<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <style>html, body {
  margin: 0;
  padding: 0;
}

.app {
  margin: 10px;
  padding: 0;
}

.files-list {
  margin: 10px 0 0;
  width: 100%;
  border-collapse: collapse;
}
.files-list__head {
  border: 1px solid #999;
}
.files-list__head > tr > th {
  padding: 10px;
  border: 1px solid #999;
  text-align: left;
  font-weight: normal;
  background: #ddd;
}
.files-list__body {
}
.files-list__file {
  cursor: pointer;
}
.files-list__file:hover {
  background: #ccf;
}
.files-list__file > td {
  padding: 10px;
  border: 1px solid #999;
}
.files-list__file > td:first-child::before {
  content: '\01F4C4';
  margin-right: 1em;
}
.files-list__file_low {
  background: #fcc;
}
.files-list__file_medium {
  background: #ffc;
}
.files-list__file_high {
  background: #cfc;
}
.files-list__file_folder > td:first-child::before {
  content: '\01F4C1';
  margin-right: 1em;
}

.file-header {
  border: 1px solid #999;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.file-header__back {
  margin: 10px;
  cursor: pointer;
  flex-shrink: 0;
  flex-grow: 0;
  text-decoration: underline;
  color: #338;
}

.file-header__name {
  margin: 10px;
  flex-shrink: 2;
  flex-grow: 2;
}

.file-header__stat {
  margin: 10px;
  flex-shrink: 0;
  flex-grow: 0;
}

.file-content {
  margin: 10px 0 0;
  border: 1px solid #999;
  padding: 10px;
}

.code-line {
  margin: 0;
  padding: 0.3em;
  height: 1em;
}
.code-line_covered {
  background: #cfc;
}
.code-line_uncovered {
  background: #fcc;
}
</style>
</head>
<body>
    <div id="root"></div>
    <script>
        var data = {"files":[{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-01","src","lib.rs"],"content":"//! Advent of Code 2015: Day 1: Not Quite Lisp\n//!\n//! [https://adventofcode.com/2015/day/1](https://adventofcode.com/2015/day/1)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Not Quite Lisp\";\n\tyear = 2015;\n\tday = 1;\n\tparse = |input| model::parse_input (input [0]);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003ci32\u003e {\n\t\tOk (\n\t\t\tinput.iter ().copied ().enumerate ()\n\t\t\t\t.scan (0_i32, |floor, (idx, dir)| {\n\t\t\t\t\t* floor += dir.val ();\n\t\t\t\t\tSome ((idx, * floor))\n\t\t\t\t})\n\t\t\t\t.last ()\n\t\t\t\t.map_or (0_i32, |(_, floor)| floor)\n\t\t)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cusize\u003e {\n\t\tOk (\n\t\t\tinput.iter ().copied ().enumerate ()\n\t\t\t\t.scan (0_i32, |floor, (idx, dir)| {\n\t\t\t\t\t* floor += dir.val ();\n\t\t\t\t\tSome ((idx, * floor))\n\t\t\t\t})\n\t\t\t\t.find_map (|(idx, floor)| (floor \u003c 0_i32).then_some (idx + 1))\n\t\t\t\t.ok_or (\"Never visited the basement\") ?\n\t\t)\n\t}\n\n\t#[ cfg (test) ]\n\tmod tests {\n\n\t\tuse super::*;\n\n\t\t#[ test ]\n\t\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\t\tuse model::Dir::*;\n\t\t\tassert_eq! (3, logic::part_one (\u0026 vec! [Up, Up, Up]) ?);\n\t\t\tassert_eq! (-1, logic::part_one (\u0026 vec! [Up, Down, Down]) ?);\n\t\t\tOk (())\n\t\t}\n\n\t\t#[ test ]\n\t\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\t\tuse model::Dir::*;\n\t\t\tassert_eq! (3, logic::part_two (\u0026 vec! [Up, Down, Down]) ?);\n\t\t\tassert_err! (\"Never visited the basement\", logic::part_two (\u0026 vec! [Up, Down]));\n\t\t\tOk (())\n\t\t}\n\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\n\tpub type Input = Vec \u003cDir\u003e;\n\n\t#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\n\tpub enum Dir { Up, Down }\n\n\timpl Dir {\n\n\t\t#[ must_use ]\n\t\tpub const fn val (\u0026 self) -\u003e i32 {\n\t\t\tmatch * self { Self::Up =\u003e 1_i32, Self::Down =\u003e -1_i32 }\n\t\t}\n\n\t}\n\n\tpub fn parse_input (input: \u0026 str) -\u003e GenResult \u003cInput\u003e {\n\t\tOk (\n\t\t\tinput.chars ().enumerate ()\n\t\t\t\t.map (|(ch_idx, ch)| match ch {\n\t\t\t\t\t'(' =\u003e Ok (Dir::Up),\n\t\t\t\t\t')' =\u003e Ok (Dir::Down),\n\t\t\t\t\t_ =\u003e Err (format! (\"Invalid character: char {}: {}\", ch_idx + 1, ch)),\n\t\t\t\t})\n\t\t\t\t.collect::\u003cResult \u003c_, _\u003e\u003e () ?\n\t\t)\n\t}\n\n\t#[ cfg (test) ]\n\tmod tests {\n\n\t\tuse super::*;\n\n\t\t#[ test ]\n\t\tfn parse_input () {\n\t\t\tassert_err! (\"Invalid character: char 3: X\", model::parse_input (\"()X\"));\n\t\t}\n\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLES_ONE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"(())\",\n\t\t\"()()\",\n\t\t\"))(((((\",\n\t\t\"())\",\n\t\t\"))(\",\n\t\t\")))\",\n\t\t\")())())\",\n\t];\n\n\tconst EXAMPLES_TWO: \u0026 [\u0026 str] = \u0026 [\n\t\t\")\",\n\t\t\"()())\",\n\t];\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq! (\"0\", puzzle.part_one (\u0026 [EXAMPLES_ONE [0]]) ?);\n\t\tassert_eq! (\"0\", puzzle.part_one (\u0026 [EXAMPLES_ONE [1]]) ?);\n\t\tassert_eq! (\"3\", puzzle.part_one (\u0026 [EXAMPLES_ONE [2]]) ?);\n\t\tassert_eq! (\"-1\", puzzle.part_one (\u0026 [EXAMPLES_ONE [3]]) ?);\n\t\tassert_eq! (\"-1\", puzzle.part_one (\u0026 [EXAMPLES_ONE [4]]) ?);\n\t\tassert_eq! (\"-3\", puzzle.part_one (\u0026 [EXAMPLES_ONE [5]]) ?);\n\t\tassert_eq! (\"-3\", puzzle.part_one (\u0026 [EXAMPLES_ONE [6]]) ?);\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq! (\"1\", puzzle.part_two (\u0026 [EXAMPLES_TWO [0]]) ?);\n\t\tassert_eq! (\"5\", puzzle.part_two (\u0026 [EXAMPLES_TWO [1]]) ?);\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":13,"address":[70627,71347],"length":1,"stats":{"Line":2},"fn_name":null},{"line":14,"address":[70788],"length":1,"stats":{"Line":1},"fn_name":null},{"line":15,"address":[71508],"length":1,"stats":{"Line":1},"fn_name":null},{"line":23,"address":[41552],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":25,"address":[41590],"length":1,"stats":{"Line":1},"fn_name":null},{"line":26,"address":[59774,59667,59616],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":27,"address":[59678,59779],"length":1,"stats":{"Line":1},"fn_name":null},{"line":28,"address":[59740],"length":1,"stats":{"Line":1},"fn_name":null},{"line":31,"address":[59839,59824],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":35,"address":[41760],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":37,"address":[42058,41798],"length":1,"stats":{"Line":2},"fn_name":null},{"line":38,"address":[60014,59856,59907],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":39,"address":[60019,59918],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[59980],"length":1,"stats":{"Line":1},"fn_name":null},{"line":42,"address":[60082,60064],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":43,"address":[42032],"length":1,"stats":{"Line":1},"fn_name":null},{"line":53,"address":[44480,44489],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":55,"address":[76937,76487],"length":1,"stats":{"Line":2},"fn_name":null},{"line":56,"address":[77484,77034],"length":1,"stats":{"Line":2},"fn_name":null},{"line":57,"address":[77556],"length":1,"stats":{"Line":1},"fn_name":null},{"line":61,"address":[44537,44528],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":63,"address":[77591,78047],"length":1,"stats":{"Line":2},"fn_name":null},{"line":64,"address":[78148],"length":1,"stats":{"Line":1},"fn_name":null},{"line":65,"address":[78667],"length":1,"stats":{"Line":1},"fn_name":null},{"line":84,"address":[23616],"length":1,"stats":{"Line":1},"fn_name":"val"},{"line":85,"address":[23625],"length":1,"stats":{"Line":1},"fn_name":null},{"line":90,"address":[23680],"length":1,"stats":{"Line":1},"fn_name":"parse_input"},{"line":92,"address":[24059,23739],"length":1,"stats":{"Line":2},"fn_name":null},{"line":93,"address":[33296,33341,33703],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":94,"address":[33407],"length":1,"stats":{"Line":1},"fn_name":null},{"line":95,"address":[33424],"length":1,"stats":{"Line":1},"fn_name":null},{"line":96,"address":[33441,33384],"length":1,"stats":{"Line":2},"fn_name":null},{"line":98,"address":[23972],"length":1,"stats":{"Line":1},"fn_name":null},{"line":108,"address":[61973,61968],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":109,"address":[66815,66519],"length":1,"stats":{"Line":2},"fn_name":null},{"line":137,"address":[40071,36160,36790],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":138,"address":[36167],"length":1,"stats":{"Line":1},"fn_name":null},{"line":139,"address":[36188,36655,36303],"length":1,"stats":{"Line":2},"fn_name":null},{"line":140,"address":[37216,36801],"length":1,"stats":{"Line":1},"fn_name":null},{"line":141,"address":[37767,37352],"length":1,"stats":{"Line":1},"fn_name":null},{"line":142,"address":[37903,38318],"length":1,"stats":{"Line":1},"fn_name":null},{"line":143,"address":[38848,38454],"length":1,"stats":{"Line":1},"fn_name":null},{"line":144,"address":[39369,38975],"length":1,"stats":{"Line":1},"fn_name":null},{"line":145,"address":[39914,39496],"length":1,"stats":{"Line":1},"fn_name":null},{"line":146,"address":[40041],"length":1,"stats":{"Line":1},"fn_name":null},{"line":150,"address":[40096,41220,40660],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":151,"address":[40103],"length":1,"stats":{"Line":1},"fn_name":null},{"line":152,"address":[40118,40224,40534],"length":1,"stats":{"Line":2},"fn_name":null},{"line":153,"address":[40671,41069],"length":1,"stats":{"Line":1},"fn_name":null},{"line":154,"address":[41196],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":50,"coverable":50},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-02","src","lib.rs"],"content":"//! Advent of Code 2015: Day 2: I Was Told There Would Be No Math\n//!\n//! [https://adventofcode.com/2015/day/2](https://adventofcode.com/2015/day/2)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"I Was Told There Would Be No Math\";\n\tyear = 2015;\n\tday = 2;\n\tparse = |input| model::parse_input (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Dim;\n\tuse model::Input;\n\tuse nums::Int;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cDim\u003e {\n\t\tOk (\n\t\t\tinput.iter_vals ().map (|(l, w, h)|\n\t\t\t\tInt::add_4 (\n\t\t\t\t\tInt::mul_3 (2, l, w) ?,\n\t\t\t\t\tInt::mul_3 (2, w, h) ?,\n\t\t\t\t\tInt::mul_3 (2, h, l) ?,\n\t\t\t\t\t[ Int::mul_2 (l, w) ?, Int::mul_2 (w, h) ?, Int::mul_2 (h, l) ?].iter_vals ()\n\t\t\t\t\t\t.min ().unwrap (),\n\t\t\t\t)\n\t\t\t).fold (Ok (0), |sum, val| Int::add_2 (sum ?, val ?)) ?\n\t\t)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cDim\u003e {\n\t\tOk (\n\t\t\tinput.iter_vals ().map (|(l, w, h)|\n\t\t\t\tInt::add_2 (\n\t\t\t\t\t[\n\t\t\t\t\t\tInt::mul_2 (2, Int::add_2 (l, w) ?) ?,\n\t\t\t\t\t\tInt::mul_2 (2, Int::add_2 (w, h) ?) ?,\n\t\t\t\t\t\tInt::mul_2 (2, Int::add_2 (h, l) ?) ?,\n\t\t\t\t\t].iter_vals ().min ().unwrap (),\n\t\t\t\t\tInt::mul_3 (l, w, h) ?,\n\t\t\t\t)\n\t\t\t).fold (Ok (0), |sum, val| Int::add_2 (sum ?, val ?)) ?\n\t\t)\n\t}\n\n\t#[ cfg (test) ]\n\tmod tests {\n\n\t\tuse super::*;\n\n\t\t#[ test ]\n\t\tfn part_one () {\n\t\t\tassert_eq_ok! (0, logic::part_one (\u0026 vec! []));\n\t\t\tassert_eq_ok! (101, logic::part_one (\u0026 vec! [(2, 3, 4), (1, 1, 10)]));\n\t\t\tconst BIG: u32 = 24770;\n\t\t\tassert_is_ok! (logic::part_one (\u0026 vec! [(BIG, BIG, BIG)]));\n\t\t\tassert_err! (\"Overflow\", logic::part_one (\u0026 vec! [(BIG + 1, BIG + 1, BIG + 1)]));\n\t\t\tassert_err! (\"Overflow\", logic::part_one (\u0026 vec! [(BIG, BIG, BIG), (BIG, BIG, BIG)]));\n\t\t}\n\n\t\t#[ test ]\n\t\tfn part_two () {\n\t\t\tassert_eq_ok! (0, logic::part_two (\u0026 vec! []));\n\t\t\tassert_eq_ok! (48, logic::part_two (\u0026 vec! [(2, 3, 4), (1, 1, 10)]));\n\t\t\tconst BIG: u32 = 1625;\n\t\t\tassert_is_ok! (logic::part_two (\u0026 vec! [(BIG, BIG, BIG)]));\n\t\t\tassert_err! (\"Overflow\", logic::part_two (\u0026 vec! [(BIG + 1, BIG + 1, BIG + 1)]));\n\t\t\tassert_err! (\"Overflow\", logic::part_two (\u0026 vec! [(BIG, BIG, BIG), (BIG, BIG, BIG)]));\n\t\t}\n\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\n\tpub type Dim = u32;\n\tpub type Input = Vec \u003c(Dim, Dim, Dim)\u003e;\n\n\tpub fn parse_input (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cInput\u003e {\n\t\tuse parser::*;\n\t\tinput.iter ().enumerate ().map (|(line_idx, line)|\n\t\t\tParser::wrap (line, |parser|\n\t\t\t\tOk ((\n\t\t\t\t\tparser.int () ?,\n\t\t\t\t\tparser.expect (\"x\") ?.int () ?,\n\t\t\t\t\tparser.expect (\"x\") ?.int () ?,\n\t\t\t\t))\n\t\t\t).map_parse_err (|char_idx|\n\t\t\t\tformat! (\"Invalid input: line {}: col {}: {}\",\n\t\t\t\t\tline_idx + 1, char_idx + 1, line)\n\t\t\t)\n\t\t).collect::\u003cResult::\u003c_, _\u003e\u003e ()\n\t}\n\n\t#[ cfg (test) ]\n\tmod tests {\n\n\t\tuse super::*;\n\n\t\t#[ test ]\n\t\tfn parse_input () -\u003e GenResult \u003c()\u003e {\n\t\t\tassert_eq! (vec! [(1, 2, 3), (4, 5, 6)], model::parse_input (\u0026 [\"1x2x3\", \"4x5x6\"]) ?);\n\t\t\tassert_err! (\"Invalid input: line 2: col 2: 4xx5x6\",\n\t\t\t\tmodel::parse_input (\u0026 [\"1x2x3\", \"4xx5x6\"]));\n\t\t\tOk (())\n\t\t}\n\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [ \"2x3x4\", \"1x1x10\" ];\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq! (\"58\", puzzle.part_one (\u0026 EXAMPLE [0 .. 1]) ?);\n\t\tassert_eq! (\"43\", puzzle.part_one (\u0026 EXAMPLE [1 .. 2]) ?);\n\t\tassert_eq! (\"101\", puzzle.part_one (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq! (\"34\", puzzle.part_two (\u0026 EXAMPLE [0 .. 1]) ?);\n\t\tassert_eq! (\"14\", puzzle.part_two (\u0026 EXAMPLE [1 .. 2]) ?);\n\t\tassert_eq! (\"48\", puzzle.part_two (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":13,"address":[42563,43251],"length":1,"stats":{"Line":2},"fn_name":null},{"line":14,"address":[42669],"length":1,"stats":{"Line":1},"fn_name":null},{"line":15,"address":[43357],"length":1,"stats":{"Line":1},"fn_name":null},{"line":25,"address":[36864],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":27,"address":[44464,44482,44662],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":28,"address":[45370],"length":1,"stats":{"Line":1},"fn_name":null},{"line":29,"address":[44638,44523],"length":1,"stats":{"Line":1},"fn_name":null},{"line":30,"address":[44774,44617,44686],"length":1,"stats":{"Line":2},"fn_name":null},{"line":31,"address":[44893,44753,44811],"length":1,"stats":{"Line":2},"fn_name":null},{"line":32,"address":[44878,44930],"length":1,"stats":{"Line":2},"fn_name":null},{"line":35,"address":[45392,45448],"length":1,"stats":{"Line":3},"fn_name":"{closure#1}"},{"line":39,"address":[37088],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":41,"address":[45650,45811,45632],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":42,"address":[46570],"length":1,"stats":{"Line":1},"fn_name":null},{"line":44,"address":[45835,45691,45917],"length":1,"stats":{"Line":2},"fn_name":null},{"line":45,"address":[46148,45902,45954],"length":1,"stats":{"Line":2},"fn_name":null},{"line":46,"address":[46185,46400,46133],"length":1,"stats":{"Line":2},"fn_name":null},{"line":48,"address":[46489,46588],"length":1,"stats":{"Line":2},"fn_name":null},{"line":50,"address":[37170],"length":1,"stats":{"Line":3},"fn_name":null},{"line":60,"address":[33984,33989],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":61,"address":[87911,88471,88095],"length":1,"stats":{"Line":2},"fn_name":null},{"line":62,"address":[88440,89152,88526,88790],"length":1,"stats":{"Line":3},"fn_name":null},{"line":64,"address":[89469,89204,89130],"length":1,"stats":{"Line":2},"fn_name":null},{"line":65,"address":[89457,89507],"length":1,"stats":{"Line":2},"fn_name":null},{"line":66,"address":[90027],"length":1,"stats":{"Line":1},"fn_name":null},{"line":70,"address":[34016,34021],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":71,"address":[91239,90863,90679],"length":1,"stats":{"Line":2},"fn_name":null},{"line":72,"address":[91294,91208,91558,91920],"length":1,"stats":{"Line":3},"fn_name":null},{"line":74,"address":[92237,91898,91972],"length":1,"stats":{"Line":2},"fn_name":null},{"line":75,"address":[92225,92275],"length":1,"stats":{"Line":2},"fn_name":null},{"line":76,"address":[92795],"length":1,"stats":{"Line":1},"fn_name":null},{"line":90,"address":[68928],"length":1,"stats":{"Line":2},"fn_name":"parse_input"},{"line":92,"address":[32396,32368,32477],"length":1,"stats":{"Line":8},"fn_name":"{closure#0}"},{"line":93,"address":[32406,32729,32452,33441,33574,32496],"length":1,"stats":{"Line":11},"fn_name":"{closure#0}"},{"line":94,"address":[33407],"length":1,"stats":{"Line":2},"fn_name":null},{"line":95,"address":[32542,32634],"length":1,"stats":{"Line":2},"fn_name":null},{"line":96,"address":[32931,32734,33024,32602],"length":1,"stats":{"Line":7},"fn_name":null},{"line":97,"address":[33145,33448,32992,33342],"length":1,"stats":{"Line":6},"fn_name":null},{"line":99,"address":[33965,32432,33584],"length":1,"stats":{"Line":4},"fn_name":"{closure#1}"},{"line":100,"address":[33662,33752,33813],"length":1,"stats":{"Line":3},"fn_name":null},{"line":101,"address":[33778,33627,33688],"length":1,"stats":{"Line":1},"fn_name":null},{"line":112,"address":[34048,34057],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":113,"address":[30519,31181,31060],"length":1,"stats":{"Line":2},"fn_name":null},{"line":114,"address":[31233],"length":1,"stats":{"Line":1},"fn_name":null},{"line":115,"address":[31208],"length":1,"stats":{"Line":1},"fn_name":null},{"line":116,"address":[31559],"length":1,"stats":{"Line":1},"fn_name":null},{"line":131,"address":[53408,53417],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":132,"address":[59191],"length":1,"stats":{"Line":1},"fn_name":null},{"line":133,"address":[59762,59212,59400],"length":1,"stats":{"Line":2},"fn_name":null},{"line":134,"address":[59908,60366],"length":1,"stats":{"Line":1},"fn_name":null},{"line":135,"address":[60881,60493],"length":1,"stats":{"Line":1},"fn_name":null},{"line":136,"address":[61008],"length":1,"stats":{"Line":1},"fn_name":null},{"line":140,"address":[53465,53456],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":141,"address":[61063],"length":1,"stats":{"Line":1},"fn_name":null},{"line":142,"address":[61084,61272,61634],"length":1,"stats":{"Line":2},"fn_name":null},{"line":143,"address":[61780,62238],"length":1,"stats":{"Line":1},"fn_name":null},{"line":144,"address":[62753,62365],"length":1,"stats":{"Line":1},"fn_name":null},{"line":145,"address":[62880],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":58,"coverable":58},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-03","src","lib.rs"],"content":"//! Advent of Code 2015: Day 3: Perfectly Spherical Houses in a Vacuum\n//!\n//! [https://adventofcode.com/2015/day/3](https://adventofcode.com/2015/day/3)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\nuse aoc_pos as pos;\n\npuzzle_info! {\n\tname = \"Perfectly Spherical Houses in a Vacuum\";\n\tyear = 2015;\n\tday = 3;\n\tparse = |input| model::parse_input (input [0]);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\tuse model::Pos;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cu32\u003e {\n\t\tlet (seen, _) = input.iter_vals ().fold (\n\t\t\t(HashMap::\u003c_, u32\u003e::from_iter ([ (Pos::ZERO, 1) ]), Pos::ZERO),\n\t\t\t|(mut seen, pos), dir| {\n\t\t\t\tlet pos = pos + dir.to_pos ();\n\t\t\t\t* seen.entry (pos).or_insert (0) += 1;\n\t\t\t\t(seen, pos)\n\t\t\t},\n\t\t);\n\t\tOk (seen.len ().try_into () ?)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cu32\u003e {\n\t\tlet (seen, _, _) = input.iter_vals ().fold (\n\t\t\t(HashMap::\u003c_, u32\u003e::from_iter ([ (Pos::ZERO, 1) ]), Pos::ZERO, Pos::ZERO),\n\t\t\t|(mut seen, pos_0, pos_1), dir| {\n\t\t\t\tlet pos_0 = pos_0 + dir.to_pos ();\n\t\t\t\t* seen.entry (pos_0).or_insert (0) += 1;\n\t\t\t\t(seen, pos_1, pos_0)\n\t\t\t},\n\t\t);\n\t\tOk (seen.len ().try_into () ?)\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\n\tpub type Input = Vec \u003cDir\u003e;\n\tpub type Pos = pos::PosGeo \u003ci16\u003e;\n\n\t#[ derive (Clone, Copy, Debug, Eq, Hash, PartialEq) ]\n\tpub enum Dir {\n\t\tNorth, South, East, West,\n\t}\n\n\timpl Dir {\n\n\t\t#[ must_use ]\n\t\tpub fn to_pos (self) -\u003e Pos {\n\t\t\tmatch self {\n\t\t\t\tSelf::North =\u003e Pos::ZERO.north (1),\n\t\t\t\tSelf::South =\u003e Pos::ZERO.south (1),\n\t\t\t\tSelf::East =\u003e Pos::ZERO.east (1),\n\t\t\t\tSelf::West =\u003e Pos::ZERO.west (1),\n\t\t\t}\n\t\t}\n\n\t}\n\n\tpub fn parse_input (input: \u0026 str) -\u003e GenResult \u003cInput\u003e {\n\t\tinput.chars ().enumerate ().map (|(ch_idx, ch)| Ok (match ch {\n\t\t\t'^' =\u003e Dir::North,\n\t\t\t'v' =\u003e Dir::South,\n\t\t\t'\u003e' =\u003e Dir::East,\n\t\t\t'\u003c' =\u003e Dir::West,\n\t\t\t_ =\u003e Err (format! (\"Invalid input: col {}: {}\", ch_idx + 1, ch)) ?,\n\t\t})).collect::\u003cGenResult \u003c_\u003e\u003e ()\n\t}\n\n\t#[ cfg (test) ]\n\tmod tests {\n\n\t\tuse super::*;\n\n\t\t#[ test ]\n\t\tfn parse_input () {\n\t\t\tuse Dir::*;\n\t\t\tassert_eq_ok! (vec! [North, East, South, West], model::parse_input (\"^\u003ev\u003c\"));\n\t\t\tassert_err! (\"Invalid input: col 3: X\", model::parse_input (\"^vX\"));\n\t\t}\n\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"2\", puzzle.part_one (\u0026 [\"\u003e\"]));\n\t\tassert_eq_ok! (\"4\", puzzle.part_one (\u0026 [\"^\u003ev\u003c\"]));\n\t\tassert_eq_ok! (\"2\", puzzle.part_one (\u0026 [\"^v^v^v^v^v\"]));\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"3\", puzzle.part_two (\u0026 [\"^v\"]));\n\t\tassert_eq_ok! (\"3\", puzzle.part_two (\u0026 [\"^\u003ev\u003c\"]));\n\t\tassert_eq_ok! (\"11\", puzzle.part_two (\u0026 [\"^v^v^v^v^v\"]));\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":14,"address":[33027,33747],"length":1,"stats":{"Line":2},"fn_name":null},{"line":15,"address":[33188],"length":1,"stats":{"Line":1},"fn_name":null},{"line":16,"address":[33908],"length":1,"stats":{"Line":1},"fn_name":null},{"line":25,"address":[72192,72653],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":26,"address":[72230,72389],"length":1,"stats":{"Line":2},"fn_name":null},{"line":27,"address":[72245],"length":1,"stats":{"Line":1},"fn_name":null},{"line":28,"address":[87577,87184,87221,87617],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":29,"address":[87281,87358],"length":1,"stats":{"Line":2},"fn_name":null},{"line":30,"address":[87585,87429],"length":1,"stats":{"Line":1},"fn_name":null},{"line":31,"address":[87503],"length":1,"stats":{"Line":1},"fn_name":null},{"line":34,"address":[72627,72502,72448],"length":1,"stats":{"Line":2},"fn_name":null},{"line":37,"address":[73195,72704],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":38,"address":[72931,72742],"length":1,"stats":{"Line":2},"fn_name":null},{"line":39,"address":[72757],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[88135,88095,87648,87685],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":41,"address":[87779,87856],"length":1,"stats":{"Line":2},"fn_name":null},{"line":42,"address":[88103,87927],"length":1,"stats":{"Line":1},"fn_name":null},{"line":43,"address":[88001],"length":1,"stats":{"Line":1},"fn_name":null},{"line":46,"address":[72990,73044,73169],"length":1,"stats":{"Line":2},"fn_name":null},{"line":66,"address":[29216],"length":1,"stats":{"Line":1},"fn_name":"to_pos"},{"line":67,"address":[29227],"length":1,"stats":{"Line":1},"fn_name":null},{"line":68,"address":[29258],"length":1,"stats":{"Line":1},"fn_name":null},{"line":69,"address":[29287],"length":1,"stats":{"Line":1},"fn_name":null},{"line":70,"address":[29316],"length":1,"stats":{"Line":1},"fn_name":null},{"line":71,"address":[29345],"length":1,"stats":{"Line":1},"fn_name":null},{"line":77,"address":[29392],"length":1,"stats":{"Line":1},"fn_name":"parse_input"},{"line":78,"address":[26228,25600,25645],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":79,"address":[25728],"length":1,"stats":{"Line":1},"fn_name":null},{"line":80,"address":[25738],"length":1,"stats":{"Line":1},"fn_name":null},{"line":81,"address":[25748],"length":1,"stats":{"Line":1},"fn_name":null},{"line":82,"address":[25758],"length":1,"stats":{"Line":1},"fn_name":null},{"line":83,"address":[25710,25773],"length":1,"stats":{"Line":2},"fn_name":null},{"line":93,"address":[72160,72165],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":95,"address":[58391,58490,59059],"length":1,"stats":{"Line":3},"fn_name":null},{"line":96,"address":[59066],"length":1,"stats":{"Line":1},"fn_name":null},{"line":109,"address":[34841,34832],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":110,"address":[65703],"length":1,"stats":{"Line":1},"fn_name":null},{"line":111,"address":[65748,65907,65832],"length":1,"stats":{"Line":3},"fn_name":null},{"line":112,"address":[66341,66457],"length":1,"stats":{"Line":2},"fn_name":null},{"line":113,"address":[66866,66982],"length":1,"stats":{"Line":2},"fn_name":null},{"line":114,"address":[67391],"length":1,"stats":{"Line":1},"fn_name":null},{"line":118,"address":[34889,34880],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":119,"address":[67543],"length":1,"stats":{"Line":1},"fn_name":null},{"line":120,"address":[67588,67672,67747],"length":1,"stats":{"Line":3},"fn_name":null},{"line":121,"address":[68181,68297],"length":1,"stats":{"Line":2},"fn_name":null},{"line":122,"address":[68822,68706],"length":1,"stats":{"Line":2},"fn_name":null},{"line":123,"address":[69231],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":47,"coverable":47},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-04","src","lib.rs"],"content":"//! Advent of Code 2015: Day 4: The Ideal Stocking Stuffer\n//!\n//! [https://adventofcode.com/2015/day/4](https://adventofcode.com/2015/day/4)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\nuse aoc_md5 as md5;\n\npuzzle_info! {\n\tname = \"The Ideal Stocking Stuffer\";\n\tyear = 2015;\n\tday = 4;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n\tcommands = [\n\t\t( name = \"run\"; method = cli::run; ),\n\t\t( name = \"find-test-case\"; method = cli::find_test_case; ),\n\t];\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse md5::Output;\n\tuse model::Input;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cusize\u003e {\n\t\tlet input = Input {\n\t\t\tseed: input.seed.clone (),\n\t\t\tnum_zeros: Some (input.num_zeros.unwrap_or (5)),\n\t\t\t.. * input\n\t\t};\n\t\tcalc_result (\u0026 input)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cusize\u003e {\n\t\tlet input = Input {\n\t\t\tseed: input.seed.clone (),\n\t\t\tnum_zeros: Some (input.num_zeros.unwrap_or (6)),\n\t\t\t.. * input\n\t\t};\n\t\tcalc_result (\u0026 input)\n\t}\n\n\tpub fn calc_result (input: \u0026 Input) -\u003e GenResult \u003cusize\u003e {\n\t\tlet num_threads = cmp::min (get_num_threads ().unwrap_or (1), input.max_threads);\n\t\tif num_threads \u003c 2 {\n\t\t\tcalc_result_serial (\u0026 input.seed, input.num_zeros.unwrap ())\n\t\t} else {\n\t\t\tcalc_result_parallel (\u0026 input.seed, input.num_zeros.unwrap (), num_threads)\n\t\t}\n\t}\n\n\tfn calc_result_serial (input: \u0026 str, num_zeros: usize) -\u003e GenResult \u003cusize\u003e {\n\t\tlet check_fn = check_zeros_fn (num_zeros);\n\t\tfor base in (0 .. ).step_by (100) {\n\t\t\tlet input_buf =\n\t\t\t\tformat! (\"{}{}\", input, if base == 0 { 1 } else { base })\n\t\t\t\t\t.as_bytes ().to_vec ();\n\t\t\tlet (min_len, loops) = if base == 0 {\n\t\t\t\t(input_buf.len () - 1, 99)\n\t\t\t} else {\n\t\t\t\t(input_buf.len () - 2, 100)\n\t\t\t};\n\t\t\tif let Some (loop_idx) = search_range (input_buf, min_len, loops, \u0026 check_fn) {\n\t\t\t\treturn Ok (if base == 0 { loop_idx + 1 } else { base + loop_idx });\n\t\t\t}\n\t\t}\n\t\tErr (\"No solution found\") ?;\n\t\tunreachable! ();\n\t}\n\n\tfn get_num_threads () -\u003e GenResult \u003cusize\u003e {\n\t\tuse std::fs::File;\n\t\tuse std::io::BufRead as _;\n\t\tuse std::io::BufReader;\n\t\tlet file = File::open (\"/proc/cpuinfo\") ?;\n\t\tlet reader = BufReader::new (file);\n\t\tlet mut num_threads = 0;\n\t\tfor line in reader.lines () {\n\t\t\tlet line = line ?;\n\t\t\tif ! line.starts_with (\"processor\\t: \") { continue }\n\t\t\tnum_threads += 1;\n\t\t}\n\t\tOk (num_threads)\n\t}\n\n\tfn calc_result_parallel (input: \u0026 str, num_zeros: usize, num_threads: usize) -\u003e GenResult \u003cusize\u003e {\n\t\tconst BATCH_SIZE: usize = 1000;\n\t\t#[ derive (Debug, Default) ]\n\t\tstruct State {\n\t\t\tqueue: VecDeque \u003cusize\u003e,\n\t\t\tsolutions: Vec \u003cusize\u003e,\n\t\t}\n\t\tlet state_mutex = Arc::new (Mutex::new (default::\u003cState\u003e ()));\n\t\tlet queue_pushed = Arc::new (Condvar::new ());\n\t\tlet queue_pulled = Arc::new (Condvar::new ());\n\t\t#[ allow (clippy::needless_collect) ]\n\t\tlet join_handles = (0 .. num_threads).map (|_| {\n\t\t\tlet input = input.to_owned ();\n\t\t\tlet state_mutex = Arc::clone (\u0026 state_mutex);\n\t\t\tlet queue_pushed = Arc::clone (\u0026 queue_pushed);\n\t\t\tlet queue_pulled = Arc::clone (\u0026 queue_pulled);\n\t\t\tlet check_fn = check_zeros_fn (num_zeros);\n\t\t\tthread::spawn (move || {\n\t\t\t\tloop {\n\t\t\t\t\tlet mut state = state_mutex.lock ().unwrap ();\n\t\t\t\t\tlet base = loop {\n\t\t\t\t\t\tif ! state.solutions.is_empty () { return }\n\t\t\t\t\t\tif let Some (next) = state.queue.pop_front () {\n\t\t\t\t\t\t\tqueue_pulled.notify_one ();\n\t\t\t\t\t\t\tbreak next;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tstate = queue_pushed.wait (state).unwrap ();\n\t\t\t\t\t};\n\t\t\t\t\tdrop (state);\n\t\t\t\t\tlet input_buf =\n\t\t\t\t\t\tformat! (\"{}{}\", input, if base == 0 { 1 } else { base })\n\t\t\t\t\t\t\t.as_bytes ().to_vec ();\n\t\t\t\t\tlet (min_len, loops) = if base == 0 {\n\t\t\t\t\t\t(input_buf.len () - 1, BATCH_SIZE - 1)\n\t\t\t\t\t} else {\n\t\t\t\t\t\t(input_buf.len () - (input_buf.len () - input.len ()), BATCH_SIZE)\n\t\t\t\t\t};\n\t\t\t\t\tif let Some (loop_idx) = search_range (input_buf, min_len, loops, \u0026 check_fn) {\n\t\t\t\t\t\tlet mut state = state_mutex.lock ().unwrap ();\n\t\t\t\t\t\tstate.solutions.push (\n\t\t\t\t\t\t\tif base == 0 { loop_idx + 1 } else { base + loop_idx });\n\t\t\t\t\t\tqueue_pulled.notify_all ();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}).collect::\u003cVec \u003c_\u003e\u003e ();\n\t\tlet mut state = state_mutex.lock ().unwrap ();\n\t\tfor base in (0 .. ).step_by (BATCH_SIZE) {\n\t\t\twhile state.queue.len () == num_threads * 8 \u0026\u0026 state.solutions.is_empty () {\n\t\t\t\tstate = queue_pulled.wait (state).unwrap ();\n\t\t\t}\n\t\t\tif ! state.solutions.is_empty () { break }\n\t\t\tstate.queue.push_back (base);\n\t\t\tqueue_pushed.notify_one ();\n\t\t}\n\t\tqueue_pushed.notify_all ();\n\t\tdrop (state);\n\t\tjoin_handles.into_iter ().for_each (|join_handle| join_handle.join ().unwrap ());\n\t\tlet state_mutex = Arc::try_unwrap (state_mutex).unwrap ();\n\t\tlet state = state_mutex.into_inner ().unwrap ();\n\t\tlet mut solutions = state.solutions;\n\t\tsolutions.sort ();\n\t\tOk (solutions.into_iter ().next ().ok_or (\"No solution found\") ?)\n\t}\n\n\tfn search_range (\n\t\tmut input_buf: Vec \u003cu8\u003e,\n\t\tmin_len: usize,\n\t\tloops: usize,\n\t\tcheck_fn: \u0026 (dyn Fn (\u0026 Output) -\u003e bool + Send + Sync),\n\t) -\u003e Option \u003cusize\u003e {\n\t\tfor loop_idx in 0 .. loops {\n\t\t\tlet hash = md5::md5_hash (\u0026 input_buf);\n\t\t\tif check_fn (\u0026 hash) { return Some (loop_idx) }\n\t\t\tlet mut num_zeros = 0;\n\t\t\twhile input_buf.len () != min_len {\n\t\t\t\tlet next_digit = match input_buf.pop ().unwrap () {\n\t\t\t\t\tb'0' =\u003e b'1', b'1' =\u003e b'2', b'2' =\u003e b'3',\n\t\t\t\t\tb'3' =\u003e b'4', b'4' =\u003e b'5', b'5' =\u003e b'6',\n\t\t\t\t\tb'6' =\u003e b'7', b'7' =\u003e b'8', b'8' =\u003e b'9',\n\t\t\t\t\tb'9' =\u003e {\n\t\t\t\t\t\tnum_zeros += 1;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t},\n\t\t\t\t\t_ =\u003e unreachable! (),\n\t\t\t\t};\n\t\t\t\tinput_buf.push (next_digit);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif input_buf.len () == min_len { input_buf.push (b'1'); }\n\t\t\tinput_buf.extend (iter::repeat (b'0').take (num_zeros));\n\t\t}\n\t\tNone\n\t}\n\n\tfn check_zeros \u003cconst ZRS: usize\u003e (hash: \u0026 Output) -\u003e bool {\n\t\tfor idx in 0 .. hash.len () {\n\t\t\tif ZRS == idx * 2 + 1 \u0026\u0026 hash [idx] \u0026 0xf0 != 0 { return false }\n\t\t\tif ZRS \u003e= idx * 2 + 2 \u0026\u0026 hash [idx] != 0 { return false }\n\t\t}\n\t\ttrue\n\t}\n\n\tfn check_zeros_fn (num_zeros: usize) -\u003e Box \u003cdyn Fn (\u0026 Output) -\u003e bool + Send + Sync\u003e {\n\t\tBox::new (match num_zeros {\n\t\t\t0 =\u003e check_zeros::\u003c0\u003e, 1 =\u003e check_zeros::\u003c1\u003e, 2 =\u003e check_zeros::\u003c2\u003e,\n\t\t\t3 =\u003e check_zeros::\u003c3\u003e, 4 =\u003e check_zeros::\u003c4\u003e, 5 =\u003e check_zeros::\u003c5\u003e,\n\t\t\t6 =\u003e check_zeros::\u003c6\u003e, 7 =\u003e check_zeros::\u003c7\u003e, 8 =\u003e check_zeros::\u003c8\u003e,\n\t\t\t9 =\u003e check_zeros::\u003c9\u003e, 10 =\u003e check_zeros::\u003c10\u003e, 11 =\u003e check_zeros::\u003c11\u003e,\n\t\t\t12 =\u003e check_zeros::\u003c12\u003e, 13 =\u003e check_zeros::\u003c13\u003e, 14 =\u003e check_zeros::\u003c14\u003e,\n\t\t\t15 =\u003e check_zeros::\u003c15\u003e, 16 =\u003e check_zeros::\u003c16\u003e, 17 =\u003e check_zeros::\u003c17\u003e,\n\t\t\t18 =\u003e check_zeros::\u003c18\u003e, 19 =\u003e check_zeros::\u003c19\u003e, 20 =\u003e check_zeros::\u003c20\u003e,\n\t\t\t21 =\u003e check_zeros::\u003c21\u003e, 22 =\u003e check_zeros::\u003c22\u003e, 23 =\u003e check_zeros::\u003c23\u003e,\n\t\t\t24 =\u003e check_zeros::\u003c24\u003e, 25 =\u003e check_zeros::\u003c25\u003e, 26 =\u003e check_zeros::\u003c26\u003e,\n\t\t\t27 =\u003e check_zeros::\u003c27\u003e, 28 =\u003e check_zeros::\u003c28\u003e, 29 =\u003e check_zeros::\u003c29\u003e,\n\t\t\t30 =\u003e check_zeros::\u003c30\u003e, 31 =\u003e check_zeros::\u003c31\u003e, 32 =\u003e check_zeros::\u003c32\u003e,\n\t\t\t_ =\u003e unreachable! (),\n\t\t})\n\t}\n\n\t#[ cfg (test) ]\n\tmod tests {\n\n\t\tuse super::*;\n\n\t\t#[ test ]\n\t\tfn check_zeros_fn () {\n\t\t\tfn with_zeros (zeros: usize) -\u003e Output {\n\t\t\t\tlet mut hex = String::new ();\n\t\t\t\tfor _ in 0 .. zeros { hex.push ('0'); }\n\t\t\t\twhile hex.len () \u003c 32 { hex.push ('f'); }\n\t\t\t\tOutput::from_hex (\u0026 hex).unwrap ()\n\t\t\t}\n\t\t\tfor zeros in 0 ..= 32 {\n\t\t\t\tlet check_fn = logic::check_zeros_fn (zeros);\n\t\t\t\tlet should_pass = with_zeros (zeros);\n\t\t\t\tassert! (check_fn (\u0026 should_pass));\n\t\t\t\tif zeros \u003e 0 {\n\t\t\t\t\tlet should_fail = with_zeros (zeros - 1);\n\t\t\t\t\tassert! (! check_fn (\u0026 should_fail), \"Should fail for {} zeros: {}\", zeros, should_fail);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t#[ test ]\n\t\t#[ should_panic ]\n\t\tfn check_zeros_fn_panic () {\n\t\t\tlet _ = logic::check_zeros_fn (33);\n\t\t}\n\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\n\tpub struct Input {\n\t\tpub seed: String,\n\t\tpub num_zeros: Option \u003cusize\u003e,\n\t\tpub max_threads: usize,\n\t}\n\n\timpl Input {\n\t\tpub fn parse (mut input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet num_zeros = parser::input_param_opt (\u0026 mut input, \"NUM_ZEROS=\") ?;\n\t\t\tlet max_threads = parser::input_param (\u0026 mut input, \"MAX_THREADS=\", usize::MAX) ?;\n\t\t\tlet seed = input [0].to_owned ();\n\t\t\tOk (Self { seed, num_zeros, max_threads })\n\t\t}\n\t}\n\n}\n\n#[ cfg (not (tarpaulin_include)) ]\nmod cli {\n\n\tuse super::*;\n\tuse model::Input;\n\tuse std::io::Read as _;\n\tuse std::fs::File;\n\tuse std::sync::atomic::AtomicBool;\n\tuse std::sync::atomic::Ordering;\n\n\t#[ derive (clap::Parser) ]\n\tpub struct RunArgs {\n\n\t\t#[ clap (long, default_value = \"2015/inputs/day-04\") ]\n\t\tinput: String,\n\n\t\t#[ clap (long) ]\n\t\tmax_threads: Option \u003cusize\u003e,\n\n\t\t#[ clap (long) ]\n\t\tzeros: usize,\n\n\t}\n\n\t#[ allow (clippy::needless_pass_by_value) ]\n\t#[ allow (clippy::print_stdout) ]\n\tpub fn run (args: RunArgs) -\u003e GenResult \u003c()\u003e {\n\t\tlet input_string = fs::read_to_string (\u0026 args.input) ?;\n\t\tlet input_lines: Vec \u003c_\u003e = input_string.trim ().split ('\\n').collect ();\n\t\tprintln! (\"Using input file: {}\", \u0026 args.input);\n\t\tprintln! (\"Looking for {} zeros\", args.zeros);\n\t\tlet input = Input {\n\t\t\tseed: input_lines [0].to_owned (),\n\t\t\tnum_zeros: Some (args.zeros),\n\t\t\tmax_threads: args.max_threads.unwrap_or (usize::MAX),\n\t\t};\n\t\tlet result = logic::calc_result (\u0026 input) ?;\n\t\tprintln! (\"Result: {}\", result);\n\t\tOk (())\n\t}\n\n\t#[ derive (Clone, clap::Parser) ]\n\tpub struct FindTestCaseArgs {\n\n\t\t#[ clap (long, default_value = \"16\") ]\n\t\tlen: usize,\n\n\t\t#[ clap (long, default_value = \"3999\") ]\n\t\tmax: usize,\n\n\t}\n\n\t#[ allow (clippy::needless_collect) ]\n\t#[ allow (clippy::needless_pass_by_value) ]\n\t#[ allow (clippy::unnecessary_wraps) ]\n\tpub fn find_test_case (args: FindTestCaseArgs) -\u003e GenResult \u003c()\u003e {\n\t\tassert! (args.len \u003e= 4);\n\t\tassert! (args.max \u003c 0x_0100_0000);\n\t\tlet complete = Arc::new (AtomicBool::new (false));\n\t\tlet threads: Vec \u003c_\u003e = (0_u32 .. 4_u32)\n\t\t\t.map (|_| {\n\t\t\t\tlet args = args.clone ();\n\t\t\t\tlet complete = Arc::clone (\u0026 complete);\n\t\t\t\tstd::thread::spawn (move || find_test_case_worker (args, complete))\n\t\t\t})\n\t\t\t.collect ();\n\t\tthreads.into_iter ().for_each (|thread| thread.join ().unwrap ());\n\t\tOk (())\n\t}\n\n\t#[ allow (clippy::needless_pass_by_value) ]\n\t#[ allow (clippy::print_stdout) ]\n\t#[ allow (clippy::string_slice) ]\n\tfn find_test_case_worker (args: FindTestCaseArgs, complete: Arc \u003cAtomicBool\u003e) {\n\t\tlet mut rand = File::open (\"/dev/urandom\").unwrap ();\n\t\t'OUTER: loop {\n\t\t\tif complete.load (Ordering::Acquire) { break }\n\t\t\tlet num = loop {\n\t\t\t\tlet mut buf = [0; 3];\n\t\t\t\tassert_eq! (3, rand.read (\u0026 mut buf).unwrap ());\n\t\t\t\tlet num =\n\t\t\t\t\t(buf [0].as_usize () \u003c\u003c 16_u32)\n\t\t\t\t\t\t| (buf [1].as_usize () \u003c\u003c 8_u32)\n\t\t\t\t\t\t| buf [2].as_usize ();\n\t\t\t\tif num \u003c= args.max { break num }\n\t\t\t};\n\t\t\tlet mut buffer = String::new ();\n\t\t\tfor _ in 0 .. args.len - 4 {\n\t\t\t\tlet ch = loop {\n\t\t\t\t\tlet mut buf = [0; 1];\n\t\t\t\t\tassert_eq! (1, rand.read (\u0026 mut buf).unwrap ());\n\t\t\t\t\tlet ch = buf [0].as_char ();\n\t\t\t\t\tif ('a' ..= 'z').contains (\u0026 ch) { break ch }\n\t\t\t\t};\n\t\t\t\tbuffer.push (ch);\n\t\t\t}\n\t\t\tfor chars in ('a' ..= 'z').permutations (4) {\n\t\t\t\tbuffer.truncate (args.len - 4);\n\t\t\t\tfor ch in chars { buffer.push (ch); }\n\t\t\t\twrite! (buffer, \"{}\", num).unwrap ();\n\t\t\t\tlet hash = md5::md5_hash (buffer.as_bytes ());\n\t\t\t\tif hash [0] == 0 \u0026\u0026 hash [1] == 0 \u0026\u0026 hash [2] == 0 {\n\t\t\t\t\tfor num in 1 .. num {\n\t\t\t\t\t\tlet buffer = format! (\"{}{}\", \u0026 buffer [0 .. args.len], num);\n\t\t\t\t\t\tlet hash = md5::md5_hash (buffer.as_bytes ());\n\t\t\t\t\t\tif hash [0] == 0 \u0026\u0026 hash [1] == 0 \u0026\u0026 hash [2] \u0026 0xf0 == 0\n\t\t\t\t\t\t\t\t\u0026\u0026 hash [2] \u0026 0xf != 0 {\n\t\t\t\t\t\t\tprintln! (\"{:?}\", \u0026 buffer [0 .. args.len]);\n\t\t\t\t\t\t\tcomplete.store (true, Ordering::Release);\n\t\t\t\t\t\t\tbreak 'OUTER;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"xxebvswgx\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"3206\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"4846\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":14,"address":[145360,145712],"length":1,"stats":{"Line":2},"fn_name":null},{"line":15,"address":[145449],"length":1,"stats":{"Line":1},"fn_name":null},{"line":16,"address":[145801],"length":1,"stats":{"Line":1},"fn_name":null},{"line":29,"address":[48973,48832],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":31,"address":[48850],"length":1,"stats":{"Line":1},"fn_name":null},{"line":35,"address":[48898],"length":1,"stats":{"Line":1},"fn_name":null},{"line":38,"address":[49133,48992],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":40,"address":[49010],"length":1,"stats":{"Line":1},"fn_name":null},{"line":44,"address":[49058],"length":1,"stats":{"Line":1},"fn_name":null},{"line":47,"address":[49152],"length":1,"stats":{"Line":2},"fn_name":"calc_result"},{"line":48,"address":[49176,49240],"length":1,"stats":{"Line":4},"fn_name":null},{"line":49,"address":[49266],"length":1,"stats":{"Line":2},"fn_name":null},{"line":50,"address":[49277],"length":1,"stats":{"Line":0},"fn_name":null},{"line":52,"address":[49292],"length":1,"stats":{"Line":2},"fn_name":null},{"line":56,"address":[50336,49408],"length":1,"stats":{"Line":0},"fn_name":"calc_result_serial"},{"line":57,"address":[49440],"length":1,"stats":{"Line":0},"fn_name":null},{"line":59,"address":[49675,49937,49824,49530],"length":1,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[49827],"length":1,"stats":{"Line":0},"fn_name":null},{"line":63,"address":[50092,49861],"length":1,"stats":{"Line":0},"fn_name":null},{"line":65,"address":[49834,50062],"length":1,"stats":{"Line":0},"fn_name":null},{"line":67,"address":[49871],"length":1,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[49940,50122],"length":1,"stats":{"Line":0},"fn_name":null},{"line":75,"address":[50352,51122],"length":1,"stats":{"Line":2},"fn_name":"get_num_threads"},{"line":82,"address":[50528,51107],"length":1,"stats":{"Line":2},"fn_name":null},{"line":83,"address":[50641,50618],"length":1,"stats":{"Line":4},"fn_name":null},{"line":84,"address":[50683],"length":1,"stats":{"Line":2},"fn_name":null},{"line":85,"address":[50716],"length":1,"stats":{"Line":2},"fn_name":null},{"line":87,"address":[50794],"length":1,"stats":{"Line":2},"fn_name":null},{"line":90,"address":[51136,53571],"length":1,"stats":{"Line":2},"fn_name":"calc_result_parallel"},{"line":97,"address":[51361],"length":1,"stats":{"Line":2},"fn_name":null},{"line":98,"address":[51419],"length":1,"stats":{"Line":2},"fn_name":null},{"line":99,"address":[51477],"length":1,"stats":{"Line":2},"fn_name":null},{"line":101,"address":[102656,102989,102906],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":102,"address":[102676],"length":1,"stats":{"Line":2},"fn_name":null},{"line":103,"address":[102773,102792],"length":1,"stats":{"Line":4},"fn_name":null},{"line":104,"address":[102812,102797],"length":1,"stats":{"Line":4},"fn_name":null},{"line":105,"address":[102831,102817],"length":1,"stats":{"Line":4},"fn_name":null},{"line":106,"address":[102836],"length":1,"stats":{"Line":2},"fn_name":null},{"line":107,"address":[103008,103778,104573,102848],"length":1,"stats":{"Line":5},"fn_name":"{closure#0}"},{"line":111,"address":[103167],"length":1,"stats":{"Line":2},"fn_name":null},{"line":113,"address":[103283],"length":1,"stats":{"Line":2},"fn_name":null},{"line":118,"address":[103289],"length":1,"stats":{"Line":2},"fn_name":null},{"line":120,"address":[103642,103939,103319,103454],"length":1,"stats":{"Line":13},"fn_name":null},{"line":121,"address":[104452],"length":1,"stats":{"Line":0},"fn_name":null},{"line":122,"address":[103645],"length":1,"stats":{"Line":4},"fn_name":null},{"line":123,"address":[103680,104182],"length":1,"stats":{"Line":2},"fn_name":null},{"line":125,"address":[104122,103647],"length":1,"stats":{"Line":2},"fn_name":null},{"line":127,"address":[103690],"length":1,"stats":{"Line":4},"fn_name":null},{"line":128,"address":[103931],"length":1,"stats":{"Line":1},"fn_name":null},{"line":130,"address":[104261,103942],"length":1,"stats":{"Line":1},"fn_name":null},{"line":131,"address":[104032],"length":1,"stats":{"Line":1},"fn_name":null},{"line":136,"address":[102944],"length":1,"stats":{"Line":0},"fn_name":null},{"line":137,"address":[51665],"length":1,"stats":{"Line":2},"fn_name":null},{"line":139,"address":[51865,51876,52772,51818],"length":1,"stats":{"Line":6},"fn_name":null},{"line":140,"address":[51887,51954],"length":1,"stats":{"Line":4},"fn_name":null},{"line":142,"address":[51990],"length":1,"stats":{"Line":2},"fn_name":null},{"line":144,"address":[51764],"length":1,"stats":{"Line":2},"fn_name":null},{"line":146,"address":[52043],"length":1,"stats":{"Line":1},"fn_name":null},{"line":147,"address":[52049],"length":1,"stats":{"Line":1},"fn_name":null},{"line":148,"address":[52148,52091],"length":1,"stats":{"Line":2},"fn_name":null},{"line":149,"address":[52153],"length":1,"stats":{"Line":2},"fn_name":null},{"line":151,"address":[52374],"length":1,"stats":{"Line":2},"fn_name":null},{"line":153,"address":[52462,52409],"length":1,"stats":{"Line":4},"fn_name":null},{"line":156,"address":[53584,54470],"length":1,"stats":{"Line":4},"fn_name":"search_range"},{"line":164,"address":[53875],"length":1,"stats":{"Line":4},"fn_name":null},{"line":166,"address":[53970,53900],"length":1,"stats":{"Line":8},"fn_name":null},{"line":167,"address":[53948],"length":1,"stats":{"Line":4},"fn_name":null},{"line":172,"address":[54335,53953],"length":1,"stats":{"Line":4},"fn_name":null},{"line":180,"address":[54159],"length":1,"stats":{"Line":4},"fn_name":null},{"line":186,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":187,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":188,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":189,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":191,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":194,"address":[54480],"length":1,"stats":{"Line":2},"fn_name":"check_zeros_fn"},{"line":195,"address":[54481],"length":1,"stats":{"Line":2},"fn_name":null},{"line":207,"address":[54534],"length":1,"stats":{"Line":1},"fn_name":null},{"line":217,"address":[107376,107763],"length":1,"stats":{"Line":2},"fn_name":"check_zeros_fn"},{"line":218,"address":[107776,108167],"length":1,"stats":{"Line":1},"fn_name":"with_zeros"},{"line":221,"address":[107894,108023],"length":1,"stats":{"Line":2},"fn_name":null},{"line":222,"address":[107910],"length":1,"stats":{"Line":1},"fn_name":null},{"line":224,"address":[107420],"length":1,"stats":{"Line":1},"fn_name":null},{"line":225,"address":[107424],"length":1,"stats":{"Line":1},"fn_name":null},{"line":226,"address":[107448],"length":1,"stats":{"Line":1},"fn_name":null},{"line":227,"address":[107472,107576],"length":1,"stats":{"Line":1},"fn_name":null},{"line":228,"address":[107476],"length":1,"stats":{"Line":1},"fn_name":null},{"line":229,"address":[107481],"length":1,"stats":{"Line":1},"fn_name":null},{"line":230,"address":[107506,107694,107606],"length":1,"stats":{"Line":1},"fn_name":null},{"line":237,"address":[108176],"length":1,"stats":{"Line":0},"fn_name":"check_zeros_fn_panic"},{"line":256,"address":[117664],"length":1,"stats":{"Line":2},"fn_name":"parse"},{"line":259,"address":[118028,118166],"length":1,"stats":{"Line":0},"fn_name":null},{"line":260,"address":[118090],"length":1,"stats":{"Line":2},"fn_name":null},{"line":395,"address":[60784],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":396,"address":[164716],"length":1,"stats":{"Line":1},"fn_name":null},{"line":397,"address":[164769,164892,165000,164817,164737,165072],"length":1,"stats":{"Line":3},"fn_name":null},{"line":401,"address":[60800],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":402,"address":[165132],"length":1,"stats":{"Line":1},"fn_name":null},{"line":403,"address":[165308,165416,165488,165185,165233,165153],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":83,"coverable":98},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-05","src","lib.rs"],"content":"//! Advent of Code 2015: Day 5: Doesn't He Have Intern-Elves For This?\n//!\n//! [https://adventofcode.com/2015/day/5](https://adventofcode.com/2015/day/5)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Doesn't He Have Intern-Elves For This?\";\n\tyear = 2015;\n\tday = 5;\n\tparse = |input| model::parse_input (input);\n\tpart_one = |input| Ok::\u003c_, Infallible\u003e (logic::part_one (\u0026 input));\n\tpart_two = |input| Ok::\u003c_, Infallible\u003e (logic::part_two (\u0026 input));\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\n\t#[ must_use ]\n\tpub fn part_one (input: \u0026 Input) -\u003e usize {\n\t\tinput.iter ()\n\t\t\t.filter (|line| is_nice_one (line))\n\t\t\t.count ()\n\t}\n\n\t#[ must_use ]\n\tpub fn part_two (input: \u0026 Input) -\u003e usize {\n\t\tinput.iter ()\n\t\t\t.filter (|line| is_nice_two (line))\n\t\t\t.count ()\n\t}\n\n\tfn is_nice_one (input: \u0026 str) -\u003e bool {\n\t\tif input.chars ()\n\t\t\t\t.filter (|ch| ['a', 'e', 'i', 'o', 'u'].contains (ch))\n\t\t\t\t.count () \u003c 3\n\t\t\t{ return false }\n\t\tif ! input.chars ()\n\t\t\t\t.tuple_windows::\u003c(_, _)\u003e ()\n\t\t\t\t.any (|(ch_0, ch_1)| ch_0 == ch_1)\n\t\t\t{ return false }\n\t\tif input.chars ()\n\t\t\t\t.tuple_windows::\u003c(_, _)\u003e ()\n\t\t\t\t.any (|chars|\n\t\t\t\t\t[ ('a', 'b'), ('c', 'd'), ('p', 'q'), ('x', 'y') ]\n\t\t\t\t\t\t.contains (\u0026 chars))\n\t\t\t{ return false }\n\t\ttrue\n\t}\n\n\tfn is_nice_two (input: \u0026 str) -\u003e bool {\n\t\tif ! input.chars ()\n\t\t\t\t.tuple_windows::\u003c(_, _)\u003e ()\n\t\t\t\t.enumerate ()\n\t\t\t\t.any (|(idx, chars_0)|\n\t\t\t\t\tinput.chars ().skip (idx + 2)\n\t\t\t\t\t\t.tuple_windows::\u003c(_, _)\u003e ()\n\t\t\t\t\t\t.any (|chars_1| chars_0 == chars_1))\n\t\t\t{ return false }\n\t\tif ! input.chars ()\n\t\t\t\t.tuple_windows::\u003c(_, _, _)\u003e ()\n\t\t\t\t.any (|(ch_0, _, ch_1)| ch_0 == ch_1)\n\t\t\t{ return false }\n\t\ttrue\n\t}\n\n\t#[ cfg (test) ]\n\tmod tests {\n\n\t\tuse super::*;\n\n\t\t#[ test ]\n\t\tfn is_nice_one () -\u003e GenResult \u003c()\u003e {\n\t\t\tassert_eq! (true, logic::is_nice_one (\"ugknbfddgicrmopn\"));\n\t\t\tassert_eq! (true, logic::is_nice_one (\"aaa\"));\n\t\t\tassert_eq! (false, logic::is_nice_one (\"jchzalrnumimnmhp\"));\n\t\t\tassert_eq! (false, logic::is_nice_one (\"haegwjzuvuyypxyu\"));\n\t\t\tassert_eq! (false, logic::is_nice_one (\"dvszwmarrgswjxmb\"));\n\t\t\tOk (())\n\t\t}\n\n\t\t#[ test ]\n\t\tfn is_nice_two () -\u003e GenResult \u003c()\u003e {\n\t\t\tassert_eq! (true, logic::is_nice_two (\"qjhvhtzxzqqjkmpb\"));\n\t\t\tassert_eq! (true, logic::is_nice_two (\"xxyxx\"));\n\t\t\tassert_eq! (false, logic::is_nice_two (\"uurcxstgmygtbstg\"));\n\t\t\tassert_eq! (false, logic::is_nice_two (\"ieodomkazucvgmuy\"));\n\t\t\tOk (())\n\t\t}\n\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\n\t#[ derive (Clone) ]\n\tpub struct Input (Vec \u003cString\u003e);\n\n\timpl Deref for Input {\n\t\ttype Target = [String];\n\t\tfn deref (\u0026 self) -\u003e \u0026 Self::Target { \u0026 self.0 }\n\t}\n\n\tpub fn parse_input (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cInput\u003e {\n\t\tOk (\n\t\t\tinput.iter ().all (|line| line.chars ()\n\t\t\t\t\t.all (|ch| char::is_ascii_lowercase (\u0026 ch)))\n\t\t\t\t.then_some (Input (input.iter ()\n\t\t\t\t\t.map (|\u0026 line| line.to_owned ()).collect ()))\n\t\t\t\t.ok_or (\"Invalid input\") ?\n\t\t)\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE_ONE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"ugknbfddgicrmopn\",\n\t\t\"aaa\",\n\t\t\"jchzalrnumimnmhp\",\n\t\t\"haegwjzuvuyypxyu\",\n\t\t\"dvszwmarrgswjxmb\",\n\t];\n\n\tconst EXAMPLE_TWO: \u0026 [\u0026 str] = \u0026 [\n\t\t\"qjhvhtzxzqqjkmpb\",\n\t\t\"xxyxx\",\n\t\t\"uurcxstgmygtbstg\",\n\t\t\"ieodomkazucvgmuy\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"2\", puzzle.part_one (EXAMPLE_ONE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"2\", puzzle.part_two (EXAMPLE_TWO));\n\t}\n\n}\n","traces":[{"line":13,"address":[38611,37987],"length":1,"stats":{"Line":2},"fn_name":null},{"line":14,"address":[38203,38091],"length":1,"stats":{"Line":2},"fn_name":null},{"line":15,"address":[38715,38827],"length":1,"stats":{"Line":2},"fn_name":null},{"line":24,"address":[41536],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":25,"address":[41545],"length":1,"stats":{"Line":1},"fn_name":null},{"line":26,"address":[66864,66878],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":31,"address":[41648],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":32,"address":[41657],"length":1,"stats":{"Line":1},"fn_name":null},{"line":33,"address":[66944,66958],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":37,"address":[41760],"length":1,"stats":{"Line":1},"fn_name":"is_nice_one"},{"line":38,"address":[41793],"length":1,"stats":{"Line":1},"fn_name":null},{"line":39,"address":[67024,67041],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":41,"address":[41891],"length":1,"stats":{"Line":1},"fn_name":null},{"line":42,"address":[41874,41923],"length":1,"stats":{"Line":2},"fn_name":null},{"line":44,"address":[67088,67104],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":45,"address":[41984],"length":1,"stats":{"Line":1},"fn_name":null},{"line":46,"address":[41967,42001],"length":1,"stats":{"Line":2},"fn_name":null},{"line":48,"address":[67183,67136],"length":1,"stats":{"Line":2},"fn_name":"{closure#2}"},{"line":49,"address":[67153],"length":1,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[42051],"length":1,"stats":{"Line":1},"fn_name":null},{"line":52,"address":[42041],"length":1,"stats":{"Line":1},"fn_name":null},{"line":55,"address":[42064],"length":1,"stats":{"Line":1},"fn_name":"is_nice_two"},{"line":56,"address":[42097,42173],"length":1,"stats":{"Line":2},"fn_name":null},{"line":59,"address":[42157],"length":1,"stats":{"Line":4},"fn_name":null},{"line":60,"address":[67371,67245],"length":1,"stats":{"Line":2},"fn_name":null},{"line":62,"address":[67408,67361,67425],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":63,"address":[42240],"length":1,"stats":{"Line":1},"fn_name":null},{"line":64,"address":[42223,42272],"length":1,"stats":{"Line":2},"fn_name":null},{"line":66,"address":[67480,67472],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":67,"address":[42319],"length":1,"stats":{"Line":1},"fn_name":null},{"line":68,"address":[42312],"length":1,"stats":{"Line":1},"fn_name":null},{"line":77,"address":[32448,32457],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":78,"address":[35751,35884],"length":1,"stats":{"Line":1},"fn_name":null},{"line":79,"address":[35846,35923,36048],"length":1,"stats":{"Line":2},"fn_name":null},{"line":80,"address":[36221,36010,36096],"length":1,"stats":{"Line":2},"fn_name":null},{"line":81,"address":[36269,36394,36183],"length":1,"stats":{"Line":2},"fn_name":null},{"line":82,"address":[36564,36356,36442],"length":1,"stats":{"Line":2},"fn_name":null},{"line":83,"address":[36528],"length":1,"stats":{"Line":1},"fn_name":null},{"line":87,"address":[32496,32505],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":88,"address":[36631,36764],"length":1,"stats":{"Line":1},"fn_name":null},{"line":89,"address":[36726,36803,36928],"length":1,"stats":{"Line":2},"fn_name":null},{"line":90,"address":[36890,36976,37101],"length":1,"stats":{"Line":2},"fn_name":null},{"line":91,"address":[37063,37273,37149],"length":1,"stats":{"Line":2},"fn_name":null},{"line":92,"address":[37236],"length":1,"stats":{"Line":1},"fn_name":null},{"line":108,"address":[69872,69881],"length":1,"stats":{"Line":4},"fn_name":"deref"},{"line":111,"address":[69920],"length":1,"stats":{"Line":2},"fn_name":"parse_input"},{"line":113,"address":[59568,59582],"length":1,"stats":{"Line":8},"fn_name":"{closure#0}"},{"line":114,"address":[59645,59632],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":115,"address":[70031],"length":1,"stats":{"Line":2},"fn_name":null},{"line":116,"address":[59701,59680],"length":1,"stats":{"Line":4},"fn_name":"{closure#1}"},{"line":117,"address":[70368],"length":1,"stats":{"Line":0},"fn_name":null},{"line":144,"address":[26928,26933],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":145,"address":[40263],"length":1,"stats":{"Line":1},"fn_name":null},{"line":146,"address":[40286,40360,40426],"length":1,"stats":{"Line":3},"fn_name":null},{"line":150,"address":[26965,26960],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":151,"address":[40903],"length":1,"stats":{"Line":1},"fn_name":null},{"line":152,"address":[41000,41066,40926],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":56,"coverable":57},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-06","src","lib.rs"],"content":"//! Advent of Code 2015: Day 6: Probably a Fire Hazard\n//!\n//! [https://adventofcode.com/2015/day/6](https://adventofcode.com/2015/day/6)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\nuse aoc_pos as pos;\n\npuzzle_info! {\n\tname = \"Probably a Fire Hazard\";\n\tyear = 2015;\n\tday = 6;\n\tparse = |input| model::parse_input (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Action;\n\tuse model::Coord;\n\tuse model::Input;\n\tuse model::Step;\n\tuse nums::Int;\n\tuse nums::IntConv;\n\n\tpub type ModeFn = fn (Action, u8) -\u003e u8;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cu32\u003e {\n\t\tcalc_result (input, mode_fn_one)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cu32\u003e {\n\t\tcalc_result (input, mode_fn_two)\n\t}\n\n\tconst fn mode_fn_one (action: Action, old_active: u8) -\u003e u8 {\n\t\tmatch action {\n\t\t\tAction::On =\u003e 1,\n\t\t\tAction::Off =\u003e 0,\n\t\t\tAction::Toggle =\u003e if old_active == 0 { 1 } else { 0 },\n\t\t}\n\t}\n\n\tfn mode_fn_two (action: Action, old_active: u8) -\u003e u8 {\n\t\tmatch action {\n\t\t\tAction::On =\u003e u8::checked_add (old_active, 1).unwrap (),\n\t\t\tAction::Off =\u003e u8::saturating_sub (old_active, 1),\n\t\t\tAction::Toggle =\u003e u8::checked_add (old_active, 2).unwrap (),\n\t\t}\n\t}\n\n\tfn calc_result (steps: \u0026 [Step], mode_fn: ModeFn) -\u003e GenResult \u003cu32\u003e {\n\t\tlet steps =\n\t\t\tsteps.iter ().copied ()\n\t\t\t\t.enumerate ()\n\t\t\t\t.sorted_by_key (|\u0026 (_, step)| step.origin)\n\t\t\t\t.collect::\u003cVec \u003c_\u003e\u003e ();\n\t\tlet rows =\n\t\t\tsteps.iter ().copied ()\n\t\t\t\t.flat_map (|(_, step)| [ step.origin.row, step.peak.row ])\n\t\t\t\t.sorted ()\n\t\t\t\t.dedup ()\n\t\t\t\t.collect::\u003cVec \u003c_\u003e\u003e ();\n\t\tlet mut cur_steps: Vec \u003c(usize, Step)\u003e = Vec::new ();\n\t\tlet mut sum = 0;\n\t\tlet mut prev_row = Coord::MIN;\n\t\tlet mut prev_active = 0;\n\t\tlet mut steps_iter = steps.into_iter ().peekable ();\n\t\tlet mut row_data: Vec \u003c(Coord, u8)\u003e = Vec::new ();\n\t\tlet mut row_data_temp = Vec::new ();\n\t\tfor row in rows {\n\t\t\tsum = u32::checked_add (sum,\n\t\t\t\tu32::checked_mul (\n\t\t\t\t\tu16::checked_sub (row, prev_row).unwrap ().as_u32 (),\n\t\t\t\t\tprev_active.as_u32 (),\n\t\t\t\t).unwrap (),\n\t\t\t).unwrap ();\n\t\t\tcur_steps.retain (|\u0026 (_, step)| row \u003c step.peak.row);\n\t\t\twhile let Some (\u0026 (_, step)) = steps_iter.peek () {\n\t\t\t\tif step.origin.row != row { break }\n\t\t\t\tcur_steps.push (steps_iter.next ().unwrap ());\n\t\t\t}\n\t\t\tcur_steps.sort_by_key (|\u0026 (idx, _)| idx);\n\t\t\trow_data.clear ();\n\t\t\t{\n\t\t\t\tlet mut steps = \u0026 * cur_steps;\n\t\t\t\ttrait RowIter: Iterator \u003cItem = (Coord, u8)\u003e {}\n\t\t\t\timpl \u003cSomeIter: Iterator \u003cItem = (Coord, u8)\u003e\u003e RowIter for SomeIter {}\n\t\t\t\t#[ inline ]\n\t\t\t\tfn update_once (iter: impl RowIter, step: Step, mode_fn: ModeFn) -\u003e impl RowIter {\n\t\t\t\t\tUpdateLineIter::new (iter, step.action, step.origin.col, step.peak.col, mode_fn)\n\t\t\t\t}\n\t\t\t\t#[ inline ]\n\t\t\t\tfn update_twice (iter: impl RowIter, steps: \u0026 [(usize, Step)], mode_fn: ModeFn) -\u003e impl RowIter {\n\t\t\t\t\tupdate_once (update_once (iter, steps [0].1, mode_fn), steps [1].1, mode_fn)\n\t\t\t\t}\n\t\t\t\t#[ inline ]\n\t\t\t\tfn update_four_x (iter: impl RowIter, steps: \u0026 [(usize, Step)], mode_fn: ModeFn) -\u003e impl RowIter {\n\t\t\t\t\tupdate_twice (update_twice (iter, \u0026 steps [0 .. 2], mode_fn), \u0026 steps [2 .. 4], mode_fn)\n\t\t\t\t}\n\t\t\t\t#[ inline ]\n\t\t\t\tfn update_eight_x (iter: impl RowIter, steps: \u0026 [(usize, Step)], mode_fn: ModeFn) -\u003e impl RowIter {\n\t\t\t\t\tupdate_four_x (update_four_x (iter, \u0026 steps [0 .. 4], mode_fn), \u0026 steps [4 .. 8], mode_fn)\n\t\t\t\t}\n\t\t\t\twhile steps.len () \u003e= 8 {\n\t\t\t\t\tmem::swap (\u0026 mut row_data, \u0026 mut row_data_temp);\n\t\t\t\t\tassert! (row_data.is_empty ());\n\t\t\t\t\trow_data.extend (\n\t\t\t\t\t\tupdate_eight_x (\n\t\t\t\t\t\t\trow_data_temp.drain ( .. ),\n\t\t\t\t\t\t\t\u0026 steps [0 .. 8 ],\n\t\t\t\t\t\t\tmode_fn));\n\t\t\t\t\tsteps = \u0026 steps [ 8 .. ];\n\t\t\t\t}\n\t\t\t\twhile ! steps.is_empty () {\n\t\t\t\t\tmem::swap (\u0026 mut row_data, \u0026 mut row_data_temp);\n\t\t\t\t\tassert! (row_data.is_empty ());\n\t\t\t\t\trow_data.extend (\n\t\t\t\t\t\tupdate_once (\n\t\t\t\t\t\t\trow_data_temp.drain ( .. ),\n\t\t\t\t\t\t\tsteps [0].1,\n\t\t\t\t\t\t\tmode_fn));\n\t\t\t\t\tsteps = \u0026 steps [ 1 .. ];\n\t\t\t\t}\n\t\t\t}\n\t\t\t/* old implementation:\n\t\t\tmem::swap (\u0026 mut row_data, \u0026 mut row_data_temp);\n\t\t\tassert! (row_data.is_empty ());\n\t\t\tlet mut iter: Box \u003cdyn RowIter\u003e = Box::new (row_data.drain ( .. ));\n\t\t\tfor step in steps.iter ().copied () {\n\t\t\t\titer = Box::new (UpdateLineIter::new (iter, step.action, step.origin.col, step.peak.col));\n\t\t\t}\n\t\t\trow_data = iter.collect ();\n\t\t\t*/\n\t\t\tprev_row = row;\n\t\t\tprev_active =\n\t\t\t\trow_data.iter ().copied ()\n\t\t\t\t\t.tuple_windows::\u003c(_, _)\u003e ()\n\t\t\t\t\t.map (|((start, val), (end, _))|\n\t\t\t\t\t\tInt::mul_2 (\n\t\t\t\t\t\t\tInt::sub_2 (end, start) ?.as_u32 (),\n\t\t\t\t\t\t\tval.as_u32 (),\n\t\t\t\t\t\t))\n\t\t\t\t\t.fold (Ok (0), |sum, val| Int::add_2 (sum ?, val ?)) ?;\n\t\t\tassert! (row_data.last ().copied ().map_or (0, |(_, val)| val) == 0);\n\t\t}\n\t\tOk (sum)\n\t}\n\n\tstruct UpdateLineIter \u003cInner: Iterator\u003e {\n\t\tinner: Inner,\n\t\tnext: Option \u003cInner::Item\u003e,\n\t\taction: Action,\n\t\tstep: ArrayVec \u003cCoord, 2\u003e,\n\t\told_active: u8,\n\t\tcur_active: u8,\n\t\tin_step: bool,\n\t\tmode_fn: ModeFn,\n\t}\n\n\timpl \u003cInner\u003e UpdateLineIter \u003cInner\u003e\n\t\t\twhere Inner: Iterator \u003cItem = (Coord, u8)\u003e {\n\t\t#[ inline ]\n\t\tfn new (inner: Inner, action: Action, start: Coord, end: Coord, mode_fn: ModeFn) -\u003e Self {\n\t\t\tSelf {\n\t\t\t\tinner,\n\t\t\t\tnext: None,\n\t\t\t\taction,\n\t\t\t\tstep: [ end, start ].into_iter ().collect (),\n\t\t\t\told_active: 0,\n\t\t\t\tcur_active: 0,\n\t\t\t\tin_step: false,\n\t\t\t\tmode_fn,\n\t\t\t}\n\t\t}\n\t}\n\n\timpl \u003cInner\u003e Iterator for UpdateLineIter \u003cInner\u003e\n\t\twhere Inner: Iterator \u003cItem = (Coord, u8)\u003e {\n\t\ttype Item = (Coord, u8);\n\t\tfn next (\u0026 mut self) -\u003e Option \u003c(Coord, u8)\u003e {\n\t\t\tloop {\n\t\t\t\tif self.next.is_none () { self.next = self.inner.next (); }\n\t\t\t\tlet (pos, old_val, step) = match (self.next, self.step.last ().copied ()) {\n\t\t\t\t\t(Some ((pos, val)), None) =\u003e (pos, Some (val), false),\n\t\t\t\t\t(Some ((pos_0, val)), Some (pos_1)) if pos_0 \u003c pos_1 =\u003e (pos_0, Some (val), false),\n\t\t\t\t\t(Some ((pos_0, _)), Some (pos_1)) if pos_1 \u003c pos_0 =\u003e (pos_1, None, true),\n\t\t\t\t\t(Some ((pos_0, val)), Some (pos_1)) if pos_0 == pos_1 =\u003e (pos_0, Some (val), true),\n\t\t\t\t\t(None, Some (pos)) =\u003e (pos, None, true),\n\t\t\t\t\t(None, None) =\u003e return None,\n\t\t\t\t\t_ =\u003e unreachable! (),\n\t\t\t\t};\n\t\t\t\tif let Some (val) = old_val { self.old_active = val; self.next = None; }\n\t\t\t\tif step { self.in_step = ! self.in_step; self.step.pop ().unwrap (); }\n\t\t\t\tlet want_active = if self.in_step {\n\t\t\t\t\t(self.mode_fn) (self.action, self.old_active)\n\t\t\t\t} else { self.old_active };\n\t\t\t\tif self.cur_active != want_active {\n\t\t\t\t\tself.cur_active = want_active;\n\t\t\t\t\treturn Some ((pos, want_active));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t#[ cfg (test) ]\n\tmod tests {\n\n\t\tuse super::*;\n\t\tuse model::Action::*;\n\t\tuse model::Pos;\n\n\t\tconst STEPS: \u0026 [Step] = \u0026 [\n\t\t\tStep { action: Toggle, origin: Pos { row: 0, col: 0 }, peak: Pos { row: 2, col: 9 }},\n\t\t\tStep { action: Off, origin: Pos { row: 4, col: 3 }, peak: Pos { row: 5, col: 8 }},\n\t\t\tStep { action: On, origin: Pos { row: 2, col: 2 }, peak: Pos { row: 9, col: 3 }},\n\t\t\tStep { action: Toggle, origin: Pos { row: 2, col: 4 }, peak: Pos { row: 9, col: 5 }},\n\t\t\tStep { action: Toggle, origin: Pos { row: 3, col: 3 }, peak: Pos { row: 8, col: 6 }},\n\t\t\tStep { action: Toggle, origin: Pos { row: 6, col: 3 }, peak: Pos { row: 9, col: 8 }},\n\t\t\tStep { action: Off, origin: Pos { row: 1, col: 0 }, peak: Pos { row: 1, col: 3 }},\n\t\t\tStep { action: Off, origin: Pos { row: 2, col: 2 }, peak: Pos { row: 5, col: 5 }},\n\t\t\tStep { action: Toggle, origin: Pos { row: 5, col: 5 }, peak: Pos { row: 9, col: 8 }},\n\t\t\tStep { action: Off, origin: Pos { row: 3, col: 4 }, peak: Pos { row: 7, col: 8 }},\n\t\t\tStep { action: On, origin: Pos { row: 4, col: 0 }, peak: Pos { row: 8, col: 8 }},\n\t\t\tStep { action: Off, origin: Pos { row: 1, col: 1 }, peak: Pos { row: 3, col: 5 }},\n\t\t\tStep { action: On, origin: Pos { row: 2, col: 4 }, peak: Pos { row: 6, col: 8 }},\n\t\t\tStep { action: On, origin: Pos { row: 1, col: 4 }, peak: Pos { row: 7, col: 8 }},\n\t\t\tStep { action: On, origin: Pos { row: 0, col: 3 }, peak: Pos { row: 6, col: 6 }},\n\t\t];\n\n\t\t#[ test ]\n\t\tfn calc_result () {\n\t\t\tassert_eq_ok! (59, logic::calc_result (STEPS, mode_fn_one));\n\t\t\tassert_eq_ok! (203, logic::calc_result (STEPS, mode_fn_two));\n\t\t}\n\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse pos::PosRowCol;\n\tuse parser::*;\n\n\tpub type Coord = u16;\n\tpub type Pos = PosRowCol \u003cCoord\u003e;\n\tpub type Input = Vec \u003cStep\u003e;\n\n\t#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\n\tpub struct Step {\n\t\tpub action: Action,\n\t\tpub origin: Pos,\n\t\tpub peak: Pos,\n\t}\n\n\timpl Step {\n\n\t\tpub fn parse (input: \u0026 str) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tParser::wrap (input, Self::parse_real)\n\t\t\t\t.map_parse_err (|col_idx|\n\t\t\t\t\tformat! (\"Invalid input: col {}: {}\", col_idx + 1, input)\n\t\t\t\t)\n\t\t}\n\n\t\tfn parse_real (parser: \u0026 mut Parser) -\u003e ParseResult \u003cSelf\u003e {\n\t\t\tparser.set_ignore_whitespace (true);\n\t\t\tlet action = match parser.word () ? {\n\t\t\t\t\"turn\" =\u003e match parser.word () ? {\n\t\t\t\t\t\"on\" =\u003e Action::On,\n\t\t\t\t\t\"off\" =\u003e Action::Off,\n\t\t\t\t\t_ =\u003e return Err (parser.err ()),\n\t\t\t\t},\n\t\t\t\t\"toggle\" =\u003e Action::Toggle,\n\t\t\t\t_ =\u003e return Err (parser.err ()),\n\t\t\t};\n\t\t\tlet origin = Pos {\n\t\t\t\trow: parser.int () ?,\n\t\t\t\tcol: parser.expect (\",\") ?.int () ?,\n\t\t\t};\n\t\t\tlet peak = Pos {\n\t\t\t\trow: parser.expect (\"through\") ?.int::\u003cCoord\u003e () ? + 1,\n\t\t\t\tcol: parser.expect (\",\") ?.int::\u003cCoord\u003e () ? + 1,\n\t\t\t};\n\t\t\tOk (Self { action, origin, peak })\n\t\t}\n\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\n\tpub enum Action { On, Off, Toggle }\n\n\tpub fn parse_input (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cInput\u003e {\n\t\tinput.iter ().enumerate ()\n\t\t    .map (|(line_idx, line)|\n    \t\t\tParser::wrap (line, Step::parse_real)\n\t    \t\t\t.map_parse_err (|char_idx|\n\t\t    \t\t    format! (\"Invalid input: line {}: col {}: {}\",\n\t\t\t    \t\t    line_idx + 1, char_idx + 1, line)))\n\t\t    .collect::\u003cGenResult \u003c_\u003e\u003e ()\n\t}\n\n\t#[ cfg (test) ]\n\tmod tests {\n\n\t\tuse super::*;\n\n\t\tconst STEPS: \u0026 [Step] = \u0026 [\n\t\t\tStep {\n\t\t\t\taction: Action::On,\n\t\t\t\torigin: Pos { row: 1, col: 2 },\n\t\t\t\tpeak: Pos { row: 3, col: 4 },\n\t\t\t},\n\t\t\tStep {\n\t\t\t\taction: Action::Off,\n\t\t\t\torigin: Pos { row: 0, col: 200 },\n\t\t\t\tpeak: Pos { row: 100, col: 500 },\n\t\t\t},\n\t\t\tStep {\n\t\t\t\taction: Action::Toggle,\n\t\t\t\torigin: Pos { row: 10, col: 1 },\n\t\t\t\tpeak: Pos { row: 90, col: 79 },\n\t\t\t},\n\t\t];\n\n\t\tconst STEP_TEXTS: \u0026 [\u0026 str] = \u0026 [\n\t\t\t\"turn on 1,2 through 2,3\",\n\t\t\t\"turn off 0,200 through 99,499\",\n\t\t\t\"toggle 10,1 through 89,78\",\n\t\t];\n\n\t\t#[ test ]\n\t\tfn step_parse () {\n\t\t\tassert_eq_ok! (STEPS [0], Step::parse (STEP_TEXTS [0]));\n\t\t\tassert_eq_ok! (STEPS [1], Step::parse (STEP_TEXTS [1]));\n\t\t\tassert_eq_ok! (STEPS [2], Step::parse (STEP_TEXTS [2]));\n\t\t\tassert_err! (\"Invalid input: col 4: go on 1,2 through 2,3\",\n\t\t\t\tStep::parse (\"go on 1,2 through 2,3\"));\n\t\t\tassert_err! (\"Invalid input: col 10: turn red 1,2 through 2,3\",\n\t\t\t\tStep::parse (\"turn red 1,2 through 2,3\"));\n\t\t\tassert_err! (\"Invalid input: col 9: turn on 1:2 through 2,3\",\n\t\t\t\tStep::parse (\"turn on 1:2 through 2,3\"));\n\t\t}\n\n\t\t#[ test ]\n\t\tfn parse_input () {\n\t\t\tassert_eq_ok! (STEPS, model::parse_input (STEP_TEXTS));\n\t\t\tassert_err! (\"Invalid input: line 2: col 9: turn on 1:2 through 2,3\",\n\t\t\t\tmodel::parse_input (\u0026 [STEP_TEXTS [0], \"turn on 1:2 through 2,3\" ]));\n\t\t}\n\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE_0: \u0026 [\u0026 str] = \u0026 [\n\t\t\"turn on 0,0 through 999,999\",\n\t\t\"toggle 0,0 through 999,0\",\n\t\t\"turn off 499,499 through 500,500\",\n\t];\n\n\tconst EXAMPLE_1: \u0026 [\u0026 str] = \u0026 [\n\t\t\"turn on 0,0 through 0,0\",\n\t\t\"toggle 0,0 through 999,999\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"998996\", puzzle.part_one (EXAMPLE_0));\n\t\tassert_eq_ok! (\"999999\", puzzle.part_one (EXAMPLE_1));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"1001996\", puzzle.part_two (EXAMPLE_0));\n\t\tassert_eq_ok! (\"2000001\", puzzle.part_two (EXAMPLE_1));\n\t}\n\n}\n","traces":[{"line":14,"address":[208515,209203],"length":1,"stats":{"Line":2},"fn_name":null},{"line":15,"address":[208621],"length":1,"stats":{"Line":1},"fn_name":null},{"line":16,"address":[209309],"length":1,"stats":{"Line":1},"fn_name":null},{"line":31,"address":[86944],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":32,"address":[86976],"length":1,"stats":{"Line":1},"fn_name":null},{"line":35,"address":[87040],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":36,"address":[87072],"length":1,"stats":{"Line":1},"fn_name":null},{"line":39,"address":[87136],"length":1,"stats":{"Line":1},"fn_name":"mode_fn_one"},{"line":40,"address":[87158],"length":1,"stats":{"Line":1},"fn_name":null},{"line":41,"address":[87192],"length":1,"stats":{"Line":1},"fn_name":null},{"line":42,"address":[87199],"length":1,"stats":{"Line":1},"fn_name":null},{"line":43,"address":[87210],"length":1,"stats":{"Line":1},"fn_name":null},{"line":47,"address":[87248],"length":1,"stats":{"Line":1},"fn_name":"mode_fn_two"},{"line":48,"address":[87270],"length":1,"stats":{"Line":1},"fn_name":null},{"line":49,"address":[87308,87447],"length":1,"stats":{"Line":2},"fn_name":null},{"line":50,"address":[87362],"length":1,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[87372],"length":1,"stats":{"Line":1},"fn_name":null},{"line":55,"address":[87488,89703,91087],"length":1,"stats":{"Line":1},"fn_name":"calc_result"},{"line":56,"address":[87613],"length":1,"stats":{"Line":1},"fn_name":null},{"line":59,"address":[34238,34224],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":61,"address":[87758,87838],"length":1,"stats":{"Line":2},"fn_name":null},{"line":63,"address":[34272,34281],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":67,"address":[88016],"length":1,"stats":{"Line":1},"fn_name":null},{"line":68,"address":[88064],"length":1,"stats":{"Line":1},"fn_name":null},{"line":69,"address":[88075],"length":1,"stats":{"Line":1},"fn_name":null},{"line":70,"address":[88085],"length":1,"stats":{"Line":1},"fn_name":null},{"line":71,"address":[88215,88096],"length":1,"stats":{"Line":2},"fn_name":null},{"line":72,"address":[88230],"length":1,"stats":{"Line":1},"fn_name":null},{"line":73,"address":[88282],"length":1,"stats":{"Line":1},"fn_name":null},{"line":74,"address":[88426,88326,90622],"length":1,"stats":{"Line":2},"fn_name":null},{"line":75,"address":[88646,88889],"length":1,"stats":{"Line":2},"fn_name":null},{"line":76,"address":[88815],"length":1,"stats":{"Line":1},"fn_name":null},{"line":77,"address":[88660],"length":1,"stats":{"Line":1},"fn_name":null},{"line":78,"address":[88776],"length":1,"stats":{"Line":1},"fn_name":null},{"line":81,"address":[34336,34350],"length":1,"stats":{"Line":3},"fn_name":"{closure#2}"},{"line":82,"address":[89012],"length":1,"stats":{"Line":1},"fn_name":null},{"line":83,"address":[89101],"length":1,"stats":{"Line":1},"fn_name":null},{"line":84,"address":[90906,89166],"length":1,"stats":{"Line":2},"fn_name":null},{"line":86,"address":[34413,34400],"length":1,"stats":{"Line":4},"fn_name":"{closure#3}"},{"line":87,"address":[89207],"length":1,"stats":{"Line":1},"fn_name":null},{"line":89,"address":[89222],"length":1,"stats":{"Line":1},"fn_name":null},{"line":93,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":101,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":102,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":108,"address":[89812,89277],"length":1,"stats":{"Line":2},"fn_name":null},{"line":109,"address":[89371],"length":1,"stats":{"Line":1},"fn_name":null},{"line":110,"address":[89386,89436],"length":1,"stats":{"Line":1},"fn_name":null},{"line":111,"address":[89678],"length":1,"stats":{"Line":1},"fn_name":null},{"line":112,"address":[89623],"length":1,"stats":{"Line":1},"fn_name":null},{"line":113,"address":[89468,89429],"length":1,"stats":{"Line":2},"fn_name":null},{"line":114,"address":[89476],"length":1,"stats":{"Line":1},"fn_name":null},{"line":115,"address":[89693,89654,89562],"length":1,"stats":{"Line":1},"fn_name":null},{"line":116,"address":[89714],"length":1,"stats":{"Line":1},"fn_name":null},{"line":118,"address":[90304,89322,89824],"length":1,"stats":{"Line":3},"fn_name":null},{"line":119,"address":[89896],"length":1,"stats":{"Line":1},"fn_name":null},{"line":120,"address":[89911,89955],"length":1,"stats":{"Line":1},"fn_name":null},{"line":121,"address":[90193],"length":1,"stats":{"Line":1},"fn_name":null},{"line":122,"address":[90063],"length":1,"stats":{"Line":1},"fn_name":null},{"line":123,"address":[89948,89988],"length":1,"stats":{"Line":2},"fn_name":null},{"line":124,"address":[89996,90107],"length":1,"stats":{"Line":1},"fn_name":null},{"line":125,"address":[90208,90132],"length":1,"stats":{"Line":0},"fn_name":null},{"line":126,"address":[90218],"length":1,"stats":{"Line":1},"fn_name":null},{"line":138,"address":[89830],"length":1,"stats":{"Line":1},"fn_name":null},{"line":139,"address":[90557],"length":1,"stats":{"Line":1},"fn_name":null},{"line":140,"address":[90439,89854,90325,90600],"length":1,"stats":{"Line":3},"fn_name":null},{"line":142,"address":[38928,39105,38952],"length":1,"stats":{"Line":3},"fn_name":"{closure#4}"},{"line":143,"address":[39141],"length":1,"stats":{"Line":1},"fn_name":null},{"line":144,"address":[38984],"length":1,"stats":{"Line":1},"fn_name":null},{"line":145,"address":[39122],"length":1,"stats":{"Line":1},"fn_name":null},{"line":147,"address":[39168,39224],"length":1,"stats":{"Line":3},"fn_name":"{closure#5}"},{"line":148,"address":[53232,53251],"length":1,"stats":{"Line":4},"fn_name":"{closure#6}"},{"line":150,"address":[90972],"length":1,"stats":{"Line":1},"fn_name":null},{"line":167,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":172,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":184,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":185,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":186,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":187,"address":[],"length":0,"stats":{"Line":32},"fn_name":null},{"line":188,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":189,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":190,"address":[],"length":0,"stats":{"Line":13},"fn_name":null},{"line":191,"address":[],"length":0,"stats":{"Line":14},"fn_name":null},{"line":192,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":193,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":196,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":197,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":198,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":199,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":200,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":201,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":202,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":203,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":235,"address":[116513,115568],"length":1,"stats":{"Line":3},"fn_name":"calc_result"},{"line":236,"address":[116009,115691,115575],"length":1,"stats":{"Line":2},"fn_name":null},{"line":237,"address":[116128,116056,115963,116448],"length":1,"stats":{"Line":3},"fn_name":null},{"line":263,"address":[123024],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":264,"address":[123047,123081],"length":1,"stats":{"Line":2},"fn_name":null},{"line":265,"address":[119168,119410],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":266,"address":[119206],"length":1,"stats":{"Line":1},"fn_name":null},{"line":270,"address":[123120],"length":1,"stats":{"Line":1},"fn_name":"parse_real"},{"line":271,"address":[123158],"length":1,"stats":{"Line":1},"fn_name":null},{"line":272,"address":[123173,123280],"length":1,"stats":{"Line":1},"fn_name":null},{"line":273,"address":[123252,123443,123396,123568],"length":1,"stats":{"Line":3},"fn_name":null},{"line":274,"address":[123732,123540,123693],"length":1,"stats":{"Line":3},"fn_name":null},{"line":275,"address":[123709,123743,123769],"length":1,"stats":{"Line":3},"fn_name":null},{"line":276,"address":[123801,123754],"length":1,"stats":{"Line":2},"fn_name":null},{"line":278,"address":[123851,123880,123412],"length":1,"stats":{"Line":3},"fn_name":null},{"line":279,"address":[125593,123862],"length":1,"stats":{"Line":2},"fn_name":null},{"line":282,"address":[123887,123781,123985],"length":1,"stats":{"Line":2},"fn_name":null},{"line":283,"address":[124420,124106,124303,123953],"length":1,"stats":{"Line":3},"fn_name":null},{"line":286,"address":[124987,124385,124554,124751],"length":1,"stats":{"Line":3},"fn_name":null},{"line":287,"address":[125558,125017,125214,124960],"length":1,"stats":{"Line":3},"fn_name":null},{"line":289,"address":[125447],"length":1,"stats":{"Line":1},"fn_name":null},{"line":297,"address":[125648],"length":1,"stats":{"Line":1},"fn_name":"parse_input"},{"line":298,"address":[125698],"length":1,"stats":{"Line":1},"fn_name":null},{"line":299,"address":[119533,119424,119452],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":300,"address":[119462,119508],"length":1,"stats":{"Line":2},"fn_name":null},{"line":301,"address":[119552,119933,119488],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":302,"address":[119781,119630,119720],"length":1,"stats":{"Line":3},"fn_name":null},{"line":303,"address":[119656,119595,119746],"length":1,"stats":{"Line":1},"fn_name":null},{"line":337,"address":[62128,62133],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":338,"address":[64392,64263,64769],"length":1,"stats":{"Line":2},"fn_name":null},{"line":339,"address":[65276,64816,64894,64723],"length":1,"stats":{"Line":3},"fn_name":null},{"line":340,"address":[65780,65230,65401,65323],"length":1,"stats":{"Line":3},"fn_name":null},{"line":341,"address":[65827,66177],"length":1,"stats":{"Line":2},"fn_name":null},{"line":342,"address":[65737],"length":1,"stats":{"Line":1},"fn_name":null},{"line":343,"address":[66223],"length":1,"stats":{"Line":1},"fn_name":null},{"line":344,"address":[66196],"length":1,"stats":{"Line":1},"fn_name":null},{"line":345,"address":[66608],"length":1,"stats":{"Line":1},"fn_name":null},{"line":346,"address":[66581],"length":1,"stats":{"Line":1},"fn_name":null},{"line":350,"address":[62165,62160],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":351,"address":[67079,67180],"length":1,"stats":{"Line":2},"fn_name":null},{"line":352,"address":[67661],"length":1,"stats":{"Line":1},"fn_name":null},{"line":353,"address":[67576],"length":1,"stats":{"Line":1},"fn_name":null},{"line":377,"address":[94240,94245],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":378,"address":[142967],"length":1,"stats":{"Line":1},"fn_name":null},{"line":379,"address":[142998,143072,143138],"length":1,"stats":{"Line":3},"fn_name":null},{"line":380,"address":[143551,143663],"length":1,"stats":{"Line":2},"fn_name":null},{"line":384,"address":[94272,94277],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":385,"address":[144167],"length":1,"stats":{"Line":1},"fn_name":null},{"line":386,"address":[144338,144198,144272],"length":1,"stats":{"Line":3},"fn_name":null},{"line":387,"address":[144863,144751],"length":1,"stats":{"Line":2},"fn_name":null}],"covered":145,"coverable":147},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-07","src","lib.rs"],"content":"//! Advent of Code 2015: Day 7: Some Assembly Required\n//!\n//! [https://adventofcode.com/2015/day/7](https://adventofcode.com/2015/day/7)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Some Assembly Required\";\n\tyear = 2015;\n\tday = 7;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\tuse model::WireId;\n\tuse model::WireInput;\n\tuse model::WireVal;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cu16\u003e {\n\t\tlet resolved = resolve (input, default ());\n\t\tlet a_id: WireId = \"a\".try_into ().unwrap ();\n\t\tlet a_val = resolved.get (\u0026 a_id).copied ().ok_or (\"No value found for a\") ?;\n\t\tOk (a_val)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cu16\u003e {\n\t\tlet resolved = resolve (input, default ());\n\t\tlet a_id: WireId = \"a\".try_into ().unwrap ();\n\t\tlet a_val = resolved.get (\u0026 a_id).copied ().ok_or (\"No value found for a\") ?;\n\t\tlet b_id: WireId = \"b\".try_into ().unwrap ();\n\t\tlet resolved = resolve (input, HashMap::from_iter ([ (b_id, a_val) ]));\n\t\tlet a_val = resolved.get (\u0026 a_id).copied ().ok_or (\"No value found for a\") ?;\n\t\tOk (a_val)\n\t}\n\n\tfn resolve (\n\t\tinput: \u0026 Input,\n\t\tmut resolved: HashMap \u003cWireId, WireVal\u003e,\n\t) -\u003e HashMap \u003cWireId, WireVal\u003e {\n\n\t\t// setup data about each wire and their inter-dependencies\n\n\t\t#[ derive (Debug) ]\n\t\tstruct Wire {\n\t\t\tid: WireId,\n\t\t\tinput: WireInput,\n\t\t\tinputs: ArrayVec \u003cWireId, 2\u003e,\n\t\t\toutputs: Vec \u003cWireId\u003e,\n\t\t}\n\n\t\tlet mut wires: HashMap \u003cWireId, Wire\u003e =\n\t\t\tinput.iter ()\n\t\t\t\t.map (|wire| (wire.id.clone (), Wire {\n\t\t\t\t\tid: wire.id.clone (),\n\t\t\t\t\tinput: wire.input.clone (),\n\t\t\t\t\tinputs: wire.input.inputs ().iter ().copied ().cloned ().collect (),\n\t\t\t\t\toutputs: default (),\n\t\t\t\t}))\n\t\t\t\t.collect ();\n\n\t\t// work out which wires we can handle now and later\n\n\t\tlet mut queue = VecDeque::new ();\n\n\t\tfor wire in input.iter () {\n\n\t\t\tfor inpt_id in wire.input.inputs () {\n\t\t\t\tlet inpt_wire = wires.get_mut (inpt_id).unwrap ();\n\t\t\t\tinpt_wire.outputs.push (wire.id.clone ());\n\t\t\t}\n\n\t\t\tif wire.input.inputs ().is_empty () {\n\t\t\t\tqueue.push_back (wire.id.clone ());\n\t\t\t}\n\n\t\t}\n\n\t\t// iterate the ready wires\n\n\t\twhile let Some (id) = queue.pop_front () {\n\t\t\tlet wire = wires.get_mut (\u0026 id).unwrap ();\n\t\t\tlet val = if let Some (\u0026 val) = resolved.get (\u0026 wire.id) {\n\t\t\t    val\n\t\t\t} else {\n\t\t\t\tmatch wire.input.clone () {\n\t\t\t\t\tWireInput::Static (val) =\u003e Some (val),\n\t\t\t\t\tWireInput::Wire (arg) =\u003e resolved.get (\u0026 arg).copied (),\n\t\t\t\t\tWireInput::Not (arg) =\u003e resolved.get (\u0026 arg).copied ().map (|arg| ! arg),\n\t\t\t\t\tWireInput::And (arg_0, arg_1) =\u003e\n\t\t\t\t\t\tresolved.get (\u0026 arg_0)\n\t\t\t\t\t\t\t.and_then (|\u0026 arg_0| resolved.get (\u0026 arg_1)\n\t\t\t\t\t\t\t\t.map (|\u0026 arg_1| arg_0 \u0026 arg_1)),\n\t\t\t\t\tWireInput::AndOne (arg) =\u003e resolved.get (\u0026 arg).map (|\u0026 arg| 1 \u0026 arg),\n\t\t\t\t\tWireInput::Or (arg_0, arg_1) =\u003e\n\t\t\t\t\t\tresolved.get (\u0026 arg_0)\n\t\t\t\t\t\t\t.and_then (|\u0026 arg_0| resolved.get (\u0026 arg_1)\n\t\t\t\t\t\t\t\t.map (|\u0026 arg_1| arg_0 | arg_1)),\n\t\t\t\t\tWireInput::LeftShift (arg_0, arg_1) =\u003e\n\t\t\t\t\t\tresolved.get (\u0026 arg_0).map (|\u0026 arg_0| arg_0 \u003c\u003c arg_1),\n\t\t\t\t\tWireInput::RightShift (arg_0, arg_1) =\u003e\n\t\t\t\t\t\tresolved.get (\u0026 arg_0).map (|\u0026 arg_0| arg_0 \u003e\u003e arg_1),\n\t\t\t\t}.unwrap ()\n\t\t\t};\n\t\t\tresolved.insert (wire.id.clone (), val);\n\t\t\tlet wire_id = wire.id.clone ();\n\t\t\tlet wire_outputs = mem::take (\u0026 mut wire.outputs);\n\t\t\tfor outp in wire_outputs {\n\t\t\t\tlet other = wires.get_mut (\u0026 outp).unwrap ();\n\t\t\t\tother.inputs.retain (|other_id| * other_id != wire_id);\n\t\t\t\tif ! other.inputs.is_empty () { continue }\n\t\t\t\tqueue.push_back (other.id.clone ());\n\t\t\t}\n\t\t}\n\n\t\tresolved\n\n\t}\n\n\t#[ cfg (test) ]\n\tmod tests {\n\n\t\tuse super::*;\n\n\t\t#[ test ]\n\t\tfn test_resolve () -\u003e GenResult \u003c()\u003e {\n\t\t\tlet wires = Input::parse (\u0026 [\n\t\t\t\t\"123 -\u003e x\",\n\t\t\t\t\"456 -\u003e y\",\n\t\t\t\t\"x AND y -\u003e d\",\n\t\t\t\t\"x OR y -\u003e e\",\n\t\t\t\t\"x LSHIFT 2 -\u003e f\",\n\t\t\t\t\"y RSHIFT 2 -\u003e g\",\n\t\t\t\t\"NOT x -\u003e h\",\n\t\t\t\t\"NOT y -\u003e i\",\n\t\t\t]) ?;\n\t\t\tlet resolved = resolve (\u0026 wires, default ());\n\t\t\tassert_eq! (resolved.len (), 8);\n\t\t\tlet resolve = |id_str: \u0026 str| resolved [\u0026 id_str.try_into ().unwrap ()];\n\t\t\tassert_eq! (resolve (\"d\"), 72);\n\t\t\tassert_eq! (resolve (\"e\"), 507);\n\t\t\tassert_eq! (resolve (\"f\"), 492);\n\t\t\tassert_eq! (resolve (\"g\"), 114);\n\t\t\tassert_eq! (resolve (\"h\"), 65412);\n\t\t\tassert_eq! (resolve (\"i\"), 65079);\n\t\t\tassert_eq! (resolve (\"x\"), 123);\n\t\t\tassert_eq! (resolve (\"y\"), 456);\n\t\t\tOk (())\n\t\t}\n\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse nums::IntConv;\n\tuse parser::*;\n\n\tpub type WireVal = u16;\n\n\t#[ derive (Clone) ]\n\tpub struct Input (Vec \u003cWire\u003e);\n\n\timpl Deref for Input {\n\t\ttype Target = [Wire];\n\t\tfn deref (\u0026 self) -\u003e \u0026 [Wire] { \u0026 self.0 }\n\t}\n\n\timpl Input {\n\t\tpub fn new (input: Vec \u003cWire\u003e) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet all_wire_ids =\n\t\t\t\tinput.iter ()\n\t\t\t\t\t.map (|wire| wire.id.clone ())\n\t\t\t\t\t.collect::\u003cHashSet \u003c_\u003e\u003e ();\n\t\t\tif all_wire_ids.len () \u003c input.len () {\n\t\t\t\tErr (\"Duplicate wire ids\") ?;\n\t\t\t}\n\t\t\tif let Some ((wire, input)) =\n\t\t\t\tinput.iter ()\n\t\t\t\t\t.flat_map (|wire| {\n\t\t\t\t\t\tlet wire_id = wire.id.clone ();\n\t\t\t\t\t\twire.input.inputs ().clone ().iter ()\n\t\t\t\t\t\t\t.map (move |\u0026 input| (wire_id.clone (), input.clone ()))\n\t\t\t\t\t\t\t.collect::\u003cArrayVec \u003c_, 2\u003e\u003e ()\n\t\t\t\t\t})\n\t\t\t\t\t.find (|\u0026 (_, ref input)| ! all_wire_ids.contains (input)) {\n\t\t\t\tErr (format! (\"Wire {} refers to non-existant input {}\", wire, input)) ?;\n\t\t\t}\n\t\t\tif let Some ((wire, msg)) =\n\t\t\t\tinput.iter ()\n\t\t\t\t\t.find_map (|wire| match wire.input {\n\t\t\t\t\t\tWireInput::LeftShift (_, val) if WireVal::BITS \u003c= val.as_u32 () =\u003e\n\t\t\t\t\t\t\tSome ((wire.id.clone (), format! (\"Left shift by {} is invalid\", val))),\n\t\t\t\t\t\tWireInput::RightShift (_, val) if WireVal::BITS \u003c= val.as_u32 () =\u003e\n\t\t\t\t\t\t\tSome ((wire.id.clone (), format! (\"Right shift by {} is invalid\", val))),\n\t\t\t\t\t\tWireInput::Static (_) | WireInput::Wire (_) | WireInput::Not (_) |\n\t\t\t\t\t\tWireInput::And (..) | WireInput::AndOne (_) | WireInput::Or (..) |\n\t\t\t\t\t\tWireInput::LeftShift (..) | WireInput::RightShift (..) =\u003e None,\n\t\t\t\t\t}) {\n\t\t\t\tErr (format! (\"Wire {} has invalid input: {}\", wire, msg)) ?;\n\t\t\t}\n\t\t\tOk (Self (input))\n\t\t}\n\t\tpub fn parse (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tSelf::new (input.iter ()\n\t\t\t\t.enumerate ()\n\t\t\t\t.map (|(line_idx, line)|\n\t\t\t\t\tParser::wrap (line, Wire::parse_real)\n\t\t\t\t\t\t.map_parse_err (|col_idx|\n\t\t\t\t\t\t\tformat! (\"Invalid input: line {}: col {}: {}\",\n\t\t\t\t\t\t\t\tline_idx + 1, col_idx + 1, line)))\n\t\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e () ?)\n\t}\n\t}\n\n\t#[ derive (Clone, Eq, Hash, PartialEq) ]\n\tpub struct WireId (Rc \u003cstr\u003e);\n\n\timpl Wire {\n\t\tpub fn parse (input: \u0026 str) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tParser::wrap (input, Self::parse_real)\n\t\t\t\t.map_parse_err (|col_idx| format! (\"Invalid input: col {}\", col_idx + 1))\n\t\t}\n\t\tfn parse_real (parser: \u0026 mut Parser) -\u003e ParseResult \u003cSelf\u003e {\n\t\t\tparser.set_ignore_whitespace (true);\n\t\t\tlet valid_id = |word: \u0026 str| word.chars ().all (char::is_lowercase);\n\t\t\tparser.any ()\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tlet val = parser.int () ?;\n\t\t\t\t\tlet id = parser.expect_word (\"-\u003e\") ?.confirm ().word_if (valid_id) ?;\n\t\t\t\t\tparser.end () ?;\n\t\t\t\t\tOk ((id.try_into () ?, WireInput::Static (val)))\n\t\t\t\t})\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tlet arg = parser.word_if (valid_id) ?;\n\t\t\t\t\tlet id = parser.expect_word (\"-\u003e\") ?.confirm ().word_if (valid_id) ?;\n\t\t\t\t\tparser.end () ?;\n\t\t\t\t\tOk ((id.try_into () ?, WireInput::Wire (arg.try_into () ?)))\n\t\t\t\t})\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tlet arg_0 = parser.expect_word (\"NOT\") ?.confirm ().word_if (valid_id) ?;\n\t\t\t\t\tlet id = parser.expect_word (\"-\u003e\") ?.word_if (valid_id) ?;\n\t\t\t\t\tparser.end () ?;\n\t\t\t\t\tOk ((id.try_into () ?, WireInput::Not (arg_0.try_into () ?)))\n\t\t\t\t})\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tlet arg_0 = parser.word_if (valid_id) ?;\n\t\t\t\t\tlet arg_1 = parser.expect_word (\"AND\") ?.confirm ().word_if (valid_id) ?;\n\t\t\t\t\tlet id = parser.expect_word (\"-\u003e\") ?.word_if (valid_id) ?;\n\t\t\t\t\tparser.end () ?;\n\t\t\t\t\tOk ((id.try_into () ?, WireInput::And (arg_0.try_into () ?, arg_1.try_into () ?)))\n\t\t\t\t})\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tlet arg_0 = parser.expect_word (\"1\") ?.expect_word (\"AND\") ?.confirm ().word_if (valid_id) ?;\n\t\t\t\t\tlet id = parser.expect_word (\"-\u003e\") ?.word_if (valid_id) ?;\n\t\t\t\t\tparser.end () ?;\n\t\t\t\t\tOk ((id.try_into () ?, WireInput::AndOne (arg_0.try_into () ?)))\n\t\t\t\t})\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tlet arg_0 = parser.word_if (valid_id) ?;\n\t\t\t\t\tlet arg_1 = parser.expect_word (\"OR\") ?.confirm ().word_if (valid_id) ?;\n\t\t\t\t\tlet id = parser.expect_word (\"-\u003e\") ?.word_if (valid_id) ?;\n\t\t\t\t\tparser.end () ?;\n\t\t\t\t\tOk ((id.try_into () ?, WireInput::Or (arg_0.try_into () ?, arg_1.try_into () ?)))\n\t\t\t\t})\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tlet arg_0 = parser.word_if (valid_id) ?;\n\t\t\t\t\tlet arg_1: u16 = parser.expect_word (\"LSHIFT\") ?.confirm ().int () ?;\n\t\t\t\t\tif WireVal::BITS \u003c= arg_1.as_u32 () { Err (parser.err ()) ?; }\n\t\t\t\t\tlet id = parser.expect_word (\"-\u003e\") ?.word_if (valid_id) ?;\n\t\t\t\t\tparser.end () ?;\n\t\t\t\t\tOk ((id.try_into () ?, WireInput::LeftShift (arg_0.try_into () ?, arg_1)))\n\t\t\t\t})\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tlet arg_0 = parser.word_if (valid_id) ?;\n\t\t\t\t\tlet arg_1: u16 = parser.expect_word (\"RSHIFT\") ?.confirm ().int () ?;\n\t\t\t\t\tif WireVal::BITS \u003c= arg_1.as_u32 () { Err (parser.err ()) ?; }\n\t\t\t\t\tlet id = parser.expect_word (\"-\u003e\") ?.word_if (valid_id) ?;\n\t\t\t\t\tparser.end () ?;\n\t\t\t\t\tOk ((id.try_into () ?, WireInput::RightShift (arg_0.try_into () ?, arg_1)))\n\t\t\t\t})\n\t\t\t\t.done ()\n\t\t\t\t.map (|(id, input)| Self { id, input })\n\t\t}\n\t}\n\n\timpl Deref for WireId {\n\t\ttype Target = str;\n\t\tfn deref (\u0026 self) -\u003e \u0026 str { self.0.as_ref () }\n\t}\n\n\timpl TryFrom \u003c\u0026 str\u003e for WireId {\n\t\ttype Error = GenError;\n\t\tfn try_from (src: \u0026 str) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tif ! src.chars ().all (char::is_lowercase) {\n\t\t\t\tErr (\"Wire ID must be lowercase\") ?;\n\t\t\t}\n\t\t\tOk (Self (src.to_owned ().into ()))\n\t\t}\n\t}\n\n\timpl Display for WireId {\n\t\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\t\tDisplay::fmt (\u0026 self.0, formatter)\n\t\t}\n\t}\n\n\timpl Debug for WireId {\n\t\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\t\twrite! (formatter, \"WireId ({:?})\", self.0) ?;\n\t\t\tOk (())\n\t\t}\n\t}\n\n\timpl PartialOrd for WireId {\n\t\tfn partial_cmp (\u0026 self, other: \u0026 Self) -\u003e Option \u003ccmp::Ordering\u003e {\n\t\t\tPartialOrd::partial_cmp (\u0026 self.0, \u0026 other.0)\n\t\t}\n\t}\n\n\timpl Ord for WireId {\n\t\tfn cmp (\u0026 self, other: \u0026 Self) -\u003e cmp::Ordering {\n\t\t\tOrd::cmp (\u0026 self.0, \u0026 other.0)\n\t\t}\n\t}\n\n\t#[ derive (Clone, Debug) ]\n\tpub struct Wire {\n\t\tpub id: WireId,\n\t\tpub input: WireInput,\n\t}\n\n\t#[ derive (Clone) ]\n\tpub enum WireInput {\n\t\tStatic (WireVal),\n\t\tWire (WireId),\n\t\tNot (WireId),\n\t\tAnd (WireId, WireId),\n\t\tAndOne (WireId),\n\t\tOr (WireId, WireId),\n\t\tLeftShift (WireId, WireVal),\n\t\tRightShift (WireId, WireVal),\n\t}\n\n\timpl Debug for WireInput {\n\t\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\t\tuse WireInput::{ And, AndOne, LeftShift, Not, Or, RightShift, Static, Wire };\n\t\t\tmatch * self {\n\t\t\t\tStatic (val) =\u003e write! (formatter, \"Static ({:?})\", val) ?,\n\t\t\t\tWire (ref arg) =\u003e write! (formatter, \"Wire ({:?})\", arg) ?,\n\t\t\t\tNot (ref arg) =\u003e write! (formatter, \"Not ({:?})\", arg) ?,\n\t\t\t\tAnd (ref arg_0, ref arg_1) =\u003e write! (formatter, \"And ({:?}, {:?})\", arg_0, arg_1) ?,\n\t\t\t\tAndOne (ref arg) =\u003e write! (formatter, \"AndOne ({:?})\", arg) ?,\n\t\t\t\tOr (ref arg_0, ref arg_1) =\u003e write! (formatter, \"Or ({:?}, {:?})\", arg_0, arg_1) ?,\n\t\t\t\tLeftShift (ref arg_0, arg_1) =\u003e write! (formatter, \"LeftShift ({:?}, {:?})\", arg_0, arg_1) ?,\n\t\t\t\tRightShift (ref arg_0, arg_1) =\u003e write! (formatter, \"RightShift ({:?}, {:?})\", arg_0, arg_1) ?,\n\t\t\t}\n\t\t\tOk (())\n\t\t}\n\t}\n\n\timpl WireInput {\n\n\t\t#[ inline ]\n\t\t#[ must_use ]\n\t\tpub fn inputs (\u0026 self) -\u003e ArrayVec \u003c\u0026 WireId, 2\u003e {\n\t\t\tmatch * self {\n\t\t\t\tSelf::Static (_) =\u003e array_vec! [],\n\t\t\t\tSelf::Wire (ref arg) =\u003e array_vec! [ arg ],\n\t\t\t\tSelf::Not (ref arg) =\u003e array_vec! [ arg ],\n\t\t\t\tSelf::And (ref arg_0, ref arg_1) =\u003e array_vec! [ arg_0, arg_1 ],\n\t\t\t\tSelf::AndOne (ref arg) =\u003e array_vec! [ arg ],\n\t\t\t\tSelf::Or (ref arg_0, ref arg_1) =\u003e array_vec! [ arg_0, arg_1 ],\n\t\t\t\tSelf::LeftShift (ref arg_0, _) =\u003e array_vec! [ arg_0 ],\n\t\t\t\tSelf::RightShift (ref arg_0, _) =\u003e array_vec! [ arg_0 ],\n\t\t\t}\n\t\t}\n\n\t}\n\n}\n","traces":[{"line":13,"address":[139411,140099],"length":1,"stats":{"Line":0},"fn_name":null},{"line":14,"address":[139517],"length":1,"stats":{"Line":0},"fn_name":null},{"line":15,"address":[140205],"length":1,"stats":{"Line":0},"fn_name":null},{"line":26,"address":[36906,36952,36432],"length":1,"stats":{"Line":0},"fn_name":"part_one"},{"line":27,"address":[36462],"length":1,"stats":{"Line":0},"fn_name":null},{"line":28,"address":[36556,36492],"length":1,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[36845,36684,36627],"length":1,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[36816],"length":1,"stats":{"Line":0},"fn_name":null},{"line":33,"address":[36976,37993,37932],"length":1,"stats":{"Line":0},"fn_name":"part_two"},{"line":34,"address":[37006],"length":1,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[37042,37106],"length":1,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[37234,37177,37398],"length":1,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[37366,37464],"length":1,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[37527],"length":1,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[37707,37868,37650],"length":1,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[37839],"length":1,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[38016,42239,39010],"length":1,"stats":{"Line":1},"fn_name":"resolve"},{"line":58,"address":[38090,38170],"length":1,"stats":{"Line":2},"fn_name":null},{"line":60,"address":[104256,104302,104569,105123,104784],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":61,"address":[104338,104411],"length":1,"stats":{"Line":2},"fn_name":null},{"line":62,"address":[104427],"length":1,"stats":{"Line":1},"fn_name":null},{"line":63,"address":[104488,104630,104552],"length":1,"stats":{"Line":3},"fn_name":null},{"line":64,"address":[104732],"length":1,"stats":{"Line":1},"fn_name":null},{"line":70,"address":[38271],"length":1,"stats":{"Line":1},"fn_name":null},{"line":72,"address":[38402,38594,38326],"length":1,"stats":{"Line":3},"fn_name":null},{"line":74,"address":[38618],"length":1,"stats":{"Line":1},"fn_name":null},{"line":75,"address":[38870],"length":1,"stats":{"Line":1},"fn_name":null},{"line":76,"address":[38939],"length":1,"stats":{"Line":1},"fn_name":null},{"line":79,"address":[39029],"length":1,"stats":{"Line":1},"fn_name":null},{"line":80,"address":[39149],"length":1,"stats":{"Line":1},"fn_name":null},{"line":87,"address":[39340,39224,42207,38568],"length":1,"stats":{"Line":3},"fn_name":null},{"line":88,"address":[39487,39314],"length":1,"stats":{"Line":2},"fn_name":null},{"line":89,"address":[39533,39617],"length":1,"stats":{"Line":1},"fn_name":null},{"line":90,"address":[39609],"length":1,"stats":{"Line":0},"fn_name":null},{"line":92,"address":[40451,41424,39630],"length":1,"stats":{"Line":3},"fn_name":null},{"line":93,"address":[39691],"length":1,"stats":{"Line":1},"fn_name":null},{"line":94,"address":[39738,41315],"length":1,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[41173,39804],"length":1,"stats":{"Line":3},"fn_name":null},{"line":96,"address":[39870],"length":1,"stats":{"Line":1},"fn_name":null},{"line":97,"address":[41033,39942],"length":1,"stats":{"Line":2},"fn_name":null},{"line":98,"address":[41009],"length":1,"stats":{"Line":4},"fn_name":null},{"line":99,"address":[41100,40961],"length":1,"stats":{"Line":4},"fn_name":null},{"line":100,"address":[39968,40852],"length":1,"stats":{"Line":0},"fn_name":null},{"line":101,"address":[40034],"length":1,"stats":{"Line":1},"fn_name":null},{"line":102,"address":[40106,40712],"length":1,"stats":{"Line":2},"fn_name":null},{"line":103,"address":[40688],"length":1,"stats":{"Line":4},"fn_name":null},{"line":104,"address":[40779,40640],"length":1,"stats":{"Line":4},"fn_name":null},{"line":105,"address":[40132],"length":1,"stats":{"Line":1},"fn_name":null},{"line":106,"address":[40504,40188],"length":1,"stats":{"Line":3},"fn_name":null},{"line":107,"address":[40214],"length":1,"stats":{"Line":1},"fn_name":null},{"line":108,"address":[40270],"length":1,"stats":{"Line":3},"fn_name":null},{"line":111,"address":[41440],"length":1,"stats":{"Line":1},"fn_name":null},{"line":112,"address":[41498],"length":1,"stats":{"Line":1},"fn_name":null},{"line":113,"address":[41549],"length":1,"stats":{"Line":1},"fn_name":null},{"line":114,"address":[41608,42100,42172],"length":1,"stats":{"Line":2},"fn_name":null},{"line":115,"address":[41966,41909],"length":1,"stats":{"Line":2},"fn_name":null},{"line":116,"address":[41998],"length":1,"stats":{"Line":3},"fn_name":null},{"line":117,"address":[42038],"length":1,"stats":{"Line":1},"fn_name":null},{"line":118,"address":[42068,42150],"length":1,"stats":{"Line":2},"fn_name":null},{"line":122,"address":[39363],"length":1,"stats":{"Line":1},"fn_name":null},{"line":132,"address":[57369,57360],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":133,"address":[61255,61434],"length":1,"stats":{"Line":1},"fn_name":null},{"line":143,"address":[61392,61556],"length":1,"stats":{"Line":2},"fn_name":null},{"line":144,"address":[61571,61829,61631],"length":1,"stats":{"Line":2},"fn_name":null},{"line":145,"address":[57427,57408],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":146,"address":[62069,61887,61747],"length":1,"stats":{"Line":2},"fn_name":null},{"line":147,"address":[62307,61987,62124],"length":1,"stats":{"Line":2},"fn_name":null},{"line":148,"address":[62225,62542,62362],"length":1,"stats":{"Line":2},"fn_name":null},{"line":149,"address":[62463,62594,62761],"length":1,"stats":{"Line":2},"fn_name":null},{"line":150,"address":[62688,62980,62813],"length":1,"stats":{"Line":2},"fn_name":null},{"line":151,"address":[63032,63200,62907],"length":1,"stats":{"Line":2},"fn_name":null},{"line":152,"address":[63252,63127,63419],"length":1,"stats":{"Line":2},"fn_name":null},{"line":153,"address":[63346,63471,63603],"length":1,"stats":{"Line":2},"fn_name":null},{"line":154,"address":[63566],"length":1,"stats":{"Line":1},"fn_name":null},{"line":174,"address":[118896,118905],"length":1,"stats":{"Line":2},"fn_name":"deref"},{"line":178,"address":[121828,118944,120359],"length":1,"stats":{"Line":1},"fn_name":"new"},{"line":179,"address":[118986],"length":1,"stats":{"Line":1},"fn_name":null},{"line":181,"address":[171913,171888],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":183,"address":[119278,119215],"length":1,"stats":{"Line":2},"fn_name":null},{"line":184,"address":[119348],"length":1,"stats":{"Line":0},"fn_name":null},{"line":186,"address":[119722],"length":1,"stats":{"Line":1},"fn_name":null},{"line":188,"address":[171952,172451,172107],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":189,"address":[171998],"length":1,"stats":{"Line":1},"fn_name":null},{"line":190,"address":[172034,172100,172255,172316,172172],"length":1,"stats":{"Line":5},"fn_name":null},{"line":191,"address":[172501,172282,172464],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":194,"address":[119627,119706],"length":1,"stats":{"Line":4},"fn_name":null},{"line":195,"address":[119962,120231,119836],"length":1,"stats":{"Line":0},"fn_name":null},{"line":197,"address":[120760],"length":1,"stats":{"Line":1},"fn_name":null},{"line":199,"address":[172720,173253,172758],"length":1,"stats":{"Line":2},"fn_name":"{closure#3}"},{"line":200,"address":[172814,173296],"length":1,"stats":{"Line":2},"fn_name":null},{"line":201,"address":[173323],"length":1,"stats":{"Line":0},"fn_name":null},{"line":202,"address":[172857],"length":1,"stats":{"Line":1},"fn_name":null},{"line":203,"address":[172920],"length":1,"stats":{"Line":0},"fn_name":null},{"line":206,"address":[172797],"length":1,"stats":{"Line":1},"fn_name":null},{"line":208,"address":[120990,121275,120874],"length":1,"stats":{"Line":0},"fn_name":null},{"line":210,"address":[121605],"length":1,"stats":{"Line":1},"fn_name":null},{"line":212,"address":[121872],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":213,"address":[122166,121931],"length":1,"stats":{"Line":1},"fn_name":null},{"line":215,"address":[173632,173747,173666],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":216,"address":[173676,173722],"length":1,"stats":{"Line":2},"fn_name":null},{"line":217,"address":[173760,173702,174141],"length":1,"stats":{"Line":1},"fn_name":"{closure#0}"},{"line":218,"address":[173928,173989,173838],"length":1,"stats":{"Line":0},"fn_name":null},{"line":219,"address":[173803,173864,173954],"length":1,"stats":{"Line":0},"fn_name":null},{"line":220,"address":[122140],"length":1,"stats":{"Line":0},"fn_name":null},{"line":228,"address":[122208],"length":1,"stats":{"Line":0},"fn_name":"parse"},{"line":229,"address":[122232],"length":1,"stats":{"Line":0},"fn_name":null},{"line":230,"address":[174160,174190],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":232,"address":[122272],"length":1,"stats":{"Line":1},"fn_name":"parse_real"},{"line":233,"address":[122308],"length":1,"stats":{"Line":1},"fn_name":null},{"line":234,"address":[174352,174397],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":235,"address":[122390,122322,122516,122558,122348,122432,122642,122474,122600],"length":1,"stats":{"Line":9},"fn_name":null},{"line":236,"address":[122335],"length":1,"stats":{"Line":4},"fn_name":null},{"line":237,"address":[174494,174598],"length":1,"stats":{"Line":2},"fn_name":null},{"line":238,"address":[174913,175049,174566,174714],"length":1,"stats":{"Line":3},"fn_name":null},{"line":239,"address":[175029,175247,175170],"length":1,"stats":{"Line":2},"fn_name":null},{"line":240,"address":[175561,175227,175368],"length":1,"stats":{"Line":2},"fn_name":null},{"line":242,"address":[122377],"length":1,"stats":{"Line":3},"fn_name":null},{"line":243,"address":[175662,175793],"length":1,"stats":{"Line":2},"fn_name":null},{"line":244,"address":[175915,175761,176114,176251],"length":1,"stats":{"Line":2},"fn_name":null},{"line":245,"address":[176450,176231,176372],"length":1,"stats":{"Line":0},"fn_name":null},{"line":246,"address":[176430,176746,176571,176844,177015],"length":1,"stats":{"Line":0},"fn_name":null},{"line":248,"address":[122419],"length":1,"stats":{"Line":4},"fn_name":null},{"line":249,"address":[177166,177390,177524],"length":1,"stats":{"Line":2},"fn_name":null},{"line":250,"address":[177649,177969,177846,177489],"length":1,"stats":{"Line":3},"fn_name":null},{"line":251,"address":[177949,178167,178090],"length":1,"stats":{"Line":2},"fn_name":null},{"line":252,"address":[178463,178288,178147,178561,178732],"length":1,"stats":{"Line":2},"fn_name":null},{"line":254,"address":[122461],"length":1,"stats":{"Line":4},"fn_name":null},{"line":255,"address":[179025,178894],"length":1,"stats":{"Line":1},"fn_name":null},{"line":256,"address":[179346,179495,179147,178993],"length":1,"stats":{"Line":3},"fn_name":null},{"line":257,"address":[179463,179936,179616,179813],"length":1,"stats":{"Line":3},"fn_name":null},{"line":258,"address":[180134,180057,179916],"length":1,"stats":{"Line":2},"fn_name":null},{"line":259,"address":[180114,180525,180255,180430,180720,180995],"length":1,"stats":{"Line":2},"fn_name":null},{"line":261,"address":[122503],"length":1,"stats":{"Line":3},"fn_name":null},{"line":262,"address":[181631,181198,181765,181432],"length":1,"stats":{"Line":1},"fn_name":null},{"line":263,"address":[182087,182211,181890,181730],"length":1,"stats":{"Line":0},"fn_name":null},{"line":264,"address":[182410,182191,182332],"length":1,"stats":{"Line":0},"fn_name":null},{"line":265,"address":[182804,182531,182390,182975,182706],"length":1,"stats":{"Line":0},"fn_name":null},{"line":267,"address":[122545],"length":1,"stats":{"Line":4},"fn_name":null},{"line":268,"address":[183134,183265],"length":1,"stats":{"Line":1},"fn_name":null},{"line":269,"address":[183387,183586,183735,183233],"length":1,"stats":{"Line":3},"fn_name":null},{"line":270,"address":[184176,184053,183856,183703],"length":1,"stats":{"Line":3},"fn_name":null},{"line":271,"address":[184374,184297,184156],"length":1,"stats":{"Line":2},"fn_name":null},{"line":272,"address":[185235,184670,184960,184495,184354,184765],"length":1,"stats":{"Line":2},"fn_name":null},{"line":274,"address":[122587],"length":1,"stats":{"Line":4},"fn_name":null},{"line":275,"address":[185438,185569],"length":1,"stats":{"Line":1},"fn_name":null},{"line":276,"address":[185992,185691,185890,185537],"length":1,"stats":{"Line":3},"fn_name":null},{"line":277,"address":[186117,186166,185972],"length":1,"stats":{"Line":2},"fn_name":null},{"line":278,"address":[186406,186603,186726,186131],"length":1,"stats":{"Line":3},"fn_name":null},{"line":279,"address":[186706,186847,186924],"length":1,"stats":{"Line":2},"fn_name":null},{"line":280,"address":[186904,187318,187220,187502,187045],"length":1,"stats":{"Line":2},"fn_name":null},{"line":282,"address":[122629],"length":1,"stats":{"Line":4},"fn_name":null},{"line":283,"address":[187662,187793],"length":1,"stats":{"Line":1},"fn_name":null},{"line":284,"address":[187761,188114,187915,188216],"length":1,"stats":{"Line":3},"fn_name":null},{"line":285,"address":[188341,188390,188196],"length":1,"stats":{"Line":2},"fn_name":null},{"line":286,"address":[188355,188630,188950,188827],"length":1,"stats":{"Line":3},"fn_name":null},{"line":287,"address":[188930,189148,189071],"length":1,"stats":{"Line":2},"fn_name":null},{"line":288,"address":[189726,189269,189128,189444,189542],"length":1,"stats":{"Line":2},"fn_name":null},{"line":291,"address":[189857,189840],"length":1,"stats":{"Line":2},"fn_name":"{closure#9}"},{"line":297,"address":[122720,122729],"length":1,"stats":{"Line":0},"fn_name":"deref"},{"line":302,"address":[122768],"length":1,"stats":{"Line":1},"fn_name":"try_from"},{"line":303,"address":[122827],"length":1,"stats":{"Line":1},"fn_name":null},{"line":304,"address":[122888],"length":1,"stats":{"Line":0},"fn_name":null},{"line":306,"address":[123012,122876],"length":1,"stats":{"Line":2},"fn_name":null},{"line":311,"address":[123088],"length":1,"stats":{"Line":0},"fn_name":"fmt"},{"line":312,"address":[123102],"length":1,"stats":{"Line":0},"fn_name":null},{"line":317,"address":[123136],"length":1,"stats":{"Line":0},"fn_name":"fmt"},{"line":318,"address":[123293,123158],"length":1,"stats":{"Line":0},"fn_name":null},{"line":319,"address":[123286],"length":1,"stats":{"Line":0},"fn_name":null},{"line":324,"address":[123344],"length":1,"stats":{"Line":0},"fn_name":"partial_cmp"},{"line":330,"address":[123472],"length":1,"stats":{"Line":0},"fn_name":"cmp"},{"line":331,"address":[123486],"length":1,"stats":{"Line":0},"fn_name":null},{"line":354,"address":[123504],"length":1,"stats":{"Line":0},"fn_name":"fmt"},{"line":356,"address":[123543],"length":1,"stats":{"Line":0},"fn_name":null},{"line":357,"address":[125500,123588],"length":1,"stats":{"Line":0},"fn_name":null},{"line":358,"address":[125326,123642],"length":1,"stats":{"Line":0},"fn_name":null},{"line":359,"address":[123696,125152],"length":1,"stats":{"Line":0},"fn_name":null},{"line":360,"address":[123750,124913],"length":1,"stats":{"Line":0},"fn_name":null},{"line":361,"address":[124755,123819],"length":1,"stats":{"Line":0},"fn_name":null},{"line":362,"address":[123873,124516],"length":1,"stats":{"Line":0},"fn_name":null},{"line":363,"address":[124296,123942],"length":1,"stats":{"Line":0},"fn_name":null},{"line":364,"address":[124008,124254],"length":1,"stats":{"Line":0},"fn_name":null},{"line":366,"address":[124244],"length":1,"stats":{"Line":0},"fn_name":null},{"line":374,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":375,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":376,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":377,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":378,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":379,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":380,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":381,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":382,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":383,"address":[],"length":0,"stats":{"Line":1},"fn_name":null}],"covered":134,"coverable":192},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-08","src","lib.rs"],"content":"//! Advent of Code 2015: Day 8: Matchsticks\n//!\n//! [https://adventofcode.com/2015/day/8](https://adventofcode.com/2015/day/8)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Matchsticks\";\n\tyear = 2015;\n\tday = 8;\n\tparse = |input| model::parse_input (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cusize\u003e {\n\t\tOk (\n\t\t\tinput.iter ()\n\t\t\t\t.map (|\u0026 (ref code, ref value)|\n\t\t\t\t\tcode.chars ().count () - value.chars ().count ())\n\t\t\t\t.sum ()\n\t\t)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cusize\u003e {\n\t\tOk (\n\t\t\tinput.iter ()\n\t\t\t\t.map (|\u0026 (ref code, _)| (model::encode (code), code))\n\t\t\t\t.map (|(code, value)|\n\t\t\t\t\tcode.chars ().count () - value.chars ().count ())\n\t\t\t\t.sum ()\n\t\t)\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse parser::*;\n\n\tpub type Input = Vec \u003c(String, String)\u003e;\n\n\t#[ must_use ]\n\tpub fn encode (input: \u0026 str) -\u003e String {\n\t\titer::once ('\"')\n\t\t\t.chain (input.chars ().flat_map::\u003cArrayVec \u003cchar, 2\u003e, _\u003e (|ch|\n\t\t\t\tmatch ch {\n\t\t\t\t\t'\\\\' =\u003e array_vec! [ '\\\\', '\\\\' ],\n\t\t\t\t\t'\"' =\u003e array_vec! [ '\\\\', '\"' ],\n\t\t\t\t\tch =\u003e array_vec! [ ch ],\n\t\t\t\t}))\n\t\t\t.chain (iter::once ('\"'))\n\t\t\t.collect ()\n\t}\n\n\tpub fn decode (input: \u0026 str) -\u003e GenResult \u003cString\u003e {\n\t\tParser::wrap (input, decode_real)\n\t\t\t.map_parse_err (|col_idx| format! (\"Invalid input: col {}: {}\", col_idx + 1, input))\n\t}\n\n\tfn decode_real (parser: \u0026 mut Parser) -\u003e ParseResult \u003cString\u003e {\n\t\tparser.expect (\"\\\"\") ?;\n\t\tlet mut result = String::new ();\n\t\tloop {\n\t\t\tmatch parser.expect_next () ? {\n\t\t\t\t'\"' =\u003e break,\n\t\t\t\t'\\\\' =\u003e match parser.expect_next () ? {\n\t\t\t\t\t'x' =\u003e {\n\t\t\t\t\t\tlet digit_high = parser.expect_next () ?.to_digit (16)\n\t\t\t\t\t\t\t.ok_or_else (|| parser.err ()) ?;\n\t\t\t\t\t\tlet digit_low = parser.expect_next () ?.to_digit (16)\n\t\t\t\t\t\t\t.ok_or_else (|| parser.err ()) ?;\n\t\t\t\t\t\tlet ch_code = digit_high \u003c\u003c 4_u32 | digit_low;\n\t\t\t\t\t\tlet ch = char::from_u32 (ch_code).ok_or_else (|| parser.err ()) ?;\n\t\t\t\t\t\tresult.push (ch);\n\t\t\t\t\t},\n\t\t\t\t\t'\\\\' =\u003e result.push ('\\\\'),\n\t\t\t\t\t'\"' =\u003e result.push ('\"'),\n\t\t\t\t\t_ =\u003e Err (parser.err ()) ?,\n\t\t\t\t},\n\t\t\t\tch =\u003e result.push (ch),\n\t\t\t}\n\t\t}\n\t\tOk (result)\n\t}\n\n\tpub fn parse_input (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cInput\u003e {\n\t\tinput.iter ().enumerate ()\n\t\t\t.map (|(line_idx, \u0026 line)|\n\t\t\t\tParser::wrap (line, |parser| Ok ((line.to_owned (), decode_real (parser) ?)))\n\t\t\t\t\t.map_parse_err (|col_idx| format! (\"Invalid input: line {}: col {}: {}\",\n\t\t\t\t\t\tline_idx + 1, col_idx + 1, line)))\n\t\t\t.collect ()\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"\\\"\\\"\",\n\t\t\"\\\"abc\\\"\",\n\t\t\"\\\"aaa\\\\\\\"aaa\\\"\",\n\t\t\"\\\"\\\\x27\\\"\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"12\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"19\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":13,"address":[25619,26307],"length":1,"stats":{"Line":2},"fn_name":null},{"line":14,"address":[25725],"length":1,"stats":{"Line":1},"fn_name":null},{"line":15,"address":[26413],"length":1,"stats":{"Line":1},"fn_name":null},{"line":23,"address":[61200],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":25,"address":[61232],"length":1,"stats":{"Line":1},"fn_name":null},{"line":26,"address":[55088,55285,55105],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":27,"address":[55130,55293],"length":1,"stats":{"Line":1},"fn_name":null},{"line":32,"address":[61360],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":34,"address":[61392],"length":1,"stats":{"Line":1},"fn_name":null},{"line":35,"address":[55370,55328],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":36,"address":[55472,55484,55770],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":37,"address":[55523],"length":1,"stats":{"Line":1},"fn_name":null},{"line":52,"address":[56640,56923,56893],"length":1,"stats":{"Line":1},"fn_name":"encode"},{"line":53,"address":[56683,56840,56757,56881],"length":1,"stats":{"Line":4},"fn_name":null},{"line":54,"address":[56715],"length":1,"stats":{"Line":2},"fn_name":null},{"line":55,"address":[81947],"length":1,"stats":{"Line":1},"fn_name":null},{"line":56,"address":[82205,81985],"length":1,"stats":{"Line":2},"fn_name":null},{"line":57,"address":[82121,82000],"length":1,"stats":{"Line":2},"fn_name":null},{"line":58,"address":[81969,82021],"length":1,"stats":{"Line":2},"fn_name":null},{"line":60,"address":[56916,56873,56791],"length":1,"stats":{"Line":2},"fn_name":null},{"line":64,"address":[56960],"length":1,"stats":{"Line":0},"fn_name":"decode"},{"line":65,"address":[56983,57017],"length":1,"stats":{"Line":0},"fn_name":null},{"line":66,"address":[57007],"length":1,"stats":{"Line":0},"fn_name":null},{"line":69,"address":[57056,59444],"length":1,"stats":{"Line":2},"fn_name":"decode_real"},{"line":70,"address":[57172,57086],"length":1,"stats":{"Line":2},"fn_name":null},{"line":71,"address":[57152],"length":1,"stats":{"Line":2},"fn_name":null},{"line":72,"address":[57734],"length":1,"stats":{"Line":2},"fn_name":null},{"line":73,"address":[57307,57374,57564],"length":1,"stats":{"Line":4},"fn_name":null},{"line":75,"address":[57755,57725,57957],"length":1,"stats":{"Line":4},"fn_name":null},{"line":77,"address":[58288,57997,58493,58671,58465],"length":1,"stats":{"Line":6},"fn_name":null},{"line":78,"address":[58693,58485,58607,58438],"length":1,"stats":{"Line":2},"fn_name":null},{"line":79,"address":[58918,58741,58595,58946,59117],"length":1,"stats":{"Line":6},"fn_name":null},{"line":80,"address":[59139,58938,58891,59053],"length":1,"stats":{"Line":2},"fn_name":null},{"line":81,"address":[59039,59179],"length":1,"stats":{"Line":4},"fn_name":null},{"line":82,"address":[59188,59321],"length":1,"stats":{"Line":2},"fn_name":null},{"line":83,"address":[59439,59309],"length":1,"stats":{"Line":4},"fn_name":null},{"line":85,"address":[58020,58270],"length":1,"stats":{"Line":0},"fn_name":null},{"line":86,"address":[58043,58268],"length":1,"stats":{"Line":4},"fn_name":null},{"line":87,"address":[58053,57977],"length":1,"stats":{"Line":0},"fn_name":null},{"line":89,"address":[57589,57732],"length":1,"stats":{"Line":4},"fn_name":null},{"line":92,"address":[57616],"length":1,"stats":{"Line":2},"fn_name":null},{"line":95,"address":[59472],"length":1,"stats":{"Line":2},"fn_name":"parse_input"},{"line":96,"address":[59522],"length":1,"stats":{"Line":2},"fn_name":null},{"line":97,"address":[82865,82688,82722],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":98,"address":[82754,82834,82880,82921],"length":1,"stats":{"Line":8},"fn_name":"{closure#0}"},{"line":99,"address":[82808,83653,83424,83502,83592],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":100,"address":[83618,83467,83528],"length":1,"stats":{"Line":0},"fn_name":null},{"line":119,"address":[59605,59600],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":120,"address":[64439],"length":1,"stats":{"Line":1},"fn_name":null},{"line":121,"address":[64536,64462,64602],"length":1,"stats":{"Line":3},"fn_name":null},{"line":125,"address":[59632,59637],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":126,"address":[65079],"length":1,"stats":{"Line":1},"fn_name":null},{"line":127,"address":[65102,65176,65242],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":47,"coverable":53},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-09","src","lib.rs"],"content":"//! Advent of Code 2015: Day 9: All in a Single Night\n//!\n//! [https://adventofcode.com/2015/day/9](https://adventofcode.com/2015/day/9)\n//!\n//! # Input\n//!\n//! Each line represents the distance between two locations in the form \"$0 to $1 = $2\". The first\n//! two parameters are alphanumeric strings representing the locations, tand the third is a\n//! integer representing the distance.\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"All in a Single Night\";\n\tyear = 2015;\n\tday = 9;\n\tparse = |input| model::parse_input (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\tuse model::Place;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cu32\u003e {\n\t\tsanity_check (input) ?;\n\t\tOk (distances (input).min ().unwrap ())\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cu32\u003e {\n\t\tsanity_check (input) ?;\n\t\tOk (distances (input).max ().unwrap ())\n\t}\n\n\tfn sanity_check (input: \u0026 Input) -\u003e GenResult \u003c()\u003e {\n\t\tif input.len () \u003e 60 { Err (\"Refusing to handle more than 60 distances\") ?; }\n\t\tlet num_places =\n\t\t\tinput.iter ()\n\t\t\t\t.flat_map (|\u0026 (ref from, ref to, _)| [from, to])\n\t\t\t\t.sorted ()\n\t\t\t\t.dedup ()\n\t\t\t\t.count ();\n\t\tif num_places \u003e 10 {\n\t\t\tErr (\"Refusing to handle more than 10 places\") ?;\n\t\t}\n\t\tif input.len () != num_places * (num_places - 1) / 2 {\n\t\t\tErr (\"Wrong number of distances for given number of places\") ?;\n\t\t}\n\t\tOk (())\n\t}\n\n\tfn distances (input: \u0026 Input) -\u003e impl Iterator \u003cItem = u32\u003e {\n\t\tlet (num_places, distances) = gen_dist_table (input);\n\t\tlet mut route = Vec::new ();\n\t\tlet mut used = iter::repeat (false).take (num_places).collect::\u003cVec \u003c_\u003e\u003e ();\n\t\tlet mut finished = false;\n\t\titer::from_fn (move || {\n\t\t\tif finished { return None }\n\n\t\t\t// find the next free place\n\n\t\t\t#[ inline ]\n\t\t\tfn next (used: \u0026 [bool], start: usize) -\u003e Option \u003cusize\u003e {\n\t\t\t\tused.iter ().copied ().enumerate ()\n\t\t\t\t\t.skip (start)\n\t\t\t\t\t.filter (|\u0026 (_, used)| ! used)\n\t\t\t\t\t.map (|(idx, _)| idx)\n\t\t\t\t\t.next ()\n\t\t\t}\n\n\t\t\t// find a place index we can increment (except first time)\n\n\t\t\tif ! route.is_empty () {\n\t\t\t\tloop {\n\t\t\t\t\tif let Some (val) = route.pop () {\n\t\t\t\t\t\tused [val] = false;\n\t\t\t\t\t\tif let Some (val) = next (\u0026 used, val + 1) {\n\t\t\t\t\t\t\troute.push (val);\n\t\t\t\t\t\t\tused [val] = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else { finished = true; return None }\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// fill in the rest with the minimum possible\n\n\t\t\twhile route.len () \u003c num_places {\n\t\t\t\tlet val = next (\u0026 used, 0).unwrap ();\n\t\t\t\troute.push (val);\n\t\t\t\tused [val] = true;\n\t\t\t}\n\n\t\t\t// return\n\n\t\t\tSome (\n\t\t\t\troute.iter ()\n\t\t\t\t\t.tuple_windows::\u003c(_, _)\u003e ()\n\t\t\t\t\t.map (|(place_0, place_1)| distances [place_0 * num_places + place_1])\n\t\t\t\t\t.sum::\u003cu32\u003e ()\n\t\t\t)\n\n\t\t})\n\t}\n\n\tfn gen_dist_table (input: \u0026 Input) -\u003e (usize, Vec \u003cu32\u003e) {\n\t\tlet place_indexes: HashMap \u003cPlace, usize\u003e =\n\t\t\tinput.iter ()\n\t\t\t\t.flat_map (|\u0026 (ref place_0, ref place_1, _)| [\n\t\t\t\t\tRc::clone (place_0),\n\t\t\t\t\tRc::clone (place_1),\n\t\t\t\t])\n\t\t\t\t.sorted ()\n\t\t\t\t.dedup ()\n\t\t\t\t.enumerate ()\n\t\t\t\t.map (|(idx, place)| (place, idx))\n\t\t\t\t.collect ();\n\t\tlet num_places = place_indexes.len ();\n\t\tlet mut distances = iter::repeat (0).take (num_places * num_places).collect::\u003cVec \u003c_\u003e\u003e ();\n\t\tfor \u0026 (ref place_0, ref place_1, dist) in input {\n\t\t\tlet place_0 = place_indexes [place_0];\n\t\t\tlet place_1 = place_indexes [place_1];\n\t\t\tdistances [place_0 * num_places + place_1] = dist;\n\t\t\tdistances [place_1 * num_places + place_0] = dist;\n\t\t}\n\t\t(num_places, distances)\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\n\tpub type Place = Rc \u003cstr\u003e;\n\tpub type Input = Vec \u003c(Place, Place, u32)\u003e;\n\n\tpub fn parse_input (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cInput\u003e {\n\t\tuse parser::*;\n\t\tinput.iter ().enumerate ().map (|(line_idx, line)|\n\t\t\tParser::wrap (line, |parser| {\n\t\t\t\tparser.set_ignore_whitespace (true);\n\t\t\t\tlet place_0 = parser.word () ?;\n\t\t\t\tlet place_1 = parser.expect_word (\"to\") ?.word () ?;\n\t\t\t\tlet distance = parser.expect_word (\"=\") ?.int () ?;\n\t\t\t\tif distance \u003c 1 { Err (\"Distance must be at least one\") ?; }\n\t\t\t\tparser.end () ?;\n\t\t\t\tOk ((place_0.into (), place_1.into (), distance))\n\t\t\t}).map_parse_err (|col_idx|\n\t\t\t\tformat! (\"Invalid input: line {}: col {}: {}\", line_idx + 1, col_idx + 1, line)\n\t\t\t)\n\t\t).collect ()\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"London to Dublin = 464\",\n\t\t\"London to Belfast = 518\",\n\t\t\"Dublin to Belfast = 141\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"605\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"982\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n\n","traces":[{"line":19,"address":[84771,84083],"length":1,"stats":{"Line":2},"fn_name":null},{"line":20,"address":[84189],"length":1,"stats":{"Line":1},"fn_name":null},{"line":21,"address":[84877],"length":1,"stats":{"Line":1},"fn_name":null},{"line":30,"address":[29024],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":31,"address":[29150,29062],"length":1,"stats":{"Line":1},"fn_name":null},{"line":32,"address":[29203,29133],"length":1,"stats":{"Line":2},"fn_name":null},{"line":35,"address":[29280],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":36,"address":[29318,29406],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[29389,29459],"length":1,"stats":{"Line":2},"fn_name":null},{"line":40,"address":[29536],"length":1,"stats":{"Line":1},"fn_name":"sanity_check"},{"line":41,"address":[29556,29602],"length":1,"stats":{"Line":1},"fn_name":null},{"line":42,"address":[29752,29582],"length":1,"stats":{"Line":2},"fn_name":null},{"line":44,"address":[71440,71424],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":48,"address":[29863],"length":1,"stats":{"Line":1},"fn_name":null},{"line":49,"address":[29889],"length":1,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[29874,30042],"length":1,"stats":{"Line":2},"fn_name":null},{"line":52,"address":[30180],"length":1,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[30166],"length":1,"stats":{"Line":1},"fn_name":null},{"line":57,"address":[30810,30336],"length":1,"stats":{"Line":1},"fn_name":"distances"},{"line":58,"address":[30361],"length":1,"stats":{"Line":1},"fn_name":null},{"line":59,"address":[30433],"length":1,"stats":{"Line":1},"fn_name":null},{"line":60,"address":[30558,30490],"length":1,"stats":{"Line":2},"fn_name":null},{"line":61,"address":[30620],"length":1,"stats":{"Line":1},"fn_name":null},{"line":62,"address":[30628],"length":1,"stats":{"Line":4},"fn_name":null},{"line":63,"address":[71523,71495],"length":1,"stats":{"Line":1},"fn_name":null},{"line":68,"address":[30848],"length":1,"stats":{"Line":1},"fn_name":"next"},{"line":69,"address":[30884],"length":1,"stats":{"Line":1},"fn_name":null},{"line":71,"address":[72349,72336],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":72,"address":[72384,72409],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":78,"address":[71563,71952,71509],"length":1,"stats":{"Line":3},"fn_name":null},{"line":80,"address":[71604],"length":1,"stats":{"Line":1},"fn_name":null},{"line":81,"address":[71668,71739],"length":1,"stats":{"Line":2},"fn_name":null},{"line":82,"address":[71742],"length":1,"stats":{"Line":1},"fn_name":null},{"line":83,"address":[71903],"length":1,"stats":{"Line":1},"fn_name":null},{"line":84,"address":[71922],"length":1,"stats":{"Line":1},"fn_name":null},{"line":87,"address":[71703],"length":1,"stats":{"Line":1},"fn_name":null},{"line":93,"address":[71577,72162,71973],"length":1,"stats":{"Line":3},"fn_name":null},{"line":94,"address":[72016],"length":1,"stats":{"Line":1},"fn_name":null},{"line":95,"address":[72113],"length":1,"stats":{"Line":1},"fn_name":null},{"line":96,"address":[72132],"length":1,"stats":{"Line":1},"fn_name":null},{"line":101,"address":[72309],"length":1,"stats":{"Line":1},"fn_name":null},{"line":102,"address":[72177,72251,71987],"length":1,"stats":{"Line":3},"fn_name":null},{"line":104,"address":[72224,72469,72432],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":111,"address":[32264,31040],"length":1,"stats":{"Line":1},"fn_name":"gen_dist_table"},{"line":112,"address":[31090],"length":1,"stats":{"Line":1},"fn_name":null},{"line":114,"address":[72613,72576,72720],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":115,"address":[72635],"length":1,"stats":{"Line":1},"fn_name":null},{"line":116,"address":[72655],"length":1,"stats":{"Line":1},"fn_name":null},{"line":121,"address":[72784,72795],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":123,"address":[31353,31290],"length":1,"stats":{"Line":2},"fn_name":null},{"line":124,"address":[31363],"length":1,"stats":{"Line":1},"fn_name":null},{"line":125,"address":[31507,31769,31574,32259],"length":1,"stats":{"Line":4},"fn_name":null},{"line":126,"address":[31832],"length":1,"stats":{"Line":1},"fn_name":null},{"line":127,"address":[31885],"length":1,"stats":{"Line":1},"fn_name":null},{"line":128,"address":[31946],"length":1,"stats":{"Line":1},"fn_name":null},{"line":129,"address":[32110],"length":1,"stats":{"Line":1},"fn_name":null},{"line":131,"address":[31664],"length":1,"stats":{"Line":1},"fn_name":null},{"line":143,"address":[91888],"length":1,"stats":{"Line":1},"fn_name":"parse_input"},{"line":145,"address":[91938],"length":1,"stats":{"Line":4},"fn_name":null},{"line":146,"address":[138947,138640,138596,138550,140356],"length":1,"stats":{"Line":5},"fn_name":"{closure#0}"},{"line":147,"address":[138686],"length":1,"stats":{"Line":1},"fn_name":null},{"line":148,"address":[138833,138701],"length":1,"stats":{"Line":1},"fn_name":null},{"line":149,"address":[138955,138801,139289,139153],"length":1,"stats":{"Line":3},"fn_name":null},{"line":150,"address":[139607,139687,139257,139410],"length":1,"stats":{"Line":3},"fn_name":null},{"line":151,"address":[139671,139831],"length":1,"stats":{"Line":1},"fn_name":null},{"line":152,"address":[139974,140060,139813],"length":1,"stats":{"Line":2},"fn_name":null},{"line":153,"address":[140191,140032],"length":1,"stats":{"Line":2},"fn_name":null},{"line":154,"address":[140400,140781,138576],"length":1,"stats":{"Line":1},"fn_name":"{closure#1}"},{"line":155,"address":[140443],"length":1,"stats":{"Line":0},"fn_name":null},{"line":174,"address":[32929,32320,32883],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":175,"address":[32327],"length":1,"stats":{"Line":1},"fn_name":null},{"line":176,"address":[32424,32490,32350],"length":1,"stats":{"Line":3},"fn_name":null},{"line":180,"address":[33523,32960,33569],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":181,"address":[32967],"length":1,"stats":{"Line":1},"fn_name":null},{"line":182,"address":[33130,32990,33064],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":72,"coverable":75},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-10","src","cycles.rs"],"content":"#![ allow (clippy::else_if_without_else) ]\n\nuse super::*;\nuse model::State;\nuse nums::IntConv;\n\n#[ derive (Debug, clap::Parser) ]\npub struct Args {\n\n\t#[ clap (long, default_value = \"20\") ]\n\titerations: usize,\n\n\t#[ clap (long, default_value = \"10\") ]\n\tmax_length: usize,\n\n}\n\n#[ derive (Clone, Eq, Hash, PartialEq) ]\npub struct Span (Rc \u003c[u8]\u003e);\n\nimpl Span {\n\t/*\n\tfn split (\u0026 self) -\u003e Vec \u003cSpan\u003e {\n\t\titer::empty ()\n\t\t\t.chain (iter::once (0))\n\t\t\t.chain (self.iter ().skip (1)\n\t\t\t\t.tuples::\u003c(_, _)\u003e ()\n\t\t\t\t.enumerate ()\n\t\t\t\t.filter_map (|(idx, (left, right))| (left != right).then_some (idx + 1)))\n\t\t\t.chain (iter::once (self.len ()))\n\t\t\t.tuple_windows::\u003c(_, _)\u003e ()\n\t\t\t.map (|(start, end)| Span::from (\u0026 self [start .. end]))\n\t\t\t.collect ()\n\t}\n\tfn can_split (\u0026 self) -\u003e bool {\n\t\titer::empty ()\n\t\t\t.chain (self.iter ().skip (1)\n\t\t\t\t.tuples::\u003c(_, _)\u003e ()\n\t\t\t\t.enumerate ()\n\t\t\t\t.filter_map (|(idx, (left, right))| (left != right).then_some (idx + 1)))\n\t\t\t.next ()\n\t\t\t.is_some ()\n\t}\n\t*/\n}\n\nimpl Debug for Span {\n\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\twrite! (formatter, \"Span (\\\"{}\\\")\", self) ?;\n\t\tOk (())\n\t}\n}\n\nimpl Display for Span {\n\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\tfor \u0026 val in self.0.iter () {\n\t\t\twrite! (formatter, \"{}\", char::from_digit (val.as_u32 (), 10).unwrap ()) ?;\n\t\t}\n\t\tOk (())\n\t}\n}\n\nimpl Borrow \u003c[u8]\u003e for Span {\n\tfn borrow (\u0026 self) -\u003e \u0026 [u8] { \u0026 self.0 }\n}\n\nimpl From \u003c\u0026 [u8]\u003e for Span {\n\tfn from (other: \u0026 [u8]) -\u003e Self {\n\t\tSelf (other.into ())\n\t}\n}\n\nimpl TryFrom \u003c\u0026 str\u003e for Span {\n\ttype Error = GenError;\n\tfn try_from (src: \u0026 str) -\u003e GenResult \u003cSelf\u003e {\n\t\tOk (Self::from (model::State::parse (src) ?.as_slice ()))\n\t}\n}\n\nimpl PartialEq \u003c[u8]\u003e for Span {\n\tfn eq (\u0026 self, other: \u0026 [u8]) -\u003e bool {\n\t\tself.0.as_ref () == other\n\t}\n}\n\nimpl PartialOrd for Span {\n\tfn partial_cmp (\u0026 self, other: \u0026 Self) -\u003e Option \u003cOrdering\u003e {\n\t\tSome (self.cmp (other))\n\t}\n}\n\nimpl Ord for Span {\n\tfn cmp (\u0026 self, other: \u0026 Self) -\u003e Ordering {\n\t\tself.0.len ().cmp (\u0026 other.len ())\n\t\t\t.then (self.0.cmp (\u0026 other.0))\n\t}\n}\n\nimpl Deref for Span {\n\ttype Target = [u8];\n\tfn deref (\u0026 self) -\u003e \u0026 [u8] { self.0.as_ref () }\n}\n\n#[ derive (Clone, Debug, Eq, Ord, PartialEq, PartialOrd) ]\nenum Destiny {\n\tUnstable (Span),\n\tAtomic (Atomic),\n\tStable (Rc \u003c[Atomic]\u003e),\n}\n\n#[ derive (Clone, Eq, Hash, Ord, PartialEq, PartialOrd) ]\nstruct Atomic (Rc \u003cAtomicInner\u003e);\n\nimpl Borrow \u003c[u8]\u003e for Atomic {\n\tfn borrow (\u0026 self) -\u003e \u0026 [u8] { \u0026 self.deref ().key }\n}\n\nimpl Deref for Atomic {\n\ttype Target = AtomicInner;\n\tfn deref (\u0026 self) -\u003e \u0026 AtomicInner { \u0026 self.0 }\n}\n\nimpl From \u003cAtomicInner\u003e for Atomic {\n\tfn from (inner: AtomicInner) -\u003e Self {\n\t\tSelf (Rc::new (inner))\n\t}\n}\n\n#[ derive (Clone, Ord, PartialOrd) ]\nstruct AtomicInner {\n\tkey: Span,\n\tnext: Rc \u003c[Atomic]\u003e,\n\tfirst: [u8; 3],\n\tlast: u8,\n}\n\nimpl Debug for Atomic {\n\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\twrite! (formatter, \"Atomic ({} next=\", self.key) ?;\n\t\tif self.next.is_empty () { write! (formatter, \"TODO\") ?; }\n\t\tfor (next_idx, next) in self.next.iter ().enumerate () {\n\t\t\tif next_idx \u003e 0 { write! (formatter, \",\") ?; }\n\t\t\twrite! (formatter, \"{}\", next.key) ?;\n\t\t}\n\t\twrite! (formatter, \" first=\") ?;\n\t\tfor item in self.first.iter ().copied () {\n\t\t\twrite! (formatter, \"{}\", char::from_digit (item.as_u32 (), 10).unwrap ()) ?;\n\t\t}\n\t\twrite! (formatter, \" last={})\", self.last) ?;\n\t\tOk (())\n\t}\n}\n\nimpl PartialEq \u003c[u8]\u003e for AtomicInner {\n\tfn eq (\u0026 self, other: \u0026 [u8]) -\u003e bool { self.key == * other }\n}\n\nimpl PartialEq for AtomicInner {\n\tfn eq (\u0026 self, other: \u0026 Self) -\u003e bool { self.key == other.key }\n}\n\nimpl Eq for AtomicInner {}\n\nimpl Hash for AtomicInner {\n\tfn hash \u003cHr: Hasher\u003e (\u0026 self, hasher: \u0026 mut Hr) {\n\t\tself.key.hash (hasher);\n\t}\n}\n\nimpl PartialOrd \u003c[u8]\u003e for AtomicInner {\n\tfn partial_cmp (\u0026 self, other: \u0026 [u8]) -\u003e Option \u003cOrdering\u003e {\n\t\tself.key.deref ().partial_cmp (other)\n\t}\n}\n\nconst fn compatible (prev: u8, next: \u0026 [u8]) -\u003e bool {\n\tprev != next [0] \u0026\u0026 prev != next [1] \u0026\u0026 prev != next [2]\n}\n\n#[ allow (clippy::needless_pass_by_value) ]\n#[ allow (clippy::print_stdout) ]\n#[ allow (clippy::todo) ]\n#[ allow (clippy::too_many_lines) ]\npub fn run (args: Args) -\u003e GenResult \u003c()\u003e {\n\n\tlet stables = find_stables (args.max_length, args.iterations);\n\tprintln! (\"NUM STABLES: {}\", stables.len ());\n\tprintln! (\"NUM SINGULAR: {}\", stables.values ().filter (|stable|\n\t\tstable.as_ref ().map_or (false, |stable| stable.parts.len () == 1)).count ());\n\n\tlet mut destinies: HashMap \u003cSpan, Destiny\u003e = HashMap::new ();\n\tlet mut atomics: HashSet \u003cAtomic\u003e = HashSet::new ();\n\n\tfor length in (2 ..= args.max_length).step_by (2) {\n\n\t\t'STATE: for state in (0 .. length).map (|_| (1_u8 ..= 3_u8))\n\t\t\t.multi_cartesian_product ()\n\t\t\t.map (|nums| State::try_from (nums).unwrap ()) {\n\n\t\t\tlet has_long_run = {\n\t\t\t\tlet group_by_temp =\n\t\t\t\t\tstate.iter ().copied ()\n\t\t\t\t\t\t.group_by (|\u0026 item| item);\n\t\t\t\tgroup_by_temp.into_iter ()\n\t\t\t\t\t.any (|(_, group)| group.count () \u003e 3)\n\t\t\t};\n\t\t\tif has_long_run { continue }\n\n\t\t\tfor prefix_len in (2 ..= length.as_usize () - 2).step_by (2) {\n\t\t\t\tmatch (\n\t\t\t\t\tatomics.get (\u0026 state [ .. prefix_len]),\n\t\t\t\t\tdestinies.get (\u0026 state [prefix_len .. ]).unwrap_or_else (||\n\t\t\t\t\t\tpanic! (\"Can't find destiny for {:?}\", \u0026 state [prefix_len .. ])),\n\t\t\t\t) {\n\t\t\t\t\t(Some (_), \u0026 Destiny::Unstable (_)) | (None, _) =\u003e continue,\n\t\t\t\t\t(Some (prefix), \u0026 Destiny::Atomic (ref suffix)) =\u003e {\n\t\t\t\t\t\tif ! compatible (prefix.last, \u0026 suffix.first) { continue }\n\t\t\t\t\t\tdestinies.insert (\n\t\t\t\t\t\t\tstate.as_slice ().into (),\n\t\t\t\t\t\t\tDestiny::Stable ([ prefix.clone (), suffix.clone () ].as_slice ().into ()));\n\t\t\t\t\t\tcontinue 'STATE;\n\t\t\t\t\t},\n\t\t\t\t\t(Some (prefix), \u0026 Destiny::Stable (ref suffix)) =\u003e {\n\t\t\t\t\t\tif ! compatible (prefix.last, \u0026 suffix [0].first) { continue }\n\t\t\t\t\t\tdestinies.insert (\n\t\t\t\t\t\t\tstate.as_slice ().into (),\n\t\t\t\t\t\t\tDestiny::Stable (\n\t\t\t\t\t\t\t\titer::once (prefix.clone ())\n\t\t\t\t\t\t\t\t\t.chain (suffix.iter ().cloned ())\n\t\t\t\t\t\t\t\t\t.collect::\u003cVec \u003c_\u003e\u003e ()\n\t\t\t\t\t\t\t\t\t.into ()));\n\t\t\t\t\t\tcontinue 'STATE;\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet mut seq_ord = Vec::new ();\n\t\t\tseq_ord.push (state.clone ());\n\t\t\tlet mut seq_set = HashSet::new ();\n\t\t\tseq_set.insert (state.clone ());\n\n\t\t\tlet mut prev_state = state.clone ();\n\t\t\tlet mut left_1 = state [0] == 1;\n\t\t\tlet mut left_2 = state [0] == 2;\n\t\t\tlet mut left_3 = state [0] == 3;\n\n\t\t\tfor _ in 0 .. args.iterations {\n\t\t\t\tlet next_state = logic::one_round (\u0026 prev_state);\n\n\t\t\t\tif let Some (_whatever) = destinies.get (next_state.as_slice ()) {\n\t\t\t\t\t//todo! (\"CHECK FOR EXISTING {} {}\", state, next_state); TODO\n\t\t\t\t}\n\n\t\t\t\tseq_ord.push (next_state.clone ());\n\t\t\t\tseq_set.insert (next_state.clone ());\n\n\t\t\t\tif next_state [0] == 1 { left_1 = true; }\n\t\t\t\tif next_state [0] == 2 { left_2 = true; }\n\t\t\t\tif next_state [0] == 3 { left_3 = true; }\n\n\t\t\t\tif left_1 \u0026\u0026 left_2 \u0026\u0026 left_3 {\n\t\t\t\t\tdestinies.insert (\n\t\t\t\t\t\tstate.as_slice ().into (),\n\t\t\t\t\t\tDestiny::Unstable (seq_ord [1].as_slice ().into ()));\n\t\t\t\t\tcontinue 'STATE;\n\t\t\t\t}\n\n\t\t\t\tprev_state = next_state;\n\t\t\t}\n\n\t\t\tlet mut next_rest = \u0026 seq_ord [1] [ .. ];\n\t\t\tlet mut atomic_next = Vec::new ();\n\t\t\t'OUTER: while ! next_rest.is_empty () {\n\t\t\t\tfor prefix_len in (2 .. next_rest.len ()).step_by (2) {\n\t\t\t\t\tif let Some (prefix_atomic) = atomics.get (\u0026 seq_ord [1] [0 .. prefix_len]) {\n\t\t\t\t\t\tatomic_next.push (prefix_atomic.clone ());\n\t\t\t\t\t\tnext_rest = \u0026 next_rest [ prefix_len .. ];\n\t\t\t\t\t\tcontinue 'OUTER;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t//unreachable! (\"Can't find atomics for: {}: {}\", state, seq_ord [1]);\n\t\t\t\tatomic_next.clear ();\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tlet key: Span = state.as_slice ().into ();\n\t\t\tlet atomic: Atomic = AtomicInner {\n\t\t\t\tkey: key.clone (),\n\t\t\t\tnext: atomic_next.as_slice ().into (),\n\t\t\t\tfirst: [0, 1, 2].map (|idx| seq_ord [idx].first ().copied ().unwrap ()),\n\t\t\t\tlast: seq_ord [0].last ().copied ().unwrap (),\n\t\t\t}.into ();\n\t\t\tatomics.insert (atomic.clone ());\n\t\t\tdestinies.insert (key, Destiny::Atomic (atomic));\n\n\t\t}\n\n\t}\n\n\tprintln! (\"ATOMICS: count={}\", atomics.len ());\n\tfor atomic in atomics.iter ().sorted_by_key (|atomic| atomic.key.clone ()) {\n\t\tprintln! (\" - {:?}\", atomic);\n\t}\n\n\tprintln! (\"DESTINIES: count={}\", destinies.len ());\n\tfor (_key, _destiny) in destinies.iter ().sorted_by_key (|\u0026 (key, _)| key.clone ()) {\n\t\t//println! (\" - {:?}\", atomic);\n\t}\n\n\ttodo! ();\n\n}\n\nstruct Stable {\n\tparts: Vec \u003cSpan\u003e,\n\tfirst: [u8; 3],\n\tlast: u8,\n}\n\nfn find_stables (max_length: usize, iterations: usize) -\u003e HashMap \u003cSpan, Option \u003cStable\u003e\u003e {\n\n\tlet mut stables: HashMap \u003cSpan, Option \u003cStable\u003e\u003e = HashMap::new ();\n\n\tfor length in (2 ..= max_length).step_by (2) {\n\n\t\t'STATE: for state in (0 .. length).map (|_| (1_u8 ..= 3_u8))\n\t\t\t.multi_cartesian_product ()\n\t\t\t.map (|nums| State::try_from (nums).unwrap ()) {\n\n\t\t\tlet has_long_run = {\n\t\t\t\tlet group_by_temp =\n\t\t\t\t\tstate.iter ().copied ()\n\t\t\t\t\t\t.group_by (|\u0026 item| item);\n\t\t\t\tgroup_by_temp.into_iter ()\n\t\t\t\t\t.any (|(_, group)| group.count () \u003e 3)\n\t\t\t};\n\t\t\tif has_long_run { continue }\n\n\t\t\tfor prefix_len in (2 ..= length.as_usize () - 2).step_by (2) {\n\t\t\t\tmatch (\n\t\t\t\t\tstables [\u0026 state [ .. prefix_len]].as_ref (),\n\t\t\t\t\tstables [\u0026 state [prefix_len .. ]].as_ref (),\n\t\t\t\t) {\n\t\t\t\t\t(Some (prefix), Some (suffix))\n\t\t\t\t\t\t\tif compatible (prefix.last, \u0026 suffix.first) =\u003e {\n\t\t\t\t\t\tassert_eq! (prefix.parts.len (), 1);\n\t\t\t\t\t\tstables.insert (state.as_slice ().into (), Some (Stable {\n\t\t\t\t\t\t\tparts: prefix.parts.iter ().cloned ()\n\t\t\t\t\t\t\t\t.chain (suffix.parts.iter ().cloned ())\n\t\t\t\t\t\t\t\t.collect (),\n\t\t\t\t\t\t\tfirst: prefix.first,\n\t\t\t\t\t\t\tlast: suffix.last,\n\t\t\t\t\t\t}));\n\t\t\t\t\t\tcontinue 'STATE;\n\t\t\t\t\t},\n\t\t\t\t\t_ =\u003e continue,\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet mut sequence = Vec::new ();\n\t\t\tsequence.push (state.clone ());\n\n\t\t\tlet mut prev_state = state.clone ();\n\t\t\tlet mut first_seq: ArrayVec \u003cu8, 3\u003e = ArrayVec::new ();\n\t\t\tfirst_seq.push (state.first ().copied ().unwrap ());\n\n\t\t\tlet key = Span::from (state.as_slice ());\n\n\t\t\tfor step_idx in 0 .. iterations {\n\t\t\t\tlet next_state = logic::one_round (\u0026 prev_state);\n\t\t\t\tlet next_first = next_state.first ().copied ().unwrap ();\n\n\t\t\t\t/*\n\t\t\t\tif let Some (whatever) = stables.get (next_state.as_slice ()) {\n\t\t\t\t\ttodo! (\"CHECK FOR EXISTING {} {}\", state, next_state);\n\t\t\t\t}\n\t\t\t\t*/\n\n\t\t\t\tsequence.push (next_state.clone ());\n\n\t\t\t\tif ! first_seq.is_full () {\n\t\t\t\t\tfirst_seq.push (next_first);\n\t\t\t\t\tif [1, 2, 3].into_iter ()\n\t\t\t\t\t\t.all (|num_0| first_seq.iter ().copied ()\n\t\t\t\t\t\t\t.any (|num_1| num_0 == num_1)) {\n\t\t\t\t\t\tstables.insert (key.clone (), None);\n\t\t\t\t\t\tcontinue 'STATE;\n\t\t\t\t\t}\n\t\t\t\t} else if first_seq [(step_idx + 1) % 3] != next_first {\n\t\t\t\t\tstables.insert (key.clone (), None);\n\t\t\t\t\tcontinue 'STATE;\n\t\t\t\t}\n\n\t\t\t\tprev_state = next_state;\n\t\t\t}\n\n\t\t\tstables.insert (key.clone (), Some (Stable {\n\t\t\t\tparts: vec! [ key ],\n\t\t\t\tfirst: [ first_seq [0], first_seq [1], first_seq [2] ],\n\t\t\t\tlast: state.last ().copied ().unwrap (),\n\t\t\t}));\n\n\t\t}\n\n\t}\n\n\tstables\n\n}\n\npub trait Intern \u003cItem\u003e where Item: Eq + Hash {\n\ttype Shared;\n\tfn intern (self, item: Item) -\u003e Self::Shared;\n\tfn intern_get (self, item: \u0026 Item) -\u003e Option \u003cSelf::Shared\u003e;\n}\n\nimpl \u003cItem\u003e Intern \u003cItem\u003e for \u0026 RefCell \u003cHashSet \u003cRc \u003cItem\u003e\u003e\u003e\n\t\twhere Item: Eq + Hash + Ord {\n\ttype Shared = Rc \u003cItem\u003e;\n\tfn intern (self, item: Item) -\u003e Rc \u003cItem\u003e {\n\t\tlet mut lock = self.borrow_mut ();\n\t\tuse std::ops::DerefMut;\n\t\tlock.deref_mut ().intern (item)\n\t}\n\tfn intern_get (self, item: \u0026 Item) -\u003e Option \u003cRc \u003cItem\u003e\u003e {\n\t\tlet lock = self.borrow ();\n\t\tlock.deref ().get (item).cloned ()\n\t}\n}\n\nimpl \u003cItem\u003e Intern \u003cItem\u003e for \u0026 mut HashSet \u003cRc \u003cItem\u003e\u003e\n\t\twhere Item: Eq + Hash + Ord {\n\ttype Shared = Rc \u003cItem\u003e;\n\tfn intern (self, item: Item) -\u003e Rc \u003cItem\u003e {\n\t\tif let Some (shared) = self.get (\u0026 item) {\n\t\t\treturn Rc::clone (shared);\n\t\t}\n\t\tlet shared = Rc::new (item);\n\t\t(* self).insert (Rc::clone (\u0026 shared));\n\t\tshared\n\t}\n\tfn intern_get (self, item: \u0026 Item) -\u003e Option \u003cRc \u003cItem\u003e\u003e {\n\t\tself.get (item).cloned ()\n\t}\n}\n","traces":[{"line":48,"address":[345728],"length":1,"stats":{"Line":0},"fn_name":"fmt"},{"line":49,"address":[345890,345750],"length":1,"stats":{"Line":0},"fn_name":null},{"line":50,"address":[345883],"length":1,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[345936],"length":1,"stats":{"Line":0},"fn_name":"fmt"},{"line":56,"address":[346035,346145],"length":1,"stats":{"Line":0},"fn_name":null},{"line":57,"address":[346159],"length":1,"stats":{"Line":0},"fn_name":null},{"line":59,"address":[346135],"length":1,"stats":{"Line":0},"fn_name":null},{"line":64,"address":[346479,346416],"length":1,"stats":{"Line":0},"fn_name":"borrow"},{"line":68,"address":[346496],"length":1,"stats":{"Line":0},"fn_name":"from"},{"line":69,"address":[346510],"length":1,"stats":{"Line":0},"fn_name":null},{"line":75,"address":[346560,346892],"length":1,"stats":{"Line":0},"fn_name":"try_from"},{"line":76,"address":[346593,346806],"length":1,"stats":{"Line":0},"fn_name":null},{"line":81,"address":[346928],"length":1,"stats":{"Line":0},"fn_name":"eq"},{"line":82,"address":[346947],"length":1,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[347008],"length":1,"stats":{"Line":0},"fn_name":"partial_cmp"},{"line":88,"address":[347022],"length":1,"stats":{"Line":0},"fn_name":null},{"line":93,"address":[347056],"length":1,"stats":{"Line":0},"fn_name":"cmp"},{"line":94,"address":[347202,347131],"length":1,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[347185],"length":1,"stats":{"Line":0},"fn_name":null},{"line":101,"address":[347232,347241],"length":1,"stats":{"Line":0},"fn_name":"deref"},{"line":115,"address":[347280,347289],"length":1,"stats":{"Line":0},"fn_name":"borrow"},{"line":120,"address":[347344,347388],"length":1,"stats":{"Line":0},"fn_name":"deref"},{"line":124,"address":[347408],"length":1,"stats":{"Line":0},"fn_name":"from"},{"line":125,"address":[347415],"length":1,"stats":{"Line":0},"fn_name":null},{"line":138,"address":[347472],"length":1,"stats":{"Line":0},"fn_name":"fmt"},{"line":139,"address":[347511,347725],"length":1,"stats":{"Line":0},"fn_name":null},{"line":140,"address":[347775,347917,347866,347710],"length":1,"stats":{"Line":0},"fn_name":null},{"line":141,"address":[348162,347899,348071,348377],"length":1,"stats":{"Line":0},"fn_name":null},{"line":142,"address":[348417,348449],"length":1,"stats":{"Line":0},"fn_name":null},{"line":143,"address":[348431,348603],"length":1,"stats":{"Line":0},"fn_name":null},{"line":145,"address":[348335,348810,348900],"length":1,"stats":{"Line":0},"fn_name":null},{"line":146,"address":[349106,348932,348888],"length":1,"stats":{"Line":0},"fn_name":null},{"line":147,"address":[349120],"length":1,"stats":{"Line":0},"fn_name":null},{"line":149,"address":[349091,349370,349540],"length":1,"stats":{"Line":0},"fn_name":null},{"line":150,"address":[349527],"length":1,"stats":{"Line":0},"fn_name":null},{"line":155,"address":[349587,349568],"length":1,"stats":{"Line":0},"fn_name":"eq"},{"line":159,"address":[349616,349630],"length":1,"stats":{"Line":0},"fn_name":"eq"},{"line":165,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":166,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":171,"address":[349664],"length":1,"stats":{"Line":0},"fn_name":"partial_cmp"},{"line":172,"address":[349693],"length":1,"stats":{"Line":0},"fn_name":null},{"line":176,"address":[349760],"length":1,"stats":{"Line":0},"fn_name":"compatible"},{"line":177,"address":[349794],"length":1,"stats":{"Line":0},"fn_name":null},{"line":184,"address":[359298,350032,351508],"length":1,"stats":{"Line":0},"fn_name":"run"},{"line":186,"address":[350074],"length":1,"stats":{"Line":0},"fn_name":null},{"line":187,"address":[350214,350151],"length":1,"stats":{"Line":0},"fn_name":null},{"line":188,"address":[97551,97504],"length":1,"stats":{"Line":0},"fn_name":"{closure#8}"},{"line":189,"address":[97518,97577,97568],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":191,"address":[350569],"length":1,"stats":{"Line":0},"fn_name":null},{"line":192,"address":[350584],"length":1,"stats":{"Line":0},"fn_name":null},{"line":194,"address":[350885,350639,350721],"length":1,"stats":{"Line":0},"fn_name":null},{"line":196,"address":[93608,93584],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":198,"address":[93699,93680],"length":1,"stats":{"Line":0},"fn_name":"{closure#1}"},{"line":201,"address":[351318,351239],"length":1,"stats":{"Line":0},"fn_name":null},{"line":203,"address":[93776,93789],"length":1,"stats":{"Line":0},"fn_name":"{closure#2}"},{"line":204,"address":[351384,351447],"length":1,"stats":{"Line":0},"fn_name":null},{"line":205,"address":[93817,93808],"length":1,"stats":{"Line":0},"fn_name":"{closure#3}"},{"line":207,"address":[351526],"length":1,"stats":{"Line":0},"fn_name":null},{"line":209,"address":[351845,351540,351585],"length":1,"stats":{"Line":0},"fn_name":null},{"line":210,"address":[352200],"length":1,"stats":{"Line":0},"fn_name":null},{"line":211,"address":[351869],"length":1,"stats":{"Line":0},"fn_name":null},{"line":212,"address":[93920],"length":1,"stats":{"Line":0},"fn_name":"{closure#4}"},{"line":213,"address":[93937],"length":1,"stats":{"Line":0},"fn_name":null},{"line":216,"address":[352293],"length":1,"stats":{"Line":0},"fn_name":null},{"line":217,"address":[352345,353385],"length":1,"stats":{"Line":0},"fn_name":null},{"line":218,"address":[353927],"length":1,"stats":{"Line":0},"fn_name":null},{"line":219,"address":[353476],"length":1,"stats":{"Line":0},"fn_name":null},{"line":220,"address":[353609,353982],"length":1,"stats":{"Line":0},"fn_name":null},{"line":223,"address":[352363],"length":1,"stats":{"Line":0},"fn_name":null},{"line":224,"address":[352415,352531],"length":1,"stats":{"Line":0},"fn_name":null},{"line":225,"address":[353270],"length":1,"stats":{"Line":0},"fn_name":null},{"line":226,"address":[352667],"length":1,"stats":{"Line":0},"fn_name":null},{"line":227,"address":[353242],"length":1,"stats":{"Line":0},"fn_name":null},{"line":228,"address":[352864,353115,352800,353170,353203],"length":1,"stats":{"Line":0},"fn_name":null},{"line":229,"address":[352980,353146,353185],"length":1,"stats":{"Line":0},"fn_name":null},{"line":231,"address":[352815,353325],"length":1,"stats":{"Line":0},"fn_name":null},{"line":237,"address":[351835],"length":1,"stats":{"Line":0},"fn_name":null},{"line":238,"address":[354094,354157],"length":1,"stats":{"Line":0},"fn_name":null},{"line":239,"address":[354172],"length":1,"stats":{"Line":0},"fn_name":null},{"line":240,"address":[354195,354255],"length":1,"stats":{"Line":0},"fn_name":null},{"line":242,"address":[354278],"length":1,"stats":{"Line":0},"fn_name":null},{"line":243,"address":[354353,354293],"length":1,"stats":{"Line":0},"fn_name":null},{"line":244,"address":[354411],"length":1,"stats":{"Line":0},"fn_name":null},{"line":245,"address":[354492],"length":1,"stats":{"Line":0},"fn_name":null},{"line":247,"address":[356170,354574],"length":1,"stats":{"Line":0},"fn_name":null},{"line":248,"address":[354809],"length":1,"stats":{"Line":0},"fn_name":null},{"line":250,"address":[354896,354832],"length":1,"stats":{"Line":0},"fn_name":null},{"line":254,"address":[355032],"length":1,"stats":{"Line":0},"fn_name":null},{"line":255,"address":[355078],"length":1,"stats":{"Line":0},"fn_name":null},{"line":257,"address":[355116],"length":1,"stats":{"Line":0},"fn_name":null},{"line":258,"address":[355198],"length":1,"stats":{"Line":0},"fn_name":null},{"line":259,"address":[355280],"length":1,"stats":{"Line":0},"fn_name":null},{"line":261,"address":[355354],"length":1,"stats":{"Line":0},"fn_name":null},{"line":262,"address":[355840],"length":1,"stats":{"Line":0},"fn_name":null},{"line":263,"address":[355502],"length":1,"stats":{"Line":0},"fn_name":null},{"line":264,"address":[355627,355895],"length":1,"stats":{"Line":0},"fn_name":null},{"line":268,"address":[355436,356039],"length":1,"stats":{"Line":0},"fn_name":null},{"line":271,"address":[354755,356201],"length":1,"stats":{"Line":0},"fn_name":null},{"line":272,"address":[356298],"length":1,"stats":{"Line":0},"fn_name":null},{"line":273,"address":[356388,356307],"length":1,"stats":{"Line":0},"fn_name":null},{"line":274,"address":[356420,356718],"length":1,"stats":{"Line":0},"fn_name":null},{"line":275,"address":[356742],"length":1,"stats":{"Line":0},"fn_name":null},{"line":276,"address":[356983],"length":1,"stats":{"Line":0},"fn_name":null},{"line":277,"address":[357029],"length":1,"stats":{"Line":0},"fn_name":null},{"line":282,"address":[356708,357132],"length":1,"stats":{"Line":0},"fn_name":null},{"line":286,"address":[356402,357145],"length":1,"stats":{"Line":0},"fn_name":null},{"line":288,"address":[357335,357255],"length":1,"stats":{"Line":0},"fn_name":null},{"line":289,"address":[357435,357359],"length":1,"stats":{"Line":0},"fn_name":null},{"line":290,"address":[94142,94128],"length":1,"stats":{"Line":0},"fn_name":"{closure#5}"},{"line":291,"address":[357670],"length":1,"stats":{"Line":0},"fn_name":null},{"line":293,"address":[357995,358061],"length":1,"stats":{"Line":0},"fn_name":null},{"line":294,"address":[358068],"length":1,"stats":{"Line":0},"fn_name":null},{"line":300,"address":[358314,350867],"length":1,"stats":{"Line":0},"fn_name":null},{"line":301,"address":[94288,94302],"length":1,"stats":{"Line":0},"fn_name":"{closure#6}"},{"line":302,"address":[358710],"length":1,"stats":{"Line":0},"fn_name":null},{"line":305,"address":[358826],"length":1,"stats":{"Line":0},"fn_name":null},{"line":306,"address":[94366,94352],"length":1,"stats":{"Line":0},"fn_name":"{closure#7}"},{"line":320,"address":[359328,360293,365168],"length":1,"stats":{"Line":0},"fn_name":"find_stables"},{"line":322,"address":[359386],"length":1,"stats":{"Line":0},"fn_name":null},{"line":324,"address":[359431,359516,359670],"length":1,"stats":{"Line":0},"fn_name":null},{"line":326,"address":[94416,94440],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":328,"address":[94512,94531],"length":1,"stats":{"Line":0},"fn_name":"{closure#1}"},{"line":331,"address":[360103,360024],"length":1,"stats":{"Line":0},"fn_name":null},{"line":333,"address":[94621,94608],"length":1,"stats":{"Line":0},"fn_name":"{closure#2}"},{"line":334,"address":[360169,360232],"length":1,"stats":{"Line":0},"fn_name":null},{"line":335,"address":[94640,94649],"length":1,"stats":{"Line":0},"fn_name":"{closure#3}"},{"line":337,"address":[360311],"length":1,"stats":{"Line":0},"fn_name":null},{"line":339,"address":[360370,360630,360325],"length":1,"stats":{"Line":0},"fn_name":null},{"line":340,"address":[360982],"length":1,"stats":{"Line":0},"fn_name":null},{"line":341,"address":[360662],"length":1,"stats":{"Line":0},"fn_name":null},{"line":342,"address":[360816],"length":1,"stats":{"Line":0},"fn_name":null},{"line":344,"address":[361149,361066],"length":1,"stats":{"Line":0},"fn_name":null},{"line":345,"address":[361090],"length":1,"stats":{"Line":0},"fn_name":null},{"line":346,"address":[361197,361359],"length":1,"stats":{"Line":0},"fn_name":null},{"line":347,"address":[361418,361328,361930],"length":1,"stats":{"Line":0},"fn_name":null},{"line":348,"address":[361608,361528,361851],"length":1,"stats":{"Line":0},"fn_name":null},{"line":349,"address":[361710],"length":1,"stats":{"Line":0},"fn_name":null},{"line":351,"address":[361905],"length":1,"stats":{"Line":0},"fn_name":null},{"line":352,"address":[361927],"length":1,"stats":{"Line":0},"fn_name":null},{"line":360,"address":[360620],"length":1,"stats":{"Line":0},"fn_name":null},{"line":361,"address":[362138,362201],"length":1,"stats":{"Line":0},"fn_name":null},{"line":363,"address":[362224],"length":1,"stats":{"Line":0},"fn_name":null},{"line":364,"address":[362231,362291],"length":1,"stats":{"Line":0},"fn_name":null},{"line":365,"address":[362323,362383],"length":1,"stats":{"Line":0},"fn_name":null},{"line":367,"address":[362555],"length":1,"stats":{"Line":0},"fn_name":null},{"line":369,"address":[364233,362688,362944,362808],"length":1,"stats":{"Line":0},"fn_name":null},{"line":370,"address":[362984],"length":1,"stats":{"Line":0},"fn_name":null},{"line":371,"address":[363007,363071],"length":1,"stats":{"Line":0},"fn_name":null},{"line":379,"address":[363240],"length":1,"stats":{"Line":0},"fn_name":null},{"line":381,"address":[363278],"length":1,"stats":{"Line":0},"fn_name":null},{"line":382,"address":[363346],"length":1,"stats":{"Line":0},"fn_name":null},{"line":383,"address":[363364,363532,363440],"length":1,"stats":{"Line":0},"fn_name":null},{"line":384,"address":[94768,94851,94752],"length":1,"stats":{"Line":0},"fn_name":"{closure#4}"},{"line":385,"address":[94896,94841,94911],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":386,"address":[363604],"length":1,"stats":{"Line":0},"fn_name":null},{"line":389,"address":[363727,363313],"length":1,"stats":{"Line":0},"fn_name":null},{"line":390,"address":[363903],"length":1,"stats":{"Line":0},"fn_name":null},{"line":394,"address":[363538,364102],"length":1,"stats":{"Line":0},"fn_name":null},{"line":397,"address":[362918,364272,364888],"length":1,"stats":{"Line":0},"fn_name":null},{"line":398,"address":[364364,364306],"length":1,"stats":{"Line":0},"fn_name":null},{"line":399,"address":[364739,364485,364423],"length":1,"stats":{"Line":0},"fn_name":null},{"line":400,"address":[364770,364722],"length":1,"stats":{"Line":0},"fn_name":null},{"line":420,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":421,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":423,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":425,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":426,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":427,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":434,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":435,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":436,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":438,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":439,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":440,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":442,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":443,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":176},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-10","src","lib.rs"],"content":"//! Advent of Code 2015: Day 10: Elves Look, Elves Say\n//!\n//! [https://adventofcode.com/2015/day/10](https://adventofcode.com/2015/day/10)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Elves Look, Elves Say\";\n\tyear = 2015;\n\tday = 10;\n\tparse = |input| model::State::parse (input [0]);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n\tcommands = [\n\t\t( name = \"internals\"; method = cli::internals; ),\n\t\t( name = \"run\"; method = cli::run; ),\n\t\t( name = \"tracking\"; method = tracking::run; ),\n\t\t( name = \"cycles\"; method = cycles::run; ),\n\t];\n}\n\nmod cycles;\nmod tracking;\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::State;\n\tuse nums::IntConv;\n\n\tpub fn part_one (input: \u0026 State) -\u003e GenResult \u003cu32\u003e {\n\t\tlet input = input.clone ();\n\t\tOk (\n\t\t\titer::successors (\n\t\t\t\t\tSome (input),\n\t\t\t\t\t|state| Some (one_round (state)))\n\t\t\t\t.nth (40)\n\t\t\t\t.unwrap ()\n\t\t\t\t.len ().as_u32 ()\n\t\t)\n\t}\n\n\tpub fn part_two (input: \u0026 State) -\u003e GenResult \u003cu32\u003e {\n\t\tlet input = input.clone ();\n\t\tOk (\n\t\t\titer::successors (\n\t\t\t\t\tSome (input),\n\t\t\t\t\t|state| Some (one_round (state)))\n\t\t\t\t.nth (50)\n\t\t\t\t.unwrap ()\n\t\t\t\t.len ().as_u32 ()\n\t\t)\n\t}\n\n\t#[ must_use ]\n\tpub fn one_round (state: \u0026 State) -\u003e State {\n\t\tlet group_by =\n\t\t\tstate.iter ().copied ()\n\t\t\t\t.group_by (|\u0026 val| val);\n\t\tgroup_by.into_iter ()\n\t\t\t.flat_map (|(val, group)| [ group.count ().as_u8 (), val ])\n\t\t\t.collect ()\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse nums::IntConv;\n\n\t#[ derive (Clone, Eq, Hash, PartialEq) ]\n\tpub struct State (Vec \u003cu8\u003e);\n\n\timpl State {\n\t\tpub fn parse (input: \u0026 str) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tinput.chars ()\n\t\t\t\t.map (|ch| Ok (ch.to_digit (10).ok_or (\"Invalid input\") ?.as_u8 ()))\n\t\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e ()\n\t\t}\n\t\tpub fn iter (\u0026 self) -\u003e SliceIter \u003c'_, u8\u003e {\n\t\t\tself.0.iter ()\n\t\t}\n\t}\n\n\timpl Borrow \u003c[u8]\u003e for State {\n\t\tfn borrow (\u0026 self) -\u003e \u0026 [u8] {\n\t\t\tself.0.as_slice ()\n\t\t}\n\t}\n\n\timpl Deref for State {\n\t\ttype Target = Vec \u003cu8\u003e;\n\t\tfn deref (\u0026 self) -\u003e \u0026 Vec \u003cu8\u003e {\n\t\t\t\u0026 self.0\n\t\t}\n\t}\n\n\timpl FromIterator \u003cu8\u003e for State {\n\t\tfn from_iter \u003cIntoIter\u003e (iter: IntoIter) -\u003e Self\n\t\t\t\twhere IntoIter: IntoIterator \u003cItem = u8\u003e {\n\t\t\tSelf (iter.into_iter ().collect ())\n\t\t}\n\t}\n\n\timpl TryFrom \u003cVec \u003cu8\u003e\u003e for State {\n\t\ttype Error = GenError;\n\t\tfn try_from (nums: Vec \u003cu8\u003e) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tif nums.iter ().copied ().any (|num| (1 ..= 9).contains (\u0026 num)) {\n\t\t\t\tErr (\"Digits must be 1-9\") ?;\n\t\t\t}\n\t\t\tOk (Self (nums))\n\t\t}\n\t}\n\n\timpl Debug for State {\n\t\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\t\twrite! (formatter, \"State (len={}, {})\", self.0.len (), self) ?;\n\t\t\tOk (())\n\t\t}\n\t}\n\n\timpl Display for State {\n\t\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\t\tfor \u0026 val in self.0.iter () {\n\t\t\t\twrite! (formatter, \"{}\", char::from_digit (val.as_u32 (), 10).unwrap ()) ?;\n\t\t\t}\n\t\t\tOk (())\n\t\t}\n\t}\n\n\timpl PartialOrd for State {\n\t\tfn partial_cmp (\u0026 self, other: \u0026 Self) -\u003e Option \u003cOrdering\u003e {\n\t\t\tSome (Ord::cmp (self, other))\n\t\t}\n\t}\n\n\timpl Ord for State {\n\t\tfn cmp (\u0026 self, other: \u0026 Self) -\u003e Ordering {\n\t\t\tOrd::cmp (\u0026 self.0.len (), \u0026 other.0.len ())\n\t\t\t\t.then (Ord::cmp (\u0026 self.0, \u0026 other.0))\n\t\t}\n\t}\n\n}\n\nmod cli {\n\n\tuse super::*;\n\tuse model::State;\n\n\t#[ derive (Debug, clap::Parser) ]\n\tpub struct RunArgs {\n\n\t\t#[ clap (long, default_value = \"inputs/day-10\") ]\n\t\tinput: String,\n\n\t\t#[ clap (conflicts_with = \"input\") ]\n\t\tstate: Option \u003cString\u003e,\n\n\t\t#[ clap (long) ]\n\t\tverbose: bool,\n\n\t\t#[ clap (long, default_value = \"15\") ]\n\t\tloops: u32,\n\n\t\t#[ clap (long, default_value = \"0\") ]\n\t\tkeep_end: usize,\n\n\t\t#[ clap (long, default_value = \"0\") ]\n\t\tkeep_start: usize,\n\n\t}\n\n\t#[ allow (clippy::needless_pass_by_value) ]\n\t#[ allow (clippy::print_stdout) ]\n\tpub fn run (args: RunArgs) -\u003e GenResult \u003c()\u003e {\n\t\tlet mut state = if let Some (state) = args.state.as_ref () {\n\t\t\tState::parse (state) ?\n\t\t} else {\n\t\t\tState::parse (\n\t\t\t\tfs::read_to_string (\u0026 args.input) ?\n\t\t\t\t\t.trim ()\n\t\t\t\t\t.split ('\\n')\n\t\t\t\t\t.next ().unwrap ()\n\t\t\t) ?\n\t\t};\n\t\tfor idx in 0 .. {\n\t\t\tprintln! (\"{:2} {:4} {}\", idx, state.len (), state);\n\t\t\tif idx == args.loops { break }\n\t\t\tstate = logic::one_round (\u0026 state);\n\t\t\tif (args.keep_start \u003e 0 || args.keep_end \u003e 0)\n\t\t\t\t\t\u0026\u0026 state.len () \u003e (args.keep_start + args.keep_end) {\n\t\t\t\tstate =\n\t\t\t\t\tstate [ .. args.keep_start].iter ().copied ()\n\t\t\t\t\t\t.chain (state [state.len () - args.keep_end .. ].iter ().copied ())\n\t\t\t\t\t\t.collect ();\n\t\t\t}\n\t\t}\n\t\tOk (())\n\t}\n\n\t#[ derive (Debug, clap::Parser) ]\n\tpub struct InternalsArgs;\n\n\t#[ allow (clippy::needless_pass_by_value) ]\n\t#[ allow (clippy::print_stdout) ]\n\t#[ allow (clippy::unnecessary_wraps) ]\n\tpub fn internals (_args: InternalsArgs) -\u003e GenResult \u003c()\u003e {\n\t\tprintln! (\"Data structures:\");\n\t\tfn show_struct \u003cType\u003e () {\n\t\t\tlet name = std::any::type_name::\u003cType\u003e ();\n\t\t\tlet size = mem::size_of::\u003cType\u003e ();\n\t\t\tlet align = mem::align_of::\u003cType\u003e ();\n\t\t\tprintln! (\" - {} {} bytes (align = {})\", name, size, align);\n\t\t}\n\t\tshow_struct::\u003ctracking::Item\u003e ();\n\t\tOk (())\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\tuse model::State;\n\n\t#[ test ]\n\tfn basic () -\u003e GenResult \u003c()\u003e {\n\t\tlet mut state = State::parse (\"1\") ?;\n\t\tfor expect in [ \"11\", \"21\", \"1211\", \"111221\", \"312211\" ] {\n\t\t\tstate = logic::one_round (\u0026 state);\n\t\t\tlet expect = State::parse (expect) ?;\n\t\t\tassert_eq! (expect, state);\n\t\t}\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":13,"address":[495443,496163],"length":1,"stats":{"Line":0},"fn_name":null},{"line":14,"address":[495604],"length":1,"stats":{"Line":0},"fn_name":null},{"line":15,"address":[496324],"length":1,"stats":{"Line":0},"fn_name":null},{"line":33,"address":[469024,469392,469369],"length":1,"stats":{"Line":0},"fn_name":"part_one"},{"line":34,"address":[469049],"length":1,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[469146,469223,469303],"length":1,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[469059],"length":1,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[125877,125840],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":45,"address":[469424,469792,469769],"length":1,"stats":{"Line":0},"fn_name":"part_two"},{"line":46,"address":[469449],"length":1,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[469546,469623,469703],"length":1,"stats":{"Line":0},"fn_name":null},{"line":49,"address":[469459],"length":1,"stats":{"Line":0},"fn_name":null},{"line":50,"address":[125936,125973],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":58,"address":[469824,470026],"length":1,"stats":{"Line":1},"fn_name":"one_round"},{"line":59,"address":[469862],"length":1,"stats":{"Line":1},"fn_name":null},{"line":61,"address":[126045,126032],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":62,"address":[469928,469987],"length":1,"stats":{"Line":2},"fn_name":null},{"line":63,"address":[126064,126073],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":78,"address":[119040],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":79,"address":[119090],"length":1,"stats":{"Line":1},"fn_name":null},{"line":80,"address":[419312,419346],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":83,"address":[119168],"length":1,"stats":{"Line":1},"fn_name":"iter"},{"line":84,"address":[119177],"length":1,"stats":{"Line":1},"fn_name":null},{"line":89,"address":[119232],"length":1,"stats":{"Line":0},"fn_name":"borrow"},{"line":90,"address":[119241],"length":1,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[119280],"length":1,"stats":{"Line":0},"fn_name":"deref"},{"line":102,"address":[419648,419760,419520],"length":1,"stats":{"Line":2},"fn_name":"from_iter\u003ccore::iter::adapters::chain::Chain\u003ccore::iter::adapters::copied::Copied\u003ccore::slice::iter::Iter\u003cu8\u003e\u003e, core::iter::adapters::copied::Copied\u003ccore::slice::iter::Iter\u003cu8\u003e\u003e\u003e\u003e"},{"line":104,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":110,"address":[119803,119296],"length":1,"stats":{"Line":0},"fn_name":"try_from"},{"line":111,"address":[119326,119398],"length":1,"stats":{"Line":0},"fn_name":null},{"line":112,"address":[119641],"length":1,"stats":{"Line":0},"fn_name":null},{"line":114,"address":[119510],"length":1,"stats":{"Line":0},"fn_name":null},{"line":119,"address":[119856],"length":1,"stats":{"Line":0},"fn_name":"fmt"},{"line":120,"address":[119881,120093],"length":1,"stats":{"Line":0},"fn_name":null},{"line":121,"address":[120086],"length":1,"stats":{"Line":0},"fn_name":null},{"line":126,"address":[120144],"length":1,"stats":{"Line":0},"fn_name":"fmt"},{"line":127,"address":[120172,120308],"length":1,"stats":{"Line":0},"fn_name":null},{"line":128,"address":[120322],"length":1,"stats":{"Line":0},"fn_name":null},{"line":130,"address":[120298],"length":1,"stats":{"Line":0},"fn_name":null},{"line":135,"address":[120576],"length":1,"stats":{"Line":0},"fn_name":"partial_cmp"},{"line":136,"address":[120590],"length":1,"stats":{"Line":0},"fn_name":null},{"line":141,"address":[120624],"length":1,"stats":{"Line":0},"fn_name":"cmp"},{"line":142,"address":[120722,120648],"length":1,"stats":{"Line":0},"fn_name":null},{"line":143,"address":[120704],"length":1,"stats":{"Line":0},"fn_name":null},{"line":179,"address":[378160,379110,381152],"length":1,"stats":{"Line":0},"fn_name":"run"},{"line":180,"address":[378175,378246,379139,379345],"length":1,"stats":{"Line":0},"fn_name":null},{"line":181,"address":[379350,379200,379459,378296],"length":1,"stats":{"Line":0},"fn_name":null},{"line":184,"address":[378656,378338,378578],"length":1,"stats":{"Line":0},"fn_name":null},{"line":190,"address":[379141,379663,379551],"length":1,"stats":{"Line":0},"fn_name":null},{"line":191,"address":[379685],"length":1,"stats":{"Line":0},"fn_name":null},{"line":192,"address":[380101],"length":1,"stats":{"Line":0},"fn_name":null},{"line":193,"address":[380133],"length":1,"stats":{"Line":0},"fn_name":null},{"line":194,"address":[380497,380454,380286,381129],"length":1,"stats":{"Line":0},"fn_name":null},{"line":195,"address":[380359,380465],"length":1,"stats":{"Line":0},"fn_name":null},{"line":196,"address":[380999],"length":1,"stats":{"Line":0},"fn_name":null},{"line":197,"address":[380961,380519],"length":1,"stats":{"Line":0},"fn_name":null},{"line":198,"address":[380702],"length":1,"stats":{"Line":0},"fn_name":null},{"line":202,"address":[379633],"length":1,"stats":{"Line":0},"fn_name":null},{"line":211,"address":[381168],"length":1,"stats":{"Line":0},"fn_name":"internals"},{"line":212,"address":[381172],"length":1,"stats":{"Line":0},"fn_name":null},{"line":213,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":214,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":215,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":216,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":217,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":219,"address":[381217],"length":1,"stats":{"Line":0},"fn_name":null},{"line":220,"address":[381222],"length":1,"stats":{"Line":0},"fn_name":null},{"line":232,"address":[232048,233257,233292],"length":1,"stats":{"Line":3},"fn_name":"basic"},{"line":233,"address":[232339,232055],"length":1,"stats":{"Line":1},"fn_name":null},{"line":234,"address":[232454,233111,232181],"length":1,"stats":{"Line":2},"fn_name":null},{"line":235,"address":[232666],"length":1,"stats":{"Line":1},"fn_name":null},{"line":236,"address":[232795,232996],"length":1,"stats":{"Line":1},"fn_name":null},{"line":237,"address":[233211,233177,232919],"length":1,"stats":{"Line":2},"fn_name":null},{"line":239,"address":[233268],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":19,"coverable":74},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-10","src","tracking.rs"],"content":"use super::*;\nuse nums::IntConv;\n\n#[ derive (Debug, clap::Parser) ]\npub struct Args {\n\n\t#[ clap (required = true) ]\n\tstate: String,\n\n\t#[ clap (long, default_value = \"1000\") ]\n\tloops: u16,\n\n\t#[ clap (long, default_value = \"65536\") ]\n\tmax_length: usize,\n\n\t#[ clap (long, default_value = \"10\") ]\n\tmin_points: u16,\n\n}\n\n#[ allow (clippy::needless_pass_by_value) ]\n#[ allow (clippy::print_stdout) ]\npub fn run (args: Args) -\u003e GenResult \u003c()\u003e {\n\tlet mut states = Vec::new ();\n\tstates.push (State::parse (\u0026 args.state) ?);\n\tfor cur_gen in 0_u16 .. {\n\t\tif cur_gen == args.loops { break }\n\t\tlet cur_state = states.last ().unwrap ();\n\t\tlet next_state = {\n\t\t\tlet mut items_iter = cur_state.items.iter ().copied ().enumerate ().multipeek ();\n\t\t\tlet mut buffer = None;\n\t\t\tlet mut item_idx = 0;\n\t\t\titer::from_fn (move || {\n\t\t\t\titems_iter.reset_peek ();\n\t\t\t\tlet item_0 = items_iter.peek ().copied ();\n\t\t\t\tlet item_1 = items_iter.peek ().copied ();\n\t\t\t\t// deterine num to output\n\t\t\t\tlet num = match (buffer, item_0) {\n\t\t\t\t\t(Some (buf), _) =\u003e buf,\n\t\t\t\t\t(None, Some ((_, Item { run, .. }))) =\u003e run,\n\t\t\t\t\t(None, None) =\u003e return None,\n\t\t\t\t};\n\t\t\t\t// measure size of run\n\t\t\t\tlet (next_0, next_1) = match item_0 {\n\t\t\t\t\tSome ((_, Item { run, num, .. })) =\u003e (Some (run), Some (num)),\n\t\t\t\t\tNone =\u003e (None, None),\n\t\t\t\t};\n\t\t\t\tlet (next_2, next_3) = match item_1 {\n\t\t\t\t\tSome ((_, Item { run, num, .. })) =\u003e (Some (run), Some (num)),\n\t\t\t\t\tNone =\u003e (None, None),\n\t\t\t\t};\n\t\t\t\tlet buffer_run = buffer.iter ().count ();\n\t\t\t\tlet next_run =\n\t\t\t\t\t[next_0, next_1, next_2, next_3].into_iter ()\n\t\t\t\t\t\t.take_while (|\u0026 next| next == Some (num))\n\t\t\t\t\t\t.count ();\n\t\t\t\tlet run: u8 = (buffer_run + next_run).try_into ().unwrap ();\n\t\t\t\t//println! (\"buf={:?} next=[{:?} {:?} {:?} {:?}] num={} run={}+{}={}\", buffer, next_0, next_1, next_2, next_3, num, buffer_run, next_run, run);\n\t\t\t\t// work out gen and index\n\t\t\t\tlet (gen, idx) = if buffer.is_some () {\n\t\t\t\t\t(cur_gen + 1, item_idx)\n\t\t\t\t} else {\n\t\t\t\t\tlet (_, item_0) = item_0.unwrap ();\n\t\t\t\t\t(item_0.gen, item_0.idx)\n\t\t\t\t};\n\t\t\t\t// update state\n\t\t\t\tlet (iter_adv, buffer_new) = match next_run {\n\t\t\t\t\t0 =\u003e (0_i32, None),\n\t\t\t\t\t1 =\u003e (1_i32, Some (next_1.unwrap ())),\n\t\t\t\t\t2 =\u003e (1_i32, None),\n\t\t\t\t\t3 =\u003e (2_i32, Some (next_3.unwrap ())),\n\t\t\t\t\t_ =\u003e panic! (\"Found run of {} + {} = {}\", buffer_run, next_run, run),\n\t\t\t\t};\n\t\t\t\tfor _ in 0_i32 .. iter_adv { items_iter.next ().unwrap (); }\n\t\t\t\tbuffer = buffer_new;\n\t\t\t\titem_idx += 1;\n\t\t\t\t// produce value\n\t\t\t\tSome (Item { run, num, gen, idx })\n\t\t\t})\n\t\t}.take (args.max_length * 2 / 3).collect ();\n\t\tstates.push (next_state);\n\t}\n\t// print states\n\tfor (state_gen, state) in states.iter ().enumerate () {\n\t\tlet state_gen = state_gen.as_u16 ();\n\t\tlet mut align_iter =\n\t\t\tstates.last ().unwrap ().items.iter ().copied ()\n\t\t\t\t.map (|Item { gen, idx, .. }| (gen, idx))\n\t\t\t\t.enumerate ()\n\t\t\t\t.map (|(col, (gen, idx))| ((gen, idx), col * 3))\n\t\t\t\t.filter (|\u0026 ((gen, _), _)| gen \u003c= state_gen);\n\t\tlet (mut align_key, mut align_col) = align_iter.next ().unwrap ();\n\t\tlet mut col = 0;\n\t\tfor \u0026 Item { gen, idx, run, num } in state.items.iter () {\n\t\t\tlet item_key = (gen, idx);\n\t\t\tif item_key == align_key {\n\t\t\t\twhile col \u003c align_col { print! (\" \"); col += 1; }\n\t\t\t\tprint! (\"|\"); col += 1;\n\t\t\t\t(align_key, align_col) = align_iter.next ().unwrap_or (((0, 0), 0));\n\t\t\t}\n\t\t\t//print! (\"[{}:{}]\", gen, idx);\n\t\t\tprint! (\"{}{}\", run, num); col += 2;\n\t\t}\n\t\tprint! (\"\\n\");\n\t}\n\tOk (())\n}\n\npub struct State {\n\titems: Vec \u003cItem\u003e,\n}\n\nimpl State {\n\tpub fn parse (input: \u0026 str) -\u003e GenResult \u003cSelf\u003e {\n\t\tlet state = model::State::parse (input) ?.try_into () ?;\n\t\tOk (state)\n\t}\n}\n\nimpl FromIterator \u003cItem\u003e for State {\n\tfn from_iter \u003cIntoIter\u003e (iter: IntoIter) -\u003e Self\n\t\t\twhere IntoIter: IntoIterator \u003cItem = Item\u003e {\n\t\tSelf {\n\t\t\titems: iter.into_iter ().collect (),\n\t\t}\n\t}\n}\n\nimpl TryFrom \u003cmodel::State\u003e for State {\n\ttype Error = GenError;\n\tfn try_from (state: model::State) -\u003e GenResult \u003cSelf\u003e {\n\t\tif state.len () % 2 != 0 {\n\t\t\tErr (\"TrackingState requires an even numbers of items\") ?;\n\t\t}\n\t\tOk (Self {\n\t\t\titems: state.iter ().copied ()\n\t\t\t\t.tuples::\u003c(_, _)\u003e ()\n\t\t\t\t.enumerate ()\n\t\t\t\t.map (|(idx, (run, num))|\n\t\t\t\t\tOk (Item {\n\t\t\t\t\t\tgen: 0,\n\t\t\t\t\t\tidx: idx.try_into () ?,\n\t\t\t\t\t\trun,\n\t\t\t\t\t\tnum,\n\t\t\t\t\t}))\n\t\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e () ?,\n\t\t})\n\t}\n}\n\n#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\npub struct Item { run: u8, num: u8, gen: u16, idx: u32 }\n","traces":[{"line":23,"address":[328576,331854,329905],"length":1,"stats":{"Line":0},"fn_name":"run"},{"line":24,"address":[328591],"length":1,"stats":{"Line":0},"fn_name":null},{"line":25,"address":[328662,328746],"length":1,"stats":{"Line":0},"fn_name":null},{"line":26,"address":[329062,329235],"length":1,"stats":{"Line":0},"fn_name":null},{"line":27,"address":[329259],"length":1,"stats":{"Line":0},"fn_name":null},{"line":28,"address":[329273],"length":1,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[329880,329756],"length":1,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[329373],"length":1,"stats":{"Line":0},"fn_name":null},{"line":31,"address":[329536],"length":1,"stats":{"Line":0},"fn_name":null},{"line":32,"address":[329544],"length":1,"stats":{"Line":0},"fn_name":null},{"line":33,"address":[404014,406241,403696,406201],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":34,"address":[403746],"length":1,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[403759],"length":1,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[403801],"length":1,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[403843],"length":1,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[403962],"length":1,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[404019],"length":1,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[404008],"length":1,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[404244,404042,403983],"length":1,"stats":{"Line":0},"fn_name":null},{"line":45,"address":[404124],"length":1,"stats":{"Line":0},"fn_name":null},{"line":46,"address":[404044],"length":1,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[404316,404543],"length":1,"stats":{"Line":0},"fn_name":null},{"line":49,"address":[404415],"length":1,"stats":{"Line":0},"fn_name":null},{"line":50,"address":[404335],"length":1,"stats":{"Line":0},"fn_name":null},{"line":52,"address":[404621],"length":1,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[404690,404803],"length":1,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[404787,406256,406270],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":57,"address":[404853],"length":1,"stats":{"Line":0},"fn_name":null},{"line":60,"address":[405296,404976,405171,405139],"length":1,"stats":{"Line":0},"fn_name":null},{"line":61,"address":[405088,405141],"length":1,"stats":{"Line":0},"fn_name":null},{"line":63,"address":[405250,404999],"length":1,"stats":{"Line":0},"fn_name":null},{"line":64,"address":[405266],"length":1,"stats":{"Line":0},"fn_name":null},{"line":67,"address":[405210,405771],"length":1,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[405327],"length":1,"stats":{"Line":0},"fn_name":null},{"line":69,"address":[405390,405875],"length":1,"stats":{"Line":0},"fn_name":null},{"line":70,"address":[405424],"length":1,"stats":{"Line":0},"fn_name":null},{"line":71,"address":[405714,405487],"length":1,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[405298,405521],"length":1,"stats":{"Line":0},"fn_name":null},{"line":74,"address":[405824,406059,405945],"length":1,"stats":{"Line":0},"fn_name":null},{"line":75,"address":[406020],"length":1,"stats":{"Line":0},"fn_name":null},{"line":76,"address":[406133,406203,406029],"length":1,"stats":{"Line":0},"fn_name":null},{"line":78,"address":[406136],"length":1,"stats":{"Line":0},"fn_name":null},{"line":80,"address":[329705,329787,329895],"length":1,"stats":{"Line":0},"fn_name":null},{"line":81,"address":[329916],"length":1,"stats":{"Line":0},"fn_name":null},{"line":84,"address":[329201,329992,330235],"length":1,"stats":{"Line":0},"fn_name":null},{"line":85,"address":[330275],"length":1,"stats":{"Line":0},"fn_name":null},{"line":86,"address":[330318,330620],"length":1,"stats":{"Line":0},"fn_name":null},{"line":88,"address":[406359,406336],"length":1,"stats":{"Line":0},"fn_name":"{closure#1}"},{"line":90,"address":[406400,406421],"length":1,"stats":{"Line":0},"fn_name":"{closure#2}"},{"line":91,"address":[330612],"length":1,"stats":{"Line":0},"fn_name":null},{"line":92,"address":[330667],"length":1,"stats":{"Line":0},"fn_name":null},{"line":93,"address":[330758],"length":1,"stats":{"Line":0},"fn_name":null},{"line":94,"address":[330770,330973,331774],"length":1,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[331046],"length":1,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[331077,331575],"length":1,"stats":{"Line":0},"fn_name":null},{"line":97,"address":[331130,331190],"length":1,"stats":{"Line":0},"fn_name":null},{"line":98,"address":[331148,331323,331402],"length":1,"stats":{"Line":0},"fn_name":null},{"line":99,"address":[331435,331395],"length":1,"stats":{"Line":0},"fn_name":null},{"line":102,"address":[331600,331098,331779],"length":1,"stats":{"Line":0},"fn_name":null},{"line":104,"address":[331812,330931],"length":1,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[330205],"length":1,"stats":{"Line":0},"fn_name":null},{"line":114,"address":[331872],"length":1,"stats":{"Line":0},"fn_name":"parse"},{"line":115,"address":[332114,332318,331904],"length":1,"stats":{"Line":0},"fn_name":null},{"line":116,"address":[332230],"length":1,"stats":{"Line":0},"fn_name":null},{"line":121,"address":[406592],"length":1,"stats":{"Line":0},"fn_name":"from_iter\u003ccore::iter::adapters::take::Take\u003ccore::iter::sources::from_fn::FromFn\u003caoc_2015_day_10::tracking::run::{closure_env#0}\u003e\u003e\u003e"},{"line":124,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":131,"address":[332384,333133],"length":1,"stats":{"Line":0},"fn_name":"try_from"},{"line":132,"address":[332468,332414],"length":1,"stats":{"Line":0},"fn_name":null},{"line":133,"address":[332524],"length":1,"stats":{"Line":0},"fn_name":null},{"line":135,"address":[332952],"length":1,"stats":{"Line":0},"fn_name":null},{"line":136,"address":[333087,332504,332686],"length":1,"stats":{"Line":0},"fn_name":null},{"line":139,"address":[406723,406860,406884,406704],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":140,"address":[406825],"length":1,"stats":{"Line":0},"fn_name":null},{"line":142,"address":[406867,406753],"length":1,"stats":{"Line":0},"fn_name":null},{"line":146,"address":[333055],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":75},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-11","src","lib.rs"],"content":"//! Advent of Code 2015: Day 11: Corporate Policy\n//!\n//! [https://adventofcode.com/2015/day/11](https://adventofcode.com/2015/day/11)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Corporate Policy\";\n\tyear = 2015;\n\tday = 11;\n\tpart_one = |input| logic::part_one (input [0]);\n\tpart_two = |input| logic::part_two (input [0]);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse nums::IntConv;\n\n\tconst ALL_CHARS: \u0026 [char] = \u0026 [\n\t\t'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r',\n\t\t's', 't', 'u', 'v', 'w', 'x', 'y', 'z',\n\t];\n\n\tconst DISALLOWED_CHARS: \u0026 [char] = \u0026 [ 'i', 'l', 'o' ];\n\n\tpub fn part_one (input: \u0026 str) -\u003e GenResult \u003cString\u003e {\n\t\tlet password = next_password (input) ?;\n\t\tOk (password)\n\t}\n\n\tpub fn part_two (input: \u0026 str) -\u003e GenResult \u003cString\u003e {\n\t\tlet password_0 = next_password (input) ?;\n\t\tlet password_1 = next_password (\u0026 password_0) ?;\n\t\tOk (password_1)\n\t}\n\n\tpub fn next_password (input: \u0026 str) -\u003e GenResult \u003cString\u003e {\n\t\tlet disallowed_idxs =\n\t\t\tDISALLOWED_CHARS.iter ().copied ()\n\t\t\t\t.map (|ch| ALL_CHARS.iter ().copied ()\n\t\t\t\t\t.position (|other_ch| ch == other_ch)\n\t\t\t\t\t.unwrap ())\n\t\t\t\t.collect::\u003cVec \u003c_\u003e\u003e ();\n\t\tlet mut char_idxs: Vec \u003cusize\u003e =\n\t\t\tinput.chars ()\n\t\t\t\t.map (|ch| ALL_CHARS.iter ().copied ()\n\t\t\t\t\t.position (|valid_ch| ch == valid_ch)\n\t\t\t\t\t.ok_or_else (|| format! (\"Input contains invalid character: {}\", ch).into ()))\n\t\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e () ?;\n\t\tfn idxs_to_chars (char_idxs: \u0026 [usize]) -\u003e impl Iterator \u003cItem = char\u003e + '_ + Clone {\n\t\t\tchar_idxs.iter ().copied ().map (|idx| ALL_CHARS [idx])\n\t\t}\n\t\tif let Some (idx) =\n\t\t\tchar_idxs.iter ().copied ()\n\t\t\t\t.position (|idx| disallowed_idxs.contains (\u0026 idx)) {\n\t\t\tchar_idxs [idx] += 1;\n\t\t\tchar_idxs.iter_mut ().skip (idx + 1).for_each (|ch| * ch = 0);\n\t\t}\n\t\tlet new_password = loop {\n\t\t\tfor idx in (0 .. char_idxs.len ()).rev () {\n\t\t\t\tchar_idxs [idx] += 1;\n\t\t\t\tif char_idxs [idx] \u003c ALL_CHARS.len () \u0026\u0026 (idx \u003c char_idxs.len () - 2\n\t\t\t\t\t\t|| find_pair (idxs_to_chars (\u0026 char_idxs [ .. char_idxs.len () - 2]))\n\t\t\t\t\t\t\t.is_some ())\n\t\t\t\t\t{ break }\n\t\t\t\tif disallowed_idxs.contains (\u0026 char_idxs [idx]) { char_idxs [idx] += 1; }\n\t\t\t\tchar_idxs [idx] = 0;\n\t\t\t}\n\t\t\tif is_valid (idxs_to_chars (\u0026 char_idxs)) {\n\t\t\t\tbreak char_idxs.iter ().copied ()\n\t\t\t\t\t.map (|idx| ALL_CHARS [idx])\n\t\t\t\t\t.collect::\u003cString\u003e ();\n\t\t\t}\n\t\t};\n\t\tOk (new_password)\n\t}\n\n\tpub fn is_valid \u003cInpt\u003e (input: Inpt) -\u003e bool\n\t\t\twhere Inpt: Iterator \u003cItem = char\u003e + Clone {\n\t\tif ! input.clone ()\n\t\t\t.tuple_windows::\u003c(_, _, _)\u003e ()\n\t\t\t.any (|(a, b, c)| a.as_u32 () + 1 == b.as_u32 () \u0026\u0026 b.as_u32 () + 1 == c.as_u32 ())\n\t\t\t{ return false }\n\t\tif input.clone ()\n\t\t\t.any (|ch| DISALLOWED_CHARS.contains (\u0026 ch))\n\t\t\t{ return false }\n\t\tif input.fold ((0_u32, None, None), |(sum, last, prev), next|\n\t\t\tif last == Some (next) \u0026\u0026 prev != Some (next) {\n\t\t\t\t(sum + 1, None, Some (next))\n\t\t\t} else {\n\t\t\t\t(sum, Some (next), prev)\n\t\t\t}\n\t\t).0 \u003c 2 { return false }\n\t\ttrue\n\t}\n\n\tpub fn find_pair \u003cInpt\u003e (input: Inpt) -\u003e Option \u003c(usize, char)\u003e\n\t\t\twhere Inpt: Iterator \u003cItem = char\u003e + Clone {\n\t\tinput\n\t\t\t.tuple_windows::\u003c(_, _)\u003e ()\n\t\t\t.filter (|\u0026 (a, b)| a == b)\n\t\t\t.map (|(a, _)| a)\n\t\t\t.enumerate ()\n\t\t\t.next ()\n\t}\n\n\t#[ cfg (test) ]\n\tmod tests {\n\n\t\tuse super::*;\n\n\t\t#[ test ]\n\t\tfn is_valid () -\u003e GenResult \u003c()\u003e {\n\t\t\tassert_eq! (false, logic::is_valid (\"hijklmmn\".chars ()));\n\t\t\tassert_eq! (false, logic::is_valid (\"abbceffg\".chars ()));\n\t\t\tassert_eq! (false, logic::is_valid (\"abbcegjk\".chars ()));\n\t\t\tOk (())\n\t\t}\n\n\t\t#[ test ]\n\t\tfn next_password () -\u003e GenResult \u003c()\u003e {\n\t\t\tassert_eq! (\"abcdffaa\", logic::next_password (\"abcdefgh\") ?);\n\t\t\tassert_eq! (\"ghjaabcc\", logic::next_password (\"ghijklmn\") ?);\n\t\t\tOk (())\n\t\t}\n\n\t}\n\n}\n","traces":[{"line":9,"address":[39177,39833],"length":1,"stats":{"Line":0},"fn_name":null},{"line":13,"address":[39293,39272],"length":1,"stats":{"Line":0},"fn_name":null},{"line":14,"address":[39928,39949],"length":1,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[79680],"length":1,"stats":{"Line":0},"fn_name":"part_one"},{"line":30,"address":[79712,79909],"length":1,"stats":{"Line":0},"fn_name":null},{"line":31,"address":[79821],"length":1,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[79968,80590],"length":1,"stats":{"Line":0},"fn_name":"part_two"},{"line":35,"address":[80001,80121],"length":1,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[80501,80232,80100],"length":1,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[80389],"length":1,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[83438,83468,80624],"length":1,"stats":{"Line":1},"fn_name":"next_password"},{"line":41,"address":[80679],"length":1,"stats":{"Line":1},"fn_name":null},{"line":43,"address":[40749,40685,40672],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":44,"address":[40739,40816,40828],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":47,"address":[81154,80916,80833],"length":1,"stats":{"Line":2},"fn_name":null},{"line":49,"address":[40871,40935,40848,40985],"length":1,"stats":{"Line":4},"fn_name":"{closure#1}"},{"line":50,"address":[41020,40925,41008],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":51,"address":[41052,41040,40975],"length":1,"stats":{"Line":1},"fn_name":"{closure#1}"},{"line":53,"address":[83488],"length":1,"stats":{"Line":1},"fn_name":"idxs_to_chars"},{"line":54,"address":[41216,41235],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":56,"address":[81285,81076,81399],"length":1,"stats":{"Line":3},"fn_name":null},{"line":58,"address":[41326,41312],"length":1,"stats":{"Line":3},"fn_name":"{closure#2}"},{"line":59,"address":[81505,81577,81653],"length":1,"stats":{"Line":2},"fn_name":null},{"line":60,"address":[81701,81618],"length":1,"stats":{"Line":4},"fn_name":null},{"line":63,"address":[81539,82113,83139,81851],"length":1,"stats":{"Line":4},"fn_name":null},{"line":64,"address":[82137,82262],"length":1,"stats":{"Line":1},"fn_name":null},{"line":65,"address":[82228,82514,82801,82303],"length":1,"stats":{"Line":4},"fn_name":null},{"line":66,"address":[82487,82551],"length":1,"stats":{"Line":2},"fn_name":null},{"line":69,"address":[82829,83024],"length":1,"stats":{"Line":2},"fn_name":null},{"line":70,"address":[83132,82985],"length":1,"stats":{"Line":2},"fn_name":null},{"line":72,"address":[83160,82075],"length":1,"stats":{"Line":2},"fn_name":null},{"line":73,"address":[83211],"length":1,"stats":{"Line":1},"fn_name":null},{"line":74,"address":[41424,41443],"length":1,"stats":{"Line":2},"fn_name":"{closure#4}"},{"line":78,"address":[83356],"length":1,"stats":{"Line":1},"fn_name":null},{"line":81,"address":[41520,42357,41968,41909],"length":1,"stats":{"Line":2},"fn_name":"is_valid\u003ccore::iter::adapters::map::Map\u003ccore::iter::adapters::copied::Copied\u003ccore::slice::iter::Iter\u003cusize\u003e\u003e, aoc_2015_day_11::logic::next_password::idxs_to_chars::{closure_env#0}\u003e\u003e"},{"line":83,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":85,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":86,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":89,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":92,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":100,"address":[43728,43600],"length":1,"stats":{"Line":1},"fn_name":"find_pair\u003ccore::iter::adapters::map::Map\u003ccore::iter::adapters::copied::Copied\u003ccore::slice::iter::Iter\u003cusize\u003e\u003e, aoc_2015_day_11::logic::next_password::idxs_to_chars::{closure_env#0}\u003e\u003e"},{"line":102,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":116,"address":[60512],"length":1,"stats":{"Line":3},"fn_name":"is_valid"},{"line":117,"address":[60519,60684],"length":1,"stats":{"Line":1},"fn_name":null},{"line":118,"address":[60882,60742,60645],"length":1,"stats":{"Line":2},"fn_name":null},{"line":119,"address":[60843,60940,61076],"length":1,"stats":{"Line":2},"fn_name":null},{"line":120,"address":[61040],"length":1,"stats":{"Line":1},"fn_name":null},{"line":124,"address":[61519,61136],"length":1,"stats":{"Line":3},"fn_name":"next_password"},{"line":125,"address":[61402,61143],"length":1,"stats":{"Line":1},"fn_name":null},{"line":126,"address":[61545,61824],"length":1,"stats":{"Line":1},"fn_name":null},{"line":127,"address":[61950],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":50,"coverable":61},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-12","src","lib.rs"],"content":"//! Advent of Code 2015: Day 12: JSAbacusFramework.io\n//!\n//! [https://adventofcode.com/2015/day/12](https://adventofcode.com/2015/day/12)\n//!\n//! # Input\n//!\n//! A single line of a subset of JSON. Support for arrays, objects, integers and strings (without\n//! escapes). Only the first line is considered.\n//!\n//! # Part one\n//!\n//! Sum of all numbers in the input.\n//!\n//! # Part two\n//!\n//! Sum of all numbers in the input, excluding any objects (and all children) which directly\n//! contain the value \"red\".\n//!\n//! # Algorithm\n//!\n//! This is very simple. Data is parsed into a data structure. A recursive function calculates the\n//! result for each part.\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"JSAbacusFramework.io\";\n\tyear = 2015;\n\tday = 12;\n\tparse = |input| model::Json::parse (input [0]);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Json;\n\tuse nums::IntConv;\n\n\tpub fn part_one (input: \u0026 Json) -\u003e GenResult \u003ci32\u003e {\n\t\tlet sum = calc_sum (input);\n\t\tOk (sum)\n\t}\n\n\tpub fn part_two (input: \u0026 Json) -\u003e GenResult \u003ci32\u003e {\n\t\tlet sum = calc_sum_no_red (input);\n\t\tOk (sum)\n\t}\n\n\tfn calc_sum (value: \u0026 Json) -\u003e i32 {\n\t\tmatch * value {\n\t\t\tJson::Array (ref items) =\u003e items.iter ().map (calc_sum).sum (),\n\t\t\tJson::Object (ref items) =\u003e items.iter ().map (|\u0026 (_, ref item)| calc_sum (item)).sum (),\n\t\t\tJson::Number (ref value) =\u003e value.as_i32 (),\n\t\t\tJson::String (_) =\u003e 0_i32,\n\t\t}\n\t}\n\n\tfn calc_sum_no_red (value: \u0026 Json) -\u003e i32 {\n\t\tmatch * value {\n\t\t\tJson::Array (ref items) =\u003e items.iter ().map (calc_sum_no_red).sum (),\n\t\t\tJson::Object (ref items) =\u003e {\n\t\t\t\tif ! items.iter ().any (|\u0026 (_, ref value)|\n\t\t\t\t\tif let Json::String (ref value) = * value {\n\t\t\t\t\t\tvalue == \"red\"\n\t\t\t\t\t} else { false }\n\t\t\t\t) {\n\t\t\t\t\titems.iter ().map (|\u0026 (_, ref item)| calc_sum_no_red (item)).sum ()\n\t\t\t\t} else { 0_i32 }\n\t\t\t},\n\t\t\tJson::Number (ref value) =\u003e value.as_i32 (),\n\t\t\tJson::String (_) =\u003e 0_i32,\n\t\t}\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\n\t#[ derive (Debug) ]\n\tpub enum Json {\n\t\tArray (Vec \u003cJson\u003e),\n\t\tObject (Vec \u003c(String, Json)\u003e),\n\t\tNumber (i32),\n\t\tString (String),\n\t}\n\n\timpl Json {\n\t\tpub fn parse (input: \u0026 str) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tuse parser::*;\n\t\t\tfn parse_item (parser: \u0026 mut Parser) -\u003e ParseResult \u003cJson\u003e {\n\t\t\t\tparser.any ()\n\t\t\t\t\t.of (|parser| {\n\t\t\t\t\t\tlet mut items = Vec::new ();\n\t\t\t\t\t\tparser.skip_whitespace ().expect (\"[\") ?;\n\t\t\t\t\t\tif parser.skip_whitespace ().peek () == Some (']') {\n\t\t\t\t\t\t\tparser.next ();\n\t\t\t\t\t\t\treturn Ok (Json::Array (items));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tloop {\n\t\t\t\t\t\t\titems.push (parse_item (parser) ?);\n\t\t\t\t\t\t\tmatch parser.skip_whitespace ().next () {\n\t\t\t\t\t\t\t\tSome (',') =\u003e continue,\n\t\t\t\t\t\t\t\tSome (']') =\u003e break,\n\t\t\t\t\t\t\t\t_ =\u003e Err (parser.err ()) ?,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tOk (Json::Array (items))\n\t\t\t\t\t})\n\t\t\t\t\t.of (|parser| {\n\t\t\t\t\t\tlet mut items = Vec::new ();\n\t\t\t\t\t\tparser.skip_whitespace ().expect (\"{\") ?;\n\t\t\t\t\t\tif parser.skip_whitespace ().peek () == Some ('}') {\n\t\t\t\t\t\t\tparser.next ();\n\t\t\t\t\t\t\treturn Ok (Json::Object (items));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tloop {\n\t\t\t\t\t\t\tlet name = parse_string (parser) ?;\n\t\t\t\t\t\t\tparser.skip_whitespace ().expect (\":\") ?;\n\t\t\t\t\t\t\tlet value = parse_item (parser) ?;\n\t\t\t\t\t\t\titems.push ((name, value));\n\t\t\t\t\t\t\tmatch parser.skip_whitespace ().next () {\n\t\t\t\t\t\t\t\tSome (',') =\u003e continue,\n\t\t\t\t\t\t\t\tSome ('}') =\u003e break,\n\t\t\t\t\t\t\t\t_ =\u003e Err (parser.err ()) ?,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tOk (Json::Object (items))\n\t\t\t\t\t})\n\t\t\t\t\t.of (|parser| {\n\t\t\t\t\t\tlet value = parser.skip_whitespace ().int () ?;\n\t\t\t\t\t\tOk (Json::Number (value))\n\t\t\t\t\t})\n\t\t\t\t\t.of (|parser| {\n\t\t\t\t\t\tlet value = parse_string (parser) ?;\n\t\t\t\t\t\tOk (Json::String (value))\n\t\t\t\t\t})\n\t\t\t\t\t.done ()\n\t\t\t}\n\t\t\tfn parse_string (parser: \u0026 mut Parser) -\u003e ParseResult \u003cString\u003e {\n\t\t\t\tparser.skip_whitespace ().expect (\"\\\"\") ?;\n\t\t\t\tlet mut value = String::new ();\n\t\t\t\tloop {\n\t\t\t\t\tmatch parser.next () {\n\t\t\t\t\t\tSome ('\\\\') =\u003e Err (parser.err ()) ?,\n\t\t\t\t\t\tSome ('\"') =\u003e break,\n\t\t\t\t\t\tSome (ch) =\u003e value.push (ch),\n\t\t\t\t\t\tNone =\u003e Err (parser.err ()) ?,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tOk (value)\n\t\t\t}\n\t\t\tParser::wrap (input, |parser| {\n\t\t\t\tlet item = parse_item (parser) ?;\n\t\t\t\tparser.skip_whitespace ().end () ?;\n\t\t\t\tOk (item)\n\t\t\t}).map_parse_err (|char_idx| format! (\"Invalid input: col {}\", char_idx + 1))\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"6\", puzzle.part_one (\u0026 [\"[1,2,3]\"]));\n\t\tassert_eq_ok! (\"6\", puzzle.part_one (\u0026 [\"{\\\"a\\\":2,\\\"b\\\":4}\"]));\n\t\tassert_eq_ok! (\"3\", puzzle.part_one (\u0026 [\"[[[3]]]\"]));\n\t\tassert_eq_ok! (\"3\", puzzle.part_one (\u0026 [\"{\\\"a\\\":{\\\"b\\\":4},\\\"c\\\":-1}\"]));\n\t\tassert_eq_ok! (\"0\", puzzle.part_one (\u0026 [\"{\\\"a\\\":[-1,1]}\"]));\n\t\tassert_eq_ok! (\"0\", puzzle.part_one (\u0026 [\"[-1,{\\\"a\\\":1}]\"]));\n\t\tassert_eq_ok! (\"0\", puzzle.part_one (\u0026 [\"[]\"]));\n\t\tassert_eq_ok! (\"0\", puzzle.part_one (\u0026 [\"{}\"]));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"6\", puzzle.part_two (\u0026 [\"[1,2,3]\"]));\n\t\tassert_eq_ok! (\"4\", puzzle.part_two (\u0026 [\"[1,{\\\"c\\\":\\\"red\\\",\\\"b\\\":2},3]\"]));\n\t\tassert_eq_ok! (\"0\", puzzle.part_two (\u0026 [\"{\\\"d\\\":\\\"red\\\",\\\"e\\\":[1,2,3,4],\\\"f\\\":5}\"]));\n\t\tassert_eq_ok! (\"6\", puzzle.part_two (\u0026 [\"[1,\\\"red\\\",5]\"]));\n\t}\n\n}\n","traces":[{"line":32,"address":[38435,39155],"length":1,"stats":{"Line":2},"fn_name":null},{"line":33,"address":[38596],"length":1,"stats":{"Line":1},"fn_name":null},{"line":34,"address":[39316],"length":1,"stats":{"Line":1},"fn_name":null},{"line":43,"address":[42656],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":44,"address":[42688],"length":1,"stats":{"Line":1},"fn_name":null},{"line":45,"address":[42715],"length":1,"stats":{"Line":1},"fn_name":null},{"line":48,"address":[42736],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":49,"address":[42768],"length":1,"stats":{"Line":1},"fn_name":null},{"line":50,"address":[42795],"length":1,"stats":{"Line":1},"fn_name":null},{"line":53,"address":[42816],"length":1,"stats":{"Line":1},"fn_name":"calc_sum"},{"line":54,"address":[42833],"length":1,"stats":{"Line":1},"fn_name":null},{"line":55,"address":[42868,43070],"length":1,"stats":{"Line":2},"fn_name":null},{"line":56,"address":[34992,35017],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":57,"address":[42939],"length":1,"stats":{"Line":1},"fn_name":null},{"line":58,"address":[42969],"length":1,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[43136],"length":1,"stats":{"Line":1},"fn_name":"calc_sum_no_red"},{"line":63,"address":[43159],"length":1,"stats":{"Line":1},"fn_name":null},{"line":64,"address":[43203,43522],"length":1,"stats":{"Line":2},"fn_name":null},{"line":65,"address":[43243],"length":1,"stats":{"Line":1},"fn_name":null},{"line":66,"address":[35070,35140,35056],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":67,"address":[35087],"length":1,"stats":{"Line":1},"fn_name":null},{"line":68,"address":[35110],"length":1,"stats":{"Line":1},"fn_name":null},{"line":69,"address":[35135],"length":1,"stats":{"Line":0},"fn_name":null},{"line":71,"address":[35168,35193],"length":1,"stats":{"Line":0},"fn_name":"{closure#1}"},{"line":72,"address":[43402],"length":1,"stats":{"Line":1},"fn_name":null},{"line":74,"address":[43285],"length":1,"stats":{"Line":1},"fn_name":null},{"line":75,"address":[43318],"length":1,"stats":{"Line":1},"fn_name":null},{"line":94,"address":[35408],"length":1,"stats":{"Line":2},"fn_name":"parse"},{"line":96,"address":[35472],"length":1,"stats":{"Line":2},"fn_name":"parse_item"},{"line":97,"address":[35497],"length":1,"stats":{"Line":2},"fn_name":null},{"line":98,"address":[26601,26567,26349,25168,26620],"length":1,"stats":{"Line":8},"fn_name":"{closure#0}"},{"line":99,"address":[25206],"length":1,"stats":{"Line":2},"fn_name":null},{"line":100,"address":[25291,25392,25237],"length":1,"stats":{"Line":6},"fn_name":null},{"line":101,"address":[25372,25525],"length":1,"stats":{"Line":4},"fn_name":null},{"line":102,"address":[25615],"length":1,"stats":{"Line":1},"fn_name":null},{"line":103,"address":[25627],"length":1,"stats":{"Line":1},"fn_name":null},{"line":105,"address":[26439],"length":1,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[25809,25600],"length":1,"stats":{"Line":4},"fn_name":null},{"line":107,"address":[26047],"length":1,"stats":{"Line":2},"fn_name":null},{"line":110,"address":[26449,26165,26354],"length":1,"stats":{"Line":0},"fn_name":null},{"line":113,"address":[26180],"length":1,"stats":{"Line":2},"fn_name":null},{"line":115,"address":[28981,26640,28906,28939,28638,28962],"length":1,"stats":{"Line":7},"fn_name":"{closure#1}"},{"line":116,"address":[26678],"length":1,"stats":{"Line":2},"fn_name":null},{"line":117,"address":[26725,26880,26779],"length":1,"stats":{"Line":6},"fn_name":null},{"line":118,"address":[26860,27013],"length":1,"stats":{"Line":4},"fn_name":null},{"line":119,"address":[27103],"length":1,"stats":{"Line":1},"fn_name":null},{"line":120,"address":[27115],"length":1,"stats":{"Line":1},"fn_name":null},{"line":122,"address":[28744],"length":1,"stats":{"Line":0},"fn_name":null},{"line":123,"address":[27297,27088,27420],"length":1,"stats":{"Line":4},"fn_name":null},{"line":124,"address":[27400,27707,27594],"length":1,"stats":{"Line":4},"fn_name":null},{"line":125,"address":[27692,28133,27860],"length":1,"stats":{"Line":3},"fn_name":null},{"line":126,"address":[27961],"length":1,"stats":{"Line":1},"fn_name":null},{"line":127,"address":[28305],"length":1,"stats":{"Line":1},"fn_name":null},{"line":130,"address":[28643,28754,28417],"length":1,"stats":{"Line":0},"fn_name":null},{"line":133,"address":[28469],"length":1,"stats":{"Line":1},"fn_name":null},{"line":135,"address":[29277,29187,28992],"length":1,"stats":{"Line":5},"fn_name":"{closure#2}"},{"line":136,"address":[29194,29036],"length":1,"stats":{"Line":3},"fn_name":null},{"line":137,"address":[29114],"length":1,"stats":{"Line":2},"fn_name":null},{"line":139,"address":[29730,29296,29622],"length":1,"stats":{"Line":2},"fn_name":"{closure#3}"},{"line":140,"address":[29342,29629],"length":1,"stats":{"Line":1},"fn_name":null},{"line":141,"address":[29469],"length":1,"stats":{"Line":1},"fn_name":null},{"line":145,"address":[36603,35616],"length":1,"stats":{"Line":2},"fn_name":"parse_string"},{"line":146,"address":[35654,35755],"length":1,"stats":{"Line":2},"fn_name":null},{"line":147,"address":[35735],"length":1,"stats":{"Line":2},"fn_name":null},{"line":149,"address":[35923,35979,35864],"length":1,"stats":{"Line":6},"fn_name":null},{"line":150,"address":[36048,36161],"length":1,"stats":{"Line":0},"fn_name":null},{"line":152,"address":[36156,36006],"length":1,"stats":{"Line":4},"fn_name":null},{"line":153,"address":[36390,35969],"length":1,"stats":{"Line":0},"fn_name":null},{"line":156,"address":[36060],"length":1,"stats":{"Line":2},"fn_name":null},{"line":158,"address":[30404,30266,29760,30037],"length":1,"stats":{"Line":8},"fn_name":"{closure#0}"},{"line":159,"address":[29806,29923],"length":1,"stats":{"Line":2},"fn_name":null},{"line":160,"address":[30094,30276,29904],"length":1,"stats":{"Line":4},"fn_name":null},{"line":161,"address":[30159],"length":1,"stats":{"Line":2},"fn_name":null},{"line":162,"address":[30462,30050,30432,30389],"length":1,"stats":{"Line":0},"fn_name":"{closure#1}"},{"line":174,"address":[50173,45392,46084],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":175,"address":[45399],"length":1,"stats":{"Line":1},"fn_name":null},{"line":176,"address":[45568,45643,45484],"length":1,"stats":{"Line":3},"fn_name":null},{"line":177,"address":[46095,46217],"length":1,"stats":{"Line":2},"fn_name":null},{"line":178,"address":[46781,46659],"length":1,"stats":{"Line":2},"fn_name":null},{"line":179,"address":[47223,47345],"length":1,"stats":{"Line":2},"fn_name":null},{"line":180,"address":[47787,47909],"length":1,"stats":{"Line":2},"fn_name":null},{"line":181,"address":[48473,48351],"length":1,"stats":{"Line":2},"fn_name":null},{"line":182,"address":[49013,48897],"length":1,"stats":{"Line":2},"fn_name":null},{"line":183,"address":[49422,49538],"length":1,"stats":{"Line":2},"fn_name":null},{"line":187,"address":[50868,50208,52594],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":188,"address":[50215],"length":1,"stats":{"Line":1},"fn_name":null},{"line":189,"address":[50268,50352,50427],"length":1,"stats":{"Line":3},"fn_name":null},{"line":190,"address":[50879,51001],"length":1,"stats":{"Line":2},"fn_name":null},{"line":191,"address":[51541,51425],"length":1,"stats":{"Line":2},"fn_name":null},{"line":192,"address":[52066,51950],"length":1,"stats":{"Line":2},"fn_name":null}],"covered":80,"coverable":90},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-13","src","lib.rs"],"content":"//! Advent of Code 2015: Day 13: Knights of the Dinner Table\n//!\n//! [https://adventofcode.com/2015/day/13](https://adventofcode.com/2015/day/13)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Knights of the Dinner Table\";\n\tyear = 2015;\n\tday = 13;\n\tparse = |input| model::parse_input (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003ci32\u003e {\n\t\tlet best = calc_best (input) ?;\n\t\tOk (best)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003ci32\u003e {\n\t\tlet my_scores =\n\t\t\tinput.iter ()\n\t\t\t\t.map (|\u0026 (ref name, _, _)| name)\n\t\t\t\t.sorted ()\n\t\t\t\t.dedup ()\n\t\t\t\t.flat_map (|name| [\n\t\t\t\t\t(Rc::from (\"Myself\"), Rc::clone (name), 0_i32),\n\t\t\t\t\t(Rc::clone (name), Rc::from (\"Myself\"), 0_i32),\n\t\t\t\t])\n\t\t\t\t.collect::\u003cVec \u003c_\u003e\u003e ();\n\t\tlet input: Vec \u003c_\u003e =\n\t\t\tinput.iter ().cloned ()\n\t\t\t\t.chain (my_scores)\n\t\t\t\t.collect ();\n\t\tlet best = calc_best (\u0026 input) ?;\n\t\tOk (best)\n\t}\n\n\tpub fn calc_best (input: \u0026 Input) -\u003e GenResult \u003ci32\u003e {\n\t\tlet names: Vec \u003c_\u003e =\n\t\t\tinput.iter ()\n\t\t\t\t.map (|\u0026 (ref name, _, _)| name)\n\t\t\t\t.sorted ()\n\t\t\t\t.dedup ()\n\t\t\t\t.map (Rc::clone)\n\t\t\t\t.collect ();\n\t\tlet scores =\n\t\t\tinput.iter ().cloned ()\n\t\t\t\t.chain (names.iter ()\n\t\t\t\t\t.map (|name| (Rc::clone (name), Rc::clone (name), 0_i32)))\n\t\t\t\t.sorted ()\n\t\t\t\t.map (|(_, _, score)| score)\n\t\t\t\t.collect::\u003cVec \u003c_\u003e\u003e ();\n\t\tif scores.len () != names.len () * names.len () {\n\t\t\tErr (\"Missing scores for some combinations of names\") ?;\n\t\t}\n\t\tOk ((0 .. names.len ())\n\t\t\t.permutations (names.len ())\n\t\t\t.map (|plan| plan.iter ()\n\t\t\t\t.circular_tuple_windows::\u003c(_, _)\u003e ()\n\t\t\t\t.map (|indexes| {\n\t\t\t\t\tlet score_0 = scores [indexes.0 * names.len () + indexes.1];\n\t\t\t\t\tlet score_1 = scores [indexes.1 * names.len () + indexes.0];\n\t\t\t\t\tscore_0 + score_1\n\t\t\t\t})\n\t\t\t\t.sum ())\n\t\t\t.max ()\n\t\t\t.unwrap ())\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\n\tpub type Item = (Rc \u003cstr\u003e, Rc \u003cstr\u003e, i32);\n\tpub type Input = Vec \u003cItem\u003e;\n\n\tpub fn parse_input (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cInput\u003e {\n\t\tuse parser::*;\n\t\tinput.iter ().enumerate ().map (|(line_idx, line)|\n\t\t\tParser::wrap (line, |parser| {\n\t\t\t\tparser\n\t\t\t\t\t.set_word_pred (char::is_alphabetic)\n\t\t\t\t\t.set_ignore_whitespace (true);\n\t\t\t\tlet name_0 = parser.word () ?;\n\t\t\t\tlet verb = parser.expect_word (\"would\") ?.word () ?;\n\t\t\t\tlet amount: i32 = parser.int () ?;\n\t\t\t\tlet amount = match verb {\n\t\t\t\t\t\"gain\" =\u003e amount,\n\t\t\t\t\t\"lose\" =\u003e - amount,\n\t\t\t\t\t_ =\u003e Err (parser.err ()) ?,\n\t\t\t\t};\n\t\t\t\tlet name_1 = parser.expect (\"happiness units by sitting next to \") ?.word () ?;\n\t\t\t\tparser.expect (\".\") ?.end () ?;\n\t\t\t\tOk ((name_0.into (), name_1.into (), amount))\n\t\t\t}).map_parse_err (|char_idx|\n\t\t\t\tformat! (\"Invalid input: line {}: col {}: {}\", line_idx + 1, char_idx + 1, line)\n\t\t\t)\n\t\t).collect ()\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"Alice would gain 54 happiness units by sitting next to Bob.\",\n\t\t\"Alice would lose 79 happiness units by sitting next to Carol.\",\n\t\t\"Alice would lose 2 happiness units by sitting next to David.\",\n\t\t\"Bob would gain 83 happiness units by sitting next to Alice.\",\n\t\t\"Bob would lose 7 happiness units by sitting next to Carol.\",\n\t\t\"Bob would lose 63 happiness units by sitting next to David.\",\n\t\t\"Carol would lose 62 happiness units by sitting next to Alice.\",\n\t\t\"Carol would gain 60 happiness units by sitting next to Bob.\",\n\t\t\"Carol would gain 55 happiness units by sitting next to David.\",\n\t\t\"David would gain 46 happiness units by sitting next to Alice.\",\n\t\t\"David would lose 7 happiness units by sitting next to Bob.\",\n\t\t\"David would gain 41 happiness units by sitting next to Carol.\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"330\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"286\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":13,"address":[121827,122515],"length":1,"stats":{"Line":2},"fn_name":null},{"line":14,"address":[121933],"length":1,"stats":{"Line":1},"fn_name":null},{"line":15,"address":[122621],"length":1,"stats":{"Line":1},"fn_name":null},{"line":23,"address":[112960],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":24,"address":[113052,112979],"length":1,"stats":{"Line":1},"fn_name":null},{"line":25,"address":[113036],"length":1,"stats":{"Line":1},"fn_name":null},{"line":28,"address":[113104,113811,113769],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":29,"address":[113142],"length":1,"stats":{"Line":1},"fn_name":null},{"line":31,"address":[88912,88896],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":34,"address":[89119,89343,88928],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":35,"address":[88966],"length":1,"stats":{"Line":1},"fn_name":null},{"line":36,"address":[89189,89102],"length":1,"stats":{"Line":2},"fn_name":null},{"line":39,"address":[113382,113492,113314],"length":1,"stats":{"Line":3},"fn_name":null},{"line":41,"address":[113436],"length":1,"stats":{"Line":1},"fn_name":null},{"line":43,"address":[113601,113538,113681],"length":1,"stats":{"Line":2},"fn_name":null},{"line":44,"address":[113652],"length":1,"stats":{"Line":1},"fn_name":null},{"line":47,"address":[115110,115139,113856],"length":1,"stats":{"Line":1},"fn_name":"calc_best"},{"line":48,"address":[113906],"length":1,"stats":{"Line":1},"fn_name":null},{"line":50,"address":[89424,89408],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":55,"address":[114180,114387,114101],"length":1,"stats":{"Line":3},"fn_name":null},{"line":57,"address":[114276],"length":1,"stats":{"Line":1},"fn_name":null},{"line":58,"address":[89477,89440],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":60,"address":[89654,89632],"length":1,"stats":{"Line":2},"fn_name":"{closure#2}"},{"line":62,"address":[114471,114531],"length":1,"stats":{"Line":2},"fn_name":null},{"line":63,"address":[114660],"length":1,"stats":{"Line":0},"fn_name":null},{"line":65,"address":[114982,114919,114645,114874],"length":1,"stats":{"Line":4},"fn_name":null},{"line":66,"address":[114902],"length":1,"stats":{"Line":1},"fn_name":null},{"line":67,"address":[89929,89680,89864,89790,89718],"length":1,"stats":{"Line":5},"fn_name":"{closure#3}"},{"line":69,"address":[90247,89841,89968],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":70,"address":[90011],"length":1,"stats":{"Line":1},"fn_name":null},{"line":71,"address":[90123],"length":1,"stats":{"Line":1},"fn_name":null},{"line":72,"address":[90230,90255],"length":1,"stats":{"Line":1},"fn_name":null},{"line":74,"address":[89921,89744],"length":1,"stats":{"Line":1},"fn_name":null},{"line":88,"address":[88384],"length":1,"stats":{"Line":1},"fn_name":"parse_input"},{"line":90,"address":[88434],"length":1,"stats":{"Line":4},"fn_name":null},{"line":91,"address":[148116,150648,148507,148160,148070],"length":1,"stats":{"Line":5},"fn_name":"{closure#0}"},{"line":92,"address":[148206],"length":1,"stats":{"Line":1},"fn_name":null},{"line":95,"address":[148243,148387],"length":1,"stats":{"Line":1},"fn_name":null},{"line":96,"address":[148515,148352,148713,148837],"length":1,"stats":{"Line":3},"fn_name":null},{"line":97,"address":[148958,149060,148817],"length":1,"stats":{"Line":2},"fn_name":null},{"line":99,"address":[149228,149032,149185],"length":1,"stats":{"Line":3},"fn_name":null},{"line":100,"address":[149304,149274,149201],"length":1,"stats":{"Line":3},"fn_name":null},{"line":101,"address":[149363,149285],"length":1,"stats":{"Line":0},"fn_name":null},{"line":103,"address":[149240,149613,149811,149947],"length":1,"stats":{"Line":3},"fn_name":null},{"line":104,"address":[150351,150265,149915,150068],"length":1,"stats":{"Line":3},"fn_name":null},{"line":105,"address":[150482,150323],"length":1,"stats":{"Line":2},"fn_name":null},{"line":106,"address":[150688,151069,148096],"length":1,"stats":{"Line":1},"fn_name":"{closure#1}"},{"line":107,"address":[150731],"length":1,"stats":{"Line":0},"fn_name":null},{"line":135,"address":[87299,86736,87345],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":136,"address":[86743],"length":1,"stats":{"Line":1},"fn_name":null},{"line":137,"address":[86766,86840,86906],"length":1,"stats":{"Line":3},"fn_name":null},{"line":141,"address":[87985,87376,87939],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":142,"address":[87383],"length":1,"stats":{"Line":1},"fn_name":null},{"line":143,"address":[87406,87480,87546],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":51,"coverable":54},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-14","src","lib.rs"],"content":"//! Advent of Code 2015: Day 14: Reindeer Olympics\n//!\n//! [https://adventofcode.com/2015/day/14](https://adventofcode.com/2015/day/14)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Reindeer Olympics\";\n\tyear = 2015;\n\tday = 14;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\tuse model::Reindeer;\n\tuse nums::IntConv;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cu64\u003e {\n\t\tlet max_dist =\n\t\t\tinput.deers.iter ()\n\t\t\t\t.map (|deer| calc_distance (deer, input.race_time))\n\t\t\t\t.max ()\n\t\t\t\t.unwrap_or (0);\n\t\tOk (max_dist)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cu64\u003e {\n\t\tlet mut iters = input.deers.iter ().map (iter_distance).collect::\u003cVec \u003c_\u003e\u003e ();\n\t\tlet mut dists = iter::repeat (0).take (input.deers.len ()).collect::\u003cVec \u003c_\u003e\u003e ();\n\t\tlet mut scores = iter::repeat (0).take (input.deers.len ()).collect::\u003cVec \u003c_\u003e\u003e ();\n\t\tfor _ in 0 .. input.race_time {\n\t\t\tdists.clear ();\n\t\t\tdists.extend (iters.iter_mut ().map (|iter| iter.next ().unwrap ()));\n\t\t\tlet (idx, _) =\n\t\t\t\tdists.iter ().copied ()\n\t\t\t\t\t.enumerate ()\n\t\t\t\t\t.max_by_key (|\u0026 (_, dist)| dist)\n\t\t\t\t\t.unwrap ();\n\t\t\tscores [idx] += 1;\n\t\t}\n\t\tlet best_score = scores.iter ().copied ().max ().unwrap ();\n\t\tOk (best_score)\n\t}\n\n\tpub fn iter_distance (deer: \u0026 Reindeer) -\u003e impl Iterator \u003cItem = u64\u003e + '_ {\n\t\tlet mut flying = false;\n\t\tlet mut time = 0;\n\t\tlet mut dist = 0_u64;\n\t\titer::from_fn (move || {\n\t\t\tif time == 0 {\n\t\t\t\tif flying {\n\t\t\t\t\ttime = deer.rest_time;\n\t\t\t\t\tflying = false;\n\t\t\t\t} else {\n\t\t\t\t\ttime = deer.fly_time;\n\t\t\t\t\tflying = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\ttime -= 1;\n\t\t\tif flying { dist += deer.fly_speed.as_u64 (); }\n\t\t\tSome (dist)\n\t\t})\n\t}\n\n\t#[ must_use ]\n\tpub fn calc_distance (deer: \u0026 Reindeer, time: u32) -\u003e u64 {\n\t\titer_distance (deer).nth (time.as_usize ()).unwrap ()\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse parser::*;\n\n\tpub struct Input {\n\t\tpub deers: Vec \u003cReindeer\u003e,\n\t\tpub race_time: u32,\n\t}\n\n\tpub struct Reindeer {\n\t\tpub name: String,\n\t\tpub fly_speed: u32,\n\t\tpub fly_time: u32,\n\t\tpub rest_time: u32,\n\t}\n\n\timpl Input {\n\t\tpub fn parse (mut input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet race_time = if let Some (race_time) = input [0].strip_prefix (\"RACE_TIME=\") {\n\t\t\t\tinput = \u0026 input [ 1 .. ];\n\t\t\t\trace_time.parse () ?\n\t\t\t} else { 2503 };\n\t\t\tif race_time \u003c 1 { Err (\"Race time must be at least 1\") ?; }\n\t\t\tlet deers: Vec \u003c_\u003e =\n\t\t\t\tinput.iter ()\n\t\t\t\t\t.enumerate ()\n\t\t\t\t\t.map (|(line_idx, line)|\n\t\t\t\t\t\tParser::wrap (line, |parser| {\n\t\t\t\t\t\t\tlet name = parser.word () ?.to_owned ();\n\t\t\t\t\t\t\tlet fly_speed = parser.expect (\" can fly \") ?.int () ?;\n\t\t\t\t\t\t\tif fly_speed \u003c 1 { Err (\"Fly speed must be at least 1\") ?; }\n\t\t\t\t\t\t\tlet fly_time = parser.expect (\" km/s for \") ?.int () ?;\n\t\t\t\t\t\t\tif fly_time \u003c 1 { Err (\"Fly time must be at least 1\") ?; }\n\t\t\t\t\t\t\tlet rest_time = parser.expect (\" seconds, but then must rest for \") ?\n\t\t\t\t\t\t\t\t.int () ?;\n\t\t\t\t\t\t\tif rest_time \u003c 1 { Err (\"Rest time must be at least 1\") ?; }\n\t\t\t\t\t\t\tparser.expect (\" seconds.\") ?.end () ?;\n\t\t\t\t\t\t\tOk (Reindeer { name, fly_speed, fly_time, rest_time })\n\t\t\t\t\t\t}).map_parse_err (|char_idx|\n\t\t\t\t\t\t\tformat! (\"Invalid input: line {}: col {}: {}\",\n\t\t\t\t\t\t\t\tline_idx + 1, char_idx + 1, line)))\n\t\t\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e () ?;\n\t\t\tif deers.is_empty () { Err (\"Must have at least one deer\") ?; }\n\t\t\tOk (Self { deers, race_time })\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"RACE_TIME=1000\",\n\t\t\"Comet can fly 14 km/s for 10 seconds, but then must rest for 127 seconds.\",\n\t\t\"Dancer can fly 16 km/s for 11 seconds, but then must rest for 162 seconds.\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"1120\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"689\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":13,"address":[59539,60243],"length":1,"stats":{"Line":2},"fn_name":null},{"line":14,"address":[59645],"length":1,"stats":{"Line":1},"fn_name":null},{"line":15,"address":[60349],"length":1,"stats":{"Line":1},"fn_name":null},{"line":25,"address":[24912],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":26,"address":[25007,24947],"length":1,"stats":{"Line":2},"fn_name":null},{"line":28,"address":[25002],"length":1,"stats":{"Line":3},"fn_name":null},{"line":31,"address":[25089],"length":1,"stats":{"Line":1},"fn_name":null},{"line":34,"address":[26516,26471,25120],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":35,"address":[25170],"length":1,"stats":{"Line":1},"fn_name":null},{"line":36,"address":[25298,25361],"length":1,"stats":{"Line":2},"fn_name":null},{"line":37,"address":[25517,25450],"length":1,"stats":{"Line":2},"fn_name":null},{"line":38,"address":[25724,25610,26255],"length":1,"stats":{"Line":3},"fn_name":null},{"line":39,"address":[25859],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[25874],"length":1,"stats":{"Line":3},"fn_name":null},{"line":41,"address":[26183],"length":1,"stats":{"Line":1},"fn_name":null},{"line":44,"address":[88317,88304],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":46,"address":[26191,26260],"length":1,"stats":{"Line":1},"fn_name":null},{"line":48,"address":[26308,25813],"length":1,"stats":{"Line":2},"fn_name":null},{"line":49,"address":[26441],"length":1,"stats":{"Line":1},"fn_name":null},{"line":52,"address":[26560],"length":1,"stats":{"Line":1},"fn_name":"iter_distance"},{"line":53,"address":[26576],"length":1,"stats":{"Line":1},"fn_name":null},{"line":54,"address":[26581],"length":1,"stats":{"Line":1},"fn_name":null},{"line":55,"address":[26589],"length":1,"stats":{"Line":1},"fn_name":null},{"line":56,"address":[26598],"length":1,"stats":{"Line":4},"fn_name":null},{"line":57,"address":[88350],"length":1,"stats":{"Line":1},"fn_name":null},{"line":58,"address":[88431,88411,88361],"length":1,"stats":{"Line":3},"fn_name":null},{"line":59,"address":[88418],"length":1,"stats":{"Line":1},"fn_name":null},{"line":60,"address":[88427],"length":1,"stats":{"Line":1},"fn_name":null},{"line":62,"address":[88398],"length":1,"stats":{"Line":1},"fn_name":null},{"line":63,"address":[88407],"length":1,"stats":{"Line":1},"fn_name":null},{"line":66,"address":[88442,88374,88453],"length":1,"stats":{"Line":2},"fn_name":null},{"line":67,"address":[88445,88526],"length":1,"stats":{"Line":3},"fn_name":null},{"line":68,"address":[88488],"length":1,"stats":{"Line":2},"fn_name":null},{"line":73,"address":[26656],"length":1,"stats":{"Line":1},"fn_name":"calc_distance"},{"line":74,"address":[26678],"length":1,"stats":{"Line":1},"fn_name":null},{"line":97,"address":[89680,90954],"length":1,"stats":{"Line":2},"fn_name":"parse"},{"line":98,"address":[89707,90078],"length":1,"stats":{"Line":4},"fn_name":null},{"line":99,"address":[89868,89966],"length":1,"stats":{"Line":4},"fn_name":null},{"line":100,"address":[90088,89976],"length":1,"stats":{"Line":2},"fn_name":null},{"line":101,"address":[89922],"length":1,"stats":{"Line":0},"fn_name":null},{"line":102,"address":[90161,89930],"length":1,"stats":{"Line":2},"fn_name":null},{"line":103,"address":[90130,90314,90529],"length":1,"stats":{"Line":4},"fn_name":null},{"line":106,"address":[39052,39133,39024],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":107,"address":[39108,41753,41881,39062,39152,39428],"length":1,"stats":{"Line":10},"fn_name":"{closure#0}"},{"line":108,"address":[39198],"length":1,"stats":{"Line":2},"fn_name":null},{"line":109,"address":[39525,39441,39723,39792],"length":1,"stats":{"Line":6},"fn_name":null},{"line":110,"address":[39961,39773],"length":1,"stats":{"Line":2},"fn_name":null},{"line":111,"address":[40346,40148,40412,39931],"length":1,"stats":{"Line":6},"fn_name":null},{"line":112,"address":[40396,40565],"length":1,"stats":{"Line":2},"fn_name":null},{"line":113,"address":[40927,40752,40950,40535,41080],"length":1,"stats":{"Line":6},"fn_name":null},{"line":114,"address":[40900,41016,41102],"length":1,"stats":{"Line":0},"fn_name":null},{"line":115,"address":[41000,41169],"length":1,"stats":{"Line":2},"fn_name":null},{"line":116,"address":[41356,41538,41763,41139],"length":1,"stats":{"Line":6},"fn_name":null},{"line":117,"address":[41611],"length":1,"stats":{"Line":2},"fn_name":null},{"line":118,"address":[39468,41920,42301,39088,39910],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":119,"address":[41998,42088,42149],"length":1,"stats":{"Line":0},"fn_name":null},{"line":120,"address":[41963,42024,42114],"length":1,"stats":{"Line":0},"fn_name":null},{"line":122,"address":[90590,90772,90481],"length":1,"stats":{"Line":4},"fn_name":null},{"line":123,"address":[90605],"length":1,"stats":{"Line":2},"fn_name":null},{"line":141,"address":[82112,82117],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":142,"address":[85335],"length":1,"stats":{"Line":1},"fn_name":null},{"line":143,"address":[85358,85432,85498],"length":1,"stats":{"Line":3},"fn_name":null},{"line":147,"address":[82144,82149],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":148,"address":[85975],"length":1,"stats":{"Line":1},"fn_name":null},{"line":149,"address":[86072,85998,86138],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":61,"coverable":65},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-15","src","lib.rs"],"content":"//! Advent of Code 2015: Day 15: Science for Hungry People\n//!\n//! [https://adventofcode.com/2015/day/15](https://adventofcode.com/2015/day/15)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Science for Hungry People\";\n\tyear = 2015;\n\tday = 15;\n\tparse = |input| model::parse_input (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\n/// Logic for solving the puzzles.\n///\npub mod logic {\n\n\tuse super::*;\n\tuse model::Ingredient;\n\tuse model::Input;\n\tuse nums::IntConv;\n\n\t/// Part one: Find the combination of ingredients which gives the maximum possible score.\n\t///\n\t/// Uses [`find_start_ingredients`] to work out which ingredients to include as a minimum, and\n\t/// [`calc_score`] to work out the score for a given combination of ingredients.\n\t///\n\tpub fn part_one (all_ingrs: \u0026 Input) -\u003e GenResult \u003cu64\u003e {\n\n\t\tlet start_ingrs = find_start_ingredients (all_ingrs) ?;\n\n\t\t// keep adding one ingredient at a time, maximising the score each time, until we have the\n\t\t// right number\n\n\t\tlet mixed_ingrs =\n\t\t\titer::successors (Some (start_ingrs), |ingrs| Some (iter::empty ()\n\t\t\t\t\t.chain (ingrs.iter_vals ())\n\t\t\t\t\t.chain (iter::once ((all_ingrs).iter ()\n\t\t\t\t\t\t.map (|ingr| (ingr, calc_score (\n\t\t\t\t\t\t\tingrs.iter_vals ().chain (iter::once (ingr)))))\n\t\t\t\t\t\t.max_by_key (|\u0026 (_, score)| score)\n\t\t\t\t\t\t.map (|(ingr, _)| ingr)\n\t\t\t\t\t\t.unwrap ()))\n\t\t\t\t\t.collect ()))\n\t\t\t\t.find (|ingrs| ingrs.len () == 100)\n\t\t\t\t.unwrap ();\n\n\t\t// work out the final score\n\n\t\tlet max_score = calc_score (mixed_ingrs.iter_vals ());\n\t\tOk (max_score)\n\n\t}\n\n\t/// Part two: Find the combination of ingredients which gives the maximum score and exactly 500\n\t/// calories in total.\n\t///\n\t/// This first iterates all combinations of ingredients which total 500 calories. This builds\n\t/// up the number of each ingredient iteratively, starting with [0, ..., 0], then [0, ..., 1],\n\t/// etc. At any point, if the number of calories exceeds 500 we short circuit to prevent\n\t/// needless iteration.\n\t///\n\t/// If the number of calories is exactly 500, and the number of ingredients is exactly 100, we\n\t/// note the score, and once iteration is complete the highest score is returned.\n\t///\n\t/// Uses [`calc_score`] to work out the score for a given combination of ingredients.\n\t///\n\tpub fn part_two (ingrs: \u0026 Input) -\u003e GenResult \u003cu64\u003e {\n\n\t\tlet all_ingrs: Vec \u003c_\u003e =\n\t\t\tingrs.iter ().cloned ()\n\t\t\t\t.sorted_by_key (|ingr| cmp::Reverse (ingr.calories))\n\t\t\t\t.collect ();\n\n\t\tlet mut stack: Vec \u003ci32\u003e = vec! [];\n\t\tlet ingr_combos = iter::from_fn (|| {\n\n\t\t\t// pop off the last element, it only has one possible value. or, if the stack isn't\n\t\t\t// full this must be our first iteration and it's empty, so add a zero to start us off.\n\n\t\t\tif stack.len () == all_ingrs.len () {\n\t\t\t\tstack.pop ().unwrap ();\n\t\t\t} else if stack.is_empty () {\n\t\t\t\tstack.push (0_i32);\n\t\t\t} else { unreachable! () }\n\n\t\t\tloop {\n\n\t\t\t\t// increment the ingredient counts\n\n\t\t\t\t* stack.last_mut ().unwrap () += 1_i32;\n\n\t\t\t\t// short circuit if calories is over 500\n\n\t\t\t\tlet calories: i32 =\n\t\t\t\t\tstack.iter ().copied ().enumerate ()\n\t\t\t\t\t\t.map (|(idx, num)| all_ingrs [idx].calories * num)\n\t\t\t\t\t\t.sum ();\n\n\t\t\t\tif calories \u003e 500_i32 {\n\t\t\t\t\tstack.pop ();\n\t\t\t\t\tif stack.is_empty () { return None }\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// fill in rest of stack with zeros...\n\n\t\t\t\twhile stack.len () + 1 \u003c all_ingrs.len () {\n\t\t\t\t\tstack.push (0_i32);\n\t\t\t\t}\n\n\t\t\t\t// ...execpt for last place which we pick to get 100 ingredients total\n\n\t\t\t\tlet num_final = 100_i32 - stack.iter ().copied ().sum::\u003ci32\u003e ();\n\t\t\t\tif num_final \u003c 0_i32 { continue }\n\t\t\t\tlet calories = calories + num_final * all_ingrs.last ().unwrap ().calories;\n\n\t\t\t\t// if the total calories is exactly 500, return the list of ingredients\n\n\t\t\t\tif calories == 500_i32 {\n\t\t\t\t\tstack.push (num_final);\n\t\t\t\t\treturn Some (\n\t\t\t\t\t\tstack.iter ().copied ().enumerate ()\n\t\t\t\t\t\t\t.flat_map (|(idx, num)|\n\t\t\t\t\t\t\t\titer::repeat (\u0026 all_ingrs [idx])\n\t\t\t\t\t\t\t\t\t.take (num.as_usize ()))\n\t\t\t\t\t\t\t.collect::\u003cVec \u003c_\u003e\u003e ()\n\t\t\t\t\t)\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t});\n\n\t\t// go through the list and pick the highest score\n\n\t\tlet max_score = ingr_combos\n\t\t\t.map (|ingrs| calc_score (ingrs.iter_vals ()))\n\t\t\t.max ()\n\t\t\t.ok_or (\"No solution found\") ?;\n\n\t\tOk (max_score)\n\n\t}\n\n\t/// Find a minimum number of ingredients to get a positive score.\n\t///\n\t/// Goes through all combinations of ingredients totaling 1, then 2, etc, until it finds the\n\t/// minimum number of ingredients needed for a positive score. It then returns the combination\n\t/// which gives the max score for that number of ingredients.\n\t///\n\tpub fn find_start_ingredients (all_ingrs: \u0026 [Ingredient]) -\u003e GenResult \u003cVec \u003c\u0026 Ingredient\u003e\u003e {\n\t\tOk ((1 ..= 100)\n\t\t\t.find_map (|num| all_ingrs.iter ()\n\t\t\t\t.combinations_with_replacement (num)\n\t\t\t\t.map (|ingrs: Vec \u003c\u0026 Ingredient\u003e| (ingrs.clone (),\n\t\t\t\t\tcalc_score (ingrs.iter_vals ())))\n\t\t\t\t.max_by_key (|\u0026 (_, score)| score)\n\t\t\t\t.filter (|\u0026 (_, score)| score \u003e 0)\n\t\t\t\t.map (|(ingrs, _)| ingrs))\n\t\t\t.ok_or (\"No solution_found\") ?)\n\t}\n\n\t/// Works out the score for a given combination of ingredients.\n\t///\n\t/// As per the puzzle description, this adds together each ingredient's value for capacity,\n\t/// durability, flavour and texture, then multiplies them all together. If any total is below\n\t/// zero, then the score is always zero.\n\t///\n\tpub fn calc_score \u003c'ing\u003e (ingrs: impl IntoIterator \u003cItem = \u0026 'ing Ingredient\u003e) -\u003e u64 {\n\t\tlet (cap, dur, fla, tex) = ingrs.into_iter ()\n\t\t\t.fold ((0_i32, 0_i32, 0_i32, 0_i32), |sums, ingr| (\n\t\t\t\tsums.0 + ingr.capacity,\n\t\t\t\tsums.1 + ingr.durability,\n\t\t\t\tsums.2 + ingr.flavour,\n\t\t\t\tsums.3 + ingr.texture,\n\t\t\t));\n\t\tif cap \u003c 0_i32 || dur \u003c 0_i32 || fla \u003c 0_i32 || tex \u003c 0_i32 { return 0 }\n\t\tcap.as_u64 () * dur.as_u64 () * fla.as_u64 () * tex.as_u64 ()\n\t}\n\n}\n\n/// Representation of the puzzle input, etc.\n///\npub mod model {\n\n\tuse super::*;\n\n\tpub type Input = Vec \u003cIngredient\u003e;\n\n\t#[ derive (Clone, Debug, Eq, PartialEq) ]\n\tpub struct Ingredient {\n\t\tpub name: String,\n\t\tpub capacity: i32,\n\t\tpub durability: i32,\n\t\tpub flavour: i32,\n\t\tpub texture: i32,\n\t\tpub calories: i32,\n\t}\n\n\t/// Parse a list of ingredients and their properties, according to the defined format.\n\t///\n\t/// ```\n\t/// # use aoc_2015_day_15::model::{ Ingredient, parse_input };\n\t/// let ingrs = parse_input (\u0026 [\n\t///   \"Butterscotch: capacity -1, durability -2, flavor 6, texture 3, calories 8\",\n\t/// ]).unwrap ();\n\t/// assert_eq! (ingrs.len (), 1);\n\t/// assert_eq! (ingrs [0], Ingredient {\n\t///   name: \"Butterscotch\".to_string (),\n\t///   capacity: -1,\n\t///   durability: -2,\n\t///   flavour: 6,\n\t///   texture: 3,\n\t///   calories: 8,\n\t/// });\n\t/// ```\n\t///\n\tpub fn parse_input (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cInput\u003e {\n\t\tuse parser::*;\n\t\tinput.iter ().enumerate ().map (|(line_idx, line)|\n\t\t\tParser::wrap (line, |parser| {\n\t\t\t\tparser.set_ignore_whitespace (true)\n\t\t\t\t\t.set_word_pred (char::is_alphanumeric);\n\t\t\t\tlet name = parser.word () ?.to_owned ();\n\t\t\t\tlet capacity = parser.expect (\": capacity\") ?.int () ?;\n\t\t\t\tlet durability = parser.expect (\", durability\") ?.int () ?;\n\t\t\t\tlet flavour = parser.expect (\", flavor\") ?.int () ?;\n\t\t\t\tlet texture = parser.expect (\", texture\") ?.int () ?;\n\t\t\t\tlet calories = parser.expect (\", calories\") ?.int () ?;\n\t\t\t\tparser.end () ?;\n\t\t\t\tOk (Ingredient { name, capacity, durability, flavour, texture, calories })\n\t\t\t}).map_parse_err (|char_idx|\n\t\t\t\tformat! (\"Invalid input: line {}: col {}: {}\", line_idx + 1, char_idx + 1, line)\n\t\t\t)\n\t\t).collect ()\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"Butterscotch: capacity -1, durability -2, flavor 6, texture 3, calories 8\",\n\t\t\"Cinnamon: capacity 2, durability 3, flavor -2, texture -1, calories 3\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"62842880\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"57600000\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":13,"address":[59331,58627],"length":1,"stats":{"Line":2},"fn_name":null},{"line":14,"address":[58733],"length":1,"stats":{"Line":1},"fn_name":null},{"line":15,"address":[59437],"length":1,"stats":{"Line":1},"fn_name":null},{"line":32,"address":[73360,73861,74014],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":34,"address":[73656,73398],"length":1,"stats":{"Line":1},"fn_name":null},{"line":39,"address":[119488,119531,119566,119756],"length":1,"stats":{"Line":7},"fn_name":"{closure#0}"},{"line":41,"address":[119541],"length":1,"stats":{"Line":1},"fn_name":null},{"line":42,"address":[119584,119650],"length":1,"stats":{"Line":2},"fn_name":null},{"line":43,"address":[119642,119933,119856],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":44,"address":[119875],"length":1,"stats":{"Line":1},"fn_name":null},{"line":45,"address":[119984,119997],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":46,"address":[120033,120016],"length":1,"stats":{"Line":2},"fn_name":"{closure#2}"},{"line":49,"address":[120048,120075],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":54,"address":[73920],"length":1,"stats":{"Line":1},"fn_name":null},{"line":55,"address":[73975],"length":1,"stats":{"Line":1},"fn_name":null},{"line":72,"address":[74048,74623,74675],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":74,"address":[74086],"length":1,"stats":{"Line":1},"fn_name":null},{"line":76,"address":[120126,120112],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":79,"address":[74203],"length":1,"stats":{"Line":1},"fn_name":null},{"line":80,"address":[74258,74362],"length":1,"stats":{"Line":4},"fn_name":null},{"line":85,"address":[120183],"length":1,"stats":{"Line":1},"fn_name":null},{"line":86,"address":[120278],"length":1,"stats":{"Line":1},"fn_name":null},{"line":87,"address":[120253,120368],"length":1,"stats":{"Line":2},"fn_name":null},{"line":88,"address":[120412],"length":1,"stats":{"Line":1},"fn_name":null},{"line":89,"address":[120374],"length":1,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[120335,120558,120440],"length":1,"stats":{"Line":2},"fn_name":null},{"line":100,"address":[120532,120604,120711],"length":1,"stats":{"Line":3},"fn_name":null},{"line":101,"address":[120699,121648,121670],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":104,"address":[120774],"length":1,"stats":{"Line":1},"fn_name":null},{"line":105,"address":[120815],"length":1,"stats":{"Line":1},"fn_name":null},{"line":106,"address":[120831],"length":1,"stats":{"Line":1},"fn_name":null},{"line":112,"address":[120789,120901],"length":1,"stats":{"Line":2},"fn_name":null},{"line":113,"address":[121040],"length":1,"stats":{"Line":0},"fn_name":null},{"line":118,"address":[121174,121006,121071],"length":1,"stats":{"Line":2},"fn_name":null},{"line":119,"address":[121163],"length":1,"stats":{"Line":1},"fn_name":null},{"line":120,"address":[121376,121212],"length":1,"stats":{"Line":1},"fn_name":null},{"line":124,"address":[121364],"length":1,"stats":{"Line":1},"fn_name":null},{"line":125,"address":[121418],"length":1,"stats":{"Line":1},"fn_name":null},{"line":126,"address":[121601],"length":1,"stats":{"Line":1},"fn_name":null},{"line":127,"address":[121434,121543],"length":1,"stats":{"Line":2},"fn_name":null},{"line":128,"address":[121760,121531,121782,121874],"length":1,"stats":{"Line":4},"fn_name":"{closure#1}"},{"line":129,"address":[121791,121851],"length":1,"stats":{"Line":2},"fn_name":null},{"line":130,"address":[121830],"length":1,"stats":{"Line":1},"fn_name":null},{"line":141,"address":[74378,74594],"length":1,"stats":{"Line":1},"fn_name":null},{"line":142,"address":[121888,121915],"length":1,"stats":{"Line":2},"fn_name":"{closure#2}"},{"line":146,"address":[74531],"length":1,"stats":{"Line":1},"fn_name":null},{"line":156,"address":[74704],"length":1,"stats":{"Line":1},"fn_name":"find_start_ingredients"},{"line":157,"address":[75045,74797,74747],"length":1,"stats":{"Line":2},"fn_name":null},{"line":158,"address":[74781],"length":1,"stats":{"Line":3},"fn_name":null},{"line":160,"address":[122245,122370,122208,122407],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":161,"address":[122400,122257],"length":1,"stats":{"Line":1},"fn_name":null},{"line":162,"address":[122448,122461],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":163,"address":[122480,122489],"length":1,"stats":{"Line":2},"fn_name":"{closure#2}"},{"line":164,"address":[122528,122532],"length":1,"stats":{"Line":2},"fn_name":"{closure#3}"},{"line":165,"address":[75019],"length":1,"stats":{"Line":0},"fn_name":null},{"line":174,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":175,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":176,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":177,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":178,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":179,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":180,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":182,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":183,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":224,"address":[88960],"length":1,"stats":{"Line":1},"fn_name":"parse_input"},{"line":226,"address":[89010],"length":1,"stats":{"Line":4},"fn_name":null},{"line":227,"address":[70379,70060,72801,72929,70096,70013],"length":1,"stats":{"Line":5},"fn_name":"{closure#0}"},{"line":228,"address":[70142],"length":1,"stats":{"Line":1},"fn_name":null},{"line":230,"address":[70179],"length":1,"stats":{"Line":1},"fn_name":null},{"line":231,"address":[70674,70392,70476,70764],"length":1,"stats":{"Line":3},"fn_name":null},{"line":232,"address":[70914,70729,71199,71112],"length":1,"stats":{"Line":3},"fn_name":null},{"line":233,"address":[71618,71167,71333,71531],"length":1,"stats":{"Line":3},"fn_name":null},{"line":234,"address":[71586,71752,71950,72037],"length":1,"stats":{"Line":3},"fn_name":null},{"line":235,"address":[72005,72369,72171,72444],"length":1,"stats":{"Line":3},"fn_name":null},{"line":236,"address":[72811,72562,72432],"length":1,"stats":{"Line":2},"fn_name":null},{"line":237,"address":[72644],"length":1,"stats":{"Line":1},"fn_name":null},{"line":238,"address":[72960,70040,70419,70882,73341],"length":1,"stats":{"Line":1},"fn_name":"{closure#1}"},{"line":239,"address":[73003],"length":1,"stats":{"Line":0},"fn_name":null},{"line":257,"address":[68293,68288],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":258,"address":[127623],"length":1,"stats":{"Line":1},"fn_name":null},{"line":259,"address":[127786,127646,127720],"length":1,"stats":{"Line":3},"fn_name":null},{"line":263,"address":[68320,68325],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":264,"address":[128263],"length":1,"stats":{"Line":1},"fn_name":null},{"line":265,"address":[128360,128426,128286],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":80,"coverable":84},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-16","src","lib.rs"],"content":"//! Advent of Code 2015: Day 16: Aunt Sue\n//!\n//! [https://adventofcode.com/2015/day/16](https://adventofcode.com/2015/day/16)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Aunt Sue\";\n\tyear = 2015;\n\tday = 16;\n\tparse = |input| model::parse_input (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\n/// Logic for solving the puzzles.\n///\npub mod logic {\n\n\tuse super::*;\n\tuse model::Attr;\n\tuse model::Input;\n\n\tpub fn part_one (all_sues: \u0026 Input) -\u003e GenResult \u003cu16\u003e {\n\t\tconst fn ticker (attr: Attr) -\u003e u8 {\n\t\t\tmatch attr {\n\t\t\t\tAttr::Children =\u003e 3,\n\t\t\t\tAttr::Cats =\u003e 7,\n\t\t\t\tAttr::Samoyeds =\u003e 2,\n\t\t\t\tAttr::Pomeranians =\u003e 3,\n\t\t\t\tAttr::Akitas =\u003e 0,\n\t\t\t\tAttr::Vizslas =\u003e 0,\n\t\t\t\tAttr::Goldfish =\u003e 5,\n\t\t\t\tAttr::Trees =\u003e 3,\n\t\t\t\tAttr::Cars =\u003e 2,\n\t\t\t\tAttr::Perfumes =\u003e 1,\n\t\t\t}\n\t\t}\n\t\tlet the_sue = all_sues.iter ()\n\t\t\t.filter (|sue| sue.attrs.iter ().copied ().all (|(attr, num)|\n\t\t\t\tnum == ticker (attr)))\n\t\t\t.exactly_one ().map_err (|iter| format! (\"Expected exactly one match but found {}\",\n\t\t\t\titer.count ())) ?;\n\t\tOk (the_sue.number)\n\t}\n\n\tpub fn part_two (all_sues: \u0026 Input) -\u003e GenResult \u003cu16\u003e {\n\t\tconst fn ticker (attr: Attr, num: u8) -\u003e bool {\n\t\t\tmatch attr {\n\t\t\t\tAttr::Children =\u003e num == 3,\n\t\t\t\tAttr::Cats =\u003e num \u003e 7,\n\t\t\t\tAttr::Samoyeds =\u003e num == 2,\n\t\t\t\tAttr::Pomeranians =\u003e num \u003c 3,\n\t\t\t\tAttr::Akitas =\u003e num == 0,\n\t\t\t\tAttr::Vizslas =\u003e num == 0,\n\t\t\t\tAttr::Goldfish =\u003e num \u003c 5,\n\t\t\t\tAttr::Trees =\u003e num \u003e 3,\n\t\t\t\tAttr::Cars =\u003e num == 2,\n\t\t\t\tAttr::Perfumes =\u003e num == 1,\n\t\t\t}\n\t\t}\n\t\tlet the_sue = all_sues.iter ()\n\t\t\t.filter (|sue| sue.attrs.iter ().copied ()\n\t\t\t\t.all (|(attr, num)| ticker (attr, num)))\n\t\t\t.exactly_one ().map_err (|iter| format! (\"Expected exactly one match but found {}\",\n\t\t\t\titer.count ())) ?;\n\t\tOk (the_sue.number)\n\t}\n\n}\n\n/// Representation of the puzzle input, etc.\n///\npub mod model {\n\n\tuse super::*;\n\n\tpub type Input = Vec \u003cAuntSue\u003e;\n\n\t#[ derive (Clone, Debug, Eq, PartialEq) ]\n\tpub struct AuntSue {\n\t\tpub number: u16,\n\t\tpub attrs: ArrayVec \u003c(Attr, u8), 10\u003e,\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\n\tpub enum Attr {\n\t\tChildren,\n\t\tCats,\n\t\tSamoyeds,\n\t\tPomeranians,\n\t\tAkitas,\n\t\tVizslas,\n\t\tGoldfish,\n\t\tTrees,\n\t\tCars,\n\t\tPerfumes,\n\t}\n\n\tpub fn parse_input (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cInput\u003e {\n\t\tuse parser::*;\n\t\tinput.iter ().enumerate ().map (|(line_idx, line)|\n\t\t\tParser::wrap (line, |parser| {\n\t\t\t\tparser.set_ignore_whitespace (true)\n\t\t\t\t\t.set_word_pred (char::is_alphanumeric);\n\t\t\t\tlet number = parser.expect (\"Sue\") ?.int () ?;\n\t\t\t\tparser.expect (\":\") ?;\n\t\t\t\tlet mut attrs = ArrayVec::new ();\n\t\t\t\twhile parser.peek ().is_some () {\n\t\t\t\t\tlet attr = match parser.word () ? {\n\t\t\t\t\t\t\"children\" =\u003e Attr::Children,\n\t\t\t\t\t\t\"cats\" =\u003e Attr::Cats,\n\t\t\t\t\t\t\"samoyeds\" =\u003e Attr::Samoyeds,\n\t\t\t\t\t\t\"pomeranians\" =\u003e Attr::Pomeranians,\n\t\t\t\t\t\t\"akitas\" =\u003e Attr::Akitas,\n\t\t\t\t\t\t\"vizslas\" =\u003e Attr::Vizslas,\n\t\t\t\t\t\t\"goldfish\" =\u003e Attr::Goldfish,\n\t\t\t\t\t\t\"trees\" =\u003e Attr::Trees,\n\t\t\t\t\t\t\"cars\" =\u003e Attr::Cars,\n\t\t\t\t\t\t\"perfumes\" =\u003e Attr::Perfumes,\n\t\t\t\t\t\t_ =\u003e Err (parser.err ()) ?,\n\t\t\t\t\t};\n\t\t\t\t\tlet num = parser.expect (\":\") ?.int () ?;\n\t\t\t\t\tif attrs.is_full () \n\t\t\t\t\t\t\t|| attrs.iter ().any (|\u0026 (some_attr, _)| some_attr == attr) {\n\t\t\t\t\t\tErr (parser.err ()) ?;\n\t\t\t\t\t}\n\t\t\t\t\tattrs.push ((attr, num));\n\t\t\t\t\tmatch parser.next () {\n\t\t\t\t\t\tSome (',') =\u003e continue,\n\t\t\t\t\t\tNone =\u003e break,\n\t\t\t\t\t\tSome (_) =\u003e Err (parser.err ()) ?,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tparser.end () ?;\n\t\t\t\tOk (AuntSue { number, attrs })\n\t\t\t}).map_parse_err (|char_idx|\n\t\t\t\tformat! (\"Invalid input: line {}: col {}: {}\", line_idx + 1, char_idx + 1, line)\n\t\t\t)\n\t\t).collect ()\n\t}\n\n}\n","traces":[{"line":13,"address":[65907,66595],"length":1,"stats":{"Line":0},"fn_name":null},{"line":14,"address":[66013],"length":1,"stats":{"Line":0},"fn_name":null},{"line":15,"address":[66701],"length":1,"stats":{"Line":0},"fn_name":null},{"line":26,"address":[53936],"length":1,"stats":{"Line":0},"fn_name":"part_one"},{"line":27,"address":[54288],"length":1,"stats":{"Line":0},"fn_name":"ticker"},{"line":28,"address":[54299],"length":1,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[54330],"length":1,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[54337],"length":1,"stats":{"Line":0},"fn_name":null},{"line":31,"address":[54344],"length":1,"stats":{"Line":0},"fn_name":null},{"line":32,"address":[54351],"length":1,"stats":{"Line":0},"fn_name":null},{"line":33,"address":[54358],"length":1,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[54365],"length":1,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[54372],"length":1,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[54379],"length":1,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[54386],"length":1,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[54393],"length":1,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[54244,53974],"length":1,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[42048,42074,41950,41936,42107],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":43,"address":[42082],"length":1,"stats":{"Line":0},"fn_name":null},{"line":45,"address":[42145],"length":1,"stats":{"Line":0},"fn_name":null},{"line":46,"address":[54137],"length":1,"stats":{"Line":0},"fn_name":null},{"line":49,"address":[54416],"length":1,"stats":{"Line":0},"fn_name":"part_two"},{"line":50,"address":[54768],"length":1,"stats":{"Line":0},"fn_name":"ticker"},{"line":51,"address":[54790],"length":1,"stats":{"Line":0},"fn_name":null},{"line":52,"address":[54827],"length":1,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[54847],"length":1,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[54867],"length":1,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[54884],"length":1,"stats":{"Line":0},"fn_name":null},{"line":56,"address":[54901],"length":1,"stats":{"Line":0},"fn_name":null},{"line":57,"address":[54918],"length":1,"stats":{"Line":0},"fn_name":null},{"line":58,"address":[54935],"length":1,"stats":{"Line":0},"fn_name":null},{"line":59,"address":[54952],"length":1,"stats":{"Line":0},"fn_name":null},{"line":60,"address":[54969],"length":1,"stats":{"Line":0},"fn_name":null},{"line":61,"address":[54986],"length":1,"stats":{"Line":0},"fn_name":null},{"line":64,"address":[54454,54724],"length":1,"stats":{"Line":0},"fn_name":null},{"line":65,"address":[42302,42288],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":66,"address":[42400,42422],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":68,"address":[42481],"length":1,"stats":{"Line":0},"fn_name":null},{"line":69,"address":[54617],"length":1,"stats":{"Line":0},"fn_name":null},{"line":102,"address":[52336],"length":1,"stats":{"Line":0},"fn_name":"parse_input"},{"line":104,"address":[52386],"length":1,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[72256,72166,72212,75600,72796,75728],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":106,"address":[72302],"length":1,"stats":{"Line":0},"fn_name":null},{"line":108,"address":[72670,72561,72339],"length":1,"stats":{"Line":0},"fn_name":null},{"line":109,"address":[72804,72880,72635],"length":1,"stats":{"Line":0},"fn_name":null},{"line":110,"address":[72860],"length":1,"stats":{"Line":0},"fn_name":null},{"line":111,"address":[73061,73006,75250],"length":1,"stats":{"Line":0},"fn_name":null},{"line":112,"address":[73377,73264,73129],"length":1,"stats":{"Line":0},"fn_name":null},{"line":113,"address":[73388,73236,73427],"length":1,"stats":{"Line":0},"fn_name":null},{"line":114,"address":[73474,73404,73513],"length":1,"stats":{"Line":0},"fn_name":null},{"line":115,"address":[73566,73527,73490],"length":1,"stats":{"Line":0},"fn_name":null},{"line":116,"address":[73543,73583,73622],"length":1,"stats":{"Line":0},"fn_name":null},{"line":117,"address":[73639,73678,73599],"length":1,"stats":{"Line":0},"fn_name":null},{"line":118,"address":[73655,73734,73695],"length":1,"stats":{"Line":0},"fn_name":null},{"line":119,"address":[73790,73711,73751],"length":1,"stats":{"Line":0},"fn_name":null},{"line":120,"address":[73807,73767,73846],"length":1,"stats":{"Line":0},"fn_name":null},{"line":121,"address":[73902,73863,73823],"length":1,"stats":{"Line":0},"fn_name":null},{"line":122,"address":[73945,73919,73879],"length":1,"stats":{"Line":0},"fn_name":null},{"line":123,"address":[73938,73958],"length":1,"stats":{"Line":0},"fn_name":null},{"line":125,"address":[73440,74494,74222,74420],"length":1,"stats":{"Line":0},"fn_name":null},{"line":126,"address":[74616,74647,74946,74478,74771],"length":1,"stats":{"Line":0},"fn_name":null},{"line":127,"address":[75774,75760,74630,74681],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":128,"address":[74854,74956],"length":1,"stats":{"Line":0},"fn_name":null},{"line":130,"address":[74786],"length":1,"stats":{"Line":0},"fn_name":null},{"line":131,"address":[75079],"length":1,"stats":{"Line":0},"fn_name":null},{"line":134,"address":[75260,75158],"length":1,"stats":{"Line":0},"fn_name":null},{"line":137,"address":[73114,75378,75610],"length":1,"stats":{"Line":0},"fn_name":null},{"line":138,"address":[75444],"length":1,"stats":{"Line":0},"fn_name":null},{"line":139,"address":[76205,72192,73025,74188,75824],"length":1,"stats":{"Line":0},"fn_name":"{closure#1}"},{"line":140,"address":[75867],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":70},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-17","src","lib.rs"],"content":"//! Advent of Code 2015: Day 17: No Such Thing as Too Much\n//!\n//! [https://adventofcode.com/2015/day/17](https://adventofcode.com/2015/day/17)\n//!\n//! # Input\n//!\n//! Each line is a decimal integer, representing the size of an available container.\n//!\n//! # Part one\n//!\n//! Work out the number of combinations of containers so that the size adds up to exactly 150. The\n//! containers count separately, even if they are the same size.\n//!\n//! # Part two\n//!\n//! Work out the minimum number of containers to hold exactly 150, then work out the total number\n//! of combinations of that many containers which can hold exactly 150.\n//!\n//! # Algorithm\n//!\n//! The private function `combos` provides an iterator over a list of combinations of container\n//! sizes to match a given target. TODO how does this work?\n//!\n//! For part one, we just use [`count`](Iterator::count). For part two, we invoke `combos` twice,\n//! the first time using [`min`](Iterator::min) to work out the minimum number of containers, then\n//! using [`filter`](Iterator::filter) and [`count`](Iterator::count) to determine the number of\n//! combinations with that specific number of containers.\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"No Such Thing as Too Much\";\n\tyear = 2015;\n\tday = 17;\n\tparse = |input| model::parse_input (input);\n\tpart_one = |input| logic::part_one (input);\n\tpart_two = |input| logic::part_two (input);\n}\n\n/// Logic for solving the puzzles.\n///\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\tuse nums::IntConv;\n\n\tpub fn part_one (input: Input) -\u003e GenResult \u003cu32\u003e {\n\t\tlet (mut sizes, target) = input;\n\t\tsanity_checks (\u0026 sizes, target) ?;\n\n\t\tsizes.sort_by_key (|\u0026 size| cmp::Reverse (size));\n\t\tlet num_combos = combos (\u0026 sizes, target).count ();\n\t\tOk (num_combos.as_u32 ())\n\t}\n\n\tpub fn part_two (input: Input) -\u003e GenResult \u003cu32\u003e {\n\t\tlet (mut sizes, target) = input;\n\t\tsanity_checks (\u0026 sizes, target) ?;\n\n\t\t// sort first, this makes the algorithm more efficient\n\n\t\tsizes.sort_by_key (|\u0026 size| cmp::Reverse (size));\n\n\t\t// work out smallest number of containers\n\n\t\tlet smallest =\n\t\t\tcombos (\u0026 sizes, target)\n\t\t\t\t.min_by_key (Vec::len)\n\t\t\t\t.map_or (0, |combo| combo.len ());\n\n\t\t// count combinations with this number\n\n\t\tlet num_smallest =\n\t\t\tcombos (\u0026 sizes, target)\n\t\t\t\t.filter (|combo| combo.len () == smallest)\n\t\t\t\t.count ();\n\n\t\t// return\n\n\t\tOk (num_smallest.as_u32 ())\n\n\t}\n\n\tfn sanity_checks (sizes: \u0026 [u32], target: u32) -\u003e GenResult \u003c()\u003e {\n\t\tif sizes.len () \u003e 20 { Err (\"Refusing to deal with more than 20 containers\") ?; }\n\t\tif sizes.iter ().copied ().sum::\u003cu32\u003e () \u003c target { Err (\"No solution found\") ?; }\n\t\tOk (())\n\t}\n\n\t/// Iterate over combinations of provided container given a specific total.\n\t///\n\t/// Returns an [`Iterator`] over [`Vec`]s of the sizes of each container. Note that these can\n\t/// appear to be duplicates, if there is more than one container with the same size.\n\t///\n\tfn combos (sizes: \u0026 [u32], target: u32) -\u003e impl Iterator \u003cItem = Vec \u003cu32\u003e\u003e + '_ {\n\t\tlet mut state = iter::repeat (false).take (sizes.len ()).collect::\u003cVec \u003c_\u003e\u003e ();\n\t\tlet mut sum = 0;\n\t\titer::from_fn (move || loop {\n\t\t\tif state.is_empty () { return None }\n\t\t\tlet mut idx = state.len () - 1;\n\t\t\tloop {\n\t\t\t\tif state [idx] {\n\t\t\t\t\tstate [idx] = false;\n\t\t\t\t\tsum -= sizes [idx];\n\t\t\t\t\tif idx \u003e 0 { idx -= 1 } else { return None }\n\t\t\t\t} else if 150 \u003c sum\n\t\t\t\t\t\t|| sum + sizes.iter ().copied ().skip (idx).sum::\u003cu32\u003e () \u003c target {\n\t\t\t\t\tif idx \u003e 0 { idx -= 1 } else { return None }\n\t\t\t\t} else { break }\n\t\t\t}\n\t\t\tstate [idx] = true;\n\t\t\tsum += sizes [idx];\n\t\t\tif sum == target {\n\t\t\t\treturn Some (\n\t\t\t\t\tIterator::zip (sizes.iter ().copied (), state.iter ().copied ())\n\t\t\t\t\t\t.filter (|\u0026 (_, state)| state)\n\t\t\t\t\t\t.map (|(size, _)| size)\n\t\t\t\t\t\t.collect::\u003cVec \u003c_\u003e\u003e ()\n\t\t\t\t);\n\t\t\t}\n\t\t})\n\t}\n\n}\n\n/// Representation of the puzzle input, etc.\n///\npub mod model {\n\n\tuse super::*;\n\tuse nums::IntConv;\n\tuse parser::*;\n\n\tpub type Input = (Vec \u003cu32\u003e, u32);\n\n\tpub fn parse_input (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cInput\u003e {\n\t\tlet (input, target) = if let Some (target_str) = input [0].strip_prefix (\"TARGET=\") {\n\t\t\t(\u0026 input [ 1 .. ], target_str.parse () ?)\n\t\t} else { (input, 150) };\n\t\tlet buckets = input.iter ().enumerate ().map (|(line_idx, line)|\n\t\t\tParser::wrap (line, |parser| {\n\t\t\t\tlet val = parser.int::\u003cu8\u003e () ?.as_u32 ();\n\t\t\t\tparser.end () ?;\n\t\t\t\tOk (val)\n\t\t\t}).map_parse_err (|char_idx| format! (\"Invalid input: line {}: col {}: {}\",\n\t\t\t\t\tline_idx + 1, char_idx + 1, line))\n\t\t).collect::\u003cGenResult \u003c_\u003e\u003e () ?;\n\t\tOk (( buckets, target ))\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tlet input = model::parse_input (\u0026 [\"TARGET=25\", \"20\", \"15\", \"10\", \"5\", \"5\"]) ?;\n\t\tassert_eq_ok! (4, logic::part_one (input));\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tlet input = model::parse_input (\u0026 [\"TARGET=25\", \"20\", \"15\", \"10\", \"5\", \"5\"]) ?;\n\t\tassert_eq_ok! (3, logic::part_two (input));\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":37,"address":[58043,58795],"length":1,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[58144],"length":1,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[58896],"length":1,"stats":{"Line":0},"fn_name":null},{"line":50,"address":[88128,88644],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":51,"address":[88145],"length":1,"stats":{"Line":1},"fn_name":null},{"line":52,"address":[88261,88190,88390],"length":1,"stats":{"Line":2},"fn_name":null},{"line":54,"address":[88368,88499],"length":1,"stats":{"Line":4},"fn_name":null},{"line":55,"address":[88514],"length":1,"stats":{"Line":1},"fn_name":null},{"line":56,"address":[88593],"length":1,"stats":{"Line":1},"fn_name":null},{"line":59,"address":[89361,88672],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":60,"address":[88689],"length":1,"stats":{"Line":1},"fn_name":null},{"line":61,"address":[88734,88946,88817],"length":1,"stats":{"Line":2},"fn_name":null},{"line":65,"address":[26974,26960],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":69,"address":[89070],"length":1,"stats":{"Line":1},"fn_name":null},{"line":72,"address":[27008,27016],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":76,"address":[89184,89246],"length":1,"stats":{"Line":2},"fn_name":null},{"line":78,"address":[27104,27134],"length":1,"stats":{"Line":3},"fn_name":"{closure#2}"},{"line":83,"address":[89310],"length":1,"stats":{"Line":1},"fn_name":null},{"line":87,"address":[89392],"length":1,"stats":{"Line":2},"fn_name":"sanity_checks"},{"line":88,"address":[89472,89436],"length":1,"stats":{"Line":2},"fn_name":null},{"line":89,"address":[89452,89616,89673],"length":1,"stats":{"Line":4},"fn_name":null},{"line":90,"address":[89662],"length":1,"stats":{"Line":2},"fn_name":null},{"line":98,"address":[89808],"length":1,"stats":{"Line":2},"fn_name":"combos"},{"line":99,"address":[89862],"length":1,"stats":{"Line":2},"fn_name":null},{"line":100,"address":[89946],"length":1,"stats":{"Line":2},"fn_name":null},{"line":101,"address":[27302,27184],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":102,"address":[27287,27231],"length":1,"stats":{"Line":2},"fn_name":null},{"line":103,"address":[27264,27318,27355],"length":1,"stats":{"Line":4},"fn_name":null},{"line":104,"address":[27353],"length":1,"stats":{"Line":2},"fn_name":null},{"line":105,"address":[27393,28152,27760],"length":1,"stats":{"Line":6},"fn_name":null},{"line":106,"address":[27470],"length":1,"stats":{"Line":2},"fn_name":null},{"line":107,"address":[27667,27518],"length":1,"stats":{"Line":2},"fn_name":null},{"line":108,"address":[27705,27654,27717,27765],"length":1,"stats":{"Line":6},"fn_name":null},{"line":109,"address":[27443,27844,28004],"length":1,"stats":{"Line":4},"fn_name":null},{"line":110,"address":[28018,27803,27887],"length":1,"stats":{"Line":4},"fn_name":null},{"line":111,"address":[28115,28084,28157],"length":1,"stats":{"Line":4},"fn_name":null},{"line":114,"address":[28056,28200],"length":1,"stats":{"Line":4},"fn_name":null},{"line":115,"address":[28203,28329],"length":1,"stats":{"Line":2},"fn_name":null},{"line":116,"address":[28316],"length":1,"stats":{"Line":2},"fn_name":null},{"line":117,"address":[28590],"length":1,"stats":{"Line":2},"fn_name":null},{"line":118,"address":[28367],"length":1,"stats":{"Line":2},"fn_name":null},{"line":119,"address":[28640,28653],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":120,"address":[28688,28711],"length":1,"stats":{"Line":4},"fn_name":"{closure#1}"},{"line":139,"address":[101424],"length":1,"stats":{"Line":2},"fn_name":"parse_input"},{"line":140,"address":[101894,101467,101700],"length":1,"stats":{"Line":6},"fn_name":null},{"line":141,"address":[101772,101628,101904],"length":1,"stats":{"Line":4},"fn_name":null},{"line":142,"address":[101682],"length":1,"stats":{"Line":0},"fn_name":null},{"line":143,"address":[99085,99004,98976],"length":1,"stats":{"Line":10},"fn_name":"{closure#0}"},{"line":144,"address":[99318,99060,99410,99104,99014],"length":1,"stats":{"Line":10},"fn_name":"{closure#0}"},{"line":145,"address":[99150],"length":1,"stats":{"Line":2},"fn_name":null},{"line":146,"address":[99417,99331],"length":1,"stats":{"Line":2},"fn_name":null},{"line":147,"address":[99401],"length":1,"stats":{"Line":2},"fn_name":null},{"line":148,"address":[99781,99040,99630,99552,99720],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":149,"address":[99656,99746,99595],"length":1,"stats":{"Line":0},"fn_name":null},{"line":151,"address":[102159],"length":1,"stats":{"Line":2},"fn_name":null},{"line":162,"address":[29273,29264],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":163,"address":[53751,53559],"length":1,"stats":{"Line":1},"fn_name":null},{"line":164,"address":[53939,54266,53694,53870],"length":1,"stats":{"Line":3},"fn_name":null},{"line":165,"address":[54226],"length":1,"stats":{"Line":1},"fn_name":null},{"line":169,"address":[29312,29321],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":170,"address":[54391,54583],"length":1,"stats":{"Line":1},"fn_name":null},{"line":171,"address":[54702,54771,55098,54526],"length":1,"stats":{"Line":3},"fn_name":null},{"line":172,"address":[55058],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":58,"coverable":63},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-18","src","lib.rs"],"content":"//! Advent of Code 2015: Day 18: Like a GIF For Your Yard\n//!\n//! [https://adventofcode.com/2015/day/18](https://adventofcode.com/2015/day/18)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\nuse aoc_grid as grid;\nuse aoc_pos as pos;\n\npuzzle_info! {\n\tname = \"Like a GIF For Your Yard\";\n\tyear = 2015;\n\tday = 18;\n\tparse = |input| model::parse_input (input);\n\tpart_one = |input, steps: u32| logic::part_one (input, steps);\n\tpart_two = |input, steps: u32| logic::part_two (input, steps);\n\tparams = [\n\t\tsteps: u32 = 100;\n\t];\n}\n\n/// Logic for solving the puzzles.\n///\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\tuse model::Pos;\n\tuse nums::IntConv;\n\n\tpub fn part_one (input: Input, loops: u32) -\u003e GenResult \u003cu32\u003e {\n\t\tlet num_active = calc_result (input, loops, \u0026 HashMap::new ());\n\t\tOk (num_active)\n\t}\n\n\tpub fn part_two (input: Input, loops: u32) -\u003e GenResult \u003cu32\u003e {\n\t\tlet Pos { y: y0, x: x0 } = input.origin ();\n\t\tlet Pos { y: y1, x: x1 } = input.peak ();\n\t\tlet overrides = [\n\t\t\tPos { y: y0, x: x0 }, Pos { y: y0, x: x1 },\n\t\t\tPos { y: y1, x: x0 }, Pos { y: y1, x: x1 },\n\t\t].into_iter ().map (|pos| (pos, true)).collect ();\n\t\tlet num_active = calc_result (input, loops, \u0026 overrides);\n\t\tOk (num_active)\n\t}\n\n\tfn calc_result (lights: Input, loops: u32, overrides: \u0026 HashMap \u003cPos, bool\u003e) -\u003e u32 {\n\t\tlet mut lights = lights;\n\n\t\t// make sure overrides start in the correct state\n\n\t\tfor (\u0026 pos, \u0026 val) in overrides.iter () {\n\t\t\tlights.set (pos, val);\n\t\t}\n\n\t\t// apply rules specified number of times\n\n\t\tfor _ in 0 .. loops {\n\t\t\tlet new_data = lights.iter ().map (|(pos, val)| {\n\t\t\t\tif let Some (\u0026 val) = overrides.get (\u0026 pos) { val } else {\n\t\t\t\t\tlet num_adjacent =\n\t\t\t\t\t\tpos.adjacent_8 ().iter ().copied ()\n\t\t\t\t\t\t\t.filter (|\u0026 adj_pos| lights.get (adj_pos).unwrap_or (false))\n\t\t\t\t\t\t\t.count ();\n\t\t\t\t\tmatches! ((val, num_adjacent), (true, 2) | (_, 3))\n\t\t\t\t}\n\t\t\t}).collect ();\n\t\t\tlights = Input::wrap (new_data, lights.raw_origin (), lights.raw_size ());\n\t\t}\n\n\t\t// count active lights\n\n\t\tlet num_active =\n\t\t\tlights.values ()\n\t\t\t\t.filter (|\u0026 val| val)\n\t\t\t\t.count ().to_u32 ().unwrap ();\n\n\t\tnum_active\n\n\t}\n\n}\n\n/// Representation of the puzzle input, etc.\n///\npub mod model {\n\n\tuse super::*;\n\tuse grid::Grid;\n\tuse pos::PosYX;\n\n\tpub type Coord = u16;\n\tpub type Pos = PosYX \u003cCoord\u003e;\n\tpub type Input = Grid \u003cVec \u003cbool\u003e, Pos\u003e;\n\n\tpub fn parse_input (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cInput\u003e {\n\t\tlet grid_size = [ input.len (), input [0].chars ().count () ];\n\t\tif grid_size [1] == 0 { Err (\"Invalid input\") ? }\n\t\tif let Some ((line_idx, line_len)) =\n\t\t\tinput.iter ().enumerate ()\n\t\t\t\t.map (|(idx, line)| (idx, line.chars ().count ()))\n\t\t\t\t.find (|\u0026 (_, len)| len != grid_size [1]) {\n\t\t\tErr (format! (\"Invalid input: line {}: Expected {} chars, not {}\",\n\t\t\t\tline_idx + 1, grid_size [1], line_len)) ?;\n\t\t}\n\t\tlet grid_data = input.iter ().enumerate ().flat_map (|(line_idx, line)|\n\t\t\tline.chars ().enumerate ().map (move |(char_idx, ch)| Ok (match ch {\n\t\t\t\t'#' =\u003e true,\n\t\t\t\t'.' =\u003e false,\n\t\t\t\t_ =\u003e Err (format! (\"Invalid input: line {}: col {}: {}\", line_idx + 1,\n\t\t\t\t\tchar_idx + 1, ch)) ?,\n\t\t\t}))\n\t\t).collect::\u003cGenResult \u003cVec \u003c_\u003e\u003e\u003e () ?;\n\t\tlet grid = Grid::wrap (grid_data, [0, 0], grid_size);\n\t\tOk (grid)\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\".#.#.#\", \"...##.\", \"#....#\", \"..#...\", \"#.#..#\", \"####..\"\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet mut puzzle = puzzle_metadata ();\n\t\tpuzzle.set_param (\"steps\", 4.to_string ());\n\t\tassert_eq_ok! (\"4\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet mut puzzle = puzzle_metadata ();\n\t\tpuzzle.set_param (\"steps\", 5.to_string ());\n\t\tassert_eq_ok! (\"17\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":15,"address":[43139,44147],"length":1,"stats":{"Line":2},"fn_name":null},{"line":16,"address":[43329],"length":1,"stats":{"Line":1},"fn_name":null},{"line":17,"address":[44337],"length":1,"stats":{"Line":1},"fn_name":null},{"line":32,"address":[74064,74198],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":33,"address":[74229,74092],"length":1,"stats":{"Line":1},"fn_name":null},{"line":34,"address":[74293],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[74947,74320,74971],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":38,"address":[74361,74450],"length":1,"stats":{"Line":2},"fn_name":null},{"line":39,"address":[74482],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[74599],"length":1,"stats":{"Line":1},"fn_name":null},{"line":41,"address":[74535],"length":1,"stats":{"Line":1},"fn_name":null},{"line":42,"address":[74567],"length":1,"stats":{"Line":1},"fn_name":null},{"line":43,"address":[88832,88857],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":44,"address":[74919,74796],"length":1,"stats":{"Line":2},"fn_name":null},{"line":45,"address":[74926],"length":1,"stats":{"Line":1},"fn_name":null},{"line":48,"address":[75008,75831,76042],"length":1,"stats":{"Line":1},"fn_name":"calc_result"},{"line":49,"address":[75051],"length":1,"stats":{"Line":1},"fn_name":null},{"line":53,"address":[75171,75111,75349,75342,75331],"length":1,"stats":{"Line":5},"fn_name":null},{"line":54,"address":[75345,75339,75395],"length":1,"stats":{"Line":3},"fn_name":null},{"line":59,"address":[75284,75415,75915],"length":1,"stats":{"Line":4},"fn_name":null},{"line":60,"address":[75530],"length":1,"stats":{"Line":4},"fn_name":null},{"line":61,"address":[88989],"length":1,"stats":{"Line":1},"fn_name":null},{"line":63,"address":[89060,89153,89224],"length":1,"stats":{"Line":3},"fn_name":null},{"line":64,"address":[89212,89408,89422],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":65,"address":[89111,89272],"length":1,"stats":{"Line":2},"fn_name":null},{"line":66,"address":[89321],"length":1,"stats":{"Line":2},"fn_name":null},{"line":69,"address":[75625,75842],"length":1,"stats":{"Line":2},"fn_name":null},{"line":74,"address":[75930,75497],"length":1,"stats":{"Line":4},"fn_name":null},{"line":76,"address":[89504,89517],"length":1,"stats":{"Line":4},"fn_name":"{closure#1}"},{"line":97,"address":[51423,49824,51389],"length":1,"stats":{"Line":1},"fn_name":"parse_input"},{"line":98,"address":[49873],"length":1,"stats":{"Line":1},"fn_name":null},{"line":99,"address":[49997,50102],"length":1,"stats":{"Line":1},"fn_name":null},{"line":100,"address":[50255,50084,50205],"length":1,"stats":{"Line":3},"fn_name":null},{"line":102,"address":[90672,90696],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":103,"address":[50239],"length":1,"stats":{"Line":3},"fn_name":null},{"line":104,"address":[50882,50389,50445],"length":1,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[50381,50786,50327,50415],"length":1,"stats":{"Line":0},"fn_name":null},{"line":107,"address":[50917,50355,51246],"length":1,"stats":{"Line":10},"fn_name":null},{"line":108,"address":[90976,91706,90879,91026],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":109,"address":[91090],"length":1,"stats":{"Line":2},"fn_name":null},{"line":110,"address":[91100],"length":1,"stats":{"Line":2},"fn_name":null},{"line":111,"address":[91213,91686,91069,91115,91269],"length":1,"stats":{"Line":0},"fn_name":null},{"line":112,"address":[91184,91239,91583],"length":1,"stats":{"Line":0},"fn_name":null},{"line":115,"address":[51087],"length":1,"stats":{"Line":2},"fn_name":null},{"line":116,"address":[51305],"length":1,"stats":{"Line":2},"fn_name":null},{"line":131,"address":[24976,24981],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":132,"address":[105175],"length":1,"stats":{"Line":1},"fn_name":null},{"line":133,"address":[105198,105284],"length":1,"stats":{"Line":2},"fn_name":null},{"line":134,"address":[105309,105415],"length":1,"stats":{"Line":2},"fn_name":null},{"line":138,"address":[25013,25008],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":139,"address":[105895],"length":1,"stats":{"Line":1},"fn_name":null},{"line":140,"address":[105918,106004],"length":1,"stats":{"Line":2},"fn_name":null},{"line":141,"address":[106135,106029],"length":1,"stats":{"Line":2},"fn_name":null}],"covered":49,"coverable":53},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-19","src","lib.rs"],"content":"//! Advent of Code 2015: Day 19: Medicine for Rudolph\n//!\n//! [https://adventofcode.com/2015/day/19](https://adventofcode.com/2015/day/19)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\nuse aoc_list as list;\n\npuzzle_info! {\n\tname = \"Medicine for Rudolph\";\n\tyear = 2015;\n\tday = 19;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\n/// Logic for solving the puzzles.\n///\npub mod logic {\n\n\tuse super::*;\n\tuse list::CharList;\n\tuse list::List;\n\tuse model::Input;\n\tuse nums::IntConv;\n\n\t#[ allow (clippy::string_slice) ]\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cu32\u003e {\n\t\tlet mut results = HashSet::new ();\n\t\tfor \u0026 (ref from, ref to) in input.replacements.iter () {\n\t\t\tlet mut last_pos = 0;\n\t\t\twhile let Some (pos) = input.medicine [last_pos .. ].find (from) {\n\t\t\t\tlet pos = last_pos + pos;\n\t\t\t\tlet new_molecule = format! (\"{}{}{}\",\n\t\t\t\t\t\u0026 input.medicine [ .. pos],\n\t\t\t\t\tto,\n\t\t\t\t\t\u0026 input.medicine [pos + from.len () .. ],\n\t\t\t\t);\n\t\t\t\tresults.insert (new_molecule);\n\t\t\t\tlast_pos = pos + from.len ();\n\t\t\t}\n\t\t}\n\t\tOk (results.len ().as_u32 ())\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cu32\u003e {\n\n\t\t// sanity checks\n\n\t\tif ! input.replacements.iter ().any (|\u0026 (ref from, _)| from == \"e\") {\n\t\t\tErr (\"Must have at least one replacement from \\\"e\\\"\") ?;\n\t\t}\n\n\t\tif input.medicine.len () \u003e 512 {\n\t\t\tErr (\"Medicine must be 512 chars or less\") ?;\n\t\t}\n\n\t\tif ! input.medicine.chars ().all (|ch| ch.is_ascii_alphanumeric ()) {\n\t\t\tErr (\"Medicine must be ASCII alphanumeric\") ?;\n\t\t}\n\n\t\tfor \u0026 (ref from, ref to) in input.replacements.iter () {\n\n\t\t\tif ! from.chars ().all (|ch| ch.is_ascii_alphanumeric ())\n\t\t\t\t\t|| ! to.chars ().all (|ch| ch.is_ascii_alphanumeric ()) {\n\t\t\t\tErr (\"All replacements must be ASCII alphanumeric\") ?;\n\t\t\t}\n\n\t\t\tif from.chars ()\n\t\t\t\t\t.filter (|ch| ch.is_ascii_uppercase () || ch.is_ascii_digit ())\n\t\t\t\t\t.count ()\n\t\t\t\t\u003e= to.chars ()\n\t\t\t\t\t.filter (|ch| ch.is_ascii_uppercase () || ch.is_ascii_digit ())\n\t\t\t\t\t.count () {\n\t\t\t\tErr (\"Replacements must always increase number of more ASCII uppercase/digits\") ?;\n\t\t\t}\n\n\t\t}\n\n\t\t// list of continuations to handle branching without recursion\n\n\t\tlet mut todo: VecDeque \u003c(u32, List \u003cString\u003e, CharList)\u003e = VecDeque::new ();\n\t\ttodo.push_back ((0, List::new (), CharList::from (\u0026 input.medicine)));\n\n\t\t// set of previous iterations to short circuit repeated evaluation of the same state\n\n\t\tlet mut seen: HashSet \u003c(List \u003cString\u003e, CharList)\u003e = HashSet::new ();\n\n\t\t// iterate over items from todo\n\n\t\tlet mut min_match = None;\n\t\t'OUTER: while let Some ((todo_steps, todo_prefix, todo_suffix)) = todo.pop_back () {\n\n\t\t\t// abort if it looks too complex, this is mostly to make fuzzing more practical\n\n\t\t\tif todo.len () \u003e= 1500 { Err (\"1500 states pending, giving up\") ?; }\n\t\t\tif seen.len () \u003e= 3000 { Err (\"3000 unique states seen, giving up\") ?; }\n\n\t\t\t// skip duplicated items\n\n\t\t\tif ! seen.insert ((todo_prefix.clone (), todo_suffix.clone ())) { continue }\n\n\t\t\t// output a message, disabled for now but could be added as a flag\n\n\t\t\tconst VERBOSE: bool = false;\n\t\t\t#[ allow (clippy::print_stdout) ]\n\t\t\tif VERBOSE {\n\t\t\t\tif todo_prefix.is_empty () {\n\t\t\t\t\tprintln! (\"queue={} steps={} {}\", todo.len (), todo_steps, todo_suffix);\n\t\t\t\t} else {\n\t\t\t\t\tprintln! (\"queue={} steps={} {} | {}\", todo.len (), todo_steps,\n\t\t\t\t\t\ttodo_prefix.iter ().join (\" | \"), todo_suffix);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// add todo items for any replacements at the start of the suffix, also detect success\n\n\t\t\tfor \u0026 (ref from, ref to) in input.replacements.iter () {\n\t\t\t\tif from == \"e\" {\n\n\t\t\t\t\t// detect success\n\n\t\t\t\t\tif todo_prefix.is_empty () \u0026\u0026 to == todo_suffix {\n\t\t\t\t\t\t// TODO I am not entirely convinced that this is so simple, but I got the\n\t\t\t\t\t\t// right answer, so... I am /guessing/ that this has something to do with\n\t\t\t\t\t\t// this being an implementation of a greedy matcher, always trying to match\n\t\t\t\t\t\t// on the left first then recursing. But i would like to think about this a\n\t\t\t\t\t\t// bit more.\n\t\t\t\t\t\tmin_match = Some (todo_steps + 1);\n\t\t\t\t\t\tbreak 'OUTER;\n\t\t\t\t\t}\n\n\t\t\t\t\t// never reduce a partial match to \"e\", it's only valid if it replaces the\n\t\t\t\t\t// entire molecule\n\n\t\t\t\t} else if let Some (suffix) = todo_suffix.strip_prefix (to) {\n\t\t\t\t\tif todo_prefix.is_empty () {\n\n\t\t\t\t\t\t// no prefix: add the split with no prefix also\n\n\t\t\t\t\t\ttodo.push_back ((\n\t\t\t\t\t\t\ttodo_steps + 1,\n\t\t\t\t\t\t\tList::new (),\n\t\t\t\t\t\t\tsuffix.prepend (from),\n\t\t\t\t\t\t));\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\t// some prefix: continue with the last item removed\n\n\t\t\t\t\t\ttodo.push_back ((\n\t\t\t\t\t\t\ttodo_steps + 1,\n\t\t\t\t\t\t\ttodo_prefix.tail ().cloned ().unwrap (),\n\t\t\t\t\t\t\tsuffix.prepend (from)\n\t\t\t\t\t\t\t\t.prepend (todo_prefix.head ().unwrap ()),\n\t\t\t\t\t\t));\n\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// no match, carry on\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// add todo items for possible splits: at some point we have to match a replacement at\n\t\t\t// the start of the molecule, so we must be able to reduce some suffix of the current\n\t\t\t// molecule into something so that we can reduce the new combined prefix and suffix.\n\t\t\t// so, we iterate over prefixes but stop when our prefix is not itself a prefix of any\n\t\t\t// replacements, since we know that it can't possibly be reduced further whatever the\n\t\t\t// suffix changes into.\n\n\t\t\tlet mut prefix = String::new ();\n\t\t\tlet mut suffix = \u0026 todo_suffix;\n\t\t\twhile let Some ((\u0026 head, tail)) = suffix.cons () {\n\t\t\t\tprefix.push (head);\n\t\t\t\tsuffix = tail;\n\t\t\t\tif ! input.replacements.iter ()\n\t\t\t\t\t\t.any (|\u0026 (_, ref to)| to.starts_with (\u0026 prefix)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\ttodo.push_back ((\n\t\t\t\t\ttodo_steps,\n\t\t\t\t\ttodo_prefix.push_front (prefix.clone ()),\n\t\t\t\t\tsuffix.clone (),\n\t\t\t\t));\n\t\t\t}\n\n\t\t}\n\n\t\t// return result or error\n\n\t\tOk (min_match.ok_or (\"No solution found\") ?)\n\n\t}\n\n\t#[ cfg (test) ]\n\tmod tests {\n\n\t\tuse super::*;\n\n\t\t#[ test ]\n\t\tfn part_two () {\n\t\t\tassert_err! (\"Must have at least one replacement from \\\"e\\\"\",\n\t\t\t\tlogic::part_two (\u0026 Input::parse (\u0026 [\"a =\u003e b\", \"c =\u003e d\", \"\", \"whatever\"]).unwrap ()));\n\t\t}\n\n\t}\n\n}\n\n/// Representation of the puzzle input, etc.\n///\npub mod model {\n\n\tuse super::*;\n\tuse parser::*;\n\n\t#[ derive (Clone, Debug) ]\n\tpub struct Input {\n\t\tpub replacements: Replacements,\n\t\tpub medicine: String,\n\t}\n\n\tpub type Replacements = Vec \u003cReplacement\u003e;\n\tpub type Replacement = (String, String);\n\n\timpl Input {\n\t\tpub fn parse (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tif input.len () \u003c 3 { Err (\"Invalid input\") ?; }\n\t\t\tif ! input [input.len () - 2].is_empty () { Err (\"Invalid input\") ?; }\n\t\t\tlet is_chem = |input: \u0026 str| input.chars ().all (|ch| ch.is_ascii_alphanumeric ());\n\t\t\tlet replacements = input [0 .. input.len () - 2].iter ().enumerate ()\n\t\t\t\t.map (|(line_idx, line)|\n\t\t\t\t\tParser::wrap (line, |parser| {\n\t\t\t\t\t\tparser.set_ignore_whitespace (true);\n\t\t\t\t\t\tlet from = parser.word_if (is_chem) ?;\n\t\t\t\t\t\tlet to = parser.expect_word (\"=\u003e\") ?.word_if (is_chem) ?;\n\t\t\t\t\t\tparser.end () ?;\n\t\t\t\t\t\tif to.len () \u003c from.len () { Err (parser.err ()) ?; }\n\t\t\t\t\t\tOk ((from.to_owned (), to.to_owned ()))\n\t\t\t\t\t}).map_parse_err (|col_idx| format! (\n\t\t\t\t\t\t\"Invalid input: line {}: col {}: {}\", line_idx + 1, col_idx + 1, line))\n\t\t\t\t).collect::\u003cGenResult \u003cReplacements\u003e\u003e () ?;\n\t\t\tlet medicine = input.last ().unwrap ().deref ().to_owned ();\n\t\t\tif medicine.is_empty () { Err (\"Medicine must be at least one character\") ?; }\n\t\t\tOk (Self { replacements, medicine })\n\t\t}\n\t}\n\n\t#[ cfg (test) ]\n\tmod tests {\n\n\t\tuse super::*;\n\n\t\t#[ test ]\n\t\tfn input_parse () {\n\t\t\tassert_err! (\"Invalid input: line 1: col 5: a =\u003e\",\n\t\t\t\tmodel::Input::parse (\u0026 [ \"a =\u003e\", \"\", \"whatever\" ]));\n\t\t}\n\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE_ONE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"H =\u003e HO\",\n\t\t\"H =\u003e OH\",\n\t\t\"O =\u003e HH\",\n\t\t\"\",\n\t\t\"HOH\",\n\t];\n\n\tconst EXAMPLE_TWO: \u0026 [\u0026 str] = \u0026 [\n\t\t\"e =\u003e H\",\n\t\t\"e =\u003e O\",\n\t\t\"H =\u003e HO\",\n\t\t\"H =\u003e OH\",\n\t\t\"O =\u003e HH\",\n\t\t\"\",\n\t\t\"HOH\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"4\", puzzle.part_one (EXAMPLE_ONE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"3\", puzzle.part_two (EXAMPLE_TWO));\n\t}\n\n}\n","traces":[{"line":14,"address":[78083,78803],"length":1,"stats":{"Line":2},"fn_name":null},{"line":15,"address":[78224],"length":1,"stats":{"Line":1},"fn_name":null},{"line":16,"address":[78944],"length":1,"stats":{"Line":1},"fn_name":null},{"line":30,"address":[97360,98780],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":31,"address":[97399],"length":1,"stats":{"Line":1},"fn_name":null},{"line":32,"address":[97499,97683,97420],"length":1,"stats":{"Line":3},"fn_name":null},{"line":33,"address":[97727],"length":1,"stats":{"Line":1},"fn_name":null},{"line":34,"address":[98683,97747],"length":1,"stats":{"Line":2},"fn_name":null},{"line":35,"address":[98012,97915],"length":1,"stats":{"Line":1},"fn_name":null},{"line":36,"address":[98076,98366],"length":1,"stats":{"Line":2},"fn_name":null},{"line":37,"address":[97962,98060],"length":1,"stats":{"Line":2},"fn_name":null},{"line":39,"address":[98208],"length":1,"stats":{"Line":1},"fn_name":null},{"line":41,"address":[98567],"length":1,"stats":{"Line":1},"fn_name":null},{"line":42,"address":[98630,98688],"length":1,"stats":{"Line":1},"fn_name":null},{"line":45,"address":[97665,98729],"length":1,"stats":{"Line":2},"fn_name":null},{"line":48,"address":[104527,100858,98832],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":52,"address":[80862,80848],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":53,"address":[99019],"length":1,"stats":{"Line":1},"fn_name":null},{"line":56,"address":[98997,99184],"length":1,"stats":{"Line":2},"fn_name":null},{"line":57,"address":[99230],"length":1,"stats":{"Line":0},"fn_name":null},{"line":60,"address":[80912,80925],"length":1,"stats":{"Line":4},"fn_name":"{closure#1}"},{"line":61,"address":[99480],"length":1,"stats":{"Line":0},"fn_name":null},{"line":64,"address":[99454,99796,99642],"length":1,"stats":{"Line":3},"fn_name":null},{"line":66,"address":[80973,80960],"length":1,"stats":{"Line":4},"fn_name":"{closure#2}"},{"line":67,"address":[81021,81008],"length":1,"stats":{"Line":4},"fn_name":"{closure#3}"},{"line":68,"address":[100101],"length":1,"stats":{"Line":0},"fn_name":null},{"line":71,"address":[100263,100498,100075],"length":1,"stats":{"Line":3},"fn_name":null},{"line":72,"address":[81056,81088],"length":1,"stats":{"Line":2},"fn_name":"{closure#4}"},{"line":74,"address":[100358],"length":1,"stats":{"Line":1},"fn_name":null},{"line":75,"address":[81200,81168],"length":1,"stats":{"Line":2},"fn_name":"{closure#5}"},{"line":77,"address":[100507],"length":1,"stats":{"Line":0},"fn_name":null},{"line":84,"address":[99778],"length":1,"stats":{"Line":1},"fn_name":null},{"line":85,"address":[100657,100728],"length":1,"stats":{"Line":2},"fn_name":null},{"line":89,"address":[100877],"length":1,"stats":{"Line":1},"fn_name":null},{"line":93,"address":[100884],"length":1,"stats":{"Line":1},"fn_name":null},{"line":94,"address":[102621,101668,100958,102551,104330,101975,101077,100911],"length":1,"stats":{"Line":6},"fn_name":null},{"line":98,"address":[101062,101149,101183],"length":1,"stats":{"Line":2},"fn_name":null},{"line":99,"address":[101430,101396,101165],"length":1,"stats":{"Line":2},"fn_name":null},{"line":103,"address":[101752,101412],"length":1,"stats":{"Line":2},"fn_name":null},{"line":120,"address":[101918,102188,102012],"length":1,"stats":{"Line":3},"fn_name":null},{"line":121,"address":[102224],"length":1,"stats":{"Line":1},"fn_name":null},{"line":125,"address":[102308],"length":1,"stats":{"Line":1},"fn_name":null},{"line":131,"address":[102412,102501],"length":1,"stats":{"Line":1},"fn_name":null},{"line":138,"address":[102266,102945],"length":1,"stats":{"Line":2},"fn_name":null},{"line":139,"address":[103038],"length":1,"stats":{"Line":1},"fn_name":null},{"line":143,"address":[103311],"length":1,"stats":{"Line":1},"fn_name":null},{"line":144,"address":[103105,103137],"length":1,"stats":{"Line":1},"fn_name":null},{"line":145,"address":[103122,103178],"length":1,"stats":{"Line":2},"fn_name":null},{"line":146,"address":[103281,103186],"length":1,"stats":{"Line":2},"fn_name":null},{"line":153,"address":[103785],"length":1,"stats":{"Line":1},"fn_name":null},{"line":154,"address":[103072,103393],"length":1,"stats":{"Line":1},"fn_name":null},{"line":155,"address":[103378,103434],"length":1,"stats":{"Line":2},"fn_name":null},{"line":156,"address":[103511,103761,103606],"length":1,"stats":{"Line":3},"fn_name":null},{"line":157,"address":[103702,103645],"length":1,"stats":{"Line":2},"fn_name":null},{"line":173,"address":[102178],"length":1,"stats":{"Line":1},"fn_name":null},{"line":174,"address":[103905],"length":1,"stats":{"Line":1},"fn_name":null},{"line":175,"address":[103921,104004],"length":1,"stats":{"Line":2},"fn_name":null},{"line":176,"address":[104092],"length":1,"stats":{"Line":1},"fn_name":null},{"line":177,"address":[104134],"length":1,"stats":{"Line":1},"fn_name":null},{"line":178,"address":[104228,104142],"length":1,"stats":{"Line":2},"fn_name":null},{"line":179,"address":[81312,81280],"length":1,"stats":{"Line":3},"fn_name":"{closure#6}"},{"line":182,"address":[104468],"length":1,"stats":{"Line":1},"fn_name":null},{"line":184,"address":[104269,104367],"length":1,"stats":{"Line":2},"fn_name":null},{"line":185,"address":[104392],"length":1,"stats":{"Line":1},"fn_name":null},{"line":193,"address":[102745,102824,102579],"length":1,"stats":{"Line":2},"fn_name":null},{"line":203,"address":[36361,35920,36322],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":204,"address":[35999,36333],"length":1,"stats":{"Line":1},"fn_name":null},{"line":205,"address":[35927],"length":1,"stats":{"Line":1},"fn_name":null},{"line":229,"address":[61065,59456,61036],"length":1,"stats":{"Line":2},"fn_name":"parse"},{"line":230,"address":[59544,59508],"length":1,"stats":{"Line":2},"fn_name":null},{"line":231,"address":[59859,59711,59519],"length":1,"stats":{"Line":4},"fn_name":null},{"line":232,"address":[94656,94752,94765,94701],"length":1,"stats":{"Line":8},"fn_name":"{closure#0}"},{"line":233,"address":[60397,60023,59834,60178],"length":1,"stats":{"Line":7},"fn_name":null},{"line":234,"address":[60162],"length":1,"stats":{"Line":8},"fn_name":null},{"line":235,"address":[94944,95250,94906,96406,94847],"length":1,"stats":{"Line":10},"fn_name":"{closure#0}"},{"line":236,"address":[94990],"length":1,"stats":{"Line":2},"fn_name":null},{"line":237,"address":[95136,95005],"length":1,"stats":{"Line":2},"fn_name":null},{"line":238,"address":[95579,95104,95258,95455],"length":1,"stats":{"Line":7},"fn_name":null},{"line":239,"address":[95559,95775,95700],"length":1,"stats":{"Line":4},"fn_name":null},{"line":240,"address":[95906,95758,95962],"length":1,"stats":{"Line":4},"fn_name":null},{"line":241,"address":[96220,95939],"length":1,"stats":{"Line":4},"fn_name":null},{"line":242,"address":[96526,96448,94886,96616,96677],"length":1,"stats":{"Line":6},"fn_name":"{closure#1}"},{"line":243,"address":[96491,96552,96642],"length":1,"stats":{"Line":1},"fn_name":null},{"line":245,"address":[60345,60459],"length":1,"stats":{"Line":4},"fn_name":null},{"line":246,"address":[60537,60596,60848],"length":1,"stats":{"Line":4},"fn_name":null},{"line":247,"address":[60614],"length":1,"stats":{"Line":2},"fn_name":null},{"line":257,"address":[32512,32517],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":258,"address":[49805,50090],"length":1,"stats":{"Line":2},"fn_name":null},{"line":259,"address":[49783],"length":1,"stats":{"Line":1},"fn_name":null},{"line":290,"address":[33808,34371,34417],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":291,"address":[33815],"length":1,"stats":{"Line":1},"fn_name":null},{"line":292,"address":[33978,33838,33912],"length":1,"stats":{"Line":3},"fn_name":null},{"line":296,"address":[35057,34448,35011],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":297,"address":[34455],"length":1,"stats":{"Line":1},"fn_name":null},{"line":298,"address":[34552,34618,34478],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":91,"coverable":95},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-20","src","lib.rs"],"content":"//! Advent of Code 2015: Day 20: Infinite Elves and Infinite Houses\n//!\n//! [https://adventofcode.com/2015/day/20](https://adventofcode.com/2015/day/20)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Infinite Elves and Infinite Houses\";\n\tyear = 2015;\n\tday = 20;\n\tparse = |input| input [0].parse::\u003cu32\u003e ();\n\tpart_one = |input| logic::part_one (input);\n\tpart_two = |input| logic::part_two (input);\n}\n\n/// Logic for solving the puzzles.\n///\npub mod logic {\n\n\tuse super::*;\n\tuse nums::{ Int, IntConv, NumResult };\n\n\tpub type Val = u32;\n\n\tpub fn part_one (input: Val) -\u003e GenResult \u003cVal\u003e {\n\t\tOk (calc_result (input, 10, Val::MAX) ?)\n\t}\n\n\tpub fn part_two (input: Val) -\u003e GenResult \u003cVal\u003e {\n\t\tOk (calc_result (input, 11, 50) ?)\n\t}\n\n\tpub fn calc_result (input: Val, mul: Val, lim: Val) -\u003e NumResult \u003cVal\u003e {\n\n\t\tlet mut divs = Vec::new ();\n\t\tlet mut extend_sqrt = Val::ONE;\n\t\tlet mut extend = Val::ONE;\n\n\t\tfor house in Val::ONE .. {\n\t\t\tlet mut total = Val::ZERO;\n\n\t\t\t// decrement all the values in `divs`, or if they are at zero then include the\n\t\t\t// corresponding \"elf\" and its complement in the total and reset to the elf's number\n\t\t\t// minus one\n\n\t\t\tlet mut div = Val::ZERO;\n\t\t\tfor next in divs.iter_mut () {\n\t\t\t\tdiv = Val::add_2 (div, Val::ONE) ?;\n\t\t\t\tif * next == Val::ZERO {\n\t\t\t\t\t* next = Val::sub_2 (div, 1) ?;\n\t\t\t\t\tlet comp =\n\t\t\t\t\t\tif div == Val::ONE { house }\n\t\t\t\t\t\telse if div == 2 { house \u003e\u003e 1_i32 }\n\t\t\t\t\t\telse { Val::div_2 (house, div) ? };\n\t\t\t\t\tif comp \u003c= lim {\n\t\t\t\t\t\ttotal = Val::add_2 (total, Val::mul_2 (div, mul) ?) ?;\n\t\t\t\t\t}\n\t\t\t\t\tif comp != div \u0026\u0026 div \u003c= lim {\n\t\t\t\t\t\ttotal = Val::add_2 (total, Val::mul_2 (comp, mul) ?) ?;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t* next = Val::sub_2 (* next, Val::ONE) ?;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// once the house square root reaches a new integer we add it to divs, also we have to\n\t\t\t// include the corresponding elf in our total\n\n\t\t\tif house == extend {\n\t\t\t\tif divs.is_empty () {\n\t\t\t\t\tdivs.push (Val::ZERO);\n\t\t\t\t} else {\n\t\t\t\t\tdivs.push (Val::from_usize (divs.len ()) ?);\n\t\t\t\t}\n\t\t\t\ttotal = Val::add_2 (total, Val::mul_2 (extend_sqrt, mul) ?) ?;\n\t\t\t\textend_sqrt = Val::add_2 (extend_sqrt, Val::ONE) ?;\n\t\t\t\textend = Val::mul_2 (extend_sqrt, extend_sqrt) ?;\n\t\t\t}\n\n\t\t\t// return when we find a solution\n\n\t\t\tif total \u003e= input { return Ok (house) }\n\n\t\t}\n\n\t\tunreachable! ();\n\n\t}\n\n}\n\n#[ cfg (test) ]\nmod tests {\n\n\tuse super::*;\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"1\", puzzle.part_one (\u0026 [ \"1\" ]));\n\t\tassert_eq_ok! (\"1\", puzzle.part_one (\u0026 [ \"10\" ]));\n\t\tassert_eq_ok! (\"6\", puzzle.part_one (\u0026 [ \"100\" ]));\n\t\tassert_eq_ok! (\"48\", puzzle.part_one (\u0026 [ \"1000\" ]));\n\t\tassert_eq_ok! (\"360\", puzzle.part_one (\u0026 [ \"10000\" ]));\n\t\tassert_eq_ok! (\"3120\", puzzle.part_one (\u0026 [ \"100000\" ]));\n\t\tassert_eq_ok! (\"27720\", puzzle.part_one (\u0026 [ \"1000000\" ]));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"1\", puzzle.part_two (\u0026 [ \"1\" ]));\n\t\tassert_eq_ok! (\"1\", puzzle.part_two (\u0026 [ \"10\" ]));\n\t\tassert_eq_ok! (\"6\", puzzle.part_two (\u0026 [ \"100\" ]));\n\t\tassert_eq_ok! (\"36\", puzzle.part_two (\u0026 [ \"1000\" ]));\n\t\tassert_eq_ok! (\"336\", puzzle.part_two (\u0026 [ \"10000\" ]));\n\t\tassert_eq_ok! (\"2880\", puzzle.part_two (\u0026 [ \"100000\" ]));\n\t\tassert_eq_ok! (\"25200\", puzzle.part_two (\u0026 [ \"1000000\" ]));\n\t}\n\n}\n","traces":[{"line":13,"address":[46275,46819],"length":1,"stats":{"Line":2},"fn_name":null},{"line":14,"address":[46420],"length":1,"stats":{"Line":1},"fn_name":null},{"line":15,"address":[46964],"length":1,"stats":{"Line":1},"fn_name":null},{"line":27,"address":[39888],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":28,"address":[39917,40009],"length":1,"stats":{"Line":1},"fn_name":null},{"line":31,"address":[40032],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":32,"address":[40061,40153],"length":1,"stats":{"Line":1},"fn_name":null},{"line":35,"address":[43640,40176],"length":1,"stats":{"Line":2},"fn_name":"calc_result"},{"line":37,"address":[40225],"length":1,"stats":{"Line":2},"fn_name":null},{"line":38,"address":[40238],"length":1,"stats":{"Line":2},"fn_name":null},{"line":39,"address":[40249],"length":1,"stats":{"Line":2},"fn_name":null},{"line":41,"address":[40339,40260,40454],"length":1,"stats":{"Line":6},"fn_name":null},{"line":42,"address":[40475],"length":1,"stats":{"Line":2},"fn_name":null},{"line":48,"address":[40486],"length":1,"stats":{"Line":2},"fn_name":null},{"line":49,"address":[40727,40505],"length":1,"stats":{"Line":4},"fn_name":null},{"line":50,"address":[40905,40751],"length":1,"stats":{"Line":2},"fn_name":null},{"line":51,"address":[42562,40898],"length":1,"stats":{"Line":4},"fn_name":null},{"line":52,"address":[41022,41176],"length":1,"stats":{"Line":2},"fn_name":null},{"line":53,"address":[41260,41164],"length":1,"stats":{"Line":4},"fn_name":null},{"line":55,"address":[41241,41455,41299,41532],"length":1,"stats":{"Line":8},"fn_name":null},{"line":56,"address":[41460,41321],"length":1,"stats":{"Line":2},"fn_name":null},{"line":57,"address":[41916,41274],"length":1,"stats":{"Line":4},"fn_name":null},{"line":58,"address":[41576,41921],"length":1,"stats":{"Line":2},"fn_name":null},{"line":60,"address":[42383,41544,41986],"length":1,"stats":{"Line":4},"fn_name":null},{"line":61,"address":[42043,42388],"length":1,"stats":{"Line":2},"fn_name":null},{"line":64,"address":[40991,42467,42567],"length":1,"stats":{"Line":4},"fn_name":null},{"line":71,"address":[40709,43528],"length":1,"stats":{"Line":4},"fn_name":null},{"line":72,"address":[42665],"length":1,"stats":{"Line":2},"fn_name":null},{"line":73,"address":[42725],"length":1,"stats":{"Line":2},"fn_name":null},{"line":75,"address":[42785,42700],"length":1,"stats":{"Line":4},"fn_name":null},{"line":77,"address":[42962,43222,42741],"length":1,"stats":{"Line":4},"fn_name":null},{"line":78,"address":[43283,43387,43195],"length":1,"stats":{"Line":4},"fn_name":null},{"line":79,"address":[43533,43448,43363],"length":1,"stats":{"Line":4},"fn_name":null},{"line":84,"address":[42639,43593],"length":1,"stats":{"Line":4},"fn_name":null},{"line":100,"address":[48412,47728,51911],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":101,"address":[47735],"length":1,"stats":{"Line":1},"fn_name":null},{"line":102,"address":[47896,47971,47812],"length":1,"stats":{"Line":3},"fn_name":null},{"line":103,"address":[48545,48423],"length":1,"stats":{"Line":2},"fn_name":null},{"line":104,"address":[49109,48987],"length":1,"stats":{"Line":2},"fn_name":null},{"line":105,"address":[49673,49551],"length":1,"stats":{"Line":2},"fn_name":null},{"line":106,"address":[50115,50237],"length":1,"stats":{"Line":2},"fn_name":null},{"line":107,"address":[50661,50777],"length":1,"stats":{"Line":2},"fn_name":null},{"line":108,"address":[51186,51302],"length":1,"stats":{"Line":2},"fn_name":null},{"line":112,"address":[51936,52620,56119],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":113,"address":[51943],"length":1,"stats":{"Line":1},"fn_name":null},{"line":114,"address":[52020,52104,52179],"length":1,"stats":{"Line":3},"fn_name":null},{"line":115,"address":[52631,52753],"length":1,"stats":{"Line":2},"fn_name":null},{"line":116,"address":[53195,53317],"length":1,"stats":{"Line":2},"fn_name":null},{"line":117,"address":[53881,53759],"length":1,"stats":{"Line":2},"fn_name":null},{"line":118,"address":[54323,54445],"length":1,"stats":{"Line":2},"fn_name":null},{"line":119,"address":[54985,54869],"length":1,"stats":{"Line":2},"fn_name":null},{"line":120,"address":[55510,55394],"length":1,"stats":{"Line":2},"fn_name":null}],"covered":52,"coverable":52},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-21","src","lib.rs"],"content":"//! Advent of Code 2015: Day 21: RPG Simulator 20XX\n//!\n//! [https://adventofcode.com/2015/day/21](https://adventofcode.com/2015/day/21)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"RPG Simulator 20XX\";\n\tyear = 2015;\n\tday = 21;\n\tparse = |input| model::Stats::parse (input);\n\tpart_one = |input| Ok::\u003c_, Infallible\u003e (logic::part_one (input));\n\tpart_two = |input| Ok::\u003c_, Infallible\u003e (logic::part_two (input));\n}\n\n/// Logic for solving the puzzles.\n///\npub mod logic {\n\n\tuse super::*;\n\tuse model::Stats;\n\n\t#[ must_use ]\n\tpub fn part_one (boss: Stats) -\u003e u32 {\n\t\tchoices ()\n\t\t\t.filter (|\u0026 (_, player)| outcome (player, boss))\n\t\t\t.map (|(gold, _)| gold)\n\t\t\t.min ()\n\t\t\t.unwrap ()\n\t}\n\n\t#[ must_use ]\n\tpub fn part_two (boss: Stats) -\u003e u32 {\n\t\tchoices ()\n\t\t\t.filter (|\u0026 (_, player)| ! outcome (player, boss))\n\t\t\t.map (|(gold, _)| gold)\n\t\t\t.max ()\n\t\t\t.unwrap ()\n\t}\n\n\tfn choices () -\u003e impl Iterator \u003cItem = (u32, Stats)\u003e {\n\t\tPLAYER_STATS [0].iter ()\n\t\t\t.cartesian_product (PLAYER_STATS [1].iter ())\n\t\t\t.cartesian_product (PLAYER_STATS [2].iter ())\n\t\t\t.map (|((\u0026 a, \u0026 b), \u0026 c)| (a, b, c))\n\t\t\t.map (|(\n\t\t\t\t\t(gld_0, dmg_0, arm_0),\n\t\t\t\t\t(gld_1, dmg_1, arm_1),\n\t\t\t\t\t(gld_2, dmg_2, arm_2),\n\t\t\t\t)| (\n\t\t\t\t\tgld_0 + gld_1 + gld_2,\n\t\t\t\t\tStats {\n\t\t\t\t\t\thit_points: 100,\n\t\t\t\t\t\tdamage: dmg_0 + dmg_1 + dmg_2,\n\t\t\t\t\t\tarmor: arm_0 + arm_1 + arm_2,\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t)\n\t}\n\n\tconst fn outcome (player: Stats, boss: Stats) -\u003e bool {\n\n\t\tlet mut player_hp = player.hit_points;\n\t\tlet mut boss_hp = boss.hit_points;\n\n\t\tlet player_attack = if player.damage \u003e boss.armor {\n\t\t\tplayer.damage - boss.armor\n\t\t} else { 1 };\n\n\t\tlet boss_attack = if boss.damage \u003e player.armor {\n\t\t\tboss.damage - player.armor\n\t\t} else { 1 };\n\n\t\tloop {\n\n\t\t\tif boss_hp \u003c= player_attack { return true }\n\t\t\tboss_hp -= player_attack;\n\n\t\t\tif player_hp \u003c= boss_attack { return false }\n\t\t\tplayer_hp -= boss_attack;\n\n\t\t}\n\n\t}\n\n\tconst PLAYER_STATS: \u0026 [\u0026 [(u32, u32, u32)]] = \u0026 [\n\n\t\t// weapons\n\t\t\u0026 [ (8, 4, 0), (10, 5, 0), (25, 6, 0), (40, 7, 0), (74, 8, 0) ],\n\n\t\t// armor\n\t\t\u0026 [ (0, 0, 0), (13, 0, 1), (31, 0, 2), (53, 0, 3), (75, 0, 4), (102, 0, 5) ],\n\n\t\t// rings\n\t\t\u0026 [\n\t\t\t(0, 0, 0), (25, 1, 0), (50, 2, 0), (100, 3, 0), (20, 0, 1), (40, 0, 2), (80, 0, 3),\n\t\t\t(75, 3, 0), (125, 4, 0), (45, 1, 1), (65, 1, 2), (105, 1, 3), (150, 5, 0), (70, 2, 1),\n\t\t\t(90, 2, 2), (130, 2, 3), (120, 3, 1), (140, 3, 2), (180, 3, 3), (60, 0, 3),\n\t\t\t(100, 0, 4), (120, 0, 5),\n\t\t],\n\n\t];\n\n}\n\n/// Representation of the puzzle input, etc.\n///\npub mod model {\n\n\tuse super::*;\n\tuse parser::*;\n\n\t#[ derive (Clone, Copy, Debug) ]\n\tpub struct Stats {\n\t\tpub hit_points: u32,\n\t\tpub damage: u32,\n\t\tpub armor: u32,\n\t}\n\n\timpl Stats {\n\t\tpub fn parse (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tif input.len () != 3 { Err (\"Invalid input\") ?; }\n\t\t\tfn parse_line (line_idx: usize, line: \u0026 str, expect: \u0026 str) -\u003e GenResult \u003cu32\u003e {\n\t\t\t\tParser::wrap (line, |parser| {\n\t\t\t\t\tlet value = parser.expect (expect) ?.int () ?;\n\t\t\t\t\tparser.end () ?;\n\t\t\t\t\tOk (value)\n\t\t\t\t}).map_parse_err (|_| format! (\"Invalid input: line {}: {}\", line_idx + 1, line))\n\t\t\t}\n\t\t\tlet hit_points = parse_line (0, input [0], \"Hit Points: \") ?;\n\t\t\tlet damage = parse_line (1, input [1], \"Damage: \") ?;\n\t\t\tlet armor = parse_line (2, input [2], \"Armor: \") ?;\n\t\t\tOk (Self { hit_points, damage, armor })\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod tests {\n\n\tuse super::*;\n\n\tconst EXAMPLES: \u0026 [\u0026 [\u0026 str]] = \u0026 [\n\t\t\u0026 [ \"Hit Points: 100\", \"Damage: 3\", \"Armor: 3\" ],\n\t\t\u0026 [ \"Hit Points: 100\", \"Damage: 3\", \"Armor: 4\" ],\n\t\t\u0026 [ \"Hit Points: 100\", \"Damage: 3\", \"Armor: 5\" ],\n\t\t\u0026 [ \"Hit Points: 100\", \"Damage: 4\", \"Armor: 3\" ],\n\t\t\u0026 [ \"Hit Points: 100\", \"Damage: 4\", \"Armor: 4\" ],\n\t\t\u0026 [ \"Hit Points: 100\", \"Damage: 4\", \"Armor: 5\" ],\n\t\t\u0026 [ \"Hit Points: 100\", \"Damage: 5\", \"Armor: 3\" ],\n\t\t\u0026 [ \"Hit Points: 100\", \"Damage: 5\", \"Armor: 4\" ],\n\t\t\u0026 [ \"Hit Points: 100\", \"Damage: 5\", \"Armor: 5\" ],\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"23\", puzzle.part_one (EXAMPLES [0]));\n\t\tassert_eq_ok! (\"38\", puzzle.part_one (EXAMPLES [1]));\n\t\tassert_eq_ok! (\"39\", puzzle.part_one (EXAMPLES [2]));\n\t\tassert_eq_ok! (\"38\", puzzle.part_one (EXAMPLES [3]));\n\t\tassert_eq_ok! (\"53\", puzzle.part_one (EXAMPLES [4]));\n\t\tassert_eq_ok! (\"59\", puzzle.part_one (EXAMPLES [5]));\n\t\tassert_eq_ok! (\"53\", puzzle.part_one (EXAMPLES [6]));\n\t\tassert_eq_ok! (\"71\", puzzle.part_one (EXAMPLES [7]));\n\t\tassert_eq_ok! (\"79\", puzzle.part_one (EXAMPLES [8]));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"33\", puzzle.part_two (EXAMPLES [0]));\n\t\tassert_eq_ok! (\"58\", puzzle.part_two (EXAMPLES [1]));\n\t\tassert_eq_ok! (\"108\", puzzle.part_two (EXAMPLES [2]));\n\t\tassert_eq_ok! (\"58\", puzzle.part_two (EXAMPLES [3]));\n\t\tassert_eq_ok! (\"108\", puzzle.part_two (EXAMPLES [4]));\n\t\tassert_eq_ok! (\"133\", puzzle.part_two (EXAMPLES [5]));\n\t\tassert_eq_ok! (\"108\", puzzle.part_two (EXAMPLES [6]));\n\t\tassert_eq_ok! (\"133\", puzzle.part_two (EXAMPLES [7]));\n\t\tassert_eq_ok! (\"158\", puzzle.part_two (EXAMPLES [8]));\n\t}\n\n}\n","traces":[{"line":13,"address":[76419,75891],"length":1,"stats":{"Line":2},"fn_name":null},{"line":14,"address":[75973,76078],"length":1,"stats":{"Line":2},"fn_name":null},{"line":15,"address":[76501,76606],"length":1,"stats":{"Line":2},"fn_name":null},{"line":26,"address":[74048],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":27,"address":[74060,74086],"length":1,"stats":{"Line":2},"fn_name":null},{"line":28,"address":[66544,66558],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":29,"address":[66664,66656],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":35,"address":[74192],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":36,"address":[74204,74230],"length":1,"stats":{"Line":2},"fn_name":null},{"line":37,"address":[66688,66702],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":38,"address":[66800,66808],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":43,"address":[74336],"length":1,"stats":{"Line":1},"fn_name":"choices"},{"line":44,"address":[74432,74353,74483],"length":1,"stats":{"Line":3},"fn_name":null},{"line":45,"address":[74382],"length":1,"stats":{"Line":1},"fn_name":null},{"line":46,"address":[74445],"length":1,"stats":{"Line":1},"fn_name":null},{"line":47,"address":[66844,66832],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":48,"address":[67008],"length":1,"stats":{"Line":1},"fn_name":"{closure#1}"},{"line":49,"address":[67035],"length":1,"stats":{"Line":1},"fn_name":null},{"line":50,"address":[67063],"length":1,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[67101],"length":1,"stats":{"Line":1},"fn_name":null},{"line":52,"address":[67459],"length":1,"stats":{"Line":1},"fn_name":null},{"line":53,"address":[67143,67232],"length":1,"stats":{"Line":1},"fn_name":null},{"line":54,"address":[67443],"length":1,"stats":{"Line":1},"fn_name":null},{"line":56,"address":[67338,67217,67270],"length":1,"stats":{"Line":2},"fn_name":null},{"line":57,"address":[67376,67323,67485],"length":1,"stats":{"Line":2},"fn_name":null},{"line":63,"address":[74560],"length":1,"stats":{"Line":1},"fn_name":"outcome"},{"line":65,"address":[74574],"length":1,"stats":{"Line":1},"fn_name":null},{"line":66,"address":[74580],"length":1,"stats":{"Line":1},"fn_name":null},{"line":68,"address":[74639,74586,74602],"length":1,"stats":{"Line":3},"fn_name":null},{"line":69,"address":[74614,74641],"length":1,"stats":{"Line":1},"fn_name":null},{"line":70,"address":[74594],"length":1,"stats":{"Line":1},"fn_name":null},{"line":72,"address":[74734,74697,74681],"length":1,"stats":{"Line":3},"fn_name":null},{"line":73,"address":[74709,74736],"length":1,"stats":{"Line":1},"fn_name":null},{"line":74,"address":[74689],"length":1,"stats":{"Line":1},"fn_name":null},{"line":76,"address":[74904],"length":1,"stats":{"Line":1},"fn_name":null},{"line":78,"address":[74799,74766],"length":1,"stats":{"Line":2},"fn_name":null},{"line":79,"address":[74822,74838,74776],"length":1,"stats":{"Line":2},"fn_name":null},{"line":81,"address":[74826,74890],"length":1,"stats":{"Line":2},"fn_name":null},{"line":82,"address":[74909,74868,74900],"length":1,"stats":{"Line":2},"fn_name":null},{"line":123,"address":[61344],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":124,"address":[61419,61387],"length":1,"stats":{"Line":1},"fn_name":null},{"line":125,"address":[62192],"length":1,"stats":{"Line":1},"fn_name":"parse_line"},{"line":126,"address":[45264,45703,45777],"length":1,"stats":{"Line":5},"fn_name":"{closure#0}"},{"line":127,"address":[45310,45506,45586],"length":1,"stats":{"Line":2},"fn_name":null},{"line":128,"address":[45784,45563,45711],"length":1,"stats":{"Line":2},"fn_name":null},{"line":129,"address":[45768],"length":1,"stats":{"Line":1},"fn_name":null},{"line":130,"address":[62274],"length":1,"stats":{"Line":1},"fn_name":null},{"line":132,"address":[61548,61398,61690],"length":1,"stats":{"Line":2},"fn_name":null},{"line":133,"address":[61738,61888,61668],"length":1,"stats":{"Line":2},"fn_name":null},{"line":134,"address":[61866,62142,61942],"length":1,"stats":{"Line":2},"fn_name":null},{"line":135,"address":[62083],"length":1,"stats":{"Line":1},"fn_name":null},{"line":159,"address":[48501,48496],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":160,"address":[34327],"length":1,"stats":{"Line":1},"fn_name":null},{"line":161,"address":[34581,34420,34506],"length":1,"stats":{"Line":3},"fn_name":null},{"line":162,"address":[35033,35158],"length":1,"stats":{"Line":2},"fn_name":null},{"line":163,"address":[35725,35600],"length":1,"stats":{"Line":2},"fn_name":null},{"line":164,"address":[36292,36167],"length":1,"stats":{"Line":2},"fn_name":null},{"line":165,"address":[36859,36734],"length":1,"stats":{"Line":2},"fn_name":null},{"line":166,"address":[37426,37301],"length":1,"stats":{"Line":2},"fn_name":null},{"line":167,"address":[37993,37868],"length":1,"stats":{"Line":2},"fn_name":null},{"line":168,"address":[38417,38536],"length":1,"stats":{"Line":2},"fn_name":null},{"line":169,"address":[38945,39070],"length":1,"stats":{"Line":2},"fn_name":null},{"line":173,"address":[40462,45171,39760],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":174,"address":[39767],"length":1,"stats":{"Line":1},"fn_name":null},{"line":175,"address":[40021,39860,39946],"length":1,"stats":{"Line":3},"fn_name":null},{"line":176,"address":[40473,40598],"length":1,"stats":{"Line":2},"fn_name":null},{"line":177,"address":[41165,41040],"length":1,"stats":{"Line":2},"fn_name":null},{"line":178,"address":[41732,41607],"length":1,"stats":{"Line":2},"fn_name":null},{"line":179,"address":[42174,42299],"length":1,"stats":{"Line":2},"fn_name":null},{"line":180,"address":[42741,42866],"length":1,"stats":{"Line":2},"fn_name":null},{"line":181,"address":[43308,43433],"length":1,"stats":{"Line":2},"fn_name":null},{"line":182,"address":[43857,43976],"length":1,"stats":{"Line":2},"fn_name":null},{"line":183,"address":[44385,44510],"length":1,"stats":{"Line":2},"fn_name":null}],"covered":73,"coverable":73},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-22","src","lib.rs"],"content":"//! Advent of Code 2015: Day 22: Wizard Simulator 20XX\n//!\n//! [https://adventofcode.com/2015/day/22](https://adventofcode.com/2015/day/22)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\nuse aoc_search as search;\n\npuzzle_info! {\n\tname = \"Wizard Simulator 20XX\";\n\tyear = 2015;\n\tday = 22;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (input);\n\tpart_two = |input| logic::part_two (input);\n}\n\n/// Logic for solving the puzzles.\n///\npub mod logic {\n\n\tuse super::*;\n\tuse model::Boss;\n\tuse model::Input;\n\tuse model::Player;\n\tuse search::PrioritySearch;\n\tuse search::PrioritySearchAdder;\n\n\tpub fn part_one (input: Input) -\u003e GenResult \u003cu16\u003e {\n\t\tOk (calc_result (input, Difficulty::Easy).ok_or (\"No solution found\") ?)\n\t}\n\n\tpub fn part_two (input: Input) -\u003e GenResult \u003cu16\u003e {\n\t\tOk (calc_result (input, Difficulty::Hard).ok_or (\"No solution found\") ?)\n\t}\n\n\tfn calc_result (input: Input, difficulty: Difficulty) -\u003e Option \u003cu16\u003e {\n\t\toutcomes (input, difficulty)\n\t\t\t.filter (|outcome| outcome.winner == Contender::Player)\n\t\t\t.map (|outcome| outcome.mana)\n\t\t\t.next ()\n\t}\n\n\tfn outcomes (input: Input, difficulty: Difficulty) -\u003e impl Iterator \u003cItem = Outcome\u003e {\n\n\t\tlet mut search = PrioritySearch::with_hash_map (\n\t\t\t|state: State, _, mut adder: PrioritySearchAdder \u003c'_, _, _, _\u003e| {\n\t\t\t\tif state.boss.hit_points == 0 {\n\t\t\t\t\tSome (Outcome { winner: Contender::Player, mana: state.mana })\n\t\t\t\t} else if state.player.hit_points == 0 {\n\t\t\t\t\tSome (Outcome { winner: Contender::Boss, mana: state.mana })\n\t\t\t\t} else {\n\t\t\t\t\tfor next_state in next_states (state) {\n\t\t\t\t\t\tadder.add (next_state, next_state.mana);\n\t\t\t\t\t}\n\t\t\t\t\tNone\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\n\t\tsearch.push (State {\n\t\t\tplayer: input.player,\n\t\t\tboss: input.boss,\n\t\t\teffects: Effects { shield: 0, poison: 0, recharge: 0 },\n\t\t\tturn: Contender::Player,\n\t\t\tdifficulty,\n\t\t\tmana: 0,\n\t\t}, 0);\n\n\t\tsearch.flatten ()\n\n\t}\n\n\tfn next_states (mut state: State) -\u003e ArrayVec \u003cState, 5\u003e {\n\n\t\tif state.effects.shield \u003e 0 {\n\t\t\tstate.effects.shield -= 1;\n\t\t}\n\n\t\tif state.effects.poison \u003e 0 {\n\t\t\tstate.boss.hit_points -= cmp::min (state.boss.hit_points, 3);\n\t\t\tif state.boss.hit_points == 0 { return array_vec! [ state ] }\n\t\t\tstate.effects.poison -= 1;\n\t\t}\n\n\t\tif state.effects.recharge \u003e 0 {\n\t\t\tstate.player.mana += 101;\n\t\t\tstate.effects.recharge -= 1;\n\t\t}\n\n\t\tif state.turn == Contender::Player {\n\n\t\t\tstate.turn = Contender::Boss;\n\n\t\t\tif state.player.mana \u003c 53 {\n\t\t\t\tstate.player.hit_points = 0;\n\t\t\t\treturn array_vec! [ state ];\n\t\t\t}\n\n\t\t\tif state.difficulty == Difficulty::Hard {\n\t\t\t\tstate.player.hit_points -= 1;\n\t\t\t\tif state.player.hit_points == 0 {\n\t\t\t\t\treturn array_vec! [ state ];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet mut results = ArrayVec::new ();\n\n\t\t\tif state.player.mana \u003e= 53 {\n\t\t\t\tlet mut state = state;\n\t\t\t\tstate.player.mana -= 53;\n\t\t\t\tstate.boss.hit_points -= cmp::min (state.boss.hit_points, 4);\n\t\t\t\tstate.mana += 53;\n\t\t\t\tresults.push (state);\n\t\t\t}\n\n\t\t\tif state.player.mana \u003e= 73 {\n\t\t\t\tlet mut state = state;\n\t\t\t\tstate.player.hit_points += 2;\n\t\t\t\tstate.player.mana -= 73;\n\t\t\t\tstate.boss.hit_points -= cmp::min (state.boss.hit_points, 2);\n\t\t\t\tstate.mana += 73;\n\t\t\t\tresults.push (state);\n\t\t\t}\n\n\t\t\tif state.player.mana \u003e= 113 \u0026\u0026 state.effects.shield == 0 {\n\t\t\t\tlet mut state = state;\n\t\t\t\tstate.player.mana -= 113;\n\t\t\t\tstate.effects.shield = 6;\n\t\t\t\tstate.mana += 113;\n\t\t\t\tresults.push (state);\n\t\t\t}\n\n\t\t\tif state.player.mana \u003e= 173 \u0026\u0026 state.effects.poison == 0 {\n\t\t\t\tlet mut state = state;\n\t\t\t\tstate.player.mana -= 173;\n\t\t\t\tstate.effects.poison = 6;\n\t\t\t\tstate.mana += 173;\n\t\t\t\tresults.push (state);\n\t\t\t}\n\n\t\t\tif state.player.mana \u003e= 229 \u0026\u0026 state.effects.recharge == 0 {\n\t\t\t\tlet mut state = state;\n\t\t\t\tstate.player.mana -= 229;\n\t\t\t\tstate.effects.recharge = 5;\n\t\t\t\tstate.mana += 229;\n\t\t\t\tresults.push (state);\n\t\t\t}\n\n\t\t\tresults\n\n\t\t} else {\n\n\t\t\tstate.turn = Contender::Player;\n\n\t\t\tlet armor = if state.effects.shield \u003e 0 { 7 } else { 0 };\n\t\t\tlet attack = if state.boss.damage \u003c= armor { 1 } else { state.boss.damage - armor };\n\t\t\tstate.player.hit_points -= cmp::min (state.player.hit_points, attack);\n\t\t\tarray_vec! [ state ]\n\n\t\t}\n\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, Hash, Ord, PartialEq, PartialOrd) ]\n\tstruct Outcome {\n\t\twinner: Contender,\n\t\tmana: u16,\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, Hash, Ord, PartialEq, PartialOrd) ]\n\tstruct Effects {\n\t\tshield: u8,\n\t\tpoison: u8,\n\t\trecharge: u8,\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, Hash, Ord, PartialEq, PartialOrd) ]\n\tstruct State {\n\t\tplayer: Player,\n\t\tboss: Boss,\n\t\teffects: Effects,\n\t\tturn: Contender,\n\t\tdifficulty: Difficulty,\n\t\tmana: u16,\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, Hash, Ord, PartialEq, PartialOrd) ]\n\tenum Contender { Player, Boss }\n\n\t#[ derive (Clone, Copy, Debug, Eq, Hash, Ord, PartialEq, PartialOrd) ]\n\tenum Difficulty { Easy, Hard }\n\n}\n\n/// Representation of the puzzle input, etc.\n///\npub mod model {\n\n\tuse super::*;\n\tuse parser::*;\n\n\t#[ derive (Clone, Copy, Debug, Eq, Hash, PartialEq) ]\n\tpub struct Input {\n\t\tpub player: Player,\n\t\tpub boss: Boss,\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, Hash, Ord, PartialEq, PartialOrd) ]\n\tpub struct Player {\n\t\tpub hit_points: u16,\n\t\tpub mana: u16,\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, Hash, Ord, PartialEq, PartialOrd) ]\n\tpub struct Boss {\n\t\tpub hit_points: u16,\n\t\tpub damage: u16,\n\t}\n\n\timpl Input {\n\t\tpub fn parse (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet player = Player { hit_points: 50, mana: 500 };\n\t\t\tif input.len () != 2 { Err (\"Invalid input\") ?; }\n\t\t\tfn parse_line (line_idx: usize, line: \u0026 str, expect: \u0026 str) -\u003e GenResult \u003cu16\u003e {\n\t\t\t\tParser::wrap (line, |parser| {\n\t\t\t\t\tlet value = parser.expect (expect) ?.int () ?;\n\t\t\t\t\tparser.end () ?;\n\t\t\t\t\tOk (value)\n\t\t\t\t}).map_parse_err (|_| format! (\"Invalid input: line {}: {}\", line_idx + 1, line))\n\t\t\t}\n\t\t\tlet hit_points = parse_line (0, input [0], \"Hit Points: \") ?;\n\t\t\tlet damage = parse_line (1, input [1], \"Damage: \") ?;\n\t\t\tif hit_points \u003e 100 { Err (\"Boss hit points are limited to 100\") ?; }\n\t\t\tif damage \u003e 15 { Err (\"Boss damage is limited to 15\") ?; }\n\t\t\tOk (Self { player, boss: Boss { hit_points, damage }})\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"491\", puzzle.part_one (\u0026 [ \"Hit Points: 40\", \"Damage: 8\" ]));\n\t\tassert_eq_ok! (\"787\", puzzle.part_one (\u0026 [ \"Hit Points: 50\", \"Damage: 8\" ]));\n\t\tassert_eq_ok! (\"1249\", puzzle.part_one (\u0026 [ \"Hit Points: 60\", \"Damage: 8\" ]));\n\t\tassert_eq_ok! (\"734\", puzzle.part_one (\u0026 [ \"Hit Points: 40\", \"Damage: 9\" ]));\n\t\tassert_eq_ok! (\"900\", puzzle.part_one (\u0026 [ \"Hit Points: 50\", \"Damage: 9\" ]));\n\t\tassert_eq_ok! (\"1269\", puzzle.part_one (\u0026 [ \"Hit Points: 60\", \"Damage: 9\" ]));\n\t\tassert_eq_ok! (\"754\", puzzle.part_one (\u0026 [ \"Hit Points: 40\", \"Damage: 10\" ]));\n\t\tassert_eq_ok! (\"900\", puzzle.part_one (\u0026 [ \"Hit Points: 50\", \"Damage: 10\" ]));\n\t\tassert_eq_ok! (\"1309\", puzzle.part_one (\u0026 [ \"Hit Points: 60\", \"Damage: 10\" ]));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"734\", puzzle.part_two (\u0026 [ \"Hit Points: 40\", \"Damage: 8\" ]));\n\t\tassert_eq_ok! (\"900\", puzzle.part_two (\u0026 [ \"Hit Points: 50\", \"Damage: 8\" ]));\n\t\tassert_eq_ok! (\"1309\", puzzle.part_two (\u0026 [ \"Hit Points: 60\", \"Damage: 8\" ]));\n\t\tassert_eq_ok! (\"754\", puzzle.part_two (\u0026 [ \"Hit Points: 40\", \"Damage: 9\" ]));\n\t\tassert_eq_ok! (\"920\", puzzle.part_two (\u0026 [ \"Hit Points: 50\", \"Damage: 9\" ]));\n\t\tassert_eq_ok! (\"1309\", puzzle.part_two (\u0026 [ \"Hit Points: 60\", \"Damage: 9\" ]));\n\t\tassert_eq_ok! (\"794\", puzzle.part_two (\u0026 [ \"Hit Points: 40\", \"Damage: 10\" ]));\n\t\tassert_eq_ok! (\"1256\", puzzle.part_two (\u0026 [ \"Hit Points: 50\", \"Damage: 10\" ]));\n\t\tassert_eq_ok! (\"1442\", puzzle.part_two (\u0026 [ \"Hit Points: 60\", \"Damage: 10\" ]));\n\t}\n\n}\n","traces":[{"line":14,"address":[27251,26691],"length":1,"stats":{"Line":2},"fn_name":null},{"line":15,"address":[26752],"length":1,"stats":{"Line":1},"fn_name":null},{"line":16,"address":[27312],"length":1,"stats":{"Line":1},"fn_name":null},{"line":30,"address":[78656],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":31,"address":[78688,78836],"length":1,"stats":{"Line":1},"fn_name":null},{"line":34,"address":[78896],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":35,"address":[79076,78928],"length":1,"stats":{"Line":1},"fn_name":null},{"line":38,"address":[79136,79314],"length":1,"stats":{"Line":2},"fn_name":"calc_result"},{"line":39,"address":[79173],"length":1,"stats":{"Line":2},"fn_name":null},{"line":40,"address":[102496,102523],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":41,"address":[102560,102585],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":45,"address":[79759,79360,79732],"length":1,"stats":{"Line":2},"fn_name":"outcomes"},{"line":48,"address":[102985,103016,102592],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":49,"address":[102672,102627],"length":1,"stats":{"Line":3},"fn_name":null},{"line":50,"address":[102638],"length":1,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[102681,102725],"length":1,"stats":{"Line":4},"fn_name":null},{"line":52,"address":[102691],"length":1,"stats":{"Line":1},"fn_name":null},{"line":54,"address":[102734],"length":1,"stats":{"Line":2},"fn_name":null},{"line":55,"address":[102936],"length":1,"stats":{"Line":2},"fn_name":null},{"line":57,"address":[103011],"length":1,"stats":{"Line":2},"fn_name":null},{"line":62,"address":[79481],"length":1,"stats":{"Line":2},"fn_name":null},{"line":63,"address":[79437],"length":1,"stats":{"Line":2},"fn_name":null},{"line":64,"address":[79447],"length":1,"stats":{"Line":2},"fn_name":null},{"line":65,"address":[79457],"length":1,"stats":{"Line":2},"fn_name":null},{"line":71,"address":[79623],"length":1,"stats":{"Line":2},"fn_name":null},{"line":75,"address":[79776,80180],"length":1,"stats":{"Line":2},"fn_name":"next_states"},{"line":77,"address":[79798,79850],"length":1,"stats":{"Line":4},"fn_name":null},{"line":78,"address":[79852,79822],"length":1,"stats":{"Line":2},"fn_name":null},{"line":81,"address":[80053,79809],"length":1,"stats":{"Line":4},"fn_name":null},{"line":82,"address":[79978,79907],"length":1,"stats":{"Line":2},"fn_name":null},{"line":83,"address":[79969,80008,80093],"length":1,"stats":{"Line":4},"fn_name":null},{"line":84,"address":[80025,80058],"length":1,"stats":{"Line":2},"fn_name":null},{"line":87,"address":[79887,80348],"length":1,"stats":{"Line":4},"fn_name":null},{"line":88,"address":[80306,80254],"length":1,"stats":{"Line":2},"fn_name":null},{"line":89,"address":[80345,80353,80288],"length":1,"stats":{"Line":4},"fn_name":null},{"line":92,"address":[80387,82811,82238,80224],"length":1,"stats":{"Line":8},"fn_name":null},{"line":94,"address":[80422],"length":1,"stats":{"Line":2},"fn_name":null},{"line":96,"address":[80426],"length":1,"stats":{"Line":2},"fn_name":null},{"line":97,"address":[80468],"length":1,"stats":{"Line":1},"fn_name":null},{"line":98,"address":[80473],"length":1,"stats":{"Line":2},"fn_name":null},{"line":101,"address":[80438,80597],"length":1,"stats":{"Line":4},"fn_name":null},{"line":102,"address":[80626,80666],"length":1,"stats":{"Line":1},"fn_name":null},{"line":103,"address":[80658],"length":1,"stats":{"Line":1},"fn_name":null},{"line":104,"address":[80696],"length":1,"stats":{"Line":1},"fn_name":null},{"line":108,"address":[80603],"length":1,"stats":{"Line":1},"fn_name":null},{"line":110,"address":[80821],"length":1,"stats":{"Line":1},"fn_name":null},{"line":111,"address":[80854],"length":1,"stats":{"Line":2},"fn_name":null},{"line":112,"address":[80877,80939],"length":1,"stats":{"Line":2},"fn_name":null},{"line":113,"address":[80914,81016,81078],"length":1,"stats":{"Line":4},"fn_name":null},{"line":114,"address":[81113,81052,81160],"length":1,"stats":{"Line":4},"fn_name":null},{"line":115,"address":[81121,81193],"length":1,"stats":{"Line":4},"fn_name":null},{"line":118,"address":[80833],"length":1,"stats":{"Line":2},"fn_name":null},{"line":119,"address":[81224],"length":1,"stats":{"Line":2},"fn_name":null},{"line":120,"address":[81310,81247],"length":1,"stats":{"Line":2},"fn_name":null},{"line":121,"address":[81348,81381,81284],"length":1,"stats":{"Line":4},"fn_name":null},{"line":122,"address":[81419,81481,81356],"length":1,"stats":{"Line":4},"fn_name":null},{"line":123,"address":[81455,81519,81566],"length":1,"stats":{"Line":4},"fn_name":null},{"line":124,"address":[81527,81599],"length":1,"stats":{"Line":4},"fn_name":null},{"line":127,"address":[81604,81203],"length":1,"stats":{"Line":4},"fn_name":null},{"line":128,"address":[81672],"length":1,"stats":{"Line":2},"fn_name":null},{"line":129,"address":[81695,81766],"length":1,"stats":{"Line":2},"fn_name":null},{"line":130,"address":[81732],"length":1,"stats":{"Line":2},"fn_name":null},{"line":131,"address":[81740,81851,81804],"length":1,"stats":{"Line":4},"fn_name":null},{"line":132,"address":[81884,81812],"length":1,"stats":{"Line":4},"fn_name":null},{"line":135,"address":[81650,81889],"length":1,"stats":{"Line":3},"fn_name":null},{"line":136,"address":[81957],"length":1,"stats":{"Line":2},"fn_name":null},{"line":137,"address":[81980,82051],"length":1,"stats":{"Line":2},"fn_name":null},{"line":138,"address":[82017],"length":1,"stats":{"Line":2},"fn_name":null},{"line":139,"address":[82136,82089,82025],"length":1,"stats":{"Line":4},"fn_name":null},{"line":140,"address":[82169,82097],"length":1,"stats":{"Line":4},"fn_name":null},{"line":143,"address":[82174,81935],"length":1,"stats":{"Line":4},"fn_name":null},{"line":144,"address":[82248],"length":1,"stats":{"Line":2},"fn_name":null},{"line":145,"address":[82271,82342],"length":1,"stats":{"Line":2},"fn_name":null},{"line":146,"address":[82308],"length":1,"stats":{"Line":2},"fn_name":null},{"line":147,"address":[82427,82316,82380],"length":1,"stats":{"Line":4},"fn_name":null},{"line":148,"address":[82388,82460],"length":1,"stats":{"Line":4},"fn_name":null},{"line":151,"address":[82220],"length":1,"stats":{"Line":2},"fn_name":null},{"line":155,"address":[80398],"length":1,"stats":{"Line":2},"fn_name":null},{"line":157,"address":[80402,82465],"length":1,"stats":{"Line":4},"fn_name":null},{"line":158,"address":[82492,82583],"length":1,"stats":{"Line":4},"fn_name":null},{"line":159,"address":[82679,82633,82552],"length":1,"stats":{"Line":4},"fn_name":null},{"line":160,"address":[82714,82664],"length":1,"stats":{"Line":4},"fn_name":null},{"line":223,"address":[87264],"length":1,"stats":{"Line":2},"fn_name":"parse"},{"line":224,"address":[87307],"length":1,"stats":{"Line":2},"fn_name":null},{"line":225,"address":[87353,87321],"length":1,"stats":{"Line":2},"fn_name":null},{"line":226,"address":[88304],"length":1,"stats":{"Line":2},"fn_name":"parse_line"},{"line":227,"address":[88406,88342],"length":1,"stats":{"Line":10},"fn_name":null},{"line":228,"address":[94622,94818,94903],"length":1,"stats":{"Line":4},"fn_name":null},{"line":229,"address":[95028,95102,94880],"length":1,"stats":{"Line":4},"fn_name":null},{"line":230,"address":[95086],"length":1,"stats":{"Line":2},"fn_name":null},{"line":231,"address":[88386],"length":1,"stats":{"Line":2},"fn_name":null},{"line":233,"address":[87332,87629,87482],"length":1,"stats":{"Line":4},"fn_name":null},{"line":234,"address":[87677,87833,87607],"length":1,"stats":{"Line":4},"fn_name":null},{"line":235,"address":[87820,87902],"length":1,"stats":{"Line":2},"fn_name":null},{"line":236,"address":[87887,88156],"length":1,"stats":{"Line":2},"fn_name":null},{"line":237,"address":[88060],"length":1,"stats":{"Line":2},"fn_name":null},{"line":249,"address":[36963,31584,32284],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":250,"address":[31591],"length":1,"stats":{"Line":1},"fn_name":null},{"line":251,"address":[31843,31684,31768],"length":1,"stats":{"Line":3},"fn_name":null},{"line":252,"address":[32295,32417],"length":1,"stats":{"Line":2},"fn_name":null},{"line":253,"address":[32859,32981],"length":1,"stats":{"Line":2},"fn_name":null},{"line":254,"address":[33545,33423],"length":1,"stats":{"Line":2},"fn_name":null},{"line":255,"address":[33987,34109],"length":1,"stats":{"Line":2},"fn_name":null},{"line":256,"address":[34551,34673],"length":1,"stats":{"Line":2},"fn_name":null},{"line":257,"address":[35115,35237],"length":1,"stats":{"Line":2},"fn_name":null},{"line":258,"address":[35777,35661],"length":1,"stats":{"Line":2},"fn_name":null},{"line":259,"address":[36302,36186],"length":1,"stats":{"Line":2},"fn_name":null},{"line":263,"address":[42371,36992,37692],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":264,"address":[36999],"length":1,"stats":{"Line":1},"fn_name":null},{"line":265,"address":[37176,37092,37251],"length":1,"stats":{"Line":3},"fn_name":null},{"line":266,"address":[37703,37825],"length":1,"stats":{"Line":2},"fn_name":null},{"line":267,"address":[38389,38267],"length":1,"stats":{"Line":2},"fn_name":null},{"line":268,"address":[38831,38953],"length":1,"stats":{"Line":2},"fn_name":null},{"line":269,"address":[39517,39395],"length":1,"stats":{"Line":2},"fn_name":null},{"line":270,"address":[39959,40081],"length":1,"stats":{"Line":2},"fn_name":null},{"line":271,"address":[40645,40523],"length":1,"stats":{"Line":2},"fn_name":null},{"line":272,"address":[41069,41185],"length":1,"stats":{"Line":2},"fn_name":null},{"line":273,"address":[41710,41594],"length":1,"stats":{"Line":2},"fn_name":null}],"covered":118,"coverable":118},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-23","src","lib.rs"],"content":"//! Advent of Code 2015: Day 23: Opening the Turing Lock\n//!\n//! [https://adventofcode.com/2015/day/23](https://adventofcode.com/2015/day/23)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Opening the Turing Lock\";\n\tyear = 2015;\n\tday = 23;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\n/// Logic for solving the puzzles.\n///\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\tuse model::Instr;\n\tuse model::Reg;\n\tuse model::Val;\n\tuse nums::Int;\n\tuse nums::IntConv;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cVal\u003e {\n\t\tlet (_, reg_b) = emulate (input, 0, 0, 0, 0x10000) ?;\n\t\tOk (reg_b)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cVal\u003e {\n\t\tlet (_, reg_b) = emulate (input, 1, 0, 0, 0x10000) ?;\n\t\tOk (reg_b)\n\t}\n\n\tfn emulate (\n\t\tinput: \u0026 Input,\n\t\tmut reg_a: Val,\n\t\tmut reg_b: Val,\n\t\tmut next: Val,\n\t\tmut max_loops: usize,\n\t) -\u003e Result \u003c(Val, Val), EmulateError\u003e {\n\n\t\t// main loop\n\n\t\tlet mut seen = HashSet::new ();\n\t\twhile next \u003c Val::from_usize (input.instrs.len ())\n\t\t\t.map_err (|_err| EmulateError::Overflow) ? {\n\n\t\t\t// abort when we reach max_loops\n\n\t\t\tif max_loops == 0 { return Err (EmulateError::MaxLoops) }\n\t\t\tmax_loops -= 1;\n\n\t\t\t// detect infinite loops and abort\n\n\t\t\tif ! seen.insert ((reg_a, reg_b, next)) { return Err (EmulateError::InfiniteLoop) }\n\n\t\t\t// execute next instruction\n\n\t\t\tlet instr = input.instrs [next.as_usize ()];\n\t\t\tmatch instr {\n\t\t\t\tInstr::Hlf (Reg::A) =\u003e reg_a /= 2,\n\t\t\t\tInstr::Hlf (Reg::B) =\u003e reg_b /= 2,\n\t\t\t\tInstr::Tpl (Reg::A) =\u003e\n\t\t\t\t\treg_a = Val::mul_2 (reg_a, 3)\n\t\t\t\t\t\t.map_err (|_err| EmulateError::Overflow) ?,\n\t\t\t\tInstr::Tpl (Reg::B) =\u003e\n\t\t\t\t\treg_b = Val::mul_2 (reg_b, 3)\n\t\t\t\t\t\t.map_err (|_err| EmulateError::Overflow) ?,\n\t\t\t\tInstr::Inc (Reg::A) =\u003e\n\t\t\t\t\treg_a = Val::add_2 (reg_a, 1)\n\t\t\t\t\t\t.map_err (|_err| EmulateError::Overflow) ?,\n\t\t\t\tInstr::Inc (Reg::B) =\u003e\n\t\t\t\t\treg_b = Val::add_2 (reg_b, 1)\n\t\t\t\t\t\t.map_err (|_err| EmulateError::Overflow) ?,\n\t\t\t\tInstr::Jmp (offset) =\u003e {\n\t\t\t\t\tnext = Val::add_signed (next, offset)\n\t\t\t\t\t\t.map_err (|_err| EmulateError::Overflow) ?;\n\t\t\t\t\tcontinue;\n\t\t\t\t},\n\t\t\t\tInstr::Jie (Reg::A, offset) =\u003e if reg_a \u0026 1 == 0 {\n\t\t\t\t\tnext = Val::add_signed (next, offset)\n\t\t\t\t\t\t.map_err (|_err| EmulateError::Overflow) ?;\n\t\t\t\t\tcontinue;\n\t\t\t\t},\n\t\t\t\tInstr::Jie (Reg::B, offset) =\u003e if reg_b \u0026 1 == 0 {\n\t\t\t\t\tnext = Val::add_signed (next, offset)\n\t\t\t\t\t\t.map_err (|_err| EmulateError::Overflow) ?;\n\t\t\t\t\tcontinue;\n\t\t\t\t},\n\t\t\t\tInstr::Jio (Reg::A, offset) =\u003e if reg_a == 1 {\n\t\t\t\t\tnext = Val::add_signed (next, offset)\n\t\t\t\t\t\t.map_err (|_err| EmulateError::Overflow) ?;\n\t\t\t\t\tcontinue;\n\t\t\t\t},\n\t\t\t\tInstr::Jio (Reg::B, offset) =\u003e if reg_b == 1 {\n\t\t\t\t\tnext = Val::add_signed (next, offset)\n\t\t\t\t\t\t.map_err (|_err| EmulateError::Overflow) ?;\n\t\t\t\t\tcontinue;\n\t\t\t\t},\n\t\t\t}\n\n\t\t\t// move to next instruction, jump instructions skip this bit\n\n\t\t\tnext += 1;\n\n\t\t}\n\n\t\t// return the two registers\n\n\t\tOk ((reg_a, reg_b))\n\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\n\tenum EmulateError {\n\t\tInfiniteLoop,\n\t\tOverflow,\n\t\tMaxLoops,\n\t}\n\n\timpl Error for EmulateError {\n\t}\n\n\timpl Display for EmulateError {\n\t\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\t\tmatch * self {\n\t\t\t\tSelf::InfiniteLoop =\u003e write! (formatter, \"Infinite loop\") ?,\n\t\t\t\tSelf::Overflow =\u003e write! (formatter, \"Arithmetic overflow\") ?,\n\t\t\t\tSelf::MaxLoops =\u003e write! (formatter, \"Max loops reached\") ?,\n\t\t\t}\n\t\t\tOk (())\n\t\t}\n\t}\n\n\t#[ cfg (test) ]\n\tmod tests {\n\n\t\tuse super::*;\n\n\t\t#[ test ]\n\t\tfn emulate () {\n\t\t\tuse Instr::*;\n\t\t\tuse Reg::*;\n\t\t\t// inc, hlf, tpl\n\t\t\tassert_eq_ok! ((2, 0), logic::emulate (\n\t\t\t\t\u0026 Input { instrs: vec! [ Inc (A), Tpl (A), Inc (A), Hlf (A) ] }, 0, 0, 0, 10));\n\t\t\tassert_eq_ok! ((0, 2), logic::emulate (\n\t\t\t\t\u0026 Input { instrs: vec! [ Inc (B), Tpl (B), Inc (B), Hlf (B) ] }, 0, 0, 0, 10));\n\t\t\t// jmp\n\t\t\tassert_eq_ok! ((1, 1), logic::emulate (\n\t\t\t\t\u0026 Input { instrs: vec! [ Inc (A), Jmp (2), Tpl (A), Inc (B) ] }, 0, 0, 0, 10));\n\t\t\t// jio\n\t\t\tassert_eq_ok! ((1, 1), logic::emulate (\n\t\t\t\t\u0026 Input { instrs: vec! [ Inc (A), Jio (A, 2), Inc (B), Inc (B) ] }, 0, 0, 0, 10));\n\t\t\tassert_eq_ok! ((0, 2), logic::emulate (\n\t\t\t\t\u0026 Input { instrs: vec! [ Jio (A, 2), Inc (B), Inc (B) ] }, 0, 0, 0, 10));\n\t\t\tassert_eq_ok! ((1, 1), logic::emulate (\n\t\t\t\t\u0026 Input { instrs: vec! [ Inc (B), Jio (B, 2), Inc (A), Inc (A) ] }, 0, 0, 0, 10));\n\t\t\tassert_eq_ok! ((2, 0), logic::emulate (\n\t\t\t\t\u0026 Input { instrs: vec! [ Jio (B, 2), Inc (A), Inc (A) ] }, 0, 0, 0, 10));\n\t\t\t// jie\n\t\t\tassert_eq_ok! ((1, 2), logic::emulate (\n\t\t\t\t\u0026 Input { instrs: vec! [ Inc (A), Jie (A, 2), Inc (B), Inc (B) ] }, 0, 0, 0, 10));\n\t\t\tassert_eq_ok! ((0, 1), logic::emulate (\n\t\t\t\t\u0026 Input { instrs: vec! [ Jie (A, 2), Inc (B), Inc (B) ] }, 0, 0, 0, 10));\n\t\t\tassert_eq_ok! ((2, 1), logic::emulate (\n\t\t\t\t\u0026 Input { instrs: vec! [ Inc (B), Jie (B, 2), Inc (A), Inc (A) ] }, 0, 0, 0, 10));\n\t\t\tassert_eq_ok! ((1, 0), logic::emulate (\n\t\t\t\t\u0026 Input { instrs: vec! [ Jie (B, 2), Inc (A), Inc (A) ] }, 0, 0, 0, 10));\n\t\t\t// errors\n\t\t\tassert_err! (\"Infinite loop\", logic::emulate (\n\t\t\t\t\u0026 Input { instrs: vec! [ Jmp (0) ] }, 0, 0, 0, 10));\n\t\t\tassert_err! (\"Max loops reached\", logic::emulate (\n\t\t\t\t\u0026 Input { instrs: vec! [ Inc (A), Jmp (-1) ] }, 0, 0, 0, 10));\n\t\t\tassert_err! (\"Arithmetic overflow\", logic::emulate (\n\t\t\t\t\u0026 Input { instrs: vec! [ Inc (A), Tpl (A), Jmp (-1) ] }, 0, 0, 0, 100));\n\t\t}\n\n\t}\n\n}\n\n/// Representation of the puzzle input, etc.\n///\npub mod model {\n\n\tuse super::*;\n\tuse parser::*;\n\n\tpub type Val = u32;\n\tpub type Offset = i32;\n\n\t#[ derive (Clone, Debug) ]\n\tpub struct Input {\n\t\tpub instrs: Vec \u003cInstr\u003e,\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\n\tpub enum Instr {\n\t\tHlf (Reg),\n\t\tTpl (Reg),\n\t\tInc (Reg),\n\t\tJmp (Offset),\n\t\tJie (Reg, Offset),\n\t\tJio (Reg, Offset),\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\n\tpub enum Reg { A, B }\n\n\timpl Instr {\n\t\tpub fn parse (input: \u0026 str) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tParser::wrap (input, Self::parse_real)\n\t\t\t\t.map_parse_err (|col_idx|\n\t\t\t\t\tformat! (\"Invalid input: col {}: {}\", col_idx + 1, input))\n\t\t}\n\t\tfn parse_real (parser: \u0026 mut Parser) -\u003e ParseResult \u003cSelf\u003e {\n\t\t\tparser\n\t\t\t\t.set_ignore_whitespace (true)\n\t\t\t\t.set_word_pred (|ch| ch.is_ascii_alphanumeric ());\n\t\t\tparser.any ()\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tparser.expect_word (\"hlf\") ?.confirm ();\n\t\t\t\t\tlet reg = Reg::parse_real (parser) ?;\n\t\t\t\t\tparser.end () ?;\n\t\t\t\t\tOk (Self::Hlf (reg))\n\t\t\t\t})\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tparser.expect_word (\"tpl\") ?.confirm ();\n\t\t\t\t\tlet reg = Reg::parse_real (parser) ?;\n\t\t\t\t\tparser.end () ?;\n\t\t\t\t\tOk (Self::Tpl (reg))\n\t\t\t\t})\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tparser.expect_word (\"inc\") ?.confirm ();\n\t\t\t\t\tlet reg = Reg::parse_real (parser) ?;\n\t\t\t\t\tparser.end () ?;\n\t\t\t\t\tOk (Self::Inc (reg))\n\t\t\t\t})\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tparser.expect_word (\"jmp\") ?.confirm ();\n\t\t\t\t\tlet offset = parser.int () ?;\n\t\t\t\t\tparser.end () ?;\n\t\t\t\t\tOk (Self::Jmp (offset))\n\t\t\t\t})\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tparser.expect_word (\"jio\") ?.confirm ();\n\t\t\t\t\tlet reg = Reg::parse_real (parser) ?;\n\t\t\t\t\tlet offset = parser.expect (\",\") ?.int () ?;\n\t\t\t\t\tparser.end () ?;\n\t\t\t\t\tOk (Self::Jio (reg, offset))\n\t\t\t\t})\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tparser.expect_word (\"jie\") ?.confirm ();\n\t\t\t\t\tlet reg = Reg::parse_real (parser) ?;\n\t\t\t\t\tlet offset = parser.expect (\",\") ?.int () ?;\n\t\t\t\t\tparser.end () ?;\n\t\t\t\t\tOk (Self::Jie (reg, offset))\n\t\t\t\t})\n\t\t\t\t.done ()\n\t\t}\n\t}\n\n\timpl Input {\n\t\tpub fn parse (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet instrs =\n\t\t\t\tinput.iter ().enumerate ()\n\t\t\t\t\t.map (|(line_idx, line)|\n\t\t\t\t\t\tParser::wrap (line, Instr::parse_real)\n\t\t\t\t\t\t\t.map_parse_err (|col_idx|\n\t\t\t\t\t\t\t\tformat! (\"Invalid input: line {}: col {}: {}\",\n\t\t\t\t\t\t\t\t\tline_idx + 1, col_idx + 1, line)))\n\t\t\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e () ?;\n\t\t\tOk (Self { instrs })\n\t\t}\n\t}\n\n\timpl Reg {\n\t\tfn parse_real (parser: \u0026 mut Parser) -\u003e ParseResult \u003cSelf\u003e {\n\t\t\tparser.any ()\n\t\t\t\t.of (|parser| { parser.expect_word (\"a\") ?; Ok (Self::A) })\n\t\t\t\t.of (|parser| { parser.expect_word (\"b\") ?; Ok (Self::B) })\n\t\t\t\t.done ()\n\t\t}\n\t}\n\n\t#[ cfg (test) ]\n\tmod tests {\n\n\t\tuse super::*;\n\n\t\t#[ test ]\n\t\tfn input_parse () {\n\t\t\tassert_err! (\"Invalid input: line 2: col 8: jio a, +-5\",\n\t\t\t\tInput::parse (\u0026 [ \"inc a\", \"jio a, +-5\" ]));\n\t\t}\n\n\t\t#[ test ]\n\t\tfn instr_parse () {\n\t\t\tuse { Instr::*, Reg::* };\n\t\t\tassert_eq_ok! (Hlf (A), Instr::parse (\"hlf a\"));\n\t\t\tassert_eq_ok! (Tpl (B), Instr::parse (\"tpl b\"));\n\t\t\tassert_eq_ok! (Inc (A), Instr::parse (\"inc a\"));\n\t\t\tassert_eq_ok! (Jmp (-1), Instr::parse (\"jmp -1\"));\n\t\t\tassert_eq_ok! (Jio (B, 0), Instr::parse (\"jio b, 0\"));\n\t\t\tassert_eq_ok! (Jie (A, 1), Instr::parse (\"jie a, +1\"));\n\t\t\tassert_err! (\"Invalid input: col 5: inc abc\", Instr::parse (\"inc abc\"));\n\t\t}\n\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"jio a, +5\",\n\t\t\"inc a\",\n\t\t\"tpl a\",\n\t\t\"tpl a\",\n\t\t\"jmp +3\",\n\t\t\"inc a\",\n\t\t\"tpl a\",\n\t\t\"jio a, +4\",\n\t\t\"hlf a\",\n\t\t\"inc b\",\n\t\t\"jmp -3\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"3\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"2\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":13,"address":[39571,40259],"length":1,"stats":{"Line":2},"fn_name":null},{"line":14,"address":[39677],"length":1,"stats":{"Line":1},"fn_name":null},{"line":15,"address":[40365],"length":1,"stats":{"Line":1},"fn_name":null},{"line":30,"address":[82368],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":31,"address":[82387,82483],"length":1,"stats":{"Line":1},"fn_name":null},{"line":32,"address":[82467],"length":1,"stats":{"Line":1},"fn_name":null},{"line":35,"address":[82528],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":36,"address":[82547,82645],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[82629],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[82688,85963],"length":1,"stats":{"Line":1},"fn_name":"emulate"},{"line":50,"address":[82757],"length":1,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[82778,82855,85925,83067],"length":1,"stats":{"Line":3},"fn_name":null},{"line":52,"address":[70160,70164],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":56,"address":[83178],"length":1,"stats":{"Line":1},"fn_name":null},{"line":57,"address":[83206,83321],"length":1,"stats":{"Line":1},"fn_name":null},{"line":61,"address":[83416,83249,83360],"length":1,"stats":{"Line":3},"fn_name":null},{"line":65,"address":[83444,83382],"length":1,"stats":{"Line":2},"fn_name":null},{"line":66,"address":[83641,83485],"length":1,"stats":{"Line":2},"fn_name":null},{"line":67,"address":[85867],"length":1,"stats":{"Line":1},"fn_name":null},{"line":68,"address":[85889],"length":1,"stats":{"Line":1},"fn_name":null},{"line":70,"address":[85438,85848,85690,85830],"length":1,"stats":{"Line":4},"fn_name":null},{"line":71,"address":[70192,70196],"length":1,"stats":{"Line":4},"fn_name":"{closure#1}"},{"line":73,"address":[85468,85645,85663],"length":1,"stats":{"Line":1},"fn_name":null},{"line":74,"address":[70228,70224],"length":1,"stats":{"Line":1},"fn_name":"{closure#2}"},{"line":76,"address":[85401,85259,85007,85419],"length":1,"stats":{"Line":2},"fn_name":null},{"line":77,"address":[70260,70256],"length":1,"stats":{"Line":1},"fn_name":"{closure#3}"},{"line":79,"address":[85214,85232,85037],"length":1,"stats":{"Line":1},"fn_name":null},{"line":80,"address":[70288,70292],"length":1,"stats":{"Line":1},"fn_name":"{closure#4}"},{"line":81,"address":[83596],"length":1,"stats":{"Line":1},"fn_name":null},{"line":82,"address":[83610,84988,84970,84828],"length":1,"stats":{"Line":2},"fn_name":null},{"line":83,"address":[70320,70324],"length":1,"stats":{"Line":0},"fn_name":"{closure#5}"},{"line":86,"address":[84261],"length":1,"stats":{"Line":1},"fn_name":null},{"line":87,"address":[84593,84777,84795],"length":1,"stats":{"Line":1},"fn_name":null},{"line":88,"address":[70352,70356],"length":1,"stats":{"Line":0},"fn_name":"{closure#6}"},{"line":91,"address":[84306],"length":1,"stats":{"Line":1},"fn_name":null},{"line":92,"address":[84549,84567,84353],"length":1,"stats":{"Line":1},"fn_name":null},{"line":93,"address":[70384,70388],"length":1,"stats":{"Line":0},"fn_name":"{closure#7}"},{"line":96,"address":[83680],"length":1,"stats":{"Line":1},"fn_name":null},{"line":97,"address":[84224,84242,84028],"length":1,"stats":{"Line":1},"fn_name":null},{"line":98,"address":[70416,70420],"length":1,"stats":{"Line":0},"fn_name":"{closure#8}"},{"line":101,"address":[83717],"length":1,"stats":{"Line":1},"fn_name":null},{"line":102,"address":[83755,83984,84002,83830],"length":1,"stats":{"Line":2},"fn_name":null},{"line":103,"address":[70448,70452],"length":1,"stats":{"Line":0},"fn_name":"{closure#9}"},{"line":110,"address":[85930,85918,83783],"length":1,"stats":{"Line":2},"fn_name":null},{"line":116,"address":[83109],"length":1,"stats":{"Line":1},"fn_name":null},{"line":131,"address":[86016],"length":1,"stats":{"Line":1},"fn_name":"fmt"},{"line":132,"address":[86044],"length":1,"stats":{"Line":1},"fn_name":null},{"line":133,"address":[86076,86389],"length":1,"stats":{"Line":2},"fn_name":null},{"line":134,"address":[86115,86308],"length":1,"stats":{"Line":2},"fn_name":null},{"line":135,"address":[86154,86267],"length":1,"stats":{"Line":1},"fn_name":null},{"line":137,"address":[86260],"length":1,"stats":{"Line":1},"fn_name":null},{"line":147,"address":[37248,37253],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":151,"address":[114025,114116,114484],"length":1,"stats":{"Line":2},"fn_name":null},{"line":152,"address":[113805],"length":1,"stats":{"Line":1},"fn_name":null},{"line":153,"address":[115159,114725],"length":1,"stats":{"Line":1},"fn_name":null},{"line":154,"address":[114536,114443],"length":1,"stats":{"Line":2},"fn_name":null},{"line":156,"address":[115837,115403],"length":1,"stats":{"Line":1},"fn_name":null},{"line":157,"address":[115118,115211],"length":1,"stats":{"Line":2},"fn_name":null},{"line":159,"address":[116089,116523],"length":1,"stats":{"Line":1},"fn_name":null},{"line":160,"address":[115889,115796],"length":1,"stats":{"Line":2},"fn_name":null},{"line":161,"address":[116747,117181],"length":1,"stats":{"Line":1},"fn_name":null},{"line":162,"address":[116482,116575],"length":1,"stats":{"Line":2},"fn_name":null},{"line":163,"address":[117867,117433],"length":1,"stats":{"Line":1},"fn_name":null},{"line":164,"address":[117140,117233],"length":1,"stats":{"Line":2},"fn_name":null},{"line":165,"address":[118525,118091],"length":1,"stats":{"Line":1},"fn_name":null},{"line":166,"address":[117826,117919],"length":1,"stats":{"Line":2},"fn_name":null},{"line":168,"address":[119211,118777],"length":1,"stats":{"Line":1},"fn_name":null},{"line":169,"address":[118484,118577],"length":1,"stats":{"Line":2},"fn_name":null},{"line":170,"address":[119435,119869],"length":1,"stats":{"Line":1},"fn_name":null},{"line":171,"address":[119170,119263],"length":1,"stats":{"Line":2},"fn_name":null},{"line":172,"address":[120555,120121],"length":1,"stats":{"Line":1},"fn_name":null},{"line":173,"address":[119828,119921],"length":1,"stats":{"Line":2},"fn_name":null},{"line":174,"address":[121192,120779],"length":1,"stats":{"Line":1},"fn_name":null},{"line":175,"address":[120514,120607],"length":1,"stats":{"Line":2},"fn_name":null},{"line":177,"address":[121349],"length":1,"stats":{"Line":1},"fn_name":null},{"line":178,"address":[121160,121241],"length":1,"stats":{"Line":2},"fn_name":null},{"line":179,"address":[121849],"length":1,"stats":{"Line":1},"fn_name":null},{"line":180,"address":[121688],"length":1,"stats":{"Line":1},"fn_name":null},{"line":181,"address":[122378],"length":1,"stats":{"Line":1},"fn_name":null},{"line":182,"address":[122189],"length":1,"stats":{"Line":1},"fn_name":null},{"line":218,"address":[72608],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":219,"address":[72631,72665],"length":1,"stats":{"Line":2},"fn_name":null},{"line":220,"address":[42306,42064],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":221,"address":[42102],"length":1,"stats":{"Line":1},"fn_name":null},{"line":223,"address":[72704],"length":1,"stats":{"Line":1},"fn_name":"parse_real"},{"line":224,"address":[72740],"length":1,"stats":{"Line":1},"fn_name":null},{"line":226,"address":[42320,42333],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":227,"address":[72776],"length":1,"stats":{"Line":1},"fn_name":null},{"line":228,"address":[43063,42582,42368],"length":1,"stats":{"Line":3},"fn_name":"{closure#1}"},{"line":229,"address":[42414],"length":1,"stats":{"Line":1},"fn_name":null},{"line":230,"address":[42595,42704],"length":1,"stats":{"Line":1},"fn_name":null},{"line":231,"address":[42825,42919,42684],"length":1,"stats":{"Line":2},"fn_name":null},{"line":232,"address":[43045,42877],"length":1,"stats":{"Line":2},"fn_name":null},{"line":234,"address":[43072,43286,43767],"length":1,"stats":{"Line":3},"fn_name":"{closure#2}"},{"line":235,"address":[43118],"length":1,"stats":{"Line":1},"fn_name":null},{"line":236,"address":[43299,43408],"length":1,"stats":{"Line":1},"fn_name":null},{"line":237,"address":[43623,43388,43529],"length":1,"stats":{"Line":2},"fn_name":null},{"line":238,"address":[43581,43749],"length":1,"stats":{"Line":2},"fn_name":null},{"line":240,"address":[44471,43990,43776],"length":1,"stats":{"Line":3},"fn_name":"{closure#3}"},{"line":241,"address":[43822],"length":1,"stats":{"Line":1},"fn_name":null},{"line":242,"address":[44003,44112],"length":1,"stats":{"Line":2},"fn_name":null},{"line":243,"address":[44233,44327,44092],"length":1,"stats":{"Line":2},"fn_name":null},{"line":244,"address":[44453,44285],"length":1,"stats":{"Line":2},"fn_name":null},{"line":246,"address":[45162,44480,44694],"length":1,"stats":{"Line":3},"fn_name":"{closure#4}"},{"line":247,"address":[44526],"length":1,"stats":{"Line":1},"fn_name":null},{"line":248,"address":[44707,44809],"length":1,"stats":{"Line":1},"fn_name":null},{"line":249,"address":[44930,44789,45018],"length":1,"stats":{"Line":2},"fn_name":null},{"line":250,"address":[44982,45144],"length":1,"stats":{"Line":2},"fn_name":null},{"line":252,"address":[46284,45168,45382],"length":1,"stats":{"Line":3},"fn_name":"{closure#5}"},{"line":253,"address":[45214],"length":1,"stats":{"Line":1},"fn_name":null},{"line":254,"address":[45516,45395],"length":1,"stats":{"Line":1},"fn_name":null},{"line":255,"address":[45834,45637,45922,45484],"length":1,"stats":{"Line":4},"fn_name":null},{"line":256,"address":[46140,46043,45902],"length":1,"stats":{"Line":2},"fn_name":null},{"line":257,"address":[46098,46266],"length":1,"stats":{"Line":2},"fn_name":null},{"line":259,"address":[46518,47420,46304],"length":1,"stats":{"Line":3},"fn_name":"{closure#6}"},{"line":260,"address":[46350],"length":1,"stats":{"Line":1},"fn_name":null},{"line":261,"address":[46531,46652],"length":1,"stats":{"Line":1},"fn_name":null},{"line":262,"address":[46620,46970,46773,47058],"length":1,"stats":{"Line":3},"fn_name":null},{"line":263,"address":[47276,47038,47179],"length":1,"stats":{"Line":2},"fn_name":null},{"line":264,"address":[47234,47402],"length":1,"stats":{"Line":2},"fn_name":null},{"line":271,"address":[72928],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":272,"address":[72987,73345],"length":1,"stats":{"Line":2},"fn_name":null},{"line":274,"address":[47549,47440,47468],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":275,"address":[47478,47524],"length":1,"stats":{"Line":2},"fn_name":null},{"line":276,"address":[47568,47504,47949],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":277,"address":[47797,47736,47646],"length":1,"stats":{"Line":3},"fn_name":null},{"line":278,"address":[47672,47611,47762],"length":1,"stats":{"Line":1},"fn_name":null},{"line":280,"address":[73182],"length":1,"stats":{"Line":1},"fn_name":null},{"line":285,"address":[73376],"length":1,"stats":{"Line":1},"fn_name":"parse_real"},{"line":286,"address":[73394],"length":1,"stats":{"Line":1},"fn_name":null},{"line":287,"address":[48014,47968],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":288,"address":[48208,48254],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":299,"address":[106804,106512,106828],"length":1,"stats":{"Line":3},"fn_name":"input_parse"},{"line":300,"address":[106815,106541],"length":1,"stats":{"Line":2},"fn_name":null},{"line":301,"address":[106519],"length":1,"stats":{"Line":1},"fn_name":null},{"line":305,"address":[110315,110491,106864],"length":1,"stats":{"Line":3},"fn_name":"instr_parse"},{"line":307,"address":[107022,107412,106871],"length":1,"stats":{"Line":2},"fn_name":null},{"line":308,"address":[107537,107459,107928,107369],"length":1,"stats":{"Line":3},"fn_name":null},{"line":309,"address":[108053,108444,107975,107885],"length":1,"stats":{"Line":3},"fn_name":null},{"line":310,"address":[108401,108960,108491,108569],"length":1,"stats":{"Line":3},"fn_name":null},{"line":311,"address":[109085,109458,109007,108917],"length":1,"stats":{"Line":3},"fn_name":null},{"line":312,"address":[109929,109421,109505,109577],"length":1,"stats":{"Line":3},"fn_name":null},{"line":313,"address":[110326,109892,109976],"length":1,"stats":{"Line":3},"fn_name":null},{"line":340,"address":[89123,88560,89169],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":341,"address":[88567],"length":1,"stats":{"Line":1},"fn_name":null},{"line":342,"address":[88730,88590,88664],"length":1,"stats":{"Line":3},"fn_name":null},{"line":346,"address":[89200,89763,89809],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":347,"address":[89207],"length":1,"stats":{"Line":1},"fn_name":null},{"line":348,"address":[89304,89370,89230],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":143,"coverable":149},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-24","src","lib.rs"],"content":"//! Advent of Code 2015: Day 24: It Hangs in the Balance\n//!\n//! [https://adventofcode.com/2015/day/24](https://adventofcode.com/2015/day/24)\n//!\n//! # Input\n//!\n//! Each line contains a decimal integer, representing the weight of a single package.\n//!\n//! # Part one\n//!\n//! Split the packages into three piles of equal weight. Optimise so that one pile has the fewest\n//! possible number of packages. Further optimize so that the product of the weights of the\n//! packages in the first pile is as small as possible. Produce that product as a result.\n//!\n//! # Part two\n//!\n//! The same as part one, but with four piles instead of three.\n//!\n//! # Algorithm\n//!\n//! - Iteratively build up a list of items to assign to each pile, always in order from heavier to\n//!   lighter. This ensures that we find a solution with the smallest possible number of packages\n//!   in the first pile before any other.\n//! - Once we find a solution for all three piles, record the size and product of the first pile,\n//!   and only consider solutions with a first pile which would signify an improvement.\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"It Hangs in the Balance\";\n\tyear = 2015;\n\tday = 24;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (input);\n\tpart_two = |input| logic::part_two (input);\n}\n\n/// Logic for solving the puzzles.\n///\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\tuse nums::Int;\n\tuse nums::IntConv;\n\n\tpub fn part_one (input: Input) -\u003e GenResult \u003cu64\u003e {\n\t\tcalc_result::\u003c3\u003e (input)\n\t}\n\n\tpub fn part_two (input: Input) -\u003e GenResult \u003cu64\u003e {\n\t\tcalc_result::\u003c4\u003e (input)\n\t}\n\n\tfn calc_result \u003cconst PILES: usize\u003e (input: Input) -\u003e GenResult \u003cu64\u003e {\n\n\t\t// make sure the weights are in reverse order\n\n\t\tlet weights: Vec \u003cu32\u003e =\n\t\t\tinput.weights.into_iter ()\n\t\t\t\t.sorted_by_key (|\u0026 weight| cmp::Reverse (weight))\n\t\t\t\t.collect ();\n\n\t\t// sanity check (mainly for fuzzing)\n\n\t\tif weights.len () \u003e 50 {\n\t\t\tErr (\"Refusing to deal with more than 50 items\") ?;\n\t\t}\n\n\t\tif weights.iter ().dedup ().count () != weights.len () {\n\t\t\tErr (\"Refusing to deal with duplicated weights\") ?;\n\t\t}\n\n\t\tif weights.iter ().copied ().any (|weight| weight \u003e 200) {\n\t\t\tErr (\"Refusing to deal with weights over 200\") ?;\n\t\t}\n\n\t\t// work out the balanced weight of each pile\n\n\t\tlet total_weight: u32 =\n\t\t\tweights.iter ().copied ()\n\t\t\t\t.fold (Ok (0), |sum, item| sum\n\t\t\t\t\t.and_then (|sum| u32::add_2 (sum, item))) ?;\n\t\tlet want_pile_weight = total_weight / PILES.as_u32 ();\n\t\tif want_pile_weight * PILES.as_u32 () != total_weight {\n\t\t\tErr (format! (\"Total weight is not a multiple of {}\", PILES)) ?;\n\t\t}\n\n\t\t// once we find one solution we can rule out any first piles which are bigger or have a\n\t\t// higher quantum entanglement\n\n\t\tlet mut max_len_0 = usize::MAX;\n\t\tlet mut max_quantum_0 = u64::MAX;\n\n\t\t// stack holds a list of piles and the indexes of their contents\n\n\t\tlet mut stack: Vec \u003cVec \u003cusize\u003e\u003e = vec! [ vec! [] ];\n\n\t\t// todo holds continuations, first value is number of piles to retain, second is number of\n\t\t// items in top pile, third is new index to push to top pile, for initial state we have a\n\t\t// single pile and branch for the full list of weights as the next item in it\n\n\t\tlet mut todo: Vec \u003c(usize, usize, usize)\u003e =\n\t\t\t(0 .. weights.len ())\n\t\t\t\t.rev ()\n\t\t\t\t.map (|idx| (1, 0, idx))\n\t\t\t\t.collect ();\n\n\t\t// iterate through continuations, shortcircuit allows us to quickly get back to the first\n\t\t// pile when we find a new solution, because we don't really care about the other piles, so\n\t\t// long as we know there's at least one solution for them\n\n\t\tlet mut shortcircuit = false;\n\t\twhile let Some ((trunc_0, trunc_1, idx)) = todo.pop () {\n\t\t\tif shortcircuit \u0026\u0026 trunc_0 \u003e 1 { continue }\n\t\t\tshortcircuit = false;\n\n\t\t\t// truncate the number of piles according to the continuation\n\n\t\t\tstack.truncate (trunc_0);\n\n\t\t\t// truncate the items in the top pile according to the continuation\n\n\t\t\tlet pile_stack = stack.last_mut ().unwrap ();\n\t\t\tpile_stack.truncate (trunc_1);\n\n\t\t\t// add on the next item from the continuation\n\n\t\t\tpile_stack.push (idx);\n\t\t\tlet pile_stack_len = pile_stack.len ();\n\n\t\t\t// work out the top pile's weight, abort if it is too heavy\n\n\t\t\tlet pile_weight: u32 =\n\t\t\t\tpile_stack.iter ().copied ().map (|idx| weights [idx]).sum ();\n\t\t\tif pile_weight \u003e want_pile_weight { continue }\n\n\t\t\t// for the first pile only, check the quantum and abort if it's already too high\n\n\t\t\tif stack.len () == 1 {\n\t\t\t\tif max_len_0 \u003c stack [0].len () { continue }\n\t\t\t\tlet quantum_0 =\n\t\t\t\t\tstack [0].iter ().copied ()\n\t\t\t\t\t\t.map (|idx| weights [idx].as_u64 ())\n\t\t\t\t\t\t.fold (Ok (1), |prod, item| prod\n\t\t\t\t\t\t\t.and_then (|prod| u64::mul_2 (prod, item))) ?;\n\t\t\t\tif max_quantum_0 \u003c= quantum_0 { continue }\n\t\t\t}\n\n\t\t\t// if this pile is now the right weight we start the next pile, or record a solution if\n\t\t\t// this is the last pile\n\n\t\t\tif pile_weight == want_pile_weight {\n\t\t\t\tif stack.len () \u003c PILES {\n\t\t\t\t\tstack.push (vec! []);\n\t\t\t\t\tfor idx in (0 .. weights.len ()).rev () {\n\t\t\t\t\t\tif stack.iter ()\n\t\t\t\t\t\t\t.any (|pile_stack| pile_stack.iter ().copied ()\n\t\t\t\t\t\t\t\t.any (|existing_idx| idx == existing_idx))\n\t\t\t\t\t\t\t{ continue }\n\t\t\t\t\t\ttodo.push ((stack.len (), 0, idx));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tmax_len_0 = stack [0].len ();\n\t\t\t\t\tmax_quantum_0 =\n\t\t\t\t\t\tstack [0].iter ().copied ()\n\t\t\t\t\t\t\t.map (|idx| weights [idx].as_u64 ())\n\t\t\t\t\t\t\t.fold (Ok (1), |prod, item| prod\n\t\t\t\t\t\t\t\t.and_then (|prod| u64::mul_2 (prod, item))) ?;\n\t\t\t\t\tshortcircuit = true;\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// branch out for every possible next weight to add to the top pile\n\n\t\t\tlet min_idx =\n\t\t\t\tstack.last ().unwrap ().iter ().copied ()\n\t\t\t\t\t.map (|idx| idx + 1).max ().unwrap_or (0);\n\t\t\tfor idx in (min_idx .. weights.len ()).rev () {\n\t\t\t\tif stack.iter ()\n\t\t\t\t\t.any (|pile_stack| pile_stack.iter ().copied ()\n\t\t\t\t\t\t.any (|existing_idx| idx == existing_idx))\n\t\t\t\t\t{ continue }\n\t\t\t\ttodo.push ((stack.len (), pile_stack_len, idx));\n\t\t\t}\n\n\t\t}\n\n\t\tif max_quantum_0 == u64::MAX { Err (\"No solution found\") ?; }\n\t\tOk (max_quantum_0)\n\n\t}\n\n\t#[ cfg (test) ]\n\tmod tests {\n\n\t\tuse super::*;\n\n\t\t#[ test ]\n\t\tfn calc_result () {\n\t\t\tassert_eq_ok! (5, logic::calc_result::\u003c3\u003e (Input { weights: (1 ..= 5).collect () }));\n\t\t\tassert_err! (\"No solution found\",\n\t\t\t\tlogic::calc_result::\u003c3\u003e (Input { weights: (1 ..= 3).collect () }));\n\t\t\tassert_err! (\"Refusing to deal with more than 50 items\",\n\t\t\t\tlogic::calc_result::\u003c3\u003e (Input { weights: (0 ..= 50).collect () }));\n\t\t\tassert_err! (\"Refusing to deal with duplicated weights\",\n\t\t\t\tlogic::calc_result::\u003c3\u003e (Input { weights: vec! [ 1, 1, 1 ] }));\n\t\t\tassert_err! (\"Total weight is not a multiple of 3\",\n\t\t\t\tlogic::calc_result::\u003c3\u003e (Input { weights: vec! [ 1, 2, 3, 4 ] }));\n\t\t}\n\n\t}\n\n}\n\n/// Representation of the puzzle input, etc.\n///\npub mod model {\n\n\tuse super::*;\n\n\t#[ derive (Clone, Debug) ]\n\tpub struct Input {\n\t\tpub weights: Vec \u003cu32\u003e,\n\t}\n\n\timpl Input {\n\t\tpub fn parse (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet weights = input.iter ().enumerate ()\n\t\t\t\t.map (|(line_idx, line)| Ok (\n\t\t\t\t\tline.parse ().map_err (|_err|\n\t\t\t\t\t\tformat! (\"Invalid input: line {}: {}\", line_idx + 1, line)) ?))\n\t\t\t\t.collect::\u003cGenResult \u003cVec \u003c_\u003e\u003e\u003e () ?;\n\t\t\tOk (Self { weights })\n\t\t}\n\t}\n\n\t#[ cfg (test) ]\n\tmod tests {\n\n\t\tuse super::*;\n\n\t\t#[ test ]\n\t\tfn input_parse () {\n\t\t\tassert_err! (\"Invalid input: line 2: 456X\", Input::parse (\u0026 [ \"123\", \"456X\" ]));\n\t\t}\n\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [ \"1\", \"2\", \"3\", \"4\", \"5\", \"7\", \"8\", \"9\", \"10\", \"11\" ];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"99\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"44\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":35,"address":[126555,127323],"length":1,"stats":{"Line":2},"fn_name":null},{"line":36,"address":[126656],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[127424],"length":1,"stats":{"Line":1},"fn_name":null},{"line":49,"address":[132624],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":50,"address":[132636],"length":1,"stats":{"Line":1},"fn_name":null},{"line":53,"address":[132688],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":54,"address":[132700],"length":1,"stats":{"Line":1},"fn_name":null},{"line":57,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":63,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":82,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":83,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":85,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":86,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":99,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":108,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":115,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":116,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":117,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":118,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":122,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":126,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":127,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":131,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":132,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":136,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":137,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":138,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":142,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":143,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":144,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":145,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":146,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":147,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":148,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":149,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":155,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":156,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":157,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":158,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":159,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":160,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":161,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":162,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":163,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":166,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":167,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":168,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":169,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":170,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":171,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":172,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":174,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":179,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":180,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":181,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":182,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":183,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":184,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":185,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":186,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":187,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":192,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":193,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":203,"address":[96020,94960,97495],"length":1,"stats":{"Line":3},"fn_name":"calc_result"},{"line":204,"address":[95166,95526,94967],"length":1,"stats":{"Line":2},"fn_name":null},{"line":205,"address":[95651,96031],"length":1,"stats":{"Line":2},"fn_name":null},{"line":206,"address":[95589,95503],"length":1,"stats":{"Line":2},"fn_name":null},{"line":207,"address":[96150],"length":1,"stats":{"Line":1},"fn_name":null},{"line":208,"address":[96065],"length":1,"stats":{"Line":1},"fn_name":null},{"line":209,"address":[96636],"length":1,"stats":{"Line":1},"fn_name":null},{"line":210,"address":[96524],"length":1,"stats":{"Line":1},"fn_name":null},{"line":211,"address":[97123],"length":1,"stats":{"Line":1},"fn_name":null},{"line":212,"address":[97004],"length":1,"stats":{"Line":1},"fn_name":null},{"line":231,"address":[44048],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":232,"address":[44465,44107],"length":1,"stats":{"Line":2},"fn_name":null},{"line":233,"address":[125156,125279,124976,125017],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":234,"address":[125027,125259,125296,125544],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":235,"address":[125332,125172],"length":1,"stats":{"Line":2},"fn_name":null},{"line":237,"address":[44302],"length":1,"stats":{"Line":1},"fn_name":null},{"line":247,"address":[44693,44688],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":248,"address":[152343,152639],"length":1,"stats":{"Line":2},"fn_name":null},{"line":263,"address":[87856,87861],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":264,"address":[106231],"length":1,"stats":{"Line":1},"fn_name":null},{"line":265,"address":[106328,106254,106394],"length":1,"stats":{"Line":3},"fn_name":null},{"line":269,"address":[87893,87888],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":270,"address":[106871],"length":1,"stats":{"Line":1},"fn_name":null},{"line":271,"address":[106968,107034,106894],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":92,"coverable":102},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","day-25","src","lib.rs"],"content":"//! Advent of Code 2015: Day 25: Let It Snow\n//!\n//! [https://adventofcode.com/2015/day/25](https://adventofcode.com/2015/day/25)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Let It Snow\";\n\tyear = 2015;\n\tday = 25;\n\tparse = |input| model::Input::parse (input [0]);\n\tpart_one = |input| logic::part_one (\u0026 input);\n}\n\n/// Logic for solving the puzzles.\n///\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\tuse nums::Int;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cu64\u003e {\n\t\tlet diag_num = u64::add_2 (input.row, input.col) ?;\n\t\tlet diag_seq = u64::mul_2 (diag_num, u64::add_2 (diag_num, 1) ?) ? / 2;\n\t\tlet mut cell_seq = u64::add_2 (diag_seq, input.col) ?;\n\t\tlet mut code: u64 = 20_151_125;\n\t\tlet mut mul = 252_533;\n\t\twhile cell_seq != 0 {\n\t\t\tif cell_seq \u0026 1 == 1 { code = code * mul % 33_554_393; }\n\t\t\tcell_seq \u003e\u003e= 1_i32;\n\t\t\tmul = mul * mul % 33_554_393;\n\t\t}\n\t\tOk (code)\n\t}\n\n}\n\n/// Representation of the puzzle input, etc.\n///\npub mod model {\n\n\tuse super::*;\n\tuse parser::*;\n\n\t#[ derive (Clone, Debug) ]\n\tpub struct Input {\n\t\tpub row: u64,\n\t\tpub col: u64,\n\t}\n\n\timpl Input {\n\t\tpub fn parse (input: \u0026 str) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tParser::wrap (input, |parser| {\n\t\t\t\tlet row: u64 = parser\n\t\t\t\t\t.expect (\"To continue, please consult the code grid in the manual.  \") ?\n\t\t\t\t\t.expect (\"Enter the code at row \") ?\n\t\t\t\t\t.int () ?;\n\t\t\t\tlet col: u64 = parser.expect (\", column \") ?.int () ?;\n\t\t\t\tparser.expect (\".\") ?.end () ?;\n\t\t\t\tif row \u003c 1 || col \u003c 1 { Err (\"Row and column start at one\") ?; }\n\t\t\t\tOk (Self { row: row - 1, col: col - 1 })\n\t\t\t}).map_parse_err (|col_idx| format! (\"Invalid input: col {}: {}\", col_idx + 1, input))\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tmacro_rules! ex {\n\t\t\t($row:literal, $col_1:literal, $col_2:literal, $col_3:literal, $col_4:literal,\n\t\t\t\t\t$col_5:literal, $col_6:literal) =\u003e {\n\t\t\t\tex! (@one, $row, \"column 1\", $col_1); ex! (@one, $row, \"column 2\", $col_2);\n\t\t\t\tex! (@one, $row, \"column 3\", $col_3); ex! (@one, $row, \"column 4\", $col_4);\n\t\t\t\tex! (@one, $row, \"column 5\", $col_5); ex! (@one, $row, \"column 6\", $col_6);\n\t\t\t};\n\t\t\t(@one, $row:literal, $col:literal, $expect:literal) =\u003e {\n\t\t\t\tassert_eq_ok! ($expect, puzzle.part_one (\u0026 [ \u0026 format! (\n\t\t\t\t\t\"To continue, please consult the code grid in the manual.  Enter the code at \\\n\t\t\t\t\t{}, {}.\", $row, $col) ]));\n\t\t\t};\n\t\t}\n\t\tex! (\"row 1\", \"20151125\", \"18749137\", \"17289845\", \"30943339\", \"10071777\", \"33511524\");\n\t\tex! (\"row 2\", \"31916031\", \"21629792\", \"16929656\", \"7726640\", \"15514188\", \"4041754\");\n\t\tex! (\"row 3\", \"16080970\", \"8057251\", \"1601130\", \"7981243\", \"11661866\", \"16474243\");\n\t\tex! (\"row 4\", \"24592653\", \"32451966\", \"21345942\", \"9380097\", \"10600672\", \"31527494\");\n\t\tex! (\"row 5\", \"77061\", \"17552253\", \"28094349\", \"6899651\", \"9250759\", \"31663883\");\n\t\tex! (\"row 6\", \"33071741\", \"6796745\", \"25397450\", \"24659492\", \"1534922\", \"27995004\");\n\t}\n\n}\n\n","traces":[{"line":13,"address":[25299],"length":1,"stats":{"Line":1},"fn_name":null},{"line":14,"address":[25431],"length":1,"stats":{"Line":1},"fn_name":null},{"line":25,"address":[37952],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":26,"address":[37982,38108],"length":1,"stats":{"Line":1},"fn_name":null},{"line":27,"address":[38081,38143,38357],"length":1,"stats":{"Line":2},"fn_name":null},{"line":28,"address":[38331,38483,38384],"length":1,"stats":{"Line":2},"fn_name":null},{"line":29,"address":[38452],"length":1,"stats":{"Line":1},"fn_name":null},{"line":30,"address":[38464],"length":1,"stats":{"Line":1},"fn_name":null},{"line":31,"address":[38500,38724,38476],"length":1,"stats":{"Line":3},"fn_name":null},{"line":32,"address":[38540,38612],"length":1,"stats":{"Line":2},"fn_name":null},{"line":33,"address":[38588,38667],"length":1,"stats":{"Line":2},"fn_name":null},{"line":34,"address":[38675,38729],"length":1,"stats":{"Line":1},"fn_name":null},{"line":36,"address":[38516],"length":1,"stats":{"Line":1},"fn_name":null},{"line":55,"address":[80720],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":56,"address":[80777,80743],"length":1,"stats":{"Line":5},"fn_name":null},{"line":57,"address":[23090,22881,22712,22478,22687,22906],"length":1,"stats":{"Line":3},"fn_name":null},{"line":58,"address":[22591],"length":1,"stats":{"Line":0},"fn_name":null},{"line":59,"address":[22785],"length":1,"stats":{"Line":0},"fn_name":null},{"line":60,"address":[23003,23110],"length":1,"stats":{"Line":0},"fn_name":null},{"line":61,"address":[23325,23431,23128,22968],"length":1,"stats":{"Line":3},"fn_name":null},{"line":62,"address":[23399,23552,23749,23819],"length":1,"stats":{"Line":3},"fn_name":null},{"line":63,"address":[24011,23945,23802],"length":1,"stats":{"Line":2},"fn_name":null},{"line":64,"address":[23986,24274,24159],"length":1,"stats":{"Line":2},"fn_name":null},{"line":65,"address":[24304,24342],"length":1,"stats":{"Line":1},"fn_name":"{closure#1}"},{"line":77,"address":[38800,38805],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":78,"address":[40509],"length":1,"stats":{"Line":1},"fn_name":null},{"line":92,"address":[42371,43354,40956,44337,45320,41389,46303,40818],"length":1,"stats":{"Line":8},"fn_name":null},{"line":93,"address":[49252,50235,48269,51218,46766,52201,47286],"length":1,"stats":{"Line":7},"fn_name":null},{"line":94,"address":[54167,52664,57116,55150,56133,58099,53184],"length":1,"stats":{"Line":7},"fn_name":null},{"line":95,"address":[62031,61048,63014,63997,60065,59082,58562],"length":1,"stats":{"Line":7},"fn_name":null},{"line":96,"address":[68912,67929,69895,65963,64460,64980,66946],"length":1,"stats":{"Line":7},"fn_name":null},{"line":97,"address":[70358,71861,75733,74810,73827,70878,72844],"length":1,"stats":{"Line":7},"fn_name":null}],"covered":29,"coverable":32},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2015","src","lib.rs"],"content":"#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npub use aoc_2015_day_01 as day_01;\npub use aoc_2015_day_02 as day_02;\npub use aoc_2015_day_03 as day_03;\npub use aoc_2015_day_04 as day_04;\npub use aoc_2015_day_05 as day_05;\npub use aoc_2015_day_06 as day_06;\npub use aoc_2015_day_07 as day_07;\npub use aoc_2015_day_08 as day_08;\npub use aoc_2015_day_09 as day_09;\npub use aoc_2015_day_10 as day_10;\npub use aoc_2015_day_11 as day_11;\npub use aoc_2015_day_12 as day_12;\npub use aoc_2015_day_13 as day_13;\npub use aoc_2015_day_14 as day_14;\npub use aoc_2015_day_15 as day_15;\npub use aoc_2015_day_16 as day_16;\npub use aoc_2015_day_17 as day_17;\npub use aoc_2015_day_18 as day_18;\npub use aoc_2015_day_19 as day_19;\npub use aoc_2015_day_20 as day_20;\npub use aoc_2015_day_21 as day_21;\npub use aoc_2015_day_22 as day_22;\npub use aoc_2015_day_23 as day_23;\npub use aoc_2015_day_24 as day_24;\npub use aoc_2015_day_25 as day_25;\n\n#[ must_use ]\npub fn puzzle_metadata () -\u003e Vec \u003cBox \u003cdyn puzzle::Puzzle\u003e\u003e {\n\tvec! [\n\t\tday_01::puzzle_metadata (),\n\t\tday_02::puzzle_metadata (),\n\t\tday_03::puzzle_metadata (),\n\t\tday_04::puzzle_metadata (),\n\t\tday_05::puzzle_metadata (),\n\t\tday_06::puzzle_metadata (),\n\t\tday_07::puzzle_metadata (),\n\t\tday_08::puzzle_metadata (),\n\t\tday_09::puzzle_metadata (),\n\t\tday_10::puzzle_metadata (),\n\t\tday_11::puzzle_metadata (),\n\t\tday_12::puzzle_metadata (),\n\t\tday_13::puzzle_metadata (),\n\t\tday_14::puzzle_metadata (),\n\t\tday_15::puzzle_metadata (),\n\t\tday_16::puzzle_metadata (),\n\t\tday_17::puzzle_metadata (),\n\t\tday_18::puzzle_metadata (),\n\t\tday_19::puzzle_metadata (),\n\t\tday_20::puzzle_metadata (),\n\t\tday_21::puzzle_metadata (),\n\t\tday_22::puzzle_metadata (),\n\t\tday_23::puzzle_metadata (),\n\t\tday_24::puzzle_metadata (),\n\t\tday_25::puzzle_metadata (),\n\t]\n}\n","traces":[{"line":32,"address":[11616,14789],"length":1,"stats":{"Line":0},"fn_name":"puzzle_metadata"},{"line":33,"address":[13208,11908,12808,12608,12508,12208,13008,13496,12108,12408,11639,13672,11808,12308,13108,13760,13848,13936,13584,14024,12008,13308,13405,11713,12908,12708],"length":1,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[11678,11765],"length":1,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[11865,11781],"length":1,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[11881,11965],"length":1,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[11981,12065],"length":1,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[12165,12081],"length":1,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[12181,12265],"length":1,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[12365,12281],"length":1,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[13793,13713],"length":1,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[13889,13809],"length":1,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[13985,13905],"length":1,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[14081,14001],"length":1,"stats":{"Line":0},"fn_name":null},{"line":45,"address":[14097,14177],"length":1,"stats":{"Line":0},"fn_name":null},{"line":46,"address":[12965,12881],"length":1,"stats":{"Line":0},"fn_name":null},{"line":47,"address":[12981,13065],"length":1,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[13165,13081],"length":1,"stats":{"Line":0},"fn_name":null},{"line":49,"address":[14561,14481],"length":1,"stats":{"Line":0},"fn_name":null},{"line":50,"address":[13365,13281],"length":1,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[14673,14747],"length":1,"stats":{"Line":0},"fn_name":null},{"line":52,"address":[14763,14831],"length":1,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[14915,14847],"length":1,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[14999,14931],"length":1,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[15015,15083],"length":1,"stats":{"Line":0},"fn_name":null},{"line":56,"address":[15099,15167],"length":1,"stats":{"Line":0},"fn_name":null},{"line":57,"address":[15251,15183],"length":1,"stats":{"Line":0},"fn_name":null},{"line":58,"address":[15267],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":27},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","cpu","src","lib.rs"],"content":"//! Advent of Code 2016: CPU\n//!\n//! CPU used in the following puzzles:\n//! - [https://adventofcode.com/2016/day/12](https://adventofcode.com/2016/day/12)\n//! - [https://adventofcode.com/2016/day/23](https://adventofcode.com/2016/day/23)\n//! - [https://adventofcode.com/2016/day/25](https://adventofcode.com/2016/day/25)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\nuse parser::FromParser;\nuse parser::ParseResult;\nuse parser::Parser;\n\n#[ derive (Default) ]\npub struct Cpu {\n\tpub instrs: Rc \u003cVec \u003cInstr\u003e\u003e,\n\tpub reg_a: i32,\n\tpub reg_b: i32,\n\tpub reg_c: i32,\n\tpub reg_d: i32,\n\tpub limit: u32,\n\tpub next: u32,\n}\n\nimpl Cpu {\n\n\tconst fn load (\u0026 self, arg: Arg) -\u003e i32 {\n\t\tmatch arg {\n\t\t\tArg::RegA =\u003e self.reg_a,\n\t\t\tArg::RegB =\u003e self.reg_b,\n\t\t\tArg::RegC =\u003e self.reg_c,\n\t\t\tArg::RegD =\u003e self.reg_d,\n\t\t\tArg::Imm (val) =\u003e val,\n\t\t}\n\t}\n\n\tfn store (\u0026 mut self, arg: Arg, val: i32) {\n\t\tmatch arg {\n\t\t\tArg::RegA =\u003e self.reg_a = val,\n\t\t\tArg::RegB =\u003e self.reg_b = val,\n\t\t\tArg::RegC =\u003e self.reg_c = val,\n\t\t\tArg::RegD =\u003e self.reg_d = val,\n\t\t\tArg::Imm (_) =\u003e (),\n\t\t}\n\t}\n\n\tpub fn exec (\u0026 mut self) -\u003e GenResult \u003cOption \u003ci32\u003e\u003e {\n\t\twhile self.next.as_usize () \u003c self.instrs.len () {\n\t\t\tif self.limit == 0 { return Err (\"Reached ops limit\".into ()) }\n\t\t\tself.limit -= 1;\n\t\t\t#[ allow (clippy::match_on_vec_items) ]\n\t\t\tmatch self.instrs [self.next.as_usize ()] {\n\t\t\t\tInstr::Cpy (src, dst) =\u003e self.store (dst, self.load (src)),\n\t\t\t\tInstr::Inc (reg) =\u003e self.store (reg, i32::add_2 (self.load (reg), 1_i32) ?),\n\t\t\t\tInstr::Dec (reg) =\u003e self.store (reg, i32::sub_2 (self.load (reg), 1_i32) ?),\n\t\t\t\tInstr::Jnz (src, dst) =\u003e { self.jnz (src, dst) ?; continue }\n\t\t\t\tInstr::Tgl (dst) =\u003e {\n\t\t\t\t\tlet idx = u32::add_signed (self.next, self.load (dst)) ?;\n\t\t\t\t\tif let Some (instr) =\n\t\t\t\t\t\tRc::make_mut (\u0026 mut self.instrs)\n\t\t\t\t\t\t\t.get_mut (idx.as_usize ()) {\n\t\t\t\t\t\t* instr = match * instr {\n\t\t\t\t\t\t\tInstr::Cpy (src, dst) =\u003e Instr::Jnz (src, dst),\n\t\t\t\t\t\t\tInstr::Jnz (src, dst) =\u003e Instr::Cpy (src, dst),\n\t\t\t\t\t\t\tInstr::Inc (arg) =\u003e Instr::Dec (arg),\n\t\t\t\t\t\t\tInstr::Dec (arg) | Instr::Tgl (arg) | Instr::Out (arg) =\u003e\n\t\t\t\t\t\t\t\tInstr::Inc (arg),\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstr::Out (arg) =\u003e {\n\t\t\t\t\tself.next += 1;\n\t\t\t\t\treturn Ok (Some (self.load (arg)));\n\t\t\t\t},\n\t\t\t}\n\t\t\tself.next += 1;\n\t\t}\n\t\tOk (None)\n\t}\n\n\tfn jnz (\u0026 mut self, src: Arg, dst: Arg) -\u003e GenResult \u003c()\u003e {\n\n\t\t// ignore if src is zero\n\n\t\tif self.load (src) == 0_i32 {\n\t\t\tself.next += 1;\n\t\t\treturn Ok (());\n\t\t}\n\n\t\t// check if this can be optimized\n\n\t\tif self.next \u003e= 2 {\n\t\t\tmatch \u003c[Instr; 3]\u003e::try_from (\n\t\t\t\t\u0026 self.instrs [self.next.as_usize () - 2 .. self.next.as_usize () + 1],\n\t\t\t).unwrap () {\n\t\t\t\t[\n\t\t\t\t\tInstr::Dec (arg),\n\t\t\t\t\tInstr::Inc (dst),\n\t\t\t\t\tInstr::Jnz (arg_0, Arg::Imm (-2_i32)),\n\t\t\t\t] | [\n\t\t\t\t\tInstr::Inc (dst),\n\t\t\t\t\tInstr::Dec (arg),\n\t\t\t\t\tInstr::Jnz (arg_0, Arg::Imm (-2_i32)),\n\t\t\t\t] if arg == arg_0 \u0026\u0026 dst != arg \u0026\u0026 arg.is_reg () \u0026\u0026 dst.is_reg () =\u003e {\n\t\t\t\t\tself.store (dst, i32::add_2 (self.load (dst), self.load (arg)) ?);\n\t\t\t\t\tself.store (arg, 0);\n\t\t\t\t\treturn Ok (());\n\t\t\t\t},\n\t\t\t\t_ =\u003e (),\n\t\t\t}\n\t\t}\n\n\t\tif self.next \u003e= 4 {\n\t\t\tmatch \u003c[Instr; 5]\u003e::try_from (\n\t\t\t\t\u0026 self.instrs [self.next.as_usize () - 4 .. self.next.as_usize () + 1],\n\t\t\t).unwrap () {\n\t\t\t\t[\n\t\t\t\t\tInstr::Jnz (arg, Arg::Imm (2_i32)),\n\t\t\t\t\tInstr::Jnz (Arg::Imm (1_i32), Arg::Imm (4_i32)),\n\t\t\t\t\tInstr::Dec (dst),\n\t\t\t\t\tInstr::Dec (arg_0),\n\t\t\t\t\tInstr::Jnz (Arg::Imm (1_i32), Arg::Imm (-4_i32)),\n\t\t\t\t] if arg == arg_0 \u0026\u0026 arg != dst \u0026\u0026 arg.is_reg () \u0026\u0026 dst.is_reg () =\u003e {\n\t\t\t\t\tself.store (dst, i32::sub_2 (\n\t\t\t\t\t\tself.load (dst),\n\t\t\t\t\t\tself.load (arg),\n\t\t\t\t\t) ?);\n\t\t\t\t\tself.store (arg, 0);\n\t\t\t\t},\n\t\t\t\t_ =\u003e (),\n\t\t\t}\n\t\t}\n\n\t\tif self.next \u003e= 5 {\n\t\t\tmatch \u003c[Instr; 6]\u003e::try_from (\n\t\t\t\t\u0026 self.instrs [self.next.as_usize () - 5 .. self.next.as_usize () + 1],\n\t\t\t).unwrap () {\n\t\t\t\t[\n\t\t\t\t\tInstr::Cpy (arg, tmp),\n\t\t\t\t\tInstr::Inc (dst),\n\t\t\t\t\tInstr::Dec (tmp_0),\n\t\t\t\t\tInstr::Jnz (tmp_1, Arg::Imm (-2_i32)),\n\t\t\t\t\tInstr::Dec (ctr),\n\t\t\t\t\tInstr::Jnz (ctr_0, Arg::Imm (-5_i32)),\n\t\t\t\t] if tmp == tmp_0 \u0026\u0026 tmp == tmp_1 \u0026\u0026 ctr == ctr_0 \u0026\u0026 arg != tmp \u0026\u0026 arg != dst\n\t\t\t\t\t\t\u0026\u0026 arg != ctr \u0026\u0026 tmp != dst \u0026\u0026 tmp != ctr \u0026\u0026 dst != ctr \u0026\u0026 dst.is_reg ()\n\t\t\t\t\t\t\u0026\u0026 tmp.is_reg () \u0026\u0026 ctr.is_reg () =\u003e {\n\t\t\t\t\tself.store (dst, i32::add_2 (\n\t\t\t\t\t\tself.load (dst),\n\t\t\t\t\t\ti32::mul_2 (self.load (arg), self.load (ctr)) ?,\n\t\t\t\t\t) ?);\n\t\t\t\t\tself.store (tmp, 0);\n\t\t\t\t\tself.store (ctr, 0);\n\t\t\t\t\treturn Ok (());\n\t\t\t\t},\n\t\t\t\t_ =\u003e (),\n\t\t\t}\n\t\t}\n\n\t\tif self.next \u003e= 7 {\n\t\t\tmatch \u003c[Instr; 8]\u003e::try_from (\n\t\t\t\t\u0026 self.instrs [self.next.as_usize () - 7 .. self.next.as_usize () + 1],\n\t\t\t).unwrap () {\n\t\t\t\t[\n\t\t\t\t\tInstr::Cpy (Arg::Imm (div), rem),\n\t\t\t\t\tInstr::Jnz (mul, Arg::Imm (2_i32)),\n\t\t\t\t\tInstr::Jnz (Arg::Imm (1_i32), Arg::Imm (6_i32)),\n\t\t\t\t\tInstr::Dec (mul_0),\n\t\t\t\t\tInstr::Dec (rem_0),\n\t\t\t\t\tInstr::Jnz (rem_1, Arg::Imm (-4_i32)),\n\t\t\t\t\tInstr::Inc (out),\n\t\t\t\t\tInstr::Jnz (Arg::Imm (1_i32), Arg::Imm (-7_i32)),\n\t\t\t\t] if rem != mul \u0026\u0026 rem != out \u0026\u0026 mul != out \u0026\u0026 mul == mul_0 \u0026\u0026 rem == rem_0\n\t\t\t\t\t\t\u0026\u0026 rem == rem_1 \u0026\u0026 rem.is_reg () \u0026\u0026 mul.is_reg () \u0026\u0026 out.is_reg () =\u003e {\n\t\t\t\t\tself.store (out, i32::add_2 (\n\t\t\t\t\t\tself.load (out),\n\t\t\t\t\t\ti32::div_2 (self.load (mul), div) ?,\n\t\t\t\t\t) ?);\n\t\t\t\t\tlet rem_val = self.load (mul) % div;\n\t\t\t\t\tself.store (rem, if rem_val == 0 { div } else { rem_val });\n\t\t\t\t\tself.store (mul, 0);\n\t\t\t\t\tself.next += 1;\n\t\t\t\t\treturn Ok (())\n\t\t\t\t},\n\t\t\t\t_ =\u003e (),\n\t\t\t}\n\t\t}\n\n\t\t// if not then jump as described\n\n\t\tself.next = u32::add_signed (self.next, self.load (dst)) ?;\n\t\tOk (())\n\n\t}\n\n}\n\n#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\npub enum Instr {\n\tCpy (Arg, Arg),\n\tInc (Arg),\n\tDec (Arg),\n\tJnz (Arg, Arg),\n\tTgl (Arg),\n\tOut (Arg),\n}\n\n#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\npub enum Arg { RegA, RegB, RegC, RegD, Imm (i32) }\n\nimpl Instr {\n\n\t#[ must_use ]\n\tpub const fn is_v1 (\u0026 self) -\u003e bool {\n\t\tuse Instr::{ Cpy, Dec, Inc, Jnz };\n\t\tmatches! (* self, Cpy (_, _) | Inc (_) | Dec (_) | Jnz (_, _))\n\t}\n\n\t#[ must_use ]\n\tpub const fn is_v2 (\u0026 self) -\u003e bool {\n\t\tuse Instr::{ Cpy, Dec, Inc, Jnz, Tgl };\n\t\tmatches! (* self, Cpy (_, _) | Inc (_) | Dec (_) | Jnz (_, _) | Tgl (_))\n\t}\n\n\t#[ must_use ]\n\tpub const fn is_v3 (\u0026 self) -\u003e bool {\n\t\tuse Instr::{ Cpy, Dec, Inc, Jnz, Out };\n\t\tmatches! (* self, Cpy (_, _) | Inc (_) | Dec (_) | Jnz (_, _) | Out (_))\n\t}\n\n}\n\nimpl FromParser for Instr {\n\tfn from_parser (parser: \u0026 mut Parser) -\u003e ParseResult \u003cSelf\u003e {\n\t\tparser.any ()\n\t\t\t.of (|parser| {\n\t\t\t\tlet arg_0 = parser.expect (\"cpy \") ?.confirm ().item () ?;\n\t\t\t\tlet arg_1 = parser.expect (\" \") ?.item () ?;\n\t\t\t\tparser.end () ?;\n\t\t\t\tOk (Self::Cpy (arg_0, arg_1))\n\t\t\t})\n\t\t\t.of (|parser| {\n\t\t\t\tlet arg = parser.expect (\"inc \") ?.confirm ().item () ?;\n\t\t\t\tparser.end () ?;\n\t\t\t\tOk (Self::Inc (arg))\n\t\t\t})\n\t\t\t.of (|parser| {\n\t\t\t\tlet arg = parser.expect (\"dec \") ?.confirm ().item () ?;\n\t\t\t\tparser.end () ?;\n\t\t\t\tOk (Self::Dec (arg))\n\t\t\t})\n\t\t\t.of (|parser| {\n\t\t\t\tlet arg_0 = parser.expect (\"jnz \") ?.confirm ().item () ?;\n\t\t\t\tlet arg_1 = parser.expect (\" \") ?.confirm ().item () ?;\n\t\t\t\tparser.end () ?;\n\t\t\t\tOk (Self::Jnz (arg_0, arg_1))\n\t\t\t})\n\t\t\t.of (|parser| {\n\t\t\t\tlet arg = parser.expect (\"tgl \") ?.confirm ().item () ?;\n\t\t\t\tparser.end () ?;\n\t\t\t\tOk (Self::Tgl (arg))\n\t\t\t})\n\t\t\t.of (|parser| {\n\t\t\t\tlet arg = parser.expect (\"out \") ?.confirm ().item () ?;\n\t\t\t\tparser.end () ?;\n\t\t\t\tOk (Self::Out (arg))\n\t\t\t})\n\t\t\t.done ()\n\t}\n}\n\nimpl Arg {\n\t#[ must_use ]\n\tpub const fn is_reg (\u0026 self) -\u003e bool {\n\t\tmatches! (* self, Self::RegA | Self::RegB | Self::RegC | Self::RegD)\n\t}\n}\n\nimpl FromParser for Arg {\n\tfn from_parser (parser: \u0026 mut Parser) -\u003e ParseResult \u003cSelf\u003e {\n\t\tparser.any ()\n\t\t\t.of (|parser| { parser.expect (\"a\") ?; Ok (Self::RegA) })\n\t\t\t.of (|parser| { parser.expect (\"b\") ?; Ok (Self::RegB) })\n\t\t\t.of (|parser| { parser.expect (\"c\") ?; Ok (Self::RegC) })\n\t\t\t.of (|parser| { parser.expect (\"d\") ?; Ok (Self::RegD) })\n\t\t\t.of (|parser| { let val = parser.int () ?; Ok (Self::Imm (val)) })\n\t\t\t.done ()\n\t}\n}\n","traces":[{"line":28,"address":[14688],"length":1,"stats":{"Line":0},"fn_name":"load"},{"line":29,"address":[14709],"length":1,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[14745],"length":1,"stats":{"Line":0},"fn_name":null},{"line":31,"address":[14758],"length":1,"stats":{"Line":0},"fn_name":null},{"line":32,"address":[14771],"length":1,"stats":{"Line":0},"fn_name":null},{"line":33,"address":[14784],"length":1,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[14793],"length":1,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[14816],"length":1,"stats":{"Line":0},"fn_name":"store"},{"line":39,"address":[14845],"length":1,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[14885],"length":1,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[14898],"length":1,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[14911],"length":1,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[14924],"length":1,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[14944],"length":1,"stats":{"Line":0},"fn_name":"exec"},{"line":49,"address":[17177,14991,15074],"length":1,"stats":{"Line":0},"fn_name":null},{"line":50,"address":[15166,17236],"length":1,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[15309,15219],"length":1,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[15347,15307,15257],"length":1,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[17152,15460],"length":1,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[15547,16985],"length":1,"stats":{"Line":0},"fn_name":null},{"line":56,"address":[16840,15614],"length":1,"stats":{"Line":0},"fn_name":null},{"line":57,"address":[15681,16721,16784],"length":1,"stats":{"Line":0},"fn_name":null},{"line":58,"address":[15762],"length":1,"stats":{"Line":0},"fn_name":null},{"line":59,"address":[16008,15782,16123],"length":1,"stats":{"Line":0},"fn_name":null},{"line":60,"address":[16203,16703],"length":1,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[16164],"length":1,"stats":{"Line":0},"fn_name":null},{"line":63,"address":[16670,16312,16483,16250,16599],"length":1,"stats":{"Line":0},"fn_name":null},{"line":64,"address":[16319],"length":1,"stats":{"Line":0},"fn_name":null},{"line":65,"address":[16493],"length":1,"stats":{"Line":0},"fn_name":null},{"line":66,"address":[16408],"length":1,"stats":{"Line":0},"fn_name":null},{"line":67,"address":[16463,16579,16606],"length":1,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[16626],"length":1,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[15819],"length":1,"stats":{"Line":0},"fn_name":null},{"line":73,"address":[15847,15898],"length":1,"stats":{"Line":0},"fn_name":null},{"line":74,"address":[15940,15887],"length":1,"stats":{"Line":0},"fn_name":null},{"line":77,"address":[16286,17174,17182],"length":1,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[15116],"length":1,"stats":{"Line":0},"fn_name":null},{"line":82,"address":[17264],"length":1,"stats":{"Line":0},"fn_name":"jnz"},{"line":86,"address":[17331],"length":1,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[17363,24320,24340],"length":1,"stats":{"Line":0},"fn_name":null},{"line":88,"address":[24323],"length":1,"stats":{"Line":0},"fn_name":null},{"line":93,"address":[17400],"length":1,"stats":{"Line":0},"fn_name":null},{"line":94,"address":[18304,17755,18664],"length":1,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[17495,17437],"length":1,"stats":{"Line":0},"fn_name":null},{"line":97,"address":[18636,18396],"length":1,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[18245,18677],"length":1,"stats":{"Line":0},"fn_name":null},{"line":107,"address":[18894],"length":1,"stats":{"Line":0},"fn_name":null},{"line":108,"address":[18915],"length":1,"stats":{"Line":0},"fn_name":null},{"line":114,"address":[17414],"length":1,"stats":{"Line":0},"fn_name":null},{"line":115,"address":[19278],"length":1,"stats":{"Line":0},"fn_name":null},{"line":116,"address":[18960,19018],"length":1,"stats":{"Line":0},"fn_name":null},{"line":118,"address":[19559,19795],"length":1,"stats":{"Line":0},"fn_name":null},{"line":125,"address":[19967],"length":1,"stats":{"Line":0},"fn_name":null},{"line":126,"address":[19907],"length":1,"stats":{"Line":0},"fn_name":null},{"line":127,"address":[19941],"length":1,"stats":{"Line":0},"fn_name":null},{"line":129,"address":[20139],"length":1,"stats":{"Line":0},"fn_name":null},{"line":135,"address":[18937],"length":1,"stats":{"Line":0},"fn_name":null},{"line":136,"address":[20500],"length":1,"stats":{"Line":0},"fn_name":null},{"line":137,"address":[20240,20182],"length":1,"stats":{"Line":0},"fn_name":null},{"line":139,"address":[21409,20705],"length":1,"stats":{"Line":0},"fn_name":null},{"line":147,"address":[21133],"length":1,"stats":{"Line":0},"fn_name":null},{"line":148,"address":[21337],"length":1,"stats":{"Line":0},"fn_name":null},{"line":149,"address":[21850,21918],"length":1,"stats":{"Line":0},"fn_name":null},{"line":150,"address":[21661],"length":1,"stats":{"Line":0},"fn_name":null},{"line":151,"address":[21695,21871],"length":1,"stats":{"Line":0},"fn_name":null},{"line":153,"address":[22057],"length":1,"stats":{"Line":0},"fn_name":null},{"line":154,"address":[22086],"length":1,"stats":{"Line":0},"fn_name":null},{"line":155,"address":[22093],"length":1,"stats":{"Line":0},"fn_name":null},{"line":161,"address":[20159],"length":1,"stats":{"Line":0},"fn_name":null},{"line":162,"address":[22485],"length":1,"stats":{"Line":0},"fn_name":null},{"line":163,"address":[22225,22167],"length":1,"stats":{"Line":0},"fn_name":null},{"line":165,"address":[23492,23006],"length":1,"stats":{"Line":0},"fn_name":null},{"line":175,"address":[23225],"length":1,"stats":{"Line":0},"fn_name":null},{"line":176,"address":[23668,23724],"length":1,"stats":{"Line":0},"fn_name":null},{"line":177,"address":[23546],"length":1,"stats":{"Line":0},"fn_name":null},{"line":178,"address":[23571,23683],"length":1,"stats":{"Line":0},"fn_name":null},{"line":180,"address":[23851,23964],"length":1,"stats":{"Line":0},"fn_name":null},{"line":181,"address":[23957,23998],"length":1,"stats":{"Line":0},"fn_name":null},{"line":182,"address":[24062],"length":1,"stats":{"Line":0},"fn_name":null},{"line":183,"address":[24077,24126],"length":1,"stats":{"Line":0},"fn_name":null},{"line":184,"address":[24109],"length":1,"stats":{"Line":0},"fn_name":null},{"line":192,"address":[24170,24272,22132],"length":1,"stats":{"Line":0},"fn_name":null},{"line":193,"address":[24255],"length":1,"stats":{"Line":0},"fn_name":null},{"line":215,"address":[24384],"length":1,"stats":{"Line":0},"fn_name":"is_v1"},{"line":217,"address":[24393],"length":1,"stats":{"Line":0},"fn_name":null},{"line":221,"address":[24432],"length":1,"stats":{"Line":0},"fn_name":"is_v2"},{"line":223,"address":[24441],"length":1,"stats":{"Line":0},"fn_name":null},{"line":227,"address":[24480],"length":1,"stats":{"Line":0},"fn_name":"is_v3"},{"line":229,"address":[24489],"length":1,"stats":{"Line":0},"fn_name":null},{"line":235,"address":[24544],"length":1,"stats":{"Line":0},"fn_name":"from_parser"},{"line":236,"address":[24568],"length":1,"stats":{"Line":0},"fn_name":null},{"line":237,"address":[57120,57625,58316],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":238,"address":[57384,57508,57166],"length":1,"stats":{"Line":0},"fn_name":null},{"line":239,"address":[57473,57944,57830,57633],"length":1,"stats":{"Line":0},"fn_name":null},{"line":240,"address":[58065,57924,58150],"length":1,"stats":{"Line":0},"fn_name":null},{"line":241,"address":[58130,58276],"length":1,"stats":{"Line":0},"fn_name":null},{"line":243,"address":[58336,59073,58823],"length":1,"stats":{"Line":0},"fn_name":"{closure#1}"},{"line":244,"address":[58594,58706,58382],"length":1,"stats":{"Line":0},"fn_name":null},{"line":245,"address":[58683,58831,58907],"length":1,"stats":{"Line":0},"fn_name":null},{"line":246,"address":[58887,59033],"length":1,"stats":{"Line":0},"fn_name":null},{"line":248,"address":[59825,59088,59575],"length":1,"stats":{"Line":0},"fn_name":"{closure#2}"},{"line":249,"address":[59134,59458,59346],"length":1,"stats":{"Line":0},"fn_name":null},{"line":250,"address":[59583,59659,59435],"length":1,"stats":{"Line":0},"fn_name":null},{"line":251,"address":[59639,59785],"length":1,"stats":{"Line":0},"fn_name":null},{"line":253,"address":[60345,59840,61049],"length":1,"stats":{"Line":0},"fn_name":"{closure#3}"},{"line":254,"address":[60228,59886,60104],"length":1,"stats":{"Line":0},"fn_name":null},{"line":255,"address":[60193,60353,60552,60678],"length":1,"stats":{"Line":0},"fn_name":null},{"line":256,"address":[60799,60883,60658],"length":1,"stats":{"Line":0},"fn_name":null},{"line":257,"address":[60863,61009],"length":1,"stats":{"Line":0},"fn_name":null},{"line":259,"address":[61793,61056,61543],"length":1,"stats":{"Line":0},"fn_name":"{closure#4}"},{"line":260,"address":[61426,61314,61102],"length":1,"stats":{"Line":0},"fn_name":null},{"line":261,"address":[61403,61627,61551],"length":1,"stats":{"Line":0},"fn_name":null},{"line":262,"address":[61753,61607],"length":1,"stats":{"Line":0},"fn_name":null},{"line":264,"address":[61808,62295,62545],"length":1,"stats":{"Line":0},"fn_name":"{closure#5}"},{"line":265,"address":[62178,61854,62066],"length":1,"stats":{"Line":0},"fn_name":null},{"line":266,"address":[62379,62155,62303],"length":1,"stats":{"Line":0},"fn_name":null},{"line":267,"address":[62505,62359],"length":1,"stats":{"Line":0},"fn_name":null},{"line":275,"address":[24720],"length":1,"stats":{"Line":0},"fn_name":"is_reg"},{"line":276,"address":[24729],"length":1,"stats":{"Line":0},"fn_name":null},{"line":281,"address":[24768],"length":1,"stats":{"Line":0},"fn_name":"from_parser"},{"line":282,"address":[24792],"length":1,"stats":{"Line":0},"fn_name":null},{"line":283,"address":[62604,62560],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":284,"address":[62816,62860],"length":1,"stats":{"Line":0},"fn_name":"{closure#1}"},{"line":285,"address":[63072,63116],"length":1,"stats":{"Line":0},"fn_name":"{closure#2}"},{"line":286,"address":[63328,63372],"length":1,"stats":{"Line":0},"fn_name":"{closure#3}"},{"line":287,"address":[63630,63584],"length":1,"stats":{"Line":0},"fn_name":"{closure#4}"}],"covered":0,"coverable":126},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-01","src","lib.rs"],"content":"//! Advent of Code 2016: Day 1: No Time for a Taxicab\n//!\n//! [https://adventofcode.com/2016/day/1](https://adventofcode.com/2016/day/1)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\nuse aoc_pos as pos;\n\npuzzle_info! {\n\tname = \"No Time for a Taxicab\";\n\tyear = 2016;\n\tday = 1;\n\tparse = |input| model::Input::parse (input [0]);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Dir;\n\tuse model::Input;\n\tuse model::Pos;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cu32\u003e {\n\t\tlet mut dir = Dir::North;\n\t\tlet mut pos = Pos::ZERO;\n\t\tfor (turn, dist) in input.steps.iter_vals () {\n\t\t\tdir = dir + turn;\n\t\t\tpos = (pos + (dir, dist)) ?;\n\t\t}\n\t\tlet dist = pos.n.unsigned_abs () + pos.e.unsigned_abs ();\n\t\tOk (dist)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cu32\u003e {\n\t\tlet mut dir = Dir::North;\n\t\tlet mut pos = Pos::ZERO;\n\t\tlet mut seen = HashSet::new ();\n\t\tlet mut twice = None;\n\t\tseen.insert (pos);\n\t\t'OUTER: for (turn, dist) in input.steps.iter_vals () {\n\t\t\tdir = dir + turn;\n\t\t\tfor _ in 0_i32 .. dist {\n\t\t\t\tpos = (pos + (dir, 1_i32)) ?;\n\t\t\t\tif ! seen.insert (pos) { twice = Some (pos); break 'OUTER }\n\t\t\t}\n\t\t}\n\t\tlet dist = if let Some (twice) = twice {\n\t\t\ttwice.n.unsigned_abs () + twice.e.unsigned_abs ()\n\t\t} else { Err (\"No solution found\") ? };\n\t\tOk (dist)\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse parser::*;\n\n\tpub type Dir = pos::DirGeo;\n\tpub type Pos = pos::PosGeo \u003ci32\u003e;\n\tpub type Turn = pos::Turn2d;\n\n\t#[ derive (Clone, Debug, Eq, PartialEq) ]\n\tpub struct Input {\n\t\tpub steps: Vec \u003c(Turn, i32)\u003e,\n\t}\n\n\timpl Input {\n\t\tpub fn parse (input: \u0026 str) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tParser::wrap (input, |parser| {\n\t\t\t\tlet mut steps = Vec::new ();\n\t\t\t\tloop {\n\t\t\t\t\tlet dir = match parser.expect_next () ? {\n\t\t\t\t\t\t'L' =\u003e Turn::Left,\n\t\t\t\t\t\t'R' =\u003e Turn::Right,\n\t\t\t\t\t\t_ =\u003e Err (parser.err ()) ?,\n\t\t\t\t\t};\n\t\t\t\t\tlet dist = parser.int () ?;\n\t\t\t\t\tif dist \u003c 1_i32 { Err (\"Min distance is 1\") ?; }\n\t\t\t\t\tif dist \u003e 1000_i32 { Err (\"Max distance is 1000\") ?; }\n\t\t\t\t\tsteps.push ((dir, dist));\n\t\t\t\t\tif parser.peek ().is_none () { break }\n\t\t\t\t\tparser.expect (\", \") ?;\n\t\t\t\t}\n\t\t\t\tOk (Self { steps })\n\t\t\t}).map_parse_err (|col_idx| format! (\"Invalid input: col {}: {}\", col_idx + 1, input))\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLES: \u0026 [\u0026 str] = \u0026 [\n\t\t\"R2, L3\",\n\t\t\"R2, R2, R2\",\n\t\t\"R5, L5, R5, R3\",\n\t\t\"R8, R4, R4, R8\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"5\", puzzle.part_one (\u0026 [EXAMPLES [0]]));\n\t\tassert_eq_ok! (\"2\", puzzle.part_one (\u0026 [EXAMPLES [1]]));\n\t\tassert_eq_ok! (\"12\", puzzle.part_one (\u0026 [EXAMPLES [2]]));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"4\", puzzle.part_two (\u0026 [EXAMPLES [3]]));\n\t}\n\n}\n","traces":[{"line":14,"address":[28323,29043],"length":1,"stats":{"Line":2},"fn_name":null},{"line":15,"address":[28484],"length":1,"stats":{"Line":1},"fn_name":null},{"line":16,"address":[29204],"length":1,"stats":{"Line":1},"fn_name":null},{"line":26,"address":[49216],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":27,"address":[49254],"length":1,"stats":{"Line":1},"fn_name":null},{"line":28,"address":[49259],"length":1,"stats":{"Line":1},"fn_name":null},{"line":29,"address":[49582,49395,49279],"length":1,"stats":{"Line":3},"fn_name":null},{"line":30,"address":[49421],"length":1,"stats":{"Line":1},"fn_name":null},{"line":31,"address":[49450,49592],"length":1,"stats":{"Line":1},"fn_name":null},{"line":33,"address":[49377,49678,49617],"length":1,"stats":{"Line":2},"fn_name":null},{"line":34,"address":[49667],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[49712,50838],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":38,"address":[49742],"length":1,"stats":{"Line":1},"fn_name":null},{"line":39,"address":[49747],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[49767],"length":1,"stats":{"Line":1},"fn_name":null},{"line":41,"address":[49780],"length":1,"stats":{"Line":1},"fn_name":null},{"line":42,"address":[49791],"length":1,"stats":{"Line":1},"fn_name":null},{"line":43,"address":[49859,50026],"length":1,"stats":{"Line":2},"fn_name":null},{"line":44,"address":[50054,50019],"length":1,"stats":{"Line":2},"fn_name":null},{"line":45,"address":[50082],"length":1,"stats":{"Line":1},"fn_name":null},{"line":46,"address":[50387,50218],"length":1,"stats":{"Line":1},"fn_name":null},{"line":47,"address":[50425,50355],"length":1,"stats":{"Line":2},"fn_name":null},{"line":50,"address":[50504,50804,49997,50650],"length":1,"stats":{"Line":3},"fn_name":null},{"line":51,"address":[50536,50806,50761],"length":1,"stats":{"Line":2},"fn_name":null},{"line":52,"address":[50657,50550],"length":1,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[50726],"length":1,"stats":{"Line":1},"fn_name":null},{"line":73,"address":[53488],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":74,"address":[53147,51504,52953],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":75,"address":[51542],"length":1,"stats":{"Line":1},"fn_name":null},{"line":76,"address":[53019],"length":1,"stats":{"Line":1},"fn_name":null},{"line":77,"address":[51622,51565,51800],"length":1,"stats":{"Line":2},"fn_name":null},{"line":78,"address":[51827],"length":1,"stats":{"Line":1},"fn_name":null},{"line":79,"address":[51837],"length":1,"stats":{"Line":1},"fn_name":null},{"line":80,"address":[51820,51847],"length":1,"stats":{"Line":0},"fn_name":null},{"line":82,"address":[52102,52191],"length":1,"stats":{"Line":1},"fn_name":null},{"line":83,"address":[52175,52329],"length":1,"stats":{"Line":1},"fn_name":null},{"line":84,"address":[52547,52313],"length":1,"stats":{"Line":1},"fn_name":null},{"line":85,"address":[52500],"length":1,"stats":{"Line":1},"fn_name":null},{"line":86,"address":[52723],"length":1,"stats":{"Line":1},"fn_name":null},{"line":87,"address":[52977,53029,52783],"length":1,"stats":{"Line":2},"fn_name":null},{"line":89,"address":[52818],"length":1,"stats":{"Line":1},"fn_name":null},{"line":90,"address":[53222,52074,53184,51577],"length":1,"stats":{"Line":1},"fn_name":"{closure#1}"},{"line":109,"address":[32144,32809,34027],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":110,"address":[32151],"length":1,"stats":{"Line":1},"fn_name":null},{"line":111,"address":[32196,32386,32311],"length":1,"stats":{"Line":3},"fn_name":null},{"line":112,"address":[32968,32820],"length":1,"stats":{"Line":2},"fn_name":null},{"line":113,"address":[33377,33525],"length":1,"stats":{"Line":2},"fn_name":null},{"line":117,"address":[34064,34694,34648],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":118,"address":[34071],"length":1,"stats":{"Line":1},"fn_name":null},{"line":119,"address":[34094,34255,34189],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":48,"coverable":50},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-02","src","lib.rs"],"content":"//! Advent of Code 2016: Day 2: Bathroom Security\n//!\n//! [https://adventofcode.com/2016/day/2](https://adventofcode.com/2016/day/2)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\nuse aoc_pos as pos;\n\npuzzle_info! {\n\tname = \"Bathroom Security\";\n\tyear = 2016;\n\tday = 2;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Dir;\n\tuse model::Input;\n\tuse model::Pos;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cString\u003e {\n\t\tlet digits = |pos| match pos {\n\t\t\tPos { row: 0, col: 0 } =\u003e Some ('1'),\n\t\t\tPos { row: 0, col: 1 } =\u003e Some ('2'),\n\t\t\tPos { row: 0, col: 2 } =\u003e Some ('3'),\n\t\t\tPos { row: 1, col: 0 } =\u003e Some ('4'),\n\t\t\tPos { row: 1, col: 1 } =\u003e Some ('5'),\n\t\t\tPos { row: 1, col: 2 } =\u003e Some ('6'),\n\t\t\tPos { row: 2, col: 0 } =\u003e Some ('7'),\n\t\t\tPos { row: 2, col: 1 } =\u003e Some ('8'),\n\t\t\tPos { row: 2, col: 2 } =\u003e Some ('9'),\n\t\t\t_ =\u003e None,\n\t\t};\n\t\tlet code = calc_code (\u0026 input.steps, digits, Pos { row: 1, col: 1 }) ?;\n\t\tOk (code)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cString\u003e {\n\t\tlet digits = |pos| match pos {\n\t\t\tPos { row: 0, col: 2 } =\u003e Some ('1'),\n\t\t\tPos { row: 1, col: 1 } =\u003e Some ('2'),\n\t\t\tPos { row: 1, col: 2 } =\u003e Some ('3'),\n\t\t\tPos { row: 1, col: 3 } =\u003e Some ('4'),\n\t\t\tPos { row: 2, col: 0 } =\u003e Some ('5'),\n\t\t\tPos { row: 2, col: 1 } =\u003e Some ('6'),\n\t\t\tPos { row: 2, col: 2 } =\u003e Some ('7'),\n\t\t\tPos { row: 2, col: 3 } =\u003e Some ('8'),\n\t\t\tPos { row: 2, col: 4 } =\u003e Some ('9'),\n\t\t\tPos { row: 3, col: 1 } =\u003e Some ('A'),\n\t\t\tPos { row: 3, col: 2 } =\u003e Some ('B'),\n\t\t\tPos { row: 3, col: 3 } =\u003e Some ('C'),\n\t\t\tPos { row: 4, col: 2 } =\u003e Some ('D'),\n\t\t\t_ =\u003e None,\n\t\t};\n\t\tlet code = calc_code (\u0026 input.steps, digits, Pos { row: 2, col: 0 }) ?;\n\t\tOk (code)\n\t}\n\n\tfn calc_code (\n\t\tsteps: \u0026 [Vec \u003cDir\u003e],\n\t\tdigits: fn (Pos) -\u003e Option \u003cchar\u003e,\n\t\tmut pos: Pos,\n\t) -\u003e GenResult \u003cString\u003e {\n\t\tlet mut code = String::new ();\n\t\tfor line in steps.iter () {\n\t\t\tfor step in line.iter_vals () {\n\t\t\t\tlet new_pos = (pos + (step, 1)) ?;\n\t\t\t\tif digits (new_pos).is_some () { pos = new_pos; }\n\t\t\t}\n\t\t\tcode.push (digits (pos).unwrap ());\n\t\t}\n\t\tOk (code)\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\n\tpub type Coord = i8;\n\tpub type Dir = pos::Dir2d;\n\tpub type Pos = pos::PosRowCol \u003cCoord\u003e;\n\n\t#[ derive (Clone, Debug, Eq, PartialEq) ]\n\tpub struct Input {\n\t\tpub steps: Vec \u003cVec \u003cDir\u003e\u003e,\n\t}\n\n\timpl Input {\n\t\tpub fn parse (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet steps = input.iter ()\n\t\t\t\t.enumerate ()\n\t\t\t\t.map (|(line_idx, line)|\n\t\t\t\t\tline.chars ()\n\t\t\t\t\t\t.enumerate ()\n\t\t\t\t\t\t.map (|(col_idx, ch)| Ok (match ch {\n\t\t\t\t\t\t\t'U' =\u003e Dir::Up,\n\t\t\t\t\t\t\t'D' =\u003e Dir::Down,\n\t\t\t\t\t\t\t'L' =\u003e Dir::Left,\n\t\t\t\t\t\t\t'R' =\u003e Dir::Right,\n\t\t\t\t\t\t\t_ =\u003e Err (format! (\n\t\t\t\t\t\t\t\t\"Invalid input: line {}: col {}: {}\",\n\t\t\t\t\t\t\t\tline_idx + 1, col_idx, line)) ?,\n\t\t\t\t\t\t}))\n\t\t\t\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e ())\n\t\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e () ?;\n\t\t\tOk (Self { steps })\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"ULL\",\n\t\t\"RRDDD\",\n\t\t\"LURDL\",\n\t\t\"UUUUD\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"1985\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"5DB3\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":14,"address":[61331,60563],"length":1,"stats":{"Line":2},"fn_name":null},{"line":15,"address":[60669],"length":1,"stats":{"Line":1},"fn_name":null},{"line":16,"address":[61437],"length":1,"stats":{"Line":1},"fn_name":null},{"line":26,"address":[35952],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":27,"address":[52366,52336,52409,52535],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":28,"address":[52574],"length":1,"stats":{"Line":1},"fn_name":null},{"line":29,"address":[52584],"length":1,"stats":{"Line":1},"fn_name":null},{"line":30,"address":[52594],"length":1,"stats":{"Line":1},"fn_name":null},{"line":31,"address":[52544],"length":1,"stats":{"Line":0},"fn_name":null},{"line":32,"address":[52554],"length":1,"stats":{"Line":1},"fn_name":null},{"line":33,"address":[52564],"length":1,"stats":{"Line":1},"fn_name":null},{"line":34,"address":[52507],"length":1,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[52517],"length":1,"stats":{"Line":1},"fn_name":null},{"line":36,"address":[52527],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[52392],"length":1,"stats":{"Line":1},"fn_name":null},{"line":39,"address":[36273,35988],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[36184],"length":1,"stats":{"Line":1},"fn_name":null},{"line":43,"address":[36336],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":44,"address":[52824,52608,52634,52684],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":45,"address":[52943],"length":1,"stats":{"Line":1},"fn_name":null},{"line":46,"address":[52913],"length":1,"stats":{"Line":0},"fn_name":null},{"line":47,"address":[52923],"length":1,"stats":{"Line":1},"fn_name":null},{"line":48,"address":[52933],"length":1,"stats":{"Line":0},"fn_name":null},{"line":49,"address":[52863],"length":1,"stats":{"Line":1},"fn_name":null},{"line":50,"address":[52873],"length":1,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[52883],"length":1,"stats":{"Line":1},"fn_name":null},{"line":52,"address":[52893],"length":1,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[52903],"length":1,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[52833],"length":1,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[52843],"length":1,"stats":{"Line":1},"fn_name":null},{"line":56,"address":[52853],"length":1,"stats":{"Line":1},"fn_name":null},{"line":57,"address":[52816],"length":1,"stats":{"Line":1},"fn_name":null},{"line":58,"address":[52667],"length":1,"stats":{"Line":1},"fn_name":null},{"line":60,"address":[36372,36657],"length":1,"stats":{"Line":1},"fn_name":null},{"line":61,"address":[36568],"length":1,"stats":{"Line":1},"fn_name":null},{"line":64,"address":[37771,36720],"length":1,"stats":{"Line":1},"fn_name":"calc_code"},{"line":69,"address":[36821],"length":1,"stats":{"Line":1},"fn_name":null},{"line":70,"address":[37123,36847,36918],"length":1,"stats":{"Line":3},"fn_name":null},{"line":71,"address":[37294,37139],"length":1,"stats":{"Line":2},"fn_name":null},{"line":72,"address":[37308,37603],"length":1,"stats":{"Line":1},"fn_name":null},{"line":73,"address":[37651,37581],"length":1,"stats":{"Line":2},"fn_name":null},{"line":75,"address":[37267,37725],"length":1,"stats":{"Line":2},"fn_name":null},{"line":77,"address":[37027],"length":1,"stats":{"Line":1},"fn_name":null},{"line":96,"address":[21472],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":97,"address":[21889,21531],"length":1,"stats":{"Line":1},"fn_name":null},{"line":99,"address":[26536,26658,26496],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":100,"address":[26546,26614],"length":1,"stats":{"Line":2},"fn_name":null},{"line":102,"address":[26672,27362,26594,26719],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":103,"address":[26796],"length":1,"stats":{"Line":1},"fn_name":null},{"line":104,"address":[26806],"length":1,"stats":{"Line":1},"fn_name":null},{"line":105,"address":[26816],"length":1,"stats":{"Line":1},"fn_name":null},{"line":106,"address":[26826],"length":1,"stats":{"Line":1},"fn_name":null},{"line":107,"address":[26849,26905,27342],"length":1,"stats":{"Line":0},"fn_name":null},{"line":109,"address":[26875,26772,26841,27239],"length":1,"stats":{"Line":0},"fn_name":null},{"line":113,"address":[21726],"length":1,"stats":{"Line":1},"fn_name":null},{"line":132,"address":[80851,80897,80288],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":133,"address":[80295],"length":1,"stats":{"Line":1},"fn_name":null},{"line":134,"address":[80392,80318,80458],"length":1,"stats":{"Line":3},"fn_name":null},{"line":138,"address":[81491,80928,81537],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":139,"address":[80935],"length":1,"stats":{"Line":1},"fn_name":null},{"line":140,"address":[81032,81098,80958],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":52,"coverable":61},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-03","src","lib.rs"],"content":"//! Advent of Code 2016: Day 3: Squares With Three Sides\n//!\n//! [https://adventofcode.com/2016/day/3](https://adventofcode.com/2016/day/3)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Squares With Three Sides\";\n\tyear = 2016;\n\tday = 3;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cusize\u003e {\n\t\tlet num_possible =\n\t\t\tinput.triangles.iter_vals ()\n\t\t\t\t.map (|(a, b, c)| [a, b, c])\n\t\t\t\t.map (|mut sides| { sides.sort (); sides })\n\t\t\t\t.filter (|\u0026 [a, b, c]| c \u003c a + b)\n\t\t\t\t.count ();\n\t\tOk (num_possible)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cusize\u003e {\n\t\tlet num_possible =\n\t\t\tinput.triangles.iter_vals ()\n\t\t\t\t.tuples::\u003c(_, _, _)\u003e ()\n\t\t\t\t.flat_map (\n\t\t\t\t\t|((a0, a1, a2), (b0, b1, b2), (c0, c1, c2))|\n\t\t\t\t\t\t[(a0, b0, c0), (a1, b1, c1), (a2, b2, c2) ])\n\t\t\t\t.map (|(a, b, c)| [a, b, c])\n\t\t\t\t.map (|mut sides| { sides.sort (); sides })\n\t\t\t\t.filter (|\u0026 [a, b, c]| c \u003c a + b)\n\t\t\t\t.count ();\n\t\tOk (num_possible)\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse parser::*;\n\n\tpub type Side = u16;\n\tpub type Triangle = (Side, Side, Side);\n\n\t#[ derive (Clone, Debug, Eq, PartialEq) ]\n\tpub struct Input {\n\t\tpub triangles: Vec \u003cTriangle\u003e,\n\t}\n\n\timpl Input {\n\t\tpub fn parse (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet triangles = input.iter ()\n\t\t\t\t.enumerate ()\n\t\t\t\t.map (|(line_idx, line)|\n\t\t\t\t\tParser::wrap (line, |parser| {\n\t\t\t\t\t\tparser.set_ignore_whitespace (true);\n\t\t\t\t\t\tlet side_0 = parser.int () ?;\n\t\t\t\t\t\tlet side_1 = parser.int () ?;\n\t\t\t\t\t\tlet side_2 = parser.int () ?;\n\t\t\t\t\t\tOk ((side_0, side_1, side_2))\n\t\t\t\t\t}).map_parse_err (|col_idx| format! (\n\t\t\t\t\t\t\"Invalid input: line {}: col {}: {}\", line_idx + 1, col_idx + 1, line))\n\t\t\t\t)\n\t\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e () ?;\n\t\t\tOk (Self { triangles })\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"2 2 3\",\n\t\t\"4 6 8\",\n\t\t\"5 10 25\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"2\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"1\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":13,"address":[52531,51843],"length":1,"stats":{"Line":2},"fn_name":null},{"line":14,"address":[51949],"length":1,"stats":{"Line":1},"fn_name":null},{"line":15,"address":[52637],"length":1,"stats":{"Line":1},"fn_name":null},{"line":23,"address":[53232],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":24,"address":[53264],"length":1,"stats":{"Line":1},"fn_name":null},{"line":26,"address":[90252,90208],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":27,"address":[90365,90320],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":28,"address":[90446,90432],"length":1,"stats":{"Line":2},"fn_name":"{closure#2}"},{"line":30,"address":[53394],"length":1,"stats":{"Line":1},"fn_name":null},{"line":33,"address":[53424],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":34,"address":[53462],"length":1,"stats":{"Line":1},"fn_name":null},{"line":38,"address":[90560,90577,90759],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":39,"address":[90665],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[90768,90812],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":41,"address":[90880,90925],"length":1,"stats":{"Line":2},"fn_name":"{closure#2}"},{"line":42,"address":[91006,90992],"length":1,"stats":{"Line":2},"fn_name":"{closure#3}"},{"line":44,"address":[53619],"length":1,"stats":{"Line":1},"fn_name":null},{"line":63,"address":[40128],"length":1,"stats":{"Line":2},"fn_name":"parse"},{"line":64,"address":[40187,40545],"length":1,"stats":{"Line":2},"fn_name":null},{"line":66,"address":[61613,61504,61532],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":67,"address":[61875,61632,61542,61588,62228],"length":1,"stats":{"Line":10},"fn_name":"{closure#0}"},{"line":68,"address":[61678],"length":1,"stats":{"Line":2},"fn_name":null},{"line":69,"address":[61785,61693],"length":1,"stats":{"Line":2},"fn_name":null},{"line":70,"address":[61883,61977,61765],"length":1,"stats":{"Line":4},"fn_name":null},{"line":71,"address":[61957,62098,62238],"length":1,"stats":{"Line":4},"fn_name":null},{"line":72,"address":[62177],"length":1,"stats":{"Line":2},"fn_name":null},{"line":73,"address":[62597,61568,62536,62368,62446],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":74,"address":[62411,62472,62562],"length":1,"stats":{"Line":0},"fn_name":null},{"line":77,"address":[40382],"length":1,"stats":{"Line":2},"fn_name":null},{"line":95,"address":[48197,48192],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":96,"address":[93511],"length":1,"stats":{"Line":1},"fn_name":null},{"line":97,"address":[93534,93608,93674],"length":1,"stats":{"Line":3},"fn_name":null},{"line":101,"address":[48229,48224],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":102,"address":[94151],"length":1,"stats":{"Line":1},"fn_name":null},{"line":103,"address":[94248,94314,94174],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":34,"coverable":35},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-04","src","lib.rs"],"content":"//! Advent of Code 2016: Day 4: Security Through Obscurity\n//!\n//! [https://adventofcode.com/2016/day/4](https://adventofcode.com/2016/day/4)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Security Through Obscurity\";\n\tyear = 2016;\n\tday = 4;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\tuse model::Room;\n\tuse nums::IntConv;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cu32\u003e {\n\t\tlet num_valid =\n\t\t\tinput.rooms.iter ()\n\t\t\t\t.filter (|room| room_is_valid (room))\n\t\t\t\t.map (|room| room.sector)\n\t\t\t\t.sum ();\n\t\tOk (num_valid)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cu32\u003e {\n\t\tlet sector =\n\t\t\tinput.rooms.iter ()\n\t\t\t\t.filter (|room| room_is_valid (room))\n\t\t\t\t.map (|room| Ok::\u003c_, GenError\u003e ((\n\t\t\t\t\troom.sector,\n\t\t\t\t\troom.name.chars ().map (|ch| match ch {\n\t\t\t\t\t\t'-' =\u003e Ok (' '),\n\t\t\t\t\t\t'a' ..= 'z' =\u003e Ok ((\n\t\t\t\t\t\t\t(ch.as_u32 () - 'a'.as_u32 () + room.sector) % 26 + 'a'.as_u32 ()\n\t\t\t\t\t\t).as_char ()),\n\t\t\t\t\t\t_ =\u003e Err (format! (\"Invalid char: {}\", ch).into ()),\n\t\t\t\t\t}).collect::\u003cGenResult \u003cString\u003e\u003e () ?)))\n\t\t\t\t.filter_ok (|\u0026 (_, ref room)| room == \"northpole object storage\")\n\t\t\t\t.map_ok (|(sector, _)| sector)\n\t\t\t\t.next ()\n\t\t\t\t.ok_or (\"No solution found\") ? ?;\n\t\tOk (sector)\n\t}\n\n\tfn room_is_valid (room: \u0026 Room) -\u003e bool {\n\t\troom.checksum ==\n\t\t\troom.name.chars ()\n\t\t\t\t.filter (|\u0026 ch| ch != '-')\n\t\t\t\t.counts ()\n\t\t\t\t.into_iter ()\n\t\t\t\t.sorted_by_key (|\u0026 (ch, num)| (cmp::Reverse (num), ch))\n\t\t\t\t.take (5)\n\t\t\t\t.map (|(ch, _)| ch)\n\t\t\t\t.collect::\u003cString\u003e ()\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse parser::*;\n\n\t#[ derive (Clone, Debug, Eq, PartialEq) ]\n\tpub struct Input {\n\t\tpub rooms: Vec \u003cRoom\u003e,\n\t}\n\n\t#[ derive (Clone, Debug, Eq, PartialEq) ]\n\tpub struct Room {\n\t\tpub name: String,\n\t\tpub sector: u32,\n\t\tpub checksum: String,\n\t}\n\n\timpl Input {\n\t\tpub fn parse (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet rooms = input.iter ()\n\t\t\t\t.enumerate ()\n\t\t\t\t.map (|(line_idx, line)|\n\t\t\t\t\tParser::wrap (line, |parser| {\n\t\t\t\t\t\tparser.set_word_pred (char::is_alphabetic);\n\t\t\t\t\t\tlet mut num_dashes =\n\t\t\t\t\t\t\tparser.rest ().chars ()\n\t\t\t\t\t\t\t\t.filter (|\u0026 ch| ch == '-')\n\t\t\t\t\t\t\t\t.count ();\n\t\t\t\t\t\tlet mut name = String::new ();\n\t\t\t\t\t\tloop {\n\t\t\t\t\t\t\tlet next = parser.expect_next () ?;\n\t\t\t\t\t\t\tif next == '-' {\n\t\t\t\t\t\t\t\tnum_dashes -= 1;\n\t\t\t\t\t\t\t\tif num_dashes == 0 { break }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tname.push (next);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet sector = parser.int () ?;\n\t\t\t\t\t\tlet checksum = parser.expect (\"[\") ?.word () ?.to_owned ();\n\t\t\t\t\t\tparser.expect (\"]\") ?.end () ?;\n\t\t\t\t\t\tOk (Room { name, sector, checksum })\n\t\t\t\t\t}).map_parse_err (|col_idx| format! (\n\t\t\t\t\t\t\"Invalid input: line {}: col {}: {}\", line_idx + 1, col_idx + 1, line)))\n\t\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e () ?;\n\t\t\tOk (Self { rooms })\n\t\t}\n\t}\n\n\t#[ cfg (test) ]\n\tmod tests {\n\n\t\tuse super::*;\n\n\t\t#[ test ]\n\t\tfn input_parse () {\n\t\t\tassert_err! (\"Invalid input: line 1: col 13: abc[def]ghi]\",\n\t\t\t\tInput::parse (\u0026 [ \"abc[def]ghi]\" ]));\n\t\t}\n\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"aaaaa-bbb-z-y-x-123[abxyz]\",\n\t\t\"a-b-c-d-e-f-g-h-987[abcde]\",\n\t\t\"not-a-real-room-404[oarel]\",\n\t\t\"totally-real-room-200[decoy]\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"1514\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_err! (\"No solution found\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":13,"address":[89427,90115],"length":1,"stats":{"Line":2},"fn_name":null},{"line":14,"address":[89533],"length":1,"stats":{"Line":1},"fn_name":null},{"line":15,"address":[90221],"length":1,"stats":{"Line":1},"fn_name":null},{"line":25,"address":[120080],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":26,"address":[120112],"length":1,"stats":{"Line":1},"fn_name":null},{"line":28,"address":[118702,118688],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":29,"address":[118736,118749],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":31,"address":[120239],"length":1,"stats":{"Line":1},"fn_name":null},{"line":34,"address":[120256],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":35,"address":[120685,120294,120699,120779],"length":1,"stats":{"Line":2},"fn_name":null},{"line":37,"address":[118782,118768],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":38,"address":[119242,119114,118816],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":39,"address":[118862],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[119634,119264,119230,118869,119298],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":41,"address":[119310],"length":1,"stats":{"Line":1},"fn_name":null},{"line":42,"address":[119328,119552,119365],"length":1,"stats":{"Line":3},"fn_name":null},{"line":43,"address":[119372],"length":1,"stats":{"Line":1},"fn_name":null},{"line":45,"address":[119652,119339],"length":1,"stats":{"Line":0},"fn_name":null},{"line":46,"address":[119198],"length":1,"stats":{"Line":0},"fn_name":null},{"line":47,"address":[119838,119824],"length":1,"stats":{"Line":2},"fn_name":"{closure#2}"},{"line":48,"address":[119910,119888],"length":1,"stats":{"Line":0},"fn_name":"{closure#3}"},{"line":51,"address":[120737],"length":1,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[121104,120816],"length":1,"stats":{"Line":2},"fn_name":"room_is_valid"},{"line":55,"address":[121042,120831],"length":1,"stats":{"Line":4},"fn_name":null},{"line":56,"address":[120843],"length":1,"stats":{"Line":2},"fn_name":null},{"line":57,"address":[119936,119949],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":60,"address":[119998,119984],"length":1,"stats":{"Line":4},"fn_name":"{closure#1}"},{"line":62,"address":[120048,120067],"length":1,"stats":{"Line":4},"fn_name":"{closure#2}"},{"line":86,"address":[84208],"length":1,"stats":{"Line":2},"fn_name":"parse"},{"line":87,"address":[84625,84267],"length":1,"stats":{"Line":3},"fn_name":null},{"line":89,"address":[96147,96066,96032],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":90,"address":[97933,98061,96160,96122,96076],"length":1,"stats":{"Line":8},"fn_name":"{closure#0}"},{"line":91,"address":[96206],"length":1,"stats":{"Line":2},"fn_name":null},{"line":93,"address":[96223],"length":1,"stats":{"Line":2},"fn_name":null},{"line":94,"address":[98112,98125],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":96,"address":[96308],"length":1,"stats":{"Line":2},"fn_name":null},{"line":98,"address":[96464,96395,96331],"length":1,"stats":{"Line":5},"fn_name":null},{"line":99,"address":[96445],"length":1,"stats":{"Line":2},"fn_name":null},{"line":100,"address":[96639,96595,96654],"length":1,"stats":{"Line":4},"fn_name":null},{"line":101,"address":[96644],"length":1,"stats":{"Line":2},"fn_name":null},{"line":103,"address":[96627,96706],"length":1,"stats":{"Line":4},"fn_name":null},{"line":105,"address":[96727,96699,96814],"length":1,"stats":{"Line":4},"fn_name":null},{"line":106,"address":[96948,97134,96782],"length":1,"stats":{"Line":6},"fn_name":null},{"line":107,"address":[97442,97943,97644,97355],"length":1,"stats":{"Line":6},"fn_name":null},{"line":108,"address":[97709],"length":1,"stats":{"Line":2},"fn_name":null},{"line":109,"address":[96338,96102,98160,98389,98328,96579,97382,97622,98238],"length":1,"stats":{"Line":7},"fn_name":"{closure#1}"},{"line":110,"address":[98264,98203,98354],"length":1,"stats":{"Line":1},"fn_name":null},{"line":112,"address":[84462],"length":1,"stats":{"Line":2},"fn_name":null},{"line":122,"address":[71813,71808],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":123,"address":[93455,93181],"length":1,"stats":{"Line":2},"fn_name":null},{"line":124,"address":[93159],"length":1,"stats":{"Line":1},"fn_name":null},{"line":144,"address":[106592,106597],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":145,"address":[117495],"length":1,"stats":{"Line":1},"fn_name":null},{"line":146,"address":[117518,117592,117658],"length":1,"stats":{"Line":3},"fn_name":null},{"line":150,"address":[106624,106629],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":151,"address":[118135],"length":1,"stats":{"Line":1},"fn_name":null},{"line":152,"address":[118526,118224,118150],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":53,"coverable":57},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-05","src","lib.rs"],"content":"//! Advent of Code 2016: Day 5: How About a Nice Game of Chess?\n//!\n//! [https://adventofcode.com/2016/day/5](https://adventofcode.com/2016/day/5)\n//!\n//! # Input\n//!\n//! Any string, used as a cryptographic salt. Only a single line is used. For testing purposes, we\n//! also accept a prefix line in the form `\"NUM_ZEROS=n\"` where n is the number of zeros to match\n//! at the start of the generated hash.\n//!\n//! # Part one\n//!\n//! Construct a password by searching for integers which can be appended to the input string which\n//! give an md5 hash having at least 5 zeros at the start of its hex representation. The password\n//! is built by appending the 6th hex digit each time. Once eight characters are obtained, the\n//! password is complete.\n//!\n//! # Part two\n//!\n//! The sixth character of the hex hash now represents the position of the character in the\n//! password, and the seventh is the character itself.\n//!\n//! # Algorithm\n//!\n//! We use the md5 implementation in [`aoc_common`]. Iterate over integers to append until we find\n//! a match and build up the password.\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\nuse aoc_md5 as md5;\nuse md5::md5_hash;\n\npuzzle_info! {\n\tname = \"How About a Nice Game of Chess?\";\n\tyear = 2016;\n\tday = 5;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\tuse nums::IntConv;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cString\u003e {\n\t\tlet mut password = String::new ();\n\t\tlet mut attempt = input.door_id.clone ();\n\t\tfor idx in 0_u32 .. {\n\t\t\tif password.len () == 8 { break }\n\t\t\tattempt.truncate (input.door_id.len ());\n\t\t\twrite! (\u0026 mut attempt, \"{}\", idx).unwrap ();\n\t\t\tlet hash = md5_hash (attempt.as_bytes ());\n\t\t\tif hash.num_zeros () \u003c input.num_zeros { continue }\n\t\t\tlet hash_str = hash.to_string ();\n\t\t\tpassword.push (hash_str.chars ().nth (5).unwrap ());\n\t\t}\n\t\tOk (password)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cString\u003e {\n\t\tlet mut password = [None; 8];\n\t\tlet mut attempt = input.door_id.clone ();\n\t\tfor idx in 0_u32 .. {\n\t\t\tif ! password.iter ().any (Option::is_none) { break }\n\t\t\tattempt.truncate (input.door_id.len ());\n\t\t\twrite! (\u0026 mut attempt, \"{}\", idx).unwrap ();\n\t\t\tlet hash = md5_hash (attempt.as_bytes ());\n\t\t\tif hash.num_zeros () \u003c input.num_zeros { continue }\n\t\t\tlet hash_str = hash.to_string ();\n\t\t\tlet pos =\n\t\t\t\thash_str.chars ()\n\t\t\t\t\t.nth (5)\n\t\t\t\t\t.unwrap ()\n\t\t\t\t\t.to_digit (16)\n\t\t\t\t\t.unwrap ()\n\t\t\t\t\t.as_usize ();\n\t\t\tif 8 \u003c= pos { continue }\n\t\t\tif password [pos].is_some () { continue }\n\t\t\tlet ch = hash_str.chars ().nth (6).unwrap ();\n\t\t\tpassword [pos] = Some (ch);\n\t\t}\n\t\tlet password =\n\t\t\tpassword.iter_vals ()\n\t\t\t\t.map (Option::unwrap)\n\t\t\t\t.collect ();\n\t\tOk (password)\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\n\tpub struct Input {\n\t\tpub door_id: String,\n\t\tpub num_zeros: u8,\n\t}\n\n\timpl Input {\n\t\tpub fn parse (mut input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet num_zeros =\n\t\t\t\tinput [0].strip_prefix (\"NUM_ZEROS=\")\n\t\t\t\t\t.map_or (Ok (5), |num_zeros| {\n\t\t\t\t\t\tinput = \u0026 input [1 .. ];\n\t\t\t\t\t\tnum_zeros.parse ()\n\t\t\t\t\t}) ?;\n\t\t\tif input.len () != 1 { Err (\"Invalid input\") ?; }\n\t\t\tlet door_id = input [0].to_owned ();\n\t\t\tOk (Self { door_id, num_zeros })\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [ \"NUM_ZEROS=1\", \"abc\" ];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"0500f456\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"36790f5e\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":38,"address":[24099,24867],"length":1,"stats":{"Line":2},"fn_name":null},{"line":39,"address":[24205],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[24973],"length":1,"stats":{"Line":1},"fn_name":null},{"line":49,"address":[27882,26912,27847],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":50,"address":[26948],"length":1,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[26982],"length":1,"stats":{"Line":1},"fn_name":null},{"line":52,"address":[27116,27287,27042],"length":1,"stats":{"Line":3},"fn_name":null},{"line":53,"address":[27309],"length":1,"stats":{"Line":1},"fn_name":null},{"line":54,"address":[27341],"length":1,"stats":{"Line":1},"fn_name":null},{"line":55,"address":[27381],"length":1,"stats":{"Line":1},"fn_name":null},{"line":56,"address":[27530],"length":1,"stats":{"Line":1},"fn_name":null},{"line":57,"address":[27580],"length":1,"stats":{"Line":1},"fn_name":null},{"line":58,"address":[27625],"length":1,"stats":{"Line":1},"fn_name":null},{"line":59,"address":[27711,27640],"length":1,"stats":{"Line":2},"fn_name":null},{"line":61,"address":[27194],"length":1,"stats":{"Line":1},"fn_name":null},{"line":64,"address":[29387,29569,27920],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":65,"address":[27959],"length":1,"stats":{"Line":1},"fn_name":null},{"line":66,"address":[28088],"length":1,"stats":{"Line":1},"fn_name":null},{"line":67,"address":[28102,28185,28301],"length":1,"stats":{"Line":3},"fn_name":null},{"line":68,"address":[28328],"length":1,"stats":{"Line":1},"fn_name":null},{"line":69,"address":[28430],"length":1,"stats":{"Line":1},"fn_name":null},{"line":70,"address":[28476],"length":1,"stats":{"Line":1},"fn_name":null},{"line":71,"address":[28643],"length":1,"stats":{"Line":1},"fn_name":null},{"line":72,"address":[28705],"length":1,"stats":{"Line":1},"fn_name":null},{"line":73,"address":[28759],"length":1,"stats":{"Line":1},"fn_name":null},{"line":74,"address":[28774,28845],"length":1,"stats":{"Line":2},"fn_name":null},{"line":81,"address":[29029],"length":1,"stats":{"Line":1},"fn_name":null},{"line":82,"address":[29044,29084],"length":1,"stats":{"Line":2},"fn_name":null},{"line":83,"address":[29155],"length":1,"stats":{"Line":1},"fn_name":null},{"line":84,"address":[29361,29295],"length":1,"stats":{"Line":1},"fn_name":null},{"line":86,"address":[28275,29414],"length":1,"stats":{"Line":2},"fn_name":null},{"line":90,"address":[29462],"length":1,"stats":{"Line":1},"fn_name":null},{"line":105,"address":[31696],"length":1,"stats":{"Line":2},"fn_name":"parse"},{"line":106,"address":[31723,31846,31978],"length":1,"stats":{"Line":4},"fn_name":null},{"line":108,"address":[26768,26899],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":109,"address":[26797],"length":1,"stats":{"Line":2},"fn_name":null},{"line":110,"address":[26877],"length":1,"stats":{"Line":2},"fn_name":null},{"line":112,"address":[31952,32032],"length":1,"stats":{"Line":2},"fn_name":null},{"line":113,"address":[32148,32006],"length":1,"stats":{"Line":4},"fn_name":null},{"line":114,"address":[32210],"length":1,"stats":{"Line":2},"fn_name":null},{"line":128,"address":[26464,26469],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":129,"address":[55527],"length":1,"stats":{"Line":1},"fn_name":null},{"line":130,"address":[55624,55690,55550],"length":1,"stats":{"Line":3},"fn_name":null},{"line":134,"address":[26496,26501],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":135,"address":[56167],"length":1,"stats":{"Line":1},"fn_name":null},{"line":136,"address":[56190,56264,56330],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":46,"coverable":46},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-06","src","lib.rs"],"content":"//! Advent of Code 2016: Day 6: Signals and Noise\n//!\n//! [https://adventofcode.com/2016/day/6](https://adventofcode.com/2016/day/6)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Signals and Noise\";\n\tyear = 2016;\n\tday = 6;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cString\u003e {\n\t\tOk (calc_result (\n\t\t\t\u0026 input.lines,\n\t\t\t|col_counts| col_counts.iter ()\n\t\t\t\t.max_by_key (|\u0026 (_, num)| num)\n\t\t\t\t.map (|(\u0026 ch, _)| ch)\n\t\t\t\t.unwrap ()))\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cString\u003e {\n\t\tOk (calc_result (\n\t\t\t\u0026 input.lines,\n\t\t\t|col_counts|\n\t\t\t\tcol_counts.iter ()\n\t\t\t\t\t.min_by_key (|\u0026 (_, num)| num)\n\t\t\t\t\t.map (|(\u0026 ch, _)| ch)\n\t\t\t\t\t.unwrap ()))\n\t}\n\n\tfn calc_result (\n\t\tlines: \u0026 [String],\n\t\tmap_fn: fn (HashMap \u003cchar, usize\u003e) -\u003e char,\n\t) -\u003e String {\n\t\tlines.iter ()\n\t\t\t.fold (\n\t\t\t\titer::repeat (HashMap::new ())\n\t\t\t\t\t.take (lines [0].chars ().count ())\n\t\t\t\t\t.collect::\u003cVec \u003c_\u003e\u003e (),\n\t\t\t\t|mut all_counts, line| {\n\t\t\t\t\tall_counts.iter_mut ()\n\t\t\t\t\t\t.zip (line.chars ())\n\t\t\t\t\t\t.for_each (|(col_counts, ch)|\n\t\t\t\t\t\t\t* col_counts.entry (ch).or_insert (0) += 1_usize);\n\t\t\t\t\tall_counts\n\t\t\t\t})\n\t\t\t.into_iter ()\n\t\t\t.map (map_fn)\n\t\t\t.collect ()\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\n\tpub struct Input {\n\t\tpub lines: Vec \u003cString\u003e,\n\t}\n\n\timpl Input {\n\t\tpub fn parse (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet lines: Vec \u003cString\u003e =\n\t\t\t\tinput.iter ()\n\t\t\t\t\t.map (|\u0026 line| line.to_owned ())\n\t\t\t\t\t.collect ();\n\t\t\tif lines [0].is_empty () { Err (\"Invalid input\") ?; }\n\t\t\tif lines.iter ().any (|line| line.len () != lines [0].len ()) {\n\t\t\t\tErr (\"All lines must be the same length\") ?;\n\t\t\t}\n\t\t\tOk (Self { lines })\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"eedadn\", \"drvtee\", \"eandsr\", \"raavrd\", \"atevrs\", \"tsrnev\", \"sdttsa\", \"rasrtv\",\n\t\t\"nssdts\", \"ntnada\", \"svetve\", \"tesnvt\", \"vntsnd\", \"vrdear\", \"dvrsen\", \"enarar\"\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"easter\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"advent\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":13,"address":[60579,61347],"length":1,"stats":{"Line":2},"fn_name":null},{"line":14,"address":[60685],"length":1,"stats":{"Line":1},"fn_name":null},{"line":15,"address":[61453],"length":1,"stats":{"Line":1},"fn_name":null},{"line":23,"address":[34976],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":24,"address":[35032],"length":1,"stats":{"Line":1},"fn_name":null},{"line":25,"address":[35006],"length":1,"stats":{"Line":1},"fn_name":null},{"line":26,"address":[72991,73068,72947,72928],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":27,"address":[73117,73104],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":28,"address":[73136,73149],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":29,"address":[72959,73060],"length":1,"stats":{"Line":1},"fn_name":null},{"line":32,"address":[35104],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":33,"address":[35160],"length":1,"stats":{"Line":1},"fn_name":null},{"line":34,"address":[35134],"length":1,"stats":{"Line":1},"fn_name":null},{"line":35,"address":[73168,73308],"length":1,"stats":{"Line":1},"fn_name":"{closure#0}"},{"line":36,"address":[73231,73187],"length":1,"stats":{"Line":2},"fn_name":null},{"line":37,"address":[73344,73357],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":38,"address":[73389,73376],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":39,"address":[73199,73300],"length":1,"stats":{"Line":1},"fn_name":null},{"line":42,"address":[35232,35597,35627],"length":1,"stats":{"Line":1},"fn_name":"calc_result"},{"line":46,"address":[35648,35304],"length":1,"stats":{"Line":3},"fn_name":null},{"line":48,"address":[35535,35574,35328],"length":1,"stats":{"Line":6},"fn_name":null},{"line":49,"address":[35566,35620,35375],"length":1,"stats":{"Line":4},"fn_name":null},{"line":51,"address":[73408,73688],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":52,"address":[73459,73523,73632],"length":1,"stats":{"Line":6},"fn_name":null},{"line":53,"address":[73565],"length":1,"stats":{"Line":2},"fn_name":null},{"line":54,"address":[73728,73819,73746],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":55,"address":[73755,73824],"length":1,"stats":{"Line":2},"fn_name":null},{"line":56,"address":[73666],"length":1,"stats":{"Line":2},"fn_name":null},{"line":74,"address":[80512,81406],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":75,"address":[80574],"length":1,"stats":{"Line":1},"fn_name":null},{"line":77,"address":[26048,26069],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":79,"address":[80734,80787,80650],"length":1,"stats":{"Line":2},"fn_name":null},{"line":80,"address":[80755,80984],"length":1,"stats":{"Line":4},"fn_name":null},{"line":81,"address":[81237],"length":1,"stats":{"Line":0},"fn_name":null},{"line":83,"address":[81093],"length":1,"stats":{"Line":1},"fn_name":null},{"line":100,"address":[59216,59221],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":101,"address":[79239],"length":1,"stats":{"Line":1},"fn_name":null},{"line":102,"address":[79262,79336,79402],"length":1,"stats":{"Line":3},"fn_name":null},{"line":106,"address":[59248,59253],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":107,"address":[79879],"length":1,"stats":{"Line":1},"fn_name":null},{"line":108,"address":[80042,79902,79976],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":40,"coverable":41},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-07","src","lib.rs"],"content":"//! Advent of Code 2016: Day 7: Internet Protocol Version 7\n//!\n//! [https://adventofcode.com/2016/day/7](https://adventofcode.com/2016/day/7)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Internet Protocol Version 7\";\n\tyear = 2016;\n\tday = 7;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cusize\u003e {\n\t\tOk (input.lines.iter ()\n\t\t\t.filter (|line|\n\t\t\t\thas_abba_unbracketed (line)\n\t\t\t\t\t\u0026\u0026 ! has_abba_bracketed (line))\n\t\t\t.count ())\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cusize\u003e {\n\t\tOk (input.lines.iter ()\n\t\t\t.filter (|line|\n\t\t\t\titer_abas_unbracketed (line)\n\t\t\t\t\t.any (|(a, b)| has_bab_bracketed (line, a, b)))\n\t\t\t.count ())\n\t}\n\n\tfn has_abba_unbracketed (addr: \u0026 str) -\u003e bool {\n\t\taddr.chars ()\n\t\t\t.scan (true, |state, ch| {\n\t\t\t\tSome (match ch {\n\t\t\t\t\t'[' =\u003e { * state = false; Some ('[') },\n\t\t\t\t\t']' =\u003e { * state = true; Some (']') },\n\t\t\t\t\t_ =\u003e (* state).then_some (ch),\n\t\t\t\t})\n\t\t\t})\n\t\t\t.flatten ()\n\t\t\t.tuple_windows::\u003c(_, _, _, _)\u003e ()\n\t\t\t.any (|(a, b, c, d)| a == d \u0026\u0026 b == c \u0026\u0026 a != b)\n\t}\n\n\tfn has_abba_bracketed (addr: \u0026 str) -\u003e bool {\n\t\taddr.chars ()\n\t\t\t.scan (false, |state, ch| {\n\t\t\t\tSome (match ch {\n\t\t\t\t\t'[' =\u003e { * state = true; Some ('[') },\n\t\t\t\t\t']' =\u003e { * state = false; Some (']') },\n\t\t\t\t\t_ =\u003e (* state).then_some (ch),\n\t\t\t\t})\n\t\t\t})\n\t\t\t.flatten ()\n\t\t\t.tuple_windows::\u003c(_, _, _, _)\u003e ()\n\t\t\t.any (|(a, b, c, d)| a == d \u0026\u0026 b == c \u0026\u0026 a != b)\n\t}\n\n\tfn iter_abas_unbracketed (addr: \u0026 str) -\u003e impl Iterator \u003cItem = (char, char)\u003e + '_ {\n\t\taddr.chars ()\n\t\t\t.scan (true, |state, ch| {\n\t\t\t\tSome (match ch {\n\t\t\t\t\t'[' =\u003e { * state = false; Some ('[') },\n\t\t\t\t\t']' =\u003e { * state = true; Some (']') },\n\t\t\t\t\t_ =\u003e (* state).then_some (ch),\n\t\t\t\t})\n\t\t\t})\n\t\t\t.flatten ()\n\t\t\t.tuple_windows::\u003c(_, _, _)\u003e ()\n\t\t\t.filter (|\u0026 (a, b, c)| a == c \u0026\u0026 a != b)\n\t\t\t.map (|(a, b, _)| (a, b))\n\t}\n\n\tfn has_bab_bracketed (addr: \u0026 str, a: char, b: char) -\u003e bool {\n\t\taddr.chars ()\n\t\t\t.scan (false, |state, ch| {\n\t\t\t\tSome (match ch {\n\t\t\t\t\t'[' =\u003e { * state = true; Some ('[') },\n\t\t\t\t\t']' =\u003e { * state = false; Some (']') },\n\t\t\t\t\t_ =\u003e (* state).then_some (ch),\n\t\t\t\t})\n\t\t\t})\n\t\t\t.flatten ()\n\t\t\t.tuple_windows::\u003c(_, _, _)\u003e ()\n\t\t\t.any (|(a1, b1, c1)| a == b1 \u0026\u0026 b == a1 \u0026\u0026 b == c1)\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\n\tpub struct Input \u003c'dat\u003e {\n\t\tpub lines: \u0026 'dat [\u0026 'dat str],\n\t}\n\n\timpl \u003c'dat\u003e Input \u003c'dat\u003e {\n\t\tpub fn parse (lines: \u0026 'dat [\u0026 'dat str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tif lines.iter ().any (|line|\n\t\t\t\tline.chars ()\n\t\t\t\t\t.fold (Some (false), |state, ch|\n\t\t\t\t\t\tmatch (state, ch) {\n\t\t\t\t\t\t\t(Some (state), ('a' ..= 'z')) =\u003e Some (state),\n\t\t\t\t\t\t\t(Some (false), '[') =\u003e Some (true),\n\t\t\t\t\t\t\t(Some (true), ']') =\u003e Some (false),\n\t\t\t\t\t\t\t_ =\u003e None,\n\t\t\t\t\t\t})\n\t\t\t\t\t.is_none ()) {\n\t\t\t\tErr (\"Invalid input\") ?;\n\t\t\t}\n\t\t\tOk (Self { lines })\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"abba[mnop]qrst\",\n\t\t\"abcd[bddb]xyyx\",\n\t\t\"aaaa[qwer]tyui\",\n\t\t\"ioxxoj[asdfgh]zxcvbn\",\n\t\t\"aba[bab]xyz\",\n\t\t\"xyx[xyx]xyx\",\n\t\t\"aaa[kek]eke\",\n\t\t\"zazbz[bzb]cdb\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"2\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"3\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":13,"address":[40051,39507],"length":1,"stats":{"Line":2},"fn_name":null},{"line":14,"address":[39584],"length":1,"stats":{"Line":1},"fn_name":null},{"line":15,"address":[40128],"length":1,"stats":{"Line":1},"fn_name":null},{"line":23,"address":[24512],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":24,"address":[24531],"length":1,"stats":{"Line":1},"fn_name":null},{"line":25,"address":[64480,64571],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":26,"address":[64565,64499],"length":1,"stats":{"Line":2},"fn_name":null},{"line":27,"address":[64540],"length":1,"stats":{"Line":1},"fn_name":null},{"line":31,"address":[24640],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":32,"address":[24659],"length":1,"stats":{"Line":1},"fn_name":null},{"line":33,"address":[64592,64684],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":34,"address":[64611,64656],"length":1,"stats":{"Line":2},"fn_name":null},{"line":35,"address":[64636,64704,64728],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":39,"address":[24768],"length":1,"stats":{"Line":1},"fn_name":"has_abba_unbracketed"},{"line":40,"address":[24791],"length":1,"stats":{"Line":1},"fn_name":null},{"line":41,"address":[64768,64882],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":42,"address":[64795,64874],"length":1,"stats":{"Line":2},"fn_name":null},{"line":43,"address":[64845],"length":1,"stats":{"Line":1},"fn_name":null},{"line":44,"address":[64863],"length":1,"stats":{"Line":1},"fn_name":null},{"line":45,"address":[64822],"length":1,"stats":{"Line":1},"fn_name":null},{"line":50,"address":[64905,64896],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":53,"address":[24896],"length":1,"stats":{"Line":1},"fn_name":"has_abba_bracketed"},{"line":54,"address":[24919],"length":1,"stats":{"Line":1},"fn_name":null},{"line":55,"address":[65138,65024],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":56,"address":[65130,65051],"length":1,"stats":{"Line":2},"fn_name":null},{"line":57,"address":[65101],"length":1,"stats":{"Line":1},"fn_name":null},{"line":58,"address":[65119],"length":1,"stats":{"Line":1},"fn_name":null},{"line":59,"address":[65078],"length":1,"stats":{"Line":1},"fn_name":null},{"line":64,"address":[65152,65161],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":67,"address":[25024],"length":1,"stats":{"Line":1},"fn_name":"iter_abas_unbracketed"},{"line":68,"address":[25081],"length":1,"stats":{"Line":1},"fn_name":null},{"line":69,"address":[65280,65394],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":70,"address":[65307,65386],"length":1,"stats":{"Line":2},"fn_name":null},{"line":71,"address":[65357],"length":1,"stats":{"Line":1},"fn_name":null},{"line":72,"address":[65375],"length":1,"stats":{"Line":1},"fn_name":null},{"line":73,"address":[65334],"length":1,"stats":{"Line":1},"fn_name":null},{"line":78,"address":[65408,65422],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":79,"address":[65504,65513],"length":1,"stats":{"Line":2},"fn_name":"{closure#2}"},{"line":82,"address":[25216],"length":1,"stats":{"Line":1},"fn_name":"has_bab_bracketed"},{"line":83,"address":[25247,25340],"length":1,"stats":{"Line":2},"fn_name":null},{"line":84,"address":[65666,65552],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":85,"address":[65658,65579],"length":1,"stats":{"Line":2},"fn_name":null},{"line":86,"address":[65629],"length":1,"stats":{"Line":1},"fn_name":null},{"line":87,"address":[65647],"length":1,"stats":{"Line":1},"fn_name":null},{"line":88,"address":[65606],"length":1,"stats":{"Line":1},"fn_name":null},{"line":93,"address":[25314],"length":1,"stats":{"Line":3},"fn_name":null},{"line":107,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":108,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":109,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":110,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":111,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":113,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":114,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":115,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":117,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":118,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":120,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":143,"address":[62387,62433,61824],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":144,"address":[61831],"length":1,"stats":{"Line":1},"fn_name":null},{"line":145,"address":[61854,61994,61928],"length":1,"stats":{"Line":3},"fn_name":null},{"line":149,"address":[63073,63027,62464],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":150,"address":[62471],"length":1,"stats":{"Line":1},"fn_name":null},{"line":151,"address":[62634,62494,62568],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":61,"coverable":64},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-08","src","lib.rs"],"content":"//! Advent of Code 2016: Day 8: Two-Factor Authentication\n//!\n//! [https://adventofcode.com/2016/day/8](https://adventofcode.com/2016/day/8)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\nuse aoc_grid as grid;\nuse aoc_ocr as ocr;\nuse aoc_pos as pos;\n\npuzzle_info! {\n\tname = \"Two-Factor Authentication\";\n\tyear = 2016;\n\tday = 8;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse grid::Grid;\n\tuse model::Input;\n\tuse model::Step;\n\tuse model::Pos;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cusize\u003e {\n\t\tlet grid = calc_result (input);\n\t\tOk (grid.values ().filter (|\u0026 val| val).count ())\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cString\u003e {\n\t\tlet grid = calc_result (input);\n\t\tlet code =\n\t\t\tocr::read_dots (\u0026 |row: u32, col: u32|\n\t\t\t\tgrid.get (Pos { row, col }).unwrap_or (false)) ?;\n\t\tOk (code)\n\t}\n\n\tfn calc_result (input: \u0026 Input) -\u003e Grid \u003cVec \u003cbool\u003e, Pos\u003e {\n\t\tlet mut grid: Grid \u003cVec \u003cbool\u003e, Pos\u003e =\n\t\t\tGrid::new_vec ([0, 0], [input.height.as_usize (), input.width.as_usize ()]);\n\t\tfor step in input.steps.iter_vals () {\n\t\t\tmatch step {\n\t\t\t\tStep::Rect { width, height } =\u003e {\n\t\t\t\t\tfor row in 0 .. height {\n\t\t\t\t\t\tfor col in 0 .. width {\n\t\t\t\t\t\t\tgrid.set (Pos { row, col }, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tStep::RotateRow { row, dist } =\u003e {\n\t\t\t\t\tlet temp: Vec \u003cbool\u003e =\n\t\t\t\t\t\t(0 .. input.width)\n\t\t\t\t\t\t\t.map (|col| grid.get (Pos { row, col }).unwrap ())\n\t\t\t\t\t\t\t.collect ();\n\t\t\t\t\tfor old_col in 0 .. input.width {\n\t\t\t\t\t\tlet col = (old_col + dist) % input.width;\n\t\t\t\t\t\tgrid.set (Pos { row, col }, temp [old_col.as_usize ()]);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tStep::RotateCol { col, dist } =\u003e {\n\t\t\t\t\tlet temp: Vec \u003cbool\u003e =\n\t\t\t\t\t\t(0 .. input.height)\n\t\t\t\t\t\t\t.map (|row| grid.get (Pos { row, col }).unwrap ())\n\t\t\t\t\t\t\t.collect ();\n\t\t\t\t\tfor old_row in 0 .. input.height {\n\t\t\t\t\t\tlet row = (old_row + dist) % input.height;\n\t\t\t\t\t\tgrid.set (Pos { row, col }, temp [old_row.as_usize ()]);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t\tgrid\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse parser::*;\n\n\tpub type Pos = pos::PosRowCol \u003cu32\u003e;\n\n\t#[ derive (Clone, Debug) ]\n\tpub struct Input {\n\t\tpub steps: Vec \u003cStep\u003e,\n\t\tpub width: u32,\n\t\tpub height: u32,\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, Hash, Ord, PartialEq, PartialOrd) ]\n\tpub enum Step {\n\t\tRect { width: u32, height: u32 },\n\t\tRotateRow { row: u32, dist: u32 },\n\t\tRotateCol { col: u32, dist: u32 },\n\t}\n\n\timpl Input {\n\t\tpub fn parse (mut lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet width = parser::input_param (\u0026 mut lines, \"WIDTH=\", 50_u32) ?;\n\t\t\tlet height = parser::input_param (\u0026 mut lines, \"HEIGHT=\", 6_u32) ?;\n\t\t\tlet steps = lines.iter ()\n\t\t\t\t.enumerate ()\n\t\t\t\t.map (|(line_idx, line)|\n\t\t\t\t\tParser::wrap (line, |parser| {\n\t\t\t\t\t\tparser.set_ignore_whitespace (true);\n\t\t\t\t\t\tStep::parse_real (parser)\n\t\t\t\t\t}).map_parse_err (|col_idx| format! (\"Invalid input: line {}: col {}: {}\",\n\t\t\t\t\t\tline_idx + 1, col_idx + 1, line)))\n\t\t\t\t.collect::\u003cGenResult \u003cVec \u003cStep\u003e\u003e\u003e () ?;\n\t\t\tif steps.iter_vals ().any (|step|\n\t\t\t\t\tmatch step {\n\t\t\t\t\t\tStep::Rect { width: step_width, height: step_height } =\u003e\n\t\t\t\t\t\t\tstep_width \u003e= width || step_height \u003e= height,\n\t\t\t\t\t\tStep::RotateRow { row, .. } =\u003e height \u003c= row,\n\t\t\t\t\t\tStep::RotateCol { col, .. } =\u003e width \u003c= col,\n\t\t\t\t\t}) {\n\t\t\t\tErr (\"Invalid input\") ?;\n\t\t\t}\n\t\t\tOk (Self { steps, width, height })\n\t\t}\n\t}\n\n\timpl Step {\n\t\tfn parse_real (parser: \u0026 mut Parser) -\u003e ParseResult \u003cSelf\u003e {\n\t\t\tparser.any ()\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tlet width = parser.expect (\"rect\") ?.confirm ().int () ?;\n\t\t\t\t\tlet height = parser.expect (\"x\") ?.int () ?;\n\t\t\t\t\tOk (Self::Rect { width, height })\n\t\t\t\t})\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tlet row = parser.expect (\"rotate row y=\") ?.confirm ().int () ?;\n\t\t\t\t\tlet dist = parser.expect (\"by\") ?.int () ?;\n\t\t\t\t\tOk (Self::RotateRow { row, dist })\n\t\t\t\t})\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tlet col = parser.expect (\"rotate column x=\") ?.confirm ().int () ?;\n\t\t\t\t\tlet dist = parser.expect (\"by\") ?.int () ?;\n\t\t\t\t\tOk (Self::RotateCol { col, dist })\n\t\t\t\t})\n\t\t\t\t.done ()\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"WIDTH=7\",\n\t\t\"HEIGHT=3\",\n\t\t\"rect 3x2\",\n\t\t\"rotate column x=1 by 1\",\n\t\t\"rotate row y=0 by 4\",\n\t\t\"rotate column x=1 by 1\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"6\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_err! (\"Unrecognised character: 0x13440000 in position 1\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":16,"address":[99907,99219],"length":1,"stats":{"Line":2},"fn_name":null},{"line":17,"address":[99325],"length":1,"stats":{"Line":1},"fn_name":null},{"line":18,"address":[100013],"length":1,"stats":{"Line":1},"fn_name":null},{"line":29,"address":[94864,95029],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":30,"address":[94886],"length":1,"stats":{"Line":1},"fn_name":null},{"line":31,"address":[94959,94901],"length":1,"stats":{"Line":4},"fn_name":null},{"line":34,"address":[95072,95494],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":35,"address":[95097],"length":1,"stats":{"Line":1},"fn_name":null},{"line":36,"address":[95187,95112,95441],"length":1,"stats":{"Line":5},"fn_name":null},{"line":38,"address":[95415,95455],"length":1,"stats":{"Line":2},"fn_name":null},{"line":39,"address":[95316],"length":1,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[95536,97688,96849],"length":1,"stats":{"Line":2},"fn_name":"calc_result"},{"line":43,"address":[95575],"length":1,"stats":{"Line":2},"fn_name":null},{"line":45,"address":[95710,95789,95907],"length":1,"stats":{"Line":6},"fn_name":null},{"line":46,"address":[95937],"length":1,"stats":{"Line":2},"fn_name":null},{"line":47,"address":[95982],"length":1,"stats":{"Line":2},"fn_name":null},{"line":48,"address":[97375,96017],"length":1,"stats":{"Line":4},"fn_name":null},{"line":49,"address":[97481],"length":1,"stats":{"Line":2},"fn_name":null},{"line":50,"address":[97643],"length":1,"stats":{"Line":2},"fn_name":null},{"line":54,"address":[96089],"length":1,"stats":{"Line":2},"fn_name":null},{"line":55,"address":[96876,96124,96169],"length":1,"stats":{"Line":6},"fn_name":null},{"line":57,"address":[96145],"length":1,"stats":{"Line":6},"fn_name":null},{"line":59,"address":[97099,96891,96993],"length":1,"stats":{"Line":6},"fn_name":null},{"line":60,"address":[97117,97250],"length":1,"stats":{"Line":2},"fn_name":null},{"line":61,"address":[97288,97213],"length":1,"stats":{"Line":4},"fn_name":null},{"line":64,"address":[96233],"length":1,"stats":{"Line":2},"fn_name":null},{"line":65,"address":[96265,96310],"length":1,"stats":{"Line":4},"fn_name":null},{"line":67,"address":[96286],"length":1,"stats":{"Line":6},"fn_name":null},{"line":69,"address":[96386,96488,96591],"length":1,"stats":{"Line":6},"fn_name":null},{"line":70,"address":[96741,96609],"length":1,"stats":{"Line":2},"fn_name":null},{"line":71,"address":[96776,96704],"length":1,"stats":{"Line":4},"fn_name":null},{"line":103,"address":[35984,37095],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":104,"address":[36138,36011],"length":1,"stats":{"Line":1},"fn_name":null},{"line":105,"address":[36095,36191,36284],"length":1,"stats":{"Line":2},"fn_name":null},{"line":106,"address":[36251,36564,36343],"length":1,"stats":{"Line":2},"fn_name":null},{"line":108,"address":[77581,77500,77472],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":109,"address":[77556,77600,77510,77664],"length":1,"stats":{"Line":7},"fn_name":"{closure#0}"},{"line":110,"address":[77635],"length":1,"stats":{"Line":2},"fn_name":null},{"line":111,"address":[77654],"length":1,"stats":{"Line":2},"fn_name":null},{"line":112,"address":[77848,77536,77758,77680,77909],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":113,"address":[77784,77874,77723],"length":1,"stats":{"Line":0},"fn_name":null},{"line":115,"address":[36510,36631],"length":1,"stats":{"Line":8},"fn_name":null},{"line":116,"address":[78099],"length":1,"stats":{"Line":2},"fn_name":null},{"line":117,"address":[78140],"length":1,"stats":{"Line":2},"fn_name":null},{"line":118,"address":[78255,78158],"length":1,"stats":{"Line":4},"fn_name":null},{"line":119,"address":[78177],"length":1,"stats":{"Line":2},"fn_name":null},{"line":120,"address":[78211],"length":1,"stats":{"Line":2},"fn_name":null},{"line":122,"address":[36911],"length":1,"stats":{"Line":0},"fn_name":null},{"line":124,"address":[36730],"length":1,"stats":{"Line":2},"fn_name":null},{"line":129,"address":[37136],"length":1,"stats":{"Line":2},"fn_name":"parse_real"},{"line":130,"address":[37160],"length":1,"stats":{"Line":2},"fn_name":null},{"line":131,"address":[78288,78762,79089],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":132,"address":[78543,78334,78645],"length":1,"stats":{"Line":4},"fn_name":null},{"line":133,"address":[78610,78770,79099,78967],"length":1,"stats":{"Line":6},"fn_name":null},{"line":134,"address":[79036],"length":1,"stats":{"Line":2},"fn_name":null},{"line":136,"address":[80033,79232,79706],"length":1,"stats":{"Line":6},"fn_name":"{closure#1}"},{"line":137,"address":[79589,79487,79278],"length":1,"stats":{"Line":4},"fn_name":null},{"line":138,"address":[79554,79911,80043,79714],"length":1,"stats":{"Line":6},"fn_name":null},{"line":139,"address":[79980],"length":1,"stats":{"Line":2},"fn_name":null},{"line":141,"address":[80650,80977,80176],"length":1,"stats":{"Line":6},"fn_name":"{closure#2}"},{"line":142,"address":[80222,80533,80431],"length":1,"stats":{"Line":4},"fn_name":null},{"line":143,"address":[80498,80987,80658,80855],"length":1,"stats":{"Line":6},"fn_name":null},{"line":144,"address":[80924],"length":1,"stats":{"Line":2},"fn_name":null},{"line":167,"address":[40656,40661],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":168,"address":[59383],"length":1,"stats":{"Line":1},"fn_name":null},{"line":169,"address":[59480,59546,59406],"length":1,"stats":{"Line":3},"fn_name":null},{"line":173,"address":[40693,40688],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":174,"address":[60023],"length":1,"stats":{"Line":1},"fn_name":null},{"line":175,"address":[60038,60112,60414],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":66,"coverable":69},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-09","src","lib.rs"],"content":"//! Advent of Code 2016: Day 9: Explosives in Cyberspace\n//!\n//! [https://adventofcode.com/2016/day/9](https://adventofcode.com/2016/day/9)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Explosives in Cyberspace\";\n\tyear = 2016;\n\tday = 9;\n\tpart_one = |input| logic::part_one (input [0]);\n\tpart_two = |input| logic::part_two (input [0]);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse parser::*;\n\n\tpub fn part_one (input: \u0026 str) -\u003e GenResult \u003cusize\u003e {\n\t\tlet sum = Parser::wrap (input, |parser| {\n\t\t\tlet mut sum = 0_usize;\n\t\t\twhile parser.peek ().is_some () {\n\t\t\t\tif parser.peek ().unwrap () == '(' {\n\t\t\t\t\tlet len: usize = parser.expect (\"(\") ?.int () ?;\n\t\t\t\t\tlet num: usize = parser.expect (\"x\") ?.int () ?;\n\t\t\t\t\tparser.expect (\")\") ?;\n\t\t\t\t\tfor _ in 0 .. len {\n\t\t\t\t\t\tparser.expect_next () ?;\n\t\t\t\t\t\tsum = usize::add_2 (sum, num) ?;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tparser.expect_next () ?;\n\t\t\t\t\tsum += 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tOk (sum)\n\t\t}).map_parse_err (|col_idx| format! (\"Invalid input: col {}: {}\", col_idx + 1, input)) ?;\n\t\tOk (sum)\n\t}\n\n\tpub fn part_two (input: \u0026 str) -\u003e GenResult \u003cusize\u003e {\n\t\tlet sum = Parser::wrap (input, |parser| {\n\t\t\tlet mut sum = 0;\n\t\t\twhile let Some (ch) = parser.next () {\n\t\t\t\tif ch == '(' {\n\t\t\t\t\tlet len: usize = parser.int () ?;\n\t\t\t\t\tlet num: usize = parser.expect (\"x\") ?.int () ?;\n\t\t\t\t\tparser.expect (\")\") ?;\n\t\t\t\t\tlet byte_len = parser.rest ().chars ().take (len).map (char::len_utf8).sum ();\n\t\t\t\t\tsum = usize::add_2 (sum,\n\t\t\t\t\t\tusize::mul_2 (num,\n\t\t\t\t\t\t\tpart_two (\n\t\t\t\t\t\t\t\t#[ allow (clippy::string_slice) ]\n\t\t\t\t\t\t\t\t\u0026 parser.rest () [0 .. byte_len],\n\t\t\t\t\t\t\t) ?,\n\t\t\t\t\t\t) ?,\n\t\t\t\t\t) ?;\n\t\t\t\t\tfor _ in 0 .. len { parser.next ().ok_or_else (|| parser.err ()) ?; }\n\t\t\t\t} else {\n\t\t\t\t\tsum += 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tOk (sum)\n\t\t}).map_parse_err (|col_idx| format! (\"Invalid input: col {}: {}\", col_idx + 1, input)) ?;\n\t\tOk (sum)\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLES_ONE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"ADVENT\",\n\t\t\"A(1x5)BC\",\n\t\t\"(3x3)XYZ\",\n\t\t\"A(2x2)BCD(2x2)EFG\",\n\t\t\"(6x1)(1x3)A\",\n\t\t\"X(8x2)(3x3)ABCY\",\n\t];\n\n\tconst EXAMPLES_TWO: \u0026 [\u0026 str] = \u0026 [\n\t\t\"(3x3)XYZ\",\n\t\t\"X(8x2)(3x3)ABCY\",\n\t\t\"(27x12)(20x12)(13x14)(7x10)(1x12)A\",\n\t\t\"(25x3)(3x3)ABC(2x3)XY(5x2)PQRSTX(18x9)(3x2)TWO(5x7)SEVEN\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"6\", puzzle.part_one (\u0026 [\u0026 EXAMPLES_ONE [0]]));\n\t\tassert_eq_ok! (\"7\", puzzle.part_one (\u0026 [\u0026 EXAMPLES_ONE [1]]));\n\t\tassert_eq_ok! (\"9\", puzzle.part_one (\u0026 [\u0026 EXAMPLES_ONE [2]]));\n\t\tassert_eq_ok! (\"11\", puzzle.part_one (\u0026 [\u0026 EXAMPLES_ONE [3]]));\n\t\tassert_eq_ok! (\"6\", puzzle.part_one (\u0026 [\u0026 EXAMPLES_ONE [4]]));\n\t\tassert_eq_ok! (\"18\", puzzle.part_one (\u0026 [\u0026 EXAMPLES_ONE [5]]));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"9\", puzzle.part_two (\u0026 [\u0026 EXAMPLES_TWO [0]]));\n\t\tassert_eq_ok! (\"20\", puzzle.part_two (\u0026 [\u0026 EXAMPLES_TWO [1]]));\n\t\tassert_eq_ok! (\"241920\", puzzle.part_two (\u0026 [\u0026 EXAMPLES_TWO [2]]));\n\t\tassert_eq_ok! (\"445\", puzzle.part_two (\u0026 [\u0026 EXAMPLES_TWO [3]]));\n\t}\n\n}\n","traces":[{"line":9,"address":[36857,37385],"length":1,"stats":{"Line":2},"fn_name":null},{"line":13,"address":[36952,36973],"length":1,"stats":{"Line":2},"fn_name":null},{"line":14,"address":[37501,37480],"length":1,"stats":{"Line":2},"fn_name":null},{"line":22,"address":[22944],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":23,"address":[23116,22970,23000],"length":1,"stats":{"Line":5},"fn_name":null},{"line":24,"address":[23958],"length":1,"stats":{"Line":1},"fn_name":null},{"line":25,"address":[23972],"length":1,"stats":{"Line":1},"fn_name":null},{"line":26,"address":[24037,24358],"length":1,"stats":{"Line":2},"fn_name":null},{"line":27,"address":[24690,24590,24081,24393],"length":1,"stats":{"Line":3},"fn_name":null},{"line":28,"address":[25114,25008,24658,24811],"length":1,"stats":{"Line":3},"fn_name":null},{"line":29,"address":[25082,25235,25355],"length":1,"stats":{"Line":2},"fn_name":null},{"line":30,"address":[25486,25857,25296],"length":1,"stats":{"Line":3},"fn_name":null},{"line":31,"address":[25661,25563],"length":1,"stats":{"Line":1},"fn_name":null},{"line":32,"address":[25634,25867,25792],"length":1,"stats":{"Line":2},"fn_name":null},{"line":35,"address":[24116,24217],"length":1,"stats":{"Line":1},"fn_name":null},{"line":36,"address":[24363,24182,24353],"length":1,"stats":{"Line":2},"fn_name":null},{"line":39,"address":[24011],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[22990,23093],"length":1,"stats":{"Line":1},"fn_name":null},{"line":41,"address":[23076],"length":1,"stats":{"Line":1},"fn_name":null},{"line":44,"address":[23152],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":45,"address":[23178,23208,23324],"length":1,"stats":{"Line":4},"fn_name":null},{"line":46,"address":[26191],"length":1,"stats":{"Line":1},"fn_name":null},{"line":47,"address":[26211],"length":1,"stats":{"Line":1},"fn_name":null},{"line":48,"address":[26270,26386],"length":1,"stats":{"Line":2},"fn_name":null},{"line":49,"address":[26328,26539,26421],"length":1,"stats":{"Line":2},"fn_name":null},{"line":50,"address":[26501,26660,26981,26863],"length":1,"stats":{"Line":3},"fn_name":null},{"line":51,"address":[26943,27102,27197],"length":1,"stats":{"Line":2},"fn_name":null},{"line":52,"address":[27331,27166],"length":1,"stats":{"Line":2},"fn_name":null},{"line":53,"address":[27819,27432,27770,27957],"length":1,"stats":{"Line":3},"fn_name":null},{"line":54,"address":[27621,27705,27795],"length":1,"stats":{"Line":2},"fn_name":null},{"line":55,"address":[27544,27678],"length":1,"stats":{"Line":1},"fn_name":null},{"line":57,"address":[27445],"length":1,"stats":{"Line":1},"fn_name":null},{"line":61,"address":[28304,27984,27895,28321],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":63,"address":[26391,26343],"length":1,"stats":{"Line":1},"fn_name":null},{"line":66,"address":[26285],"length":1,"stats":{"Line":1},"fn_name":null},{"line":67,"address":[23301,23198],"length":1,"stats":{"Line":1},"fn_name":null},{"line":68,"address":[23284],"length":1,"stats":{"Line":1},"fn_name":null},{"line":95,"address":[22725,22720],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":96,"address":[55063],"length":1,"stats":{"Line":1},"fn_name":null},{"line":97,"address":[55132,55322,55247],"length":1,"stats":{"Line":3},"fn_name":null},{"line":98,"address":[55774,55928],"length":1,"stats":{"Line":2},"fn_name":null},{"line":99,"address":[56370,56524],"length":1,"stats":{"Line":2},"fn_name":null},{"line":100,"address":[56966,57120],"length":1,"stats":{"Line":2},"fn_name":null},{"line":101,"address":[57692,57544],"length":1,"stats":{"Line":2},"fn_name":null},{"line":102,"address":[58101,58249],"length":1,"stats":{"Line":2},"fn_name":null},{"line":106,"address":[22752,22757],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":107,"address":[58871],"length":1,"stats":{"Line":1},"fn_name":null},{"line":108,"address":[58924,59039,59114],"length":1,"stats":{"Line":3},"fn_name":null},{"line":109,"address":[59566,59720],"length":1,"stats":{"Line":2},"fn_name":null},{"line":110,"address":[60292,60144],"length":1,"stats":{"Line":2},"fn_name":null},{"line":111,"address":[60701,60849],"length":1,"stats":{"Line":2},"fn_name":null}],"covered":51,"coverable":51},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-10","src","lib.rs"],"content":"//! Advent of Code 2016: Day 10: Balance Bots\n//!\n//! [https://adventofcode.com/2016/day/10](https://adventofcode.com/2016/day/10)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Balance Bots\";\n\tyear = 2016;\n\tday = 10;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\tuse model::Step;\n\tuse model::Target;\n\tuse model::Val;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cVal\u003e {\n\t\tfor event in events (input) ? {\n\t\t\tif event.low_chip == input.low \u0026\u0026 event.high_chip == input.high {\n\t\t\t\treturn Ok (event.from_bot);\n\t\t\t}\n\t\t}\n\t\tErr (\"No solution found\".into ())\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cu64\u003e {\n\t\tlet mut output_0 = None;\n\t\tlet mut output_1 = None;\n\t\tlet mut output_2 = None;\n\t\tfor event in events (input) ? {\n\t\t\tfor (chip, target) in [\n\t\t\t\t(event.low_chip, event.low_target),\n\t\t\t\t(event.high_chip, event.high_target),\n\t\t\t] {\n\t\t\t\tif target == Target::Output (0) { output_0 = Some (chip); }\n\t\t\t\tif target == Target::Output (1) { output_1 = Some (chip); }\n\t\t\t\tif target == Target::Output (2) { output_2 = Some (chip); }\n\t\t\t}\n\t\t}\n\t\tmatch (output_0, output_1, output_2) {\n\t\t\t(Some (output_0), Some (output_1), Some (output_2)) =\u003e\n\t\t\t\tOk (output_0.as_u64 () * output_1.as_u64 () * output_2.as_u64 ()),\n\t\t\t_ =\u003e Err (\"No solution found\".into ()),\n\t\t}\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\n\tstruct Event {\n\t\tfrom_bot: Val,\n\t\tlow_chip: Val,\n\t\thigh_chip: Val,\n\t\tlow_target: Target,\n\t\thigh_target: Target,\n\t}\n\n\tfn events (input: \u0026 Input) -\u003e GenResult \u003cVec \u003cEvent\u003e\u003e {\n\t\t#[ derive (Debug, Default) ]\n\t\tstruct BotState {\n\t\t\tchips: ArrayVec \u003cVal, 2\u003e,\n\t\t\tgives: Option \u003c(Target, Target)\u003e,\n\t\t}\n\t\tlet mut bots: HashMap \u003cVal, BotState\u003e = HashMap::new ();\n\t\tlet mut todo: Vec \u003cVal\u003e = Vec::new ();\n\t\tfor step in input.steps.iter () {\n\t\t\tmatch * step {\n\t\t\t\tStep::Input { bot, val } =\u003e {\n\t\t\t\t\tlet bot_state = bots.entry (bot).or_default ();\n\t\t\t\t\tif bot_state.chips.is_full () {\n\t\t\t\t\t\tErr (format! (\"Bot {} has too many chips\", bot)) ?;\n\t\t\t\t\t}\n\t\t\t\t\tbot_state.chips.push (val);\n\t\t\t\t\tif bot_state.chips.is_full () \u0026\u0026 bot_state.gives.is_some () {\n\t\t\t\t\t\ttodo.push (bot);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tStep::Give { bot, low, high } =\u003e {\n\t\t\t\t\tlet bot_state = bots.entry (bot).or_default ();\n\t\t\t\t\tif bot_state.gives.is_some () {\n\t\t\t\t\t\tErr (format! (\"Bot {} gives more than once\", bot)) ?;\n\t\t\t\t\t}\n\t\t\t\t\tbot_state.gives = Some ((low, high));\n\t\t\t\t\tif bot_state.chips.is_full () \u0026\u0026 bot_state.gives.is_some () {\n\t\t\t\t\t\ttodo.push (bot);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t\tlet mut events: Vec \u003cEvent\u003e = Vec::new ();\n\t\twhile let Some (from_bot) = todo.pop () {\n\t\t\tlet from_bot_state = bots.get_mut (\u0026 from_bot).unwrap ();\n\t\t\tlet low_chip = from_bot_state.chips.iter_vals ().min ().unwrap ();\n\t\t\tlet high_chip = from_bot_state.chips.iter_vals ().max ().unwrap ();\n\t\t\tfrom_bot_state.chips.clear ();\n\t\t\tlet (low_target, high_target) = from_bot_state.gives.unwrap ();\n\t\t\tfor (chip, target) in [(low_chip, low_target), (high_chip, high_target)] {\n\t\t\t\tmatch target {\n\t\t\t\t\tTarget::Bot (to_bot) =\u003e {\n\t\t\t\t\t\tlet to_bot_state = some_or! (bots.get_mut (\u0026 to_bot),\n\t\t\t\t\t\t\tErr (format! (\"Bot {} gives to unknown bot {}\", from_bot, to_bot)) ?);\n\t\t\t\t\t\tif to_bot_state.chips.is_full () {\n\t\t\t\t\t\t\tErr (format! (\"Bot {} has too many chips\", to_bot)) ?;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tto_bot_state.chips.push (chip);\n\t\t\t\t\t\tif to_bot_state.chips.is_full () \u0026\u0026 to_bot_state.gives.is_some () {\n\t\t\t\t\t\t\ttodo.push (to_bot);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tTarget::Output (_) =\u003e (),\n\t\t\t\t}\n\t\t\t}\n\t\t\tevents.push (Event { from_bot, low_chip, high_chip, low_target, high_target });\n\t\t}\n\t\tOk (events)\n\t}\n\n\t#[ cfg (test) ]\n\tmod tests {\n\n\t\tuse super::*;\n\n\t\t#[ test ]\n\t\tfn events () {\n\t\t\tassert_err! (\"Bot 0 gives to unknown bot 1\", logic::events (\u0026 Input {\n\t\t\t\tsteps: vec! [\n\t\t\t\t\tStep::Input { val: 1, bot: 0 },\n\t\t\t\t\tStep::Input { val: 2, bot: 0 },\n\t\t\t\t\tStep::Give { bot: 0, low: Target::Bot (1), high: Target::Bot (2) },\n\t\t\t\t],\n\t\t\t\t.. default ()\n\t\t\t}));\n\t\t\tassert_err! (\"Bot 0 has too many chips\", logic::events (\u0026 Input {\n\t\t\t\tsteps: vec! [\n\t\t\t\t\tStep::Input { val: 1, bot: 0 },\n\t\t\t\t\tStep::Input { val: 2, bot: 0 },\n\t\t\t\t\tStep::Input { val: 3, bot: 0 },\n\t\t\t\t],\n\t\t\t\t.. default ()\n\t\t\t}));\n\t\t\tassert_err! (\"Bot 0 gives more than once\", logic::events (\u0026 Input {\n\t\t\t\tsteps: vec! [\n\t\t\t\t\tStep::Give { bot: 0, low: Target::Bot (1), high: Target::Bot (2) },\n\t\t\t\t\tStep::Give { bot: 0, low: Target::Bot (3), high: Target::Bot (4) },\n\t\t\t\t],\n\t\t\t\t.. default ()\n\t\t\t}));\n\t\t}\n\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse parser::*;\n\n\tpub type Val = u16;\n\n\t#[ derive (Clone, Debug, Default, Eq, PartialEq) ]\n\tpub struct Input {\n\t\tpub steps: Vec \u003cStep\u003e,\n\t\tpub low: Val,\n\t\tpub high: Val,\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\n\tpub enum Step {\n\t\tInput { val: Val, bot: Val },\n\t\tGive { bot: Val, low: Target, high: Target },\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\n\tpub enum Target {\n\t\tBot (Val),\n\t\tOutput (Val),\n\t}\n\n\timpl Input {\n\t\tpub fn parse (mut input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet low = input_param (\u0026 mut input, \"LOW=\", 17_u16) ?;\n\t\t\tlet high = input_param (\u0026 mut input, \"HIGH=\", 61_u16) ?;\n\t\t\tlet steps = input.iter ()\n\t\t\t\t.enumerate ()\n\t\t\t\t.map (|(line_idx, line)|\n\t\t\t\t\tParser::wrap (line, |parser| {\n\t\t\t\t\t\tparser.set_ignore_whitespace (true);\n\t\t\t\t\t\tparser.item ()\n\t\t\t\t\t}).map_parse_err (|col_idx| format! (\"Invalid input: line {}: col {}: {}\",\n\t\t\t\t\t\tline_idx + 1, col_idx + 1, line)))\n\t\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e () ?;\n\t\t\tOk (Self { steps, low, high })\n\t\t}\n\t}\n\n\timpl FromParser for Step {\n\t\tfn from_parser (parser: \u0026 mut Parser) -\u003e ParseResult \u003cSelf\u003e {\n\t\t\tparser.any ()\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tlet val = parser.expect (\"value\") ?.confirm ().int () ?;\n\t\t\t\t\tlet bot = parser.expect (\"goes to bot\") ?.int () ?;\n\t\t\t\t\tparser.end () ?;\n\t\t\t\t\tOk (Self::Input { val, bot })\n\t\t\t\t})\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tlet bot = parser.expect (\"bot\") ?.confirm ().int () ?;\n\t\t\t\t\tlet low: Target = parser.expect (\"gives low to\") ?.item () ?;\n\t\t\t\t\tlet high: Target = parser.expect (\"and high to\") ?.item () ?;\n\t\t\t\t\tparser.end () ?;\n\t\t\t\t\tOk (Self::Give { bot, low, high })\n\t\t\t\t})\n\t\t\t\t.done ()\n\t\t}\n\t}\n\n\timpl FromParser for Target {\n\t\tfn from_parser (parser: \u0026 mut Parser) -\u003e ParseResult \u003cSelf\u003e {\n\t\t\tparser.any ()\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tlet bot = parser.expect (\"bot\") ?.confirm ().int () ?;\n\t\t\t\t\tOk (Self::Bot (bot))\n\t\t\t\t})\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tlet output = parser.expect (\"output\") ?.confirm ().int () ?;\n\t\t\t\t\tOk (Self::Output (output))\n\t\t\t\t})\n\t\t\t\t.done ()\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"value 5 goes to bot 2\",\n\t\t\"bot 2 gives low to bot 1 and high to bot 0\",\n\t\t\"value 3 goes to bot 1\",\n\t\t\"bot 1 gives low to output 1 and high to bot 0\",\n\t\t\"bot 0 gives low to output 2 and high to output 0\",\n\t\t\"value 2 goes to bot 2\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tuse parser::with_params;\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"0\", puzzle.part_one (\u0026 with_params ([\"LOW=3\", \"HIGH=5\"], EXAMPLE)));\n\t\tassert_eq_ok! (\"1\", puzzle.part_one (\u0026 with_params ([\"LOW=2\", \"HIGH=3\"], EXAMPLE)));\n\t\tassert_eq_ok! (\"2\", puzzle.part_one (\u0026 with_params ([\"LOW=2\", \"HIGH=5\"], EXAMPLE)));\n\t\tassert_err! (\"No solution found\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"30\", puzzle.part_two (EXAMPLE));\n\t\tassert_err! (\"No solution found\", puzzle.part_one (\u0026 EXAMPLE [1 .. ]));\n\t}\n\n}\n","traces":[{"line":13,"address":[125859,125171],"length":1,"stats":{"Line":2},"fn_name":null},{"line":14,"address":[125277],"length":1,"stats":{"Line":1},"fn_name":null},{"line":15,"address":[125965],"length":1,"stats":{"Line":1},"fn_name":null},{"line":26,"address":[97360,97719],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":27,"address":[97583,97905,97390,97745],"length":1,"stats":{"Line":3},"fn_name":null},{"line":28,"address":[97816],"length":1,"stats":{"Line":1},"fn_name":null},{"line":29,"address":[97888],"length":1,"stats":{"Line":1},"fn_name":null},{"line":32,"address":[97936],"length":1,"stats":{"Line":1},"fn_name":null},{"line":35,"address":[99213,99148,98000],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":36,"address":[98025],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[98032],"length":1,"stats":{"Line":1},"fn_name":null},{"line":38,"address":[98039],"length":1,"stats":{"Line":1},"fn_name":null},{"line":39,"address":[98279,98046],"length":1,"stats":{"Line":2},"fn_name":null},{"line":40,"address":[98575],"length":1,"stats":{"Line":1},"fn_name":null},{"line":41,"address":[98479],"length":1,"stats":{"Line":1},"fn_name":null},{"line":42,"address":[98527],"length":1,"stats":{"Line":1},"fn_name":null},{"line":44,"address":[98935,99002],"length":1,"stats":{"Line":2},"fn_name":null},{"line":45,"address":[99052,99089,98971],"length":1,"stats":{"Line":3},"fn_name":null},{"line":46,"address":[99139,99164,99058],"length":1,"stats":{"Line":3},"fn_name":null},{"line":49,"address":[99228,99366],"length":1,"stats":{"Line":2},"fn_name":null},{"line":50,"address":[99380],"length":1,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[99438,99494],"length":1,"stats":{"Line":2},"fn_name":null},{"line":52,"address":[99336,99469],"length":1,"stats":{"Line":0},"fn_name":null},{"line":65,"address":[99664,104043,103903],"length":1,"stats":{"Line":1},"fn_name":"events"},{"line":71,"address":[99703],"length":1,"stats":{"Line":1},"fn_name":null},{"line":72,"address":[99724],"length":1,"stats":{"Line":1},"fn_name":null},{"line":73,"address":[99855,99779,100031],"length":1,"stats":{"Line":6},"fn_name":null},{"line":74,"address":[100055],"length":1,"stats":{"Line":2},"fn_name":null},{"line":75,"address":[100077],"length":1,"stats":{"Line":2},"fn_name":null},{"line":76,"address":[100109,100965],"length":1,"stats":{"Line":4},"fn_name":null},{"line":77,"address":[101295,100996],"length":1,"stats":{"Line":2},"fn_name":null},{"line":78,"address":[101052,101308],"length":1,"stats":{"Line":2},"fn_name":null},{"line":80,"address":[101039],"length":1,"stats":{"Line":2},"fn_name":null},{"line":81,"address":[101434],"length":1,"stats":{"Line":2},"fn_name":null},{"line":82,"address":[101527],"length":1,"stats":{"Line":2},"fn_name":null},{"line":85,"address":[100151],"length":1,"stats":{"Line":2},"fn_name":null},{"line":86,"address":[100243],"length":1,"stats":{"Line":2},"fn_name":null},{"line":87,"address":[100313,100704],"length":1,"stats":{"Line":2},"fn_name":null},{"line":88,"address":[100461,100717],"length":1,"stats":{"Line":2},"fn_name":null},{"line":90,"address":[100384],"length":1,"stats":{"Line":2},"fn_name":null},{"line":91,"address":[100444,100857],"length":1,"stats":{"Line":4},"fn_name":null},{"line":92,"address":[100929],"length":1,"stats":{"Line":1},"fn_name":null},{"line":97,"address":[100021,101555],"length":1,"stats":{"Line":4},"fn_name":null},{"line":98,"address":[101565,101644],"length":1,"stats":{"Line":4},"fn_name":null},{"line":99,"address":[101706,101844],"length":1,"stats":{"Line":4},"fn_name":null},{"line":100,"address":[101882],"length":1,"stats":{"Line":2},"fn_name":null},{"line":101,"address":[102016],"length":1,"stats":{"Line":2},"fn_name":null},{"line":102,"address":[102132],"length":1,"stats":{"Line":2},"fn_name":null},{"line":103,"address":[102147],"length":1,"stats":{"Line":2},"fn_name":null},{"line":104,"address":[103342,102313],"length":1,"stats":{"Line":3},"fn_name":null},{"line":105,"address":[102722],"length":1,"stats":{"Line":2},"fn_name":null},{"line":106,"address":[102744],"length":1,"stats":{"Line":2},"fn_name":null},{"line":107,"address":[102855,102776],"length":1,"stats":{"Line":4},"fn_name":null},{"line":108,"address":[102826,102921],"length":1,"stats":{"Line":2},"fn_name":null},{"line":109,"address":[102879,103356,103619],"length":1,"stats":{"Line":4},"fn_name":null},{"line":110,"address":[103388,103632],"length":1,"stats":{"Line":0},"fn_name":null},{"line":112,"address":[103367],"length":1,"stats":{"Line":2},"fn_name":null},{"line":113,"address":[103786],"length":1,"stats":{"Line":2},"fn_name":null},{"line":114,"address":[103875],"length":1,"stats":{"Line":2},"fn_name":null},{"line":120,"address":[103948],"length":1,"stats":{"Line":2},"fn_name":null},{"line":122,"address":[101729],"length":1,"stats":{"Line":2},"fn_name":null},{"line":131,"address":[38677,38672],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":132,"address":[133960,134081],"length":1,"stats":{"Line":1},"fn_name":null},{"line":133,"address":[133825,133607],"length":1,"stats":{"Line":2},"fn_name":null},{"line":134,"address":[133641],"length":1,"stats":{"Line":1},"fn_name":null},{"line":135,"address":[133671],"length":1,"stats":{"Line":1},"fn_name":null},{"line":136,"address":[133701],"length":1,"stats":{"Line":1},"fn_name":null},{"line":138,"address":[133916],"length":1,"stats":{"Line":1},"fn_name":null},{"line":140,"address":[134806],"length":1,"stats":{"Line":1},"fn_name":null},{"line":141,"address":[134550,134668],"length":1,"stats":{"Line":2},"fn_name":null},{"line":142,"address":[134578],"length":1,"stats":{"Line":1},"fn_name":null},{"line":143,"address":[134608],"length":1,"stats":{"Line":1},"fn_name":null},{"line":144,"address":[134638],"length":1,"stats":{"Line":1},"fn_name":null},{"line":146,"address":[134759],"length":1,"stats":{"Line":1},"fn_name":null},{"line":148,"address":[135751],"length":1,"stats":{"Line":1},"fn_name":null},{"line":149,"address":[135635,135359],"length":1,"stats":{"Line":2},"fn_name":null},{"line":150,"address":[135387],"length":1,"stats":{"Line":1},"fn_name":null},{"line":151,"address":[135511],"length":1,"stats":{"Line":1},"fn_name":null},{"line":153,"address":[135704],"length":1,"stats":{"Line":1},"fn_name":null},{"line":188,"address":[46320],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":189,"address":[46480,46347],"length":1,"stats":{"Line":1},"fn_name":null},{"line":190,"address":[46437,46533,46626],"length":1,"stats":{"Line":2},"fn_name":null},{"line":191,"address":[46682,47100,46593],"length":1,"stats":{"Line":3},"fn_name":null},{"line":193,"address":[129072,129100,129181],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":194,"address":[129200,129156,129264,129110],"length":1,"stats":{"Line":8},"fn_name":"{closure#0}"},{"line":195,"address":[129235],"length":1,"stats":{"Line":2},"fn_name":null},{"line":196,"address":[129254],"length":1,"stats":{"Line":2},"fn_name":null},{"line":197,"address":[129358,129448,129509,129136,129280],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":198,"address":[129323,129384,129474],"length":1,"stats":{"Line":0},"fn_name":null},{"line":200,"address":[46891],"length":1,"stats":{"Line":2},"fn_name":null},{"line":205,"address":[47120],"length":1,"stats":{"Line":2},"fn_name":"from_parser"},{"line":206,"address":[47138],"length":1,"stats":{"Line":2},"fn_name":null},{"line":207,"address":[129680,130162,130698],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":208,"address":[129726,129938,130045],"length":1,"stats":{"Line":4},"fn_name":null},{"line":209,"address":[130170,130367,130010,130461],"length":1,"stats":{"Line":6},"fn_name":null},{"line":210,"address":[130441,130708,130582],"length":1,"stats":{"Line":4},"fn_name":null},{"line":211,"address":[130645],"length":1,"stats":{"Line":2},"fn_name":null},{"line":213,"address":[130832,132373,131314],"length":1,"stats":{"Line":6},"fn_name":"{closure#1}"},{"line":214,"address":[130878,131090,131197],"length":1,"stats":{"Line":4},"fn_name":null},{"line":215,"address":[131322,131654,131162,131519],"length":1,"stats":{"Line":6},"fn_name":null},{"line":216,"address":[131622,131972,132095,131775],"length":1,"stats":{"Line":6},"fn_name":null},{"line":217,"address":[132383,132075,132216],"length":1,"stats":{"Line":4},"fn_name":null},{"line":218,"address":[132295],"length":1,"stats":{"Line":2},"fn_name":null},{"line":225,"address":[47216],"length":1,"stats":{"Line":2},"fn_name":"from_parser"},{"line":226,"address":[47234],"length":1,"stats":{"Line":2},"fn_name":null},{"line":227,"address":[133010,132512,132757,132974],"length":1,"stats":{"Line":8},"fn_name":"{closure#0}"},{"line":228,"address":[132857,132767,132558],"length":1,"stats":{"Line":4},"fn_name":null},{"line":229,"address":[132829,132997],"length":1,"stats":{"Line":4},"fn_name":null},{"line":231,"address":[133269,133024,133486,133522],"length":1,"stats":{"Line":6},"fn_name":"{closure#1}"},{"line":232,"address":[133279,133369,133070],"length":1,"stats":{"Line":4},"fn_name":null},{"line":233,"address":[133509,133341],"length":1,"stats":{"Line":4},"fn_name":null},{"line":256,"address":[31536,31902,34436],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":258,"address":[31543],"length":1,"stats":{"Line":1},"fn_name":null},{"line":259,"address":[31962,31588,31751],"length":1,"stats":{"Line":3},"fn_name":null},{"line":260,"address":[32424,32750],"length":1,"stats":{"Line":2},"fn_name":null},{"line":261,"address":[33213,33515],"length":1,"stats":{"Line":2},"fn_name":null},{"line":262,"address":[33939],"length":1,"stats":{"Line":1},"fn_name":null},{"line":266,"address":[35054,35576,34464],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":267,"address":[34471],"length":1,"stats":{"Line":1},"fn_name":null},{"line":268,"address":[34497,34577,34646],"length":1,"stats":{"Line":3},"fn_name":null},{"line":269,"address":[35065],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":118,"coverable":121},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-11","src","lib.rs"],"content":"//! Advent of Code 2016: Day 11: Radioisotope Thermoelectric Generators\n//!\n//! [https://adventofcode.com/2016/day/11](https://adventofcode.com/2016/day/11)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Radioisotope Thermoelectric Generators\";\n\tyear = 2016;\n\tday = 11;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n\tcommands = [\n\t\t( name = \"corpus-gen\"; method = tools::corpus_gen; ),\n\t];\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Component;\n\tuse model::Input;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cusize\u003e {\n\t\tcalc_result (input)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cusize\u003e {\n\t\tlet mut input = input.clone ();\n\t\tlet elerium_str = Rc::from (\"elerium\");\n\t\tlet dilithium_str = Rc::from (\"dilithium\");\n\t\tinput.floors [0].push (Component::Generator (Rc::clone (\u0026 elerium_str)));\n\t\tinput.floors [0].push (Component::Microchip (elerium_str));\n\t\tinput.floors [0].push (Component::Generator (Rc::clone (\u0026 dilithium_str)));\n\t\tinput.floors [0].push (Component::Microchip (dilithium_str));\n\t\tcalc_result (\u0026 input)\n\t}\n\n\tfn calc_result (input: \u0026 Input) -\u003e GenResult \u003cusize\u003e {\n\t\tlet (mut state, _names) = State::from_input (input) ?;\n\t\tstate.comps [ .. state.comps_len.as_usize ()].sort ();\n\t\tlet mut seen = HashSet::new ();\n\t\tseen.insert (state.compact ());\n\t\tlet mut todo = VecDeque::new ();\n\t\ttodo.push_back ((state.compact (), 0));\n\t\tlet mut next_states = Vec::new ();\n\t\twhile let Some ((state_compact, steps)) = todo.pop_front () {\n\t\t\tlet state = state_compact.expand ();\n\t\t\tif state.is_done () { return Ok (steps) }\n\t\t\tnext_states.clear ();\n\t\t\tstate.next_states (\u0026 mut next_states);\n\t\t\tfor next_state in next_states.iter_vals () {\n\t\t\t\tif ! seen.insert (next_state) { continue }\n\t\t\t\ttodo.push_back ((next_state, steps + 1));\n\t\t\t}\n\t\t}\n\t\tErr (\"No solution found\".into ())\n\t}\n\n\t#[ derive (Clone, Copy, Debug) ]\n\tstruct State {\n\t\tcomps: [[u8; 2]; 7],\n\t\tcomps_len: u8,\n\t\televator: u8,\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, Hash, Ord, PartialEq, PartialOrd) ]\n\tstruct StateCompact {\n\t\tdata: u64,\n\t}\n\n\timpl State {\n\n\t\tfn from_input (input: \u0026 Input) -\u003e GenResult \u003c(Self, Vec \u003cRc \u003cstr\u003e\u003e)\u003e {\n\t\t\tlet names: Vec \u003cRc \u003cstr\u003e\u003e =\n\t\t\t\tinput.floors.iter ()\n\t\t\t\t\t.flat_map (|floor| floor.iter ()\n\t\t\t\t\t\t.map (|comp| match * comp {\n\t\t\t\t\t\t\tComponent::Generator (ref name) =\u003e Rc::clone (name),\n\t\t\t\t\t\t\tComponent::Microchip (ref name) =\u003e Rc::clone (name),\n\t\t\t\t\t\t}))\n\t\t\t\t\t.sorted ()\n\t\t\t\t\t.dedup ()\n\t\t\t\t\t.collect ();\n\t\t\tif names.is_empty () { return Err (\"Must have at least one component type\".into ()) }\n\t\t\tif names.len () \u003e 7 { return Err (\"Only support seven types of component\".into ()) }\n\t\t\tlet comp_floor = |comp|\n\t\t\t\tinput.floors.iter ()\n\t\t\t\t\t.enumerate ()\n\t\t\t\t\t.flat_map (|(floor_idx, floor)| floor.iter ()\n\t\t\t\t\t\t.map (move |comp| ((floor_idx + 1).as_u8 (), comp)))\n\t\t\t\t\t.filter (|\u0026 (_, some_comp)| * some_comp == comp)\n\t\t\t\t\t.map (|(floor, _)| floor)\n\t\t\t\t\t.exactly_one ()\n\t\t\t\t\t.map_err (|_err| \"Must have exactly one generator of each type\");\n\t\t\tOk ((Self {\n\t\t\t\tcomps: names.iter ()\n\t\t\t\t\t.map (|name| Ok::\u003c_, GenError\u003e ([\n\t\t\t\t\t\tcomp_floor (Component::Generator (Rc::clone (name))) ?,\n\t\t\t\t\t\tcomp_floor (Component::Microchip (Rc::clone (name))) ?,\n\t\t\t\t\t]))\n\t\t\t\t\t.chain (iter::from_fn (|| Some (Ok ([1, 1]))))\n\t\t\t\t\t.take (7)\n\t\t\t\t\t.collect_array_ok () ?\n\t\t\t\t\t.unwrap (),\n\t\t\t\tcomps_len: names.len ().as_u8 (),\n\t\t\t\televator: 1,\n\t\t\t}, names))\n\t\t}\n\n\t\tfn next_states (\u0026 self, results: \u0026 mut Vec \u003cStateCompact\u003e) {\n\t\t\tlet mut next_floors = ArrayVec::\u003cu8, 2\u003e::new ();\n\t\t\tif self.elevator \u003e 1 { next_floors.push (self.elevator - 1); }\n\t\t\tif self.elevator \u003c 4 { next_floors.push (self.elevator + 1); }\n\t\t\tfor name_idx_0 in 0 .. self.comps_len.as_usize () {\n\t\t\t\tfor comp_idx_0 in 0 .. 2 {\n\t\t\t\t\tif self.comps [name_idx_0] [comp_idx_0] != self.elevator { continue }\n\t\t\t\t\tfor next_floor in next_floors.iter_vals () {\n\t\t\t\t\t\tlet mut next_state = * self;\n\t\t\t\t\t\tnext_state.elevator = next_floor;\n\t\t\t\t\t\tnext_state.comps [name_idx_0] [comp_idx_0] = next_floor;\n\t\t\t\t\t\tif next_state.is_valid () {\n\t\t\t\t\t\t\tnext_state.comps [ .. next_state.comps_len.as_usize ()].sort ();\n\t\t\t\t\t\t\tresults.push (next_state.compact ());\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfor name_idx_1 in name_idx_0 .. self.comps_len.as_usize () {\n\t\t\t\t\t\tfor comp_idx_1 in 0 .. 2 {\n\t\t\t\t\t\t\tif self.comps [name_idx_1] [comp_idx_1] != self.elevator { continue }\n\t\t\t\t\t\t\tif (name_idx_0, comp_idx_0) \u003e= (name_idx_1, comp_idx_1) { continue }\n\t\t\t\t\t\t\tfor next_floor in next_floors.iter_vals () {\n\t\t\t\t\t\t\t\tlet mut next_state = * self;\n\t\t\t\t\t\t\t\tnext_state.elevator = next_floor;\n\t\t\t\t\t\t\t\tnext_state.comps [name_idx_0] [comp_idx_0] = next_floor;\n\t\t\t\t\t\t\t\tnext_state.comps [name_idx_1] [comp_idx_1] = next_floor;\n\t\t\t\t\t\t\t\tif next_state.is_valid () {\n\t\t\t\t\t\t\t\t\tnext_state.comps [ .. next_state.comps_len.as_usize ()].sort ();\n\t\t\t\t\t\t\t\t\tresults.push (next_state.compact ());\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfn is_valid (\u0026 self) -\u003e bool {\n\t\t\tfor name_idx_0 in 0 .. self.comps_len.as_usize () {\n\t\t\t\tif self.comps [name_idx_0] [1] == self.comps [name_idx_0] [0] { continue }\n\t\t\t\tfor name_idx_1 in 0 .. self.comps_len.as_usize () {\n\t\t\t\t\tif name_idx_1 == name_idx_0 { continue }\n\t\t\t\t\tif self.comps [name_idx_0] [1] == self.comps [name_idx_1] [0] { return false }\n\t\t\t\t}\n\t\t\t}\n\t\t\ttrue\n\t\t}\n\n\t\tfn is_done (\u0026 self) -\u003e bool {\n\t\t\tself.comps.iter ()\n\t\t\t\t.take (self.comps_len.as_usize ())\n\t\t\t\t.all (|\u0026 [gen, chip]| gen == 4 \u0026\u0026 chip == 4)\n\t\t}\n\n\t\tfn compact (\u0026 self) -\u003e StateCompact {\n\t\t\tlet mut data = 0_u64;\n\t\t\tfor [gen, chip] in self.comps.iter_vals ().rev () {\n\t\t\t\tdebug_assert! ((1 ..= 4).contains (\u0026 gen));\n\t\t\t\tdata \u003c\u003c= 2_u32;\n\t\t\t\tdata |= chip.as_u64 () - 1;\n\t\t\t\tdebug_assert! ((1 ..= 4).contains (\u0026 chip));\n\t\t\t\tdata \u003c\u003c= 2_u32;\n\t\t\t\tdata |= gen.as_u64 () - 1;\n\t\t\t}\n\t\t\tdebug_assert! ((1 ..= 7).contains (\u0026 self.comps_len));\n\t\t\tdata \u003c\u003c= 3_u32;\n\t\t\tdata |= self.comps_len.as_u64 ();\n\t\t\tdebug_assert! ((1 ..= 4).contains (\u0026 self.elevator));\n\t\t\tdata \u003c\u003c= 2_u32;\n\t\t\tdata |= self.elevator.as_u64 () - 1;\n\t\t\tStateCompact { data }\n\t\t}\n\n\t}\n\n\timpl StateCompact {\n\t\tfn expand (self) -\u003e State {\n\t\t\tlet mut data = self.data;\n\t\t\tlet elevator = (data \u0026 0x3).as_u8 () + 1;\n\t\t\tdata \u003e\u003e= 2_u32;\n\t\t\tlet comps_len = (data \u0026 0x7).as_u8 ();\n\t\t\tdata \u003e\u003e= 3_u32;\n\t\t\tlet comps = (0_u32 .. 7_u32).map (|_| {\n\t\t\t\tlet gen = (data \u0026 0x3).as_u8 () + 1;\n\t\t\t\tdata \u003e\u003e= 2_u32;\n\t\t\t\tlet chip = (data \u0026 0x3).as_u8 () + 1;\n\t\t\t\tdata \u003e\u003e= 2_u32;\n\t\t\t\t[gen, chip]\n\t\t\t}).collect_array ().unwrap ();\n\t\t\tdebug_assert! (data == 0);\n\t\t\tState { comps, comps_len, elevator }\n\t\t}\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse parser::*;\n\n\tpub type Val = u16;\n\n\t#[ derive (Clone, Debug, Default, Eq, PartialEq) ]\n\tpub struct Input {\n\t\tpub floors: Vec \u003cVec \u003cComponent\u003e\u003e,\n\t}\n\n\t#[ derive (Clone, Debug, Eq, PartialEq) ]\n\tpub enum Component {\n\t\tGenerator (Rc \u003cstr\u003e),\n\t\tMicrochip (Rc \u003cstr\u003e),\n\t}\n\n\timpl Input {\n\t\tpub fn parse (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet floors = input.iter ()\n\t\t\t\t.enumerate ()\n\t\t\t\t.map (|(line_idx, line)|\n\t\t\t\t\tParser::wrap (line, |parser| {\n\t\t\t\t\t\tparser.set_word_pred (char::is_alphabetic);\n\t\t\t\t\t\tparser.expect (match line_idx {\n\t\t\t\t\t\t\t0 =\u003e \"The first floor contains \",\n\t\t\t\t\t\t\t1 =\u003e \"The second floor contains \",\n\t\t\t\t\t\t\t2 =\u003e \"The third floor contains \",\n\t\t\t\t\t\t\t3 =\u003e \"The fourth floor contains \",\n\t\t\t\t\t\t\t_ =\u003e return Err (parser.err ()),\n\t\t\t\t\t\t}) ?;\n\t\t\t\t\t\tparser.any ()\n\t\t\t\t\t\t\t.of (|parser| {\n\t\t\t\t\t\t\t\tparser.expect (\"nothing relevant.\") ?.confirm ().end () ?;\n\t\t\t\t\t\t\t\tOk (vec! [])\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.of (|parser| {\n\t\t\t\t\t\t\t\tlet comp: Component = parser.expect (\"a \") ?.item () ?;\n\t\t\t\t\t\t\t\tparser.expect (\".\") ?.end () ?;\n\t\t\t\t\t\t\t\tOk (vec! [ comp ])\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.of (|parser| {\n\t\t\t\t\t\t\t\tlet comp_0 = parser.expect (\"a \") ?.item () ?;\n\t\t\t\t\t\t\t\tlet comp_1 = parser.expect (\" and a \") ?.item () ?;\n\t\t\t\t\t\t\t\tparser.expect (\".\") ?.end () ?;\n\t\t\t\t\t\t\t\tOk (vec! [ comp_0, comp_1 ])\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.of (|parser| {\n\t\t\t\t\t\t\t\tlet comp = parser.expect (\"a \") ?.item () ?;\n\t\t\t\t\t\t\t\tlet mut comps = vec! [ comp ];\n\t\t\t\t\t\t\t\tloop {\n\t\t\t\t\t\t\t\t\tif parser.rest ().starts_with (\", and a \") {\n\t\t\t\t\t\t\t\t\t\tlet comp: Component =\n\t\t\t\t\t\t\t\t\t\t\tparser.expect (\", and a \") ?.item () ?;\n\t\t\t\t\t\t\t\t\t\tparser.expect (\".\") ?;\n\t\t\t\t\t\t\t\t\t\tcomps.push (comp);\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tlet comp = parser.expect (\", a \") ?.item () ?;\n\t\t\t\t\t\t\t\t\tcomps.push (comp);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tOk (comps)\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.done ()\n\t\t\t\t\t}).map_parse_err (|col_idx| format! (\"Invalid input: line {}: col {}: {}\",\n\t\t\t\t\t\tline_idx + 1, col_idx + 1, line)))\n\t\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e () ?;\n\t\t\tOk (Self { floors })\n\t\t}\n\t}\n\n\timpl FromParser for Component {\n\t\tfn from_parser (parser: \u0026 mut Parser) -\u003e ParseResult \u003cSelf\u003e {\n\t\t\tparser.any ()\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tlet name = parser.word () ?;\n\t\t\t\t\tparser.expect (\"-compatible microchip\") ?;\n\t\t\t\t\tOk (Self::Microchip (Rc::from (name)))\n\t\t\t\t})\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tlet name = parser.word () ?;\n\t\t\t\t\tparser.expect (\" generator\") ?;\n\t\t\t\t\tOk (Self::Generator (Rc::from (name)))\n\t\t\t\t})\n\t\t\t\t.done ()\n\t\t}\n\t}\n\n}\n\nmod tools {\n\n\tuse super::*;\n\tuse std::fs::File;\n\tuse std::io::Read as _;\n\tuse std::io::Write as _;\n\tuse std::path::PathBuf;\n\tuse std::process::Command;\n\tuse std::process::Stdio;\n\n\t#[ derive (clap::Parser) ]\n\tpub struct CorpusGenArgs {\n\n\t\t#[ clap (long, default_value = \"fuzz/corpus/2016-day-11\") ]\n\t\toutput_dir: PathBuf,\n\n\t\t#[ clap (long, default_value = \"10\") ]\n\t\tnum_files: usize,\n\n\t\t#[ clap (long, default_value = \"5\") ]\n\t\tnum_comps: usize,\n\n\t\t#[ clap (long, default_value = \"4\") ]\n\t\tname_len: usize,\n\n\t}\n\n\t#[ allow (clippy::needless_pass_by_value) ]\n\tpub fn corpus_gen (args: CorpusGenArgs) -\u003e GenResult \u003c()\u003e {\n\t\tlet mut rand = File::open (\"/dev/urandom\") ?;\n\t\tfor _ in 0 .. args.num_files {\n\t\t\tlet names =\n\t\t\t\titer::from_fn (\n\t\t\t\t\t\t|| -\u003e Option \u003cString\u003e {\n\t\t\t\t\t\t\tlet mut name = String::new ();\n\t\t\t\t\t\t\twhile name.len () \u003c args.name_len {\n\t\t\t\t\t\t\t\tlet mut buf = [0];\n\t\t\t\t\t\t\t\tassert_eq! (rand.read (\u0026 mut buf).unwrap (), 1);\n\t\t\t\t\t\t\t\tlet ch = ok_or! (buf [0].to_char (), continue);\n\t\t\t\t\t\t\t\tif ! ch.is_ascii_lowercase () { continue }\n\t\t\t\t\t\t\t\tname.push (ch);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tSome (name)\n\t\t\t\t\t\t})\n\t\t\t\t\t.take (args.num_comps)\n\t\t\t\t\t.collect::\u003cVec \u003cString\u003e\u003e ();\n\t\t\tlet comps =\n\t\t\t\titer::from_fn (\n\t\t\t\t\t\t|| -\u003e Option \u003c[u8; 2]\u003e {\n\t\t\t\t\t\t\tlet mut buf = [0];\n\t\t\t\t\t\t\tassert_eq! (rand.read (\u0026 mut buf).unwrap (), 1);\n\t\t\t\t\t\t\tSome ([(buf [0] \u0026 0x3) + 1, ((buf [0] \u003e\u003e 2_u32) \u0026 0x3) + 1])\n\t\t\t\t\t\t})\n\t\t\t\t\t.take (7)\n\t\t\t\t\t.collect::\u003cVec \u003c[u8; 2]\u003e\u003e ();\n\t\t\tlet mut output = String::new ();\n\t\t\tfor floor in 1 ..= 4 {\n\t\t\t\tlet mut items = Vec::new ();\n\t\t\t\tfor (name, [gen, chip]) in\n\t\t\t\t\tnames.iter ()\n\t\t\t\t\t\t.zip (comps.iter_vals ())\n\t\t\t\t\t\t.take (args.num_comps) {\n\t\t\t\t\tif gen == floor {\n\t\t\t\t\t\titems.push (format! (\"{} generator\", name));\n\t\t\t\t\t}\n\t\t\t\t\tif chip == floor {\n\t\t\t\t\t\titems.push (format! (\"{}-compatible microchip\", name));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet floor_name = match floor {\n\t\t\t\t\t1 =\u003e \"first\", 2 =\u003e \"second\", 3 =\u003e \"third\", 4 =\u003e \"fourth\",\n\t\t\t\t\t_ =\u003e unreachable! (),\n\t\t\t\t};\n\t\t\t\tif items.is_empty () {\n\t\t\t\t\twriteln! (\u0026 mut output, \"The {} floor contains nothing relevant.\",\n\t\t\t\t\t\tfloor_name).unwrap ();\n\t\t\t\t} else if items.len () == 1 {\n\t\t\t\t\twriteln! (\u0026 mut output, \"The {} floor contains a {}.\", floor_name,\n\t\t\t\t\t\titems [0]).unwrap ();\n\t\t\t\t} else if items.len () == 2 {\n\t\t\t\t\twriteln! (\u0026 mut output, \"The {} floor contains a {} and a {}.\", floor_name,\n\t\t\t\t\t\titems [0], items [1]).unwrap ();\n\t\t\t\t} else {\n\t\t\t\t\twrite! (\u0026 mut output, \"The {} floor contains a {}\", floor_name, items [0]).unwrap ();\n\t\t\t\t\tfor item in \u0026 items [1 .. items.len () - 1] {\n\t\t\t\t\t\twrite! (\u0026 mut output, \", a {}\", item).unwrap ();\n\t\t\t\t\t}\n\t\t\t\t\twriteln! (\u0026 mut output, \", and a {}.\", items [items.len () - 1]).unwrap ();\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet mut sum_command =\n\t\t\t\tCommand::new (\"sha1sum\")\n\t\t\t\t\t.stdin (Stdio::piped ())\n\t\t\t\t\t.stdout (Stdio::piped ())\n\t\t\t\t\t.spawn ()\n\t\t\t\t\t.unwrap ();\n\t\t\tlet mut sum_stdin = sum_command.stdin.take ().unwrap ();\n\t\t\tsum_stdin.write_all (output.as_bytes ()).unwrap ();\n\t\t\tdrop (sum_stdin);\n\t\t\tlet sum_output = sum_command.wait_with_output ().unwrap ();\n\t\t\tlet sum_output_vec = sum_output.stdout [0 .. 40].to_vec ();\n\t\t\tlet sum_output_str = String::from_utf8 (sum_output_vec).unwrap ();\n\t\t\tlet mut output_path = args.output_dir.clone ();\n\t\t\toutput_path.push (sum_output_str);\n\t\t\tlet mut output_file = File::create (output_path).unwrap ();\n\t\t\toutput_file.write_all (output.as_bytes ()).unwrap ();\n\t\t}\n\t\tOk (())\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE_ONE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"The first floor contains a hydrogen-compatible microchip and a lithium-compatible microchip.\",\n\t\t\"The second floor contains a hydrogen generator.\",\n\t\t\"The third floor contains a lithium generator.\",\n\t\t\"The fourth floor contains nothing relevant.\",\n\t];\n\n\tconst EXAMPLE_TWO: \u0026 [\u0026 str] = \u0026 [\n\t\t\"The first floor contains a hydrogen generator.\",\n\t\t\"The second floor contains a lithium generator.\",\n\t\t\"The third floor contains a hydrogen-compatible microchip and a lithium-compatible microchip.\",\n\t\t\"The fourth floor contains nothing relevant.\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"11\", puzzle.part_one (EXAMPLE_ONE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"29\", puzzle.part_two (EXAMPLE_TWO));\n\t}\n\n}\n","traces":[{"line":13,"address":[200691,200003],"length":1,"stats":{"Line":2},"fn_name":null},{"line":14,"address":[200109],"length":1,"stats":{"Line":1},"fn_name":null},{"line":15,"address":[200797],"length":1,"stats":{"Line":1},"fn_name":null},{"line":27,"address":[143776],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":28,"address":[143793],"length":1,"stats":{"Line":1},"fn_name":null},{"line":31,"address":[144581,143808,144610],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":32,"address":[143833],"length":1,"stats":{"Line":1},"fn_name":null},{"line":33,"address":[143859,143935],"length":1,"stats":{"Line":2},"fn_name":null},{"line":34,"address":[143951,144036],"length":1,"stats":{"Line":2},"fn_name":null},{"line":35,"address":[144134,144052],"length":1,"stats":{"Line":2},"fn_name":null},{"line":36,"address":[144209],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[144309],"length":1,"stats":{"Line":1},"fn_name":null},{"line":38,"address":[144420],"length":1,"stats":{"Line":1},"fn_name":null},{"line":39,"address":[144528],"length":1,"stats":{"Line":1},"fn_name":null},{"line":42,"address":[146078,144640],"length":1,"stats":{"Line":1},"fn_name":"calc_result"},{"line":43,"address":[144922,144671],"length":1,"stats":{"Line":1},"fn_name":null},{"line":44,"address":[144887,145040],"length":1,"stats":{"Line":4},"fn_name":null},{"line":45,"address":[145117],"length":1,"stats":{"Line":2},"fn_name":null},{"line":46,"address":[145132,145197],"length":1,"stats":{"Line":4},"fn_name":null},{"line":47,"address":[145212],"length":1,"stats":{"Line":2},"fn_name":null},{"line":48,"address":[145227,145281],"length":1,"stats":{"Line":4},"fn_name":null},{"line":49,"address":[145340],"length":1,"stats":{"Line":2},"fn_name":null},{"line":50,"address":[145412,145365],"length":1,"stats":{"Line":4},"fn_name":null},{"line":51,"address":[145468],"length":1,"stats":{"Line":2},"fn_name":null},{"line":52,"address":[145615,145664],"length":1,"stats":{"Line":3},"fn_name":null},{"line":53,"address":[145644],"length":1,"stats":{"Line":2},"fn_name":null},{"line":54,"address":[145754],"length":1,"stats":{"Line":2},"fn_name":null},{"line":55,"address":[145769],"length":1,"stats":{"Line":1},"fn_name":null},{"line":56,"address":[145942],"length":1,"stats":{"Line":2},"fn_name":null},{"line":57,"address":[145968],"length":1,"stats":{"Line":2},"fn_name":null},{"line":60,"address":[145478],"length":1,"stats":{"Line":0},"fn_name":null},{"line":77,"address":[146787,146112],"length":1,"stats":{"Line":1},"fn_name":"from_input"},{"line":78,"address":[146153],"length":1,"stats":{"Line":1},"fn_name":null},{"line":80,"address":[57003,56976],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":81,"address":[57106,57088,57178],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":82,"address":[57124],"length":1,"stats":{"Line":2},"fn_name":null},{"line":83,"address":[57154],"length":1,"stats":{"Line":1},"fn_name":null},{"line":88,"address":[146354,146380,146299],"length":1,"stats":{"Line":4},"fn_name":null},{"line":89,"address":[146463,146368,146507],"length":1,"stats":{"Line":4},"fn_name":null},{"line":90,"address":[57200,57476],"length":1,"stats":{"Line":4},"fn_name":"{closure#1}"},{"line":91,"address":[57230,57297,57373],"length":1,"stats":{"Line":6},"fn_name":null},{"line":93,"address":[57520,57567,57642],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":94,"address":[57637,57664,57683],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":95,"address":[57809,57365,57792],"length":1,"stats":{"Line":6},"fn_name":"{closure#1}"},{"line":96,"address":[57856,57876],"length":1,"stats":{"Line":4},"fn_name":"{closure#2}"},{"line":98,"address":[57888,57255,57889,57469],"length":1,"stats":{"Line":2},"fn_name":"{closure#3}"},{"line":99,"address":[147176,147067],"length":1,"stats":{"Line":4},"fn_name":null},{"line":100,"address":[146644,146813,146946,146601,146490,146690],"length":1,"stats":{"Line":8},"fn_name":null},{"line":101,"address":[57904,58221,58403],"length":1,"stats":{"Line":8},"fn_name":"{closure#2}"},{"line":102,"address":[57955,58178],"length":1,"stats":{"Line":2},"fn_name":null},{"line":103,"address":[58433,58244,58148],"length":1,"stats":{"Line":4},"fn_name":null},{"line":105,"address":[58508,58496],"length":1,"stats":{"Line":6},"fn_name":"{closure#3}"},{"line":107,"address":[146914],"length":1,"stats":{"Line":0},"fn_name":null},{"line":109,"address":[147026],"length":1,"stats":{"Line":2},"fn_name":null},{"line":111,"address":[147128],"length":1,"stats":{"Line":2},"fn_name":null},{"line":114,"address":[147296,150196],"length":1,"stats":{"Line":2},"fn_name":"next_states"},{"line":115,"address":[147335],"length":1,"stats":{"Line":2},"fn_name":null},{"line":116,"address":[147525,147372,147409],"length":1,"stats":{"Line":6},"fn_name":null},{"line":117,"address":[147569,147386],"length":1,"stats":{"Line":4},"fn_name":null},{"line":118,"address":[147852,147538,147653],"length":1,"stats":{"Line":6},"fn_name":null},{"line":119,"address":[147876],"length":1,"stats":{"Line":2},"fn_name":null},{"line":120,"address":[148097],"length":1,"stats":{"Line":2},"fn_name":null},{"line":121,"address":[148255,148478],"length":1,"stats":{"Line":4},"fn_name":null},{"line":122,"address":[148499],"length":1,"stats":{"Line":2},"fn_name":null},{"line":123,"address":[148522],"length":1,"stats":{"Line":2},"fn_name":null},{"line":124,"address":[148529,148661],"length":1,"stats":{"Line":2},"fn_name":null},{"line":125,"address":[148694,148639],"length":1,"stats":{"Line":3},"fn_name":null},{"line":126,"address":[148719],"length":1,"stats":{"Line":1},"fn_name":null},{"line":127,"address":[148839],"length":1,"stats":{"Line":1},"fn_name":null},{"line":130,"address":[148898,148436],"length":1,"stats":{"Line":2},"fn_name":null},{"line":131,"address":[149100],"length":1,"stats":{"Line":2},"fn_name":null},{"line":132,"address":[149303],"length":1,"stats":{"Line":2},"fn_name":null},{"line":133,"address":[149464],"length":1,"stats":{"Line":2},"fn_name":null},{"line":134,"address":[149545],"length":1,"stats":{"Line":2},"fn_name":null},{"line":135,"address":[149720],"length":1,"stats":{"Line":2},"fn_name":null},{"line":136,"address":[149743],"length":1,"stats":{"Line":2},"fn_name":null},{"line":137,"address":[149884,149750],"length":1,"stats":{"Line":2},"fn_name":null},{"line":138,"address":[149915,150008,149863],"length":1,"stats":{"Line":4},"fn_name":null},{"line":139,"address":[150038,149992],"length":1,"stats":{"Line":4},"fn_name":null},{"line":140,"address":[150060],"length":1,"stats":{"Line":1},"fn_name":null},{"line":141,"address":[150159],"length":1,"stats":{"Line":1},"fn_name":null},{"line":150,"address":[150240],"length":1,"stats":{"Line":2},"fn_name":"is_valid"},{"line":151,"address":[150260,150399],"length":1,"stats":{"Line":4},"fn_name":null},{"line":152,"address":[150420],"length":1,"stats":{"Line":2},"fn_name":null},{"line":153,"address":[150550],"length":1,"stats":{"Line":2},"fn_name":null},{"line":154,"address":[150730],"length":1,"stats":{"Line":2},"fn_name":null},{"line":155,"address":[150740],"length":1,"stats":{"Line":2},"fn_name":null},{"line":158,"address":[150389],"length":1,"stats":{"Line":1},"fn_name":null},{"line":161,"address":[150896],"length":1,"stats":{"Line":2},"fn_name":"is_done"},{"line":162,"address":[150910,150965],"length":1,"stats":{"Line":4},"fn_name":null},{"line":163,"address":[150935],"length":1,"stats":{"Line":2},"fn_name":null},{"line":164,"address":[58576,58590],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":167,"address":[151008],"length":1,"stats":{"Line":2},"fn_name":"compact"},{"line":168,"address":[151031],"length":1,"stats":{"Line":2},"fn_name":null},{"line":169,"address":[151279,151653,151043],"length":1,"stats":{"Line":6},"fn_name":null},{"line":170,"address":[151360,151307],"length":1,"stats":{"Line":2},"fn_name":null},{"line":171,"address":[151341,151395],"length":1,"stats":{"Line":4},"fn_name":null},{"line":172,"address":[151490,151403],"length":1,"stats":{"Line":2},"fn_name":null},{"line":173,"address":[151524,151549,151464],"length":1,"stats":{"Line":4},"fn_name":null},{"line":174,"address":[151584,151530],"length":1,"stats":{"Line":4},"fn_name":null},{"line":175,"address":[151592,151658],"length":1,"stats":{"Line":2},"fn_name":null},{"line":177,"address":[151717,151692,151254],"length":1,"stats":{"Line":4},"fn_name":null},{"line":178,"address":[151698,151760],"length":1,"stats":{"Line":4},"fn_name":null},{"line":179,"address":[151768],"length":1,"stats":{"Line":2},"fn_name":null},{"line":180,"address":[151861,151812],"length":1,"stats":{"Line":2},"fn_name":null},{"line":181,"address":[151842,151904],"length":1,"stats":{"Line":4},"fn_name":null},{"line":182,"address":[152001,151912],"length":1,"stats":{"Line":2},"fn_name":null},{"line":189,"address":[152032],"length":1,"stats":{"Line":2},"fn_name":"expand"},{"line":190,"address":[152057],"length":1,"stats":{"Line":2},"fn_name":null},{"line":191,"address":[152125,152062],"length":1,"stats":{"Line":2},"fn_name":null},{"line":192,"address":[152109,152160],"length":1,"stats":{"Line":4},"fn_name":null},{"line":193,"address":[152165],"length":1,"stats":{"Line":2},"fn_name":null},{"line":194,"address":[152191],"length":1,"stats":{"Line":2},"fn_name":null},{"line":195,"address":[58656,58916],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":196,"address":[58674,58741],"length":1,"stats":{"Line":2},"fn_name":null},{"line":197,"address":[58724,58781],"length":1,"stats":{"Line":4},"fn_name":null},{"line":198,"address":[58854,58787],"length":1,"stats":{"Line":2},"fn_name":null},{"line":199,"address":[58837,58902],"length":1,"stats":{"Line":4},"fn_name":null},{"line":200,"address":[58908],"length":1,"stats":{"Line":2},"fn_name":null},{"line":202,"address":[152307,152426],"length":1,"stats":{"Line":2},"fn_name":null},{"line":228,"address":[61600],"length":1,"stats":{"Line":2},"fn_name":"parse"},{"line":229,"address":[62017,61659],"length":1,"stats":{"Line":2},"fn_name":null},{"line":231,"address":[239006,238880,238909],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":232,"address":[239024,238919,239287,238981],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":233,"address":[239075],"length":1,"stats":{"Line":2},"fn_name":null},{"line":234,"address":[239092,239300,239476],"length":1,"stats":{"Line":4},"fn_name":null},{"line":235,"address":[239145],"length":1,"stats":{"Line":2},"fn_name":null},{"line":236,"address":[239168],"length":1,"stats":{"Line":2},"fn_name":null},{"line":237,"address":[239191],"length":1,"stats":{"Line":2},"fn_name":null},{"line":238,"address":[239214],"length":1,"stats":{"Line":2},"fn_name":null},{"line":239,"address":[239242,239133],"length":1,"stats":{"Line":0},"fn_name":null},{"line":241,"address":[239501,239369],"length":1,"stats":{"Line":4},"fn_name":null},{"line":242,"address":[239616,240105,240049,239851],"length":1,"stats":{"Line":8},"fn_name":"{closure#0}"},{"line":243,"address":[239662,239860,239932],"length":1,"stats":{"Line":4},"fn_name":null},{"line":244,"address":[239909,240062],"length":1,"stats":{"Line":4},"fn_name":null},{"line":246,"address":[241098,241243,241275,240636,240112],"length":1,"stats":{"Line":5},"fn_name":"{closure#1}"},{"line":247,"address":[240385,240158,240516],"length":1,"stats":{"Line":3},"fn_name":null},{"line":248,"address":[240893,240698,240975,240481],"length":1,"stats":{"Line":3},"fn_name":null},{"line":249,"address":[240956,241110],"length":1,"stats":{"Line":2},"fn_name":null},{"line":251,"address":[243044,242827,241296,243067,241828],"length":1,"stats":{"Line":3},"fn_name":"{closure#2}"},{"line":252,"address":[241342,241708,241577],"length":1,"stats":{"Line":2},"fn_name":null},{"line":253,"address":[241673,241890,242226,242088],"length":1,"stats":{"Line":3},"fn_name":null},{"line":254,"address":[242191,242424,242622,242704],"length":1,"stats":{"Line":3},"fn_name":null},{"line":255,"address":[242839,242685],"length":1,"stats":{"Line":2},"fn_name":null},{"line":257,"address":[243120,244876,244896,243656,245503],"length":1,"stats":{"Line":0},"fn_name":"{closure#3}"},{"line":258,"address":[243412,243166,243536],"length":1,"stats":{"Line":0},"fn_name":null},{"line":259,"address":[243707,243516],"length":1,"stats":{"Line":0},"fn_name":null},{"line":260,"address":[245480],"length":1,"stats":{"Line":0},"fn_name":null},{"line":261,"address":[243791,243858],"length":1,"stats":{"Line":0},"fn_name":null},{"line":263,"address":[244176,244314,243935],"length":1,"stats":{"Line":0},"fn_name":null},{"line":264,"address":[244502,244615,244279],"length":1,"stats":{"Line":0},"fn_name":null},{"line":265,"address":[244544],"length":1,"stats":{"Line":0},"fn_name":null},{"line":268,"address":[245317,245145,244936,243900],"length":1,"stats":{"Line":0},"fn_name":null},{"line":269,"address":[245246],"length":1,"stats":{"Line":0},"fn_name":null},{"line":271,"address":[244777],"length":1,"stats":{"Line":0},"fn_name":null},{"line":274,"address":[245765,245614,238961,245704,245536],"length":1,"stats":{"Line":1},"fn_name":"{closure#1}"},{"line":275,"address":[245730,245579,245640],"length":1,"stats":{"Line":0},"fn_name":null},{"line":277,"address":[61854],"length":1,"stats":{"Line":2},"fn_name":null},{"line":282,"address":[62048],"length":1,"stats":{"Line":2},"fn_name":"from_parser"},{"line":283,"address":[62066],"length":1,"stats":{"Line":2},"fn_name":null},{"line":284,"address":[245936,246222,246508],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":285,"address":[245982,246114],"length":1,"stats":{"Line":2},"fn_name":null},{"line":286,"address":[246317,246230,246082],"length":1,"stats":{"Line":5},"fn_name":null},{"line":287,"address":[246296,246447],"length":1,"stats":{"Line":2},"fn_name":null},{"line":289,"address":[246814,246528,247100],"length":1,"stats":{"Line":3},"fn_name":"{closure#1}"},{"line":290,"address":[246574,246706],"length":1,"stats":{"Line":1},"fn_name":null},{"line":291,"address":[246674,246822,246909],"length":1,"stats":{"Line":2},"fn_name":null},{"line":292,"address":[246888,247039],"length":1,"stats":{"Line":2},"fn_name":null},{"line":328,"address":[130645,126064,132050],"length":1,"stats":{"Line":0},"fn_name":"corpus_gen"},{"line":329,"address":[126322,126079,126178],"length":1,"stats":{"Line":0},"fn_name":null},{"line":330,"address":[126524,126252],"length":1,"stats":{"Line":0},"fn_name":null},{"line":333,"address":[126668],"length":1,"stats":{"Line":0},"fn_name":null},{"line":334,"address":[249886],"length":1,"stats":{"Line":0},"fn_name":null},{"line":335,"address":[249964,249901],"length":1,"stats":{"Line":0},"fn_name":null},{"line":336,"address":[250069],"length":1,"stats":{"Line":0},"fn_name":null},{"line":337,"address":[250074,250247],"length":1,"stats":{"Line":0},"fn_name":null},{"line":338,"address":[250301,250221],"length":1,"stats":{"Line":0},"fn_name":null},{"line":339,"address":[250366],"length":1,"stats":{"Line":0},"fn_name":null},{"line":340,"address":[250391],"length":1,"stats":{"Line":0},"fn_name":null},{"line":342,"address":[249982],"length":1,"stats":{"Line":0},"fn_name":null},{"line":344,"address":[126759],"length":1,"stats":{"Line":0},"fn_name":null},{"line":348,"address":[126809],"length":1,"stats":{"Line":0},"fn_name":null},{"line":349,"address":[250463],"length":1,"stats":{"Line":0},"fn_name":null},{"line":350,"address":[250619,250468],"length":1,"stats":{"Line":0},"fn_name":null},{"line":351,"address":[250783,250658,250588],"length":1,"stats":{"Line":0},"fn_name":null},{"line":355,"address":[126959],"length":1,"stats":{"Line":0},"fn_name":null},{"line":356,"address":[127357,127016,127078],"length":1,"stats":{"Line":0},"fn_name":null},{"line":357,"address":[127378],"length":1,"stats":{"Line":0},"fn_name":null},{"line":358,"address":[127820],"length":1,"stats":{"Line":0},"fn_name":null},{"line":359,"address":[127397,127492,127622,127657],"length":1,"stats":{"Line":0},"fn_name":null},{"line":360,"address":[127559],"length":1,"stats":{"Line":0},"fn_name":null},{"line":361,"address":[127637],"length":1,"stats":{"Line":0},"fn_name":null},{"line":362,"address":[127871],"length":1,"stats":{"Line":0},"fn_name":null},{"line":363,"address":[127902],"length":1,"stats":{"Line":0},"fn_name":null},{"line":365,"address":[127889],"length":1,"stats":{"Line":0},"fn_name":null},{"line":366,"address":[128097],"length":1,"stats":{"Line":0},"fn_name":null},{"line":369,"address":[127768],"length":1,"stats":{"Line":0},"fn_name":null},{"line":370,"address":[128322],"length":1,"stats":{"Line":0},"fn_name":null},{"line":373,"address":[128440],"length":1,"stats":{"Line":0},"fn_name":null},{"line":374,"address":[128509],"length":1,"stats":{"Line":0},"fn_name":null},{"line":376,"address":[128479,128714],"length":1,"stats":{"Line":0},"fn_name":null},{"line":377,"address":[128720,130455],"length":1,"stats":{"Line":0},"fn_name":null},{"line":378,"address":[130409],"length":1,"stats":{"Line":0},"fn_name":null},{"line":379,"address":[128758],"length":1,"stats":{"Line":0},"fn_name":null},{"line":380,"address":[128799,130037,130143],"length":1,"stats":{"Line":0},"fn_name":null},{"line":381,"address":[129991,130096],"length":1,"stats":{"Line":0},"fn_name":null},{"line":383,"address":[128837],"length":1,"stats":{"Line":0},"fn_name":null},{"line":384,"address":[129145,129487],"length":1,"stats":{"Line":0},"fn_name":null},{"line":385,"address":[129503],"length":1,"stats":{"Line":0},"fn_name":null},{"line":387,"address":[129457,129687],"length":1,"stats":{"Line":0},"fn_name":null},{"line":390,"address":[127327,130731,130775],"length":1,"stats":{"Line":0},"fn_name":null},{"line":392,"address":[130656],"length":1,"stats":{"Line":0},"fn_name":null},{"line":393,"address":[130743],"length":1,"stats":{"Line":0},"fn_name":null},{"line":396,"address":[130905],"length":1,"stats":{"Line":0},"fn_name":null},{"line":397,"address":[130973,131049],"length":1,"stats":{"Line":0},"fn_name":null},{"line":398,"address":[131084],"length":1,"stats":{"Line":0},"fn_name":null},{"line":399,"address":[131106],"length":1,"stats":{"Line":0},"fn_name":null},{"line":400,"address":[131203,131333],"length":1,"stats":{"Line":0},"fn_name":null},{"line":401,"address":[131340],"length":1,"stats":{"Line":0},"fn_name":null},{"line":402,"address":[131453,131501],"length":1,"stats":{"Line":0},"fn_name":null},{"line":403,"address":[131509],"length":1,"stats":{"Line":0},"fn_name":null},{"line":404,"address":[131610],"length":1,"stats":{"Line":0},"fn_name":null},{"line":405,"address":[131797,131718],"length":1,"stats":{"Line":0},"fn_name":null},{"line":407,"address":[126626],"length":1,"stats":{"Line":0},"fn_name":null},{"line":432,"address":[100563,100000,100609],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":433,"address":[100007],"length":1,"stats":{"Line":1},"fn_name":null},{"line":434,"address":[100030,100170,100104],"length":1,"stats":{"Line":3},"fn_name":null},{"line":438,"address":[101203,101249,100640],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":439,"address":[100647],"length":1,"stats":{"Line":1},"fn_name":null},{"line":440,"address":[100670,100744,100810],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":159,"coverable":230},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-12","src","lib.rs"],"content":"//! Advent of Code 2016: Day 12: Leonardo's Monorail\n//!\n//! [https://adventofcode.com/2016/day/12](https://adventofcode.com/2016/day/12)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\nuse aoc_2016_cpu as cpu;\n\npuzzle_info! {\n\tname = \"Leonardo's Monorail\";\n\tyear = 2016;\n\tday = 12;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse cpu::Cpu;\n\tuse model::Input;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003ci32\u003e {\n\t\tlet mut cpu = Cpu {\n\t\t\tinstrs: Rc::new (input.instrs.clone ()),\n\t\t\tlimit: input.ops_limit,\n\t\t\t.. Cpu::default ()\n\t\t};\n\t\tcpu.exec () ?;\n\t\tOk (cpu.reg_a)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003ci32\u003e {\n\t\tlet mut cpu = Cpu {\n\t\t\tinstrs: Rc::new (input.instrs.clone ()),\n\t\t\treg_c: 1,\n\t\t\tlimit: input.ops_limit,\n\t\t\t.. Cpu::default ()\n\t\t};\n\t\tcpu.exec () ?;\n\t\tOk (cpu.reg_a)\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse cpu::Instr as Instr;\n\tuse parser::*;\n\n\t#[ derive (Clone, Debug, Default, Eq, PartialEq) ]\n\tpub struct Input {\n\t\tpub instrs: Vec \u003cInstr\u003e,\n\t\tpub ops_limit: u32,\n\t}\n\n\timpl Input {\n\t\tpub fn parse (mut input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet ops_limit = parser::input_param (\u0026 mut input, \"OPS_LIMIT=\", 100_000_000_u32) ?;\n\t\t\t#[ allow (clippy::redundant_closure_for_method_calls) ]\n\t\t\tlet instrs = input.iter ()\n\t\t\t\t.enumerate ()\n\t\t\t\t.map (|(line_idx, line)|\n\t\t\t\t\tParser::wrap (line, |parser| {\n\t\t\t\t\t\tlet instr: Instr = parser.item () ?;\n\t\t\t\t\t\tif ! instr.is_v1 () { return Err (parser.err ()) }\n\t\t\t\t\t\tOk (instr)\n\t\t\t\t\t}).map_parse_err (|col_idx|\n\t\t\t\t\t\tformat! (\"Invalid input: line {}: col {}: {}\",\n\t\t\t\t\t\t\tline_idx + 1, col_idx + 1, line)))\n\t\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e () ?;\n\t\t\tOk (Self { instrs, ops_limit })\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"cpy 41 a\",\n\t\t\"inc a\",\n\t\t\"inc a\",\n\t\t\"dec a\",\n\t\t\"jnz a 2\",\n\t\t\"dec a\",\n\t\t\"dec c\",\n\t\t\"jnz c 3\",\n\t\t\"dec a\",\n\t\t\"dec a\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"42\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"40\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":14,"address":[60387,61075],"length":1,"stats":{"Line":2},"fn_name":null},{"line":15,"address":[60493],"length":1,"stats":{"Line":1},"fn_name":null},{"line":16,"address":[61181],"length":1,"stats":{"Line":1},"fn_name":null},{"line":25,"address":[61776,61972],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":27,"address":[61806],"length":1,"stats":{"Line":1},"fn_name":null},{"line":28,"address":[61838],"length":1,"stats":{"Line":1},"fn_name":null},{"line":31,"address":[62165,62036],"length":1,"stats":{"Line":1},"fn_name":null},{"line":32,"address":[62134],"length":1,"stats":{"Line":1},"fn_name":null},{"line":35,"address":[62468,62272],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":37,"address":[62302],"length":1,"stats":{"Line":1},"fn_name":null},{"line":39,"address":[62334],"length":1,"stats":{"Line":1},"fn_name":null},{"line":42,"address":[62532,62661],"length":1,"stats":{"Line":1},"fn_name":null},{"line":43,"address":[62630],"length":1,"stats":{"Line":1},"fn_name":null},{"line":61,"address":[28704],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":62,"address":[28731,28849],"length":1,"stats":{"Line":1},"fn_name":null},{"line":64,"address":[28816,28912,29297],"length":1,"stats":{"Line":2},"fn_name":null},{"line":66,"address":[34416,34525,34444],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":67,"address":[34544,34944,34500,34454,34844],"length":1,"stats":{"Line":5},"fn_name":"{closure#0}"},{"line":68,"address":[34590,34729],"length":1,"stats":{"Line":1},"fn_name":null},{"line":69,"address":[34856,34704,34951],"length":1,"stats":{"Line":2},"fn_name":null},{"line":70,"address":[34867],"length":1,"stats":{"Line":1},"fn_name":null},{"line":71,"address":[35405,34480,35024],"length":1,"stats":{"Line":1},"fn_name":"{closure#1}"},{"line":72,"address":[35102,35253,35192],"length":1,"stats":{"Line":0},"fn_name":null},{"line":73,"address":[35128,35067,35218],"length":1,"stats":{"Line":0},"fn_name":null},{"line":75,"address":[29106],"length":1,"stats":{"Line":1},"fn_name":null},{"line":100,"address":[24128,24133],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":101,"address":[52295],"length":1,"stats":{"Line":1},"fn_name":null},{"line":102,"address":[52318,52392,52458],"length":1,"stats":{"Line":3},"fn_name":null},{"line":106,"address":[24160,24165],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":107,"address":[52935],"length":1,"stats":{"Line":1},"fn_name":null},{"line":108,"address":[53098,52958,53032],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":29,"coverable":31},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-13","src","lib.rs"],"content":"//! Advent of Code 2016: Day 13: A Maze of Twisty Little Cubicles\n//!\n//! [https://adventofcode.com/2016/day/13](https://adventofcode.com/2016/day/13)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\nuse aoc_pos as pos;\n\npuzzle_info! {\n\tname = \"A Maze of Twisty Little Cubicles\";\n\tyear = 2016;\n\tday = 13;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\tuse model::Pos;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cu32\u003e {\n\t\tlet mut todo = VecDeque::new ();\n\t\ttodo.push_back ((input.start, 0_u32));\n\t\tlet mut seen = HashSet::new ();\n\t\tseen.insert (input.start);\n\t\twhile let Some ((pos, dist)) = todo.pop_front () {\n\t\t\tif dist \u003e input.max_dist { break }\n\t\t\tif pos == input.end { return Ok (dist) }\n\t\t\tfor adj_pos in pos.adjacent_4 () {\n\t\t\t\tif ! seen.insert (adj_pos) { continue }\n\t\t\t\tlet Pos { x, y } = adj_pos;\n\t\t\t\tif (x*x + 3*x + 2*x*y + y + y*y + input.seed).count_ones () \u0026 1 == 1 { continue }\n\t\t\t\ttodo.push_back ((adj_pos, dist + 1));\n\t\t\t}\n\t\t}\n\t\tErr (\"No solution found\".into ())\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cu32\u003e {\n\t\tlet mut todo = VecDeque::new ();\n\t\ttodo.push_back ((input.start, 0_u32));\n\t\tlet mut seen = HashSet::new ();\n\t\tseen.insert (input.start);\n\t\tlet mut posns = 0;\n\t\twhile let Some ((pos, dist)) = todo.pop_front () {\n\t\t\tif dist \u003e input.count_dist { break }\n\t\t\tposns += 1;\n\t\t\tfor adj_pos in pos.adjacent_4 () {\n\t\t\t\tif ! seen.insert (adj_pos) { continue }\n\t\t\t\tlet Pos { x, y } = adj_pos;\n\t\t\t\tif (x*x + 3*x + 2*x*y + y + y*y + input.seed).count_ones () \u0026 1 == 1 { continue }\n\t\t\t\ttodo.push_back ((adj_pos, dist + 1));\n\t\t\t}\n\t\t}\n\t\tOk (posns)\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse parser::*;\n\n\tpub type Coord = u32;\n\tpub type Pos = pos::PosXY \u003cCoord\u003e;\n\n\t#[ derive (Clone, Debug, Default, Eq, PartialEq) ]\n\tpub struct Input {\n\t\tpub seed: u32,\n\t\tpub start: Pos,\n\t\tpub end: Pos,\n\t\tpub max_dist: u32,\n\t\tpub count_dist: u32,\n\t}\n\n\timpl Input {\n\t\tpub fn parse (mut input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet start_x = parser::input_param (\u0026 mut input, \"START_X=\", 1_u32) ?;\n\t\t\tlet start_y = parser::input_param (\u0026 mut input, \"START_Y=\", 1_u32) ?;\n\t\t\tlet start = Pos { x: start_x, y: start_y };\n\t\t\tlet end_x = parser::input_param (\u0026 mut input, \"END_X=\", 31_u32) ?;\n\t\t\tlet end_y = parser::input_param (\u0026 mut input, \"END_Y=\", 39_u32) ?;\n\t\t\tlet end = Pos { x: end_x, y: end_y };\n\t\t\tlet max_dist = parser::input_param (\u0026 mut input, \"MAX_DIST=\", 100_u32) ?;\n\t\t\tlet count_dist = parser::input_param (\u0026 mut input, \"COUNT_DIST=\", 50_u32) ?;\n\t\t\tif input.len () != 1 { return Err (\"Input must be one line only\".into ()) }\n\t\t\tlet seed =\n\t\t\t\tParser::wrap (input [0],\n\t\t\t\t\t|parser| {\n\t\t\t\t\t\tlet seed = parser.int () ?;\n\t\t\t\t\t\tparser.end () ?;\n\t\t\t\t\t\tOk (seed)\n\t\t\t\t\t}).map_parse_err (|col_idx|\n\t\t\t\t\t\tformat! (\"Invalid input: {}: {}\", col_idx + 1, input [0])) ?;\n\t\t\tOk (Self { seed, start, end, max_dist, count_dist })\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [ \"END_X=7\", \"END_Y=4\", \"MAX_DIST=20\", \"COUNT_DIST=10\", \"10\" ];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"11\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"18\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":14,"address":[71235,71859],"length":1,"stats":{"Line":2},"fn_name":null},{"line":15,"address":[71375],"length":1,"stats":{"Line":1},"fn_name":null},{"line":16,"address":[71999],"length":1,"stats":{"Line":1},"fn_name":null},{"line":25,"address":[74443,72944],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":26,"address":[72974],"length":1,"stats":{"Line":1},"fn_name":null},{"line":27,"address":[72989],"length":1,"stats":{"Line":1},"fn_name":null},{"line":28,"address":[73085],"length":1,"stats":{"Line":1},"fn_name":null},{"line":29,"address":[73155,73097],"length":1,"stats":{"Line":2},"fn_name":null},{"line":30,"address":[73170],"length":1,"stats":{"Line":1},"fn_name":null},{"line":31,"address":[73241],"length":1,"stats":{"Line":1},"fn_name":null},{"line":32,"address":[73416,73284,73378],"length":1,"stats":{"Line":3},"fn_name":null},{"line":33,"address":[73400,73468],"length":1,"stats":{"Line":2},"fn_name":null},{"line":34,"address":[73644],"length":1,"stats":{"Line":1},"fn_name":null},{"line":35,"address":[73677],"length":1,"stats":{"Line":1},"fn_name":null},{"line":36,"address":[74285,73691],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[74338],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[73246,73322],"length":1,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[75937,74480],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":44,"address":[74510],"length":1,"stats":{"Line":1},"fn_name":null},{"line":45,"address":[74525],"length":1,"stats":{"Line":1},"fn_name":null},{"line":46,"address":[74621],"length":1,"stats":{"Line":1},"fn_name":null},{"line":47,"address":[74633],"length":1,"stats":{"Line":1},"fn_name":null},{"line":48,"address":[74691],"length":1,"stats":{"Line":1},"fn_name":null},{"line":49,"address":[74715],"length":1,"stats":{"Line":1},"fn_name":null},{"line":50,"address":[74786],"length":1,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[74827,74877,74907],"length":1,"stats":{"Line":2},"fn_name":null},{"line":52,"address":[74955,74900],"length":1,"stats":{"Line":2},"fn_name":null},{"line":53,"address":[75131],"length":1,"stats":{"Line":1},"fn_name":null},{"line":54,"address":[75164],"length":1,"stats":{"Line":1},"fn_name":null},{"line":55,"address":[75178,75779],"length":1,"stats":{"Line":1},"fn_name":null},{"line":56,"address":[75832],"length":1,"stats":{"Line":1},"fn_name":null},{"line":59,"address":[74796],"length":1,"stats":{"Line":1},"fn_name":null},{"line":82,"address":[49040],"length":1,"stats":{"Line":2},"fn_name":"parse"},{"line":83,"address":[49067,49195],"length":1,"stats":{"Line":2},"fn_name":null},{"line":84,"address":[49152,49248,49369],"length":1,"stats":{"Line":4},"fn_name":null},{"line":85,"address":[49312],"length":1,"stats":{"Line":2},"fn_name":null},{"line":86,"address":[49525,49418,49326],"length":1,"stats":{"Line":4},"fn_name":null},{"line":87,"address":[49574,49695,49482],"length":1,"stats":{"Line":4},"fn_name":null},{"line":88,"address":[49638],"length":1,"stats":{"Line":2},"fn_name":null},{"line":89,"address":[49744,49851,49652],"length":1,"stats":{"Line":4},"fn_name":null},{"line":90,"address":[49900,49808,49979],"length":1,"stats":{"Line":4},"fn_name":null},{"line":91,"address":[50052,49964],"length":1,"stats":{"Line":2},"fn_name":null},{"line":92,"address":[50028,50114,50194,50486],"length":1,"stats":{"Line":6},"fn_name":null},{"line":94,"address":[21797,21871,21568],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":95,"address":[21701,21614],"length":1,"stats":{"Line":2},"fn_name":null},{"line":96,"address":[21681,21878,21805],"length":1,"stats":{"Line":4},"fn_name":null},{"line":97,"address":[21862],"length":1,"stats":{"Line":2},"fn_name":null},{"line":98,"address":[50168],"length":1,"stats":{"Line":2},"fn_name":null},{"line":99,"address":[22038],"length":1,"stats":{"Line":0},"fn_name":null},{"line":100,"address":[50310],"length":1,"stats":{"Line":2},"fn_name":null},{"line":114,"address":[28560,29123,29169],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":115,"address":[28567],"length":1,"stats":{"Line":1},"fn_name":null},{"line":116,"address":[28590,28664,28730],"length":1,"stats":{"Line":3},"fn_name":null},{"line":120,"address":[29809,29763,29200],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":121,"address":[29207],"length":1,"stats":{"Line":1},"fn_name":null},{"line":122,"address":[29370,29230,29304],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":54,"coverable":56},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-14","src","lib.rs"],"content":"//! Advent of Code 2016: Day 14: One-Time Pad\n//!\n//! [https://adventofcode.com/2016/day/14](https://adventofcode.com/2016/day/14)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\nuse aoc_md5 as md5;\n\npuzzle_info! {\n\tname = \"One-Time Pad\";\n\tyear = 2016;\n\tday = 14;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cu32\u003e {\n\t\tOk (KeyIndexIter::new (input, 0)\n\t\t\t.nth (input.num_keys.as_usize () - 1)\n\t\t\t.unwrap ())\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cu32\u003e {\n\t\tOk (KeyIndexIter::new (input, input.hash_reps)\n\t\t\t.nth (input.num_keys.as_usize () - 1)\n\t\t\t.unwrap ())\n\t}\n\n\tstruct KeyIndexIter {\n\t\thashes: MultiPeek \u003cHashesIter\u003e,\n\t\tidx: u32,\n\t\tnum_next: u32,\n\t}\n\n\timpl KeyIndexIter {\n\n\t\t#[ inline ]\n\t\tfn new (input: \u0026 Input, hash_reps: u32) -\u003e Self {\n\t\t\tSelf {\n\t\t\t\thashes: HashesIter::new (input, hash_reps).multipeek (),\n\t\t\t\tidx: 0,\n\t\t\t\tnum_next: input.num_next,\n\t\t\t}\n\t\t}\n\n\t}\n\n\timpl Iterator for KeyIndexIter {\n\n\t\ttype Item = u32;\n\n\t\t#[ inline ]\n\t\tfn next (\u0026 mut self) -\u003e Option \u003cu32\u003e {\n\t\t\tloop {\n\t\t\t\tlet hash_0 = self.hashes.next ().unwrap ();\n\t\t\t\tif let Some (ch_0) = find_triple (\u0026 hash_0) {\n\t\t\t\t\tfor _ in 0 .. self.num_next.as_usize () {\n\t\t\t\t\t\tif ! has_quintuple (self.hashes.peek ().unwrap (), ch_0) { continue }\n\t\t\t\t\t\tself.idx += 1;\n\t\t\t\t\t\treturn Some (self.idx - 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tself.idx += 1;\n\t\t\t}\n\t\t}\n\n\t}\n\n\tfn find_triple (hash: \u0026 [u8; 32]) -\u003e Option \u003cu8\u003e {\n\t\thash.iter_vals ()\n\t\t\t.tuple_windows::\u003c(_, _, _)\u003e ()\n\t\t\t.filter (|\u0026 (a, b, c)| a == b \u0026\u0026 a == c)\n\t\t\t.map (|(a, _, _)| a)\n\t\t\t.next ()\n\t}\n\n\tfn has_quintuple (hash: \u0026 [u8; 32], ch_0: u8) -\u003e bool {\n\t\thash.iter_vals ()\n\t\t\t.fold ((false, 0_u32), |(matched, count), ch_1|\n\t\t\t\tif matched || (ch_0 == ch_1 \u0026\u0026 count == 4){ (true, 0) }\n\t\t\t\telse if ch_0 == ch_1 { (false, count + 1) }\n\t\t\t\telse { (false, 0) }\n\t\t\t).0\n\t}\n\n\tstruct HashesIter {\n\t\tbuffer: String,\n\t\tsalt_len: usize,\n\t\tidx: u32,\n\t\thash_reps: u32,\n\t}\n\n\timpl HashesIter {\n\n\t\t#[ inline ]\n\t\tfn new (input: \u0026 Input, hash_reps: u32) -\u003e Self {\n\t\t\tSelf {\n\t\t\t\tbuffer: input.salt.clone (),\n\t\t\t\tsalt_len: input.salt.len (),\n\t\t\t\tidx: 0,\n\t\t\t\thash_reps,\n\t\t\t}\n\t\t}\n\n\t}\n\n\timpl Iterator for HashesIter {\n\n\t\ttype Item = [u8; 32];\n\n\t\t#[ inline ]\n\t\tfn next (\u0026 mut self) -\u003e Option \u003c[u8; 32]\u003e {\n\t\t\tself.buffer.truncate (self.salt_len);\n\t\t\twrite! (\u0026 mut self.buffer, \"{}\", self.idx).unwrap ();\n\t\t\tself.idx += 1;\n\t\t\tSome (stretched_hash (\u0026 self.buffer, self.hash_reps))\n\t\t}\n\n\t}\n\n\t#[ inline ]\n\tfn stretched_hash (input: \u0026 str, hash_reps: u32) -\u003e [u8; 32] {\n\t\tlet mut hasher = md5::MD5::new ();\n\t\thasher.update (input.as_bytes ());\n\t\tlet mut hash = hasher.finish_reset ();\n\t\tfor _ in 0 .. hash_reps {\n\t\t\thasher.update (\u0026 hash.as_hex_bytes ());\n\t\t\thash = hasher.finish_reset ();\n\t\t}\n\t\thash.as_hex_bytes ()\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse parser::*;\n\n\t#[ derive (Clone, Debug, Default, Eq, PartialEq) ]\n\tpub struct Input {\n\t\tpub salt: String,\n\t\tpub num_keys: u32,\n\t\tpub num_next: u32,\n\t\tpub hash_reps: u32,\n\t}\n\n\timpl Input {\n\t\tpub fn parse (mut input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\n\t\t\tlet num_keys = parser::input_param (\u0026 mut input, \"NUM_KEYS=\", 64_u32) ?;\n\t\t\tif num_keys \u003c 1 { return Err (\"Number of keys must be at least one\".into ()) }\n\t\t\tif num_keys \u003e 100 { return Err (\"Number of keys must be 100 or less\".into ()) }\n\n\t\t\tlet num_next = parser::input_param (\u0026 mut input, \"NUM_NEXT=\", 1000_u32) ?;\n\t\t\tif num_next \u003c 1 { return Err (\"Number of next hashes must be at least one\".into ()) }\n\t\t\tif num_next \u003e 2000 { return Err (\"Number of next hashes must be 2000 or less\".into ()) }\n\n\t\t\tlet hash_reps = parser::input_param (\u0026 mut input, \"HASH_REPS=\", 2016_u32) ?;\n\t\t\tif hash_reps \u003c 2 { return Err (\"Hash reps must be at least one\".into ()) }\n\t\t\tif hash_reps \u003e 3000 { return Err (\"Hash reps must be 3000 or less\".into ()) }\n\n\t\t\tif input.len () != 1 { return Err (\"Invalid input: more than one line\".into ()) }\n\n\t\t\tlet salt =\n\t\t\t\tParser::wrap (input [0], |parser| Ok (parser.rest ().to_owned ()))\n\t\t\t\t\t.map_parse_err (|col_idx|\n\t\t\t\t\t\tformat! (\"Invalid input: col {}: {}\", col_idx + 1, input [0])) ?;\n\t\t\tif salt.is_empty () { return Err (\"Salt must be at least one character\".into ()) }\n\n\t\t\tOk (Self { salt, num_keys, num_next, hash_reps })\n\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"NUM_KEYS=16\",\n\t\t\"NUM_NEXT=1000\",\n\t\t\"HASH_REPS=16\",\n\t\t\"abc\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"1144\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"4684\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":14,"address":[34224,34560],"length":1,"stats":{"Line":2},"fn_name":null},{"line":15,"address":[34313],"length":1,"stats":{"Line":1},"fn_name":null},{"line":16,"address":[34649],"length":1,"stats":{"Line":1},"fn_name":null},{"line":24,"address":[24000,24365],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":25,"address":[24232],"length":1,"stats":{"Line":1},"fn_name":null},{"line":26,"address":[24269,24184],"length":1,"stats":{"Line":1},"fn_name":null},{"line":30,"address":[24766,24384],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":31,"address":[24632,24403],"length":1,"stats":{"Line":2},"fn_name":null},{"line":32,"address":[24584,24670],"length":1,"stats":{"Line":1},"fn_name":null},{"line":45,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":47,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":49,"address":[24169,24569],"length":1,"stats":{"Line":2},"fn_name":null},{"line":60,"address":[24784],"length":1,"stats":{"Line":1},"fn_name":"next"},{"line":61,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":63,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":65,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":66,"address":[25377,25297],"length":1,"stats":{"Line":1},"fn_name":null},{"line":67,"address":[25309,25393],"length":1,"stats":{"Line":1},"fn_name":null},{"line":70,"address":[25280,25361],"length":1,"stats":{"Line":1},"fn_name":null},{"line":76,"address":[25536],"length":1,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[41547],"length":1,"stats":{"Line":1},"fn_name":null},{"line":84,"address":[25712],"length":1,"stats":{"Line":0},"fn_name":null},{"line":85,"address":[25264],"length":1,"stats":{"Line":2},"fn_name":null},{"line":86,"address":[42112,42164],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":87,"address":[27757,27880,27750],"length":1,"stats":{"Line":3},"fn_name":null},{"line":88,"address":[27781,27928,27916,27796],"length":1,"stats":{"Line":2},"fn_name":null},{"line":103,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":119,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":120,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":121,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":122,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":123,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":129,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":130,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":131,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":132,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":133,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":134,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":135,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":137,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":156,"address":[38487,37552],"length":1,"stats":{"Line":2},"fn_name":"parse"},{"line":159,"address":[37931],"length":1,"stats":{"Line":2},"fn_name":null},{"line":160,"address":[37937],"length":1,"stats":{"Line":2},"fn_name":null},{"line":163,"address":[37746],"length":1,"stats":{"Line":2},"fn_name":null},{"line":164,"address":[37752],"length":1,"stats":{"Line":2},"fn_name":null},{"line":166,"address":[37778],"length":1,"stats":{"Line":2},"fn_name":null},{"line":167,"address":[37838],"length":1,"stats":{"Line":2},"fn_name":null},{"line":168,"address":[37861],"length":1,"stats":{"Line":2},"fn_name":null},{"line":170,"address":[37963],"length":1,"stats":{"Line":2},"fn_name":null},{"line":172,"address":[19515,19424],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":174,"address":[19568,19703],"length":1,"stats":{"Line":0},"fn_name":"{closure#1}"},{"line":175,"address":[30784,30970],"length":1,"stats":{"Line":0},"fn_name":null},{"line":176,"address":[38395,38327],"length":1,"stats":{"Line":2},"fn_name":null},{"line":178,"address":[38329],"length":1,"stats":{"Line":2},"fn_name":null},{"line":198,"address":[13696],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":199,"address":[29292],"length":1,"stats":{"Line":1},"fn_name":null},{"line":200,"address":[29648,29468,29313,29393,29345,29576],"length":1,"stats":{"Line":3},"fn_name":null},{"line":204,"address":[13712],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":205,"address":[29708],"length":1,"stats":{"Line":1},"fn_name":null},{"line":206,"address":[29729,29992,30064,29761,29809,29884],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":47,"coverable":64},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-15","src","lib.rs"],"content":"//! Advent of Code 2016: Day 15: Timing is Everything\n//!\n//! [https://adventofcode.com/2016/day/15](https://adventofcode.com/2016/day/15)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Timing is Everything\";\n\tyear = 2016;\n\tday = 15;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Disc;\n\tuse model::Input;\n\n\t/// Implementation for part one\n\t///\n\t/// Simply calls [`calc_result`].\n\t///\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cu64\u003e {\n\t\tcalc_result (input)\n\t}\n\n\t/// Implementation for part two\n\t///\n\t/// Modifies the provided [`Input`] to add one extra disc with `11` positions starting at\n\t/// position `0`. Then hands over to [`calc_result`] for the main logic.\n\t///\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cu64\u003e {\n\t\tlet input = Input {\n\t\t\tdiscs: input.discs.iter ().cloned ()\n\t\t\t\t.chain (iter::once (Disc {\n\t\t\t\t\tdelay: input.discs.len ().as_u8 () + 1,\n\t\t\t\t\tnum_posns: 11,\n\t\t\t\t\tstart_pos: 0,\n\t\t\t\t}))\n\t\t\t\t.collect (),\n\t\t};\n\t\tcalc_result (\u0026 input)\n\t}\n\n\t/// Main logic for both parts, take a list of discs and calculate the start time\n\t///\n\t/// We iterate over each disc, finding the first start time at which all discs up to this point\n\t/// will be in the right positions. We start off with start time zero and add one each time,\n\t/// but we also increase the stepping each time to the lowest common multiplier of all discs so\n\t/// far.\n\t/// \n\tfn calc_result (input: \u0026 Input) -\u003e GenResult \u003cu64\u003e {\n\t\tlet (time, _) = input.discs.iter ()\n\t\t\t.fold (Ok ((0_u64, 1_u64)), |state, disc|\n\t\t\t\tstate.and_then (|(time, step)| Ok::\u003c_, GenError\u003e ((\n\t\t\t\t\t(time .. )\n\t\t\t\t\t\t.step_by (step.as_usize ())\n\t\t\t\t\t\t.take (disc.num_posns.as_usize ())\n\t\t\t\t\t\t.find (|time|\n\t\t\t\t\t\t\t(time + disc.delay.as_u64 () + disc.start_pos.as_u64 ())\n\t\t\t\t\t\t\t\t% disc.num_posns.as_u64 () == 0)\n\t\t\t\t\t\t.ok_or (\"No solution found\") ?,\n\t\t\t\t\t(step .. )\n\t\t\t\t\t\t.step_by (step.as_usize ())\n\t\t\t\t\t\t.find (|step| step % disc.num_posns.as_u64 () == 0)\n\t\t\t\t\t\t.unwrap (),\n\t\t\t\t)))) ?;\n\t\tOk (time)\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse parser::*;\n\n\t#[ derive (Clone, Debug, Default, Eq, PartialEq) ]\n\tpub struct Input {\n\t\tpub discs: Vec \u003cDisc\u003e\n\t}\n\n\t#[ derive (Clone, Debug, Default, Eq, PartialEq) ]\n\tpub struct Disc {\n\t\tpub delay: u8,\n\t\tpub num_posns: u8,\n\t\tpub start_pos: u8,\n\t}\n\n\timpl Input {\n\t\tpub fn parse (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\t#[ allow (clippy::redundant_closure_for_method_calls) ]\n\t\t\tlet discs: Vec \u003cDisc\u003e = input.iter ()\n\t\t\t\t.enumerate ()\n\t\t\t\t.map (|(line_idx, line)|\n\t\t\t\t\tParser::wrap (line, |parser| parser.item ())\n\t\t\t\t\t\t.map_parse_err (|col_idx|\n\t\t\t\t\t\t\tformat! (\"Invalid input: line {}: col {}: {}\",\n\t\t\t\t\t\t\t\tline_idx + 1, col_idx + 1, line)))\n\t\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e () ?;\n\t\t\tif discs.is_empty () { return Err (\"Must provide at least one disc\".into ()) }\n\t\t\tOk (Self { discs })\n\t\t}\n\t}\n\n\timpl FromParser for Disc {\n\t\tfn from_parser (parser: \u0026 mut Parser) -\u003e ParseResult \u003cSelf\u003e {\n\t\t\tlet delay = parser.expect (\"Disc #\") ?.int () ?;\n\t\t\tif delay \u003e 100 { return Err (\"Max disc delay is 100\".into ()) }\n\t\t\tlet num_posns = parser.expect (\" has \") ?.int () ?;\n\t\t\tif num_posns \u003c 1 { return Err (\"Min disc positions is 1\".into ()) }\n\t\t\tif num_posns \u003e 100 { return Err (\"Max disc positions is 100\".into ()) }\n\t\t\tlet start_pos = parser.expect (\" positions; at time=0, it is at position \") ?.int () ?;\n\t\t\tif start_pos \u003e= num_posns { return Err (\"Disc start pos out of range\".into ()) }\n\t\t\tparser.expect (\".\") ?.end () ?;\n\t\t\tOk (Self { delay, num_posns, start_pos })\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"Disc #1 has 5 positions; at time=0, it is at position 4.\",\n\t\t\"Disc #2 has 2 positions; at time=0, it is at position 1.\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"5\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"85\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":13,"address":[83491,82787],"length":1,"stats":{"Line":2},"fn_name":null},{"line":14,"address":[82893],"length":1,"stats":{"Line":1},"fn_name":null},{"line":15,"address":[83597],"length":1,"stats":{"Line":1},"fn_name":null},{"line":28,"address":[87600],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":29,"address":[87617],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[88022,87632],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":39,"address":[87898,87670],"length":1,"stats":{"Line":2},"fn_name":null},{"line":47,"address":[87969],"length":1,"stats":{"Line":1},"fn_name":null},{"line":57,"address":[88064],"length":1,"stats":{"Line":1},"fn_name":"calc_result"},{"line":58,"address":[88102,88188,88317],"length":1,"stats":{"Line":2},"fn_name":null},{"line":59,"address":[63376,63447],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":60,"address":[63956,63456,63397,63507,63835],"length":1,"stats":{"Line":5},"fn_name":"{closure#0}"},{"line":61,"address":[63627,63818,63593,63523,63547],"length":1,"stats":{"Line":4},"fn_name":null},{"line":62,"address":[63531],"length":1,"stats":{"Line":1},"fn_name":null},{"line":63,"address":[63568],"length":1,"stats":{"Line":1},"fn_name":null},{"line":64,"address":[64199,64000,63614],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":65,"address":[64024,64133,64209],"length":1,"stats":{"Line":1},"fn_name":null},{"line":66,"address":[64114],"length":1,"stats":{"Line":1},"fn_name":null},{"line":67,"address":[63786],"length":1,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[63882,63848,63760],"length":1,"stats":{"Line":3},"fn_name":null},{"line":69,"address":[63768],"length":1,"stats":{"Line":1},"fn_name":null},{"line":70,"address":[63869,64259,64240],"length":1,"stats":{"Line":3},"fn_name":"{closure#1}"},{"line":73,"address":[88273],"length":1,"stats":{"Line":1},"fn_name":null},{"line":96,"address":[39264,39839],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":98,"address":[39323,39543],"length":1,"stats":{"Line":1},"fn_name":null},{"line":100,"address":[52925,52844,52816],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":101,"address":[52854,52944,52900,52979],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":102,"address":[53389,52880,53008],"length":1,"stats":{"Line":1},"fn_name":"{closure#1}"},{"line":103,"address":[53086,53176,53237],"length":1,"stats":{"Line":0},"fn_name":null},{"line":104,"address":[53202,53051,53112],"length":1,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[39498,39611,39761],"length":1,"stats":{"Line":2},"fn_name":null},{"line":107,"address":[39626],"length":1,"stats":{"Line":1},"fn_name":null},{"line":112,"address":[39872],"length":1,"stats":{"Line":1},"fn_name":"from_parser"},{"line":113,"address":[40176,40106,39902],"length":1,"stats":{"Line":2},"fn_name":null},{"line":114,"address":[40158,40333],"length":1,"stats":{"Line":1},"fn_name":null},{"line":115,"address":[40680,40601,40404,40306],"length":1,"stats":{"Line":3},"fn_name":null},{"line":116,"address":[40811,40665],"length":1,"stats":{"Line":1},"fn_name":null},{"line":117,"address":[40805,40917],"length":1,"stats":{"Line":1},"fn_name":null},{"line":118,"address":[40991,40890,41271,41188],"length":1,"stats":{"Line":3},"fn_name":null},{"line":119,"address":[41256,41424],"length":1,"stats":{"Line":1},"fn_name":null},{"line":120,"address":[41397,41818,41498,41695],"length":1,"stats":{"Line":3},"fn_name":null},{"line":121,"address":[41761],"length":1,"stats":{"Line":1},"fn_name":null},{"line":138,"address":[30293,30288],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":139,"address":[30359],"length":1,"stats":{"Line":1},"fn_name":null},{"line":140,"address":[30382,30456,30522],"length":1,"stats":{"Line":3},"fn_name":null},{"line":144,"address":[30320,30325],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":145,"address":[30999],"length":1,"stats":{"Line":1},"fn_name":null},{"line":146,"address":[31096,31022,31162],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":45,"coverable":48},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-16","src","lib.rs"],"content":"//! Advent of Code 2016: Day 16: Dragon Checksum\n//!\n//! [https://adventofcode.com/2016/day/16](https://adventofcode.com/2016/day/16)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Dragon Checksum\";\n\tyear = 2016;\n\tday = 16;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Bit;\n\tuse model::Input;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cString\u003e {\n\t\tOk (calc_result (\u0026 input.initial_state, input.disk_size_one))\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cString\u003e {\n\t\tOk (calc_result (\u0026 input.initial_state, input.disk_size_two))\n\t}\n\n\tfn calc_result (state: \u0026 [Bit], disk_size: u32) -\u003e String {\n\n\t\t// iterator over packed integers with bits from sequence\n\n\t\tlet mut extend_iter = ExtendIter::new (state);\n\n\t\t// work out checksum size and number of bits they span in the original\n\n\t\tlet mut sum_bits = disk_size;\n\t\tlet mut span_bits = 1_u32;\n\t\twhile sum_bits \u0026 1 == 0 { sum_bits /= 2; span_bits *= 2; }\n\n\t\t// iterate to build up the result string\n\n\t\tlet mut result = String::new ();\n\t\tlet mut cur = 0;\n\t\tlet mut cur_bits = 0;\n\t\tfor _ in 0 .. sum_bits {\n\n\t\t\t// iterate over the appropriate number of bits\n\n\t\t\tlet mut span_rem = span_bits;\n\t\t\tlet mut sum = 0;\n\t\t\twhile span_rem \u003e 0 {\n\n\t\t\t\t// get another packed word from the iterator\n\n\t\t\t\tif cur_bits == 0 {\n\t\t\t\t\tcur = extend_iter.next ().unwrap ();\n\t\t\t\t\tcur_bits = 64;\n\t\t\t\t}\n\n\t\t\t\t// count the relevant one bits\n\n\t\t\t\tif cur_bits \u003c= span_rem {\n\t\t\t\t\tsum += cur.count_ones ();\n\t\t\t\t\tspan_rem -= cur_bits;\n\t\t\t\t\tcur_bits = 0;\n\t\t\t\t} else {\n\t\t\t\t\tsum += (cur \u003e\u003e (64 - span_rem)).count_ones ();\n\t\t\t\t\tcur \u003c\u003c= span_rem;\n\t\t\t\t\tcur_bits -= span_rem;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// append the result to the string\n\n\t\t\twrite! (\u0026 mut result, \"{}\", (sum \u0026 1) ^ 1).unwrap ();\n\n\t\t}\n\n\t\tresult\n\n\t}\n\n\tstruct ExtendIter {\n\t\tdata: u64,\n\t\tdata_rev: u64,\n\t\tdata_bits: u32,\n\t\tcur: u64,\n\t\tcur_bits: u32,\n\t\trev: bool,\n\t\tcount: usize,\n\t}\n\n\timpl ExtendIter {\n\n\t\tfn new (data_vec: \u0026 [Bit]) -\u003e Self {\n\n\t\t\tlet data_bits = data_vec.len ().as_u32 ();\n\n\t\t\t// convert vec to bit pattern\n\n\t\t\tlet mut data = 0_u64;\n\t\t\tfor bit in data_vec.iter ().copied () {\n\t\t\t\tdata \u003c\u003c= 1_u32;\n\t\t\t\tif bit == Bit::One { data |= 1; }\n\t\t\t}\n\n\t\t\t// also convert to inverted and reversed bit pattern\n\n\t\t\tlet mut data_rev = 0_u64;\n\t\t\tfor bit in data_vec.iter ().rev ().copied () {\n\t\t\t\tdata_rev \u003c\u003c= 1_u32;\n\t\t\t\tif bit == Bit::Zero { data_rev |= 1; }\n\t\t\t}\n\n\t\t\t// construct\n\n\t\t\tSelf {\n\t\t\t\tdata,\n\t\t\t\tdata_rev,\n\t\t\t\tdata_bits,\n\t\t\t\tcur: 0,\n\t\t\t\tcur_bits: 0,\n\t\t\t\trev: false,\n\t\t\t\tcount: usize::MAX,\n\t\t\t}\n\n\t\t}\n\n\t\tconst fn calc_sep_bit (old_count: usize) -\u003e u64 {\n\t\t\tlet new_count = old_count + 1;\n\t\t\tlet changes = old_count ^ new_count;\n\t\t\tlet bit_idx = usize::BITS - changes.leading_zeros ();\n\t\t\tif new_count \u0026 (1 \u003c\u003c bit_idx) != 0 { 1 } else { 0 }\n\t\t}\n\n\t}\n\n\timpl Iterator for ExtendIter {\n\n\t\ttype Item = u64;\n\n\t\tfn next (\u0026 mut self) -\u003e Option \u003cu64\u003e {\n\n\t\t\t// build up packed bits iteratively\n\n\t\t\tlet mut val = 0;\n\t\t\tlet mut val_bits = 0;\n\t\t\twhile val_bits \u003c 64 {\n\n\t\t\t\t// work out next chunk of bits - single 0 or 1, plus data or data_rev\n\n\t\t\t\tif self.cur_bits == 0 {\n\t\t\t\t\tself.cur = 0;\n\t\t\t\t\tif self.count == usize::MAX {\n\t\t\t\t\t\tself.count = 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.cur = Self::calc_sep_bit (self.count);\n\t\t\t\t\t\tself.count += 1;\n\t\t\t\t\t\tself.cur_bits = 1;\n\t\t\t\t\t}\n\t\t\t\t\tself.cur \u003c\u003c= self.data_bits;\n\t\t\t\t\tself.cur |= if self.rev { self.data_rev } else { self.data };\n\t\t\t\t\tself.cur_bits += self.data_bits;\n\t\t\t\t\tself.rev = ! self.rev;\n\t\t\t\t}\n\n\t\t\t\t// append bits to result\n\n\t\t\t\tif val_bits + self.cur_bits \u003c= 64 {\n\t\t\t\t\tval |= self.cur \u003c\u003c (64 - val_bits - self.cur_bits);\n\t\t\t\t\tval_bits += self.cur_bits;\n\t\t\t\t\tself.cur_bits = 0;\n\t\t\t\t} else {\n\t\t\t\t\tval |= self.cur \u003e\u003e (self.cur_bits + val_bits - 64);\n\t\t\t\t\tself.cur_bits -= 64 - val_bits;\n\t\t\t\t\tval_bits = 64;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// return packed value\n\n\t\t\tSome (val)\n\n\t\t}\n\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\n\t#[ derive (Clone, Debug, Default, Eq, PartialEq) ]\n\tpub struct Input {\n\t\tpub initial_state: Vec \u003cBit\u003e,\n\t\tpub disk_size_one: u32,\n\t\tpub disk_size_two: u32,\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\n\tpub enum Bit { Zero, One }\n\n\timpl Input {\n\n\t\tpub fn parse (mut input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\n\t\t\tlet disk_size_one = parser::input_param (\u0026 mut input, \"DISK_SIZE_ONE=\", 272_u32) ?;\n\t\t\tif disk_size_one \u003c 1 { return Err (\"Disk size one must be at least 1\".into ()) };\n\n\t\t\tlet disk_size_two = parser::input_param (\u0026 mut input, \"DISK_SIZE_TWO=\", 35_651_584_u32) ?;\n\t\t\tif disk_size_two \u003c 1 { return Err (\"Disk size two must be at least 1\".into ()) };\n\n\t\t\tif input.len () != 1 { return Err (\"Input must have exactly one line\".into ()) }\n\n\t\t\tlet initial_state: Vec \u003cBit\u003e =\n\t\t\t\tinput [0].chars ()\n\t\t\t\t\t.map (|ch| match ch {\n\t\t\t\t\t\t'0' =\u003e Ok (Bit::Zero),\n\t\t\t\t\t\t'1' =\u003e Ok (Bit::One),\n\t\t\t\t\t\t_ =\u003e Err (format! (\"Invalid character: {}\", ch).into ()),\n\t\t\t\t\t})\n\t\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e () ?;\n\t\t\tif initial_state.is_empty () { return Err (\"Min initial state size is 1 bit\".into ()) }\n\t\t\tif initial_state.len () \u003e 50 { return Err (\"Max initial state size is 50 bits\".into ()) }\n\n\t\t\tOk (Self { initial_state, disk_size_one, disk_size_two })\n\n\t\t}\n\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"DISK_SIZE_ONE=20\",\n\t\t\"DISK_SIZE_TWO=80\",\n\t\t\"10000\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"01100\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"11010\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":13,"address":[60595,61363],"length":1,"stats":{"Line":2},"fn_name":null},{"line":14,"address":[60701],"length":1,"stats":{"Line":1},"fn_name":null},{"line":15,"address":[61469],"length":1,"stats":{"Line":1},"fn_name":null},{"line":24,"address":[55088],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":25,"address":[55118],"length":1,"stats":{"Line":1},"fn_name":null},{"line":28,"address":[55216],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":29,"address":[55246],"length":1,"stats":{"Line":1},"fn_name":null},{"line":32,"address":[56844,55344],"length":1,"stats":{"Line":1},"fn_name":"calc_result"},{"line":36,"address":[55394],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[55411],"length":1,"stats":{"Line":1},"fn_name":null},{"line":41,"address":[55418],"length":1,"stats":{"Line":1},"fn_name":null},{"line":42,"address":[55429,56874],"length":1,"stats":{"Line":2},"fn_name":null},{"line":46,"address":[55503],"length":1,"stats":{"Line":1},"fn_name":null},{"line":47,"address":[55508],"length":1,"stats":{"Line":1},"fn_name":null},{"line":48,"address":[55520],"length":1,"stats":{"Line":1},"fn_name":null},{"line":49,"address":[55531,55637],"length":1,"stats":{"Line":2},"fn_name":null},{"line":53,"address":[55730],"length":1,"stats":{"Line":1},"fn_name":null},{"line":54,"address":[55744],"length":1,"stats":{"Line":1},"fn_name":null},{"line":55,"address":[56210,55755],"length":1,"stats":{"Line":2},"fn_name":null},{"line":59,"address":[55812,55922],"length":1,"stats":{"Line":2},"fn_name":null},{"line":60,"address":[55875,55830],"length":1,"stats":{"Line":2},"fn_name":null},{"line":61,"address":[55911],"length":1,"stats":{"Line":1},"fn_name":null},{"line":66,"address":[55847],"length":1,"stats":{"Line":1},"fn_name":null},{"line":67,"address":[56156,56098,55969],"length":1,"stats":{"Line":2},"fn_name":null},{"line":68,"address":[56127,56215,56192],"length":1,"stats":{"Line":2},"fn_name":null},{"line":69,"address":[56199],"length":1,"stats":{"Line":1},"fn_name":null},{"line":71,"address":[56254,56558,56446,55924],"length":1,"stats":{"Line":2},"fn_name":null},{"line":72,"address":[56596,56512,56633],"length":1,"stats":{"Line":2},"fn_name":null},{"line":73,"address":[56670,56682,56604],"length":1,"stats":{"Line":2},"fn_name":null},{"line":81,"address":[55765,56725],"length":1,"stats":{"Line":2},"fn_name":null},{"line":101,"address":[56928],"length":1,"stats":{"Line":1},"fn_name":"new"},{"line":103,"address":[56994],"length":1,"stats":{"Line":1},"fn_name":null},{"line":107,"address":[57030],"length":1,"stats":{"Line":1},"fn_name":null},{"line":108,"address":[57042,57239],"length":1,"stats":{"Line":2},"fn_name":null},{"line":109,"address":[57255],"length":1,"stats":{"Line":1},"fn_name":null},{"line":110,"address":[57285],"length":1,"stats":{"Line":1},"fn_name":null},{"line":115,"address":[57210],"length":1,"stats":{"Line":1},"fn_name":null},{"line":116,"address":[57575,57222,57357],"length":1,"stats":{"Line":3},"fn_name":null},{"line":117,"address":[57591],"length":1,"stats":{"Line":1},"fn_name":null},{"line":118,"address":[57621],"length":1,"stats":{"Line":1},"fn_name":null},{"line":135,"address":[57696],"length":1,"stats":{"Line":1},"fn_name":"calc_sep_bit"},{"line":136,"address":[57787,57710],"length":1,"stats":{"Line":1},"fn_name":null},{"line":137,"address":[57741],"length":1,"stats":{"Line":1},"fn_name":null},{"line":138,"address":[57882,57821,57785],"length":1,"stats":{"Line":2},"fn_name":null},{"line":139,"address":[57921,57847],"length":1,"stats":{"Line":2},"fn_name":null},{"line":148,"address":[58000],"length":1,"stats":{"Line":1},"fn_name":"next"},{"line":152,"address":[58020],"length":1,"stats":{"Line":1},"fn_name":null},{"line":153,"address":[58032],"length":1,"stats":{"Line":1},"fn_name":null},{"line":154,"address":[58043],"length":1,"stats":{"Line":1},"fn_name":null},{"line":158,"address":[58104,58480],"length":1,"stats":{"Line":2},"fn_name":null},{"line":159,"address":[58115],"length":1,"stats":{"Line":1},"fn_name":null},{"line":160,"address":[58299,58123],"length":1,"stats":{"Line":2},"fn_name":null},{"line":161,"address":[58193],"length":1,"stats":{"Line":1},"fn_name":null},{"line":163,"address":[58172,58254],"length":1,"stats":{"Line":2},"fn_name":null},{"line":164,"address":[58301,58258],"length":1,"stats":{"Line":1},"fn_name":null},{"line":165,"address":[58292],"length":1,"stats":{"Line":1},"fn_name":null},{"line":167,"address":[58353,58341,58206],"length":1,"stats":{"Line":2},"fn_name":null},{"line":168,"address":[58388,58345],"length":1,"stats":{"Line":2},"fn_name":null},{"line":169,"address":[58439,58485],"length":1,"stats":{"Line":1},"fn_name":null},{"line":170,"address":[58468],"length":1,"stats":{"Line":1},"fn_name":null},{"line":175,"address":[59175,58137,58864,58519],"length":1,"stats":{"Line":4},"fn_name":null},{"line":176,"address":[58605,58811],"length":1,"stats":{"Line":1},"fn_name":null},{"line":177,"address":[58869,58788,58850],"length":1,"stats":{"Line":2},"fn_name":null},{"line":178,"address":[58857],"length":1,"stats":{"Line":1},"fn_name":null},{"line":180,"address":[58903,59065,58561],"length":1,"stats":{"Line":2},"fn_name":null},{"line":181,"address":[59104,59040,59180],"length":1,"stats":{"Line":2},"fn_name":null},{"line":182,"address":[59164],"length":1,"stats":{"Line":1},"fn_name":null},{"line":189,"address":[58053],"length":1,"stats":{"Line":1},"fn_name":null},{"line":213,"address":[75200,76563],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":215,"address":[75360,75239],"length":1,"stats":{"Line":1},"fn_name":null},{"line":216,"address":[75463,75345],"length":1,"stats":{"Line":1},"fn_name":null},{"line":218,"address":[75623,75422,75541],"length":1,"stats":{"Line":2},"fn_name":null},{"line":219,"address":[75608,75685],"length":1,"stats":{"Line":1},"fn_name":null},{"line":221,"address":[75672,75778],"length":1,"stats":{"Line":1},"fn_name":null},{"line":223,"address":[75751,76114,75844],"length":1,"stats":{"Line":2},"fn_name":null},{"line":225,"address":[22925,23164,22896],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":226,"address":[22979],"length":1,"stats":{"Line":1},"fn_name":null},{"line":227,"address":[22996],"length":1,"stats":{"Line":1},"fn_name":null},{"line":228,"address":[22951,23018],"length":1,"stats":{"Line":0},"fn_name":null},{"line":231,"address":[76201,76063,76175],"length":1,"stats":{"Line":2},"fn_name":null},{"line":232,"address":[76290,76492,76189],"length":1,"stats":{"Line":2},"fn_name":null},{"line":234,"address":[76322],"length":1,"stats":{"Line":1},"fn_name":null},{"line":254,"address":[45125,45120],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":255,"address":[46455],"length":1,"stats":{"Line":1},"fn_name":null},{"line":256,"address":[46478,46552,46618],"length":1,"stats":{"Line":3},"fn_name":null},{"line":260,"address":[45152,45157],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":261,"address":[47095],"length":1,"stats":{"Line":1},"fn_name":null},{"line":262,"address":[47258,47118,47192],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":87,"coverable":88},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-17","src","lib.rs"],"content":"//! Advent of Code 2016: Day 17: Two Steps Forward\n//!\n//! [https://adventofcode.com/2016/day/17](https://adventofcode.com/2016/day/17)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\nuse aoc_md5 as md5;\nuse aoc_pos as pos;\n\npuzzle_info! {\n\tname = \"Two Steps Forward\";\n\tyear = 2016;\n\tday = 17;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Dir;\n\tuse model::Input;\n\tuse model::Pos;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cString\u003e {\n\t\tOk (\n\t\t\tRoutesIter::new (input)\n\t\t\t\t.next ()\n\t\t\t\t.ok_or (\"No solution found\") ?\n\t\t)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cusize\u003e {\n\t\tOk (\n\t\t\tRoutesIter::new (input)\n\t\t\t\t.last ()\n\t\t\t\t.ok_or (\"No solution found\") ?\n\t\t\t\t.chars ()\n\t\t\t\t.count ()\n\t\t)\n\t}\n\n\tstruct RoutesIter {\n\t\ttodo: VecDeque \u003c(Pos, String)\u003e,\n\t\tend: Pos,\n\t\tsize: Pos,\n\t\tpasscode: String,\n\t}\n\n\timpl RoutesIter {\n\t\tfn new (input: \u0026 Input) -\u003e Self {\n\t\t\tlet mut todo = VecDeque::new ();\n\t\t\ttodo.push_back ((input.start, \"\".to_owned ()));\n\t\t\tlet end = input.end;\n\t\t\tlet size = input.size;\n\t\t\tlet passcode = input.passcode.clone ();\n\t\t\tSelf { todo, end, size, passcode }\n\t\t}\n\t}\n\n\timpl Iterator for RoutesIter {\n\n\t\ttype Item = String;\n\n\t\tfn next (\u0026 mut self) -\u003e Option \u003cString\u003e {\n\t\t\twhile let Some ((pos, route)) = self.todo.pop_front () {\n\t\t\t\tif pos == self.end { return Some (route) }\n\t\t\t\tlet hash = md5::md5_hash (format! (\"{}{}\", self.passcode, route).as_bytes ());\n\t\t\t\tlet hash_hex = hash.as_hex_bytes ();\n\t\t\t\tfor (dir_idx, dir_tag, dir) in [\n\t\t\t\t\t(0, \"U\", Dir::Up), (1, \"D\", Dir::Down),\n\t\t\t\t\t(2, \"L\", Dir::Left), (3, \"R\", Dir::Right),\n\t\t\t\t] {\n\t\t\t\t\tlet adj_pos = some_or! (pos.try_add (dir.into ()), continue);\n\t\t\t\t\tif adj_pos.y \u003e= self.size.y || adj_pos.x \u003e= self.size.x { continue }\n\t\t\t\t\tif hash_hex [dir_idx] \u003e b'a' {\n\t\t\t\t\t\tself.todo.push_back ((adj_pos, format! (\"{}{}\", route, dir_tag)));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tNone\n\t\t}\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\n\tpub type Dir = pos::Dir2d;\n\tpub type Pos = pos::PosYX \u003cu8\u003e;\n\n\t#[ derive (Clone, Debug, Eq, PartialEq) ]\n\tpub struct Input {\n\t\tpub passcode: String,\n\t\tpub start: Pos,\n\t\tpub end: Pos,\n\t\tpub size: Pos,\n\t}\n\n\timpl Input {\n\n\t\tpub fn parse (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tif input.len () != 1 { return Err (\"Input must have exactly one line\".into ()) }\n\t\t\tlet passcode = input [0].to_owned ();\n\t\t\tlet start = Pos { y: 0, x: 0 };\n\t\t\tlet end = Pos { y: 3, x: 3 };\n\t\t\tlet size = Pos { y: 4, x: 4 };\n\t\t\tOk (Self { passcode, start, end, size })\n\t\t}\n\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLES: \u0026 [\u0026 str] = \u0026 [\n\t\t\"ihgpwlah\",\n\t\t\"kglvqrro\",\n\t\t\"ulqzkmiv\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"DDRRRD\", puzzle.part_one (\u0026 [ EXAMPLES [0] ]));\n\t\tassert_eq_ok! (\"DDUDRLRRUDRD\", puzzle.part_one (\u0026 [ EXAMPLES [1] ]));\n\t\tassert_eq_ok! (\"DRURDRUDDLLDLUURRDULRLDUUDDDRR\", puzzle.part_one (\u0026 [ EXAMPLES [2] ]));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"370\", puzzle.part_two (\u0026 [ EXAMPLES [0] ]));\n\t\tassert_eq_ok! (\"492\", puzzle.part_two (\u0026 [ EXAMPLES [1] ]));\n\t\tassert_eq_ok! (\"830\", puzzle.part_two (\u0026 [ EXAMPLES [2] ]));\n\t}\n\n}\n","traces":[{"line":15,"address":[59635,60403],"length":1,"stats":{"Line":2},"fn_name":null},{"line":16,"address":[59741],"length":1,"stats":{"Line":1},"fn_name":null},{"line":17,"address":[60509],"length":1,"stats":{"Line":1},"fn_name":null},{"line":27,"address":[74592,74974],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":29,"address":[74617,74918,74690],"length":1,"stats":{"Line":2},"fn_name":null},{"line":31,"address":[74892],"length":1,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[75024,75397],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":37,"address":[75049,75324,75249],"length":1,"stats":{"Line":2},"fn_name":null},{"line":39,"address":[75223],"length":1,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[75440,75927],"length":1,"stats":{"Line":2},"fn_name":"new"},{"line":54,"address":[75470],"length":1,"stats":{"Line":2},"fn_name":null},{"line":55,"address":[75567,75485],"length":1,"stats":{"Line":4},"fn_name":null},{"line":56,"address":[75617],"length":1,"stats":{"Line":2},"fn_name":null},{"line":57,"address":[75645],"length":1,"stats":{"Line":2},"fn_name":null},{"line":58,"address":[75673],"length":1,"stats":{"Line":2},"fn_name":null},{"line":67,"address":[75968,76704,77946],"length":1,"stats":{"Line":2},"fn_name":"next"},{"line":68,"address":[76015,76148,77961],"length":1,"stats":{"Line":5},"fn_name":null},{"line":69,"address":[76122,76243,76296],"length":1,"stats":{"Line":6},"fn_name":null},{"line":70,"address":[76410,76257],"length":1,"stats":{"Line":4},"fn_name":null},{"line":71,"address":[76731],"length":1,"stats":{"Line":2},"fn_name":null},{"line":72,"address":[77267,76926],"length":1,"stats":{"Line":4},"fn_name":null},{"line":73,"address":[76738],"length":1,"stats":{"Line":2},"fn_name":null},{"line":74,"address":[76832],"length":1,"stats":{"Line":2},"fn_name":null},{"line":76,"address":[77277,77260],"length":1,"stats":{"Line":4},"fn_name":null},{"line":77,"address":[77490],"length":1,"stats":{"Line":2},"fn_name":null},{"line":78,"address":[77551],"length":1,"stats":{"Line":2},"fn_name":null},{"line":79,"address":[77627],"length":1,"stats":{"Line":2},"fn_name":null},{"line":83,"address":[76169],"length":1,"stats":{"Line":1},"fn_name":null},{"line":106,"address":[45792],"length":1,"stats":{"Line":2},"fn_name":"parse"},{"line":107,"address":[45835,45860],"length":1,"stats":{"Line":2},"fn_name":null},{"line":108,"address":[45934,45846],"length":1,"stats":{"Line":4},"fn_name":null},{"line":109,"address":[45985],"length":1,"stats":{"Line":2},"fn_name":null},{"line":110,"address":[45995],"length":1,"stats":{"Line":2},"fn_name":null},{"line":111,"address":[46005],"length":1,"stats":{"Line":2},"fn_name":null},{"line":112,"address":[46015],"length":1,"stats":{"Line":2},"fn_name":null},{"line":131,"address":[33349,33344],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":132,"address":[27719],"length":1,"stats":{"Line":1},"fn_name":null},{"line":133,"address":[27879,27764,27954],"length":1,"stats":{"Line":3},"fn_name":null},{"line":134,"address":[28388,28536],"length":1,"stats":{"Line":2},"fn_name":null},{"line":135,"address":[29093,28945],"length":1,"stats":{"Line":2},"fn_name":null},{"line":139,"address":[31515,30297,29632],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":140,"address":[29639],"length":1,"stats":{"Line":1},"fn_name":null},{"line":141,"address":[29684,29799,29874],"length":1,"stats":{"Line":3},"fn_name":null},{"line":142,"address":[30456,30308],"length":1,"stats":{"Line":2},"fn_name":null},{"line":143,"address":[31013,30865],"length":1,"stats":{"Line":2},"fn_name":null}],"covered":43,"coverable":45},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-18","src","lib.rs"],"content":"//! Advent of Code 2016: Day 18: Like a Rogue\n//!\n//! [https://adventofcode.com/2016/day/18](https://adventofcode.com/2016/day/18)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Like a Rogue\";\n\tyear = 2016;\n\tday = 18;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\tuse model::Tile;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cu32\u003e {\n\t\tcalc_result (\u0026 input.first_row, input.num_rows_one)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cu32\u003e {\n\t\tcalc_result (\u0026 input.first_row, input.num_rows_two)\n\t}\n\n\tfn calc_result (first_row: \u0026 [Tile], num_rows: u32) -\u003e GenResult \u003cu32\u003e {\n\t\tif first_row.is_empty () { return Err (\"Max row size is 1 tile\".into ()) }\n\t\tif first_row.len () \u003e 128 { return Err (\"Max row size is 128 tiles\".into ()) }\n\t\tlet mut row: u128 = 0;\n\t\tlet mut mask: u128 = 0;\n\t\tfor tile in first_row.iter ().copied () {\n\t\t\trow \u003c\u003c= 1_u32;\n\t\t\tif tile == Tile::Trap { row |= 1; }\n\t\t\tmask \u003c\u003c= 1_u32;\n\t\t\tmask |= 1;\n\t\t}\n\t\tlet num_tiles = mask.count_ones ();\n\t\tlet mut num_safe = 0;\n\t\tfor _ in 0 .. num_rows {\n\t\t\tnum_safe += num_tiles - row.count_ones ();\n\t\t\trow = ((row \u003c\u003c 1_u32) ^ (row \u003e\u003e 1_u32)) \u0026 mask;\n\t\t}\n\t\tOk (num_safe)\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse parser::*;\n\n\t#[ derive (Clone, Debug, Eq, PartialEq) ]\n\tpub struct Input {\n\t\tpub first_row: Vec \u003cTile\u003e,\n\t\tpub num_rows_one: u32,\n\t\tpub num_rows_two: u32,\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, Hash, PartialEq) ]\n\tpub enum Tile { Trap, Safe }\n\n\timpl Input {\n\n\t\tpub fn parse (mut input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet num_rows_one = parser::input_param (\u0026 mut input, \"NUM_ROWS_ONE=\", 40_u32) ?;\n\t\t\tlet num_rows_two = parser::input_param (\u0026 mut input, \"NUM_ROWS_TWO=\", 400_000_u32) ?;\n\t\t\tif input.len () != 1 { return Err (\"Input must have exactly one line\".into ()) }\n\t\t\tlet first_row = Parser::wrap (input [0], |parser| {\n\t\t\t\t\tlet mut items = Vec::new ();\n\t\t\t\t\twhile let Some (ch) = parser.next () {\n\t\t\t\t\t\titems.push (match ch {\n\t\t\t\t\t\t\t'^' =\u003e Tile::Trap,\n\t\t\t\t\t\t\t'.' =\u003e Tile::Safe,\n\t\t\t\t\t\t\t_ =\u003e return Err (parser.err ()),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tOk (items)\n\t\t\t\t}).map_parse_err (|col_idx|\n\t\t\t\t\tformat! (\"Invalid input: col {}: {}\", col_idx + 1, input [0])) ?;\n\t\t\tOk (Self { first_row, num_rows_one, num_rows_two })\n\t\t}\n\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"NUM_ROWS_ONE=10\",\n\t\t\"NUM_ROWS_TWO=20\",\n\t\t\".^^.^.^^^^\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"38\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"93\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":13,"address":[33635,32947],"length":1,"stats":{"Line":2},"fn_name":null},{"line":14,"address":[33053],"length":1,"stats":{"Line":1},"fn_name":null},{"line":15,"address":[33741],"length":1,"stats":{"Line":1},"fn_name":null},{"line":24,"address":[47824],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":25,"address":[47856],"length":1,"stats":{"Line":1},"fn_name":null},{"line":28,"address":[47920],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":29,"address":[47952],"length":1,"stats":{"Line":1},"fn_name":null},{"line":32,"address":[48016],"length":1,"stats":{"Line":1},"fn_name":"calc_result"},{"line":33,"address":[48107,48154],"length":1,"stats":{"Line":1},"fn_name":null},{"line":34,"address":[48140,48329],"length":1,"stats":{"Line":1},"fn_name":null},{"line":35,"address":[48258],"length":1,"stats":{"Line":1},"fn_name":null},{"line":36,"address":[48282],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[48422,48306,48966,48762],"length":1,"stats":{"Line":4},"fn_name":null},{"line":38,"address":[48776],"length":1,"stats":{"Line":1},"fn_name":null},{"line":39,"address":[48906,48836],"length":1,"stats":{"Line":2},"fn_name":null},{"line":40,"address":[48870,48934],"length":1,"stats":{"Line":2},"fn_name":null},{"line":41,"address":[48950],"length":1,"stats":{"Line":1},"fn_name":null},{"line":43,"address":[48750,48546],"length":1,"stats":{"Line":2},"fn_name":null},{"line":44,"address":[48978],"length":1,"stats":{"Line":1},"fn_name":null},{"line":45,"address":[49587,48989],"length":1,"stats":{"Line":2},"fn_name":null},{"line":46,"address":[49342,49456,49130],"length":1,"stats":{"Line":2},"fn_name":null},{"line":47,"address":[49486,49420],"length":1,"stats":{"Line":2},"fn_name":null},{"line":49,"address":[49109],"length":1,"stats":{"Line":1},"fn_name":null},{"line":71,"address":[36160],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":72,"address":[36187,36315],"length":1,"stats":{"Line":1},"fn_name":null},{"line":73,"address":[36368,36438,36272],"length":1,"stats":{"Line":2},"fn_name":null},{"line":74,"address":[36423,36505],"length":1,"stats":{"Line":1},"fn_name":null},{"line":75,"address":[29118,29230,28880],"length":1,"stats":{"Line":5},"fn_name":"{closure#0}"},{"line":76,"address":[28912],"length":1,"stats":{"Line":1},"fn_name":null},{"line":77,"address":[28979,28927],"length":1,"stats":{"Line":2},"fn_name":null},{"line":78,"address":[29208,29027],"length":1,"stats":{"Line":2},"fn_name":null},{"line":79,"address":[29143],"length":1,"stats":{"Line":1},"fn_name":null},{"line":80,"address":[29150],"length":1,"stats":{"Line":1},"fn_name":null},{"line":81,"address":[29162,29136],"length":1,"stats":{"Line":0},"fn_name":null},{"line":84,"address":[29049],"length":1,"stats":{"Line":1},"fn_name":null},{"line":85,"address":[28943,29196,29264,29574],"length":1,"stats":{"Line":1},"fn_name":"{closure#1}"},{"line":86,"address":[29302],"length":1,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[36835],"length":1,"stats":{"Line":1},"fn_name":null},{"line":106,"address":[38961,38915,38352],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":107,"address":[38359],"length":1,"stats":{"Line":1},"fn_name":null},{"line":108,"address":[38382,38522,38456],"length":1,"stats":{"Line":3},"fn_name":null},{"line":112,"address":[39555,38992,39601],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":113,"address":[38999],"length":1,"stats":{"Line":1},"fn_name":null},{"line":114,"address":[39096,39162,39022],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":42,"coverable":44},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-19","src","lib.rs"],"content":"//! Advent of Code 2016: Day 19: An Elephant Named Joseph\n//!\n//! [https://adventofcode.com/2016/day/19](https://adventofcode.com/2016/day/19)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"An Elephant Named Joseph\";\n\tyear = 2016;\n\tday = 19;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cu32\u003e {\n\t\tif input.num_elves \u003c 2 { return Err (\"Must have at least two elves\".into ()) }\n\t\tlet mut first_with = 0;\n\t\tlet mut sep = 1;\n\t\tlet mut rem = input.num_elves;\n\t\tlet mut take = false;\n\t\twhile rem \u003e 1 {\n\t\t\tlet odd = (rem \u0026 1) == 1;\n\t\t\tif ! take \u0026\u0026 odd { rem = (rem + 1) / 2; } else { rem /= 2; }\n\t\t\tif take { first_with += sep; }\n\t\t\tif odd { take = ! take; }\n\t\t\tsep = u32::mul_2 (sep, 2) ?;\n\t\t}\n\t\tOk (first_with + 1)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cu32\u003e {\n\t\tif input.num_elves \u003c 2 { return Err (\"Must have at least two elves\".into ()) }\n\t\tlet mut elves =\n\t\t\t((input.num_elves + 2) / 2 ..= input.num_elves)\n\t\t\t\t.chain (1 .. (input.num_elves + 2) / 2)\n\t\t\t\t.collect::\u003cVec \u003c_\u003e\u003e ();\n\t\tlet mut seq = 1 + (input.num_elves) % 2;\n\t\twhile elves.len () \u003e 3 {\n\t\t\tlet next_seq = (seq + elves.len ().as_u32 ()) % 3;\n\t\t\telves = elves.iter_vals ()\n\t\t\t\t.scan (seq, |state, elf| {\n\t\t\t\t\tlet seq = * state;\n\t\t\t\t\t* state += 1;\n\t\t\t\t\tif * state == 3 { * state = 0; }\n\t\t\t\t\tSome ((seq, elf))\n\t\t\t\t})\n\t\t\t\t.filter (|\u0026 (seq, _)| seq == 0)\n\t\t\t\t.map (|(_, elf)| elf)\n\t\t\t\t.collect ();\n\t\t\tseq = next_seq;\n\t\t}\n\t\twhile elves.len () \u003e 1 {\n\t\t\tlet elf = elves.remove (0);\n\t\t\tif seq == 0 { elves.push (elf); }\n\t\t\tseq = (seq + 1) % 3;\n\t\t}\n\t\tOk (elves [0])\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse parser::*;\n\n\t#[ derive (Clone, Debug, Eq, PartialEq) ]\n\tpub struct Input {\n\t\tpub num_elves: u32,\n\t}\n\n\timpl Input {\n\n\t\tpub fn parse (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tif input.len () != 1 { return Err (\"Input must have exactly one line\".into ()) }\n\t\t\t#[ allow (clippy::redundant_closure_for_method_calls) ]\n\t\t\tlet num_elves = Parser::wrap (input [0], |parser| parser.int ())\n\t\t\t\t.map_parse_err (|col_idx|\n\t\t\t\t\tformat! (\"Invalid input: col {}: {}\", col_idx + 1, input [0])) ?;\n\t\t\tOk (Self { num_elves })\n\t\t}\n\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tfor (input, expected) in [\n\t\t\t(2, 1), (3, 3), (4, 1), (5, 3), (6, 5), (7, 7), (8, 1), (9, 3), (10, 5), (11, 7),\n\t\t\t(12, 9), (13, 11), (14, 13), (15, 15), (16, 1), (17, 3), (18, 5), (19, 7), (20, 9),\n\t\t].into_iter () {\n\t\t\tassert_eq_ok! (expected.to_string (), puzzle.part_one (\u0026 [\u0026 input.to_string ()]));\n\t\t}\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tfor (input, expected) in [\n\t\t\t(2, 1), (3, 3), (4, 1), (5, 2), (6, 3), (7, 5), (8, 7), (9, 9), (10, 1), (11, 2),\n\t\t\t(12, 3), (13, 4), (14, 5), (15, 6), (16, 7), (17, 8), (18, 9), (19, 11), (20, 13),\n\t\t].into_iter () {\n\t\t\tassert_eq_ok! (expected.to_string (), puzzle.part_two (\u0026 [\u0026 input.to_string ()]));\n\t\t}\n\t}\n\n}\n","traces":[{"line":13,"address":[60787,60275],"length":1,"stats":{"Line":2},"fn_name":null},{"line":14,"address":[60330],"length":1,"stats":{"Line":1},"fn_name":null},{"line":15,"address":[60842],"length":1,"stats":{"Line":1},"fn_name":null},{"line":23,"address":[55440],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":24,"address":[55503,55464],"length":1,"stats":{"Line":1},"fn_name":null},{"line":25,"address":[55474],"length":1,"stats":{"Line":1},"fn_name":null},{"line":26,"address":[55482],"length":1,"stats":{"Line":1},"fn_name":null},{"line":27,"address":[55490],"length":1,"stats":{"Line":1},"fn_name":null},{"line":28,"address":[55496],"length":1,"stats":{"Line":1},"fn_name":null},{"line":29,"address":[55899,55501,55570],"length":1,"stats":{"Line":3},"fn_name":null},{"line":30,"address":[55604],"length":1,"stats":{"Line":1},"fn_name":null},{"line":31,"address":[55627],"length":1,"stats":{"Line":1},"fn_name":null},{"line":32,"address":[55752,55735],"length":1,"stats":{"Line":2},"fn_name":null},{"line":33,"address":[55834,55746],"length":1,"stats":{"Line":2},"fn_name":null},{"line":34,"address":[55855,55909,55811],"length":1,"stats":{"Line":2},"fn_name":null},{"line":36,"address":[55577,55949,55935],"length":1,"stats":{"Line":2},"fn_name":null},{"line":39,"address":[55984,57133],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":40,"address":[56017,56045],"length":1,"stats":{"Line":1},"fn_name":null},{"line":41,"address":[56027,56127,56290,56223],"length":1,"stats":{"Line":4},"fn_name":null},{"line":43,"address":[56260,56182],"length":1,"stats":{"Line":1},"fn_name":null},{"line":45,"address":[56348,56316],"length":1,"stats":{"Line":1},"fn_name":null},{"line":46,"address":[56893,56428,56346],"length":1,"stats":{"Line":3},"fn_name":null},{"line":47,"address":[56610,56474],"length":1,"stats":{"Line":1},"fn_name":null},{"line":48,"address":[56593,56668],"length":1,"stats":{"Line":2},"fn_name":null},{"line":49,"address":[56653],"length":1,"stats":{"Line":3},"fn_name":null},{"line":50,"address":[65909],"length":1,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[65953,65919],"length":1,"stats":{"Line":1},"fn_name":null},{"line":52,"address":[65988,65946],"length":1,"stats":{"Line":2},"fn_name":null},{"line":53,"address":[66012],"length":1,"stats":{"Line":1},"fn_name":null},{"line":55,"address":[66048,66061],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":56,"address":[66096,66114],"length":1,"stats":{"Line":2},"fn_name":"{closure#2}"},{"line":58,"address":[56886],"length":1,"stats":{"Line":1},"fn_name":null},{"line":60,"address":[56459,56903,57056],"length":1,"stats":{"Line":3},"fn_name":null},{"line":61,"address":[56943],"length":1,"stats":{"Line":1},"fn_name":null},{"line":62,"address":[57035,56984],"length":1,"stats":{"Line":2},"fn_name":null},{"line":63,"address":[57013,57040,57061],"length":1,"stats":{"Line":2},"fn_name":null},{"line":65,"address":[57104,56909],"length":1,"stats":{"Line":2},"fn_name":null},{"line":82,"address":[38576],"length":1,"stats":{"Line":2},"fn_name":"parse"},{"line":83,"address":[38644,38619],"length":1,"stats":{"Line":2},"fn_name":null},{"line":85,"address":[36435,36400],"length":1,"stats":{"Line":10},"fn_name":"{closure#0}"},{"line":86,"address":[36774,36464],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":87,"address":[36502],"length":1,"stats":{"Line":0},"fn_name":null},{"line":88,"address":[38875],"length":1,"stats":{"Line":2},"fn_name":null},{"line":101,"address":[39184,39189],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":102,"address":[39783],"length":1,"stats":{"Line":1},"fn_name":null},{"line":103,"address":[40224,40829,41765],"length":1,"stats":{"Line":3},"fn_name":null},{"line":104,"address":[39806],"length":1,"stats":{"Line":1},"fn_name":null},{"line":105,"address":[40026],"length":1,"stats":{"Line":1},"fn_name":null},{"line":107,"address":[40983,41247],"length":1,"stats":{"Line":2},"fn_name":null},{"line":112,"address":[39216,39221],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":113,"address":[41831],"length":1,"stats":{"Line":1},"fn_name":null},{"line":114,"address":[42877,43813,42272],"length":1,"stats":{"Line":3},"fn_name":null},{"line":115,"address":[41854],"length":1,"stats":{"Line":1},"fn_name":null},{"line":116,"address":[42074],"length":1,"stats":{"Line":1},"fn_name":null},{"line":118,"address":[43295,43031],"length":1,"stats":{"Line":2},"fn_name":null}],"covered":54,"coverable":55},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-20","src","lib.rs"],"content":"//! Advent of Code 2016: Day 20: Firewall Rules\n//!\n//! [https://adventofcode.com/2016/day/20](https://adventofcode.com/2016/day/20)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Firewall Rules\";\n\tyear = 2016;\n\tday = 20;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cu32\u003e {\n\t\tlet rules = input.rules.iter ().cloned ().sorted ().collect::\u003cVec \u003c_\u003e\u003e ();\n\t\tlet mut first = 0;\n\t\tfor rule in rules {\n\t\t\tif first \u003c rule.start { continue }\n\t\t\tfirst = cmp::max (first, rule.end + 1);\n\t\t}\n\t\tOk (first)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cu32\u003e {\n\t\tlet rules = input.rules.iter ().cloned ().sorted ().collect::\u003cVec \u003c_\u003e\u003e ();\n\t\tlet mut last = 0;\n\t\tlet mut valid = 0;\n\t\tfor rule in rules {\n\t\t\tif last \u003c rule.start {\n\t\t\t\tvalid += rule.start - last - 1;\n\t\t\t}\n\t\t\tlast = cmp::max (last, rule.end);\n\t\t}\n\t\tOk (valid + (u32::MAX - last))\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse parser::*;\n\n\t#[ derive (Clone, Debug, Eq, PartialEq) ]\n\tpub struct Input {\n\t\tpub rules: Vec \u003cRule\u003e,\n\t}\n\n\t#[ derive (Clone, Debug, Eq, Ord, PartialEq, PartialOrd) ]\n\tpub struct Rule {\n\t\tpub start: u32,\n\t\tpub end: u32,\n\t}\n\n\timpl Input {\n\n\t\tpub fn parse (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet rules: Vec \u003c_\u003e = input.iter ().enumerate ()\n\t\t\t\t.map (|(line_idx, line)| {\n\t\t\t\t\t#[ allow (clippy::redundant_closure_for_method_calls) ]\n\t\t\t\t\tParser::wrap (line, |parser| parser.item ())\n\t\t\t\t\t\t.map_parse_err (|col_idx| \n\t\t\t\t\t\t\tformat! (\"Invalid input: line {}: col {}: {}\",\n\t\t\t\t\t\t\t\tline_idx + 1, col_idx + 1, input [0]))\n\t\t\t\t})\n\t\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e () ?;\n\t\t\tif rules.is_empty () { return Err (\"Must have at least one rule\".into ()) }\n\t\t\tOk (Self { rules })\n\t\t}\n\n\t}\n\n\timpl FromParser for Rule {\n\t\tfn from_parser (parser: \u0026 mut Parser) -\u003e ParseResult \u003cSelf\u003e {\n\t\t\tlet start = parser.int () ?;\n\t\t\tlet end = parser.expect (\"-\") ?.int () ?;\n\t\t\tparser.end () ?;\n\t\t\tif end \u003c start { return Err (\"Rule start must be less or equal to end\".into ()) }\n\t\t\tOk (Self { start, end })\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"5-8\",\n\t\t\"0-2\",\n\t\t\"4-7\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"3\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"4294967288\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":13,"address":[93555,94243],"length":1,"stats":{"Line":2},"fn_name":null},{"line":14,"address":[93661],"length":1,"stats":{"Line":1},"fn_name":null},{"line":15,"address":[94349],"length":1,"stats":{"Line":1},"fn_name":null},{"line":23,"address":[56177,55664],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":24,"address":[55702],"length":1,"stats":{"Line":1},"fn_name":null},{"line":25,"address":[55802],"length":1,"stats":{"Line":1},"fn_name":null},{"line":26,"address":[56172,55813],"length":1,"stats":{"Line":2},"fn_name":null},{"line":27,"address":[56068],"length":1,"stats":{"Line":1},"fn_name":null},{"line":28,"address":[56085],"length":1,"stats":{"Line":1},"fn_name":null},{"line":30,"address":[56213],"length":1,"stats":{"Line":1},"fn_name":null},{"line":33,"address":[56240,56892],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":34,"address":[56278],"length":1,"stats":{"Line":1},"fn_name":null},{"line":35,"address":[56384],"length":1,"stats":{"Line":1},"fn_name":null},{"line":36,"address":[56395],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[56887,56406],"length":1,"stats":{"Line":2},"fn_name":null},{"line":38,"address":[56841,56668],"length":1,"stats":{"Line":2},"fn_name":null},{"line":39,"address":[56706,56846],"length":1,"stats":{"Line":1},"fn_name":null},{"line":41,"address":[56880,56681],"length":1,"stats":{"Line":2},"fn_name":null},{"line":43,"address":[57036,56918],"length":1,"stats":{"Line":1},"fn_name":null},{"line":66,"address":[43200,43817],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":67,"address":[43259,43324,43521],"length":1,"stats":{"Line":2},"fn_name":null},{"line":68,"address":[43308],"length":1,"stats":{"Line":4},"fn_name":null},{"line":70,"address":[51920,51838,51891,51955],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":71,"address":[52420,51864,51984],"length":1,"stats":{"Line":1},"fn_name":"{closure#1}"},{"line":72,"address":[52062,52152,52241,52318],"length":1,"stats":{"Line":0},"fn_name":null},{"line":73,"address":[52178,52027,52088,52267],"length":1,"stats":{"Line":0},"fn_name":null},{"line":76,"address":[43476,43589,43739],"length":1,"stats":{"Line":2},"fn_name":null},{"line":77,"address":[43604],"length":1,"stats":{"Line":1},"fn_name":null},{"line":83,"address":[43856],"length":1,"stats":{"Line":1},"fn_name":"from_parser"},{"line":84,"address":[43985,43886],"length":1,"stats":{"Line":1},"fn_name":null},{"line":85,"address":[44083,44368,43953,44280],"length":1,"stats":{"Line":3},"fn_name":null},{"line":86,"address":[44348,44489,44559],"length":1,"stats":{"Line":2},"fn_name":null},{"line":87,"address":[44737,44544],"length":1,"stats":{"Line":1},"fn_name":null},{"line":88,"address":[44692],"length":1,"stats":{"Line":1},"fn_name":null},{"line":106,"address":[32597,32592],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":107,"address":[91143],"length":1,"stats":{"Line":1},"fn_name":null},{"line":108,"address":[91240,91306,91166],"length":1,"stats":{"Line":3},"fn_name":null},{"line":112,"address":[32624,32629],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":113,"address":[91783],"length":1,"stats":{"Line":1},"fn_name":null},{"line":114,"address":[91946,91806,91880],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":38,"coverable":40},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-21","src","lib.rs"],"content":"//! Advent of Code 2016: Day 21: Scrambled Letters and Hash\n//!\n//! [https://adventofcode.com/2016/day/21](https://adventofcode.com/2016/day/21)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Scrambled Letters and Hash\";\n\tyear = 2016;\n\tday = 21;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\tuse model::ScrambleOp;\n\n\t#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\n\tenum Mode { Scramble, Unscramble }\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cString\u003e {\n\t\tcalc_result (\u0026 input.ops, \u0026 input.start_one, Mode::Scramble)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cString\u003e {\n\t\tcalc_result (\u0026 input.ops, \u0026 input.start_two, Mode::Unscramble)\n\t}\n\n\tfn calc_result (ops: \u0026 [ScrambleOp], start: \u0026 str, mode: Mode) -\u003e GenResult \u003cString\u003e {\n\n\t\tuse Mode::{ Scramble, Unscramble };\n\t\tuse ScrambleOp::{ Move, Reverse, RotChar, RotLeft, RotRight, SwapChars, SwapPosns };\n\n\t\t// check password length\n\n\t\tif start.is_empty () {\n\t\t\treturn Err (\"Password must have at least one character\".into ());\n\t\t}\n\t\tif mode == Unscramble \u0026\u0026 start.chars ().count () != 8 {\n\t\t\treturn Err (\"Can only unscramble password with length 8\".into ());\n\t\t}\n\n\t\t// convert password to chars, allocate temp buffer\n\n\t\tlet mut state: Vec \u003cchar\u003e = start.chars ().collect ();\n\t\tlet mut state_temp: Vec \u003cchar\u003e = Vec::with_capacity (state.len ());\n\n\t\t// iterate over operations, in reverse order for unscramble\n\n\t\tlet ops_iter = match mode {\n\t\t\tScramble =\u003e Either::Left (ops.iter ().copied ()),\n\t\t\tUnscramble =\u003e Either::Right (ops.iter ().rev ().copied ()),\n\t\t};\n\t\tfor op in ops_iter {\n\t\t\tmatch (mode, op) {\n\t\t\t\t(_, SwapPosns (pos_0, pos_1)) =\u003e {\n\t\t\t\t\tlet pos_0 = pos_0.as_usize ();\n\t\t\t\t\tlet pos_1 = pos_1.as_usize ();\n\t\t\t\t\tif pos_0 \u003e= state.len () || pos_1 \u003e= state.len () {\n\t\t\t\t\t\treturn Err (\"Swap positions must be inside password\".into ());\n\t\t\t\t\t}\n\t\t\t\t\tlet ch_0 = state [pos_0];\n\t\t\t\t\tlet ch_1 = state [pos_1];\n\t\t\t\t\tstate [pos_0] = ch_1;\n\t\t\t\t\tstate [pos_1] = ch_0;\n\t\t\t\t},\n\t\t\t\t(_, SwapChars (ch_0, ch_1)) =\u003e {\n\t\t\t\t\tfor ch in state.iter_mut () {\n\t\t\t\t\t\t* ch = match * ch {\n\t\t\t\t\t\t\tch if ch == ch_0 =\u003e ch_1,\n\t\t\t\t\t\t\tch if ch == ch_1 =\u003e ch_0,\n\t\t\t\t\t\t\tch =\u003e ch,\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t(Scramble, RotLeft (num)) | (Unscramble, RotRight (num)) =\u003e {\n\t\t\t\t\tlet num = num.as_usize () % state.len ();\n\t\t\t\t\tstate_temp.clear ();\n\t\t\t\t\tstate_temp.extend (state.iter_vals ().skip (num));\n\t\t\t\t\tstate_temp.extend (state.iter_vals ().take (num));\n\t\t\t\t\tmem::swap (\u0026 mut state, \u0026 mut state_temp);\n\t\t\t\t},\n\t\t\t\t(Scramble, RotRight (num)) | (Unscramble, RotLeft (num)) =\u003e {\n\t\t\t\t\tlet num = num.as_usize () % state.len ();\n\t\t\t\t\tstate_temp.clear ();\n\t\t\t\t\tstate_temp.extend (state.iter_vals ().skip (state.len () - num));\n\t\t\t\t\tstate_temp.extend (state.iter_vals ().take (state.len () - num));\n\t\t\t\t\tmem::swap (\u0026 mut state, \u0026 mut state_temp);\n\t\t\t\t},\n\t\t\t\t(Scramble, RotChar (ch)) =\u003e {\n\t\t\t\t\tif let Some (pos) = state.iter_vals ().position (|some_ch| some_ch == ch) {\n\t\t\t\t\t\tlet num = (if pos \u003e= 4 { 2 } else { 1 } + pos) % state.len ();\n\t\t\t\t\t\tstate_temp.clear ();\n\t\t\t\t\t\tstate_temp.extend (state.iter_vals ().skip (state.len () - num));\n\t\t\t\t\t\tstate_temp.extend (state.iter_vals ().take (state.len () - num));\n\t\t\t\t\t\tmem::swap (\u0026 mut state, \u0026 mut state_temp);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t(Unscramble, RotChar (ch)) =\u003e {\n\t\t\t\t\tif let Some (pos) = state.iter_vals ().position (|some_ch| some_ch == ch) {\n\t\t\t\t\t\tlet num = match pos {\n\t\t\t\t\t\t\t0 =\u003e 1, 1 =\u003e 1, 2 =\u003e 6, 3 =\u003e 2,\n\t\t\t\t\t\t\t4 =\u003e 7, 5 =\u003e 3, 6 =\u003e 0, 7 =\u003e 4,\n\t\t\t\t\t\t\t_ =\u003e unreachable! (),\n\t\t\t\t\t\t};\n\t\t\t\t\t\tstate_temp.clear ();\n\t\t\t\t\t\tstate_temp.extend (state.iter_vals ().skip (num));\n\t\t\t\t\t\tstate_temp.extend (state.iter_vals ().take (num));\n\t\t\t\t\t\tmem::swap (\u0026 mut state, \u0026 mut state_temp);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t(_, Reverse (pos_0, pos_1)) =\u003e {\n\t\t\t\t\tlet mut pos_0 = pos_0.as_usize ();\n\t\t\t\t\tlet mut pos_1 = pos_1.as_usize ();\n\t\t\t\t\tif pos_0 \u003e= state.len () || pos_1 \u003e= state.len () {\n\t\t\t\t\t\treturn Err (\"Reverse range outside of password length\".into ());\n\t\t\t\t\t}\n\t\t\t\t\twhile pos_0 \u003c pos_1 {\n\t\t\t\t\t\tlet ch_0 = state [pos_0];\n\t\t\t\t\t\tlet ch_1 = state [pos_1];\n\t\t\t\t\t\tstate [pos_0] = ch_1;\n\t\t\t\t\t\tstate [pos_1] = ch_0;\n\t\t\t\t\t\tpos_0 += 1;\n\t\t\t\t\t\tpos_1 -= 1;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t(Scramble, Move (pos_0, pos_1)) | (Unscramble, Move (pos_1, pos_0)) =\u003e {\n\t\t\t\t\tlet pos_0 = pos_0.as_usize ();\n\t\t\t\t\tlet pos_1 = pos_1.as_usize ();\n\t\t\t\t\tif pos_0 \u003e= state.len () || pos_1 \u003e= state.len () {\n\t\t\t\t\t\treturn Err (\"Move position outside of password length\".into ());\n\t\t\t\t\t}\n\t\t\t\t\tlet ch = state.remove (pos_0);\n\t\t\t\t\tstate.insert (pos_1, ch);\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\n\t\t// collect back into string and return\n\n\t\tlet result = state.into_iter ().collect::\u003cString\u003e ();\n\t\tOk (result)\n\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse parser::*;\n\n\t#[ derive (Clone, Debug, Eq, PartialEq) ]\n\tpub struct Input {\n\t\tpub ops: Vec \u003cScrambleOp\u003e,\n\t\tpub start_one: String,\n\t\tpub start_two: String,\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, Ord, PartialEq, PartialOrd) ]\n\tpub enum ScrambleOp {\n\t\tSwapPosns (u32, u32),\n\t\tSwapChars (char, char),\n\t\tRotLeft (u32),\n\t\tRotRight (u32),\n\t\tRotChar (char),\n\t\tReverse (u32, u32),\n\t\tMove (u32, u32),\n\t}\n\n\timpl Input {\n\n\t\tpub fn parse (mut input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet start_one = parser::input_param (\u0026 mut input, \"START_ONE=\", \"abcdefgh\") ?;\n\t\t\tlet start_two = parser::input_param (\u0026 mut input, \"START_TWO=\", \"fbgdceah\") ?;\n\t\t\tlet ops: Vec \u003c_\u003e = input.iter ().enumerate ()\n\t\t\t\t.map (|(line_idx, line)| {\n\t\t\t\t\t#[ allow (clippy::redundant_closure_for_method_calls) ]\n\t\t\t\t\tParser::wrap (line, |parser| parser.item ())\n\t\t\t\t\t\t.map_parse_err (|col_idx|\n\t\t\t\t\t\t\tformat! (\"Invalid input: line {}: col {}: {}\",\n\t\t\t\t\t\t\t\tline_idx + 1, col_idx + 1, line))\n\t\t\t\t})\n\t\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e () ?;\n\t\t\tif ops.is_empty () { return Err (\"Must have at least one scramble op\".into ()) }\n\t\t\tOk (Self { ops, start_one, start_two })\n\t\t}\n\n\t}\n\n\timpl FromParser for ScrambleOp {\n\t\tfn from_parser (parser: \u0026 mut Parser) -\u003e ParseResult \u003cSelf\u003e {\n\t\t\tparser.any ()\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tlet pos_0 = parser.expect (\"swap position \") ?.confirm ().int () ?;\n\t\t\t\t\tlet pos_1 = parser.expect (\" with position \") ?.int () ?;\n\t\t\t\t\tparser.end () ?;\n\t\t\t\t\tOk (Self::SwapPosns (pos_0, pos_1))\n\t\t\t\t})\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tlet ch_0 = parser.expect (\"swap letter \") ?.confirm ().expect_next () ?;\n\t\t\t\t\tlet ch_1 = parser.expect (\" with letter \") ?.expect_next () ?;\n\t\t\t\t\tparser.end () ?;\n\t\t\t\t\tOk (Self::SwapChars (ch_0, ch_1))\n\t\t\t\t})\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tlet num = parser.expect (\"rotate left \") ?.confirm ().int () ?;\n\t\t\t\t\tparser.expect (if num == 1 { \" step\" } else { \" steps\" }) ?.end () ?;\n\t\t\t\t\tOk (Self::RotLeft (num))\n\t\t\t\t})\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tlet num = parser.expect (\"rotate right \") ?.confirm ().int () ?;\n\t\t\t\t\tparser.expect (if num == 1 { \" step\" } else { \" steps\" }) ?.end () ?;\n\t\t\t\t\tOk (Self::RotRight (num))\n\t\t\t\t})\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tlet ch = parser.expect (\"rotate based on position of letter \") ?.confirm ()\n\t\t\t\t\t\t.expect_next () ?;\n\t\t\t\t\tparser.end () ?;\n\t\t\t\t\tOk (Self::RotChar (ch))\n\t\t\t\t})\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tlet pos_0 = parser.expect (\"reverse positions \") ?.confirm ().int () ?;\n\t\t\t\t\tlet pos_1 = parser.expect (\" through \") ?.int () ?;\n\t\t\t\t\tparser.end () ?;\n\t\t\t\t\tOk (Self::Reverse (pos_0, pos_1))\n\t\t\t\t})\n\t\t\t\t.of (|parser| {\n\t\t\t\t\tlet pos_0 = parser.expect (\"move position \") ?.confirm ().int () ?;\n\t\t\t\t\tlet pos_1 = parser.expect (\" to position \") ?.int () ?;\n\t\t\t\t\tparser.end () ?;\n\t\t\t\t\tOk (Self::Move (pos_0, pos_1))\n\t\t\t\t})\n\t\t\t\t.done ()\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"START_ONE=abcde\",\n\t\t\"START_TWO=fbdecgha\",\n\t\t\"swap position 4 with position 0\",\n\t\t\"swap letter d with letter b\",\n\t\t\"reverse positions 0 through 4\",\n\t\t\"rotate left 1 step\",\n\t\t\"move position 1 to position 4\",\n\t\t\"move position 3 to position 0\",\n\t\t\"rotate based on position of letter b\",\n\t\t\"rotate based on position of letter d\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"decab\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"abcdefgh\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":13,"address":[44115,43219],"length":1,"stats":{"Line":2},"fn_name":null},{"line":14,"address":[43433],"length":1,"stats":{"Line":1},"fn_name":null},{"line":15,"address":[44329],"length":1,"stats":{"Line":1},"fn_name":null},{"line":27,"address":[50688],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":28,"address":[50720],"length":1,"stats":{"Line":1},"fn_name":null},{"line":31,"address":[50816],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":32,"address":[50848],"length":1,"stats":{"Line":1},"fn_name":null},{"line":35,"address":[50944,57172,57148],"length":1,"stats":{"Line":1},"fn_name":"calc_result"},{"line":42,"address":[51066],"length":1,"stats":{"Line":1},"fn_name":null},{"line":43,"address":[51128],"length":1,"stats":{"Line":0},"fn_name":null},{"line":45,"address":[51099,51224],"length":1,"stats":{"Line":2},"fn_name":null},{"line":46,"address":[51379],"length":1,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[51356,51473],"length":1,"stats":{"Line":2},"fn_name":null},{"line":52,"address":[51503,51575],"length":1,"stats":{"Line":2},"fn_name":null},{"line":56,"address":[51582],"length":1,"stats":{"Line":1},"fn_name":null},{"line":57,"address":[51616,51918],"length":1,"stats":{"Line":2},"fn_name":null},{"line":58,"address":[51741,51658],"length":1,"stats":{"Line":2},"fn_name":null},{"line":60,"address":[52155,51847,51990],"length":1,"stats":{"Line":3},"fn_name":null},{"line":61,"address":[55315,55331,52433,52185,52603,55230,52559],"length":1,"stats":{"Line":6},"fn_name":null},{"line":62,"address":[52300],"length":1,"stats":{"Line":1},"fn_name":null},{"line":63,"address":[52335,56600],"length":1,"stats":{"Line":2},"fn_name":null},{"line":64,"address":[56608],"length":1,"stats":{"Line":1},"fn_name":null},{"line":65,"address":[56645],"length":1,"stats":{"Line":1},"fn_name":null},{"line":66,"address":[56777],"length":1,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[56750,56885],"length":1,"stats":{"Line":2},"fn_name":null},{"line":69,"address":[56898],"length":1,"stats":{"Line":1},"fn_name":null},{"line":70,"address":[56951],"length":1,"stats":{"Line":1},"fn_name":null},{"line":71,"address":[56994],"length":1,"stats":{"Line":1},"fn_name":null},{"line":73,"address":[52357],"length":1,"stats":{"Line":1},"fn_name":null},{"line":74,"address":[52407,56527,56281],"length":1,"stats":{"Line":3},"fn_name":null},{"line":75,"address":[56518],"length":1,"stats":{"Line":1},"fn_name":null},{"line":76,"address":[56447,56497],"length":1,"stats":{"Line":2},"fn_name":null},{"line":77,"address":[56567,56471],"length":1,"stats":{"Line":2},"fn_name":null},{"line":78,"address":[56537],"length":1,"stats":{"Line":1},"fn_name":null},{"line":82,"address":[55301,55232],"length":1,"stats":{"Line":1},"fn_name":null},{"line":83,"address":[55929,56018,55246],"length":1,"stats":{"Line":2},"fn_name":null},{"line":84,"address":[56011],"length":1,"stats":{"Line":1},"fn_name":null},{"line":85,"address":[56059],"length":1,"stats":{"Line":1},"fn_name":null},{"line":86,"address":[56152],"length":1,"stats":{"Line":1},"fn_name":null},{"line":87,"address":[56253],"length":1,"stats":{"Line":1},"fn_name":null},{"line":89,"address":[55216,55317],"length":1,"stats":{"Line":1},"fn_name":null},{"line":90,"address":[55430,55275,55341],"length":1,"stats":{"Line":2},"fn_name":null},{"line":91,"address":[55423],"length":1,"stats":{"Line":1},"fn_name":null},{"line":92,"address":[55471],"length":1,"stats":{"Line":1},"fn_name":null},{"line":93,"address":[55686],"length":1,"stats":{"Line":1},"fn_name":null},{"line":94,"address":[55909],"length":1,"stats":{"Line":1},"fn_name":null},{"line":96,"address":[53721],"length":1,"stats":{"Line":1},"fn_name":null},{"line":97,"address":[53743,54390],"length":1,"stats":{"Line":4},"fn_name":null},{"line":98,"address":[54725,54532],"length":1,"stats":{"Line":1},"fn_name":null},{"line":99,"address":[54718],"length":1,"stats":{"Line":1},"fn_name":null},{"line":100,"address":[54766],"length":1,"stats":{"Line":1},"fn_name":null},{"line":101,"address":[54981],"length":1,"stats":{"Line":1},"fn_name":null},{"line":102,"address":[55204],"length":1,"stats":{"Line":1},"fn_name":null},{"line":105,"address":[53769],"length":1,"stats":{"Line":1},"fn_name":null},{"line":106,"address":[53791],"length":1,"stats":{"Line":3},"fn_name":null},{"line":107,"address":[53972],"length":1,"stats":{"Line":1},"fn_name":null},{"line":108,"address":[54035],"length":1,"stats":{"Line":0},"fn_name":null},{"line":109,"address":[54091],"length":1,"stats":{"Line":0},"fn_name":null},{"line":112,"address":[54153],"length":1,"stats":{"Line":1},"fn_name":null},{"line":113,"address":[54168],"length":1,"stats":{"Line":1},"fn_name":null},{"line":114,"address":[54261],"length":1,"stats":{"Line":1},"fn_name":null},{"line":115,"address":[54362],"length":1,"stats":{"Line":1},"fn_name":null},{"line":118,"address":[52502],"length":1,"stats":{"Line":1},"fn_name":null},{"line":119,"address":[52537,53031],"length":1,"stats":{"Line":2},"fn_name":null},{"line":120,"address":[53039],"length":1,"stats":{"Line":1},"fn_name":null},{"line":121,"address":[53074],"length":1,"stats":{"Line":1},"fn_name":null},{"line":122,"address":[53249],"length":1,"stats":{"Line":0},"fn_name":null},{"line":124,"address":[53226,53686],"length":1,"stats":{"Line":2},"fn_name":null},{"line":125,"address":[53332],"length":1,"stats":{"Line":1},"fn_name":null},{"line":126,"address":[53394],"length":1,"stats":{"Line":1},"fn_name":null},{"line":127,"address":[53456],"length":1,"stats":{"Line":1},"fn_name":null},{"line":128,"address":[53511],"length":1,"stats":{"Line":1},"fn_name":null},{"line":129,"address":[53638,53566],"length":1,"stats":{"Line":1},"fn_name":null},{"line":130,"address":[53609,53678,53691],"length":1,"stats":{"Line":2},"fn_name":null},{"line":133,"address":[52575,52605],"length":1,"stats":{"Line":2},"fn_name":null},{"line":134,"address":[52633],"length":1,"stats":{"Line":1},"fn_name":null},{"line":135,"address":[52675],"length":1,"stats":{"Line":1},"fn_name":null},{"line":136,"address":[52725],"length":1,"stats":{"Line":1},"fn_name":null},{"line":137,"address":[52874],"length":1,"stats":{"Line":0},"fn_name":null},{"line":139,"address":[52989,52845],"length":1,"stats":{"Line":2},"fn_name":null},{"line":140,"address":[53004],"length":1,"stats":{"Line":1},"fn_name":null},{"line":147,"address":[52085,57051],"length":1,"stats":{"Line":2},"fn_name":null},{"line":148,"address":[57066],"length":1,"stats":{"Line":1},"fn_name":null},{"line":179,"address":[66064,67414],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":180,"address":[66274,66091],"length":1,"stats":{"Line":1},"fn_name":null},{"line":181,"address":[66224,66371,66520],"length":1,"stats":{"Line":2},"fn_name":null},{"line":182,"address":[66481,66891,66673],"length":1,"stats":{"Line":2},"fn_name":null},{"line":183,"address":[110624,110652,110733],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":185,"address":[110662,110708,110752,110787],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":186,"address":[110816,110688,111197],"length":1,"stats":{"Line":1},"fn_name":"{closure#1}"},{"line":187,"address":[110894,111045,110984],"length":1,"stats":{"Line":0},"fn_name":null},{"line":188,"address":[110859,110920,111010],"length":1,"stats":{"Line":0},"fn_name":null},{"line":191,"address":[67333,67000,66840],"length":1,"stats":{"Line":2},"fn_name":null},{"line":192,"address":[67015],"length":1,"stats":{"Line":1},"fn_name":null},{"line":198,"address":[67440],"length":1,"stats":{"Line":1},"fn_name":"from_parser"},{"line":199,"address":[67464],"length":1,"stats":{"Line":1},"fn_name":null},{"line":200,"address":[111216,111693,112338],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":201,"address":[111262,111474,111576],"length":1,"stats":{"Line":2},"fn_name":null},{"line":202,"address":[111701,111987,111541,111898],"length":1,"stats":{"Line":3},"fn_name":null},{"line":203,"address":[112108,112184,111967],"length":1,"stats":{"Line":2},"fn_name":null},{"line":204,"address":[112310,112164],"length":1,"stats":{"Line":2},"fn_name":null},{"line":206,"address":[112829,113474,112352],"length":1,"stats":{"Line":3},"fn_name":"{closure#1}"},{"line":207,"address":[112398,112610,112712],"length":1,"stats":{"Line":2},"fn_name":null},{"line":208,"address":[112837,113034,113123,112677],"length":1,"stats":{"Line":3},"fn_name":null},{"line":209,"address":[113320,113103,113244],"length":1,"stats":{"Line":2},"fn_name":null},{"line":210,"address":[113300,113446],"length":1,"stats":{"Line":2},"fn_name":null},{"line":212,"address":[113488,114462,113941],"length":1,"stats":{"Line":3},"fn_name":"{closure#2}"},{"line":213,"address":[113824,113534,113743],"length":1,"stats":{"Line":2},"fn_name":null},{"line":214,"address":[113949,114308,113805,114236],"length":1,"stats":{"Line":3},"fn_name":null},{"line":215,"address":[114288,114434],"length":1,"stats":{"Line":2},"fn_name":null},{"line":217,"address":[114933,114480,115454],"length":1,"stats":{"Line":2},"fn_name":"{closure#3}"},{"line":218,"address":[114526,114735,114816],"length":1,"stats":{"Line":1},"fn_name":null},{"line":219,"address":[115228,114941,114797,115300],"length":1,"stats":{"Line":0},"fn_name":null},{"line":220,"address":[115280,115426],"length":1,"stats":{"Line":0},"fn_name":null},{"line":222,"address":[116171,115472,115937],"length":1,"stats":{"Line":3},"fn_name":"{closure#4}"},{"line":223,"address":[115518,115907,115730],"length":1,"stats":{"Line":2},"fn_name":null},{"line":224,"address":[115820,115927],"length":1,"stats":{"Line":0},"fn_name":null},{"line":225,"address":[116017,115945,115797],"length":1,"stats":{"Line":2},"fn_name":null},{"line":226,"address":[116143,115997],"length":1,"stats":{"Line":2},"fn_name":null},{"line":228,"address":[116653,116176,117298],"length":1,"stats":{"Line":3},"fn_name":"{closure#5}"},{"line":229,"address":[116434,116536,116222],"length":1,"stats":{"Line":2},"fn_name":null},{"line":230,"address":[116947,116661,116501,116858],"length":1,"stats":{"Line":3},"fn_name":null},{"line":231,"address":[117068,117144,116927],"length":1,"stats":{"Line":2},"fn_name":null},{"line":232,"address":[117270,117124],"length":1,"stats":{"Line":2},"fn_name":null},{"line":234,"address":[118434,117312,117789],"length":1,"stats":{"Line":3},"fn_name":"{closure#6}"},{"line":235,"address":[117570,117358,117672],"length":1,"stats":{"Line":2},"fn_name":null},{"line":236,"address":[117994,117797,117637,118083],"length":1,"stats":{"Line":3},"fn_name":null},{"line":237,"address":[118280,118204,118063],"length":1,"stats":{"Line":2},"fn_name":null},{"line":238,"address":[118260,118406],"length":1,"stats":{"Line":2},"fn_name":null},{"line":265,"address":[31248,31253],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":266,"address":[74375],"length":1,"stats":{"Line":1},"fn_name":null},{"line":267,"address":[74472,74398,74538],"length":1,"stats":{"Line":3},"fn_name":null},{"line":271,"address":[31285,31280],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":272,"address":[75015],"length":1,"stats":{"Line":1},"fn_name":null},{"line":273,"address":[75038,75112,75178],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":123,"coverable":135},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-22","src","lib.rs"],"content":"//! Advent of Code 2016: Day 22: Grid Computing\n//!\n//! [https://adventofcode.com/2016/day/22](https://adventofcode.com/2016/day/22)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\nuse aoc_grid as grid;\nuse aoc_pos as pos;\n\npuzzle_info! {\n\tname = \"Grid Computing\";\n\tyear = 2016;\n\tday = 22;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\tuse model::Pos;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cusize\u003e {\n\t\tOk (\n\t\t\tinput.nodes.iter ()\n\t\t\t\t.filter (|node_a| node_a.used \u003e 0)\n\t\t\t\t.map (|node_a| input.nodes.iter ()\n\t\t\t\t\t.filter (|node_b| node_a.pos != node_b.pos)\n\t\t\t\t\t.filter (|node_b| node_a.used \u003c= node_b.avail)\n\t\t\t\t\t.count ())\n\t\t\t\t.sum ()\n\t\t)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cusize\u003e {\n\n\t\t#[ derive (Clone, Copy, Debug, Eq, Hash, Ord, PartialEq, PartialOrd) ]\n\t\tstruct State { data: Pos, empty: Pos }\n\n\t\ttype Walls = grid::Grid \u003cVec \u003cbool\u003e, Pos\u003e;\n\n\t\tlet empty_start =\n\t\t\tinput.nodes.iter ()\n\t\t\t\t.filter (|node| node.used == 0)\n\t\t\t\t.map (|node| node.pos)\n\t\t\t\t.exactly_one ()\n\t\t\t\t.map_err (|_err| \"Must have exactly one empty node\") ?;\n\n\t\tlet lowest = input.nodes.iter ().filter (|node| node.used \u003e 0).map (|node| node.used).min ().unwrap ();\n\n\t\tlet grid_size = [input.width.as_usize (), input.height.as_usize ()];\n\t\tlet mut walls = Walls::new_vec ([0, 0], grid_size);\n\t\tfor node in input.nodes.iter () {\n\t\t\twalls.set (node.pos, node.used \u003e lowest * 2);\n\t\t}\n\n\t\tlet state = State { data: input.start, empty: empty_start };\n\n\t\tlet mut seen: HashSet \u003cState\u003e = HashSet::new ();\n\t\tseen.insert (state);\n\n\t\tlet mut todo: VecDeque \u003c(usize, State)\u003e = VecDeque::new ();\n\t\ttodo.push_back ((0, state));\n\n\t\twhile let Some ((dist, state)) = todo.pop_front () {\n\t\t\tif state.data == input.end { return Ok (dist) }\n\t\t\tfor from_pos in state.empty.adjacent_4 () {\n\t\t\t\tif walls.get (from_pos).unwrap_or (true) { continue }\n\t\t\t\tlet new_state = State {\n\t\t\t\t\tdata: if from_pos == state.data { state.empty } else { state.data },\n\t\t\t\t\tempty: from_pos,\n\t\t\t\t};\n\t\t\t\tif seen.insert (new_state) {\n\t\t\t\t\ttodo.push_back ((dist + 1, new_state));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tErr (\"No solution found\".into ())\n\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse parser::*;\n\n\tpub type Coord = u8;\n\tpub type Size = u16;\n\tpub type Pos = pos::PosXY \u003cCoord\u003e;\n\n\t#[ derive (Clone, Debug, Eq, PartialEq) ]\n\tpub struct Input {\n\t\tpub nodes: Vec \u003cNode\u003e,\n\t\tpub width: Coord,\n\t\tpub height: Coord,\n\t\tpub start: Pos,\n\t\tpub end: Pos,\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\n\tpub struct Node {\n\t\tpub pos: Pos,\n\t\tpub size: Size,\n\t\tpub used: Size,\n\t\tpub avail: Size,\n\t}\n\n\timpl Input {\n\n\t\tpub fn parse (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tif input.len () \u003c 2\n\t\t\t\t\t|| input [0] != \"root@ebhq-gridcenter# df -h\"\n\t\t\t\t\t|| input [1] != \"Filesystem              Size  Used  Avail  Use%\" {\n\t\t\t\treturn Err (\"Invalid input\".into ());\n\t\t\t}\n\t\t\tlet nodes: Vec \u003cNode\u003e = input.iter ()\n\t\t\t\t.enumerate ()\n\t\t\t\t.skip (2)\n\t\t\t\t.map (|(line_idx, line)| {\n\t\t\t\t\t#[ allow (clippy::redundant_closure_for_method_calls) ]\n\t\t\t\t\tParser::wrap (line, |parser| parser.item ())\n\t\t\t\t\t\t.map_parse_err (|col_idx|\n\t\t\t\t\t\t\tformat! (\"Invalid input: line {}: col {}: {}\",\n\t\t\t\t\t\t\t\tline_idx + 1, col_idx + 1, line))\n\t\t\t\t})\n\t\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e () ?;\n\t\t\tif nodes.is_empty () { return Err (\"Must have at least one node\".into ()) }\n\t\t\tlet width = nodes.iter ().map (|\u0026 node| node.pos.x + 1).max ().unwrap ();\n\t\t\tlet height = nodes.iter ().map (|\u0026 node| node.pos.y + 1).max ().unwrap ();\n\t\t\tlet start = Pos { x: width - 1, y: 0 };\n\t\t\tlet end = Pos { x: 0, y: 0 };\n\t\t\tOk (Self { nodes, width, height, start, end })\n\t\t}\n\n\t}\n\n\timpl FromParser for Node {\n\t\tfn from_parser (parser: \u0026 mut Parser) -\u003e ParseResult \u003cSelf\u003e {\n\n\t\t\tlet x = parser.expect (\"/dev/grid/node-x\") ?.int () ?;\n\t\t\tif x == Coord::MAX { return Err (parser.err ()) }\n\n\t\t\tlet y = parser.expect (\"-y\") ?.int () ?;\n\t\t\tif y == Coord::MAX { return Err (parser.err ()) }\n\n\t\t\tlet pos = Pos { x, y };\n\n\t\t\tlet size: Size = parser.skip_whitespace ().int () ?;\n\n\t\t\tlet used = parser.expect (\"T\") ?.skip_whitespace ().int () ?;\n\t\t\tif used \u003e size { return Err (parser.err ()) }\n\n\t\t\tlet avail = parser.expect (\"T\") ?.skip_whitespace ().int () ?;\n\t\t\tif avail \u003e size { return Err (parser.err ()) }\n\t\t\tif Size::add_2 (used, avail) ? != size { return Err (parser.err ()) }\n\n\t\t\tlet use_pc: u8 = parser.expect (\"T\") ?.skip_whitespace ().int () ?;\n\t\t\tlet expect_pc = Size::div_2 (Size::mul_2 (used, 100) ?, size) ?;\n\t\t\tif use_pc.as_u16 () != expect_pc { return Err (parser.err ()) }\n\n\t\t\tparser.expect (\"%\") ?.end () ?;\n\n\t\t\tOk (Self { pos, size, used, avail })\n\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"root@ebhq-gridcenter# df -h\",\n\t\t\"Filesystem              Size  Used  Avail  Use%\",\n\t\t\"/dev/grid/node-x0-y0     93T   68T    25T   73%\",\n\t\t\"/dev/grid/node-x0-y1     91T   69T    22T   75%\",\n\t\t\"/dev/grid/node-x0-y2     92T   68T    24T   73%\",\n\t\t\"/dev/grid/node-x0-y3     92T   73T    19T   79%\",\n\t\t\"/dev/grid/node-x0-y4     89T   69T    20T   77%\",\n\t\t\"/dev/grid/node-x1-y0     89T   65T    24T   73%\",\n\t\t\"/dev/grid/node-x1-y1     89T   71T    18T   79%\",\n\t\t\"/dev/grid/node-x1-y2     88T   73T    15T   82%\",\n\t\t\"/dev/grid/node-x1-y3     93T   68T    25T   73%\",\n\t\t\"/dev/grid/node-x1-y4     91T   68T    23T   74%\",\n\t\t\"/dev/grid/node-x2-y0     94T   73T    21T   77%\",\n\t\t\"/dev/grid/node-x2-y1     93T   67T    26T   72%\",\n\t\t\"/dev/grid/node-x2-y2     87T   69T    18T   79%\",\n\t\t\"/dev/grid/node-x2-y3     86T   66T    20T   76%\",\n\t\t\"/dev/grid/node-x2-y4     94T   68T    26T   72%\",\n\t\t\"/dev/grid/node-x3-y0     94T   65T    29T   69%\",\n\t\t\"/dev/grid/node-x3-y1     87T   71T    16T   81%\",\n\t\t\"/dev/grid/node-x3-y2     91T   0T     91T   0%\",\n\t\t\"/dev/grid/node-x3-y3     94T   69T    25T   73%\",\n\t\t\"/dev/grid/node-x3-y4     90T   73T    17T   81%\",\n\t\t\"/dev/grid/node-x4-y0     86T   69T    17T   80%\",\n\t\t\"/dev/grid/node-x4-y1     92T   72T    20T   78%\",\n\t\t\"/dev/grid/node-x4-y2     94T   64T    30T   68%\",\n\t\t\"/dev/grid/node-x4-y3     85T   64T    21T   75%\",\n\t\t\"/dev/grid/node-x4-y4     92T   68T    24T   73%\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"24\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"18\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":15,"address":[99523,98835],"length":1,"stats":{"Line":2},"fn_name":null},{"line":16,"address":[98941],"length":1,"stats":{"Line":1},"fn_name":null},{"line":17,"address":[99629],"length":1,"stats":{"Line":1},"fn_name":null},{"line":26,"address":[80336],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":28,"address":[80368,80453],"length":1,"stats":{"Line":2},"fn_name":null},{"line":29,"address":[134925,134912],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":30,"address":[80448],"length":1,"stats":{"Line":5},"fn_name":null},{"line":31,"address":[135120,135043,135134],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":32,"address":[135068,135184,135197],"length":1,"stats":{"Line":3},"fn_name":"{closure#1}"},{"line":38,"address":[80512,82873],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":45,"address":[80562,80910],"length":1,"stats":{"Line":1},"fn_name":null},{"line":47,"address":[135232,135245],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":48,"address":[135293,135280],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":50,"address":[80878],"length":1,"stats":{"Line":0},"fn_name":null},{"line":52,"address":[80847,80954],"length":1,"stats":{"Line":6},"fn_name":null},{"line":54,"address":[81130],"length":1,"stats":{"Line":1},"fn_name":null},{"line":55,"address":[81194],"length":1,"stats":{"Line":1},"fn_name":null},{"line":56,"address":[81287,81563,81354],"length":1,"stats":{"Line":3},"fn_name":null},{"line":57,"address":[81579],"length":1,"stats":{"Line":1},"fn_name":null},{"line":60,"address":[81504],"length":1,"stats":{"Line":1},"fn_name":null},{"line":62,"address":[81548],"length":1,"stats":{"Line":1},"fn_name":null},{"line":63,"address":[81706],"length":1,"stats":{"Line":1},"fn_name":null},{"line":65,"address":[81790],"length":1,"stats":{"Line":1},"fn_name":null},{"line":66,"address":[81797,81900],"length":1,"stats":{"Line":2},"fn_name":null},{"line":68,"address":[81918],"length":1,"stats":{"Line":1},"fn_name":null},{"line":69,"address":[82120,81979,82162],"length":1,"stats":{"Line":3},"fn_name":null},{"line":70,"address":[82126,82237],"length":1,"stats":{"Line":2},"fn_name":null},{"line":71,"address":[82470],"length":1,"stats":{"Line":1},"fn_name":null},{"line":73,"address":[82562],"length":1,"stats":{"Line":1},"fn_name":null},{"line":76,"address":[82699],"length":1,"stats":{"Line":1},"fn_name":null},{"line":77,"address":[82757],"length":1,"stats":{"Line":1},"fn_name":null},{"line":82,"address":[82002],"length":1,"stats":{"Line":0},"fn_name":null},{"line":116,"address":[36768,38275],"length":1,"stats":{"Line":2},"fn_name":"parse"},{"line":117,"address":[36938,36974,36823,36851,37066],"length":1,"stats":{"Line":6},"fn_name":null},{"line":118,"address":[36837,36879],"length":1,"stats":{"Line":4},"fn_name":null},{"line":119,"address":[36957,37002],"length":1,"stats":{"Line":4},"fn_name":null},{"line":120,"address":[37117],"length":1,"stats":{"Line":0},"fn_name":null},{"line":122,"address":[37469,37093,37222],"length":1,"stats":{"Line":4},"fn_name":null},{"line":125,"address":[54508,54480,54589],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":127,"address":[54564,54518,54608,54643],"length":1,"stats":{"Line":8},"fn_name":"{closure#0}"},{"line":128,"address":[54544,54672,55053],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":129,"address":[54840,54901,54750],"length":1,"stats":{"Line":0},"fn_name":null},{"line":130,"address":[54776,54866,54715],"length":1,"stats":{"Line":0},"fn_name":null},{"line":133,"address":[37415,37533,37567],"length":1,"stats":{"Line":4},"fn_name":null},{"line":134,"address":[55072,55086],"length":1,"stats":{"Line":8},"fn_name":"{closure#1}"},{"line":135,"address":[55152,55166],"length":1,"stats":{"Line":6},"fn_name":"{closure#2}"},{"line":136,"address":[38243,37941],"length":1,"stats":{"Line":2},"fn_name":null},{"line":137,"address":[37995],"length":1,"stats":{"Line":2},"fn_name":null},{"line":138,"address":[38011],"length":1,"stats":{"Line":2},"fn_name":null},{"line":144,"address":[38304],"length":1,"stats":{"Line":2},"fn_name":"from_parser"},{"line":146,"address":[38334,38556,38629],"length":1,"stats":{"Line":4},"fn_name":null},{"line":147,"address":[38611,38797],"length":1,"stats":{"Line":2},"fn_name":null},{"line":149,"address":[38765,39134,38858,39055],"length":1,"stats":{"Line":6},"fn_name":null},{"line":150,"address":[39299,39119],"length":1,"stats":{"Line":2},"fn_name":null},{"line":152,"address":[39268],"length":1,"stats":{"Line":2},"fn_name":null},{"line":154,"address":[39282,39487,39368],"length":1,"stats":{"Line":4},"fn_name":null},{"line":156,"address":[39608,39910,39455,39807],"length":1,"stats":{"Line":6},"fn_name":null},{"line":157,"address":[40068,39894],"length":1,"stats":{"Line":2},"fn_name":null},{"line":159,"address":[40132,40434,40331,40036],"length":1,"stats":{"Line":6},"fn_name":null},{"line":160,"address":[40418,40593],"length":1,"stats":{"Line":2},"fn_name":null},{"line":161,"address":[40565,40667,40804],"length":1,"stats":{"Line":4},"fn_name":null},{"line":163,"address":[41067,41179,40772,40868],"length":1,"stats":{"Line":6},"fn_name":null},{"line":164,"address":[41310,41149,41540],"length":1,"stats":{"Line":4},"fn_name":null},{"line":165,"address":[41567,41609,41519],"length":1,"stats":{"Line":4},"fn_name":null},{"line":167,"address":[41577,41870,42021,41673],"length":1,"stats":{"Line":6},"fn_name":null},{"line":169,"address":[41938],"length":1,"stats":{"Line":2},"fn_name":null},{"line":212,"address":[58595,58032,58641],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":213,"address":[58039],"length":1,"stats":{"Line":1},"fn_name":null},{"line":214,"address":[58202,58136,58062],"length":1,"stats":{"Line":3},"fn_name":null},{"line":218,"address":[59281,59235,58672],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":219,"address":[58679],"length":1,"stats":{"Line":1},"fn_name":null},{"line":220,"address":[58842,58776,58702],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":67,"coverable":72},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-23","src","lib.rs"],"content":"//! Advent of Code 2016: Day 23: Safe Cracking\n//!\n//! [https://adventofcode.com/2016/day/23](https://adventofcode.com/2016/day/23)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\nuse aoc_2016_cpu as cpu;\n\npuzzle_info! {\n\tname = \"Safe Cracking\";\n\tyear = 2016;\n\tday = 23;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse cpu::Cpu;\n\tuse model::Input;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003ci32\u003e {\n\t\tlet mut cpu = Cpu {\n\t\t\tinstrs: Rc::new (input.instrs.clone ()),\n\t\t\treg_a: 7,\n\t\t\tlimit: 1000,\n\t\t\t.. default ()\n\t\t};\n\t\tcpu.exec () ?;\n\t\tOk (cpu.reg_a)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003ci32\u003e {\n\t\tlet mut cpu = Cpu {\n\t\t\tinstrs: Rc::new (input.instrs.clone ()),\n\t\t\treg_a: 12,\n\t\t\tlimit: 1000,\n\t\t\t.. default ()\n\t\t};\n\t\tcpu.exec () ?;\n\t\tOk (cpu.reg_a)\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse cpu::Instr;\n\tuse parser::*;\n\n\t#[ derive (Clone, Debug, Eq, PartialEq) ]\n\tpub struct Input {\n\t\tpub instrs: Vec \u003cInstr\u003e,\n\t}\n\n\timpl Input {\n\n\t\tpub fn parse (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet instrs: Vec \u003cInstr\u003e = input.iter ()\n\t\t\t\t.enumerate ()\n\t\t\t\t.map (|(line_idx, line)|\n\t\t\t\t\tParser::wrap (line, |parser| {\n\t\t\t\t\t\tlet instr: Instr = parser.item () ?;\n\t\t\t\t\t\tif ! instr.is_v2 () { return Err (parser.err ()) }\n\t\t\t\t\t\tOk (instr)\n\t\t\t\t\t}).map_parse_err (|col_idx|\n\t\t\t\t\t\tformat! (\"Invalid input: line {}: col {}: {}\",\n\t\t\t\t\t\t\tline_idx + 1, col_idx + 1, line)))\n\t\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e () ?;\n\t\t\tOk (Self { instrs })\n\t\t}\n\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"cpy 2 a\",\n\t\t\"tgl a\",\n\t\t\"tgl a\",\n\t\t\"tgl a\",\n\t\t\"cpy 1 a\",\n\t\t\"dec a\",\n\t\t\"dec a\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"3\", puzzle.part_one (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":14,"address":[51187,51875],"length":1,"stats":{"Line":1},"fn_name":null},{"line":15,"address":[51293],"length":1,"stats":{"Line":1},"fn_name":null},{"line":16,"address":[51981],"length":1,"stats":{"Line":0},"fn_name":null},{"line":25,"address":[26832,27008],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":27,"address":[26857],"length":1,"stats":{"Line":1},"fn_name":null},{"line":32,"address":[27072,27192],"length":1,"stats":{"Line":1},"fn_name":null},{"line":33,"address":[27161],"length":1,"stats":{"Line":1},"fn_name":null},{"line":36,"address":[27296,27472],"length":1,"stats":{"Line":0},"fn_name":"part_two"},{"line":38,"address":[27321],"length":1,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[27536,27656],"length":1,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[27625],"length":1,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[56720],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":63,"address":[57137,56779],"length":1,"stats":{"Line":1},"fn_name":null},{"line":65,"address":[21040,21068,21149],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":66,"address":[21124,21468,21078,21568,21168],"length":1,"stats":{"Line":5},"fn_name":"{closure#0}"},{"line":67,"address":[21214,21353],"length":1,"stats":{"Line":1},"fn_name":null},{"line":68,"address":[21328,21480,21575],"length":1,"stats":{"Line":2},"fn_name":null},{"line":69,"address":[21491],"length":1,"stats":{"Line":1},"fn_name":null},{"line":70,"address":[22029,21104,21648],"length":1,"stats":{"Line":1},"fn_name":"{closure#1}"},{"line":71,"address":[21816,21877,21726],"length":1,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[21691,21752,21842],"length":1,"stats":{"Line":0},"fn_name":null},{"line":74,"address":[56974],"length":1,"stats":{"Line":1},"fn_name":null},{"line":97,"address":[36625,36579,36016],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":98,"address":[36023],"length":1,"stats":{"Line":1},"fn_name":null},{"line":99,"address":[36120,36186,36046],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":18,"coverable":25},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-24","src","lib.rs"],"content":"//! Advent of Code 2016: Day 24: Air Duct Spelunking\n//!\n//! [https://adventofcode.com/2016/day/24](https://adventofcode.com/2016/day/24)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\nuse aoc_grid as grid;\nuse aoc_pos as pos;\nuse aoc_search as search;\n\npuzzle_info! {\n\tname = \"Air Duct Spelunking\";\n\tyear = 2016;\n\tday = 24;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n\tpart_two = |input| logic::part_two (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\tuse model::Pos;\n\tuse model::Tile;\n\tuse search::PrioritySearch;\n\tuse search::PrioritySearchAdder;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003cu32\u003e {\n\t\tcalc_result (input, false)\n\t}\n\n\tpub fn part_two (input: \u0026 Input) -\u003e GenResult \u003cu32\u003e {\n\t\tcalc_result (input, true)\n\t}\n\n\tfn calc_result (input: \u0026 Input, round_trip: bool) -\u003e GenResult \u003cu32\u003e {\n\n\t\t// find list of numbers in grid\n\n\t\tlet nums: Vec \u003c(u8, Pos)\u003e =\n\t\t\tinput.tiles.iter ()\n\t\t\t\t.filter_map (|(pos, tile)| match tile {\n\t\t\t\t\tTile::Num (num) =\u003e Some ((num, pos)),\n\t\t\t\t\tTile::Wall | Tile::Open =\u003e None,\n\t\t\t\t})\n\t\t\t\t.collect ();\n\n\t\t// check for duplicates\n\n\t\tif nums.iter ().map (|\u0026 (num, _)| num).sorted ().dedup ().count () != nums.len () {\n\t\t\treturn Err (\"Duplicated nums\".into ());\n\t\t}\n\n\t\t// convert to map\n\n\t\tlet nums: HashMap \u003cu8, Pos\u003e = nums.into_iter ().collect ();\n\n\t\t// check start exists\n\n\t\tif ! nums.contains_key (\u0026 0_u8) {\n\t\t\treturn Err (\"No starting position\".into ());\n\t\t}\n\n\t\t// work out distances\n\n\t\tlet mut dists: HashMap \u003c(u8, u8), u32\u003e = HashMap::new ();\n\t\tfor (\u0026 start_num, \u0026 start_pos) in nums.iter () {\n\t\t\tlet mut seen: HashSet \u003cPos\u003e = HashSet::new ();\n\t\t\tseen.insert (start_pos);\n\t\t\tlet mut todo: VecDeque \u003c(u32, Pos)\u003e = VecDeque::new ();\n\t\t\ttodo.push_back ((0, start_pos));\n\t\t\twhile let Some ((dist, pos)) = todo.pop_front () {\n\t\t\t\tfor adj_pos in pos.adjacent_4 () {\n\t\t\t\t\tlet adj_tile = some_or! (input.tiles.get (adj_pos), continue);\n\t\t\t\t\tif adj_tile == Tile::Wall { continue }\n\t\t\t\t\tif ! seen.insert (adj_pos) { continue }\n\t\t\t\t\ttodo.push_back ((dist + 1, adj_pos));\n\t\t\t\t\tif let Tile::Num (num) = adj_tile {\n\t\t\t\t\t\tdists.insert ((start_num, num), dist + 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// check everything is connected\n\n\t\tif dists.len () != nums.len () * (nums.len () - 1) {\n\t\t\treturn Err (\"No solution found1\".into ());\n\t\t}\n\n\t\t// setup priority search\n\n\t\tlet mut search = PrioritySearch::with_hash_map (\n\t\t\t|route: Vec \u003cu8\u003e, dist, mut adder: PrioritySearchAdder \u003c_, _, _\u003e| {\n\t\t\t\tfor (\u0026 (from, to), \u0026 next_dist) in dists.iter () {\n\t\t\t\t\tif route.last () != Some (\u0026 from) { continue }\n\t\t\t\t\tif route.len () \u003c nums.len () \u0026\u0026 route.contains (\u0026 to) { continue }\n\t\t\t\t\tif route.len () == nums.len () \u0026\u0026 to != 0 { continue }\n\t\t\t\t\tif route.len () \u003e nums.len () { continue }\n\t\t\t\t\tlet mut new_route = route.clone ();\n\t\t\t\t\tnew_route.push (to);\n\t\t\t\t\tadder.add (new_route.clone (), dist + next_dist);\n\t\t\t\t}\n\t\t\t\t(route, dist)\n\t\t\t});\n\n\t\t// find best route\n\n\t\tsearch\n\t\t\t.push (vec! [ 0_u8 ], 0)\n\t\t\t.filter (|\u0026 (ref route, _)| route.len () ==\n\t\t\t\tif round_trip { nums.len () + 1 } else { nums.len () })\n\t\t\t.map (|(_, dist)| dist)\n\t\t\t.next ()\n\t\t\t.ok_or_else (|| \"No solution found\".into ())\n\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse parser::*;\n\n\tpub type Coord = u16;\n\tpub type Grid = grid::Grid \u003cVec \u003cTile\u003e, Pos\u003e;\n\tpub type Pos = pos::PosRowCol \u003cu16\u003e;\n\n\t#[ derive (Clone, Debug, Eq, PartialEq) ]\n\tpub struct Input {\n\t\tpub tiles: Grid,\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\n\tpub enum Tile { Wall, Open, Num (u8) }\n\n\timpl Input {\n\n\t\tpub fn parse (input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet height = input.len ();\n\t\t\tlet width = input [0].chars ().count ();\n\t\t\tif width == 0 || height == 0\n\t\t\t\t\t|| input.iter ().any (|line| line.chars ().count () != width) {\n\t\t\t\treturn Err (\"Invalid input\".into ());\n\t\t\t}\n\t\t\tlet tiles_vec: Vec \u003cTile\u003e = input.iter ()\n\t\t\t\t.enumerate ()\n\t\t\t\t.map (|(line_idx, line)|\n\t\t\t\t\tParser::wrap (line, |parser| {\n\t\t\t\t\t\tlet items: Vec \u003c_\u003e =\n\t\t\t\t\t\t\t\titer::from_fn (|| Some (parser.item ()))\n\t\t\t\t\t\t\t.take (width)\n\t\t\t\t\t\t\t.collect::\u003cParseResult \u003c_\u003e\u003e () ?;\n\t\t\t\t\t\tparser.end () ?;\n\t\t\t\t\t\tOk (items)\n\t\t\t\t\t}).map_parse_err (|col_idx|\n\t\t\t\t\t\tformat! (\"Invalid input: line {}: col {}: {}\",\n\t\t\t\t\t\t\tline_idx + 1, col_idx + 1, line)))\n\t\t\t\t.flatten_ok ()\n\t\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e () ?;\n\t\t\tlet tiles = Grid::wrap (tiles_vec, [0, 0], [ height, width ]);\n\t\t\tOk (Self { tiles })\n\t\t}\n\n\t}\n\n\timpl FromParser for Tile {\n\t\tfn from_parser (parser: \u0026 mut Parser) -\u003e ParseResult \u003cSelf\u003e {\n\t\t\tOk (match parser.expect_next () ? {\n\t\t\t\t'#' =\u003e Self::Wall,\n\t\t\t\t'.' =\u003e Self::Open,\n\t\t\t\tch if ('0' ..= '9').contains (\u0026 ch) =\u003e\n\t\t\t\t\tSelf::Num (ch.to_digit (10).ok_or_else (|| parser.err ()) ?.as_u8 ()),\n\t\t\t\t_ =\u003e return Err (parser.err ()),\n\t\t\t})\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"###########\",\n\t\t\"#0.1.....2#\",\n\t\t\"#.#######.#\",\n\t\t\"#4.......3#\",\n\t\t\"###########\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"14\", puzzle.part_one (EXAMPLE));\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"20\", puzzle.part_two (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":16,"address":[38691,39443],"length":1,"stats":{"Line":2},"fn_name":null},{"line":17,"address":[38867],"length":1,"stats":{"Line":1},"fn_name":null},{"line":18,"address":[39619],"length":1,"stats":{"Line":1},"fn_name":null},{"line":30,"address":[162176],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":31,"address":[162193],"length":1,"stats":{"Line":1},"fn_name":null},{"line":34,"address":[162224],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":35,"address":[162241],"length":1,"stats":{"Line":1},"fn_name":null},{"line":38,"address":[165088,162272,164404],"length":1,"stats":{"Line":1},"fn_name":"calc_result"},{"line":42,"address":[162322],"length":1,"stats":{"Line":1},"fn_name":null},{"line":44,"address":[110976,111021,111150],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":45,"address":[111103],"length":1,"stats":{"Line":1},"fn_name":null},{"line":46,"address":[111084],"length":1,"stats":{"Line":1},"fn_name":null},{"line":52,"address":[111168,111181],"length":1,"stats":{"Line":4},"fn_name":"{closure#1}"},{"line":53,"address":[162727],"length":1,"stats":{"Line":0},"fn_name":null},{"line":58,"address":[162839,162664],"length":1,"stats":{"Line":2},"fn_name":null},{"line":62,"address":[162846,162922],"length":1,"stats":{"Line":2},"fn_name":null},{"line":63,"address":[162943],"length":1,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[162936],"length":1,"stats":{"Line":1},"fn_name":null},{"line":69,"address":[163054,163255,163117],"length":1,"stats":{"Line":3},"fn_name":null},{"line":70,"address":[163325],"length":1,"stats":{"Line":1},"fn_name":null},{"line":71,"address":[163342],"length":1,"stats":{"Line":1},"fn_name":null},{"line":72,"address":[163411],"length":1,"stats":{"Line":1},"fn_name":null},{"line":73,"address":[163518,163428],"length":1,"stats":{"Line":2},"fn_name":null},{"line":74,"address":[163536],"length":1,"stats":{"Line":1},"fn_name":null},{"line":75,"address":[163678,163622],"length":1,"stats":{"Line":2},"fn_name":null},{"line":76,"address":[163952],"length":1,"stats":{"Line":1},"fn_name":null},{"line":77,"address":[164064],"length":1,"stats":{"Line":1},"fn_name":null},{"line":78,"address":[164114],"length":1,"stats":{"Line":1},"fn_name":null},{"line":79,"address":[164157],"length":1,"stats":{"Line":1},"fn_name":null},{"line":80,"address":[164263],"length":1,"stats":{"Line":1},"fn_name":null},{"line":81,"address":[164303],"length":1,"stats":{"Line":1},"fn_name":null},{"line":89,"address":[163240,164423],"length":1,"stats":{"Line":2},"fn_name":null},{"line":90,"address":[164649],"length":1,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[112404,111200,111574],"length":1,"stats":{"Line":3},"fn_name":"{closure#2}"},{"line":97,"address":[111590,111269,111355],"length":1,"stats":{"Line":3},"fn_name":null},{"line":98,"address":[111646],"length":1,"stats":{"Line":1},"fn_name":null},{"line":99,"address":[111767],"length":1,"stats":{"Line":1},"fn_name":null},{"line":100,"address":[111925],"length":1,"stats":{"Line":1},"fn_name":null},{"line":101,"address":[112032],"length":1,"stats":{"Line":1},"fn_name":null},{"line":102,"address":[112099],"length":1,"stats":{"Line":1},"fn_name":null},{"line":103,"address":[112118],"length":1,"stats":{"Line":1},"fn_name":null},{"line":104,"address":[112189,112382],"length":1,"stats":{"Line":1},"fn_name":null},{"line":106,"address":[111501],"length":1,"stats":{"Line":1},"fn_name":null},{"line":111,"address":[164932,164883],"length":1,"stats":{"Line":2},"fn_name":null},{"line":112,"address":[164778,164838],"length":1,"stats":{"Line":2},"fn_name":null},{"line":113,"address":[112464,112599,112432],"length":1,"stats":{"Line":4},"fn_name":"{closure#3}"},{"line":114,"address":[112485],"length":1,"stats":{"Line":1},"fn_name":null},{"line":115,"address":[112624,112646],"length":1,"stats":{"Line":2},"fn_name":"{closure#4}"},{"line":117,"address":[112672,112676],"length":1,"stats":{"Line":0},"fn_name":"{closure#5}"},{"line":142,"address":[70672,71629,71599],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":143,"address":[70715],"length":1,"stats":{"Line":1},"fn_name":null},{"line":144,"address":[70731],"length":1,"stats":{"Line":1},"fn_name":null},{"line":145,"address":[70821,70892,70939],"length":1,"stats":{"Line":2},"fn_name":null},{"line":146,"address":[70906,70871],"length":1,"stats":{"Line":4},"fn_name":null},{"line":147,"address":[70975],"length":1,"stats":{"Line":0},"fn_name":null},{"line":149,"address":[70957,71080,71432,71054],"length":1,"stats":{"Line":3},"fn_name":null},{"line":151,"address":[71067],"length":1,"stats":{"Line":4},"fn_name":null},{"line":152,"address":[200601,200154,200786,200256,200924,200214],"length":1,"stats":{"Line":5},"fn_name":"{closure#0}"},{"line":154,"address":[200978,200341,200574,200299,200960],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":155,"address":[200335],"length":1,"stats":{"Line":1},"fn_name":null},{"line":156,"address":[200487],"length":1,"stats":{"Line":0},"fn_name":null},{"line":157,"address":[200646,200472,200796],"length":1,"stats":{"Line":2},"fn_name":null},{"line":158,"address":[200704],"length":1,"stats":{"Line":1},"fn_name":null},{"line":159,"address":[200614,200194,200909,201040,201421],"length":1,"stats":{"Line":1},"fn_name":"{closure#1}"},{"line":160,"address":[201208,201269,201118],"length":1,"stats":{"Line":0},"fn_name":null},{"line":161,"address":[201144,201234,201083],"length":1,"stats":{"Line":0},"fn_name":null},{"line":164,"address":[71271],"length":1,"stats":{"Line":1},"fn_name":null},{"line":165,"address":[71495],"length":1,"stats":{"Line":1},"fn_name":null},{"line":171,"address":[71648],"length":1,"stats":{"Line":1},"fn_name":"from_parser"},{"line":172,"address":[71678,72257],"length":1,"stats":{"Line":2},"fn_name":null},{"line":173,"address":[71915],"length":1,"stats":{"Line":1},"fn_name":null},{"line":174,"address":[71925],"length":1,"stats":{"Line":1},"fn_name":null},{"line":175,"address":[71939,71968,71878],"length":1,"stats":{"Line":3},"fn_name":null},{"line":176,"address":[71979,72234],"length":1,"stats":{"Line":2},"fn_name":null},{"line":177,"address":[72281,71950],"length":1,"stats":{"Line":0},"fn_name":null},{"line":198,"address":[33925,33920],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":199,"address":[177063],"length":1,"stats":{"Line":1},"fn_name":null},{"line":200,"address":[177226,177086,177160],"length":1,"stats":{"Line":3},"fn_name":null},{"line":204,"address":[33957,33952],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":205,"address":[177703],"length":1,"stats":{"Line":1},"fn_name":null},{"line":206,"address":[177800,177726,177866],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":72,"coverable":81},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","day-25","src","lib.rs"],"content":"//! Advent of Code 2016: Day 25: Clock Signal\n//!\n//! [https://adventofcode.com/2016/day/24](https://adventofcode.com/2016/day/24)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\nuse aoc_2016_cpu as cpu;\n\npuzzle_info! {\n\tname = \"Clock Signal\";\n\tyear = 2016;\n\tday = 25;\n\tparse = |input| model::Input::parse (input);\n\tpart_one = |input| logic::part_one (\u0026 input);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse cpu::Cpu;\n\tuse model::Input;\n\n\tpub fn part_one (input: \u0026 Input) -\u003e GenResult \u003ci32\u003e {\n\t\tfor start in 1_i32 ..= input.limit {\n\t\t\tlet mut cpu = Cpu {\n\t\t\t\tinstrs: Rc::new (input.instrs.clone ()),\n\t\t\t\treg_a: start,\n\t\t\t\tlimit: 900,\n\t\t\t\t.. default ()\n\t\t\t};\n\t\t\tlet mut expect = 0_i32;\n\t\t\tlet mut num = 0_u32;\n\t\t\tlet mut states = HashSet::new ();\n\t\t\twhile let Some (out) = cpu.exec () ? {\n\t\t\t\tif out != expect { break }\n\t\t\t\texpect = if expect == 0_i32 { 1_i32 } else { 0_i32 };\n\t\t\t\tnum += 1;\n\t\t\t\tif num \u003e= 2 \u0026\u0026 ! states.insert ((expect, cpu.next, cpu.reg_a, cpu.reg_b, cpu.reg_c, cpu.reg_d)) {\n\t\t\t\t\treturn Ok (start);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tErr (\"No solution found\".into ())\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse cpu::Instr;\n\tuse parser::*;\n\n\t#[ derive (Clone, Debug, Eq, PartialEq) ]\n\tpub struct Input {\n\t\tpub instrs: Vec \u003cInstr\u003e,\n\t\tpub limit: i32,\n\t}\n\n\timpl Input {\n\n\t\tpub fn parse (mut input: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet limit = parser::input_param (\u0026 mut input, \"LIMIT=\", i32::MAX) ?;\n\t\t\tlet instrs: Vec \u003cInstr\u003e = input.iter ()\n\t\t\t\t.enumerate ()\n\t\t\t\t.map (|(line_idx, line)|\n\t\t\t\t\tParser::wrap (line, |parser| {\n\t\t\t\t\t\tlet instr: Instr = parser.item () ?;\n\t\t\t\t\t\tif ! instr.is_v3 () { return Err (parser.err ()) }\n\t\t\t\t\t\tOk (instr)\n\t\t\t\t\t}).map_parse_err (|col_idx|\n\t\t\t\t\t\tformat! (\"Invalid input: line {}: col {}: {}\",\n\t\t\t\t\t\t\tline_idx + 1, col_idx + 1, line)))\n\t\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e () ?;\n\t\t\tOk (Self { instrs, limit })\n\t\t}\n\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"cpy 10 b\",\n\t\t\"dec a\",\n\t\t\"dec b\",\n\t\t\"jnz b -2\",\n\t\t\"jnz a 4\",\n\t\t\"out 0\",\n\t\t\"out 1\",\n\t\t\"jnz 1 -2\",\n\t];\n\n\t#[ test ]\n\tfn part_one () {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"10\", puzzle.part_one (EXAMPLE));\n\t}\n\n}\n","traces":[{"line":14,"address":[38403],"length":1,"stats":{"Line":1},"fn_name":null},{"line":15,"address":[38509],"length":1,"stats":{"Line":1},"fn_name":null},{"line":24,"address":[27316,26944],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":25,"address":[26974,27096],"length":1,"stats":{"Line":2},"fn_name":null},{"line":27,"address":[27111],"length":1,"stats":{"Line":1},"fn_name":null},{"line":32,"address":[27380],"length":1,"stats":{"Line":1},"fn_name":null},{"line":33,"address":[27391],"length":1,"stats":{"Line":1},"fn_name":null},{"line":34,"address":[27410],"length":1,"stats":{"Line":1},"fn_name":null},{"line":35,"address":[27496,27676,28007,27419],"length":1,"stats":{"Line":4},"fn_name":null},{"line":36,"address":[27690],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[27714,27742],"length":1,"stats":{"Line":2},"fn_name":null},{"line":38,"address":[27824,27780],"length":1,"stats":{"Line":1},"fn_name":null},{"line":39,"address":[27812,27856],"length":1,"stats":{"Line":2},"fn_name":null},{"line":40,"address":[28021],"length":1,"stats":{"Line":1},"fn_name":null},{"line":44,"address":[27058,28074],"length":1,"stats":{"Line":0},"fn_name":null},{"line":63,"address":[59056],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":64,"address":[59083,59201],"length":1,"stats":{"Line":1},"fn_name":null},{"line":65,"address":[59649,59168,59264],"length":1,"stats":{"Line":2},"fn_name":null},{"line":67,"address":[69856,69965,69884],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":68,"address":[70384,70284,69940,69984,69894],"length":1,"stats":{"Line":5},"fn_name":"{closure#0}"},{"line":69,"address":[70169,70030],"length":1,"stats":{"Line":1},"fn_name":null},{"line":70,"address":[70391,70144,70296],"length":1,"stats":{"Line":2},"fn_name":null},{"line":71,"address":[70307],"length":1,"stats":{"Line":1},"fn_name":null},{"line":72,"address":[70464,69920,70845],"length":1,"stats":{"Line":1},"fn_name":"{closure#1}"},{"line":73,"address":[70693,70542,70632],"length":1,"stats":{"Line":0},"fn_name":null},{"line":74,"address":[70658,70568,70507],"length":1,"stats":{"Line":0},"fn_name":null},{"line":76,"address":[59458],"length":1,"stats":{"Line":1},"fn_name":null},{"line":100,"address":[24657,24611,24048],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":101,"address":[24055],"length":1,"stats":{"Line":1},"fn_name":null},{"line":102,"address":[24152,24218,24078],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":27,"coverable":30},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2016","src","lib.rs"],"content":"#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npub use aoc_2016_day_01 as day_01;\npub use aoc_2016_day_02 as day_02;\npub use aoc_2016_day_03 as day_03;\npub use aoc_2016_day_04 as day_04;\npub use aoc_2016_day_05 as day_05;\npub use aoc_2016_day_06 as day_06;\npub use aoc_2016_day_07 as day_07;\npub use aoc_2016_day_08 as day_08;\npub use aoc_2016_day_09 as day_09;\npub use aoc_2016_day_10 as day_10;\npub use aoc_2016_day_11 as day_11;\npub use aoc_2016_day_12 as day_12;\npub use aoc_2016_day_13 as day_13;\npub use aoc_2016_day_14 as day_14;\npub use aoc_2016_day_15 as day_15;\npub use aoc_2016_day_16 as day_16;\npub use aoc_2016_day_17 as day_17;\npub use aoc_2016_day_18 as day_18;\npub use aoc_2016_day_19 as day_19;\npub use aoc_2016_day_20 as day_20;\npub use aoc_2016_day_21 as day_21;\npub use aoc_2016_day_22 as day_22;\npub use aoc_2016_day_23 as day_23;\npub use aoc_2016_day_24 as day_24;\npub use aoc_2016_day_25 as day_25;\n\n#[ must_use ]\npub fn puzzle_metadata () -\u003e Vec \u003cBox \u003cdyn puzzle::Puzzle\u003e\u003e {\n\tvec! [\n\t\tday_01::puzzle_metadata (),\n\t\tday_02::puzzle_metadata (),\n\t\tday_03::puzzle_metadata (),\n\t\tday_04::puzzle_metadata (),\n\t\tday_05::puzzle_metadata (),\n\t\tday_06::puzzle_metadata (),\n\t\tday_07::puzzle_metadata (),\n\t\tday_08::puzzle_metadata (),\n\t\tday_09::puzzle_metadata (),\n\t\tday_10::puzzle_metadata (),\n\t\tday_11::puzzle_metadata (),\n\t\tday_12::puzzle_metadata (),\n\t\tday_13::puzzle_metadata (),\n\t\tday_14::puzzle_metadata (),\n\t\tday_15::puzzle_metadata (),\n\t\tday_16::puzzle_metadata (),\n\t\tday_17::puzzle_metadata (),\n\t\tday_18::puzzle_metadata (),\n\t\tday_19::puzzle_metadata (),\n\t\tday_20::puzzle_metadata (),\n\t\tday_21::puzzle_metadata (),\n\t\tday_22::puzzle_metadata (),\n\t\tday_23::puzzle_metadata (),\n\t\tday_24::puzzle_metadata (),\n\t\tday_25::puzzle_metadata (),\n\t]\n}\n","traces":[{"line":32,"address":[14789,11616],"length":1,"stats":{"Line":0},"fn_name":"puzzle_metadata"},{"line":33,"address":[11808,13405,12408,12608,13760,13936,11713,14024,13208,11639,12208,11908,13848,13584,12308,13008,12708,12008,12808,13672,12108,13108,13308,12908,13496,12508],"length":1,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[11765,11678],"length":1,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[11865,11781],"length":1,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[11965,11881],"length":1,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[11981,12065],"length":1,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[12081,12165],"length":1,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[12181,12265],"length":1,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[12365,12281],"length":1,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[13713,13793],"length":1,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[13809,13889],"length":1,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[13985,13905],"length":1,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[14081,14001],"length":1,"stats":{"Line":0},"fn_name":null},{"line":45,"address":[14097,14177],"length":1,"stats":{"Line":0},"fn_name":null},{"line":46,"address":[12881,12965],"length":1,"stats":{"Line":0},"fn_name":null},{"line":47,"address":[12981,13065],"length":1,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[13081,13165],"length":1,"stats":{"Line":0},"fn_name":null},{"line":49,"address":[14561,14481],"length":1,"stats":{"Line":0},"fn_name":null},{"line":50,"address":[13365,13281],"length":1,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[14747,14673],"length":1,"stats":{"Line":0},"fn_name":null},{"line":52,"address":[14831,14763],"length":1,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[14915,14847],"length":1,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[14931,14999],"length":1,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[15015,15083],"length":1,"stats":{"Line":0},"fn_name":null},{"line":56,"address":[15167,15099],"length":1,"stats":{"Line":0},"fn_name":null},{"line":57,"address":[15251,15183],"length":1,"stats":{"Line":0},"fn_name":null},{"line":58,"address":[15267],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":27},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","parse-display","parse-display","src","lib.rs"],"content":"// #![include_doc(\"../../README.md\", start(\"This crate provides derive macro `Display` and `FromStr`.\"))]\n//! This crate provides derive macro `Display` and `FromStr`.\n//! These macros use common helper attributes to specify the format.\n//!\n//! ## Install\n//!\n//! Add this to your Cargo.toml:\n//!\n//! ```toml\n//! [dependencies]\n//! parse-display = \"0.5.5\"\n//! ```\n//!\n//! ## Example\n//!\n//! ```rust\n//! use parse_display::{Display, FromStr};\n//!\n//! #[derive(Display, FromStr, PartialEq, Debug)]\n//! #[display(\"{a}-{b}\")]\n//! struct MyStruct {\n//!   a: u32,\n//!   b: u32,\n//! }\n//! assert_eq!(MyStruct { a:10, b:20 }.to_string(), \"10-20\");\n//! assert_eq!(\"10-20\".parse(), Ok(MyStruct { a:10, b:20 }));\n//!\n//!\n//! #[derive(Display, FromStr, PartialEq, Debug)]\n//! #[display(style = \"snake_case\")]\n//! enum MyEnum {\n//!   VarA,\n//!   VarB,\n//! }\n//! assert_eq!(MyEnum::VarA.to_string(), \"var_a\");\n//! assert_eq!(\"var_a\".parse(), Ok(MyEnum::VarA));\n//! ```\n//!\n//! ## Helper attributes\n//!\n//! Helper attributes can be written in the following positions.\n//!\n//! | attribute                                                     | struct | enum | variant | field |\n//! | ------------------------------------------------------------- | ------ | ---- | ------- | ----- |\n//! | [`#[display(\"...\")]`](#display)                               | ✔      | ✔    | ✔       | ✔     |\n//! | [`#[display(style = \"...\")]`](#displaystyle--)                |        | ✔    | ✔       |       |\n//! | [`#[display(bound(...))]`](#displaybound)                     | ✔      | ✔    | ✔       | ✔     |\n//! | [`#[from_str(bound(...))]`](#from_strbound)                   | ✔      | ✔    | ✔       | ✔     |\n//! | [`#[from_str(regex = \"...\")]`](#from_strregex--)              | ✔      | ✔    | ✔       | ✔     |\n//! | [`#[from_str(new = ...)]`](#from_strnew--)                    | ✔      |      | ✔       |       |\n//! | [`#[from_str(default)]`](#from_strdefault)                    | ✔      |      |         | ✔     |\n//! | [`#[from_str(default_fields(...))]`](#from_strdefault_fields) | ✔      | ✔    | ✔       |       |\n//!\n//! `#[derive(Display)]` use `#[display]`.\n//! `#[derive(FromStr)]` use both `#[display]` and `#[from_str]`.\n//!\n//! `key = value` style parameter can be specified only once for each key.\n//! `key(value1, value2, ...)` style parameter can be specified multiple times.\n//!\n//! ## `#[display(\"...\")]`\n//!\n//! Specifies the format using a syntax similar to `std::format!()`.\n//! However, unlike `std::format!()`, field name is specified in `{}`.\n//!\n//! ### Struct format\n//!\n//! By writing `#[display(\"..\")]`, you can specify the format used by `Display` and `FromStr`.\n//!\n//! ```rust\n//! use parse_display::{Display, FromStr};\n//!\n//! #[derive(Display, FromStr, PartialEq, Debug)]\n//! #[display(\"{a}-{b}\")]\n//! struct MyStruct {\n//!   a: u32,\n//!   b: u32,\n//! }\n//! assert_eq!(MyStruct { a:10, b:20 }.to_string(), \"10-20\");\n//! assert_eq!(\"10-20\".parse(), Ok(MyStruct { a:10, b:20 }));\n//!\n//! #[derive(Display, FromStr, PartialEq, Debug)]\n//! #[display(\"{0}+{1}\")]\n//! struct MyTuple(u32, u32);\n//! assert_eq!(MyTuple(10, 20).to_string(), \"10+20\");\n//! assert_eq!(\"10+20\".parse(), Ok(MyTuple(10, 20)));\n//! ```\n//!\n//! ### Newtype pattern\n//!\n//! If the struct has only one field, the format can be omitted.\n//! In this case, the only field is used.\n//!\n//! ```rust\n//! use parse_display::{Display, FromStr};\n//!\n//! #[derive(Display, FromStr, PartialEq, Debug)]\n//! struct NewType(u32);\n//! assert_eq!(NewType(10).to_string(), \"10\");\n//! assert_eq!(\"10\".parse(), Ok(NewType(10)));\n//! ```\n//!\n//! ### Enum format\n//!\n//! In enum, you can specify the format for each variant.\n//!\n//! ```rust\n//! use parse_display::{Display, FromStr};\n//!\n//! #[derive(Display, FromStr, PartialEq, Debug)]\n//! enum MyEnum {\n//!   #[display(\"aaa\")]\n//!   VarA,\n//!   #[display(\"bbb\")]\n//!   VarB,\n//! }\n//! assert_eq!(MyEnum::VarA.to_string(), \"aaa\");\n//! assert_eq!(MyEnum::VarB.to_string(), \"bbb\");\n//! assert_eq!(\"aaa\".parse(), Ok(MyEnum::VarA));\n//! assert_eq!(\"bbb\".parse(), Ok(MyEnum::VarB));\n//! ```\n//!\n//! In enum format, `{}` means variant name.\n//! Variant name style (e.g. snake_case, camelCase, ...) can be specified by [`#[from_str(style = \"...\")]`](#displaystyle--).\n//!\n//! ```rust\n//! use parse_display::{Display, FromStr};\n//!\n//! #[derive(Display, FromStr, PartialEq, Debug)]\n//! enum MyEnum {\n//!   #[display(\"aaa-{}\")]\n//!   VarA,\n//!   #[display(\"bbb-{}\")]\n//!   VarB,\n//! }\n//! assert_eq!(MyEnum::VarA.to_string(), \"aaa-VarA\");\n//! assert_eq!(MyEnum::VarB.to_string(), \"bbb-VarB\");\n//! assert_eq!(\"aaa-VarA\".parse(), Ok(MyEnum::VarA));\n//! assert_eq!(\"bbb-VarB\".parse(), Ok(MyEnum::VarB));\n//!\n//! #[derive(Display, FromStr, PartialEq, Debug)]\n//! #[display(style = \"snake_case\")]\n//! enum MyEnumSnake {\n//!   #[display(\"{}\")]\n//!   VarA,\n//! }\n//! assert_eq!(MyEnumSnake::VarA.to_string(), \"var_a\");\n//! assert_eq!(\"var_a\".parse(), Ok(MyEnumSnake::VarA));\n//! ```\n//!\n//! By writing a format on enum instead of variant, you can specify the format common to multiple variants.\n//!\n//! ```rust\n//! use parse_display::{Display, FromStr};\n//!\n//! #[derive(Display, FromStr, PartialEq, Debug)]\n//! #[display(\"xxx-{}\")]\n//! enum MyEnum {\n//!   VarA,\n//!   VarB,\n//! }\n//! assert_eq!(MyEnum::VarA.to_string(), \"xxx-VarA\");\n//! assert_eq!(MyEnum::VarB.to_string(), \"xxx-VarB\");\n//! assert_eq!(\"xxx-VarA\".parse(), Ok(MyEnum::VarA));\n//! assert_eq!(\"xxx-VarB\".parse(), Ok(MyEnum::VarB));\n//! ```\n//!\n//! ### Unit variants\n//!\n//! If all variants has no field, format can be omitted.\n//! In this case, variant name is used.\n//!\n//! ```rust\n//! use parse_display::{Display, FromStr};\n//!\n//! #[derive(Display, FromStr, PartialEq, Debug)]\n//! enum MyEnum {\n//!   VarA,\n//!   VarB,\n//! }\n//! assert_eq!(MyEnum::VarA.to_string(), \"VarA\");\n//! assert_eq!(MyEnum::VarB.to_string(), \"VarB\");\n//! assert_eq!(\"VarA\".parse(), Ok(MyEnum::VarA));\n//! assert_eq!(\"VarB\".parse(), Ok(MyEnum::VarB));\n//! ```\n//!\n//! ### Field format\n//!\n//! You can specify the format of the field.\n//! In field format, `{}` means the field itself.\n//!\n//! ```rust\n//! use parse_display::{Display, FromStr};\n//!\n//! #[derive(Display, FromStr, PartialEq, Debug)]\n//! #[display(\"{a}, {b}\")]\n//! struct MyStruct {\n//!   #[display(\"a is {}\")]\n//!   a: u32,\n//!   #[display(\"b is {}\")]\n//!   b: u32,\n//! }\n//! assert_eq!(MyStruct { a:10, b:20 }.to_string(), \"a is 10, b is 20\");\n//! assert_eq!(\"a is 10, b is 20\".parse(), Ok(MyStruct { a:10, b:20 }));\n//!\n//! #[derive(Display, FromStr, PartialEq, Debug)]\n//! #[display(\"{0}, {1}\")]\n//! struct MyTuple(#[display(\"first is {}\")] u32, #[display(\"next is {}\")] u32);\n//! assert_eq!(MyTuple(10, 20).to_string(), \"first is 10, next is 20\");\n//! assert_eq!(\"first is 10, next is 20\".parse(), Ok(MyTuple(10, 20)));\n//!\n//! #[derive(Display, FromStr, PartialEq, Debug)]\n//! enum MyEnum {\n//!   #[display(\"this is A {0}\")]\n//!   VarA(#[display(\"___{}___\")] u32),\n//! }\n//! assert_eq!(MyEnum::VarA(10).to_string(), \"this is A ___10___\");\n//! assert_eq!(\"this is A ___10___\".parse(), Ok(MyEnum::VarA(10)));\n//! ```\n//!\n//! ### Display field chain\n//!\n//! You can use \"field chain\", e.g. `{x.a}` .\n//!\n//! ```rust\n//! use parse_display::{Display, FromStr};\n//!\n//! #[derive(PartialEq, Debug, Default)]\n//! struct MyStruct {\n//!   a: u32,\n//!   b: u32,\n//! }\n//!\n//! #[derive(FromStr, Display, PartialEq, Debug)]\n//! #[display(\"{x.a}\")]\n//! struct FieldChain {\n//!   #[from_str(default)]\n//!   x: MyStruct,\n//! }\n//! assert_eq!(FieldChain { x:MyStruct { a:10, b:20 } }.to_string(), \"10\");\n//! assert_eq!(\"10\".parse(), Ok(FieldChain { x:MyStruct { a:10, b:0 } }));\n//! ```\n//!\n//! When using \"field chain\", you need to use [`#[from_str(default)]`](#from_strdefault) to implement `FromStr`.\n//!\n//! ### Format parameter\n//!\n//! Like `std::format!()`, format parameter can be specified.\n//!\n//! ```rust\n//! use parse_display::{Display, FromStr};\n//!\n//! #[derive(Display, PartialEq, Debug)]\n//! #[display(\"{a:\u003e04}\")]\n//! struct WithFormatParameter {\n//!   a: u32,\n//! }\n//! assert_eq!(WithFormatParameter { a:5 }.to_string(), \"0005\");\n//! ```\n//!\n//! ## `#[display(style = \"...\")]`\n//!\n//! By writing `#[display(style = \"...\")]`, you can specify the variant name style.\n//! The following styles are available.\n//!\n//! - `none`\n//! - `lowercase`\n//! - `UPPERCASE`\n//! - `snake_case`\n//! - `SNAKE_CASE`\n//! - `camelCase`\n//! - `CamelCase`\n//! - `kebab-case`\n//! - `KEBAB-CASE`\n//! - `Title Case`\n//! - `Title case`\n//! - `title case`\n//! - `TITLE CASE`\n//!\n//! ```rust\n//! use parse_display::{Display, FromStr};\n//!\n//! #[derive(Display, FromStr, PartialEq, Debug)]\n//! #[display(style = \"snake_case\")]\n//! enum MyEnum {\n//!   VarA,\n//!   VarB,\n//! }\n//! assert_eq!(MyEnum::VarA.to_string(), \"var_a\");\n//! assert_eq!(\"var_a\".parse(), Ok(MyEnum::VarA));\n//!\n//! #[derive(Display, FromStr, PartialEq, Debug)]\n//! enum StyleExample {\n//!   #[display(style = \"none\")]\n//!   VarA1,\n//!   #[display(style = \"none\")]\n//!   varA2,\n//!   #[display(style = \"lowercase\")]\n//!   VarB,\n//!   #[display(style = \"UPPERCASE\")]\n//!   VarC,\n//!   #[display(style = \"snake_case\")]\n//!   VarD,\n//!   #[display(style = \"SNAKE_CASE\")]\n//!   VarE,\n//!   #[display(style = \"camelCase\")]\n//!   VarF,\n//!   #[display(style = \"CamelCase\")]\n//!   VarG1,\n//!   #[display(style = \"CamelCase\")]\n//!   varG2,\n//!   #[display(style = \"kebab-case\")]\n//!   VarH,\n//!   #[display(style = \"KEBAB-CASE\")]\n//!   VarI,\n//!   #[display(style = \"Title Case\")]\n//!   VarJ,\n//!   #[display(style = \"Title case\")]\n//!   VarK,\n//!   #[display(style = \"title case\")]\n//!   VarL,\n//!   #[display(style = \"TITLE CASE\")]\n//!   VarM,\n//! }\n//! assert_eq!(StyleExample::VarA1.to_string(), \"VarA1\");\n//! assert_eq!(StyleExample::varA2.to_string(), \"varA2\");\n//! assert_eq!(StyleExample::VarB.to_string(), \"varb\");\n//! assert_eq!(StyleExample::VarC.to_string(), \"VARC\");\n//! assert_eq!(StyleExample::VarD.to_string(), \"var_d\");\n//! assert_eq!(StyleExample::VarE.to_string(), \"VAR_E\");\n//! assert_eq!(StyleExample::VarF.to_string(), \"varF\");\n//! assert_eq!(StyleExample::VarG1.to_string(), \"VarG1\");\n//! assert_eq!(StyleExample::varG2.to_string(), \"VarG2\");\n//! assert_eq!(StyleExample::VarH.to_string(), \"var-h\");\n//! assert_eq!(StyleExample::VarI.to_string(), \"VAR-I\");\n//! assert_eq!(StyleExample::VarJ.to_string(), \"Var J\");\n//! assert_eq!(StyleExample::VarK.to_string(), \"Var k\");\n//! assert_eq!(StyleExample::VarL.to_string(), \"var l\");\n//! assert_eq!(StyleExample::VarM.to_string(), \"VAR M\");\n//! ```\n//!\n//! ## `#[display(bound(...))]`\n//!\n//! By default, the type of field used in the format is added to the trait bound.\n//!\n//! In Rust prior to 1.59, this behavior causes a compile error if you use fields of non public type in public struct.\n//!\n//! ```rust\n//! #![deny(private_in_public)]\n//! use parse_display::Display;\n//!\n//! // private type `Inner\u003cT\u003e` in public interface (error E0446)\n//! #[derive(Display)]\n//! pub struct Outer\u003cT\u003e(Inner\u003cT\u003e);\n//!\n//! #[derive(Display)]\n//! struct Inner\u003cT\u003e(T);\n//! ```\n//!\n//! By writing `#[display(bound(...))]`, you can override the default behavior.\n//!\n//! ### Specify trait bound type\n//!\n//! By specifying the type, you can specify the type that need to implement `Display` and `FromStr`.\n//!\n//! ```rust\n//! use parse_display::{Display, FromStr};\n//!\n//! #[derive(Display, FromStr, PartialEq, Debug)]\n//! #[display(bound(T))]\n//! pub struct Outer\u003cT\u003e(Inner\u003cT\u003e);\n//!\n//! #[derive(Display, FromStr, PartialEq, Debug)]\n//! struct Inner\u003cT\u003e(T);\n//!\n//! assert_eq!(Outer(Inner(10)).to_string(), \"10\");\n//! assert_eq!(\"10\".parse(), Ok(Outer(Inner(10))));\n//! ```\n//!\n//! ### Specify where predicate\n//!\n//! You can also specify the where predicate.\n//!\n//! ```rust\n//! use parse_display::Display;\n//!\n//! #[derive(Display)]\n//! #[display(bound(T : std::fmt::Debug))]\n//! pub struct Outer\u003cT\u003e(Inner\u003cT\u003e);\n//!\n//! #[derive(Display)]\n//! #[display(\"{0:?}\")]\n//! struct Inner\u003cT\u003e(T);\n//!\n//! assert_eq!(Outer(Inner(10)).to_string(), \"10\");\n//! ```\n//!\n//! ### No trait bounds\n//!\n//! You can also remove all trait bounds.\n//!\n//! ```rust\n//! use parse_display::Display;\n//!\n//! #[derive(Display)]\n//! #[display(bound())]\n//! pub struct Outer\u003cT\u003e(Inner\u003cT\u003e);\n//!\n//! #[derive(Display)]\n//! #[display(\"ABC\")]\n//! struct Inner\u003cT\u003e(T);\n//!\n//! assert_eq!(Outer(Inner(10)).to_string(), \"ABC\");\n//! ```\n//!\n//! ### Default trait bounds\n//!\n//! `..` means default (automatically generated) trait bounds.\n//!\n//! The following example specifies `T1` as a trait bound in addition to the default trait bound `T2`.\n//!\n//! ```rust\n//! use parse_display::Display;\n//!\n//! pub struct Inner\u003cT\u003e(T);\n//!\n//! #[derive(Display)]\n//! #[display(\"{0.0}, {1}\", bound(T1, ..))]\n//! pub struct Outer\u003cT1, T2\u003e(Inner\u003cT1\u003e, T2);\n//!\n//! assert_eq!(Outer(Inner(10), 20).to_string(), \"10, 20\");\n//! ```\n//!\n//! ## `#[from_str(bound(...))]`\n//!\n//! You can use a different trait bound for `Display` and `FromStr` by specifying both `#[display(bound(...))]` and `#[from_str(bound(...))]`.\n//!\n//! ```rust\n//! use parse_display::*;\n//! use std::{fmt::Display, str::FromStr};\n//!\n//! #[derive(Display, FromStr, PartialEq, Debug)]\n//! #[display(bound(\"T : Display\"))]\n//! #[from_str(bound(\"T : FromStr\"))]\n//! pub struct Outer\u003cT\u003e(Inner\u003cT\u003e);\n//!\n//! #[derive(Display, FromStr, PartialEq, Debug)]\n//! struct Inner\u003cT\u003e(T);\n//!\n//! assert_eq!(Outer(Inner(10)).to_string(), \"10\");\n//! assert_eq!(\"10\".parse(), Ok(Outer(Inner(10))));\n//! ```\n//!\n//! ## `#[from_str(new = ...)]`\n//!\n//! If `#[from_str(new = ...)]` is specified, the value will be initialized with the specified expression instead of the constructor.\n//!\n//! The expression must return a value that implement [`IntoResult`] (e.g. `Self`, `Option\u003cSelf\u003e`, `Result\u003cSelf, E\u003e`).\n//!\n//! In the expression, you can use a variable with the same name as the field name.\n//!\n//! ```rust\n//! use parse_display::FromStr;\n//! #[derive(FromStr, Debug, PartialEq)]\n//! #[from_str(new = Self::new(value))]\n//! struct MyNonZeroUSize {\n//!     value: usize,\n//! }\n//!\n//! impl MyNonZeroUSize {\n//!     fn new(value: usize) -\u003e Option\u003cSelf\u003e {\n//!         if value == 0 {\n//!             None\n//!         } else {\n//!             Some(Self { value })\n//!         }\n//!     }\n//! }\n//!\n//! assert_eq!(\"1\".parse(), Ok(MyNonZeroUSize { value: 1 }));\n//! assert_eq!(\"0\".parse::\u003cMyNonZeroUSize\u003e().is_err(), true);\n//! ```\n//!\n//! In tuple struct, variables are named with a leading underscore and their index. (e.g. `_0`, `_1`).\n//!\n//! ```rust\n//! use parse_display::FromStr;\n//! #[derive(FromStr, Debug, PartialEq)]\n//! #[from_str(new = Self::new(_0))]\n//! struct MyNonZeroUSize(usize);\n//!\n//! impl MyNonZeroUSize {\n//!     fn new(value: usize) -\u003e Option\u003cSelf\u003e {\n//!         if value == 0 {\n//!             None\n//!         } else {\n//!             Some(Self(value))\n//!         }\n//!     }\n//! }\n//!\n//! assert_eq!(\"1\".parse(), Ok(MyNonZeroUSize(1)));\n//! assert_eq!(\"0\".parse::\u003cMyNonZeroUSize\u003e().is_err(), true);\n//! ```\n//!\n//! ## `#[from_str(regex = \"...\")]`\n//!\n//! Specify the format of the string to be input with `FromStr`.\n//! `#[display(\"...\")]` is ignored, when this attribute is specified.\n//!\n//! ### Capture name\n//!\n//! The capture name corresponds to the field name.\n//!\n//! ```rust\n//! use parse_display::FromStr;\n//!\n//! #[derive(FromStr, PartialEq, Debug)]\n//! #[from_str(regex = \"(?P\u003ca\u003e[0-9]+)__(?P\u003cb\u003e[0-9]+)\")]\n//! struct MyStruct {\n//!   a: u8,\n//!   b: u8,\n//! }\n//!\n//! assert_eq!(\"10__20\".parse(), Ok(MyStruct { a:10, b:20 }));\n//! ```\n//!\n//! ### Field regex\n//!\n//! Set `#[display(\"...\")]` to struct and set `#[from_str(regex = \"...\")]` to field, regex is used in the position where field name is specified in `#[display(\"...\")]`.\n//!\n//! ```rust\n//! use parse_display::FromStr;\n//!\n//! #[derive(FromStr, PartialEq, Debug)]\n//! #[display(\"{a}__{b}\")]\n//! struct MyStruct {\n//!   #[from_str(regex = \"[0-9]+\")]\n//!   a: u8,\n//!\n//!   #[from_str(regex = \"[0-9]+\")]\n//!   b: u8,\n//! }\n//! assert_eq!(\"10__20\".parse(), Ok(MyStruct { a:10, b:20 }));\n//! ```\n//!\n//! If `#[from_str(regex = \"...\")]` is not set to field ,\n//! it operates in the same way as when `#[from_str(regex = \".*?\")]` is set.\n//!\n//! ```rust\n//! use parse_display::FromStr;\n//!\n//! #[derive(FromStr, PartialEq, Debug)]\n//! #[display(\"{a}{b}\")]\n//! struct MyStruct {\n//!   a: String,\n//!   b: String,\n//! }\n//! assert_eq!(\"abcdef\".parse(), Ok(MyStruct { a:\"\".into(), b:\"abcdef\".into() }));\n//! ```\n//!\n//! ### Variant name\n//!\n//! In the regex specified for enum or variant, empty name capture means variant name.\n//!\n//! ```rust\n//! use parse_display::FromStr;\n//!\n//! #[derive(FromStr, PartialEq, Debug)]\n//! #[from_str(regex = \"___(?P\u003c\u003e)___\")]\n//! enum MyEnum {\n//!   VarA,\n//!\n//!   #[from_str(regex = \"xxx(?P\u003c\u003e)xxx\")]\n//!   VarB,\n//! }\n//! assert_eq!(\"___VarA___\".parse(), Ok(MyEnum::VarA));\n//! assert_eq!(\"xxxVarBxxx\".parse(), Ok(MyEnum::VarB));\n//! ```\n//!\n//! ### Regex field chain\n//!\n//! You can use \"field chain\" in regex.\n//!\n//! ```rust\n//! use parse_display::FromStr;\n//!\n//! #[derive(PartialEq, Debug, Default)]\n//! struct MyStruct {\n//!   a: u32,\n//! }\n//!\n//! #[derive(FromStr, PartialEq, Debug)]\n//! #[from_str(regex = \"___(?P\u003cx.a\u003e[0-9]+)\")]\n//! struct FieldChain {\n//!   #[from_str(default)]\n//!   x: MyStruct,\n//! }\n//! assert_eq!(\"___10\".parse(), Ok(FieldChain { x:MyStruct { a:10 } }));\n//! ```\n//!\n//! When using \"field chain\", you need to use [`#[from_str(default)]`](#from_strdefault).\n//!\n//! ## `#[from_str(default)]`\n//!\n//! If this attribute is specified, the default value is used for fields not included in the input.\n//!\n//! If an attribute is specified for struct, the struct's default value is used.\n//!\n//! ```rust\n//! use parse_display::FromStr;\n//!\n//! #[derive(FromStr, PartialEq, Debug)]\n//! #[display(\"{b}\")]\n//! #[from_str(default)]\n//! struct MyStruct {\n//!   a: u32,\n//!   b: u32,\n//! }\n//!\n//! impl Default for MyStruct {\n//!   fn default() -\u003e Self {\n//!     Self { a:99, b:99 }\n//!   }\n//! }\n//! assert_eq!(\"10\".parse(), Ok(MyStruct { a:99, b:10 }));\n//! ```\n//!\n//! If an attribute is specified for field, the field type's default value is used.\n//!\n//! ```rust\n//! use parse_display::FromStr;\n//!\n//! #[derive(FromStr, PartialEq, Debug)]\n//! #[display(\"{b}\")]\n//! struct MyStruct {\n//!   #[from_str(default)]\n//!   a: u32,\n//!   b: u32,\n//! }\n//!\n//! impl Default for MyStruct {\n//!   fn default() -\u003e Self {\n//!     Self { a:99, b:99 }\n//!   }\n//! }\n//! assert_eq!(\"10\".parse(), Ok(MyStruct { a:0, b:10 }));\n//! ```\n//!\n//! ## `#[from_str(default_fields(...))]`\n//!\n//! You can use `#[from_str(default_fields(...))]` if you want to set default values for the same-named fields of multiple variants.\n//!\n//! ```rust\n//! use parse_display::FromStr;\n//!\n//! #[derive(FromStr, PartialEq, Debug)]\n//! #[display(\"{}-{a}\")]\n//! #[from_str(default_fields(\"b\", \"c\"))]\n//! enum MyEnum {\n//!   VarA { a:u8, b:u8, c:u8 },\n//!   VarB { a:u8, b:u8, c:u8 },\n//! }\n//!\n//! assert_eq!(\"VarA-10\".parse(), Ok(MyEnum::VarA { a:10, b:0, c:0 }));\n//! assert_eq!(\"VarB-10\".parse(), Ok(MyEnum::VarB { a:10, b:0, c:0 }));\n//! ```\n// #![include_doc(\"../../README.md\", end(\"## License\"))]\n#![cfg_attr(not(feature = \"std\"), no_std)]\n\nuse core::convert::Infallible;\nuse core::fmt::{Display, Formatter, Result};\n\n#[cfg(feature = \"regex\")]\npub mod helpers {\n    pub use once_cell;\n    pub use regex;\n}\n\npub use parse_display_derive::{Display, FromStr};\n\n#[derive(Debug, Eq, PartialEq)]\npub struct ParseError(\u0026'static str);\nimpl ParseError {\n    pub fn with_message(message: \u0026'static str) -\u003e Self {\n        Self(message)\n    }\n    pub fn new() -\u003e Self {\n        Self::with_message(\"parse failed.\")\n    }\n}\nimpl Default for ParseError {\n    fn default() -\u003e Self {\n        Self::new()\n    }\n}\n\nimpl Display for ParseError {\n    fn fmt(\u0026self, f: \u0026mut Formatter) -\u003e Result {\n        write!(f, \"{}\", self.0)\n    }\n}\n#[cfg(feature = \"std\")]\nimpl std::error::Error for ParseError {\n    fn description(\u0026self) -\u003e \u0026str {\n        self.0\n    }\n}\n\npub trait IntoResult\u003cT\u003e {\n    type Err;\n    fn into_result(self) -\u003e core::result::Result\u003cT, Self::Err\u003e;\n}\n\nimpl\u003cT\u003e IntoResult\u003cT\u003e for T {\n    type Err = Infallible;\n    fn into_result(self) -\u003e core::result::Result\u003cT, Self::Err\u003e {\n        Ok(self)\n    }\n}\n\nimpl\u003cT\u003e IntoResult\u003cT\u003e for Option\u003cT\u003e {\n    type Err = ParseError;\n    fn into_result(self) -\u003e core::result::Result\u003cT, Self::Err\u003e {\n        self.ok_or_else(ParseError::new)\n    }\n}\n\nimpl\u003cT, E\u003e IntoResult\u003cT\u003e for core::result::Result\u003cT, E\u003e {\n    type Err = E;\n    fn into_result(self) -\u003e core::result::Result\u003cT, E\u003e {\n        self\n    }\n}\n","traces":[{"line":716,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":717,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":723,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":724,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":730,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":731,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":6},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","parse-display","parse-display-benches","benches","bench.rs"],"content":"#![feature(test)]\n\nextern crate test;\n\nuse parse_display::{Display, FromStr, ParseError};\nuse std::{hint::black_box, str::FromStr};\n\n#[bench]\nfn parse_simple_enum_derive(b: \u0026mut test::Bencher) {\n    #[derive(FromStr)]\n    enum SimpleEnumDerive {\n        ItemA,\n        ItemB,\n        ItemC,\n        ItemD,\n    }\n\n    let inputs = [\"ItemA\", \"ItemB\", \"ItemC\", \"ItemD\"];\n    b.iter(|| {\n        for \u0026input in \u0026inputs {\n            black_box(input.parse::\u003cSimpleEnumDerive\u003e().unwrap());\n        }\n    });\n}\n#[bench]\nfn parse_simple_enum_by_hand(b: \u0026mut test::Bencher) {\n    enum SimpleEnumByHand {\n        ItemA,\n        ItemB,\n        ItemC,\n        ItemD,\n    }\n\n    impl FromStr for SimpleEnumByHand {\n        type Err = ParseError;\n\n        fn from_str(s: \u0026str) -\u003e Result\u003cSelf, Self::Err\u003e {\n            match s {\n                \"ItemA\" =\u003e Ok(Self::ItemA),\n                \"ItemB\" =\u003e Ok(Self::ItemB),\n                \"ItemC\" =\u003e Ok(Self::ItemC),\n                \"ItemD\" =\u003e Ok(Self::ItemD),\n                _ =\u003e Err(ParseError::new()),\n            }\n        }\n    }\n\n    let inputs = [\"ItemA\", \"ItemB\", \"ItemC\", \"ItemD\"];\n    b.iter(|| {\n        for \u0026input in \u0026inputs {\n            black_box(input.parse::\u003cSimpleEnumByHand\u003e().unwrap());\n        }\n    });\n}\n\n#[bench]\nfn parse_non_regex_format_struct_derive(b: \u0026mut test::Bencher) {\n    #[derive(Display, FromStr)]\n    #[display(\"{a},{b},{c}\")]\n    struct TestInput {\n        a: u32,\n        b: u32,\n        c: u32,\n    }\n\n    let input = TestInput {\n        a: 10,\n        b: 20,\n        c: 30,\n    }\n    .to_string();\n    b.iter(|| {\n        black_box(input.parse::\u003cTestInput\u003e().unwrap());\n    });\n}\n\n#[bench]\nfn parse_non_regex_format_struct_by_hand(b: \u0026mut test::Bencher) {\n    #[derive(Display)]\n    #[display(\"{a},{b},{c}\")]\n    struct TestInput {\n        a: u32,\n        b: u32,\n        c: u32,\n    }\n    impl FromStr for TestInput {\n        type Err = ParseError;\n\n        fn from_str(s: \u0026str) -\u003e Result\u003cSelf, Self::Err\u003e {\n            let idx1 = s.find(\",\").ok_or_else(ParseError::new)?;\n            let idx2 = idx1 + 1 + s[idx1 + 1..].find(\",\").ok_or_else(ParseError::new)?;\n            let a = s[0..idx1].parse().map_err(|_| ParseError::new())?;\n            let b = s[idx1 + 1..idx2].parse().map_err(|_| ParseError::new())?;\n            let c = s[idx2 + 1..].parse().map_err(|_| ParseError::new())?;\n            Ok(Self { a, b, c })\n        }\n    }\n\n    let input = TestInput {\n        a: 10,\n        b: 20,\n        c: 30,\n    }\n    .to_string();\n\n    b.iter(|| {\n        black_box(input.parse::\u003cTestInput\u003e().unwrap());\n    });\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","parse-display","parse-display-benches","src","lib.rs"],"content":"\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","parse-display","parse-display-derive","src","format_syntax.rs"],"content":"use once_cell::sync::Lazy;\nuse regex::*;\n\nuse std::fmt::{Display, Formatter};\nuse std::str::FromStr;\n\n#[derive(Debug, PartialEq, Eq)]\npub enum Sign {\n    Plus,\n    Minus,\n}\n\n#[derive(Debug, PartialEq, Eq)]\npub enum Align {\n    Left,\n    Right,\n    Center,\n}\n\n#[derive(Debug, PartialEq, Eq, Default)]\npub struct FormatSpec\u003c'a\u003e {\n    pub fill: Option\u003cchar\u003e,\n    pub align: Option\u003cAlign\u003e,\n    pub sign: Option\u003cSign\u003e,\n    pub is_alternate: bool,\n    pub is_zero: bool,\n    pub width: Option\u003cSubArg\u003c'a, usize\u003e\u003e,\n    pub precision: Option\u003cSubArg\u003c'a, usize\u003e\u003e,\n    pub format_type: FormatType,\n}\n\n#[derive(Debug, PartialEq, Eq)]\npub enum SubArg\u003c'a, T\u003e {\n    Value(T),\n    Index(usize),\n    Name(\u0026'a str),\n    Input,\n}\n\n#[derive(Debug, PartialEq, Eq)]\npub enum FormatType {\n    Display,\n    Debug,\n    DebugUpperHex,\n    DebugLowerHex,\n    Octal,\n    LowerHex,\n    UpperHex,\n    Pointer,\n    Binary,\n    LowerExp,\n    UpperExp,\n}\nimpl FormatType {\n    pub fn trait_name(\u0026self) -\u003e \u0026str {\n        match self {\n            FormatType::Display =\u003e \"Display\",\n            FormatType::Debug | FormatType::DebugUpperHex | FormatType::DebugLowerHex =\u003e \"Debug\",\n            FormatType::Octal =\u003e \"Octal\",\n            FormatType::LowerHex =\u003e \"LowerHex\",\n            FormatType::UpperHex =\u003e \"UpperHex\",\n            FormatType::Pointer =\u003e \"Pointer\",\n            FormatType::Binary =\u003e \"Binary\",\n            FormatType::LowerExp =\u003e \"LowerExp\",\n            FormatType::UpperExp =\u003e \"UpperExp\",\n        }\n    }\n}\n\nimpl Default for FormatType {\n    fn default() -\u003e Self {\n        FormatType::Display\n    }\n}\n\n#[derive(Debug, Eq, PartialEq)]\npub struct FormatParseError;\n\nimpl FormatParseError {\n    const ERROR_MESSAGE: \u0026'static str = \"FormatSpec parse failed.\";\n}\n\nimpl std::error::Error for FormatParseError {\n    fn description(\u0026self) -\u003e \u0026str {\n        FormatParseError::ERROR_MESSAGE\n    }\n}\nimpl Display for FormatParseError {\n    fn fmt(\u0026self, f: \u0026mut Formatter) -\u003e std::fmt::Result {\n        write!(f, \"{}\", FormatParseError::ERROR_MESSAGE)\n    }\n}\n\nimpl\u003c'a\u003e FormatSpec\u003c'a\u003e {\n    pub fn parse(s: \u0026'a str) -\u003e std::result::Result\u003cSelf, FormatParseError\u003e {\n        static RE: Lazy\u003cRegex\u003e = lazy_regex!(\n            \"^\\\n             ((?P\u003cfill\u003e.)?\\\n             (?P\u003calign\u003e[\u003c\u003e^]))??\\\n             (?P\u003csign\u003e[+-])?\\\n             (?P\u003cis_alternate\u003e#)?\\\n             (?P\u003cis_zero\u003e0)?\\\n             (\\\n             (?P\u003cwidth_integer\u003e[0-9]+)|\\\n             ((?P\u003cwidth_arg\u003e[a-zA-Z0-9_]+)\\\\$)\\\n             )?\\\n             (\\\\.(\\\n             (?P\u003cprecision_input\u003e\\\\*)|\\\n             (?P\u003cprecision_integer\u003e[0-9]+)|\\\n             ((?P\u003cprecision_arg\u003e[a-zA-Z0-9_]+)\\\\$)\\\n             ))?\\\n             (?P\u003cformat_type\u003e[a-zA-Z0-9_]*\\\\??)\\\n             $\"\n        );\n\n        let c = RE.captures(s).ok_or(FormatParseError)?;\n        let fill = c.name(\"fill\").map(|m| m.as_str().chars().next().unwrap());\n        let align = c.name(\"align\").map(|m| m.as_str().parse().unwrap());\n        let sign = c.name(\"sign\").map(|m| match m.as_str() {\n            \"+\" =\u003e Sign::Plus,\n            \"-\" =\u003e Sign::Minus,\n            _ =\u003e unreachable!(),\n        });\n        let is_alternate = c.name(\"is_alternate\").is_some();\n        let is_zero = c.name(\"is_zero\").is_some();\n        let width = if let Some(m) = c.name(\"width_integer\") {\n            let value = m.as_str().parse().map_err(|_| FormatParseError)?;\n            Some(SubArg::Value(value))\n        } else if let Some(m) = c.name(\"width_arg\") {\n            let s = m.as_str();\n            Some(if let Ok(idx) = s.parse() {\n                SubArg::Index(idx)\n            } else {\n                SubArg::Name(s)\n            })\n        } else {\n            None\n        };\n\n        let precision = if let Some(m) = c.name(\"precision_integer\") {\n            let value = m.as_str().parse().map_err(|_| FormatParseError)?;\n            Some(SubArg::Value(value))\n        } else if let Some(m) = c.name(\"precision_arg\") {\n            let s = m.as_str();\n            Some(if let Ok(idx) = s.parse() {\n                SubArg::Index(idx)\n            } else {\n                SubArg::Name(s)\n            })\n        } else if c.name(\"precision_input\").is_some() {\n            Some(SubArg::Input)\n        } else {\n            None\n        };\n        let format_type = c.name(\"format_type\").unwrap().as_str().parse()?;\n\n        Ok(FormatSpec {\n            fill,\n            align,\n            sign,\n            is_alternate,\n            is_zero,\n            width,\n            precision,\n            format_type,\n        })\n    }\n}\n\nimpl FromStr for Align {\n    type Err = FormatParseError;\n    fn from_str(s: \u0026str) -\u003e std::result::Result\u003cSelf, Self::Err\u003e {\n        Ok(match s {\n            \"\u003c\" =\u003e Align::Left,\n            \"\u003e\" =\u003e Align::Right,\n            \"^\" =\u003e Align::Center,\n            _ =\u003e return Err(FormatParseError),\n        })\n    }\n}\n\nimpl FromStr for FormatType {\n    type Err = FormatParseError;\n    fn from_str(s: \u0026str) -\u003e std::result::Result\u003cSelf, Self::Err\u003e {\n        Ok(match s {\n            \"\" =\u003e FormatType::Display,\n            \"?\" =\u003e FormatType::Debug,\n            \"x?\" =\u003e FormatType::DebugLowerHex,\n            \"X?\" =\u003e FormatType::DebugUpperHex,\n            \"o\" =\u003e FormatType::Octal,\n            \"x\" =\u003e FormatType::LowerHex,\n            \"X\" =\u003e FormatType::UpperHex,\n            \"p\" =\u003e FormatType::Pointer,\n            \"b\" =\u003e FormatType::Binary,\n            \"e\" =\u003e FormatType::LowerExp,\n            \"E\" =\u003e FormatType::UpperExp,\n            _ =\u003e return Err(FormatParseError),\n        })\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn align() {\n        assert_ps(\n            \"\u003c\",\n            FormatSpec {\n                align: Some(Align::Left),\n                ..Default::default()\n            },\n        );\n        assert_ps(\n            \"^\",\n            FormatSpec {\n                align: Some(Align::Center),\n                ..Default::default()\n            },\n        );\n        assert_ps(\n            \"\u003e\",\n            FormatSpec {\n                align: Some(Align::Right),\n                ..Default::default()\n            },\n        );\n    }\n\n    #[test]\n    fn fill_align() {\n        assert_ps(\n            \"x\u003c\",\n            FormatSpec {\n                fill: Some('x'),\n                align: Some(Align::Left),\n                ..Default::default()\n            },\n        );\n        assert_ps(\n            \"0\u003e\",\n            FormatSpec {\n                fill: Some('0'),\n                align: Some(Align::Right),\n                ..Default::default()\n            },\n        );\n    }\n\n    #[test]\n    fn sign() {\n        assert_ps(\n            \"+\",\n            FormatSpec {\n                sign: Some(Sign::Plus),\n                ..Default::default()\n            },\n        );\n        assert_ps(\n            \"-\",\n            FormatSpec {\n                sign: Some(Sign::Minus),\n                ..Default::default()\n            },\n        );\n    }\n    #[test]\n    fn alternate() {\n        assert_ps(\n            \"#\",\n            FormatSpec {\n                is_alternate: true,\n                ..Default::default()\n            },\n        );\n    }\n\n    #[test]\n    fn zero() {\n        assert_ps(\n            \"0\",\n            FormatSpec {\n                is_zero: true,\n                ..Default::default()\n            },\n        );\n    }\n\n    #[test]\n    fn width_value() {\n        assert_ps(\n            \"5\",\n            FormatSpec {\n                width: Some(SubArg::Value(5)),\n                ..Default::default()\n            },\n        );\n    }\n\n    #[test]\n    fn width_arg_index() {\n        assert_ps(\n            \"5$\",\n            FormatSpec {\n                width: Some(SubArg::Index(5)),\n                ..Default::default()\n            },\n        );\n    }\n\n    #[test]\n    fn width_arg_name() {\n        assert_ps(\n            \"field$\",\n            FormatSpec {\n                width: Some(SubArg::Name(\"field\")),\n                ..Default::default()\n            },\n        );\n    }\n\n    #[test]\n    fn zero_width() {\n        assert_ps(\n            \"05\",\n            FormatSpec {\n                is_zero: true,\n                width: Some(SubArg::Value(5)),\n                ..Default::default()\n            },\n        );\n    }\n\n    #[test]\n    fn precision_value() {\n        assert_ps(\n            \".5\",\n            FormatSpec {\n                precision: Some(SubArg::Value(5)),\n                ..Default::default()\n            },\n        );\n    }\n\n    #[test]\n    fn precision_arg_index() {\n        assert_ps(\n            \".5$\",\n            FormatSpec {\n                precision: Some(SubArg::Index(5)),\n                ..Default::default()\n            },\n        );\n    }\n\n    #[test]\n    fn precision_arg_name() {\n        assert_ps(\n            \".field$\",\n            FormatSpec {\n                precision: Some(SubArg::Name(\"field\")),\n                ..Default::default()\n            },\n        );\n    }\n\n    #[test]\n    fn precision_arg_input() {\n        assert_ps(\n            \".*\",\n            FormatSpec {\n                precision: Some(SubArg::Input),\n                ..Default::default()\n            },\n        );\n    }\n\n    #[test]\n    fn format_type() {\n        assert_ps(\n            \"?\",\n            FormatSpec {\n                format_type: FormatType::Debug,\n                ..Default::default()\n            },\n        );\n        assert_ps(\n            \"x?\",\n            FormatSpec {\n                format_type: FormatType::DebugLowerHex,\n                ..Default::default()\n            },\n        );\n        assert_ps(\n            \"x\",\n            FormatSpec {\n                format_type: FormatType::LowerHex,\n                ..Default::default()\n            },\n        );\n        assert_ps(\n            \"X\",\n            FormatSpec {\n                format_type: FormatType::UpperHex,\n                ..Default::default()\n            },\n        );\n        assert_ps(\n            \"b\",\n            FormatSpec {\n                format_type: FormatType::Binary,\n                ..Default::default()\n            },\n        );\n    }\n\n    #[test]\n    fn all() {\n        assert_ps(\n            \"_\u003e+#05$.name$x?\",\n            FormatSpec {\n                fill: Some('_'),\n                align: Some(Align::Right),\n                sign: Some(Sign::Plus),\n                is_alternate: true,\n                is_zero: true,\n                width: Some(SubArg::Index(5)),\n                precision: Some(SubArg::Name(\"name\")),\n                format_type: FormatType::DebugLowerHex,\n            },\n        );\n    }\n\n    fn assert_ps\u003c'a\u003e(s: \u0026'a str, ps: FormatSpec\u003c'a\u003e) {\n        assert_eq!(FormatSpec::parse(s), Ok(ps), \"input : {}\", s);\n    }\n}\n","traces":[{"line":95,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":99,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":101,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":102,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":103,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":107,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":108,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":109,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":110,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":111,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":113,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":116,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":117,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":118,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":119,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":120,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":121,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":122,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":124,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":125,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":126,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":127,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":128,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":129,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":130,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":131,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":132,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":134,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":137,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":140,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":141,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":142,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":143,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":144,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":145,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":146,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":148,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":150,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":151,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":153,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":155,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":157,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":158,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":159,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":160,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":161,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":162,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":163,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":164,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":165,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":435,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":436,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":60},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","parse-display","parse-display-derive","src","lib.rs"],"content":"#![recursion_limit = \"128\"]\n#![allow(clippy::large_enum_variant)]\n\n//! The documentation for this crate is found in the parse-display crate.\n\nextern crate proc_macro;\n\n#[macro_use]\nmod regex_utils;\n\n#[macro_use]\nmod syn_utils;\n\nmod format_syntax;\n\nuse crate::{format_syntax::*, regex_utils::*, syn_utils::*};\nuse once_cell::sync::Lazy;\nuse proc_macro2::{Span, TokenStream};\nuse quote::{format_ident, quote};\nuse regex::{Captures, Regex};\nuse regex_syntax::hir::Hir;\nuse std::{\n    collections::BTreeMap,\n    fmt::{Display, Formatter},\n    ops::{Deref, DerefMut},\n};\nuse structmeta::{Flag, StructMeta, ToTokens};\nuse syn::{\n    ext::IdentExt,\n    parse::{discouraged::Speculative, Parse, ParseStream},\n    parse_macro_input, parse_quote, parse_str,\n    spanned::Spanned,\n    Attribute, Data, DataEnum, DataStruct, DeriveInput, Expr, Field, Fields, FieldsNamed,\n    FieldsUnnamed, Ident, LitStr, Member, Path, Result, Token, Type, Variant, WherePredicate,\n};\n\n#[proc_macro_derive(Display, attributes(display))]\npub fn derive_display(input: proc_macro::TokenStream) -\u003e proc_macro::TokenStream {\n    let input = parse_macro_input!(input as DeriveInput);\n    into_macro_output(match \u0026input.data {\n        Data::Struct(data) =\u003e derive_display_for_struct(\u0026input, data),\n        Data::Enum(data) =\u003e derive_display_for_enum(\u0026input, data),\n        _ =\u003e panic!(\"`#[derive(Display)]` supports only enum or struct.\"),\n    })\n}\n\nfn derive_display_for_struct(input: \u0026DeriveInput, data: \u0026DataStruct) -\u003e Result\u003cTokenStream\u003e {\n    let hattrs = HelperAttributes::from(\u0026input.attrs)?;\n    let ctx = DisplayContext::Struct { data };\n    let generics = GenericParamSet::new(\u0026input.generics);\n\n    let mut format = hattrs.format;\n    if format.is_none() {\n        format = DisplayFormat::from_newtype_struct(data);\n    }\n    let format = match format {\n        Some(x) =\u003e x,\n        None =\u003e bail!(\n            input.span(),\n            \"`#[display(\\\"format\\\")]` is required except newtype pattern.\",\n        ),\n    };\n    let mut bounds = Bounds::from_data(hattrs.bound_display);\n    let args = format.format_args(ctx, \u0026mut bounds, \u0026generics)?;\n    let trait_path = parse_quote!(core::fmt::Display);\n    let wheres = bounds.build_wheres(\u0026trait_path);\n    impl_trait_result(\n        input,\n        \u0026trait_path,\n        \u0026wheres,\n        quote! {\n            fn fmt(\u0026self, f: \u0026mut core::fmt::Formatter) -\u003e core::fmt::Result {\n                core::write!(f, #args)\n            }\n        },\n        hattrs.dump_display,\n    )\n}\nfn derive_display_for_enum(input: \u0026DeriveInput, data: \u0026DataEnum) -\u003e Result\u003cTokenStream\u003e {\n    fn make_arm(\n        hattrs_enum: \u0026HelperAttributes,\n        variant: \u0026Variant,\n        bounds: \u0026mut Bounds,\n        generics: \u0026GenericParamSet,\n    ) -\u003e Result\u003cTokenStream\u003e {\n        let fields = match \u0026variant.fields {\n            Fields::Named(fields) =\u003e {\n                let fields = FieldKey::from_fields_named(fields).map(|(key, ..)| {\n                    let var = key.binding_var();\n                    quote! { #key : ref #var }\n                });\n                quote! { { #(#fields,)* } }\n            }\n            Fields::Unnamed(fields) =\u003e {\n                let fields = FieldKey::from_fields_unnamed(fields).map(|(key, ..)| {\n                    let var = key.binding_var();\n                    quote! { ref #var }\n                });\n                quote! { ( #(#fields,)* ) }\n            }\n            Fields::Unit =\u003e quote! {},\n        };\n        let hattrs_variant = HelperAttributes::from(\u0026variant.attrs)?;\n        let style = DisplayStyle::from_helper_attributes(hattrs_enum, \u0026hattrs_variant);\n        let mut format = hattrs_variant.format;\n        if format.is_none() {\n            format = hattrs_enum.format.clone();\n        }\n        if format.is_none() {\n            format = DisplayFormat::from_unit_variant(variant)?;\n        }\n        let format = match format {\n            Some(x) =\u003e x,\n            None =\u003e bail!(\n                variant.span(),\n                \"`#[display(\\\"format\\\")]` is required except unit variant.\"\n            ),\n        };\n        let variant_ident = \u0026variant.ident;\n        let args = format.format_args(\n            DisplayContext::Variant { variant, style },\n            \u0026mut bounds.child(hattrs_variant.bound_display),\n            generics,\n        )?;\n        Ok(quote! {\n            \u0026 Self::#variant_ident #fields =\u003e {\n                core::write!(f, #args)\n            },\n        })\n    }\n    let hattrs = HelperAttributes::from(\u0026input.attrs)?;\n    let mut bounds = Bounds::from_data(hattrs.bound_display.clone());\n    let generics = GenericParamSet::new(\u0026input.generics);\n    let mut arms = Vec::new();\n    for variant in \u0026data.variants {\n        arms.push(make_arm(\u0026hattrs, variant, \u0026mut bounds, \u0026generics)?);\n    }\n    let trait_path = parse_quote!(core::fmt::Display);\n    let contents = quote! {\n        fn fmt(\u0026self, f: \u0026mut core::fmt::Formatter) -\u003e core::fmt::Result {\n            match self {\n                #(#arms)*\n            }\n        }\n    };\n    let wheres = bounds.build_wheres(\u0026trait_path);\n    impl_trait_result(input, \u0026trait_path, \u0026wheres, contents, hattrs.dump_display)\n}\n\n#[proc_macro_derive(FromStr, attributes(display, from_str))]\npub fn derive_from_str(input: proc_macro::TokenStream) -\u003e proc_macro::TokenStream {\n    let input = parse_macro_input!(input as DeriveInput);\n    into_macro_output(match \u0026input.data {\n        Data::Struct(data) =\u003e derive_from_str_for_struct(\u0026input, data),\n        Data::Enum(data) =\u003e derive_from_str_for_enum(\u0026input, data),\n        _ =\u003e panic!(\"`#[derive(FromStr)]` supports only enum or struct.\"),\n    })\n}\nfn derive_from_str_for_struct(input: \u0026DeriveInput, data: \u0026DataStruct) -\u003e Result\u003cTokenStream\u003e {\n    let hattrs = HelperAttributes::from(\u0026input.attrs)?;\n    let p = ParserBuilder::from_struct(\u0026hattrs, data)?;\n    let body = p.build_from_str_body(parse_quote!(Self))?;\n    let generics = GenericParamSet::new(\u0026input.generics);\n    let mut bounds = Bounds::from_data(hattrs.bound_from_str_resolved());\n    p.build_bounds(\u0026generics, \u0026mut bounds);\n    let trait_path = parse_quote!(core::str::FromStr);\n    let wheres = bounds.build_wheres(\u0026trait_path);\n    impl_trait_result(\n        input,\n        \u0026trait_path,\n        \u0026wheres,\n        quote! {\n            type Err = parse_display::ParseError;\n            fn from_str(s: \u0026str) -\u003e core::result::Result\u003cSelf, Self::Err\u003e {\n                #body\n            }\n        },\n        hattrs.dump_from_str,\n    )\n}\nfn derive_from_str_for_enum(input: \u0026DeriveInput, data: \u0026DataEnum) -\u003e Result\u003cTokenStream\u003e {\n    let hattrs_enum = HelperAttributes::from(\u0026input.attrs)?;\n    if let Some(span) = hattrs_enum.default_self {\n        bail!(span, \"`#[from_str(default)]` cannot be specified for enum.\");\n    }\n    let mut bounds = Bounds::from_data(hattrs_enum.bound_from_str_resolved());\n    let generics = GenericParamSet::new(\u0026input.generics);\n    let mut bodys = Vec::new();\n    let mut arms = Vec::new();\n    for variant in data.variants.iter() {\n        let variant_ident = \u0026variant.ident;\n        let constructor = parse_quote!(Self::#variant_ident);\n        let hattrs_variant = HelperAttributes::from(\u0026variant.attrs)?;\n        let p = ParserBuilder::from_variant(\u0026hattrs_variant, \u0026hattrs_enum, variant)?;\n        let mut bounds = bounds.child(hattrs_variant.bound_from_str_resolved());\n        p.build_bounds(\u0026generics, \u0026mut bounds);\n        match p.build_parse_variant_code(constructor)? {\n            ParseVariantCode::MatchArm(arm) =\u003e arms.push(arm),\n            ParseVariantCode::Statement(body) =\u003e bodys.push(body),\n        }\n    }\n    let match_body = if arms.is_empty() {\n        quote! {}\n    } else {\n        quote! {\n            match s {\n                #(#arms,)*\n                _ =\u003e { }\n            }\n        }\n    };\n    let trait_path = parse_quote!(core::str::FromStr);\n    let wheres = bounds.build_wheres(\u0026trait_path);\n    impl_trait_result(\n        input,\n        \u0026trait_path,\n        \u0026wheres,\n        quote! {\n            type Err = parse_display::ParseError;\n            fn from_str(s: \u0026str) -\u003e core::result::Result\u003cSelf, Self::Err\u003e {\n                #match_body\n                #({ #bodys })*\n                Err(parse_display::ParseError::new())\n            }\n        },\n        hattrs_enum.dump_from_str,\n    )\n}\n\nstruct ParserBuilder\u003c'a\u003e {\n    capture_next: usize,\n    parse_format: ParseFormat,\n    fields: BTreeMap\u003cFieldKey, FieldEntry\u003c'a\u003e\u003e,\n    source: \u0026'a Fields,\n    use_default: bool,\n    span: Span,\n    new_expr: Option\u003cExpr\u003e,\n}\nstruct FieldEntry\u003c'a\u003e {\n    hattrs: HelperAttributes,\n    deep_captures: BTreeMap\u003cVec\u003cFieldKey\u003e, usize\u003e,\n    source: \u0026'a Field,\n    capture: Option\u003cusize\u003e,\n    use_default: bool,\n}\n\nimpl\u003c'a\u003e ParserBuilder\u003c'a\u003e {\n    fn new(source: \u0026'a Fields) -\u003e Result\u003cSelf\u003e {\n        let mut fields = BTreeMap::new();\n        for (key, field) in field_map(source) {\n            fields.insert(key, FieldEntry::new(field)?);\n        }\n        Ok(Self {\n            source,\n            capture_next: 1,\n            parse_format: ParseFormat::new(),\n            fields,\n            use_default: false,\n            span: Span::call_site(),\n            new_expr: None,\n        })\n    }\n    fn from_struct(hattrs: \u0026HelperAttributes, data: \u0026'a DataStruct) -\u003e Result\u003cSelf\u003e {\n        let mut s = Self::new(\u0026data.fields)?;\n        let context = DisplayContext::Struct { data };\n        s.new_expr = hattrs.new_expr.clone();\n        s.apply_attrs(hattrs)?;\n        s.push_attrs(hattrs, \u0026context)?;\n        Ok(s)\n    }\n    fn from_variant(\n        hattrs_variant: \u0026HelperAttributes,\n        hattrs_enum: \u0026HelperAttributes,\n        variant: \u0026'a Variant,\n    ) -\u003e Result\u003cSelf\u003e {\n        let mut s = Self::new(\u0026variant.fields)?;\n        let style = DisplayStyle::from_helper_attributes(hattrs_enum, hattrs_variant);\n        let context = DisplayContext::Variant { variant, style };\n        s.new_expr = hattrs_variant.new_expr.clone();\n        s.apply_attrs(hattrs_enum)?;\n        s.apply_attrs(hattrs_variant)?;\n        if !s.try_push_attrs(hattrs_variant, \u0026context)? {\n            s.push_attrs(hattrs_enum, \u0026context)?;\n        }\n        Ok(s)\n    }\n    fn apply_attrs(\u0026mut self, hattrs: \u0026HelperAttributes) -\u003e Result\u003c()\u003e {\n        if hattrs.default_self.is_some() {\n            self.use_default = true;\n        }\n        for field in \u0026hattrs.default_fields {\n            let key = FieldKey::from_member(\u0026field.0);\n            let span = field.span();\n            self.field(\u0026key, span)?.use_default = true;\n        }\n        if let Some(span) = hattrs.from_str_format_span() {\n            self.span = span;\n        }\n        Ok(())\n    }\n    fn field(\u0026mut self, key: \u0026FieldKey, span: Span) -\u003e Result\u003c\u0026mut FieldEntry\u003c'a\u003e\u003e {\n        field_of(\u0026mut self.fields, key, span)\n    }\n    fn set_capture(\n        \u0026mut self,\n        context: \u0026DisplayContext,\n        keys: \u0026[FieldKey],\n        span: Span,\n    ) -\u003e Result\u003cString\u003e {\n        let field_key;\n        let sub_keys;\n        if let DisplayContext::Field { key, .. } = context {\n            field_key = *key;\n            sub_keys = keys;\n        } else {\n            if keys.is_empty() {\n                return Ok(CAPTURE_NAME_EMPTY.into());\n            }\n            field_key = \u0026keys[0];\n            sub_keys = \u0026keys[1..];\n        }\n        let field = field_of(\u0026mut self.fields, field_key, span)?;\n        Ok(field.set_capture(sub_keys, \u0026mut self.capture_next))\n    }\n\n    fn push_regex(\u0026mut self, s: \u0026LitStr, context: \u0026DisplayContext) -\u003e Result\u003c()\u003e {\n        static REGEX_CAPTURE: Lazy\u003cRegex\u003e = lazy_regex!(r\"\\(\\?P\u003c([_0-9a-zA-Z.]*)\u003e\");\n        static REGEX_NUMBER: Lazy\u003cRegex\u003e = lazy_regex!(\"^[0-9]+$\");\n        let text = s.value();\n        let text_debug = REGEX_CAPTURE.replace_all(\u0026text, |c: \u0026Captures| {\n            let key = c.get(1).unwrap().as_str();\n            let key = if key.is_empty() {\n                \"self\".into()\n            } else {\n                key.replace('.', \"_\")\n            };\n            let key = REGEX_NUMBER.replace(\u0026key, \"_$0\");\n            format!(\"(?P\u003c{}\u003e\", key)\n        });\n        if let Err(e) = regex_syntax::ast::parse::Parser::new().parse(\u0026text_debug) {\n            bail!(s.span(), \"{}\", e)\n        }\n\n        let mut has_capture = false;\n        let mut has_capture_empty = false;\n        let mut text = try_replace_all(\u0026REGEX_CAPTURE, \u0026text, |c: \u0026Captures| -\u003e Result\u003cString\u003e {\n            has_capture = true;\n            let keys = FieldKey::from_str_deep(c.get(1).unwrap().as_str());\n            let name = self.set_capture(context, \u0026keys, s.span())?;\n            if name == CAPTURE_NAME_EMPTY {\n                has_capture_empty = true;\n            }\n            Ok(format!(\"(?P\u003c{}\u003e\", name))\n        })?;\n\n        if has_capture_empty {\n            if let DisplayContext::Variant { variant, style } = context {\n                let value = style.apply(\u0026variant.ident);\n                self.parse_format\n                    .push_hir(to_hir_with_expand(\u0026text, CAPTURE_NAME_EMPTY, \u0026value));\n                return Ok(());\n            } else {\n                bail!(\n                    s.span(),\n                    \"`(?P\u003c\u003e)` (empty capture name) is not allowed in struct's regex.\"\n                );\n            }\n        }\n        if let DisplayContext::Field { .. } = context {\n            if !has_capture {\n                let name = self.set_capture(context, \u0026[], s.span())?;\n                text = format!(\"(?P\u003c{}\u003e{})\", name, \u0026text);\n            }\n        }\n        self.parse_format.push_hir(to_hir(\u0026text));\n        Ok(())\n    }\n    fn push_format(\u0026mut self, format: \u0026DisplayFormat, context: \u0026DisplayContext) -\u003e Result\u003c()\u003e {\n        for p in \u0026format.parts {\n            match p {\n                DisplayFormatPart::Str(s) =\u003e self.push_str(s),\n                DisplayFormatPart::EscapedBeginBracket =\u003e self.push_str(\"{\"),\n                DisplayFormatPart::EscapedEndBracket =\u003e self.push_str(\"}\"),\n                DisplayFormatPart::Var { arg, .. } =\u003e {\n                    let keys = FieldKey::from_str_deep(arg);\n                    if let DisplayContext::Variant { variant, style } = context {\n                        if keys.is_empty() {\n                            self.push_str(\u0026style.apply(\u0026variant.ident));\n                            continue;\n                        }\n                    }\n                    if keys.len() == 1 {\n                        self.push_field(context, \u0026keys[0], format.span)?;\n                        continue;\n                    }\n                    let c = self.set_capture(context, \u0026keys, format.span)?;\n                    self.parse_format\n                        .push_hir(to_hir(\u0026format!(\"(?P\u003c{}\u003e.*?)\", c)));\n                }\n            }\n        }\n        Ok(())\n    }\n    fn push_str(\u0026mut self, string: \u0026str) {\n        self.parse_format.push_str(string)\n    }\n    fn push_field(\u0026mut self, context: \u0026DisplayContext, key: \u0026FieldKey, span: Span) -\u003e Result\u003c()\u003e {\n        let e = self.field(key, span)?;\n        let hattrs = e.hattrs.clone();\n        let parent = context;\n        let field = e.source;\n        self.push_attrs(\u0026hattrs, \u0026DisplayContext::Field { parent, key, field })\n    }\n    fn push_attrs(\u0026mut self, hattrs: \u0026HelperAttributes, context: \u0026DisplayContext) -\u003e Result\u003c()\u003e {\n        if !self.try_push_attrs(hattrs, context)? {\n            self.push_format(\u0026context.default_from_str_format()?, context)?;\n        }\n        Ok(())\n    }\n    fn try_push_attrs(\n        \u0026mut self,\n        hattrs: \u0026HelperAttributes,\n        context: \u0026DisplayContext,\n    ) -\u003e Result\u003cbool\u003e {\n        Ok(if let Some(regex) = \u0026hattrs.regex {\n            self.push_regex(regex, context)?;\n            true\n        } else if let Some(format) = \u0026hattrs.format {\n            self.push_format(format, context)?;\n            true\n        } else {\n            false\n        })\n    }\n\n    fn build_from_str_body(\u0026self, constructor: Path) -\u003e Result\u003cTokenStream\u003e {\n        let code = self.build_parse_code(constructor)?;\n        Ok(quote! {\n            #code\n            Err(parse_display::ParseError::new())\n        })\n    }\n    fn build_parse_variant_code(\u0026self, constructor: Path) -\u003e Result\u003cParseVariantCode\u003e {\n        match \u0026self.parse_format {\n            ParseFormat::Hirs(_) =\u003e {\n                let fn_ident: Ident = format_ident!(\"parse_variant\");\n                let code = self.build_from_str_body(constructor)?;\n                let code = quote! {\n                    let #fn_ident = |s: \u0026str| -\u003e core::result::Result\u003cSelf, parse_display::ParseError\u003e {\n                        #code\n                    };\n                    if let Ok(value) = #fn_ident(s) {\n                        return Ok(value);\n                    }\n                };\n                Ok(ParseVariantCode::Statement(code))\n            }\n            ParseFormat::String(s) =\u003e {\n                let code = self.build_construct_code(constructor)?;\n                let code = quote! { #s  =\u003e { #code }};\n                Ok(ParseVariantCode::MatchArm(code))\n            }\n        }\n    }\n\n    fn build_construct_code(\u0026self, constructor: Path) -\u003e Result\u003cTokenStream\u003e {\n        let code = if let Some(new_expr) = \u0026self.new_expr {\n            let mut code = TokenStream::new();\n            for (key, field) in \u0026self.fields {\n                let expr = field.build_field_init_expr(key, self.span)?;\n                let var = key.new_arg_var();\n                code.extend(quote! { let #var = #expr; });\n            }\n            code.extend(quote! {\n                if let Ok(value) = ::parse_display::IntoResult::into_result(#new_expr) {\n                    return Ok(value);\n                }\n            });\n            code\n        } else if self.use_default {\n            let mut setters = Vec::new();\n            for (key, field) in \u0026self.fields {\n                let left_expr = quote! { value . #key };\n                setters.push(field.build_setters(key, left_expr, true));\n            }\n            quote! {\n                let mut value = \u003cSelf as core::default::Default\u003e::default();\n                #(#setters)*\n                return Ok(value);\n            }\n        } else {\n            let ps = match \u0026self.source {\n                Fields::Named(..) =\u003e {\n                    let mut fields_code = Vec::new();\n                    for (key, field) in \u0026self.fields {\n                        let expr = field.build_field_init_expr(key, self.span)?;\n                        fields_code.push(quote! { #key : #expr })\n                    }\n                    quote! { { #(#fields_code,)* } }\n                }\n                Fields::Unnamed(..) =\u003e {\n                    let mut fields_code = Vec::new();\n                    for (key, field) in \u0026self.fields {\n                        fields_code.push(field.build_field_init_expr(key, self.span)?);\n                    }\n                    quote! { ( #(#fields_code,)* ) }\n                }\n                Fields::Unit =\u003e quote! {},\n            };\n            quote! { return Ok(#constructor #ps); }\n        };\n        Ok(code)\n    }\n    fn build_parse_code(\u0026self, constructor: Path) -\u003e Result\u003cTokenStream\u003e {\n        let code = self.build_construct_code(constructor)?;\n        let code = match \u0026self.parse_format {\n            ParseFormat::Hirs(hirs) =\u003e {\n                let regex = to_regex_string(hirs);\n                quote! {\n                    #[allow(clippy::trivial_regex)]\n                    static RE: parse_display::helpers::once_cell::sync::Lazy\u003cparse_display::helpers::regex::Regex\u003e =\n                        parse_display::helpers::once_cell::sync::Lazy::new(|| parse_display::helpers::regex::Regex::new(#regex).unwrap());\n                    if let Some(c) = RE.captures(\u0026s) {\n                         #code\n                    }\n                }\n            }\n            ParseFormat::String(s) =\u003e {\n                quote! {\n                    if s == #s {\n                        #code\n                    }\n                }\n            }\n        };\n        Ok(code)\n    }\n\n    fn build_bounds(\u0026self, generics: \u0026GenericParamSet, bounds: \u0026mut Bounds) {\n        if !bounds.can_extend {\n            return;\n        }\n        for field in self.fields.values() {\n            let mut bounds = bounds.child(field.hattrs.bound_from_str_resolved());\n            if bounds.can_extend \u0026\u0026 field.capture.is_some() {\n                let ty = \u0026field.source.ty;\n                if generics.contains_in_type(ty) {\n                    bounds.ty.push(ty.clone());\n                }\n            }\n        }\n    }\n}\nimpl\u003c'a\u003e FieldEntry\u003c'a\u003e {\n    fn new(source: \u0026'a Field) -\u003e Result\u003cSelf\u003e {\n        let hattrs = HelperAttributes::from(\u0026source.attrs)?;\n        let use_default = hattrs.default_self.is_some();\n        Ok(Self {\n            hattrs,\n            deep_captures: BTreeMap::new(),\n            capture: None,\n            use_default,\n            source,\n        })\n    }\n    #[allow(clippy::collapsible_else_if)]\n    fn set_capture(\u0026mut self, keys: \u0026[FieldKey], capture_next: \u0026mut usize) -\u003e String {\n        let idx = if keys.is_empty() {\n            if let Some(idx) = self.capture {\n                idx\n            } else {\n                let idx = *capture_next;\n                self.capture = Some(idx);\n                *capture_next += 1;\n                idx\n            }\n        } else {\n            if let Some(\u0026idx) = self.deep_captures.get(keys) {\n                idx\n            } else {\n                let idx = *capture_next;\n                self.deep_captures.insert(keys.to_vec(), idx);\n                *capture_next += 1;\n                idx\n            }\n        };\n        capture_name(idx)\n    }\n    fn capture(\u0026self) -\u003e Option\u003cString\u003e {\n        self.capture.map(capture_name)\n    }\n    fn build_expr(\u0026self, key: \u0026FieldKey) -\u003e Option\u003cTokenStream\u003e {\n        if let Some(capture_name) = self.capture() {\n            Some(build_parse_capture_expr(\u0026key.to_string(), \u0026capture_name))\n        } else if self.use_default {\n            Some(quote! { core::default::Default::default() })\n        } else {\n            None\n        }\n    }\n    fn build_setters(\n        \u0026self,\n        key: \u0026FieldKey,\n        left_expr: TokenStream,\n        include_self: bool,\n    ) -\u003e TokenStream {\n        let mut setters = Vec::new();\n        if include_self {\n            if let Some(expr) = self.build_expr(key) {\n                setters.push(quote! { #left_expr = #expr; });\n            }\n        }\n        for (keys, idx) in \u0026self.deep_captures {\n            let field_name = key.to_string() + \u0026join(keys, \".\");\n            let expr = build_parse_capture_expr(\u0026field_name, \u0026capture_name(*idx));\n            setters.push(quote! { #left_expr #(.#keys)* = #expr; });\n        }\n        quote! { #(#setters)* }\n    }\n\n    fn build_field_init_expr(\u0026self, key: \u0026FieldKey, span: Span) -\u003e Result\u003cTokenStream\u003e {\n        if let Some(mut expr) = self.build_expr(key) {\n            if !self.deep_captures.is_empty() {\n                let setters = self.build_setters(key, quote!(field_value), false);\n                let ty = \u0026self.source.ty;\n                expr = quote! {\n                    {\n                        let mut field_value : #ty = #expr;\n                        #setters\n                        field_value\n                    }\n                };\n            }\n            return Ok(expr);\n        }\n        bail!(span, \"field `{}` is not appear in format.\", key);\n    }\n}\n\nfn get_newtype_field(data: \u0026DataStruct) -\u003e Option\u003cString\u003e {\n    let fields: Vec\u003c_\u003e = data.fields.iter().collect();\n    if fields.len() == 1 {\n        if let Some(ident) = \u0026fields[0].ident {\n            Some(ident.to_string())\n        } else {\n            Some(\"0\".into())\n        }\n    } else {\n        None\n    }\n}\n\n#[derive(StructMeta)]\nstruct DisplayArgs {\n    #[struct_meta(unnamed)]\n    format: Option\u003cLitStr\u003e,\n    style: Option\u003cLitStr\u003e,\n    bound: Option\u003cVec\u003cQuotable\u003cBound\u003e\u003e\u003e,\n    dump: bool,\n}\n\n#[derive(Clone, ToTokens)]\nstruct DefaultField(Member);\n\nimpl Parse for DefaultField {\n    fn parse(input: ParseStream) -\u003e Result\u003cSelf\u003e {\n        if input.peek(Ident::peek_any) {\n            Ok(Self(Member::Named(Ident::parse_any(input)?)))\n        } else {\n            Ok(Self(input.parse()?))\n        }\n    }\n}\n\n#[derive(StructMeta)]\nstruct FromStrArgs {\n    regex: Option\u003cLitStr\u003e,\n    new: Option\u003cExpr\u003e,\n    bound: Option\u003cVec\u003cQuotable\u003cBound\u003e\u003e\u003e,\n    default: Flag,\n    default_fields: Option\u003cVec\u003cQuotable\u003cDefaultField\u003e\u003e\u003e,\n    dump: bool,\n}\n\n#[derive(Clone)]\nstruct HelperAttributes {\n    format: Option\u003cDisplayFormat\u003e,\n    style: Option\u003cDisplayStyle\u003e,\n    bound_display: Option\u003cVec\u003cBound\u003e\u003e,\n    bound_from_str: Option\u003cVec\u003cBound\u003e\u003e,\n    regex: Option\u003cLitStr\u003e,\n    default_self: Option\u003cSpan\u003e,\n    default_fields: Vec\u003cDefaultField\u003e,\n    new_expr: Option\u003cExpr\u003e,\n    dump_display: bool,\n    dump_from_str: bool,\n}\nimpl HelperAttributes {\n    fn from(attrs: \u0026[Attribute]) -\u003e Result\u003cSelf\u003e {\n        let mut hattrs = Self {\n            format: None,\n            style: None,\n            bound_display: None,\n            bound_from_str: None,\n            regex: None,\n            new_expr: None,\n            default_self: None,\n            default_fields: Vec::new(),\n            dump_display: false,\n            dump_from_str: false,\n        };\n        for a in attrs {\n            if a.path.is_ident(\"display\") {\n                hattrs.set_display_args(a.parse_args()?)?;\n            }\n            if a.path.is_ident(\"from_str\") {\n                hattrs.set_from_str_args(a.parse_args()?);\n            }\n        }\n        Ok(hattrs)\n    }\n    fn set_display_args(\u0026mut self, args: DisplayArgs) -\u003e Result\u003c()\u003e {\n        if let Some(format) = \u0026args.format {\n            self.format = Some(DisplayFormat::parse_lit_str(format)?);\n        }\n        if let Some(style) = \u0026args.style {\n            self.style = Some(DisplayStyle::parse_lit_str(style)?);\n        }\n        if let Some(bounds) = args.bound {\n            let list = self.bound_display.get_or_insert(Vec::new());\n            for bound in bounds {\n                for bound in bound.into_iter() {\n                    list.push(bound);\n                }\n            }\n        }\n        self.dump_from_str |= args.dump;\n        self.dump_display |= args.dump;\n        Ok(())\n    }\n    fn set_from_str_args(\u0026mut self, args: FromStrArgs) {\n        if let Some(regex) = args.regex {\n            self.regex = Some(regex);\n        }\n        if let Some(new) = args.new {\n            self.new_expr = Some(new);\n        }\n        if let Some(bound) = args.bound {\n            let list = self.bound_from_str.get_or_insert(Vec::new());\n            for bound in bound {\n                for bound in bound.into_iter() {\n                    list.push(bound);\n                }\n            }\n        }\n        if let Some(span) = args.default.span {\n            self.default_self = Some(span);\n        }\n        if let Some(fields) = args.default_fields {\n            for field in fields {\n                for field in field.into_iter() {\n                    self.default_fields.push(field);\n                }\n            }\n        }\n        self.dump_from_str |= args.dump;\n    }\n    fn from_str_format_span(\u0026self) -\u003e Option\u003cSpan\u003e {\n        if let Some(lit) = \u0026self.regex {\n            return Some(lit.span());\n        }\n        if let Some(format) = \u0026self.format {\n            return Some(format.span);\n        }\n        None\n    }\n    fn bound_from_str_resolved(\u0026self) -\u003e Option\u003cVec\u003cBound\u003e\u003e {\n        self.bound_from_str\n            .clone()\n            .or_else(|| self.bound_display.clone())\n    }\n}\n\n#[derive(Copy, Clone)]\nenum DisplayStyle {\n    None,\n    LowerCase,\n    UpperCase,\n    LowerSnakeCase,\n    UpperSnakeCase,\n    LowerCamelCase,\n    UpperCamelCase,\n    LowerKebabCase,\n    UpperKebabCase,\n    TitleCase,\n    TitleCaseHead,\n    TitleCaseLower,\n    TitleCaseUpper,\n}\n\nimpl DisplayStyle {\n    fn parse_lit_str(s: \u0026LitStr) -\u003e Result\u003cSelf\u003e {\n        const ERROR_MESSAGE: \u0026str = \"Invalid display style. \\\n        The following values are available: \\\n        \\\"none\\\", \\\n        \\\"lowercase\\\", \\\n        \\\"UPPERCASE\\\", \\\n        \\\"snake_case\\\", \\\n        \\\"SNAKE_CASE\\\", \\\n        \\\"camelCase\\\", \\\n        \\\"CamelCase\\\", \\\n        \\\"kebab-case\\\", \\\n        \\\"KEBAB-CASE\\\", \\\n        \\\"Title Case\\\", \\\n        \\\"Title case\\\", \\\n        \\\"title case\\\", \\\n        \\\"TITLE CASE\\\"\";\n        match Self::parse(\u0026s.value()) {\n            Err(_) =\u003e bail!(s.span(), ERROR_MESSAGE),\n            Ok(value) =\u003e Ok(value),\n        }\n    }\n    fn parse(s: \u0026str) -\u003e std::result::Result\u003cSelf, ParseDisplayStyleError\u003e {\n        use DisplayStyle::*;\n        Ok(match s {\n            \"none\" =\u003e None,\n            \"lowercase\" =\u003e LowerCase,\n            \"UPPERCASE\" =\u003e UpperCase,\n            \"snake_case\" =\u003e LowerSnakeCase,\n            \"SNAKE_CASE\" =\u003e UpperSnakeCase,\n            \"camelCase\" =\u003e LowerCamelCase,\n            \"CamelCase\" =\u003e UpperCamelCase,\n            \"kebab-case\" =\u003e LowerKebabCase,\n            \"KEBAB-CASE\" =\u003e UpperKebabCase,\n            \"Title Case\" =\u003e TitleCase,\n            \"Title case\" =\u003e TitleCaseHead,\n            \"title case\" =\u003e TitleCaseLower,\n            \"TITLE CASE\" =\u003e TitleCaseUpper,\n            _ =\u003e return Err(ParseDisplayStyleError),\n        })\n    }\n    fn from_helper_attributes(\n        hattrs_enum: \u0026HelperAttributes,\n        hattrs_variant: \u0026HelperAttributes,\n    ) -\u003e Self {\n        hattrs_variant\n            .style\n            .or(hattrs_enum.style)\n            .unwrap_or(DisplayStyle::None)\n    }\n    fn apply(self, ident: \u0026Ident) -\u003e String {\n        fn convert_case(c: char, to_upper: bool) -\u003e char {\n            if to_upper {\n                c.to_ascii_uppercase()\n            } else {\n                c.to_ascii_lowercase()\n            }\n        }\n\n        let s = ident.to_string();\n        let (line_head, word_head, normal, sep) = match self {\n            DisplayStyle::None =\u003e {\n                return s;\n            }\n            DisplayStyle::LowerCase =\u003e (false, false, false, \"\"),\n            DisplayStyle::UpperCase =\u003e (true, true, true, \"\"),\n            DisplayStyle::LowerSnakeCase =\u003e (false, false, false, \"_\"),\n            DisplayStyle::UpperSnakeCase =\u003e (true, true, true, \"_\"),\n            DisplayStyle::LowerCamelCase =\u003e (false, true, false, \"\"),\n            DisplayStyle::UpperCamelCase =\u003e (true, true, false, \"\"),\n            DisplayStyle::LowerKebabCase =\u003e (false, false, false, \"-\"),\n            DisplayStyle::UpperKebabCase =\u003e (true, true, true, \"-\"),\n            DisplayStyle::TitleCase =\u003e (true, true, false, \" \"),\n            DisplayStyle::TitleCaseUpper =\u003e (true, true, true, \" \"),\n            DisplayStyle::TitleCaseLower =\u003e (false, false, false, \" \"),\n            DisplayStyle::TitleCaseHead =\u003e (true, false, false, \" \"),\n        };\n        let mut is_line_head = true;\n        let mut is_word_head = true;\n        let mut last = '\\0';\n\n        let mut r = String::new();\n        for c in s.chars() {\n            if !c.is_alphanumeric() \u0026\u0026 !c.is_digit(10) {\n                is_word_head = true;\n                continue;\n            }\n            is_word_head = is_word_head || (!last.is_ascii_uppercase() \u0026\u0026 c.is_ascii_uppercase());\n            last = c;\n            let (to_upper, sep) = match (is_line_head, is_word_head) {\n                (true, _) =\u003e (line_head, \"\"),\n                (false, true) =\u003e (word_head, sep),\n                (false, false) =\u003e (normal, \"\"),\n            };\n            r.push_str(sep);\n            r.push(convert_case(c, to_upper));\n            is_word_head = false;\n            is_line_head = false;\n        }\n        r\n    }\n}\n\n#[derive(Clone)]\nstruct DisplayFormat {\n    parts: Vec\u003cDisplayFormatPart\u003e,\n    span: Span,\n}\nimpl DisplayFormat {\n    fn parse_lit_str(s: \u0026LitStr) -\u003e Result\u003cDisplayFormat\u003e {\n        Self::parse(\u0026s.value(), s.span())\n    }\n    fn parse(mut s: \u0026str, span: Span) -\u003e Result\u003cDisplayFormat\u003e {\n        static REGEX_STR: Lazy\u003cRegex\u003e = lazy_regex!(r\"^[^{}]+\");\n        static REGEX_VAR: Lazy\u003cRegex\u003e = lazy_regex!(r\"^\\{([^:{}]*)(?::([^}]*))?\\}\");\n        let mut parts = Vec::new();\n        while !s.is_empty() {\n            if s.starts_with(\"{{\") {\n                parts.push(DisplayFormatPart::EscapedBeginBracket);\n                s = \u0026s[2..];\n                continue;\n            }\n            if s.starts_with(\"}}\") {\n                parts.push(DisplayFormatPart::EscapedEndBracket);\n                s = \u0026s[2..];\n                continue;\n            }\n            if let Some(m) = REGEX_STR.find(s) {\n                parts.push(DisplayFormatPart::Str(m.as_str().into()));\n                s = \u0026s[m.end()..];\n                continue;\n            }\n            if let Some(c) = REGEX_VAR.captures(s) {\n                let arg = c.get(1).unwrap().as_str().into();\n                let format_spec = c.get(2).map_or(\"\", |x| x.as_str()).into();\n                parts.push(DisplayFormatPart::Var { arg, format_spec });\n                s = \u0026s[c.get(0).unwrap().end()..];\n                continue;\n            }\n            bail!(span, \"invalid display format.\");\n        }\n        Ok(Self { parts, span })\n    }\n    fn from_newtype_struct(data: \u0026DataStruct) -\u003e Option\u003cSelf\u003e {\n        let p = DisplayFormatPart::Var {\n            arg: get_newtype_field(data)?,\n            format_spec: String::new(),\n        };\n        Some(Self {\n            parts: vec![p],\n            span: data.fields.span(),\n        })\n    }\n    fn from_unit_variant(variant: \u0026Variant) -\u003e Result\u003cOption\u003cSelf\u003e\u003e {\n        Ok(if let Fields::Unit = \u0026variant.fields {\n            Some(Self::parse(\"{}\", variant.span())?)\n        } else {\n            None\n        })\n    }\n\n    fn format_args(\n        \u0026self,\n        context: DisplayContext,\n        bounds: \u0026mut Bounds,\n        generics: \u0026GenericParamSet,\n    ) -\u003e Result\u003cTokenStream\u003e {\n        let mut format_str = String::new();\n        let mut format_args = Vec::new();\n        for p in \u0026self.parts {\n            use DisplayFormatPart::*;\n            match p {\n                Str(s) =\u003e format_str.push_str(s.as_str()),\n                EscapedBeginBracket =\u003e format_str.push_str(\"{{\"),\n                EscapedEndBracket =\u003e format_str.push_str(\"}}\"),\n                Var { arg, format_spec } =\u003e {\n                    format_str.push('{');\n                    if !format_spec.is_empty() {\n                        format_str.push(':');\n                        format_str.push_str(format_spec);\n                    }\n                    format_str.push('}');\n                    format_args.push(context.format_arg(\n                        arg,\n                        format_spec,\n                        self.span,\n                        bounds,\n                        generics,\n                    )?);\n                }\n            }\n        }\n        let format_str = LitStr::new(\u0026format_str, self.span);\n        Ok(quote! { #format_str #(,#format_args)* })\n    }\n}\n\n#[derive(Clone)]\nenum DisplayFormatPart {\n    Str(String),\n    EscapedBeginBracket,\n    EscapedEndBracket,\n    Var { arg: String, format_spec: String },\n}\n\nenum DisplayContext\u003c'a\u003e {\n    Struct {\n        data: \u0026'a DataStruct,\n    },\n    Variant {\n        variant: \u0026'a Variant,\n        style: DisplayStyle,\n    },\n    Field {\n        parent: \u0026'a DisplayContext\u003c'a\u003e,\n        field: \u0026'a Field,\n        key: \u0026'a FieldKey,\n    },\n}\n\nimpl\u003c'a\u003e DisplayContext\u003c'a\u003e {\n    fn format_arg(\n        \u0026self,\n        arg: \u0026str,\n        format_spec: \u0026str,\n        span: Span,\n        bounds: \u0026mut Bounds,\n        generics: \u0026GenericParamSet,\n    ) -\u003e Result\u003cTokenStream\u003e {\n        let keys = FieldKey::from_str_deep(arg);\n        if keys.is_empty() {\n            return Ok(match self {\n                DisplayContext::Struct { .. } =\u003e bail!(span, \"{} is not allowed in struct format.\"),\n                DisplayContext::Field { parent, field, key } =\u003e parent.format_arg_by_field_expr(\n                    key,\n                    field,\n                    format_spec,\n                    span,\n                    bounds,\n                    generics,\n                )?,\n                DisplayContext::Variant { variant, style } =\u003e {\n                    let s = style.apply(\u0026variant.ident);\n                    quote! { #s }\n                }\n            });\n        }\n\n        if keys.len() == 1 {\n            if let Some(fields) = self.fields() {\n                let key = \u0026keys[0];\n                let m = field_map(fields);\n                let field = if let Some(field) = m.get(key) {\n                    field\n                } else {\n                    bail!(span, \"unknown field '{}'.\", key);\n                };\n                return self.format_arg_of_field(key, field, format_spec, span, bounds, generics);\n            }\n        }\n        let mut expr = self.field_expr(\u0026keys[0]);\n        for key in \u0026keys[1..] {\n            expr.extend(quote! { .#key });\n        }\n        Ok(expr)\n    }\n    fn format_arg_of_field(\n        \u0026self,\n        key: \u0026FieldKey,\n        field: \u0026Field,\n        parameters: \u0026str,\n        span: Span,\n        bounds: \u0026mut Bounds,\n        generics: \u0026GenericParamSet,\n    ) -\u003e Result\u003cTokenStream\u003e {\n        let hattrs = HelperAttributes::from(\u0026field.attrs)?;\n        let mut bounds = bounds.child(hattrs.bound_display);\n        Ok(if let Some(format) = hattrs.format {\n            let args = format.format_args(\n                DisplayContext::Field {\n                    parent: self,\n                    field,\n                    key,\n                },\n                \u0026mut bounds,\n                generics,\n            )?;\n            quote! { format_args!(#args) }\n        } else {\n            self.format_arg_by_field_expr(key, field, parameters, span, \u0026mut bounds, generics)?\n        })\n    }\n    fn format_arg_by_field_expr(\n        \u0026self,\n        key: \u0026FieldKey,\n        field: \u0026Field,\n        format_spec: \u0026str,\n        span: Span,\n        bounds: \u0026mut Bounds,\n        generics: \u0026GenericParamSet,\n    ) -\u003e Result\u003cTokenStream\u003e {\n        let ty = \u0026field.ty;\n        if generics.contains_in_type(ty) {\n            let ps = match FormatSpec::parse(format_spec) {\n                Ok(ps) =\u003e ps,\n                Err(_) =\u003e bail!(span, \"invalid format parameters \\\"{}\\\".\", format_spec),\n            };\n            let tr = ps.format_type.trait_name();\n            let tr: Ident = parse_str(tr).unwrap();\n            if bounds.can_extend {\n                bounds.pred.push(parse_quote!(#ty : core::fmt::#tr));\n            }\n        }\n        Ok(self.field_expr(key))\n    }\n\n    fn field_expr(\u0026self, key: \u0026FieldKey) -\u003e TokenStream {\n        match self {\n            DisplayContext::Struct { .. } =\u003e quote! { self.#key },\n            DisplayContext::Variant { .. } =\u003e {\n                let var = key.binding_var();\n                quote! { #var }\n            }\n            DisplayContext::Field {\n                parent,\n                key: parent_key,\n                ..\n            } =\u003e {\n                let expr = parent.field_expr(parent_key);\n                quote! { #expr.#key }\n            }\n        }\n    }\n\n    fn default_from_str_format(\u0026self) -\u003e Result\u003cDisplayFormat\u003e {\n        const ERROR_MESSAGE_FOR_STRUCT:\u0026str=\"`#[display(\\\"format\\\")]` or `#[from_str(regex = \\\"regex\\\")]` is required except newtype pattern.\";\n        const ERROR_MESSAGE_FOR_VARIANT:\u0026str=\"`#[display(\\\"format\\\")]` or `#[from_str(regex = \\\"regex\\\")]` is required except unit variant.\";\n        Ok(match self {\n            DisplayContext::Struct { data, .. } =\u003e {\n                DisplayFormat::from_newtype_struct(data).expect(ERROR_MESSAGE_FOR_STRUCT)\n            }\n            DisplayContext::Variant { variant, .. } =\u003e {\n                DisplayFormat::from_unit_variant(variant)?.expect(ERROR_MESSAGE_FOR_VARIANT)\n            }\n            DisplayContext::Field { field, .. } =\u003e DisplayFormat::parse(\"{}\", field.span())?,\n        })\n    }\n    fn fields(\u0026self) -\u003e Option\u003c\u0026Fields\u003e {\n        match self {\n            DisplayContext::Struct { data, .. } =\u003e Some(\u0026data.fields),\n            DisplayContext::Variant { variant, .. } =\u003e Some(\u0026variant.fields),\n            DisplayContext::Field { .. } =\u003e None,\n        }\n    }\n}\n\n#[derive(Debug)]\nstruct ParseDisplayStyleError;\nimpl std::error::Error for ParseDisplayStyleError {}\n\nimpl Display for ParseDisplayStyleError {\n    fn fmt(\u0026self, f: \u0026mut Formatter\u003c'_\u003e) -\u003e std::fmt::Result {\n        write!(f, \"invalid display style\")\n    }\n}\n\nenum ParseFormat {\n    Hirs(Vec\u003cHir\u003e),\n    String(String),\n}\nimpl ParseFormat {\n    fn new() -\u003e Self {\n        Self::String(String::new())\n    }\n    fn as_hirs(\u0026mut self) -\u003e \u0026mut Vec\u003cHir\u003e {\n        match self {\n            Self::Hirs(_) =\u003e {}\n            Self::String(s) =\u003e {\n                let mut hirs = vec![Hir::anchor(regex_syntax::hir::Anchor::StartText)];\n                push_str(\u0026mut hirs, s);\n                std::mem::swap(self, \u0026mut Self::Hirs(hirs));\n            }\n        }\n        if let Self::Hirs(hirs) = self {\n            hirs\n        } else {\n            unreachable!()\n        }\n    }\n    fn push_str(\u0026mut self, string: \u0026str) {\n        match self {\n            Self::Hirs(hirs) =\u003e push_str(hirs, string),\n            Self::String(s) =\u003e s.push_str(string),\n        }\n    }\n    fn push_hir(\u0026mut self, hir: Hir) {\n        self.as_hirs().push(hir);\n    }\n}\n\nenum ParseVariantCode {\n    MatchArm(TokenStream),\n    Statement(TokenStream),\n}\n\n#[derive(Clone, ToTokens)]\nenum Bound {\n    Type(Type),\n    Pred(WherePredicate),\n    Default(Token![..]),\n}\n\nimpl Parse for Bound {\n    fn parse(input: ParseStream) -\u003e Result\u003cSelf\u003e {\n        if input.peek(Token![..]) {\n            return Ok(Self::Default(input.parse()?));\n        }\n        let fork = input.fork();\n        match fork.parse() {\n            Ok(p) =\u003e {\n                input.advance_to(\u0026fork);\n                Ok(Self::Pred(p))\n            }\n            Err(e) =\u003e {\n                if let Ok(ty) = input.parse() {\n                    Ok(Self::Type(ty))\n                } else {\n                    Err(e)\n                }\n            }\n        }\n    }\n}\n\nstruct Bounds {\n    ty: Vec\u003cType\u003e,\n    pred: Vec\u003cWherePredicate\u003e,\n    can_extend: bool,\n}\nimpl Bounds {\n    fn new(can_extend: bool) -\u003e Self {\n        Bounds {\n            ty: Vec::new(),\n            pred: Vec::new(),\n            can_extend,\n        }\n    }\n    fn from_data(bound: Option\u003cVec\u003cBound\u003e\u003e) -\u003e Self {\n        if let Some(bound) = bound {\n            let mut bs = Self::new(false);\n            for b in bound {\n                bs.push(b);\n            }\n            bs\n        } else {\n            Self::new(true)\n        }\n    }\n    fn push(\u0026mut self, bound: Bound) {\n        match bound {\n            Bound::Type(ty) =\u003e self.ty.push(ty),\n            Bound::Pred(pred) =\u003e self.pred.push(pred),\n            Bound::Default(_) =\u003e self.can_extend = true,\n        }\n    }\n    fn child(\u0026mut self, bounds: Option\u003cVec\u003cBound\u003e\u003e) -\u003e BoundsChild {\n        let bounds = if self.can_extend {\n            Self::from_data(bounds)\n        } else {\n            Self::new(false)\n        };\n        BoundsChild {\n            owner: self,\n            bounds,\n        }\n    }\n    fn build_wheres(self, trait_path: \u0026Path) -\u003e Vec\u003cWherePredicate\u003e {\n        let mut pred = self.pred;\n        for ty in self.ty {\n            pred.push(parse_quote!(#ty : #trait_path));\n        }\n        pred\n    }\n}\nstruct BoundsChild\u003c'a\u003e {\n    owner: \u0026'a mut Bounds,\n    bounds: Bounds,\n}\nimpl\u003c'a\u003e Deref for BoundsChild\u003c'a\u003e {\n    type Target = Bounds;\n\n    fn deref(\u0026self) -\u003e \u0026Self::Target {\n        \u0026self.bounds\n    }\n}\nimpl\u003c'a\u003e DerefMut for BoundsChild\u003c'a\u003e {\n    fn deref_mut(\u0026mut self) -\u003e \u0026mut Self::Target {\n        \u0026mut self.bounds\n    }\n}\nimpl\u003c'a\u003e Drop for BoundsChild\u003c'a\u003e {\n    fn drop(\u0026mut self) {\n        if self.owner.can_extend {\n            self.owner.ty.append(\u0026mut self.bounds.ty);\n            self.owner.pred.append(\u0026mut self.bounds.pred);\n        }\n    }\n}\n\n#[derive(Clone, PartialEq, Eq, PartialOrd, Ord, Debug)]\nenum FieldKey {\n    Named(String),\n    Unnamed(usize),\n}\n\nimpl FieldKey {\n    fn from_str(s: \u0026str) -\u003e FieldKey {\n        if let Ok(idx) = s.parse() {\n            FieldKey::Unnamed(idx)\n        } else {\n            FieldKey::Named(trim_raw(s).to_string())\n        }\n    }\n    fn from_string(mut s: String) -\u003e FieldKey {\n        if let Ok(idx) = s.parse() {\n            FieldKey::Unnamed(idx)\n        } else {\n            if s.starts_with(\"r#\") {\n                s.drain(0..2);\n            }\n            FieldKey::Named(s)\n        }\n    }\n    fn from_ident(ident: \u0026Ident) -\u003e FieldKey {\n        Self::from_string(ident.to_string())\n    }\n    fn from_str_deep(s: \u0026str) -\u003e Vec\u003cFieldKey\u003e {\n        if s.is_empty() {\n            Vec::new()\n        } else {\n            s.split('.').map(Self::from_str).collect()\n        }\n    }\n    fn from_fields_named(fields: \u0026FieldsNamed) -\u003e impl Iterator\u003cItem = (FieldKey, \u0026Field)\u003e {\n        fields\n            .named\n            .iter()\n            .map(|field| (Self::from_ident(field.ident.as_ref().unwrap()), field))\n    }\n    fn from_fields_unnamed(fields: \u0026FieldsUnnamed) -\u003e impl Iterator\u003cItem = (FieldKey, \u0026Field)\u003e {\n        fields\n            .unnamed\n            .iter()\n            .enumerate()\n            .map(|(idx, field)| (FieldKey::Unnamed(idx), field))\n    }\n    fn from_member(member: \u0026Member) -\u003e Self {\n        match member {\n            Member::Named(ident) =\u003e Self::from_ident(ident),\n            Member::Unnamed(index) =\u003e Self::Unnamed(index.index as usize),\n        }\n    }\n\n    fn to_member(\u0026self) -\u003e Member {\n        match self {\n            FieldKey::Named(s) =\u003e Member::Named(format_ident!(\"r#{}\", s)),\n            FieldKey::Unnamed(idx) =\u003e Member::Unnamed(parse_str(\u0026format!(\"{}\", idx)).unwrap()),\n        }\n    }\n    fn binding_var(\u0026self) -\u003e Ident {\n        parse_str(\u0026format!(\"_value_{}\", self)).unwrap()\n    }\n    fn new_arg_var(\u0026self) -\u003e Ident {\n        match self {\n            Self::Named(s) =\u003e parse_str(s),\n            Self::Unnamed(idx) =\u003e parse_str(\u0026format!(\"_{}\", idx)),\n        }\n        .unwrap()\n    }\n}\nimpl std::fmt::Display for FieldKey {\n    fn fmt(\u0026self, f: \u0026mut std::fmt::Formatter) -\u003e std::fmt::Result {\n        match self {\n            FieldKey::Named(s) =\u003e write!(f, \"{}\", s),\n            FieldKey::Unnamed(idx) =\u003e write!(f, \"{}\", idx),\n        }\n    }\n}\nimpl quote::ToTokens for FieldKey {\n    fn to_tokens(\u0026self, tokens: \u0026mut TokenStream) {\n        self.to_member().to_tokens(tokens)\n    }\n}\n\nfn field_map(fields: \u0026Fields) -\u003e BTreeMap\u003cFieldKey, \u0026Field\u003e {\n    let mut m = BTreeMap::new();\n    for (idx, field) in fields.iter().enumerate() {\n        let key = if let Some(ident) = \u0026field.ident {\n            FieldKey::from_ident(ident)\n        } else {\n            FieldKey::Unnamed(idx)\n        };\n        m.insert(key, field);\n    }\n    m\n}\n\nfn join\u003cT: std::fmt::Display\u003e(s: impl IntoIterator\u003cItem = T\u003e, sep: \u0026str) -\u003e String {\n    use std::fmt::*;\n    let mut sep_current = \"\";\n    let mut buf = String::new();\n    for i in s.into_iter() {\n        write!(\u0026mut buf, \"{}{}\", sep_current, i).unwrap();\n        sep_current = sep;\n    }\n    buf\n}\nfn trim_raw(s: \u0026str) -\u003e \u0026str {\n    if let Some(s) = s.strip_prefix(\"r#\") {\n        s\n    } else {\n        s\n    }\n}\n\nfn field_of\u003c'a, 'b\u003e(\n    fields: \u0026'a mut BTreeMap\u003cFieldKey, FieldEntry\u003c'b\u003e\u003e,\n    key: \u0026FieldKey,\n    span: Span,\n) -\u003e Result\u003c\u0026'a mut FieldEntry\u003c'b\u003e\u003e {\n    if let Some(f) = fields.get_mut(key) {\n        Ok(f)\n    } else {\n        bail!(span, \"field `{}` not found.\", key);\n    }\n}\n\nconst CAPTURE_NAME_EMPTY: \u0026str = \"empty\";\nfn capture_name(idx: usize) -\u003e String {\n    format!(\"value_{}\", idx)\n}\n\nfn build_parse_capture_expr(field_name: \u0026str, capture_name: \u0026str) -\u003e TokenStream {\n    let msg = format!(\"field `{}` parse failed.\", field_name);\n    quote! {\n        c.name(#capture_name)\n            .map_or(\"\", |m| m.as_str())\n            .parse()\n            .map_err(|e| parse_display::ParseError::with_message(#msg))?\n    }\n}\n","traces":[{"line":248,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":249,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":250,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":251,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":253,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":254,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":255,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":256,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":257,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":258,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":259,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":260,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":263,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":264,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":265,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":266,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":267,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":268,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":269,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":276,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":277,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":278,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":279,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":280,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":281,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":282,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":283,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":285,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":287,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":288,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":289,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":291,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":292,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":293,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":294,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":296,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":297,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":299,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":301,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":302,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":310,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":311,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":312,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":313,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":314,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":316,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":317,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":319,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":320,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":322,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":323,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":326,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":327,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":328,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":329,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":330,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":331,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":332,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":333,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":335,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":337,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":338,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":340,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":341,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":344,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":345,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":346,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":347,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":348,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":349,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":350,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":351,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":353,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":356,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":357,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":358,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":359,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":360,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":361,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":363,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":364,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":369,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":370,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":371,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":372,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":375,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":376,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":378,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":379,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":380,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":381,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":382,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":383,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":384,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":385,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":386,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":387,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":388,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":389,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":392,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":393,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":394,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":396,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":397,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":398,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":402,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":404,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":405,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":407,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":408,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":409,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":410,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":411,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":412,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":414,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":415,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":416,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":418,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":425,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":426,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":427,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":428,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":429,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":430,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":432,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":436,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":437,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":438,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":439,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":440,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":443,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":444,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":445,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":446,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":447,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":448,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":449,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":450,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":452,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":453,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":456,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":458,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":459,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":460,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":461,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":466,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":467,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":468,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":469,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":470,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":471,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":472,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":474,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":475,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":476,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":479,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":480,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":481,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":482,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":483,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":484,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":486,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":487,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":488,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":489,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":492,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":493,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":494,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":495,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":496,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":497,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":499,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":501,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":502,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":503,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":504,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":506,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":508,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":510,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":512,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":514,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":515,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":516,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":517,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":518,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":519,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":520,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":521,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":522,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":523,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":524,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":528,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":529,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":530,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":531,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":536,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":539,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":540,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":541,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":543,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":544,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":545,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":546,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":547,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":548,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":555,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":556,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":557,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":558,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":559,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":560,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":561,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":562,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":563,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":567,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":568,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":569,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":570,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":572,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":573,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":574,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":575,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":578,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":579,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":581,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":582,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":583,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":584,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":587,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":589,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":590,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":592,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":593,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":594,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":595,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":596,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":598,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":607,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":608,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":609,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":610,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":613,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":614,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":615,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":616,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":618,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":621,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":622,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":623,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":624,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":625,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":626,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":628,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":629,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":630,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":634,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":636,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1030,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1031,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1032,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1033,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1034,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1035,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1036,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1037,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1038,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1039,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1040,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1042,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1043,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1044,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1049,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1050,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1051,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1052,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1053,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1054,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1056,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1058,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1061,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1062,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1063,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1065,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1076,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1077,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1078,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1079,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1080,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1081,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1082,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1083,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1085,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1086,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1088,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1090,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1102,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1103,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1104,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1105,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1106,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1108,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1109,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1110,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1111,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1114,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1117,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1118,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1119,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1120,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1121,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1122,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1124,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1125,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1126,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1127,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1128,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1129,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1130,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1135,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1138,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1139,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1140,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1142,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1143,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1145,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1148,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1149,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1150,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1151,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1152,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1292,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1293,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1297,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1298,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1302,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1303,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1304,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1305,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1408,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1410,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1411,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1412,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1413,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1414,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1416,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1431,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1432,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1434,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":348},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","parse-display","parse-display-derive","src","regex_utils.rs"],"content":"use regex::{Captures, Regex};\nuse regex_syntax::ast::Ast;\nuse regex_syntax::hir::Hir;\n\npub fn to_hir(s: \u0026str) -\u003e Hir {\n    regex_syntax::Parser::new().parse(s).unwrap()\n}\npub fn to_hir_with_expand(s: \u0026str, name: \u0026str, value: \u0026str) -\u003e Hir {\n    let mut ast = to_ast(s);\n    expand_capture(\u0026mut ast, |group_name| {\n        if group_name == name {\n            Some(to_ast(\u0026regex_syntax::escape(value)))\n        } else {\n            None\n        }\n    });\n    let s = format!(\"{}\", \u0026ast);\n\n    regex_syntax::hir::translate::Translator::new()\n        .translate(\u0026s, \u0026ast)\n        .unwrap()\n}\n\nfn to_ast(s: \u0026str) -\u003e Ast {\n    regex_syntax::ast::parse::Parser::new().parse(s).unwrap()\n}\n\npub fn push_str(hirs: \u0026mut Vec\u003cHir\u003e, s: \u0026str) {\n    for c in s.chars() {\n        hirs.push(Hir::literal(regex_syntax::hir::Literal::Unicode(c)));\n    }\n}\npub fn to_regex_string(hirs: \u0026[Hir]) -\u003e String {\n    let mut hirs = hirs.to_vec();\n    hirs.push(Hir::anchor(regex_syntax::hir::Anchor::EndText));\n    Hir::concat(hirs).to_string()\n}\n\nfn replace_ast(ast: \u0026mut Ast, f: \u0026mut impl FnMut(\u0026mut Ast) -\u003e bool) {\n    if !f(ast) {\n        return;\n    }\n    use regex_syntax::ast::*;\n    match ast {\n        Ast::Empty(..)\n        | Ast::Flags(..)\n        | Ast::Literal(..)\n        | Ast::Dot(..)\n        | Ast::Assertion(..)\n        | Ast::Class(..) =\u003e {}\n        Ast::Repetition(Repetition { ast, .. }) | Ast::Group(Group { ast, .. }) =\u003e {\n            replace_ast(ast, f)\n        }\n        Ast::Alternation(Alternation { asts, .. }) | Ast::Concat(Concat { asts, .. }) =\u003e {\n            for ast in asts {\n                replace_ast(ast, f)\n            }\n        }\n    }\n}\n\nfn expand_capture(ast: \u0026mut Ast, mut f: impl FnMut(\u0026str) -\u003e Option\u003cAst\u003e) {\n    let f = \u0026mut f;\n    replace_ast(ast, \u0026mut |ast| {\n        use regex_syntax::ast::*;\n        if let Ast::Group(g) = \u0026ast {\n            if let GroupKind::CaptureName(name) = \u0026g.kind {\n                if let Some(ast_new) = f(\u0026name.name) {\n                    *ast = ast_new;\n                    return false;\n                }\n            }\n        }\n        true\n    })\n}\npub fn try_replace_all\u003cR: AsRef\u003cstr\u003e, E\u003e(\n    regex: \u0026Regex,\n    text: \u0026str,\n    mut replacer: impl FnMut(\u0026Captures) -\u003e Result\u003cR, E\u003e,\n) -\u003e Result\u003cString, E\u003e {\n    let mut s = String::new();\n    let mut last_end = 0;\n    for c in regex.captures_iter(text) {\n        let m = c.get(0).unwrap();\n        s.push_str(\u0026text[last_end..m.start()]);\n        s.push_str(replacer(\u0026c)?.as_ref());\n        last_end = m.end();\n    }\n    s.push_str(\u0026text[last_end..]);\n    Ok(s)\n}\n\nmacro_rules! lazy_regex {\n    ($re:expr) =\u003e {\n        once_cell::sync::Lazy::new(|| regex::Regex::new($re).unwrap())\n    };\n}\n","traces":[{"line":82,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":83,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":85,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":86,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":9},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","parse-display","parse-display-derive","src","syn_utils.rs"],"content":"use proc_macro2::TokenStream;\nuse quote::{quote, quote_spanned, ToTokens};\nuse std::collections::HashSet;\nuse syn::{\n    ext::IdentExt,\n    parse::discouraged::Speculative,\n    parse::Parse,\n    parse::ParseStream,\n    parse2, parse_str,\n    punctuated::Punctuated,\n    visit::{visit_path, visit_type, Visit},\n    DeriveInput, GenericParam, Generics, Ident, LitStr, Path, Result, Token, Type, WherePredicate,\n};\n\nmacro_rules! bail {\n    ($span:expr, $message:literal $(,)?) =\u003e {\n        return std::result::Result::Err(syn::Error::new($span, $message))\n    };\n    ($span:expr, $err:expr $(,)?) =\u003e {\n        return std::result::Result::Err(syn::Error::new($span, $err))\n    };\n    ($span:expr, $fmt:expr, $($arg:tt)*) =\u003e {\n        return std::result::Result::Err(syn::Error::new($span, std::format!($fmt, $($arg)*)))\n    };\n}\n\npub fn into_macro_output(input: Result\u003cTokenStream\u003e) -\u003e proc_macro::TokenStream {\n    match input {\n        Ok(s) =\u003e s,\n        Err(e) =\u003e e.to_compile_error(),\n    }\n    .into()\n}\n\npub struct GenericParamSet {\n    idents: HashSet\u003cIdent\u003e,\n}\n\nimpl GenericParamSet {\n    pub fn new(generics: \u0026Generics) -\u003e Self {\n        let mut idents = HashSet::new();\n        for p in \u0026generics.params {\n            match p {\n                GenericParam::Type(t) =\u003e {\n                    idents.insert(t.ident.unraw());\n                }\n                GenericParam::Const(t) =\u003e {\n                    idents.insert(t.ident.unraw());\n                }\n                _ =\u003e {}\n            }\n        }\n        Self { idents }\n    }\n    fn contains(\u0026self, ident: \u0026Ident) -\u003e bool {\n        self.idents.contains(\u0026ident.unraw())\n    }\n\n    pub fn contains_in_type(\u0026self, ty: \u0026Type) -\u003e bool {\n        struct Visitor\u003c'a\u003e {\n            generics: \u0026'a GenericParamSet,\n            result: bool,\n        }\n        impl\u003c'a, 'ast\u003e Visit\u003c'ast\u003e for Visitor\u003c'a\u003e {\n            fn visit_path(\u0026mut self, i: \u0026'ast syn::Path) {\n                if i.leading_colon.is_none() {\n                    if let Some(s) = i.segments.iter().next() {\n                        if self.generics.contains(\u0026s.ident) {\n                            self.result = true;\n                        }\n                    }\n                }\n                visit_path(self, i);\n            }\n        }\n        let mut visitor = Visitor {\n            generics: self,\n            result: false,\n        };\n        visit_type(\u0026mut visitor, ty);\n        visitor.result\n    }\n}\n\npub enum Quotable\u003cT\u003e {\n    Direct(T),\n    Quoted { s: LitStr, args: ArgsOf\u003cT\u003e },\n}\nimpl\u003cT: Parse\u003e Parse for Quotable\u003cT\u003e {\n    fn parse(input: ParseStream) -\u003e Result\u003cSelf\u003e {\n        let fork = input.fork();\n        if let Ok(s) = fork.parse::\u003cLitStr\u003e() {\n            input.advance_to(\u0026fork);\n            let token: TokenStream = parse_str(\u0026s.value())?;\n            let tokens = quote_spanned!(s.span()=\u003e #token);\n            let args = parse2(tokens)?;\n            Ok(Quotable::Quoted { s, args })\n        } else {\n            Ok(Quotable::Direct(input.parse()?))\n        }\n    }\n}\nimpl\u003cT: ToTokens\u003e ToTokens for Quotable\u003cT\u003e {\n    fn to_tokens(\u0026self, tokens: \u0026mut TokenStream) {\n        match self {\n            Self::Direct(value) =\u003e value.to_tokens(tokens),\n            Self::Quoted { s, .. } =\u003e s.to_tokens(tokens),\n        }\n    }\n}\n\nimpl\u003cT\u003e Quotable\u003cT\u003e {\n    pub fn into_iter(self) -\u003e impl IntoIterator\u003cItem = T\u003e {\n        match self {\n            Self::Direct(item) =\u003e vec![item],\n            Self::Quoted { args, .. } =\u003e args.into_iter().collect(),\n        }\n        .into_iter()\n    }\n}\n\npub struct ArgsOf\u003cT\u003e(Punctuated\u003cT, Token![,]\u003e);\n\nimpl\u003cT: Parse\u003e Parse for ArgsOf\u003cT\u003e {\n    fn parse(input: ParseStream) -\u003e Result\u003cSelf\u003e {\n        Ok(Self(Punctuated::parse_terminated(input)?))\n    }\n}\nimpl\u003cT: ToTokens\u003e ToTokens for ArgsOf\u003cT\u003e {\n    fn to_tokens(\u0026self, tokens: \u0026mut TokenStream) {\n        self.0.to_tokens(tokens)\n    }\n}\n\nimpl\u003cT\u003e ArgsOf\u003cT\u003e {\n    pub fn into_iter(self) -\u003e impl Iterator\u003cItem = T\u003e {\n        self.0.into_iter()\n    }\n}\n\npub fn impl_trait(\n    input: \u0026DeriveInput,\n    trait_path: \u0026Path,\n    wheres: \u0026[WherePredicate],\n    contents: TokenStream,\n) -\u003e TokenStream {\n    let ty = \u0026input.ident;\n    let (impl_g, ty_g, where_clause) = input.generics.split_for_impl();\n    let mut wheres = wheres.to_vec();\n    if let Some(where_clause) = where_clause {\n        wheres.extend(where_clause.predicates.iter().cloned());\n    }\n    let where_clause = if wheres.is_empty() {\n        quote! {}\n    } else {\n        quote! { where #(#wheres,)*}\n    };\n    quote! {\n        #[automatically_derived]\n        impl #impl_g #trait_path for #ty #ty_g #where_clause {\n            #contents\n        }\n    }\n}\npub fn impl_trait_result(\n    input: \u0026DeriveInput,\n    trait_path: \u0026Path,\n    wheres: \u0026[WherePredicate],\n    contents: TokenStream,\n    dump: bool,\n) -\u003e Result\u003cTokenStream\u003e {\n    let ts = impl_trait(input, trait_path, wheres, contents);\n    if dump {\n        panic!(\"macro output:\\n{}\", ts);\n    }\n    Ok(ts)\n}\n","traces":[{"line":65,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":92,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":93,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":99,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":107,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":113,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":114,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":115,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":116,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":125,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":126,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":130,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":131,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":136,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":137,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":29},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","parse-display","parse-display-tests","src","lib.rs"],"content":"#[test]\r\nfn test() {\r\n    use parse_display::FromStr;\r\n    #[derive(FromStr, Debug, PartialEq)]\r\n    #[from_str(new = Self::new(value))]\r\n    struct MyNonZeroUSize {\r\n        value: usize,\r\n    }\r\n\r\n    impl MyNonZeroUSize {\r\n        fn new(value: usize) -\u003e Option\u003cSelf\u003e {\r\n            if value == 0 {\r\n                None\r\n            } else {\r\n                Some(Self { value })\r\n            }\r\n        }\r\n    }\r\n\r\n    assert_eq!(\"1\".parse(), Ok(MyNonZeroUSize { value: 1 }));\r\n    assert!(\"0\".parse::\u003cMyNonZeroUSize\u003e().is_err());\r\n}\r\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","parse-display","parse-display-tests","tests","both.rs"],"content":"use parse_display::*;\nuse std::fmt::Debug;\nuse std::fmt::Display;\nuse std::str::FromStr;\n\n#[test]\nfn both_newtype() {\n    #[derive(Display, FromStr, Debug, PartialEq)]\n    struct TestStruct(u32);\n\n    assert_both(\"12\", TestStruct(12));\n}\n\n#[test]\nfn both_struct_format() {\n    #[derive(Display, FromStr, Debug, PartialEq)]\n    #[display(\"{a},{b}\")]\n    struct TestStruct {\n        a: u32,\n        b: u32,\n    }\n    assert_both(\"12,50\", TestStruct { a: 12, b: 50 });\n}\n\nfn assert_both\u003cT: Display + FromStr + PartialEq + Debug\u003e(s: \u0026str, value: T)\nwhere\n    \u003cT as FromStr\u003e::Err: Display,\n{\n    let value_display = format!(\"{}\", value);\n    assert_eq!(value_display, s);\n\n    match s.parse::\u003cT\u003e() {\n        Ok(a) =\u003e assert_eq!(a, value, \"input = \\\"{}\\\"\", s),\n        Err(e) =\u003e panic!(\"\\\"{}\\\" parse failed. ({})\", s, e),\n    }\n}\n","traces":[{"line":29,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":32,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":33,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":5},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","parse-display","parse-display-tests","tests","clippy_self.rs"],"content":"#![deny(clippy::use_self)]\n\nuse parse_display::*;\n\n#[test]\nfn clippy_use_self() {\n    #[derive(FromStr)]\n    enum Foo {\n        Bar,\n        Baz,\n    }\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","parse-display","parse-display-tests","tests","compile_fail","display","invalid_format.rs"],"content":"use parse_display::Display;\n#[derive(Display)]\n#[display(\"{x\")]\nstruct TestStruct;\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","parse-display","parse-display-tests","tests","compile_fail","display","invalid_format_spec.rs"],"content":"use parse_display::Display;\n#[derive(Display)]\n#[display(\"{0:y}\")]\nstruct TestStruct(u32);\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","parse-display","parse-display-tests","tests","compile_fail","display","struct_empty_field_ident.rs"],"content":"use parse_display::Display;\n\n#[derive(Display)]\n#[display(\"{}\")]\nstruct TestStruct;\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","parse-display","parse-display-tests","tests","compile_fail","display","struct_no_display_field.rs"],"content":"use parse_display::Display;\n\n#[derive(Display)]\nstruct TestStruct {\n    x: NoDisplay,\n}\nstruct NoDisplay;\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","parse-display","parse-display-tests","tests","compile_fail","from_str","enum_default.rs"],"content":"use parse_display::FromStr;\n\n#[derive(FromStr)]\n#[from_str(default)]\nenum TestEnum {}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","parse-display","parse-display-tests","tests","compile_fail","from_str","no_field_in_format.rs"],"content":"use parse_display::FromStr;\n\n#[derive(FromStr)]\n#[display(\"abc\")]\nstruct TestStruct {\n    x: u8,\n}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","parse-display","parse-display-tests","tests","compile_fail","from_str","no_field_in_regex.rs"],"content":"use parse_display::FromStr;\n\n#[derive(FromStr)]\n#[from_str(regex = \"abc\")]\nstruct TestStruct {\n    x: u8,\n}\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","parse-display","parse-display-tests","tests","compile_fail","from_str","struct_empty_capture_name.rs"],"content":"use parse_display::FromStr;\n\n#[derive(FromStr)]\n#[from_str(regex = \"(?P\u003c\u003e)\")]\nstruct TestStruct;\n\nfn main() {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","parse-display","parse-display-tests","tests","compile_fail.rs"],"content":"#[test]\n#[ignore]\nfn compile_fail() {\n    trybuild::TestCases::new().compile_fail(\"tests/compile_fail/*/*.rs\")\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","parse-display","parse-display-tests","tests","display.rs"],"content":"#![deny(clippy::pattern_type_mismatch)]\n#![no_std]\nextern crate alloc;\nuse parse_display::*;\n\n#[test]\nfn display_newtype() {\n    #[derive(Display)]\n    struct TestStruct(u8);\n\n    assert_display(TestStruct(10), \"10\");\n}\n\n#[test]\nfn display_str() {\n    #[derive(Display)]\n    #[display(\"abcde\")]\n    struct TestStruct;\n\n    assert_display(TestStruct, \"abcde\");\n}\n\n#[test]\nfn display_struct_field() {\n    #[derive(Display)]\n    #[display(\"{a} --- {b}\")]\n    struct TestStruct {\n        a: u32,\n        b: u32,\n    }\n\n    assert_display(TestStruct { a: 1, b: 2 }, \"1 --- 2\");\n}\n\n#[test]\nfn display_struct_field_raw() {\n    #[derive(Display)]\n    #[display(\"{a},{b}\")]\n    struct TestStruct {\n        r#a: u32,\n        b: u32,\n    }\n\n    assert_display(TestStruct { a: 1, b: 2 }, \"1,2\");\n}\n\n#[test]\nfn display_struct_field_raw_keyword() {\n    #[derive(Display)]\n    #[display(\"{fn},{b}\")]\n    struct TestStruct {\n        r#fn: u32,\n        b: u32,\n    }\n\n    assert_display(TestStruct { r#fn: 1, b: 2 }, \"1,2\");\n}\n\n#[test]\nfn display_struct_field_with_parameter() {\n    #[derive(Display)]\n    #[display(\"{a:\u003c4},{b}\")]\n    struct TestStruct {\n        a: u32,\n        b: u32,\n    }\n\n    assert_display(TestStruct { a: 1, b: 2 }, \"1   ,2\");\n}\n\n#[test]\nfn display_struct_nested_field() {\n    #[derive(Display)]\n    #[display(\"{a.y},{b.x}\")]\n    struct TestStruct {\n        a: TestStruct2,\n        b: TestStruct2,\n    }\n\n    struct TestStruct2 {\n        x: u32,\n        y: u32,\n    }\n\n    let value = TestStruct {\n        a: TestStruct2 { x: 1, y: 2 },\n        b: TestStruct2 { x: 3, y: 4 },\n    };\n\n    assert_display(value, \"2,3\");\n}\n\n#[test]\nfn display_struct_nested_field_raw_keyword() {\n    #[derive(Display)]\n    #[display(\"{fn.fn},{b.y}\")]\n    struct TestStruct {\n        r#fn: TestStruct2,\n        b: TestStruct2,\n    }\n\n    struct TestStruct2 {\n        r#fn: u32,\n        y: u32,\n    }\n\n    let value = TestStruct {\n        r#fn: TestStruct2 { r#fn: 1, y: 2 },\n        b: TestStruct2 { r#fn: 3, y: 4 },\n    };\n\n    assert_display(value, \"1,4\");\n}\n\n#[test]\nfn display_tuple_struct_field() {\n    #[derive(Display)]\n    #[display(\"{1},{0}\")]\n    struct TestStruct(u32, u32);\n\n    assert_display(TestStruct(10, 20), \"20,10\");\n}\n\n#[test]\n#[allow(dead_code)]\nfn display_struct_field_attribute() {\n    #[derive(Display)]\n    #[display(\"{a},{b}\")]\n    struct TestStruct {\n        #[display(\"AAAA\")]\n        a: u32,\n        b: u32,\n    }\n    assert_display(TestStruct { a: 1, b: 2 }, \"AAAA,2\");\n}\n\n#[test]\nfn display_struct_field_attribute_var() {\n    #[derive(Display)]\n    #[display(\"{a},{b}\")]\n    struct TestStruct {\n        #[display(\"{x}+{y}\")]\n        a: TestStruct2,\n        #[display(\"{x}-{y}\")]\n        b: TestStruct2,\n    }\n\n    struct TestStruct2 {\n        x: u32,\n        y: u32,\n    }\n\n    let value = TestStruct {\n        a: TestStruct2 { x: 1, y: 2 },\n        b: TestStruct2 { x: 3, y: 4 },\n    };\n\n    assert_display(value, \"1+2,3-4\");\n}\n\n#[test]\nfn display_struct_field_attribute_var_nested() {\n    #[derive(Display)]\n    #[display(\"__{a}\")]\n    struct TestStruct {\n        #[display(\"{x.l}+{x.m}\")]\n        a: TestStruct2,\n    }\n\n    struct TestStruct2 {\n        x: TestStruct3,\n    }\n    struct TestStruct3 {\n        l: u32,\n        m: u32,\n    }\n\n    let value = TestStruct {\n        a: TestStruct2 {\n            x: TestStruct3 { l: 10, m: 20 },\n        },\n    };\n\n    assert_display(value, \"__10+20\");\n}\n\n#[test]\n#[allow(dead_code)]\nfn display_struct_field_attribute_self() {\n    #[derive(Display)]\n    #[display(\"{a},{b}\")]\n    struct TestStruct {\n        #[display(\"_{}_\")]\n        a: u32,\n        b: u32,\n    }\n    assert_display(TestStruct { a: 1, b: 2 }, \"_1_,2\");\n}\n\n#[test]\nfn display_struct_field_another_attribute() {\n    #[derive(Display)]\n    #[display(\"{a},{b}\")]\n    struct TestStruct {\n        #[allow(dead_code)]\n        a: u32,\n        b: u32,\n    }\n    assert_display(TestStruct { a: 1, b: 2 }, \"1,2\");\n}\n\n#[test]\nfn display_tuple_struct_nested_field() {\n    #[derive(Display)]\n    #[display(\"{1.1},{1.0},{0}\")]\n    struct TestStruct(u32, (u32, u32));\n\n    assert_display(TestStruct(10, (20, 30)), \"30,20,10\");\n}\n\n#[test]\nfn display_tuple_struct_attribute() {\n    #[derive(Display)]\n    #[display(\"{0},{1}\")]\n    struct TestStruct(#[display(\"AAA-{}\")] u32, u32);\n\n    assert_display(TestStruct(10, 20), \"AAA-10,20\");\n}\n\n#[test]\nfn display_enum() {\n    #[derive(Display)]\n    enum TestEnum {\n        AbcDef,\n        XyzXyz,\n    }\n    assert_display(TestEnum::AbcDef, \"AbcDef\");\n    assert_display(TestEnum::XyzXyz, \"XyzXyz\");\n}\n\n#[test]\nfn display_enum_lower_snake_case() {\n    #[derive(Display)]\n    #[display(style = \"snake_case\")]\n    enum TestEnum {\n        AbcDef,\n        XyzXyz,\n        Abc1,\n        Abc1Abc2,\n        Xxx1xxx,\n        _Xxx,\n    }\n    assert_display(TestEnum::AbcDef, \"abc_def\");\n    assert_display(TestEnum::XyzXyz, \"xyz_xyz\");\n    assert_display(TestEnum::Abc1, \"abc1\");\n    assert_display(TestEnum::Abc1Abc2, \"abc1_abc2\");\n    assert_display(TestEnum::Xxx1xxx, \"xxx1xxx\");\n    assert_display(TestEnum::_Xxx, \"xxx\");\n}\n\n#[test]\nfn display_enum_upper_snake_case() {\n    #[derive(Display)]\n    #[display(style = \"SNAKE_CASE\")]\n    enum TestEnum {\n        AbcDef,\n        XyzXyz,\n        Abc1,\n        Abc1Abc2,\n        Xxx1xxx,\n        _Xxx,\n    }\n    assert_display(TestEnum::AbcDef, \"ABC_DEF\");\n    assert_display(TestEnum::XyzXyz, \"XYZ_XYZ\");\n    assert_display(TestEnum::Abc1, \"ABC1\");\n    assert_display(TestEnum::Abc1Abc2, \"ABC1_ABC2\");\n    assert_display(TestEnum::Xxx1xxx, \"XXX1XXX\");\n    assert_display(TestEnum::_Xxx, \"XXX\");\n}\n\n#[test]\nfn display_enum_lower_camel_case() {\n    #[derive(Display)]\n    #[display(style = \"camelCase\")]\n    enum TestEnum {\n        AbcDef,\n        XyzXyz,\n        Abc1,\n        Abc1Abc2,\n        Xxx1xxx,\n        _Xxx,\n    }\n    assert_display(TestEnum::AbcDef, \"abcDef\");\n    assert_display(TestEnum::XyzXyz, \"xyzXyz\");\n    assert_display(TestEnum::Abc1, \"abc1\");\n    assert_display(TestEnum::Abc1Abc2, \"abc1Abc2\");\n    assert_display(TestEnum::Xxx1xxx, \"xxx1xxx\");\n    assert_display(TestEnum::_Xxx, \"xxx\");\n}\n\n#[test]\nfn display_enum_upper_camel_case() {\n    #[derive(Display)]\n    #[display(style = \"CamelCase\")]\n    enum TestEnum {\n        AbcDef,\n        XyzXyz,\n        Abc1,\n        Abc1Abc2,\n        Xxx1xxx,\n        _Xxx,\n    }\n    assert_display(TestEnum::AbcDef, \"AbcDef\");\n    assert_display(TestEnum::XyzXyz, \"XyzXyz\");\n    assert_display(TestEnum::Abc1, \"Abc1\");\n    assert_display(TestEnum::Abc1Abc2, \"Abc1Abc2\");\n    assert_display(TestEnum::Xxx1xxx, \"Xxx1xxx\");\n    assert_display(TestEnum::_Xxx, \"Xxx\");\n}\n\n#[test]\nfn display_enum_lower_kebab_case() {\n    #[derive(Display)]\n    #[display(style = \"kebab-case\")]\n    enum TestEnum {\n        AbcDef,\n        XyzXyz,\n        Abc1,\n        Abc1Abc2,\n        Xxx1xxx,\n        _Xxx,\n    }\n    assert_display(TestEnum::AbcDef, \"abc-def\");\n    assert_display(TestEnum::XyzXyz, \"xyz-xyz\");\n    assert_display(TestEnum::Abc1, \"abc1\");\n    assert_display(TestEnum::Abc1Abc2, \"abc1-abc2\");\n    assert_display(TestEnum::Xxx1xxx, \"xxx1xxx\");\n    assert_display(TestEnum::_Xxx, \"xxx\");\n}\n\n#[test]\nfn display_enum_upper_kebab_case() {\n    #[derive(Display)]\n    #[display(style = \"KEBAB-CASE\")]\n    enum TestEnum {\n        AbcDef,\n        XyzXyz,\n        Abc1,\n        Abc1Abc2,\n        Xxx1xxx,\n        _Xxx,\n    }\n    assert_display(TestEnum::AbcDef, \"ABC-DEF\");\n    assert_display(TestEnum::XyzXyz, \"XYZ-XYZ\");\n    assert_display(TestEnum::Abc1, \"ABC1\");\n    assert_display(TestEnum::Abc1Abc2, \"ABC1-ABC2\");\n    assert_display(TestEnum::Xxx1xxx, \"XXX1XXX\");\n    assert_display(TestEnum::_Xxx, \"XXX\");\n}\n\n#[test]\nfn display_enum_upper_title_case() {\n    #[derive(Display)]\n    #[display(style = \"Title Case\")]\n    enum TestEnum {\n        AbcDef,\n        XyzXyz,\n        Abc1,\n        Abc1Abc2,\n        Xxx1xxx,\n        _Xxx,\n    }\n    assert_display(TestEnum::AbcDef, \"Abc Def\");\n    assert_display(TestEnum::XyzXyz, \"Xyz Xyz\");\n    assert_display(TestEnum::Abc1, \"Abc1\");\n    assert_display(TestEnum::Abc1Abc2, \"Abc1 Abc2\");\n    assert_display(TestEnum::Xxx1xxx, \"Xxx1xxx\");\n    assert_display(TestEnum::_Xxx, \"Xxx\");\n}\n\n#[test]\nfn display_enum_upper_title_case_upper() {\n    #[derive(Display)]\n    #[display(style = \"TITLE CASE\")]\n    enum TestEnum {\n        AbcDef,\n        XyzXyz,\n        Abc1,\n        Abc1Abc2,\n        Xxx1xxx,\n        _Xxx,\n    }\n    assert_display(TestEnum::AbcDef, \"ABC DEF\");\n    assert_display(TestEnum::XyzXyz, \"XYZ XYZ\");\n    assert_display(TestEnum::Abc1, \"ABC1\");\n    assert_display(TestEnum::Abc1Abc2, \"ABC1 ABC2\");\n    assert_display(TestEnum::Xxx1xxx, \"XXX1XXX\");\n    assert_display(TestEnum::_Xxx, \"XXX\");\n}\n\n#[test]\nfn display_enum_upper_title_case_lower() {\n    #[derive(Display)]\n    #[display(style = \"title case\")]\n    enum TestEnum {\n        AbcDef,\n        XyzXyz,\n        Abc1,\n        Abc1Abc2,\n        Xxx1xxx,\n        _Xxx,\n    }\n    assert_display(TestEnum::AbcDef, \"abc def\");\n    assert_display(TestEnum::XyzXyz, \"xyz xyz\");\n    assert_display(TestEnum::Abc1, \"abc1\");\n    assert_display(TestEnum::Abc1Abc2, \"abc1 abc2\");\n    assert_display(TestEnum::Xxx1xxx, \"xxx1xxx\");\n    assert_display(TestEnum::_Xxx, \"xxx\");\n}\n\n#[test]\nfn display_enum_upper_title_case_head() {\n    #[derive(Display)]\n    #[display(style = \"Title case\")]\n    enum TestEnum {\n        AbcDef,\n        XyzXyz,\n        Abc1,\n        Abc1Abc2,\n        Xxx1xxx,\n        _Xxx,\n    }\n    assert_display(TestEnum::AbcDef, \"Abc def\");\n    assert_display(TestEnum::XyzXyz, \"Xyz xyz\");\n    assert_display(TestEnum::Abc1, \"Abc1\");\n    assert_display(TestEnum::Abc1Abc2, \"Abc1 abc2\");\n    assert_display(TestEnum::Xxx1xxx, \"Xxx1xxx\");\n    assert_display(TestEnum::_Xxx, \"Xxx\");\n}\n\n#[test]\nfn display_enum_lower_case() {\n    #[derive(Display)]\n    #[display(style = \"lowercase\")]\n    enum TestEnum {\n        AbcDef,\n        XyzXyz,\n        Abc1,\n        Abc1Abc2,\n        Xxx1xxx,\n        _Xxx,\n    }\n    assert_display(TestEnum::AbcDef, \"abcdef\");\n    assert_display(TestEnum::XyzXyz, \"xyzxyz\");\n    assert_display(TestEnum::Abc1, \"abc1\");\n    assert_display(TestEnum::Abc1Abc2, \"abc1abc2\");\n    assert_display(TestEnum::Xxx1xxx, \"xxx1xxx\");\n    assert_display(TestEnum::_Xxx, \"xxx\");\n}\n\n#[test]\nfn display_enum_upper_case() {\n    #[derive(Display)]\n    #[display(style = \"UPPERCASE\")]\n    enum TestEnum {\n        AbcDef,\n        XyzXyz,\n        Abc1,\n        Abc1Abc2,\n        Xxx1xxx,\n        _Xxx,\n    }\n    assert_display(TestEnum::AbcDef, \"ABCDEF\");\n    assert_display(TestEnum::XyzXyz, \"XYZXYZ\");\n    assert_display(TestEnum::Abc1, \"ABC1\");\n    assert_display(TestEnum::Abc1Abc2, \"ABC1ABC2\");\n    assert_display(TestEnum::Xxx1xxx, \"XXX1XXX\");\n    assert_display(TestEnum::_Xxx, \"XXX\");\n}\n\n#[test]\nfn display_enum_none() {\n    #[derive(Display)]\n    #[display(style = \"none\")]\n    enum TestEnum {\n        AbcDef,\n        XyzXyz,\n        Abc1,\n        Abc1Abc2,\n        Xxx1xxx,\n        _Xxx,\n    }\n    assert_display(TestEnum::AbcDef, \"AbcDef\");\n    assert_display(TestEnum::XyzXyz, \"XyzXyz\");\n    assert_display(TestEnum::Abc1, \"Abc1\");\n    assert_display(TestEnum::Abc1Abc2, \"Abc1Abc2\");\n    assert_display(TestEnum::Xxx1xxx, \"Xxx1xxx\");\n    assert_display(TestEnum::_Xxx, \"_Xxx\");\n}\n\n#[test]\nfn display_enum_common_format() {\n    #[derive(Display)]\n    #[display(\"{0}\")]\n    enum TestEnum {\n        A(u32),\n        B(bool),\n    }\n\n    assert_display(TestEnum::A(10), \"10\");\n    assert_display(TestEnum::B(true), \"true\");\n}\n\n#[test]\nfn display_enum_common_format_variant_name() {\n    #[derive(Display)]\n    #[display(\"{}-{0}\")]\n    enum TestEnum {\n        A(u32),\n        B(bool),\n    }\n\n    assert_display(TestEnum::A(10), \"A-10\");\n    assert_display(TestEnum::B(false), \"B-false\");\n}\n\n#[test]\nfn display_enum_variant_format() {\n    #[derive(Display)]\n    enum TestEnum {\n        #[display(\"AAA\")]\n        A(u32),\n\n        #[display(\"BBB\")]\n        B(bool),\n    }\n\n    assert_display(TestEnum::A(10), \"AAA\");\n    assert_display(TestEnum::B(false), \"BBB\");\n}\n\n#[test]\nfn display_enum_variant_format_typle_var() {\n    #[derive(Display)]\n    enum TestEnum {\n        #[display(\"AAA-{0}\")]\n        A(u32),\n\n        #[display(\"BBB+{0}\")]\n        B(bool),\n    }\n\n    assert_display(TestEnum::A(10), \"AAA-10\");\n    assert_display(TestEnum::B(true), \"BBB+true\");\n}\n\n#[test]\nfn display_enum_variant_format_record_var() {\n    #[derive(Display)]\n    enum TestEnum {\n        #[display(\"x={x},y={y}\")]\n        A { x: u32, y: u32 },\n    }\n    assert_display(TestEnum::A { x: 10, y: 20 }, \"x=10,y=20\");\n}\n\n#[test]\nfn display_enum_variant_format_record_var_f() {\n    #[derive(Display)]\n    enum TestEnum {\n        #[display(\"f={f}\")]\n        A { f: u32 },\n    }\n    assert_display(TestEnum::A { f: 10 }, \"f=10\");\n}\n\n#[test]\nfn display_enum_variant_format_record_var_keyword() {\n    #[derive(Display)]\n    enum TestEnum {\n        #[display(\"fn={fn}\")]\n        A { r#fn: u32 },\n    }\n    assert_display(TestEnum::A { r#fn: 10 }, \"fn=10\");\n}\n\n#[test]\nfn display_enum_field_format() {\n    #[derive(Display)]\n    enum TestEnum {\n        #[display(\"{} = {x}\")]\n        A {\n            #[display(\"---{}\")]\n            x: u32,\n        },\n    }\n    assert_display(TestEnum::A { x: 10 }, \"A = ---10\");\n}\n\n#[test]\nfn display_enum_field_format_deep() {\n    #[derive(Display)]\n    enum TestEnum {\n        #[display(\"{} = {x}\")]\n        A {\n            #[display(\"---{l}\")]\n            x: TestStruct,\n        },\n    }\n\n    struct TestStruct {\n        l: u32,\n    }\n\n    assert_display(\n        TestEnum::A {\n            x: TestStruct { l: 20 },\n        },\n        \"A = ---20\",\n    );\n}\n\n#[test]\nfn display_enum_field_format_deep_noncopy() {\n    #[derive(Display)]\n    enum TestEnum {\n        #[display(\"{} = {x}\")]\n        A {\n            #[display(\"---{l}\")]\n            x: TestStruct,\n        },\n    }\n\n    struct TestStruct {\n        l: bool,\n    }\n    assert_display(\n        TestEnum::A {\n            x: TestStruct { l: true },\n        },\n        \"A = ---true\",\n    );\n}\n\n#[test]\nfn auto_bound_newtype() {\n    #[derive(Display)]\n    struct TestNewType\u003cT\u003e(T);\n    assert_display(TestNewType(10), \"10\");\n}\n\n#[test]\nfn auto_bound_newtype_debug() {\n    #[derive(Display)]\n    #[display(\"{0:?}\")]\n    struct TestNewType\u003cT\u003e(T);\n    assert_display(TestNewType(10), \"10\");\n}\n\n#[test]\nfn auto_bound_newtype_lower_hex() {\n    #[derive(Display)]\n    #[display(\"{0:#x}\")]\n    struct TestNewType\u003cT\u003e(T);\n    assert_display(TestNewType(10), \"0xa\");\n}\n\n#[test]\nfn auto_bound_newtype_upper_hex() {\n    #[derive(Display)]\n    #[display(\"{0:#X}\")]\n    struct TestNewType\u003cT\u003e(T);\n    assert_display(TestNewType(10), \"0xA\");\n}\n\n#[test]\nfn auto_bound_newtype_binary() {\n    #[derive(Display)]\n    #[display(\"{0:#b}\")]\n    struct TestNewType\u003cT\u003e(T);\n    assert_display(TestNewType(10), \"0b1010\");\n}\n\n#[test]\nfn auto_bound_field() {\n    #[derive(Display)]\n    #[display(\"{a}\")]\n    struct TestStruct\u003cT\u003e {\n        #[display(\"___{}___\")]\n        a: T,\n    }\n    assert_display(TestStruct { a: 10 }, \"___10___\");\n}\n\n#[test]\nfn auto_bound_enum() {\n    #[derive(Display)]\n    #[display(\"{0}\")]\n    enum TestEnum\u003cT\u003e {\n        VarA(T),\n    }\n    assert_display(TestEnum::VarA(10), \"10\");\n}\n\n#[test]\nfn private_in_public_non_generic() {\n    assert_display(TestStructPrivateInPublic(TestStructPrivate(5)), \"5\");\n}\n\n#[derive(Display)]\npub struct TestStructPrivateInPublic(TestStructPrivate);\n\n#[derive(Display)]\nstruct TestStructPrivate(u8);\n\n#[test]\nfn private_in_public_generic() {\n    assert_display(\n        TestStructPrivateInPublicGeneric(TestStructPrivateGeneric(5)),\n        \"5\",\n    );\n}\n\n#[derive(Display)]\n#[display(bound(T))]\npub struct TestStructPrivateInPublicGeneric\u003cT\u003e(TestStructPrivateGeneric\u003cT\u003e);\n\n#[derive(Display)]\nstruct TestStructPrivateGeneric\u003cT\u003e(T);\n\n#[test]\nfn bound_predicate_struct() {\n    #[derive(Display)]\n    #[display(bound(T : Copy))]\n    pub struct TestStructBoundPredicate\u003cT\u003e(DisplayIfCopy\u003cT\u003e);\n\n    struct DisplayIfCopy\u003cT\u003e(T);\n\n    impl\u003cT: Copy\u003e core::fmt::Display for DisplayIfCopy\u003cT\u003e {\n        fn fmt(\u0026self, f: \u0026mut core::fmt::Formatter\u003c'_\u003e) -\u003e core::fmt::Result {\n            write!(f, \"this is display\")\n        }\n    }\n    assert_display(\n        TestStructBoundPredicate(DisplayIfCopy(10)),\n        \"this is display\",\n    );\n}\n\n#[test]\nfn bound_predicate_struct_x2() {\n    #[derive(Display)]\n    #[display(\"{a},{b}\", bound(T1 : Copy, T2 : Copy))]\n    pub struct TestStructBoundPredicate\u003cT1, T2\u003e {\n        a: DisplayIfCopy\u003cT1\u003e,\n        b: DisplayIfCopy\u003cT2\u003e,\n    }\n\n    struct DisplayIfCopy\u003cT\u003e(T);\n\n    impl\u003cT: Copy\u003e core::fmt::Display for DisplayIfCopy\u003cT\u003e {\n        fn fmt(\u0026self, f: \u0026mut core::fmt::Formatter\u003c'_\u003e) -\u003e core::fmt::Result {\n            write!(f, \"this is display\")\n        }\n    }\n    assert_display(\n        TestStructBoundPredicate {\n            a: DisplayIfCopy(10),\n            b: DisplayIfCopy(20),\n        },\n        \"this is display,this is display\",\n    );\n}\n\n#[test]\nfn bound_predicate_struct_str() {\n    #[derive(Display)]\n    #[display(bound(\"T : Copy\"))]\n    pub struct TestStructBoundPredicate\u003cT\u003e(DisplayIfCopy\u003cT\u003e);\n\n    struct DisplayIfCopy\u003cT\u003e(T);\n\n    impl\u003cT: Copy\u003e core::fmt::Display for DisplayIfCopy\u003cT\u003e {\n        fn fmt(\u0026self, f: \u0026mut core::fmt::Formatter\u003c'_\u003e) -\u003e core::fmt::Result {\n            write!(f, \"this is display\")\n        }\n    }\n    assert_display(\n        TestStructBoundPredicate(DisplayIfCopy(10)),\n        \"this is display\",\n    );\n}\n\n#[test]\nfn bound_type_enum() {\n    assert_display(Outer::A(Inner(10)), \"10\");\n    #[derive(Display)]\n    #[display(\"{0.0}\", bound(T))]\n    enum Outer\u003cT\u003e {\n        A(Inner\u003cT\u003e),\n    }\n    struct Inner\u003cT\u003e(T);\n}\n\n#[test]\nfn bound_type_generic() {\n    assert_display(Outer(Inner(5)), \"5\");\n\n    #[derive(Display)]\n    #[display(bound(Inner\u003cT\u003e))]\n    struct Outer\u003cT\u003e(Inner\u003cT\u003e);\n\n    #[derive(Display)]\n    struct Inner\u003cT\u003e(T);\n}\n\n#[test]\nfn bound_type_generic_x2() {\n    assert_display(Outer(Inner(5), Inner(10)), \"5,10\");\n\n    #[derive(Display)]\n    #[display(\"{0},{1}\",bound(Inner\u003cT1\u003e, Inner\u003cT2\u003e))]\n    struct Outer\u003cT1, T2\u003e(Inner\u003cT1\u003e, Inner\u003cT2\u003e);\n\n    #[derive(Display)]\n    struct Inner\u003cT\u003e(T);\n}\n\n#[test]\nfn bound_type_array() {\n    #[derive(Display)]\n    #[display(bound([T; 1]))]\n    struct TestStruct\u003cT\u003e {\n        x: [T; 1],\n    }\n}\n\n#[test]\nfn auto_bound_unused_field() {\n    #[derive(Display)]\n    #[display(\"{val_u8}\")]\n    #[allow(dead_code)]\n    struct TestStruct\u003cT: Eq\u003e {\n        val_eq: T,\n        val_u8: u8,\n    }\n    assert_display(\n        TestStruct {\n            val_eq: 0,\n            val_u8: 1,\n        },\n        \"1\",\n    )\n}\n\n#[test]\nfn bound_by_hand_with_auto() {\n    pub struct Inner\u003cT\u003e(T);\n\n    #[derive(Display)]\n    #[display(\"{0.0},{1}\", bound(T1, ..))]\n    pub struct Outer\u003cT1, T2\u003e(Inner\u003cT1\u003e, T2);\n\n    assert_display(Outer(Inner(10), 20), \"10,20\");\n}\n\n#[deny(private_in_public)]\n#[test]\nfn bound_struct_field() {\n    #[derive(Display)]\n    struct Inner\u003cT\u003e(T);\n    #[derive(Display)]\n    pub struct Outer\u003cT\u003e(#[display(bound(T))] Inner\u003cT\u003e);\n}\n#[allow(dead_code)]\n#[test]\nfn bound_enum_variant() {\n    #[derive(Display)]\n    #[display(bound(T : core::fmt::Display + Copy ))]\n    pub struct Inner\u003cT\u003e(T);\n    #[derive(Display)]\n    pub enum Outer\u003cT\u003e {\n        #[display(\"{0}\", bound(T : core::fmt::Display + Copy))]\n        A(Inner\u003cT\u003e),\n    }\n}\n\n#[allow(dead_code)]\n#[test]\nfn bound_enum_field() {\n    #[derive(Display)]\n    #[display(bound(T : core::fmt::Display + Copy ))]\n    pub struct Inner\u003cT\u003e(T);\n    #[derive(Display)]\n    pub enum Outer\u003cT\u003e {\n        #[display(\"{0}\")]\n        A(#[display(bound(T : core::fmt::Display + Copy))] Inner\u003cT\u003e),\n    }\n}\n\n#[test]\nfn doc_comment_struct() {\n    /// doc\n    #[derive(Display)]\n    struct TestStruct {\n        a: u8,\n    }\n    assert_display(TestStruct { a: 10 }, \"10\");\n}\n\n#[test]\nfn doc_comment_struct_field() {\n    #[derive(Display)]\n    pub struct TestStruct {\n        /// doc\n        a: u8,\n    }\n    assert_display(TestStruct { a: 10 }, \"10\");\n}\n\n#[test]\nfn doc_comment_enum() {\n    /// doc\n    #[derive(Display)]\n    enum TestEnum {\n        A,\n    }\n    assert_display(TestEnum::A, \"A\");\n}\n\n#[test]\nfn doc_comment_variant() {\n    #[derive(Display)]\n    enum TestEnum {\n        /// doc\n        A,\n    }\n    assert_display(TestEnum::A, \"A\");\n}\n\n#[test]\nfn attr_enum() {\n    #[derive(Display)]\n    #[non_exhaustive]\n    enum TestEnum {\n        A,\n    }\n    assert_display(TestEnum::A, \"A\");\n}\n\nmacro_rules! macro_rule_hygiene_test {\n    () =\u003e {\n        #[derive(Display)]\n        struct HygieneTestType {\n            x: $crate::U8Alias,\n        }\n    };\n}\n\ntype U8Alias = u8;\n#[test]\nfn macro_rule_hygiene() {\n    macro_rule_hygiene_test!();\n    assert_display(HygieneTestType { x: 5 }, \"5\");\n}\n\n#[test]\nfn format_spec_is_empty() {\n    #[derive(Display)]\n    #[display(\"{0}\u003e\")]\n    struct TestStruct(u32);\n}\n\nfn assert_display\u003cT: core::fmt::Display\u003e(value: T, display: \u0026str) {\n    let value_display = alloc::format!(\"{}\", value);\n    assert_eq!(value_display, display);\n}\n","traces":[{"line":740,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":741,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":762,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":763,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":784,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":785,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":974,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":975,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":976,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":9},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","parse-display","parse-display-tests","tests","from_str.rs"],"content":"#![deny(clippy::pattern_type_mismatch)]\n\nuse parse_display::*;\nuse std::fmt::Debug;\nuse std::fmt::Display;\nuse std::str::FromStr;\n\n#[test]\nfn from_str_newtype() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    struct TestStruct(u32);\n\n    assert_from_str(\"12\", TestStruct(12));\n    assert_from_str_err::\u003cTestStruct\u003e(\"abc\");\n}\n\n#[test]\nfn from_str_struct_keyword_field() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[display(\"{fn}\")]\n    struct TestStruct {\n        r#fn: u32,\n    }\n    assert_from_str(\"12\", TestStruct { r#fn: 12 });\n    assert_from_str_err::\u003cTestStruct\u003e(\"aa\");\n}\n\n#[test]\nfn from_str_struct_format() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[display(\"{a},{b}\")]\n    struct TestStruct {\n        a: u32,\n        b: u32,\n    }\n    assert_from_str(\"12,50\", TestStruct { a: 12, b: 50 });\n    assert_from_str_err::\u003cTestStruct\u003e(\"aa,50\");\n}\n\n#[test]\nfn from_str_struct_regex() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[from_str(regex = \"(?P\u003ca\u003e.*),(?P\u003cbc\u003e.*)\")]\n    struct TestStruct {\n        a: u32,\n        bc: u32,\n    }\n    assert_from_str(\"12,50\", TestStruct { a: 12, bc: 50 });\n    assert_from_str_err::\u003cTestStruct\u003e(\"aa,50\");\n}\n\n#[test]\nfn from_str_tuple_struct_regex() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[from_str(regex = \"(?P\u003c0\u003e.*),(?P\u003c1\u003e.*)\")]\n    struct TestStruct(u32, u32);\n    assert_from_str(\"12,50\", TestStruct(12, 50));\n    assert_from_str_err::\u003cTestStruct\u003e(\"aa,50\");\n}\n\n#[test]\nfn from_str_struct_regex_keyword() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[from_str(regex = \"(?P\u003cfn\u003e.*)\")]\n    struct TestStruct {\n        r#fn: u32,\n    }\n    assert_from_str(\"12\", TestStruct { r#fn: 12 });\n}\n\n#[test]\nfn from_str_struct_field_format() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[display(\"{a},{b}\")]\n    struct TestStruct {\n        #[display(\"--{}--\")]\n        a: u32,\n        b: u32,\n    }\n    assert_from_str(\"--12--,50\", TestStruct { a: 12, b: 50 });\n}\n\n#[test]\nfn from_str_struct_field_regex_all() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[display(\"{a}{b}\")]\n    struct TestStruct {\n        #[from_str(regex = \"[0-9]+\")]\n        a: u32,\n        b: String,\n    }\n    assert_from_str(\n        \"12abc\",\n        TestStruct {\n            a: 12,\n            b: \"abc\".into(),\n        },\n    );\n}\n\n#[test]\nfn from_str_struct_field_regex_self() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[display(\"{a},{b}\")]\n    struct TestStruct {\n        #[from_str(regex = \"---(?P\u003c\u003e[0-9]+)---\")]\n        a: u32,\n        b: u32,\n    }\n    assert_from_str(\"---12---,50\", TestStruct { a: 12, b: 50 });\n}\n\n#[test]\nfn from_str_struct_format_chain() {\n    #[derive(FromStr, Debug, Eq, PartialEq, Default)]\n    #[display(\"{a.x},{a.y}\")]\n    #[from_str(default)]\n    struct TestStruct {\n        a: TestStruct2,\n        b: TestStruct2,\n    }\n\n    #[derive(Debug, Eq, PartialEq, Default)]\n    struct TestStruct2 {\n        x: u32,\n        y: u32,\n    }\n    assert_from_str(\n        \"10,50\",\n        TestStruct {\n            a: TestStruct2 { x: 10, y: 50 },\n            b: TestStruct2 { x: 0, y: 0 },\n        },\n    );\n}\n\n#[test]\nfn from_str_struct_format_chain_default_field() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[display(\"{a.x},{a.y}\")]\n    struct TestStruct {\n        #[from_str(default)]\n        a: TestStruct2,\n\n        #[from_str(default)]\n        b: TestStruct2,\n    }\n\n    #[derive(Debug, Eq, PartialEq, Default)]\n    struct TestStruct2 {\n        x: u32,\n        y: u32,\n    }\n    assert_from_str(\n        \"10,50\",\n        TestStruct {\n            a: TestStruct2 { x: 10, y: 50 },\n            b: TestStruct2 { x: 0, y: 0 },\n        },\n    );\n}\n\n#[test]\nfn from_str_struct_field_format_chain() {\n    #[derive(FromStr, Debug, Eq, PartialEq, Default)]\n    #[display(\"{a}\")]\n    #[from_str(default)]\n    struct TestStruct {\n        #[display(\"{b.x}\")]\n        a: TestStruct2,\n    }\n\n    #[derive(Debug, Eq, PartialEq, Default)]\n    struct TestStruct2 {\n        b: TestStruct3,\n    }\n\n    #[derive(Debug, Eq, PartialEq, Default)]\n    struct TestStruct3 {\n        x: u32,\n        y: u32,\n    }\n\n    assert_from_str(\n        \"10\",\n        TestStruct {\n            a: TestStruct2 {\n                b: TestStruct3 { x: 10, y: 0 },\n            },\n        },\n    );\n}\n#[test]\nfn from_str_enum_named_field_chain() {\n    #[derive(FromStr, Eq, PartialEq, Debug)]\n    enum TestEnum {\n        #[display(\"{x.0}-{x.1}\")]\n        A {\n            #[from_str(default)]\n            x: (u8, u8),\n        },\n    }\n    assert_from_str(\"5-6\", TestEnum::A { x: (5, 6) });\n}\n\n#[test]\nfn from_str_enum_unnamed_field_chain() {\n    #[derive(FromStr, Eq, PartialEq, Debug)]\n    enum TestEnum {\n        #[display(\"{0.0}-{0.1}\")]\n        A(#[from_str(default)] (u8, u8)),\n    }\n    assert_from_str(\"5-6\", TestEnum::A((5, 6)));\n}\n\n#[test]\nfn from_str_struct_deep_regex() {\n    #[derive(FromStr, Debug, Eq, PartialEq, Default)]\n    #[from_str(regex = \"(?P\u003ca.x\u003e.*),(?P\u003ca.y\u003e.*)\", default)]\n    struct TestStruct {\n        a: TestStruct2,\n        b: TestStruct2,\n    }\n\n    #[derive(Debug, Eq, PartialEq, Default)]\n    struct TestStruct2 {\n        x: u32,\n        y: u32,\n    }\n    assert_from_str(\n        \"10,50\",\n        TestStruct {\n            a: TestStruct2 { x: 10, y: 50 },\n            b: TestStruct2 { x: 0, y: 0 },\n        },\n    );\n}\n\n#[test]\nfn from_str_struct_field_deep_regex() {\n    #[derive(FromStr, Debug, Eq, PartialEq, Default)]\n    #[display(\"{a}\")]\n    #[from_str(default)]\n    struct TestStruct {\n        #[from_str(regex = \"(?P\u003cb.x\u003e.*)\")]\n        a: TestStruct2,\n    }\n\n    #[derive(Debug, Eq, PartialEq, Default)]\n    struct TestStruct2 {\n        b: TestStruct3,\n    }\n\n    #[derive(Debug, Eq, PartialEq, Default)]\n    struct TestStruct3 {\n        x: u32,\n        y: u32,\n    }\n\n    assert_from_str(\n        \"10\",\n        TestStruct {\n            a: TestStruct2 {\n                b: TestStruct3 { x: 10, y: 0 },\n            },\n        },\n    );\n}\n\n#[test]\nfn from_str_struct_default() {\n    #[derive(FromStr, Debug, Eq, PartialEq, Default)]\n    #[display(\"{a}\")]\n    #[from_str(default)]\n    struct TestStruct {\n        a: u32,\n        b: u32,\n    }\n    assert_from_str(\"12\", TestStruct { a: 12, b: 0 });\n}\n\n#[test]\nfn from_str_struct_default_both() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[display(\"{a}\")]\n    #[from_str(default)]\n    struct TestStruct {\n        a: u32,\n\n        #[from_str(default)]\n        b: u32,\n    }\n    impl Default for TestStruct {\n        fn default() -\u003e Self {\n            Self { a: 100, b: 200 }\n        }\n    }\n\n    assert_from_str(\"12\", TestStruct { a: 12, b: 0 });\n}\n\n#[test]\nfn from_str_struct_field_default() {\n    #[derive(FromStr, Debug, Eq, PartialEq, Default)]\n    #[display(\"{a}\")]\n    struct TestStruct {\n        a: u32,\n\n        #[from_str(default)]\n        b: u32,\n    }\n    assert_from_str(\"12\", TestStruct { a: 12, b: 0 });\n}\n\n#[test]\nfn from_str_tuple_field_default() {\n    #[derive(FromStr, Debug, Eq, PartialEq, Default)]\n    #[display(\"{0}\")]\n    struct TestStruct(u32, #[from_str(default)] u32);\n    assert_from_str(\"12\", TestStruct(12, 0));\n}\n\n#[test]\nfn from_str_struct_default_fields_str() {\n    #[derive(FromStr, Debug, Eq, PartialEq, Default)]\n    #[display(\"{a}\")]\n    #[from_str(default_fields(\"b\"))]\n    struct TestStruct {\n        a: u32,\n        b: u32,\n    }\n    assert_from_str(\"12\", TestStruct { a: 12, b: 0 });\n}\n\n#[test]\nfn from_str_struct_default_fields_many() {\n    #[derive(FromStr, Debug, Eq, PartialEq, Default)]\n    #[display(\"{a}\")]\n    #[from_str(default_fields(b, \"c\"))]\n    struct TestStruct {\n        a: u32,\n        b: u32,\n        c: u32,\n    }\n    assert_from_str(\"12\", TestStruct { a: 12, b: 0, c: 0 });\n}\n\n#[test]\nfn from_str_struct_default_fields_ident() {\n    #[derive(FromStr, Debug, Eq, PartialEq, Default)]\n    #[display(\"{a}\")]\n    #[from_str(default_fields(b))]\n    struct TestStruct {\n        a: u32,\n        b: u32,\n    }\n    assert_from_str(\"12\", TestStruct { a: 12, b: 0 });\n}\n\n#[test]\nfn from_str_struct_default_fields_ident_keyword() {\n    #[derive(FromStr, Debug, Eq, PartialEq, Default)]\n    #[display(\"{fn}\")]\n    #[from_str(default_fields(fn))]\n    struct TestStruct {\n        r#fn: u32,\n    }\n    assert_from_str(\"12\", TestStruct { r#fn: 12 });\n}\n#[test]\nfn from_str_enum_field_default() {\n    #[derive(FromStr, PartialEq, Debug)]\n    #[display(\"{a}\")]\n    enum TestEnum {\n        VerA {\n            a: u8,\n            #[from_str(default)]\n            b: u8,\n        },\n    }\n    assert_from_str(\"10\", TestEnum::VerA { a: 10, b: 0 });\n}\n\n#[test]\nfn from_str_enum_tuple_field_default() {\n    #[derive(FromStr, PartialEq, Debug)]\n    #[display(\"{0}\")]\n    enum TestEnum {\n        VerA(u8, #[from_str(default)] u8),\n    }\n    assert_from_str(\"10\", TestEnum::VerA(10, 0));\n}\n\n#[test]\nfn from_str_enum_default_fields() {\n    #[derive(FromStr, PartialEq, Debug)]\n    #[display(\"{a}\")]\n    #[from_str(default_fields(b))]\n    enum TestEnum {\n        VerA { a: u8, b: u8 },\n    }\n    assert_from_str(\"10\", TestEnum::VerA { a: 10, b: 0 });\n}\n\n#[test]\nfn from_str_tuple() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[display(\"{0},{1}\")]\n    struct TestStruct(u32, u32);\n    assert_from_str(\"12,50\", TestStruct(12, 50));\n}\n\n#[test]\nfn from_str_unit() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[display(\"abc\")]\n    struct TestStruct;\n    assert_from_str(\"abc\", TestStruct);\n}\n\n#[test]\nfn from_str_enum_unit() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    enum TestEnum {\n        A,\n        Bc,\n    }\n    assert_from_str(\"A\", TestEnum::A);\n    assert_from_str(\"Bc\", TestEnum::Bc);\n}\n\n#[test]\nfn from_str_enum_style() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[display(style = \"snake_case\")]\n    enum TestEnum {\n        AaaBbb,\n        XyzXyz,\n        #[display(style = \"Title Case\")]\n        TitleAbc,\n    }\n    assert_from_str(\"aaa_bbb\", TestEnum::AaaBbb);\n    assert_from_str(\"xyz_xyz\", TestEnum::XyzXyz);\n    assert_from_str(\"Title Abc\", TestEnum::TitleAbc);\n}\n\n#[test]\nfn from_str_enum_format() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[display(\"{}--\")]\n    enum TestEnum {\n        A,\n        Bc,\n    }\n    assert_from_str(\"A--\", TestEnum::A);\n    assert_from_str(\"Bc--\", TestEnum::Bc);\n}\n\n#[test]\nfn from_str_enum_format_struct_var() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[display(\"{}--{x}\")]\n    enum TestEnum {\n        A { x: u32 },\n        Bc { x: u32 },\n    }\n    assert_from_str(\"A--10\", TestEnum::A { x: 10 });\n    assert_from_str(\"Bc--20\", TestEnum::Bc { x: 20 });\n}\n\n#[test]\nfn from_str_enum_format_tuple_var() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[display(\"{}--{0}\")]\n    enum TestEnum {\n        A(u32),\n        Bc(u32),\n    }\n    assert_from_str(\"A--10\", TestEnum::A(10));\n    assert_from_str(\"Bc--20\", TestEnum::Bc(20));\n}\n\n#[test]\nfn from_str_enum_regex() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[from_str(regex = \"(?P\u003c\u003e)--\")]\n    enum TestEnum {\n        A,\n        Bc,\n    }\n    assert_from_str(\"A--\", TestEnum::A);\n    assert_from_str(\"Bc--\", TestEnum::Bc);\n}\n\n#[test]\nfn from_str_enum_regex_tuple_var() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[from_str(regex = \"(?P\u003c\u003e)--(?P\u003c0\u003e.*)\")]\n    enum TestEnum {\n        A(u32),\n        Bc(u32),\n    }\n    assert_from_str(\"A--10\", TestEnum::A(10));\n    assert_from_str(\"Bc--20\", TestEnum::Bc(20));\n}\n\n#[test]\nfn from_str_enum_regex_struct_var() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[from_str(regex = \"(?P\u003c\u003e)--(?P\u003cx\u003e.*)\")]\n    enum TestEnum {\n        A { x: u32 },\n        Bc { x: u32 },\n    }\n    assert_from_str(\"A--10\", TestEnum::A { x: 10 });\n    assert_from_str(\"Bc--20\", TestEnum::Bc { x: 20 });\n}\n\n#[test]\nfn from_str_enum_var_field() {\n    #[derive(FromStr, Debug, PartialEq)]\n    #[display(\"{0}\")]\n    enum TestEnum {\n        A(u32),\n        B(f64),\n    }\n    assert_from_str(\"1.5\", TestEnum::B(1.5));\n}\n\n#[test]\nfn from_str_enum_variant_format() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    enum TestEnum {\n        #[display(\"xxx\")]\n        A,\n\n        #[display(\"yyy\")]\n        Bc,\n    }\n    assert_from_str(\"xxx\", TestEnum::A);\n    assert_from_str(\"yyy\", TestEnum::Bc);\n}\n\n#[test]\nfn from_str_enum_variant_format_var() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    enum TestEnum {\n        #[display(\"{} - {0}\")]\n        A(u32),\n\n        #[display(\"yyy + {x}\")]\n        Bc { x: u32 },\n    }\n    assert_from_str(\"A - 10\", TestEnum::A(10));\n    assert_from_str(\"yyy + 50\", TestEnum::Bc { x: 50 });\n}\n\n#[test]\nfn from_str_enum_variant_regex_var() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    enum TestEnum {\n        #[from_str(regex = \"(?P\u003c\u003e) - (?P\u003c0\u003e.*)\")]\n        A(u32),\n\n        #[from_str(regex = r\"yyy \\+ (?P\u003cx\u003e.*)\")]\n        Bc { x: u32 },\n    }\n    assert_from_str(\"A - 10\", TestEnum::A(10));\n    assert_from_str(\"yyy + 50\", TestEnum::Bc { x: 50 });\n\n    assert_from_str_err::\u003cTestEnum\u003e(\"A - xx\");\n    assert_from_str_err::\u003cTestEnum\u003e(\"yyy - xx\");\n}\n\n#[test]\nfn from_str_enum_format_variant_format() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[display(\"yyy + {x}\")]\n    enum TestEnum {\n        #[display(\"{} - {0}\")]\n        A(u32),\n        Bc {\n            x: u32,\n        },\n    }\n    assert_from_str(\"A - 10\", TestEnum::A(10));\n    assert_from_str(\"yyy + 50\", TestEnum::Bc { x: 50 });\n}\n\n#[test]\nfn from_str_enum_format_variant_regex() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[display(\"yyy + {x}\")]\n    enum TestEnum {\n        #[from_str(regex = \"(?P\u003c\u003e) - (?P\u003c0\u003e.*)\")]\n        A(u32),\n\n        Bc {\n            x: u32,\n        },\n    }\n    assert_from_str(\"A - 10\", TestEnum::A(10));\n    assert_from_str(\"yyy + 50\", TestEnum::Bc { x: 50 });\n}\n\n#[test]\nfn from_str_enum_regex_variant_format() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[from_str(regex = r\"yyy \\+ (?P\u003cx\u003e.*)\")]\n    enum TestEnum {\n        #[display(\"{} - {0}\")]\n        A(u32),\n\n        Bc {\n            x: u32,\n        },\n    }\n    assert_from_str(\"A - 10\", TestEnum::A(10));\n    assert_from_str(\"yyy + 50\", TestEnum::Bc { x: 50 });\n}\n\n#[test]\nfn from_str_enum_regex_variant_regex() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[from_str(regex = \"(?P\u003c\u003e) - (?P\u003c0\u003e.*)\")]\n    enum TestEnum {\n        A(u32),\n\n        #[from_str(regex = r\"yyy \\+ (?P\u003cx\u003e.*)\")]\n        Bc {\n            x: u32,\n        },\n    }\n    assert_from_str(\"A - 10\", TestEnum::A(10));\n    assert_from_str(\"yyy + 50\", TestEnum::Bc { x: 50 });\n\n    assert_from_str_err::\u003cTestEnum\u003e(\"A - xx\");\n    assert_from_str_err::\u003cTestEnum\u003e(\"yyy - xx\");\n}\n\n#[test]\nfn from_str_enum_field_format() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    enum TestEnum {\n        #[display(\"{} - {0}\")]\n        A(#[display(\"nnn{}\")] u32),\n\n        #[display(\"yyy + {x}\")]\n        Bc {\n            #[display(\"mmm{}\")]\n            x: u32,\n        },\n    }\n    assert_from_str(\"A - nnn10\", TestEnum::A(10));\n    assert_from_str(\"yyy + mmm50\", TestEnum::Bc { x: 50 });\n}\n\n#[test]\nfn from_str_enum_field_regex() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    enum TestEnum {\n        #[display(\"{} - {0}\")]\n        A(#[from_str(regex = \"nnn(?P\u003c\u003e.*)\")] u32),\n\n        #[display(\"yyy + {x}\")]\n        Bc {\n            #[from_str(regex = \"mmm(?P\u003c\u003e.*)\")]\n            x: u32,\n        },\n    }\n    assert_from_str(\"A - nnn10\", TestEnum::A(10));\n    assert_from_str(\"yyy + mmm50\", TestEnum::Bc { x: 50 });\n}\n\n#[test]\nfn auto_bound_newtype() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    struct TestNewType\u003cT\u003e(T);\n\n    assert_from_str(\"10\", TestNewType(10));\n}\n\n#[test]\nfn auto_bound_enum() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[display(\"{0}\")]\n    enum TestEnum\u003cT\u003e {\n        VarA(T),\n    }\n\n    assert_from_str(\"10\", TestEnum::VarA(10));\n}\n\n#[test]\nfn private_in_public_non_generic() {\n    assert_from_str(\"5\", TestStructPrivateInPublic(TestStructPrivate(5)));\n}\n\n#[derive(FromStr, Debug, Eq, PartialEq)]\npub struct TestStructPrivateInPublic(TestStructPrivate);\n\n#[derive(FromStr, Debug, Eq, PartialEq)]\nstruct TestStructPrivate(u8);\n\n#[test]\nfn private_in_public_generic() {\n    assert_from_str(\n        \"5\",\n        TestStructPrivateInPublicGeneric(TestStructPrivateGeneric(5)),\n    );\n}\n\n#[derive(FromStr, Debug, Eq, PartialEq)]\n#[display(bound(T))]\npub struct TestStructPrivateInPublicGeneric\u003cT\u003e(TestStructPrivateGeneric\u003cT\u003e);\n\n#[derive(FromStr, Debug, Eq, PartialEq)]\nstruct TestStructPrivateGeneric\u003cT\u003e(T);\n\n#[test]\nfn bound_predicate_struct() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[display(bound(\"T : Default\"))]\n    pub struct TestStructBoundPredicate\u003cT\u003e(FromStrIfDefault\u003cT\u003e);\n\n    #[derive(Debug, Eq, PartialEq)]\n    struct FromStrIfDefault\u003cT\u003e(T);\n    impl\u003cT: Default\u003e FromStr for FromStrIfDefault\u003cT\u003e {\n        type Err = ParseError;\n\n        fn from_str(_: \u0026str) -\u003e Result\u003cSelf, Self::Err\u003e {\n            Ok(Self(Default::default()))\n        }\n    }\n}\n\n#[test]\nfn different_bound() {\n    #![deny(private_in_public)]\n\n    #[derive(Display, FromStr, PartialEq, Debug)]\n    #[display(bound(\"T : Display\"))]\n    #[from_str(bound(\"T : FromStr\"))]\n    pub struct Outer\u003cT\u003e(Inner\u003cT\u003e);\n\n    #[derive(Display, FromStr, PartialEq, Debug)]\n    struct Inner\u003cT\u003e(T);\n\n    assert_from_str(\"5\", Outer(Inner(5)));\n}\n\n#[test]\nfn bound_type_enum() {\n    assert_from_str(\"10\", Outer::A(Inner(10)));\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[display(\"{0.0}\", bound(T))]\n    #[from_str(default_fields(\"0\"))]\n    enum Outer\u003cT: Default\u003e {\n        A(Inner\u003cT\u003e),\n    }\n    #[derive(Debug, Eq, PartialEq, Default)]\n    struct Inner\u003cT: Default\u003e(T);\n}\n\n#[deny(private_in_public)]\n#[test]\nfn bound_struct_field() {\n    #[derive(FromStr)]\n    struct Inner\u003cT\u003e(T);\n    #[derive(FromStr)]\n    pub struct Outer\u003cT\u003e(#[from_str(bound(T))] Inner\u003cT\u003e);\n}\n\n#[allow(dead_code)]\n#[test]\nfn bound_enum_variant() {\n    #[derive(FromStr)]\n    #[from_str(bound(T : core::str::FromStr + Copy ))]\n    pub struct Inner\u003cT\u003e(T);\n    #[derive(FromStr)]\n    pub enum Outer\u003cT\u003e {\n        #[display(\"{0}\")]\n        #[from_str(bound(T : core::str::FromStr + Copy))]\n        A(Inner\u003cT\u003e),\n    }\n}\n\n#[allow(dead_code)]\n#[test]\nfn bound_enum_field() {\n    #[derive(FromStr)]\n    #[from_str(bound(T : core::str::FromStr + Copy ))]\n    pub struct Inner\u003cT\u003e(T);\n    #[derive(FromStr)]\n    pub enum Outer\u003cT\u003e {\n        #[display(\"{0}\")]\n        A(#[from_str(bound(T : core::str::FromStr + Copy))] Inner\u003cT\u003e),\n    }\n}\n\n#[test]\nfn doc_comment_struct() {\n    /// doc\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    struct TestStruct {\n        a: u8,\n    }\n    assert_from_str(\"10\", TestStruct { a: 10 });\n}\n\n#[test]\nfn doc_comment_struct_field() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    pub struct TestStruct {\n        /// doc\n        a: u8,\n    }\n    assert_from_str(\"10\", TestStruct { a: 10 });\n}\n\n#[test]\nfn doc_comment_enum() {\n    /// doc\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    enum TestEnum {\n        A,\n    }\n    assert_from_str(\"A\", TestEnum::A);\n}\n\n#[test]\nfn doc_comment_variant() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    enum TestEnum {\n        /// doc\n        A,\n    }\n    assert_from_str(\"A\", TestEnum::A);\n}\n\n#[test]\nfn attr_enum() {\n    #[derive(FromStr, Debug, Eq, PartialEq)]\n    #[non_exhaustive]\n    enum TestEnum {\n        A,\n    }\n    assert_from_str(\"A\", TestEnum::A);\n}\n\nmacro_rules! macro_rule_hygiene_test {\n    () =\u003e {\n        #[derive(FromStr, Debug, Eq, PartialEq)]\n        struct HygieneTestType {\n            x: $crate::U8Alias,\n        }\n    };\n}\n\ntype U8Alias = u8;\n#[test]\nfn macro_rule_hygiene() {\n    macro_rule_hygiene_test!();\n    assert_from_str(\"5\", HygieneTestType { x: 5 });\n}\n\n#[test]\nfn new_return_option() {\n    #[derive(Display, FromStr, Debug, Eq, PartialEq)]\n    #[from_str(new = Self::new(_0))]\n    struct Non1USize(usize);\n\n    impl Non1USize {\n        fn new(value: usize) -\u003e Option\u003cSelf\u003e {\n            if value == 1 {\n                None\n            } else {\n                Some(Self(value))\n            }\n        }\n    }\n\n    assert_from_str(\"0\", Non1USize(0));\n    assert_from_str_err::\u003cNon1USize\u003e(\"1\");\n}\n\n#[test]\nfn new_return_result() {\n    #[derive(Display, FromStr, Debug, Eq, PartialEq)]\n    #[from_str(new = Self::new(_0))]\n    struct Non1USize(usize);\n    struct ParseNon1UsizeError;\n\n    impl Non1USize {\n        fn new(value: usize) -\u003e core::result::Result\u003cSelf, ParseNon1UsizeError\u003e {\n            if value == 1 {\n                Err(ParseNon1UsizeError)\n            } else {\n                Ok(Self(value))\n            }\n        }\n    }\n\n    assert_from_str(\"0\", Non1USize(0));\n    assert_from_str_err::\u003cNon1USize\u003e(\"1\");\n}\n\n#[test]\nfn new_return_value() {\n    #[derive(Display, FromStr, Debug, Eq, PartialEq)]\n    #[from_str(new = Self::new(_0))]\n    struct NewTypeUSize(usize);\n    impl NewTypeUSize {\n        fn new(value: usize) -\u003e Self {\n            Self(value)\n        }\n    }\n\n    assert_from_str(\"0\", NewTypeUSize(0));\n}\n\n#[test]\nfn new_tuple() {\n    #[derive(Display, FromStr, Debug, Eq, PartialEq)]\n    #[from_str(new = Self::new(_0))]\n    struct MyNonZeroUSize(usize);\n\n    impl MyNonZeroUSize {\n        fn new(value: usize) -\u003e Option\u003cSelf\u003e {\n            if value == 0 {\n                None\n            } else {\n                Some(Self(value))\n            }\n        }\n    }\n\n    assert_from_str(\"1\", MyNonZeroUSize(1));\n    assert_from_str_err::\u003cMyNonZeroUSize\u003e(\"0\");\n}\n#[test]\nfn new_tuple_field_x2() {\n    #[derive(Display, FromStr, Debug, Eq, PartialEq)]\n    #[display(\"{0}-{1}\")]\n    #[from_str(new = Self::new(_0, _1))]\n    struct TestRange(usize, usize);\n    impl TestRange {\n        fn new(start: usize, end: usize) -\u003e Option\u003cSelf\u003e {\n            if start \u003c= end {\n                Some(TestRange(start, end))\n            } else {\n                None\n            }\n        }\n    }\n\n    assert_from_str(\"1-2\", TestRange(1, 2));\n    assert_from_str_err::\u003cTestRange\u003e(\"2-1\");\n}\n\n#[test]\nfn new_struct() {\n    #[derive(Display, FromStr, Debug, Eq, PartialEq)]\n    #[from_str(new = Self::new(value))]\n    struct Non1USize {\n        value: usize,\n    }\n\n    impl Non1USize {\n        fn new(value: usize) -\u003e Option\u003cSelf\u003e {\n            if value == 1 {\n                None\n            } else {\n                Some(Self { value })\n            }\n        }\n    }\n\n    assert_from_str(\"0\", Non1USize { value: 0 });\n    assert_from_str_err::\u003cNon1USize\u003e(\"1\");\n}\n\n#[test]\nfn new_struct_field_x2() {\n    #[derive(Display, FromStr, Debug, Eq, PartialEq)]\n    #[display(\"{start}-{end}\")]\n    #[from_str(new = Self::new(start, end))]\n    struct TestRange {\n        start: usize,\n        end: usize,\n    }\n    impl TestRange {\n        fn new(start: usize, end: usize) -\u003e Option\u003cSelf\u003e {\n            if start \u003c= end {\n                Some(TestRange { start, end })\n            } else {\n                None\n            }\n        }\n    }\n\n    assert_from_str(\"1-2\", TestRange { start: 1, end: 2 });\n    assert_from_str_err::\u003cTestRange\u003e(\"2-1\");\n}\n\n#[test]\nfn new_enum() {\n    #[derive(Display, FromStr, Debug, Eq, PartialEq)]\n    #[display(\"{} {0}\")]\n    enum NonZeroEnum {\n        #[from_str(new = Self::new_x(_0))]\n        X(usize),\n        #[from_str(new = Self::new_y(_0))]\n        Y(usize),\n    }\n\n    impl NonZeroEnum {\n        fn new_x(value: usize) -\u003e Option\u003cSelf\u003e {\n            if value == 0 {\n                None\n            } else {\n                Some(Self::X(value))\n            }\n        }\n        fn new_y(value: usize) -\u003e Option\u003cSelf\u003e {\n            if value == 0 {\n                None\n            } else {\n                Some(Self::Y(value))\n            }\n        }\n    }\n\n    assert_from_str(\"X 1\", NonZeroEnum::X(1));\n    assert_from_str(\"Y 1\", NonZeroEnum::Y(1));\n    assert_from_str_err::\u003cNonZeroEnum\u003e(\"X 0\");\n    assert_from_str_err::\u003cNonZeroEnum\u003e(\"Y 0\");\n}\n\nfn assert_from_str\u003cT: FromStr + Debug + PartialEq\u003e(s: \u0026str, value: T)\nwhere\n    \u003cT as FromStr\u003e::Err: Display,\n{\n    match s.parse::\u003cT\u003e() {\n        Ok(a) =\u003e assert_eq!(a, value, \"input = \\\"{}\\\"\", s),\n        Err(e) =\u003e panic!(\"\\\"{}\\\" parse failed. ({})\", s, e),\n    }\n}\nfn assert_from_str_err\u003cT: FromStr + Debug\u003e(s: \u0026str) {\n    if let Ok(a) = s.parse::\u003cT\u003e() {\n        panic!(\n            \"from_str(\\\"{}\\\") should return Err. but return `{:?}`.\",\n            s, a\n        );\n    }\n}\n","traces":[{"line":731,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":732,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1044,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1045,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1046,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1049,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1050,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1051,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":1053,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":9},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","parse-display","parse-display-tests","tests","lib.rs"],"content":"\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day1","mod.rs"],"content":"mod part1;\nmod part2;\n\npub use part1::aoc2018_day1_part1;\npub use part2::aoc2018_day1_part2;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day1","part1.rs"],"content":"use std::error::Error;\n\npub fn aoc2018_day1_part1 (input: \u0026 str) -\u003e Result \u003cString, Box \u003cdyn Error\u003e\u003e {\n\tlet mut total: i64 = 0;\n\tfor line in input.trim ().split (\"\\n\") {\n\t\tlet delta: i64 = line.parse () ?;\n\t\ttotal += delta;\n\t}\n\tOk (format! (\"{}\", total))\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day1","part2.rs"],"content":"use std::collections::HashSet;\nuse std::error::Error;\nuse std::iter;\n\npub fn aoc2018_day1_part2 (input: \u0026 str) -\u003e Result \u003cString, Box \u003cdyn Error\u003e\u003e {\n\tlet deltas: Result \u003cVec \u003ci64\u003e, Box \u003cdyn Error\u003e\u003e = input.trim ().split (\"\\n\").map (\n\t\t|line| Ok (line.parse () ?),\n\t).collect ();\n\tlet deltas = deltas ?;\n\tlet mut total: i64 = 0;\n\tlet mut seen: HashSet \u003ci64\u003e = HashSet::new ();\n\tfor delta in iter::repeat (deltas).flatten () {\n\t\ttotal += delta;\n\t\tif seen.contains (\u0026 total) { break }\n\t\tseen.insert (total);\n\t}\n\tOk (format! (\"{}\", total))\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day2","mod.rs"],"content":"mod part1;\nmod part2;\n\npub use part1::aoc2018_day2_part1;\npub use part2::aoc2018_day2_part2;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day2","part1.rs"],"content":"use std::collections::HashMap;\nuse std::collections::HashSet;\nuse std::error::Error;\n\npub fn aoc2018_day2_part1 (input: \u0026 str) -\u003e Result \u003cString, Box \u003cdyn Error\u003e\u003e {\n\tlet mut num_twos: u64 = 0;\n\tlet mut num_threes: u64 = 0;\n\tfor line in input.trim ().split (\"\\n\") {\n\t\tlet mut letters: HashMap \u003cchar, u64\u003e = HashMap::new ();\n\t\tfor ch in line.chars () {\n\t\t\t(* letters.entry (ch).or_insert (0)) += 1;\n\t\t}\n\t\tlet nums: HashSet \u003cu64\u003e = letters.into_values ().collect ();\n\t\tif nums.contains (\u0026 2) { num_twos += 1 }\n\t\tif nums.contains (\u0026 3) { num_threes += 1 }\n\t}\n\tprintln! (\"Number of twos: {}\", num_twos);\n\tprintln! (\"Number of threes: {}\", num_threes);\n\tOk (format! (\"{}\", num_twos * num_threes))\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day2","part2.rs"],"content":"use std::error::Error;\n\npub fn aoc2018_day2_part2 (input: \u0026 str) -\u003e Result \u003cString, Box \u003cdyn Error\u003e\u003e {\n\tlet lines: Vec \u003c\u0026 str\u003e = input.trim ().split (\"\\n\").collect ();\n\tfor index_0 in 0 .. lines.len () - 2 {\n\t\tlet line_0 = lines [index_0];\n\t\tfor index_1 in index_0 + 1 .. lines.len () - 1 {\n\t\t\tlet line_1 = lines [index_1];\n\t\t\tlet num_different: u64 = Iterator::zip (line_0.chars (), line_1.chars ()).filter (\n\t\t\t\t|(ch_0, ch_1)| ch_0 != ch_1\n\t\t\t).count () as u64;\n\t\t\tif num_different != 1 { continue }\n\t\t\tlet common_chars: String = Iterator::zip (line_0.chars (), line_1.chars ()).filter (\n\t\t\t\t|(ch_0, ch_1)| ch_0 == ch_1\n\t\t\t).map (\n\t\t\t\t|(ch, _)| ch\n\t\t\t).collect ();\n\t\t\tprintln! (\"First box ID: {}\", line_0);\n\t\t\tprintln! (\"Second box ID: {}\", line_1);\n\t\t\treturn Ok (common_chars);\n\t\t}\n\t}\n\tpanic! ();\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day3","mod.rs"],"content":"mod part1;\nmod part2;\n\npub use part1::aoc2018_day3_part1;\npub use part2::aoc2018_day3_part2;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day3","part1.rs"],"content":"use std::collections::HashMap;\nuse std::error::Error;\nuse text_io::try_scan;\n\npub fn aoc2018_day3_part1 (input: \u0026 str) -\u003e Result \u003cString, Box \u003cdyn Error\u003e\u003e {\n\tlet mut usage: HashMap \u003c(u64, u64), u64\u003e = HashMap::new ();\n\tfor line in input.trim ().split (\"\\n\") {\n\t\tlet id: u64;\n\t\tlet (left, top, width, height): (u64, u64, u64, u64);\n\t\ttry_scan! (line.bytes () =\u003e \"#{} @ {},{}: {}x{}\", id, left, top, width, height);\n\t\tfor x in left .. left + width {\n\t\t\tfor y in top .. top + height {\n\t\t\t\t(* usage.entry ((x, y)).or_insert (0)) += 1;\n\t\t\t}\n\t\t}\n\t}\n\tlet num_common = usage.into_values ().filter (|num| * num \u003e 1).count ();\n\tOk (format! (\"{}\", num_common))\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day3","part2.rs"],"content":"use std::collections::HashMap;\nuse std::error::Error;\nuse text_io::try_scan;\n\npub fn aoc2018_day3_part2 (input: \u0026 str) -\u003e Result \u003cString, Box \u003cdyn Error\u003e\u003e {\n\tlet mut usage: HashMap \u003c(u64, u64), u64\u003e = HashMap::new ();\n\tfor line in input.trim ().split (\"\\n\") {\n\t\tlet id: u64;\n\t\tlet (left, top, width, height): (u64, u64, u64, u64);\n\t\ttry_scan! (line.bytes () =\u003e \"#{} @ {},{}: {}x{}\", id, left, top, width, height);\n\t\tfor x in left .. left + width {\n\t\t\tfor y in top .. top + height {\n\t\t\t\t(* usage.entry ((x, y)).or_insert (0)) += 1;\n\t\t\t}\n\t\t}\n\t}\n\t'LINES: for line in input.trim ().split (\"\\n\") {\n\t\tlet id: u64;\n\t\tlet (left, top, width, height): (u64, u64, u64, u64);\n\t\ttry_scan! (line.bytes () =\u003e \"#{} @ {},{}: {}x{}\", id, left, top, width, height);\n\t\tfor x in left .. left + width {\n\t\t\tfor y in top .. top + height {\n\t\t\t\tif usage [\u0026 (x, y)] \u003e 1 { continue 'LINES }\n\t\t\t}\n\t\t}\n\t\tprintln! (\"Non overlapping ID: {}\", id);\n\t\treturn Ok (format! (\"{}\", id));\n\t}\n\tpanic! ();\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day4","mod.rs"],"content":"mod part1;\nmod part2;\nmod shared;\n\npub use part1::aoc2018_day4_part1;\npub use part2::aoc2018_day4_part2;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day4","part1.rs"],"content":"use chrono::Duration;\nuse chrono::Timelike as _;\nuse std::collections::HashMap;\nuse std::error::Error;\n\nuse crate::day4::shared;\nuse crate::day4::shared::LineIter;\n\npub fn aoc2018_day4_part1 (input: \u0026 str) -\u003e Result \u003cString, Box \u003cdyn Error\u003e\u003e {\n\n\tlet lines = shared::parse_lines (input) ?;\n\n\tlet mut guard_total_mins: HashMap \u003cu32, i32\u003e = HashMap::new ();\n\tlet mut guard_sleep_mins: HashMap \u003cu32, HashMap \u003cu32, u32\u003e\u003e = HashMap::new ();\n\tfor (guard_id, sleep_time, wake_time) in LineIter::new (\u0026 lines) {\n\t\tlet diff_mins = (wake_time - sleep_time).num_minutes () as i32;\n\t\t(* guard_total_mins.entry (guard_id).or_insert (0)) += diff_mins;\n\t\tlet sleep_mins = guard_sleep_mins.entry (guard_id).or_insert (HashMap::new ());\n\t\tfor time in itertools::iterate (sleep_time, |time| * time + Duration::minutes (1))\n\t\t\t\t.take_while (|time| * time \u003c wake_time) {\n\t\t\t(* sleep_mins.entry (time.time ().minute ()).or_insert (0)) += 1;\n\t\t}\n\t}\n\n\tlet (sleepiest_id, _) = guard_total_mins.iter ().max_by_key (|(_, mins)| * mins).unwrap ();\n\tlet (sleepiest_min, _) = guard_sleep_mins [\u0026 sleepiest_id].iter ().max_by_key (\n\t\t|(_, num)| * num,\n\t).unwrap ();\n\n\tprintln! (\"Guard id: {}\", sleepiest_id);\n\tprintln! (\"Time: 00:{:02}\", sleepiest_min);\n\n\tOk (format! (\"{}\", sleepiest_id * sleepiest_min))\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day4","part2.rs"],"content":"use chrono::Duration;\nuse chrono::Timelike as _;\nuse std::collections::HashMap;\nuse std::error::Error;\n\nuse crate::day4::shared;\nuse crate::day4::shared::LineIter;\n\npub fn aoc2018_day4_part2 (input: \u0026 str) -\u003e Result \u003cString, Box \u003cdyn Error\u003e\u003e {\n\n\tlet lines = shared::parse_lines (input) ?;\n\n\tlet mut sleep_mins: HashMap \u003c(u32, u32), u32\u003e = HashMap::new ();\n\tfor (guard_id, sleep_time, wake_time) in LineIter::new (\u0026 lines) {\n\t\tfor time in itertools::iterate (sleep_time, |time| * time + Duration::minutes (1))\n\t\t\t\t.take_while (|time| * time \u003c wake_time) {\n\t\t\t(* sleep_mins.entry ((guard_id, time.time ().minute ())).or_insert (0)) += 1;\n\t\t}\n\t}\n\n\tlet ((guard_id, minute), _) = sleep_mins.iter ().max_by_key (|(_, num)| * num).unwrap ();\n\n\tprintln! (\"Guard id: {}\", guard_id);\n\tprintln! (\"Time: 00:{:02}\", minute);\n\n\tOk (format! (\"{}\", guard_id * minute))\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day4","shared.rs"],"content":"use chrono::NaiveDateTime;\nuse itertools::Itertools as _;\nuse parse_display_derive::FromStr;\nuse std::error::Error;\nuse std::slice::Iter;\n\n#[ derive (Clone, Copy, FromStr) ]\n#[ display (\"[{time}] {event}\") ]\n#[ from_str (new = Ok::\u003c_, Box \u003cdyn Error\u003e\u003e (()).and_then (|_| Ok (Line {\n\ttime: NaiveDateTime::parse_from_str (String::as_str (\u0026 time), \"%Y-%m-%d %H:%M\") ?,\n\tevent,\n}))) ]\npub struct Line {\n\tpub time: NaiveDateTime,\n\tpub event: Event,\n}\n\n#[ derive (Clone, Copy, FromStr) ]\npub enum Event {\n\t#[display (\"Guard #{0} begins shift\")] BeginsShift (u32),\n\t#[display (\"falls asleep\")] FallsAsleep,\n\t#[display (\"wakes up\")] WakesUp,\n}\n\npub struct LineIter \u003c'a\u003e {\n\titer: Iter \u003c'a, Line\u003e,\n\tstate: LineIterState,\n}\n\nimpl \u003c'a\u003e LineIter \u003c'a\u003e {\n\tpub fn new (lines: \u0026 'a [Line]) -\u003e LineIter \u003c'a\u003e {\n\t\tLineIter {\n\t\t\titer: lines.iter (),\n\t\t\tstate: LineIterState::None,\n\t\t}\n\t}\n}\n\nimpl \u003c'a\u003e Iterator for LineIter \u003c'a\u003e {\n\ttype Item = (u32, NaiveDateTime, NaiveDateTime);\n\tfn next (\u0026 mut self) -\u003e Option \u003cSelf::Item\u003e {\n\t\tloop {\n\t\t\tlet line = match self.iter.next () {\n\t\t\t\tSome (line) =\u003e line,\n\t\t\t\tNone =\u003e return None,\n\t\t\t};\n\t\t\tmatch (self.state, line.event) {\n\t\t\t\t(_, Event::BeginsShift (guard_id)) =\u003e {\n\t\t\t\t\tself.state = LineIterState::Awake (guard_id);\n\t\t\t\t},\n\t\t\t\t(LineIterState::Awake (guard_id), Event::FallsAsleep) =\u003e {\n\t\t\t\t\tself.state = LineIterState::Asleep (guard_id, line.time);\n\t\t\t\t},\n\t\t\t\t(LineIterState::Asleep (guard_id, sleep_time), Event::WakesUp) =\u003e {\n\t\t\t\t\tself.state = LineIterState::Awake (guard_id);\n\t\t\t\t\treturn Some ((guard_id, sleep_time, line.time));\n\t\t\t\t},\n\t\t\t\t_ =\u003e panic! (),\n\t\t\t};\n\t\t}\n\t}\n}\n\n#[ derive (Clone, Copy) ]\nenum LineIterState {\n\tNone,\n\tAwake (u32),\n\tAsleep (u32, NaiveDateTime)\n}\n\npub fn parse_lines (input: \u0026 str) -\u003e Result \u003cVec \u003cLine\u003e, Box \u003cdyn Error\u003e\u003e {\n\tOk (\n\t\tinput.trim ().split (\"\\n\")\n\t\t\t.map (|line| Ok::\u003cLine, Box \u003cdyn Error\u003e\u003e (line.parse () ?))\n\t\t\t.collect::\u003cResult \u003cVec \u003c_\u003e, _\u003e\u003e () ?\n\t\t\t.into_iter ().sorted_by_key (|line| line.time).collect ()\n\t)\n}\n","traces":[{"line":31,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":33,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":45,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":47,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":49,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":52,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":58,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":16},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day5","mod.rs"],"content":"mod part1;\nmod part2;\n\npub use part1::aoc2018_day5_part1;\npub use part2::aoc2018_day5_part2;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day5","part1.rs"],"content":"use std::error::Error;\n\npub fn aoc2018_day5_part1 (input: \u0026 str) -\u003e Result \u003cString, Box \u003cdyn Error\u003e\u003e {\n\n\tlet mut result = String::new ();\n\tfor ch in input.trim ().chars () {\n\t\tif let Some (last_char) = result.chars ().last () {\n\t\t\tif last_char.to_ascii_lowercase () == ch.to_ascii_lowercase ()\n\t\t\t\t\t\u0026\u0026 last_char.is_ascii_lowercase () != ch.is_ascii_lowercase () {\n\t\t\t\tresult.pop ();\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\t\tresult.push (ch);\n\t}\n\n\tprintln! (\"Resulting polymer: {}\", result);\n\n\tOk (format! (\"{}\", result.len ()))\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day5","part2.rs"],"content":"use std::collections::HashMap;\nuse std::error::Error;\n\npub fn aoc2018_day5_part2 (input: \u0026 str) -\u003e Result \u003cString, Box \u003cdyn Error\u003e\u003e {\n\n\tlet mut results: HashMap \u003cchar, String\u003e = HashMap::new ();\n\tfor remove_ch in 'a' ..= 'z' {\n\t\tlet polymer: String = input.trim ().chars ().filter (\n\t\t\t|ch| ch.to_ascii_lowercase () != remove_ch,\n\t\t).collect ();\n\t\tlet mut result = String::new ();\n\t\tfor ch in polymer.chars () {\n\t\t\tif let Some (last_char) = result.chars ().last () {\n\t\t\t\tif last_char.to_ascii_lowercase () == ch.to_ascii_lowercase ()\n\t\t\t\t\t\t\u0026\u0026 last_char.is_ascii_lowercase () != ch.is_ascii_lowercase () {\n\t\t\t\t\tresult.pop ();\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t\tresult.push (ch);\n\t\t}\n\t\tresults.insert (remove_ch, result);\n\t}\n\n\tlet (ch, result) = results.iter ().min_by_key (\n\t\t|(_, result)| result.len (),\n\t).unwrap ();\n\n\tprintln! (\"Most problematic unit type: {}\", ch);\n\tprintln! (\"Resulting polymer: {}\", result);\n\n\tOk (format! (\"{}\", result.len ()))\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day6","mod.rs"],"content":"mod part1;\nmod part2;\n\npub use part1::aoc2018_day6_part1;\npub use part2::aoc2018_day6_part2;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day6","part1.rs"],"content":"use std::collections::HashMap;\nuse std::collections::HashSet;\nuse std::error::Error;\nuse std::iter;\n\nuse crate::shared::Grid;\nuse crate::shared::Pos;\n\npub fn aoc2018_day6_part1 (input: \u0026 str) -\u003e Result \u003cString, Box \u003cdyn Error\u003e\u003e {\n\n\t// collect points and work out size\n\tlet mut width: i64 = 0;\n\tlet mut height: i64 = 0;\n\tlet mut posns: Vec \u003cPos\u003e = Vec::new ();\n\tfor line in input.trim ().split (\"\\n\") {\n\t\tlet line_parts: Vec \u003c\u0026 str\u003e = line.split (\", \").collect ();\n\t\tif line_parts.len () != 2 { panic! () }\n\t\tlet pos = Pos { x: line_parts [0].parse () ?, y: line_parts [1].parse () ? };\n\t\tif pos.x \u003c 0 || pos.y \u003c 0 { panic! () }\n\t\tif pos.x \u003e= width { width = pos.x + 1 }\n\t\tif pos.y \u003e= height { height = pos.y + 1 }\n\t\tposns.push (pos);\n\t}\n\tprintln! (\"Grid size: {} x {}\", width, height);\n\n\t// initialize grid\n\tlet mut grid: Grid \u003cOption \u003cu8\u003e\u003e = Grid::builder ()\n\t\t.width (width)\n\t\t.height (height)\n\t\t.unbounded ()\n\t\t.default (None)\n\t\t.build ();\n\tlet mut id: u8 = 0;\n\tfor pos in posns.iter ().cloned () {\n\t\tif id == u8::MAX { panic! () }\n\t\tgrid.set (pos, Some (id));\n\t\tid += 1;\n\t}\n\n\t// spread out one square at a time\n\tloop {\n\t\tlet mut grid_temp = grid.clone ();\n\t\tlet mut progress = false;\n\t\tfor pos in grid.posns () {\n\t\t\tif grid.get (pos).is_some () { continue }\n\t\t\tlet mut neighbours: HashSet \u003cu8\u003e = HashSet::new ();\n\t\t\tfor neighbour_pos in pos.four_neighbours () {\n\t\t\t\tif let Some (neighbour_val) = grid.get (neighbour_pos) {\n\t\t\t\t\tif neighbour_val == u8::MAX { continue }\n\t\t\t\t\tneighbours.insert (neighbour_val);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif neighbours.len () == 1 {\n\t\t\t\tgrid_temp.set (pos, Some (neighbours.into_iter ().next ().unwrap ()));\n\t\t\t}  else if neighbours.len () \u003e 1 {\n\t\t\t\tgrid_temp.set (pos, Some (u8::MAX));\n\t\t\t}\n\t\t\tprogress = true;\n\t\t}\n\t\tgrid = grid_temp;\n\t\tif ! progress { break }\n\t}\n\n\t// count areas\n\tlet mut areas: Vec \u003cu64\u003e = iter::repeat (0).take (posns.len () + 1).collect ();\n\tfor value in grid.values () {\n\t\tlet value = value.unwrap ();\n\t\tif value == u8::MAX { continue }\n\t\tareas [value as usize] += 1;\n\t}\n\tlet mut areas: HashMap \u003cu8, u64\u003e = areas.into_iter ().enumerate ().map (\n\t\t|(index, value)| (index as u8, value),\n\t).collect ();\n\n\t// remove areas which reach the edge\n\tfor x in 0 .. width {\n\t\tif let Some (value) = grid.get (Pos::new (x, 0)) {\n\t\t\tareas.remove (\u0026 value);\n\t\t}\n\t\tif let Some (value) = grid.get (Pos::new (x, height - 1)) {\n\t\t\tareas.remove (\u0026 value);\n\t\t}\n\t}\n\tfor y in 0 .. width {\n\t\tif let Some (value) = grid.get (Pos::new (0, y)) {\n\t\t\tareas.remove (\u0026 value);\n\t\t}\n\t\tif let Some (value) = grid.get (Pos::new (width - 1, y)) {\n\t\t\tareas.remove (\u0026 value);\n\t\t}\n\t}\n\n\t// find largest remaining area\n\tlet (index, size) = areas.iter ().max_by_key (|(_, size)| * size).unwrap ();\n\tlet index = * index;\n\n\tprintln! (\"Identified largest finite area\");\n\tprintln! (\"Index: {}\", index);\n\tprintln! (\"Position: {}, {}\", posns [index as usize].x, posns [index as usize].y);\n\n\tOk (format! (\"{}\", size))\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day6","part2.rs"],"content":"use std::error::Error;\n\nuse crate::shared::GridPosIter;\nuse crate::shared::Pos;\n\npub fn aoc2018_day6_part2 (input: \u0026 str) -\u003e Result \u003cString, Box \u003cdyn Error\u003e\u003e {\n\n\t// collect points and work out size\n\tlet mut width: i64 = 0;\n\tlet mut height: i64 = 0;\n\tlet mut posns: Vec \u003cPos\u003e = Vec::new ();\n\tfor line in input.trim ().split (\"\\n\") {\n\t\tlet line_parts: Vec \u003c\u0026 str\u003e = line.split (\", \").collect ();\n\t\tif line_parts.len () != 2 { panic! () }\n\t\tlet pos = Pos { x: line_parts [0].parse () ?, y: line_parts [1].parse () ? };\n\t\tif pos.x \u003c 0 || pos.y \u003c 0 { panic! () }\n\t\tif pos.x \u003e= width { width = pos.x + 1 }\n\t\tif pos.y \u003e= height { height = pos.y + 1 }\n\t\tposns.push (pos);\n\t}\n\tprintln! (\"Grid size: {} × {} = {}\", width, height, width * height);\n\tlet extend_size = (10_000 + posns.len () as i64 - 1) / posns.len () as i64;\n\tprintln! (\"Extend by 10000 ÷ {} = {} in four directions\", posns.len (), extend_size);\n\tlet new_width = width + extend_size * 2;\n\tlet new_height = height + extend_size * 2;\n\tprintln! (\"New grid size: {} × {} = {}\", new_width, new_height, new_width * new_height);\n\n\tlet mut area: u64 = 0;\n\tfor pos_0 in GridPosIter::new (\n\t\tPos::new (-100, -100),\n\t\tPos::new (width, height),\n\t) {\n\t\tlet distance: i64 = posns.iter ().map (\n\t\t\t|pos_1| (pos_0.x - pos_1.x).abs () + (pos_0.y - pos_1.y).abs (),\n\t\t).sum ();\n\t\tif distance \u003c= 10000 {\n\t\t\tarea += 1;\n\t\t}\n\t}\n\tprintln! (\"Number of nearby squares: {}\", area);\n\n\tOk (format! (\"{}\", area))\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day7","mod.rs"],"content":"mod part1;\nmod part2;\n\npub use part1::aoc2018_day7_part1;\npub use part2::aoc2018_day7_part2;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day7","part1.rs"],"content":"use parse_display_derive::FromStr;\nuse std::collections::HashMap;\nuse std::collections::HashSet;\nuse std::error::Error;\n\npub fn aoc2018_day7_part1 (input: \u0026 str) -\u003e Result \u003cString, Box \u003cdyn Error\u003e\u003e {\n\n\tlet mut deps: HashMap \u003cchar, HashSet \u003cchar\u003e\u003e = HashMap::new ();\n\tfor line in input.trim ().split (\"\\n\") {\n\t\tlet line: Line = line.parse () ?;\n\t\tdeps.entry (line.dependency).or_insert (HashSet::new ());\n\t\t(* deps.entry (line.target).or_insert (HashSet::new ())).insert (line.dependency);\n\t}\n\n\tlet mut remaining: HashSet \u003cchar\u003e = deps.keys ().cloned ().collect ();\n\tlet mut completed: HashSet \u003cchar\u003e = HashSet::new ();\n\tlet mut order = String::new ();\n\twhile ! remaining.is_empty () {\n\t\tlet next_step = remaining.iter ().filter (\n\t\t\t|step| deps [step].iter ().all (|dep| completed.contains (dep)),\n\t\t).cloned ().min ().ok_or (\"No next step\") ?;\n\t\tremaining.remove (\u0026 next_step);\n\t\tcompleted.insert (next_step);\n\t\torder.push (next_step);\n\t}\n\n\tOk (order)\n\n}\n\n#[ derive (FromStr) ]\n#[ display (\"Step {dependency} must be finished before step {target} can begin.\") ]\nstruct Line {\n\ttarget: char,\n\tdependency: char,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day7","part2.rs"],"content":"use parse_display_derive::FromStr;\nuse std::collections::HashMap;\nuse std::collections::HashSet;\nuse std::error::Error;\nuse std::iter;\n\npub fn aoc2018_day7_part2 (input: \u0026 str) -\u003e Result \u003cString, Box \u003cdyn Error\u003e\u003e {\n\n\tlet mut deps: HashMap \u003cchar, HashSet \u003cchar\u003e\u003e = HashMap::new ();\n\tfor line in input.trim ().split (\"\\n\") {\n\t\tlet line: Line = line.parse () ?;\n\t\tdeps.entry (line.dependency).or_insert (HashSet::new ());\n\t\t(* deps.entry (line.target).or_insert (HashSet::new ())).insert (line.dependency);\n\t}\n\n\tlet mut remaining: HashSet \u003cchar\u003e = deps.keys ().cloned ().collect ();\n\tlet mut completed: HashSet \u003cchar\u003e = HashSet::new ();\n\tlet mut queue: HashSet \u003cchar\u003e = HashSet::new ();\n\tlet mut workers: Vec \u003cOption \u003c(char, u8)\u003e\u003e = iter::repeat (None).take (5).collect ();\n\tlet mut elapsed: u64 = 0;\n\n\twhile ! remaining.is_empty ()\n\t\t|| ! queue.is_empty ()\n\t\t|| workers.iter ().any (Option::is_some) {\n\n\t\tfor next_step in remaining.iter ().filter (\n\t\t\t|step| deps [step].iter ().all (|dep| completed.contains (dep)),\n\t\t).cloned () {\n\t\t\tqueue.insert (next_step);\n\t\t}\n\n\t\tfor worker in workers.iter_mut ().filter (|worker| worker.is_none ()) {\n\t\t\tif queue.is_empty () { break }\n\t\t\tlet next_step = queue.iter ().min ().cloned ().unwrap ();\n\t\t\tlet step_time = 61 + (next_step as u32 - 'A' as u32) as u8;\n\t\t\t* worker = Some ((next_step, step_time));\n\t\t\tremaining.remove (\u0026 next_step);\n\t\t\tqueue.remove (\u0026 next_step);\n\t\t}\n\n\t\telapsed += 1;\n\t\tfor worker_opt in workers.iter_mut ().filter (|worker| worker.is_some ()) {\n\t\t\tlet worker = worker_opt.as_mut ().unwrap ();\n\t\t\tworker.1 -= 1;\n\t\t\tif worker.1 \u003e 0 { continue }\n\t\t\tcompleted.insert (worker.0);\n\t\t\t* worker_opt = None;\n\t\t}\n\n\t}\n\n\tOk (format! (\"{}\", elapsed))\n\n}\n\n#[ derive (FromStr) ]\n#[ display (\"Step {dependency} must be finished before step {target} can begin.\") ]\nstruct Line {\n\ttarget: char,\n\tdependency: char,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day8","mod.rs"],"content":"mod part1;\nmod part2;\n\npub use part1::aoc2018_day8_part1;\npub use part2::aoc2018_day8_part2;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day8","part1.rs"],"content":"use std::error::Error;\nuse std::iter;\n\npub fn aoc2018_day8_part1 (input: \u0026 str) -\u003e Result \u003cString, Box \u003cdyn Error\u003e\u003e {\n\n\tlet data: Vec \u003cu32\u003e = input.trim ().split (\" \").map (\n\t\t|datum| Ok (datum.parse () ?),\n\t).collect::\u003cResult \u003c_, Box \u003cdyn Error\u003e\u003e\u003e () ?;\n\n\tstruct Frame {\n\t\tnum_children: u32,\n\t\tnum_metadata: u32,\n\t}\n\n\tlet mut stack: Vec \u003cFrame\u003e = vec! [\n\t\tFrame {\n\t\t\tnum_children: 1,\n\t\t\tnum_metadata: 0,\n\t\t},\n\t];\n\n\tlet mut data_iter = data.iter ().cloned ();\n\tlet mut metadata_sum: u32 = 0;\n\n\twhile ! stack.is_empty () {\n\t\tlet frame = stack.last_mut ().unwrap ();\n\t\tif frame.num_children \u003e 0 {\n\t\t\tframe.num_children -= 1;\n\t\t\tstack.push (Frame {\n\t\t\t\tnum_children: data_iter.next ().unwrap (),\n\t\t\t\tnum_metadata: data_iter.next ().unwrap (),\n\t\t\t});\n\t\t\tcontinue;\n\t\t}\n\t\tmetadata_sum += iter::repeat_with (\n\t\t\t|| data_iter.next ().unwrap (),\n\t\t).take (frame.num_metadata as usize).sum::\u003cu32\u003e ();\n\t\tstack.pop ();\n\t}\n\n\tif data_iter.next ().is_some () {\n\t\tpanic! ();\n\t}\n\n\tOk (format! (\"{}\", metadata_sum))\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day8","part2.rs"],"content":"use std::error::Error;\nuse std::iter;\n\npub fn aoc2018_day8_part2 (input: \u0026 str) -\u003e Result \u003cString, Box \u003cdyn Error\u003e\u003e {\n\n\tlet data: Vec \u003cu64\u003e = input.trim ().split (\" \").map (\n\t\t|datum| Ok (datum.parse () ?),\n\t).collect::\u003cResult \u003c_, Box \u003cdyn Error\u003e\u003e\u003e () ?;\n\n\tstruct Frame {\n\t\tnum_children: u64,\n\t\tnum_metadata: u64,\n\t\tchild_values: Vec \u003cu64\u003e,\n\t}\n\n\tlet mut stack: Vec \u003cFrame\u003e = vec! [\n\t\tFrame {\n\t\t\tnum_children: 1,\n\t\t\tnum_metadata: 1,\n\t\t\tchild_values: Vec::new (),\n\t\t},\n\t];\n\tlet data = {\n\t\tlet mut data = data;\n\t\tdata.push (1);\n\t\tdata\n\t};\n\n\tlet mut data_iter = data.iter ().cloned ();\n\n\tlet value = loop {\n\t\tlet frame = stack.last_mut ().unwrap ();\n\t\tif frame.num_children \u003e 0 {\n\t\t\tframe.num_children -= 1;\n\t\t\tstack.push (Frame {\n\t\t\t\tnum_children: data_iter.next ().unwrap (),\n\t\t\t\tnum_metadata: data_iter.next ().unwrap (),\n\t\t\t\tchild_values: Vec::new (),\n\t\t\t});\n\t\t\tcontinue;\n\t\t}\n\t\tlet value = if frame.child_values.is_empty () {\n\t\t\titer::repeat_with (\n\t\t\t\t|| data_iter.next ().unwrap (),\n\t\t\t).take (frame.num_metadata as usize).sum::\u003cu64\u003e ()\n\t\t} else {\n\t\t\titer::repeat_with (\n\t\t\t\t|| data_iter.next ().unwrap (),\n\t\t\t).take (frame.num_metadata as usize).map (\n\t\t\t\t|idx| frame.child_values.get (idx as usize - 1).unwrap_or (\u0026 0)\n\t\t\t).sum::\u003cu64\u003e ()\n\t\t};\n\t\tstack.pop ();\n\t\tif let Some (frame) = stack.last_mut () {\n\t\t\tframe.child_values.push (value);\n\t\t} else {\n\t\t\tbreak value;\n\t\t}\n\t};\n\n\tif data_iter.next ().is_some () {\n\t\tpanic! ();\n\t}\n\n\tOk (format! (\"{}\", value))\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day9","mod.rs"],"content":"mod part1;\nmod part2;\nmod shared;\n\npub use part1::aoc2018_day9_part1;\npub use part2::aoc2018_day9_part2;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day9","part1.rs"],"content":"use std::error::Error;\n\nuse super::shared;\nuse super::shared::GameParams;\n\npub fn aoc2018_day9_part1 (input: \u0026 str) -\u003e Result \u003cString, Box \u003cdyn Error\u003e\u003e {\n\tlet params: GameParams = input.trim ().parse () ?;\n\tlet result = shared::play (\u0026 params);\n\tOk (format! (\"{}\", result))\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day9","part2.rs"],"content":"use std::error::Error;\n\nuse super::shared;\nuse super::shared::GameParams;\n\npub fn aoc2018_day9_part2 (input: \u0026 str) -\u003e Result \u003cString, Box \u003cdyn Error\u003e\u003e {\n\tlet mut params: GameParams = input.trim ().parse () ?;\n\tparams.last_marble *= 100;\n\tlet result = shared::play (\u0026 params);\n\tOk (format! (\"{}\", result))\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","day9","shared.rs"],"content":"use parse_display_derive::FromStr;\nuse std::collections::VecDeque;\nuse std::iter;\n\n#[ derive (Clone, Copy, FromStr) ]\n#[ display (\"{num_players} players; last marble is worth {last_marble} points\") ]\npub struct GameParams {\n\tpub num_players: u32,\n\tpub last_marble: u32,\n}\n\npub fn play (params: \u0026 GameParams) -\u003e u32 {\n\tlet mut scores: Vec \u003cu32\u003e = vec! [0; params.num_players as usize];\n\tlet mut circle: VecDeque \u003cu32\u003e = vec! [0].into ();\n\tfor (player, marble) in Iterator::zip (\n\t\titer::repeat (0 .. params.num_players).flatten (),\n\t\t1 ..= params.last_marble,\n\t) {\n\t\tif marble % 23 == 0 {\n\t\t\tlet score = \u0026 mut scores [player as usize];\n\t\t\t* score += marble;\n\t\t\tcircle.rotate_right (7);\n\t\t\t* score += circle.pop_front ().unwrap ();\n\t\t} else {\n\t\t\tcircle.rotate_left (2 % circle.len ());\n\t\t\tcircle.push_front (marble);\n\t\t}\n\t}\n\tscores.into_iter ().max ().unwrap ()\n}\n\n#[test]\nfn test_play () {\n\tfor (input, expected) in vec! [\n\t\t(\"9 players; last marble is worth 25 points\", 32),\n\t\t(\"10 players; last marble is worth 1618 points\", 8317),\n\t\t(\"13 players; last marble is worth 7999 points\", 146373),\n\t\t(\"17 players; last marble is worth 1104 points\", 2764),\n\t\t(\"21 players; last marble is worth 6111 points\", 54718),\n\t\t(\"30 players; last marble is worth 5807 points\", 37305),\n\t] {\n\t\tlet params: GameParams = input.parse ().unwrap ();\n\t\tlet actual = play (\u0026 params);\n\t\tassert_eq! (expected, actual);\n\t}\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2018","src","shared","mod.rs"],"content":"use std::fmt::Debug;\nuse std::iter;\nuse std::mem;\n\n#[ derive (Clone, Copy, Debug, Eq, Hash, PartialEq) ]\npub struct Pos {\n\tpub x: i64,\n\tpub y: i64\n}\n\nimpl Pos {\n\n\tpub fn new (x: i64, y: i64) -\u003e Pos {\n\t\tPos { x, y }\n\t}\n\n\tpub fn up (self, num: i64) -\u003e Pos {\n\t\tPos::new (self.x, i64::checked_sub (self.y, num).unwrap ())\n\t}\n\n\tpub fn down (self, num: i64) -\u003e Pos {\n\t\tPos::new (self.x, i64::checked_add (self.y, num).unwrap ())\n\t}\n\n\tpub fn left (self, num: i64) -\u003e Pos {\n\t\tPos::new (i64::checked_sub (self.x, num).unwrap (), self.y)\n\t}\n\n\tpub fn right (self, num: i64) -\u003e Pos {\n\t\tPos::new (i64::checked_add (self.x, num).unwrap (), self.y)\n\t}\n\n\tpub fn four_neighbours (\u0026 self) -\u003e [Pos; 4] {\n\t\t[\n\t\t\tself.up (1),\n\t\t\tself.down (1),\n\t\t\tself.left (1),\n\t\t\tself.right (1),\n\t\t]\n\t}\n\n}\n\nimpl From \u003c(i64, i64)\u003e for Pos {\n\tfn from ((x, y): (i64, i64)) -\u003e Pos {\n\t\tPos { x, y }\n\t}\n}\n\n#[ derive (Clone) ]\npub struct Grid \u003cValue\u003e {\n\ttop: i64,\n\tbottom: i64,\n\tleft: i64,\n\tright: i64,\n\twidth: usize,\n\theight: usize,\n\tdefault: Value,\n\tbounded: bool,\n\tdata: Vec \u003cValue\u003e,\n}\n\nimpl \u003cValue\u003e Grid \u003cValue\u003e where Value: Clone {\n\n\tpub fn builder () -\u003e GridBuilder \u003cValue\u003e {\n\t\tGridBuilder {\n\t\t\ttop: None,\n\t\t\tbottom: None,\n\t\t\tleft: None,\n\t\t\tright: None,\n\t\t\twidth: None,\n\t\t\theight: None,\n\t\t\tdefault: None,\n\t\t\tbounded: None,\n\t\t}\n\t}\n\n\tpub fn set (\u0026 mut self, pos: Pos, mut value: Value) -\u003e Value {\n\t\tlet index = match self.index (pos) {\n\t\t\tSome (index) =\u003e index,\n\t\t\tNone =\u003e panic! (\"out of bounds\"),\n\t\t};\n\t\tmem::swap (\u0026 mut value, \u0026 mut self.data [index]);\n\t\tvalue\n\t}\n\n\tpub fn get (\u0026 self, pos: Pos) -\u003e Value {\n\t\tlet index = match self.index (pos) {\n\t\t\tSome (index) =\u003e index,\n\t\t\tNone =\u003e if self.bounded {\n\t\t\t\tpanic! (\"out of bounds\");\n\t\t\t} else {\n\t\t\t\treturn self.default.clone ();\n\t\t\t},\n\t\t};\n\t\tself.data [index].clone ()\n\t}\n\n\tpub fn index (\u0026 self, pos: Pos) -\u003e Option \u003cusize\u003e {\n\t\tif pos.x \u003c self.left || pos.x \u003e= self.right { return None }\n\t\tif pos.y \u003c self.top || pos.y \u003e= self.bottom { return None }\n\t\tSome ((pos.y - self.top) as usize * self.width + (pos.x - self.left) as usize)\n\t}\n\n\tpub fn posns (\u0026 self) -\u003e GridPosIter {\n\t\tGridPosIter::new (\n\t\t\tPos::new (self.left, self.top),\n\t\t\tPos::new (self.right, self.bottom),\n\t\t)\n\t}\n\n\tpub fn values (\u0026 self) -\u003e impl Iterator \u003cItem = \u0026 Value\u003e {\n\t\tself.data.iter ()\n\t}\n\n}\n\npub struct GridPosIter {\n\tpos: Pos,\n\tbottom: i64,\n\tleft: i64,\n\tright: i64,\n}\n\nimpl GridPosIter {\n\n\tpub fn new (top_left: Pos, bottom_right: Pos) -\u003e GridPosIter {\n\t\tGridPosIter {\n\t\t\tpos: top_left,\n\t\t\tleft: top_left.x,\n\t\t\tright: bottom_right.x,\n\t\t\tbottom: bottom_right.y,\n\t\t}\n\t}\n\n}\n\nimpl Iterator for GridPosIter {\n\n\ttype Item = Pos;\n\n\tfn next (\u0026 mut self) -\u003e Option \u003cPos\u003e {\n\t\tif self.pos.y == self.bottom { return None }\n\t\tlet result = self.pos;\n\t\tself.pos.x += 1;\n\t\tif self.pos.x == self.right {\n\t\t\tself.pos.x = self.left;\n\t\t\tself.pos.y += 1;\n\t\t}\n\t\tSome (result)\n\t}\n\n}\n\npub struct GridBuilder \u003cValue\u003e {\n\ttop: Option \u003ci64\u003e,\n\tbottom: Option \u003ci64\u003e,\n\tleft: Option \u003ci64\u003e,\n\tright: Option \u003ci64\u003e,\n\twidth: Option \u003cusize\u003e,\n\theight: Option \u003cusize\u003e,\n\tdefault: Option \u003cValue\u003e,\n\tbounded: Option \u003cbool\u003e,\n}\n\nimpl \u003cValue\u003e GridBuilder \u003cValue\u003e where Value: Clone {\n\n\t/*\n\tpub fn top (mut self, top: i64) -\u003e GridBuilder \u003cValue\u003e {\n\t\tif self.top.is_some () { panic! () }\n\t\tself.top = Some (top);\n\t\tself\n\t}\n\n\tpub fn bottom (mut self, bottom: i64) -\u003e GridBuilder \u003cValue\u003e {\n\t\tif self.top.is_none () { panic! () }\n\t\tif self.bottom.is_some () { panic! () }\n\t\tif bottom \u003c self.top.unwrap () { panic! () }\n\t\tself.bottom = Some (bottom);\n\t\tself.height = Some (usize::checked_sub (\n\t\t\tbottom.try_into ().unwrap (),\n\t\t\tself.top.unwrap ().try_into ().unwrap (),\n\t\t).unwrap ());\n\t\tself\n\t}\n\n\tpub fn left (mut self, left: i64) -\u003e GridBuilder \u003cValue\u003e {\n\t\tif self.left.is_some () { panic! () }\n\t\tself.left = Some (left);\n\t\tself\n\t}\n\n\tpub fn right (mut self, right: i64) -\u003e GridBuilder \u003cValue\u003e {\n\t\tif self.left.is_none () { panic! () }\n\t\tif self.right.is_some () { panic! () }\n\t\tif right \u003c self.left.unwrap () { panic! () }\n\t\tself.right = Some (right);\n\t\tself.width = Some (usize::checked_sub (\n\t\t\tright.try_into ().unwrap (),\n\t\t\tself.left.unwrap ().try_into ().unwrap (),\n\t\t).unwrap ());\n\t\tself\n\t}\n\t*/\n\n\tpub fn width \u003cNum\u003e (mut self, width: Num) -\u003e GridBuilder \u003cValue\u003e where Num: TryInto \u003cusize\u003e {\n\t\tlet width: usize = width.try_into ().map_err (|_| \"overflow\").unwrap ();\n\t\tif self.left.is_none () { self.left = Some (0) }\n\t\tself.right = Some (i64::checked_add (\n\t\t\tself.left.unwrap (),\n\t\t\twidth.try_into ().unwrap (),\n\t\t).unwrap ());\n\t\tself.width = Some (width);\n\t\tself\n\t}\n\n\tpub fn height \u003cNum\u003e (mut self, height: Num) -\u003e GridBuilder \u003cValue\u003e where Num: TryInto \u003cusize\u003e {\n\t\tlet height: usize = height.try_into ().map_err (|_| \"overflow\").unwrap ();\n\t\tif self.top.is_none () { self.top = Some (0) }\n\t\tself.bottom = Some (i64::checked_add (\n\t\t\tself.left.unwrap (),\n\t\t\theight.try_into ().unwrap (),\n\t\t).unwrap ());\n\t\tself.height = Some (height);\n\t\tself\n\t}\n\n\t/*\n\tpub fn bounded (mut self) -\u003e GridBuilder \u003cValue\u003e {\n\t\tif self.bounded.is_some () { panic! () }\n\t\tself.bounded = Some (true);\n\t\tself\n\t}\n\t*/\n\n\tpub fn unbounded (mut self) -\u003e GridBuilder \u003cValue\u003e {\n\t\tif self.bounded.is_some () { panic! () }\n\t\tself.bounded = Some (false);\n\t\tself\n\t}\n\n\tpub fn default (mut self, default: Value) -\u003e GridBuilder \u003cValue\u003e {\n\t\tif self.default.is_some () { panic! () }\n\t\tself.default = Some (default);\n\t\tself\n\t}\n\n\tpub fn build (self) -\u003e Grid \u003cValue\u003e {\n\t\tif self.top.is_none () { panic! () }\n\t\tif self.bottom.is_none () { panic! () }\n\t\tif self.left.is_none () { panic! () }\n\t\tif self.right.is_none () { panic! () }\n\t\tif self.default.is_none () { panic! () }\n\t\tif self.bounded.is_none () { panic! () }\n\t\tGrid {\n\t\t\ttop: self.top.unwrap (),\n\t\t\tbottom: self.bottom.unwrap (),\n\t\t\tleft: self.left.unwrap (),\n\t\t\tright: self.right.unwrap (),\n\t\t\twidth: self.width.unwrap (),\n\t\t\theight: self.height.unwrap (),\n\t\t\tdefault: self.default.clone ().unwrap (),\n\t\t\tbounded: self.bounded.unwrap (),\n\t\t\tdata: iter::repeat (self.default.unwrap ())\n\t\t\t\t.take (usize::checked_mul (self.width.unwrap (), self.height.unwrap ()).unwrap ())\n\t\t\t\t.collect (),\n\t\t}\n\t}\n\n}\n","traces":[{"line":65,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":80,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":81,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":83,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":89,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":93,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":99,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":101,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":102,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":107,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":108,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":113,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":207,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":208,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":209,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":210,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":211,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":212,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":213,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":214,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":218,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":219,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":220,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":221,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":222,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":223,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":224,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":225,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":236,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":237,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":238,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":239,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":242,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":243,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":244,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":245,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":248,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":249,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":250,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":251,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":252,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":253,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":254,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":256,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":257,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":258,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":259,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":260,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":261,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":262,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":263,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":264,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":63},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2019","aoc-2019-day-11-part-1","src","intcode.rs"],"content":"use std::collections::VecDeque;\nuse std::convert::TryFrom;\nuse std::convert::TryInto as _;\nuse std::iter;\n\npub struct Machine {\n\tmem: Mem,\n\tpos: i64,\n\trel: i64,\n\tinput_buffer: VecDeque \u003ci64\u003e,\n}\n\nimpl Machine {\n\n\tpub fn new (mem: Mem) -\u003e Machine {\n\t\tMachine {\n\t\t\tmem: mem,\n\t\t\tpos: 0,\n\t\t\trel: 0,\n\t\t\tinput_buffer: VecDeque::new (),\n\t\t}\n\t}\n\n\tpub fn with_input_buffer (mut self, input_buffer: VecDeque \u003ci64\u003e) -\u003e Machine {\n\t\tself.input_buffer = input_buffer;\n\t\tself\n\t}\n\n\tpub fn input_buffer (\u0026 mut self) -\u003e \u0026 mut VecDeque \u003ci64\u003e {\n\t\t\u0026 mut self.input_buffer\n\t}\n\n\tpub fn queue_input (\u0026 mut self, value: i64) {\n\t\tself.input_buffer.push_back (value);\n\t}\n\n\tpub fn run (\u0026 mut self) -\u003e RunResult {\n\t\tloop {\n\t\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().map_err (\n\t\t\t\t|error| format! (\"[pos={}] {}\", self.pos, error),\n\t\t\t).unwrap ();\n\t\t\tmatch opcode.instr {\n\t\t\t\tInstruction::Add =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 + param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Multiply =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 * param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Input =\u003e {\n\t\t\t\t\tlet value = self.get_input ();\n\t\t\t\t\tself.param_set (0, value);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::Output =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t\treturn RunResult::Output (value);\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfTrue =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value != 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfFalse =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value == 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::LessThan =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 \u003c param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Equals =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 == param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::AdjustRelBase =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.rel += value;\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::Halt =\u003e {\n\t\t\t\t\treturn RunResult::Halt;\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}\n\n\tfn get_input (\u0026 mut self) -\u003e i64 {\n\t\tif let Some (value) = self.input_buffer.pop_front () {\n\t\t\treturn value;\n\t\t} else {\n\t\t\tpanic! (\"No input\");\n\t\t}\n\t}\n\n\tfn param_get (\u0026 mut self, num: u8) -\u003e i64 {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_get (param),\n\t\t\tMode::Immediate =\u003e param,\n\t\t\tMode::Relative =\u003e self.mem_get (param + self.rel),\n\t\t}\n\t}\n\n\tfn param_set (\u0026 mut self, num: u8, value: i64) {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_set (param, value),\n\t\t\tMode::Immediate =\u003e panic! (),\n\t\t\tMode::Relative =\u003e self.mem_set (param + self.rel, value),\n\t\t}\n\t}\n\n\tfn mem_get (\u0026 mut self, addr: i64) -\u003e i64 {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize]\n\t}\n\n\tfn mem_set (\u0026 mut self, addr: i64, value: i64) {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize] = value;\n\t}\n\n\tfn mem_extend (\u0026 mut self, addr: i64) {\n\t\tif addr \u003c 0 || addr == i64::MAX { panic! (); }\n\t\tlet size = addr as usize + 1;\n\t\tif size \u003c self.mem.len () {\n\t\t\treturn;\n\t\t}\n\t\tself.mem.extend (iter::repeat (0).take (size - self.mem.len ()));\n\t}\n\n}\n\ntype Mem = Vec \u003ci64\u003e;\n\npub fn from_str (source: \u0026 str) -\u003e Mem {\n\tsource.split (',').map (\n\t\t|item_str| item_str.trim ().parse ().unwrap (),\n\t).collect ()\n}\n\npub enum RunResult {\n\tHalt,\n\tOutput (i64),\n}\n\n#[ derive (Clone, Copy) ]\nstruct Opcode {\n\tinstr: Instruction,\n\tmodes: [Mode; 3],\n}\n\nimpl TryFrom \u003ci64\u003e for Opcode {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cOpcode, String\u003e {\n\t\tOk (Opcode {\n\t\t\tinstr: (value % 100).try_into () ?,\n\t\t\tmodes: [\n\t\t\t\t((value / 100) % 10).into (),\n\t\t\t\t((value / 1000) % 10).into (),\n\t\t\t\t((value / 10000) % 10).into (),\n\t\t\t],\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Instruction {\n\tAdd,\n\tMultiply,\n\tInput,\n\tOutput,\n\tHalt,\n\tJumpIfTrue,\n\tJumpIfFalse,\n\tLessThan,\n\tEquals,\n\tAdjustRelBase,\n}\n\nimpl TryFrom \u003ci64\u003e for Instruction {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cInstruction, String\u003e {\n\t\tOk (match value {\n\t\t\t1 =\u003e Instruction::Add,\n\t\t\t2 =\u003e Instruction::Multiply,\n\t\t\t3 =\u003e Instruction::Input,\n\t\t\t4 =\u003e Instruction::Output,\n\t\t\t5 =\u003e Instruction::JumpIfTrue,\n\t\t\t6 =\u003e Instruction::JumpIfFalse,\n\t\t\t7 =\u003e Instruction::LessThan,\n\t\t\t8 =\u003e Instruction::Equals,\n\t\t\t9 =\u003e Instruction::AdjustRelBase,\n\t\t\t99 =\u003e Instruction::Halt,\n\t\t\t_ =\u003e return Err (format! (\"Invalid instruction: {}\", value)),\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Mode { Position, Immediate, Relative }\n\nimpl From \u003ci64\u003e for Mode {\n\n\tfn from (value: i64) -\u003e Mode {\n\t\tmatch value {\n\t\t\t0 =\u003e Mode::Position,\n\t\t\t1 =\u003e Mode::Immediate,\n\t\t\t2 =\u003e Mode::Relative,\n\t\t\t_ =\u003e panic! (\"Invalid mode: {}\", value),\n\t\t}\n\t}\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2019","aoc-2019-day-11-part-2","src","intcode.rs"],"content":"use std::collections::VecDeque;\nuse std::convert::TryFrom;\nuse std::convert::TryInto as _;\nuse std::iter;\n\npub struct Machine {\n\tmem: Mem,\n\tpos: i64,\n\trel: i64,\n\tinput_buffer: VecDeque \u003ci64\u003e,\n}\n\nimpl Machine {\n\n\tpub fn new (mem: Mem) -\u003e Machine {\n\t\tMachine {\n\t\t\tmem: mem,\n\t\t\tpos: 0,\n\t\t\trel: 0,\n\t\t\tinput_buffer: VecDeque::new (),\n\t\t}\n\t}\n\n\tpub fn with_input_buffer (mut self, input_buffer: VecDeque \u003ci64\u003e) -\u003e Machine {\n\t\tself.input_buffer = input_buffer;\n\t\tself\n\t}\n\n\tpub fn input_buffer (\u0026 mut self) -\u003e \u0026 mut VecDeque \u003ci64\u003e {\n\t\t\u0026 mut self.input_buffer\n\t}\n\n\tpub fn queue_input (\u0026 mut self, value: i64) {\n\t\tself.input_buffer.push_back (value);\n\t}\n\n\tpub fn run (\u0026 mut self) -\u003e RunResult {\n\t\tloop {\n\t\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().map_err (\n\t\t\t\t|error| format! (\"[pos={}] {}\", self.pos, error),\n\t\t\t).unwrap ();\n\t\t\tmatch opcode.instr {\n\t\t\t\tInstruction::Add =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 + param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Multiply =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 * param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Input =\u003e {\n\t\t\t\t\tlet value = self.get_input ();\n\t\t\t\t\tself.param_set (0, value);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::Output =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t\treturn RunResult::Output (value);\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfTrue =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value != 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfFalse =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value == 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::LessThan =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 \u003c param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Equals =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 == param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::AdjustRelBase =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.rel += value;\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::Halt =\u003e {\n\t\t\t\t\treturn RunResult::Halt;\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}\n\n\tfn get_input (\u0026 mut self) -\u003e i64 {\n\t\tif let Some (value) = self.input_buffer.pop_front () {\n\t\t\treturn value;\n\t\t} else {\n\t\t\tpanic! (\"No input\");\n\t\t}\n\t}\n\n\tfn param_get (\u0026 mut self, num: u8) -\u003e i64 {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_get (param),\n\t\t\tMode::Immediate =\u003e param,\n\t\t\tMode::Relative =\u003e self.mem_get (param + self.rel),\n\t\t}\n\t}\n\n\tfn param_set (\u0026 mut self, num: u8, value: i64) {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_set (param, value),\n\t\t\tMode::Immediate =\u003e panic! (),\n\t\t\tMode::Relative =\u003e self.mem_set (param + self.rel, value),\n\t\t}\n\t}\n\n\tfn mem_get (\u0026 mut self, addr: i64) -\u003e i64 {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize]\n\t}\n\n\tfn mem_set (\u0026 mut self, addr: i64, value: i64) {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize] = value;\n\t}\n\n\tfn mem_extend (\u0026 mut self, addr: i64) {\n\t\tif addr \u003c 0 || addr == i64::MAX { panic! (); }\n\t\tlet size = addr as usize + 1;\n\t\tif size \u003c self.mem.len () {\n\t\t\treturn;\n\t\t}\n\t\tself.mem.extend (iter::repeat (0).take (size - self.mem.len ()));\n\t}\n\n}\n\ntype Mem = Vec \u003ci64\u003e;\n\npub fn from_str (source: \u0026 str) -\u003e Mem {\n\tsource.split (',').map (\n\t\t|item_str| item_str.trim ().parse ().unwrap (),\n\t).collect ()\n}\n\npub enum RunResult {\n\tHalt,\n\tOutput (i64),\n}\n\n#[ derive (Clone, Copy) ]\nstruct Opcode {\n\tinstr: Instruction,\n\tmodes: [Mode; 3],\n}\n\nimpl TryFrom \u003ci64\u003e for Opcode {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cOpcode, String\u003e {\n\t\tOk (Opcode {\n\t\t\tinstr: (value % 100).try_into () ?,\n\t\t\tmodes: [\n\t\t\t\t((value / 100) % 10).into (),\n\t\t\t\t((value / 1000) % 10).into (),\n\t\t\t\t((value / 10000) % 10).into (),\n\t\t\t],\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Instruction {\n\tAdd,\n\tMultiply,\n\tInput,\n\tOutput,\n\tHalt,\n\tJumpIfTrue,\n\tJumpIfFalse,\n\tLessThan,\n\tEquals,\n\tAdjustRelBase,\n}\n\nimpl TryFrom \u003ci64\u003e for Instruction {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cInstruction, String\u003e {\n\t\tOk (match value {\n\t\t\t1 =\u003e Instruction::Add,\n\t\t\t2 =\u003e Instruction::Multiply,\n\t\t\t3 =\u003e Instruction::Input,\n\t\t\t4 =\u003e Instruction::Output,\n\t\t\t5 =\u003e Instruction::JumpIfTrue,\n\t\t\t6 =\u003e Instruction::JumpIfFalse,\n\t\t\t7 =\u003e Instruction::LessThan,\n\t\t\t8 =\u003e Instruction::Equals,\n\t\t\t9 =\u003e Instruction::AdjustRelBase,\n\t\t\t99 =\u003e Instruction::Halt,\n\t\t\t_ =\u003e return Err (format! (\"Invalid instruction: {}\", value)),\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Mode { Position, Immediate, Relative }\n\nimpl From \u003ci64\u003e for Mode {\n\n\tfn from (value: i64) -\u003e Mode {\n\t\tmatch value {\n\t\t\t0 =\u003e Mode::Position,\n\t\t\t1 =\u003e Mode::Immediate,\n\t\t\t2 =\u003e Mode::Relative,\n\t\t\t_ =\u003e panic! (\"Invalid mode: {}\", value),\n\t\t}\n\t}\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2019","aoc-2019-day-13-part-1","src","intcode.rs"],"content":"use std::collections::VecDeque;\nuse std::convert::TryFrom;\nuse std::convert::TryInto as _;\nuse std::iter;\n\npub struct Machine {\n\tmem: Mem,\n\tpos: i64,\n\trel: i64,\n\tinput_buffer: VecDeque \u003ci64\u003e,\n}\n\nimpl Machine {\n\n\tpub fn new (mem: Mem) -\u003e Machine {\n\t\tMachine {\n\t\t\tmem: mem,\n\t\t\tpos: 0,\n\t\t\trel: 0,\n\t\t\tinput_buffer: VecDeque::new (),\n\t\t}\n\t}\n\n\tpub fn with_input_buffer (mut self, input_buffer: VecDeque \u003ci64\u003e) -\u003e Machine {\n\t\tself.input_buffer = input_buffer;\n\t\tself\n\t}\n\n\tpub fn input_buffer (\u0026 mut self) -\u003e \u0026 mut VecDeque \u003ci64\u003e {\n\t\t\u0026 mut self.input_buffer\n\t}\n\n\tpub fn queue_input (\u0026 mut self, value: i64) {\n\t\tself.input_buffer.push_back (value);\n\t}\n\n\tpub fn run (\u0026 mut self) -\u003e RunResult {\n\t\tloop {\n\t\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().map_err (\n\t\t\t\t|error| format! (\"[pos={}] {}\", self.pos, error),\n\t\t\t).unwrap ();\n\t\t\tmatch opcode.instr {\n\t\t\t\tInstruction::Add =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 + param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Multiply =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 * param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Input =\u003e {\n\t\t\t\t\tlet value = self.get_input ();\n\t\t\t\t\tself.param_set (0, value);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::Output =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t\treturn RunResult::Output (value);\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfTrue =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value != 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfFalse =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value == 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::LessThan =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 \u003c param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Equals =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 == param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::AdjustRelBase =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.rel += value;\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::Halt =\u003e {\n\t\t\t\t\treturn RunResult::Halt;\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}\n\n\tpub fn next (\u0026 mut self) -\u003e Option \u003ci64\u003e {\n\t\tmatch self.run () {\n\t\t\tRunResult::Output (value) =\u003e Some (value),\n\t\t\tRunResult::Halt =\u003e None,\n\t\t}\n\t}\n\n\tfn get_input (\u0026 mut self) -\u003e i64 {\n\t\tif let Some (value) = self.input_buffer.pop_front () {\n\t\t\treturn value;\n\t\t} else {\n\t\t\tpanic! (\"No input\");\n\t\t}\n\t}\n\n\tfn param_get (\u0026 mut self, num: u8) -\u003e i64 {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_get (param),\n\t\t\tMode::Immediate =\u003e param,\n\t\t\tMode::Relative =\u003e self.mem_get (param + self.rel),\n\t\t}\n\t}\n\n\tfn param_set (\u0026 mut self, num: u8, value: i64) {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_set (param, value),\n\t\t\tMode::Immediate =\u003e panic! (),\n\t\t\tMode::Relative =\u003e self.mem_set (param + self.rel, value),\n\t\t}\n\t}\n\n\tfn mem_get (\u0026 mut self, addr: i64) -\u003e i64 {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize]\n\t}\n\n\tfn mem_set (\u0026 mut self, addr: i64, value: i64) {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize] = value;\n\t}\n\n\tfn mem_extend (\u0026 mut self, addr: i64) {\n\t\tif addr \u003c 0 || addr == i64::MAX { panic! (); }\n\t\tlet size = addr as usize + 1;\n\t\tif size \u003c self.mem.len () {\n\t\t\treturn;\n\t\t}\n\t\tself.mem.extend (iter::repeat (0).take (size - self.mem.len ()));\n\t}\n\n}\n\ntype Mem = Vec \u003ci64\u003e;\n\npub fn from_str (source: \u0026 str) -\u003e Mem {\n\tsource.split (',').map (\n\t\t|item_str| item_str.trim ().parse ().unwrap (),\n\t).collect ()\n}\n\npub enum RunResult {\n\tHalt,\n\tOutput (i64),\n}\n\n#[ derive (Clone, Copy) ]\nstruct Opcode {\n\tinstr: Instruction,\n\tmodes: [Mode; 3],\n}\n\nimpl TryFrom \u003ci64\u003e for Opcode {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cOpcode, String\u003e {\n\t\tOk (Opcode {\n\t\t\tinstr: (value % 100).try_into () ?,\n\t\t\tmodes: [\n\t\t\t\t((value / 100) % 10).into (),\n\t\t\t\t((value / 1000) % 10).into (),\n\t\t\t\t((value / 10000) % 10).into (),\n\t\t\t],\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Instruction {\n\tAdd,\n\tMultiply,\n\tInput,\n\tOutput,\n\tHalt,\n\tJumpIfTrue,\n\tJumpIfFalse,\n\tLessThan,\n\tEquals,\n\tAdjustRelBase,\n}\n\nimpl TryFrom \u003ci64\u003e for Instruction {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cInstruction, String\u003e {\n\t\tOk (match value {\n\t\t\t1 =\u003e Instruction::Add,\n\t\t\t2 =\u003e Instruction::Multiply,\n\t\t\t3 =\u003e Instruction::Input,\n\t\t\t4 =\u003e Instruction::Output,\n\t\t\t5 =\u003e Instruction::JumpIfTrue,\n\t\t\t6 =\u003e Instruction::JumpIfFalse,\n\t\t\t7 =\u003e Instruction::LessThan,\n\t\t\t8 =\u003e Instruction::Equals,\n\t\t\t9 =\u003e Instruction::AdjustRelBase,\n\t\t\t99 =\u003e Instruction::Halt,\n\t\t\t_ =\u003e return Err (format! (\"Invalid instruction: {}\", value)),\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Mode { Position, Immediate, Relative }\n\nimpl From \u003ci64\u003e for Mode {\n\n\tfn from (value: i64) -\u003e Mode {\n\t\tmatch value {\n\t\t\t0 =\u003e Mode::Position,\n\t\t\t1 =\u003e Mode::Immediate,\n\t\t\t2 =\u003e Mode::Relative,\n\t\t\t_ =\u003e panic! (\"Invalid mode: {}\", value),\n\t\t}\n\t}\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2019","aoc-2019-day-13-part-2","src","intcode.rs"],"content":"use std::collections::VecDeque;\nuse std::convert::TryFrom;\nuse std::convert::TryInto as _;\nuse std::iter;\n\npub struct Machine {\n\tmem: Mem,\n\tpos: i64,\n\trel: i64,\n\tinput_buffer: VecDeque \u003ci64\u003e,\n}\n\nimpl Machine {\n\n\tpub fn new (mem: Mem) -\u003e Machine {\n\t\tMachine {\n\t\t\tmem: mem,\n\t\t\tpos: 0,\n\t\t\trel: 0,\n\t\t\tinput_buffer: VecDeque::new (),\n\t\t}\n\t}\n\n\tpub fn queue_input (\u0026 mut self, value: i64) {\n\t\tself.input_buffer.push_back (value);\n\t}\n\n\tpub fn run (\u0026 mut self) -\u003e RunResult {\n\t\tloop {\n\t\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().map_err (\n\t\t\t\t|error| format! (\"[pos={}] {}\", self.pos, error),\n\t\t\t).unwrap ();\n\t\t\tmatch opcode.instr {\n\t\t\t\tInstruction::Add =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 + param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Multiply =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 * param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Input =\u003e {\n\t\t\t\t\tif let Some (value) = self.input_buffer.pop_front () {\n\t\t\t\t\t\tself.param_set (0, value);\n\t\t\t\t\t\tself.pos += 2;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn RunResult::Input;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::Output =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t\treturn RunResult::Output (value);\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfTrue =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value != 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfFalse =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value == 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::LessThan =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 \u003c param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Equals =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 == param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::AdjustRelBase =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.rel += value;\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::Halt =\u003e {\n\t\t\t\t\treturn RunResult::Halt;\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}\n\n\tfn param_get (\u0026 mut self, num: u8) -\u003e i64 {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_get (param),\n\t\t\tMode::Immediate =\u003e param,\n\t\t\tMode::Relative =\u003e self.mem_get (param + self.rel),\n\t\t}\n\t}\n\n\tfn param_set (\u0026 mut self, num: u8, value: i64) {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_set (param, value),\n\t\t\tMode::Immediate =\u003e panic! (),\n\t\t\tMode::Relative =\u003e self.mem_set (param + self.rel, value),\n\t\t}\n\t}\n\n\tfn mem_get (\u0026 mut self, addr: i64) -\u003e i64 {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize]\n\t}\n\n\tfn mem_set (\u0026 mut self, addr: i64, value: i64) {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize] = value;\n\t}\n\n\tfn mem_extend (\u0026 mut self, addr: i64) {\n\t\tif addr \u003c 0 || addr == i64::MAX { panic! (); }\n\t\tlet size = addr as usize + 1;\n\t\tif size \u003c self.mem.len () {\n\t\t\treturn;\n\t\t}\n\t\tself.mem.extend (iter::repeat (0).take (size - self.mem.len ()));\n\t}\n\n}\n\ntype Mem = Vec \u003ci64\u003e;\n\npub fn from_str (source: \u0026 str) -\u003e Mem {\n\tsource.split (',').map (\n\t\t|item_str| item_str.trim ().parse ().unwrap (),\n\t).collect ()\n}\n\npub enum RunResult {\n\tHalt,\n\tOutput (i64),\n\tInput,\n}\n\n#[ derive (Clone, Copy) ]\nstruct Opcode {\n\tinstr: Instruction,\n\tmodes: [Mode; 3],\n}\n\nimpl TryFrom \u003ci64\u003e for Opcode {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cOpcode, String\u003e {\n\t\tOk (Opcode {\n\t\t\tinstr: (value % 100).try_into () ?,\n\t\t\tmodes: [\n\t\t\t\t((value / 100) % 10).into (),\n\t\t\t\t((value / 1000) % 10).into (),\n\t\t\t\t((value / 10000) % 10).into (),\n\t\t\t],\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Instruction {\n\tAdd,\n\tMultiply,\n\tInput,\n\tOutput,\n\tHalt,\n\tJumpIfTrue,\n\tJumpIfFalse,\n\tLessThan,\n\tEquals,\n\tAdjustRelBase,\n}\n\nimpl TryFrom \u003ci64\u003e for Instruction {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cInstruction, String\u003e {\n\t\tOk (match value {\n\t\t\t1 =\u003e Instruction::Add,\n\t\t\t2 =\u003e Instruction::Multiply,\n\t\t\t3 =\u003e Instruction::Input,\n\t\t\t4 =\u003e Instruction::Output,\n\t\t\t5 =\u003e Instruction::JumpIfTrue,\n\t\t\t6 =\u003e Instruction::JumpIfFalse,\n\t\t\t7 =\u003e Instruction::LessThan,\n\t\t\t8 =\u003e Instruction::Equals,\n\t\t\t9 =\u003e Instruction::AdjustRelBase,\n\t\t\t99 =\u003e Instruction::Halt,\n\t\t\t_ =\u003e return Err (format! (\"Invalid instruction: {}\", value)),\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Mode { Position, Immediate, Relative }\n\nimpl From \u003ci64\u003e for Mode {\n\n\tfn from (value: i64) -\u003e Mode {\n\t\tmatch value {\n\t\t\t0 =\u003e Mode::Position,\n\t\t\t1 =\u003e Mode::Immediate,\n\t\t\t2 =\u003e Mode::Relative,\n\t\t\t_ =\u003e panic! (\"Invalid mode: {}\", value),\n\t\t}\n\t}\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2019","aoc-2019-day-15-part-1","src","intcode.rs"],"content":"use std::collections::VecDeque;\nuse std::convert::TryFrom;\nuse std::convert::TryInto as _;\nuse std::iter;\n\npub struct Machine {\n\tmem: Mem,\n\tpos: i64,\n\trel: i64,\n\tinput_buffer: VecDeque \u003ci64\u003e,\n}\n\nimpl Machine {\n\n\tpub fn new (mem: Mem) -\u003e Machine {\n\t\tMachine {\n\t\t\tmem: mem,\n\t\t\tpos: 0,\n\t\t\trel: 0,\n\t\t\tinput_buffer: VecDeque::new (),\n\t\t}\n\t}\n\n\tpub fn queue_input (\u0026 mut self, value: i64) {\n\t\tself.input_buffer.push_back (value);\n\t}\n\n\tpub fn run (\u0026 mut self) -\u003e RunResult {\n\t\tloop {\n\t\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().map_err (\n\t\t\t\t|error| format! (\"[pos={}] {}\", self.pos, error),\n\t\t\t).unwrap ();\n\t\t\tmatch opcode.instr {\n\t\t\t\tInstruction::Add =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 + param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Multiply =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 * param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Input =\u003e {\n\t\t\t\t\tif let Some (value) = self.input_buffer.pop_front () {\n\t\t\t\t\t\tself.param_set (0, value);\n\t\t\t\t\t\tself.pos += 2;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn RunResult::Input;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::Output =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t\treturn RunResult::Output (value);\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfTrue =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value != 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfFalse =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value == 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::LessThan =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 \u003c param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Equals =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 == param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::AdjustRelBase =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.rel += value;\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::Halt =\u003e {\n\t\t\t\t\treturn RunResult::Halt;\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}\n\n\tfn param_get (\u0026 mut self, num: u8) -\u003e i64 {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_get (param),\n\t\t\tMode::Immediate =\u003e param,\n\t\t\tMode::Relative =\u003e self.mem_get (param + self.rel),\n\t\t}\n\t}\n\n\tfn param_set (\u0026 mut self, num: u8, value: i64) {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_set (param, value),\n\t\t\tMode::Immediate =\u003e panic! (),\n\t\t\tMode::Relative =\u003e self.mem_set (param + self.rel, value),\n\t\t}\n\t}\n\n\tfn mem_get (\u0026 mut self, addr: i64) -\u003e i64 {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize]\n\t}\n\n\tfn mem_set (\u0026 mut self, addr: i64, value: i64) {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize] = value;\n\t}\n\n\tfn mem_extend (\u0026 mut self, addr: i64) {\n\t\tif addr \u003c 0 || addr == i64::MAX { panic! (); }\n\t\tlet size = addr as usize + 1;\n\t\tif size \u003c self.mem.len () {\n\t\t\treturn;\n\t\t}\n\t\tself.mem.extend (iter::repeat (0).take (size - self.mem.len ()));\n\t}\n\n}\n\npub type Mem = Vec \u003ci64\u003e;\n\npub fn from_str (source: \u0026 str) -\u003e Mem {\n\tsource.split (',').map (\n\t\t|item_str| item_str.trim ().parse ().unwrap (),\n\t).collect ()\n}\n\npub enum RunResult {\n\tHalt,\n\tOutput (i64),\n\tInput,\n}\n\n#[ derive (Clone, Copy) ]\nstruct Opcode {\n\tinstr: Instruction,\n\tmodes: [Mode; 3],\n}\n\nimpl TryFrom \u003ci64\u003e for Opcode {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cOpcode, String\u003e {\n\t\tOk (Opcode {\n\t\t\tinstr: (value % 100).try_into () ?,\n\t\t\tmodes: [\n\t\t\t\t((value / 100) % 10).into (),\n\t\t\t\t((value / 1000) % 10).into (),\n\t\t\t\t((value / 10000) % 10).into (),\n\t\t\t],\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Instruction {\n\tAdd,\n\tMultiply,\n\tInput,\n\tOutput,\n\tHalt,\n\tJumpIfTrue,\n\tJumpIfFalse,\n\tLessThan,\n\tEquals,\n\tAdjustRelBase,\n}\n\nimpl TryFrom \u003ci64\u003e for Instruction {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cInstruction, String\u003e {\n\t\tOk (match value {\n\t\t\t1 =\u003e Instruction::Add,\n\t\t\t2 =\u003e Instruction::Multiply,\n\t\t\t3 =\u003e Instruction::Input,\n\t\t\t4 =\u003e Instruction::Output,\n\t\t\t5 =\u003e Instruction::JumpIfTrue,\n\t\t\t6 =\u003e Instruction::JumpIfFalse,\n\t\t\t7 =\u003e Instruction::LessThan,\n\t\t\t8 =\u003e Instruction::Equals,\n\t\t\t9 =\u003e Instruction::AdjustRelBase,\n\t\t\t99 =\u003e Instruction::Halt,\n\t\t\t_ =\u003e return Err (format! (\"Invalid instruction: {}\", value)),\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Mode { Position, Immediate, Relative }\n\nimpl From \u003ci64\u003e for Mode {\n\n\tfn from (value: i64) -\u003e Mode {\n\t\tmatch value {\n\t\t\t0 =\u003e Mode::Position,\n\t\t\t1 =\u003e Mode::Immediate,\n\t\t\t2 =\u003e Mode::Relative,\n\t\t\t_ =\u003e panic! (\"Invalid mode: {}\", value),\n\t\t}\n\t}\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2019","aoc-2019-day-15-part-2","src","intcode.rs"],"content":"use std::collections::VecDeque;\nuse std::convert::TryFrom;\nuse std::convert::TryInto as _;\nuse std::iter;\n\npub struct Machine {\n\tmem: Mem,\n\tpos: i64,\n\trel: i64,\n\tinput_buffer: VecDeque \u003ci64\u003e,\n}\n\nimpl Machine {\n\n\tpub fn new (mem: Mem) -\u003e Machine {\n\t\tMachine {\n\t\t\tmem: mem,\n\t\t\tpos: 0,\n\t\t\trel: 0,\n\t\t\tinput_buffer: VecDeque::new (),\n\t\t}\n\t}\n\n\tpub fn queue_input (\u0026 mut self, value: i64) {\n\t\tself.input_buffer.push_back (value);\n\t}\n\n\tpub fn run (\u0026 mut self) -\u003e RunResult {\n\t\tloop {\n\t\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().map_err (\n\t\t\t\t|error| format! (\"[pos={}] {}\", self.pos, error),\n\t\t\t).unwrap ();\n\t\t\tmatch opcode.instr {\n\t\t\t\tInstruction::Add =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 + param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Multiply =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 * param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Input =\u003e {\n\t\t\t\t\tif let Some (value) = self.input_buffer.pop_front () {\n\t\t\t\t\t\tself.param_set (0, value);\n\t\t\t\t\t\tself.pos += 2;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn RunResult::Input;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::Output =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t\treturn RunResult::Output (value);\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfTrue =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value != 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfFalse =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value == 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::LessThan =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 \u003c param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Equals =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 == param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::AdjustRelBase =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.rel += value;\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::Halt =\u003e {\n\t\t\t\t\treturn RunResult::Halt;\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}\n\n\tfn param_get (\u0026 mut self, num: u8) -\u003e i64 {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_get (param),\n\t\t\tMode::Immediate =\u003e param,\n\t\t\tMode::Relative =\u003e self.mem_get (param + self.rel),\n\t\t}\n\t}\n\n\tfn param_set (\u0026 mut self, num: u8, value: i64) {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_set (param, value),\n\t\t\tMode::Immediate =\u003e panic! (),\n\t\t\tMode::Relative =\u003e self.mem_set (param + self.rel, value),\n\t\t}\n\t}\n\n\tfn mem_get (\u0026 mut self, addr: i64) -\u003e i64 {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize]\n\t}\n\n\tfn mem_set (\u0026 mut self, addr: i64, value: i64) {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize] = value;\n\t}\n\n\tfn mem_extend (\u0026 mut self, addr: i64) {\n\t\tif addr \u003c 0 || addr == i64::MAX { panic! (); }\n\t\tlet size = addr as usize + 1;\n\t\tif size \u003c self.mem.len () {\n\t\t\treturn;\n\t\t}\n\t\tself.mem.extend (iter::repeat (0).take (size - self.mem.len ()));\n\t}\n\n}\n\npub type Mem = Vec \u003ci64\u003e;\n\npub fn from_str (source: \u0026 str) -\u003e Mem {\n\tsource.split (',').map (\n\t\t|item_str| item_str.trim ().parse ().unwrap (),\n\t).collect ()\n}\n\npub enum RunResult {\n\tHalt,\n\tOutput (i64),\n\tInput,\n}\n\n#[ derive (Clone, Copy) ]\nstruct Opcode {\n\tinstr: Instruction,\n\tmodes: [Mode; 3],\n}\n\nimpl TryFrom \u003ci64\u003e for Opcode {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cOpcode, String\u003e {\n\t\tOk (Opcode {\n\t\t\tinstr: (value % 100).try_into () ?,\n\t\t\tmodes: [\n\t\t\t\t((value / 100) % 10).into (),\n\t\t\t\t((value / 1000) % 10).into (),\n\t\t\t\t((value / 10000) % 10).into (),\n\t\t\t],\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Instruction {\n\tAdd,\n\tMultiply,\n\tInput,\n\tOutput,\n\tHalt,\n\tJumpIfTrue,\n\tJumpIfFalse,\n\tLessThan,\n\tEquals,\n\tAdjustRelBase,\n}\n\nimpl TryFrom \u003ci64\u003e for Instruction {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cInstruction, String\u003e {\n\t\tOk (match value {\n\t\t\t1 =\u003e Instruction::Add,\n\t\t\t2 =\u003e Instruction::Multiply,\n\t\t\t3 =\u003e Instruction::Input,\n\t\t\t4 =\u003e Instruction::Output,\n\t\t\t5 =\u003e Instruction::JumpIfTrue,\n\t\t\t6 =\u003e Instruction::JumpIfFalse,\n\t\t\t7 =\u003e Instruction::LessThan,\n\t\t\t8 =\u003e Instruction::Equals,\n\t\t\t9 =\u003e Instruction::AdjustRelBase,\n\t\t\t99 =\u003e Instruction::Halt,\n\t\t\t_ =\u003e return Err (format! (\"Invalid instruction: {}\", value)),\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Mode { Position, Immediate, Relative }\n\nimpl From \u003ci64\u003e for Mode {\n\n\tfn from (value: i64) -\u003e Mode {\n\t\tmatch value {\n\t\t\t0 =\u003e Mode::Position,\n\t\t\t1 =\u003e Mode::Immediate,\n\t\t\t2 =\u003e Mode::Relative,\n\t\t\t_ =\u003e panic! (\"Invalid mode: {}\", value),\n\t\t}\n\t}\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2019","aoc-2019-day-17-part-1","src","intcode.rs"],"content":"use std::collections::VecDeque;\nuse std::convert::TryFrom;\nuse std::convert::TryInto as _;\nuse std::iter;\n\npub struct Machine {\n\tmem: Mem,\n\tpos: i64,\n\trel: i64,\n\tinput_buffer: VecDeque \u003ci64\u003e,\n}\n\nimpl Machine {\n\n\tpub fn new (mem: Mem) -\u003e Machine {\n\t\tMachine {\n\t\t\tmem: mem,\n\t\t\tpos: 0,\n\t\t\trel: 0,\n\t\t\tinput_buffer: VecDeque::new (),\n\t\t}\n\t}\n\n\tpub fn queue_input (\u0026 mut self, value: i64) {\n\t\tself.input_buffer.push_back (value);\n\t}\n\n\tpub fn run (\u0026 mut self) -\u003e RunResult {\n\t\tloop {\n\t\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().map_err (\n\t\t\t\t|error| format! (\"[pos={}] {}\", self.pos, error),\n\t\t\t).unwrap ();\n\t\t\tmatch opcode.instr {\n\t\t\t\tInstruction::Add =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 + param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Multiply =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 * param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Input =\u003e {\n\t\t\t\t\tif let Some (value) = self.input_buffer.pop_front () {\n\t\t\t\t\t\tself.param_set (0, value);\n\t\t\t\t\t\tself.pos += 2;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn RunResult::Input;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::Output =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t\treturn RunResult::Output (value);\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfTrue =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value != 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfFalse =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value == 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::LessThan =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 \u003c param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Equals =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 == param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::AdjustRelBase =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.rel += value;\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::Halt =\u003e {\n\t\t\t\t\treturn RunResult::Halt;\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}\n\n\tfn param_get (\u0026 mut self, num: u8) -\u003e i64 {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_get (param),\n\t\t\tMode::Immediate =\u003e param,\n\t\t\tMode::Relative =\u003e self.mem_get (param + self.rel),\n\t\t}\n\t}\n\n\tfn param_set (\u0026 mut self, num: u8, value: i64) {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_set (param, value),\n\t\t\tMode::Immediate =\u003e panic! (),\n\t\t\tMode::Relative =\u003e self.mem_set (param + self.rel, value),\n\t\t}\n\t}\n\n\tfn mem_get (\u0026 mut self, addr: i64) -\u003e i64 {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize]\n\t}\n\n\tfn mem_set (\u0026 mut self, addr: i64, value: i64) {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize] = value;\n\t}\n\n\tfn mem_extend (\u0026 mut self, addr: i64) {\n\t\tif addr \u003c 0 || addr == i64::MAX { panic! (); }\n\t\tlet size = addr as usize + 1;\n\t\tif size \u003c self.mem.len () {\n\t\t\treturn;\n\t\t}\n\t\tself.mem.extend (iter::repeat (0).take (size - self.mem.len ()));\n\t}\n\n}\n\npub type Mem = Vec \u003ci64\u003e;\n\npub fn from_str (source: \u0026 str) -\u003e Mem {\n\tsource.split (',').map (\n\t\t|item_str| item_str.trim ().parse ().unwrap (),\n\t).collect ()\n}\n\npub enum RunResult {\n\tHalt,\n\tOutput (i64),\n\tInput,\n}\n\n#[ derive (Clone, Copy) ]\nstruct Opcode {\n\tinstr: Instruction,\n\tmodes: [Mode; 3],\n}\n\nimpl TryFrom \u003ci64\u003e for Opcode {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cOpcode, String\u003e {\n\t\tOk (Opcode {\n\t\t\tinstr: (value % 100).try_into () ?,\n\t\t\tmodes: [\n\t\t\t\t((value / 100) % 10).into (),\n\t\t\t\t((value / 1000) % 10).into (),\n\t\t\t\t((value / 10000) % 10).into (),\n\t\t\t],\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Instruction {\n\tAdd,\n\tMultiply,\n\tInput,\n\tOutput,\n\tHalt,\n\tJumpIfTrue,\n\tJumpIfFalse,\n\tLessThan,\n\tEquals,\n\tAdjustRelBase,\n}\n\nimpl TryFrom \u003ci64\u003e for Instruction {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cInstruction, String\u003e {\n\t\tOk (match value {\n\t\t\t1 =\u003e Instruction::Add,\n\t\t\t2 =\u003e Instruction::Multiply,\n\t\t\t3 =\u003e Instruction::Input,\n\t\t\t4 =\u003e Instruction::Output,\n\t\t\t5 =\u003e Instruction::JumpIfTrue,\n\t\t\t6 =\u003e Instruction::JumpIfFalse,\n\t\t\t7 =\u003e Instruction::LessThan,\n\t\t\t8 =\u003e Instruction::Equals,\n\t\t\t9 =\u003e Instruction::AdjustRelBase,\n\t\t\t99 =\u003e Instruction::Halt,\n\t\t\t_ =\u003e return Err (format! (\"Invalid instruction: {}\", value)),\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Mode { Position, Immediate, Relative }\n\nimpl From \u003ci64\u003e for Mode {\n\n\tfn from (value: i64) -\u003e Mode {\n\t\tmatch value {\n\t\t\t0 =\u003e Mode::Position,\n\t\t\t1 =\u003e Mode::Immediate,\n\t\t\t2 =\u003e Mode::Relative,\n\t\t\t_ =\u003e panic! (\"Invalid mode: {}\", value),\n\t\t}\n\t}\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2019","aoc-2019-day-17-part-2","src","intcode.rs"],"content":"use std::collections::VecDeque;\nuse std::convert::TryFrom;\nuse std::convert::TryInto as _;\nuse std::iter;\n\npub struct Machine {\n\tmem: Mem,\n\tpos: i64,\n\trel: i64,\n\tinput_buffer: VecDeque \u003ci64\u003e,\n}\n\nimpl Machine {\n\n\tpub fn new (mem: Mem) -\u003e Machine {\n\t\tMachine {\n\t\t\tmem: mem,\n\t\t\tpos: 0,\n\t\t\trel: 0,\n\t\t\tinput_buffer: VecDeque::new (),\n\t\t}\n\t}\n\n\tpub fn input (\u0026 mut self, value: i64) {\n\t\tself.input_buffer.push_back (value);\n\t}\n\n\tpub fn input_str (\u0026 mut self, value: \u0026 str) {\n\t\tfor ch in value.chars () {\n\t\t\tself.input_buffer.push_back (ch as i64);\n\t\t}\n\t}\n\n\tpub fn run (\u0026 mut self) -\u003e RunResult {\n\t\tloop {\n\t\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().map_err (\n\t\t\t\t|error| format! (\"[pos={}] {}\", self.pos, error),\n\t\t\t).unwrap ();\n\t\t\tmatch opcode.instr {\n\t\t\t\tInstruction::Add =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 + param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Multiply =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 * param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Input =\u003e {\n\t\t\t\t\tif let Some (value) = self.input_buffer.pop_front () {\n\t\t\t\t\t\tself.param_set (0, value);\n\t\t\t\t\t\tself.pos += 2;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn RunResult::Input;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::Output =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t\treturn RunResult::Output (value);\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfTrue =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value != 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfFalse =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value == 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::LessThan =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 \u003c param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Equals =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 == param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::AdjustRelBase =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.rel += value;\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::Halt =\u003e {\n\t\t\t\t\treturn RunResult::Halt;\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}\n\n\tfn param_get (\u0026 mut self, num: u8) -\u003e i64 {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_get (param),\n\t\t\tMode::Immediate =\u003e param,\n\t\t\tMode::Relative =\u003e self.mem_get (param + self.rel),\n\t\t}\n\t}\n\n\tfn param_set (\u0026 mut self, num: u8, value: i64) {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_set (param, value),\n\t\t\tMode::Immediate =\u003e panic! (),\n\t\t\tMode::Relative =\u003e self.mem_set (param + self.rel, value),\n\t\t}\n\t}\n\n\tfn mem_get (\u0026 mut self, addr: i64) -\u003e i64 {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize]\n\t}\n\n\tfn mem_set (\u0026 mut self, addr: i64, value: i64) {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize] = value;\n\t}\n\n\tfn mem_extend (\u0026 mut self, addr: i64) {\n\t\tif addr \u003c 0 || addr == i64::MAX { panic! (); }\n\t\tlet size = addr as usize + 1;\n\t\tif size \u003c self.mem.len () {\n\t\t\treturn;\n\t\t}\n\t\tself.mem.extend (iter::repeat (0).take (size - self.mem.len ()));\n\t}\n\n}\n\npub type Mem = Vec \u003ci64\u003e;\n\npub fn from_str (source: \u0026 str) -\u003e Mem {\n\tsource.split (',').map (\n\t\t|item_str| item_str.trim ().parse ().unwrap (),\n\t).collect ()\n}\n\npub enum RunResult {\n\tHalt,\n\tOutput (i64),\n\tInput,\n}\n\n#[ derive (Clone, Copy) ]\nstruct Opcode {\n\tinstr: Instruction,\n\tmodes: [Mode; 3],\n}\n\nimpl TryFrom \u003ci64\u003e for Opcode {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cOpcode, String\u003e {\n\t\tOk (Opcode {\n\t\t\tinstr: (value % 100).try_into () ?,\n\t\t\tmodes: [\n\t\t\t\t((value / 100) % 10).into (),\n\t\t\t\t((value / 1000) % 10).into (),\n\t\t\t\t((value / 10000) % 10).into (),\n\t\t\t],\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Instruction {\n\tAdd,\n\tMultiply,\n\tInput,\n\tOutput,\n\tHalt,\n\tJumpIfTrue,\n\tJumpIfFalse,\n\tLessThan,\n\tEquals,\n\tAdjustRelBase,\n}\n\nimpl TryFrom \u003ci64\u003e for Instruction {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cInstruction, String\u003e {\n\t\tOk (match value {\n\t\t\t1 =\u003e Instruction::Add,\n\t\t\t2 =\u003e Instruction::Multiply,\n\t\t\t3 =\u003e Instruction::Input,\n\t\t\t4 =\u003e Instruction::Output,\n\t\t\t5 =\u003e Instruction::JumpIfTrue,\n\t\t\t6 =\u003e Instruction::JumpIfFalse,\n\t\t\t7 =\u003e Instruction::LessThan,\n\t\t\t8 =\u003e Instruction::Equals,\n\t\t\t9 =\u003e Instruction::AdjustRelBase,\n\t\t\t99 =\u003e Instruction::Halt,\n\t\t\t_ =\u003e return Err (format! (\"Invalid instruction: {}\", value)),\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Mode { Position, Immediate, Relative }\n\nimpl From \u003ci64\u003e for Mode {\n\n\tfn from (value: i64) -\u003e Mode {\n\t\tmatch value {\n\t\t\t0 =\u003e Mode::Position,\n\t\t\t1 =\u003e Mode::Immediate,\n\t\t\t2 =\u003e Mode::Relative,\n\t\t\t_ =\u003e panic! (\"Invalid mode: {}\", value),\n\t\t}\n\t}\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2019","aoc-2019-day-19-part-1","src","intcode.rs"],"content":"use std::collections::VecDeque;\nuse std::convert::TryFrom;\nuse std::convert::TryInto as _;\nuse std::iter;\n\npub struct Machine {\n\tmem: Mem,\n\tpos: i64,\n\trel: i64,\n\tinput_buffer: VecDeque \u003ci64\u003e,\n}\n\nimpl Machine {\n\n\tpub fn new (mem: Mem) -\u003e Machine {\n\t\tMachine {\n\t\t\tmem: mem,\n\t\t\tpos: 0,\n\t\t\trel: 0,\n\t\t\tinput_buffer: VecDeque::new (),\n\t\t}\n\t}\n\n\tpub fn input (\u0026 mut self, value: i64) {\n\t\tself.input_buffer.push_back (value);\n\t}\n\n\tpub fn input_str (\u0026 mut self, value: \u0026 str) {\n\t\tfor ch in value.chars () {\n\t\t\tself.input_buffer.push_back (ch as i64);\n\t\t}\n\t}\n\n\tpub fn run (\u0026 mut self) -\u003e RunResult {\n\t\tloop {\n\t\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().map_err (\n\t\t\t\t|error| format! (\"[pos={}] {}\", self.pos, error),\n\t\t\t).unwrap ();\n\t\t\tmatch opcode.instr {\n\t\t\t\tInstruction::Add =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 + param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Multiply =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 * param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Input =\u003e {\n\t\t\t\t\tif let Some (value) = self.input_buffer.pop_front () {\n\t\t\t\t\t\tself.param_set (0, value);\n\t\t\t\t\t\tself.pos += 2;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn RunResult::Input;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::Output =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t\treturn RunResult::Output (value);\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfTrue =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value != 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfFalse =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value == 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::LessThan =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 \u003c param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Equals =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 == param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::AdjustRelBase =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.rel += value;\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::Halt =\u003e {\n\t\t\t\t\treturn RunResult::Halt;\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}\n\n\tfn param_get (\u0026 mut self, num: u8) -\u003e i64 {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_get (param),\n\t\t\tMode::Immediate =\u003e param,\n\t\t\tMode::Relative =\u003e self.mem_get (param + self.rel),\n\t\t}\n\t}\n\n\tfn param_set (\u0026 mut self, num: u8, value: i64) {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_set (param, value),\n\t\t\tMode::Immediate =\u003e panic! (),\n\t\t\tMode::Relative =\u003e self.mem_set (param + self.rel, value),\n\t\t}\n\t}\n\n\tfn mem_get (\u0026 mut self, addr: i64) -\u003e i64 {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize]\n\t}\n\n\tfn mem_set (\u0026 mut self, addr: i64, value: i64) {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize] = value;\n\t}\n\n\tfn mem_extend (\u0026 mut self, addr: i64) {\n\t\tif addr \u003c 0 || addr == i64::MAX { panic! (); }\n\t\tlet size = addr as usize + 1;\n\t\tif size \u003c self.mem.len () {\n\t\t\treturn;\n\t\t}\n\t\tself.mem.extend (iter::repeat (0).take (size - self.mem.len ()));\n\t}\n\n}\n\npub type Mem = Vec \u003ci64\u003e;\n\npub fn from_str (source: \u0026 str) -\u003e Mem {\n\tsource.split (',').map (\n\t\t|item_str| item_str.trim ().parse ().unwrap (),\n\t).collect ()\n}\n\n#[ derive (Debug) ]\npub enum RunResult {\n\tHalt,\n\tOutput (i64),\n\tInput,\n}\n\n#[ derive (Clone, Copy) ]\nstruct Opcode {\n\tinstr: Instruction,\n\tmodes: [Mode; 3],\n}\n\nimpl TryFrom \u003ci64\u003e for Opcode {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cOpcode, String\u003e {\n\t\tOk (Opcode {\n\t\t\tinstr: (value % 100).try_into () ?,\n\t\t\tmodes: [\n\t\t\t\t((value / 100) % 10).into (),\n\t\t\t\t((value / 1000) % 10).into (),\n\t\t\t\t((value / 10000) % 10).into (),\n\t\t\t],\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Instruction {\n\tAdd,\n\tMultiply,\n\tInput,\n\tOutput,\n\tHalt,\n\tJumpIfTrue,\n\tJumpIfFalse,\n\tLessThan,\n\tEquals,\n\tAdjustRelBase,\n}\n\nimpl TryFrom \u003ci64\u003e for Instruction {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cInstruction, String\u003e {\n\t\tOk (match value {\n\t\t\t1 =\u003e Instruction::Add,\n\t\t\t2 =\u003e Instruction::Multiply,\n\t\t\t3 =\u003e Instruction::Input,\n\t\t\t4 =\u003e Instruction::Output,\n\t\t\t5 =\u003e Instruction::JumpIfTrue,\n\t\t\t6 =\u003e Instruction::JumpIfFalse,\n\t\t\t7 =\u003e Instruction::LessThan,\n\t\t\t8 =\u003e Instruction::Equals,\n\t\t\t9 =\u003e Instruction::AdjustRelBase,\n\t\t\t99 =\u003e Instruction::Halt,\n\t\t\t_ =\u003e return Err (format! (\"Invalid instruction: {}\", value)),\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Mode { Position, Immediate, Relative }\n\nimpl From \u003ci64\u003e for Mode {\n\n\tfn from (value: i64) -\u003e Mode {\n\t\tmatch value {\n\t\t\t0 =\u003e Mode::Position,\n\t\t\t1 =\u003e Mode::Immediate,\n\t\t\t2 =\u003e Mode::Relative,\n\t\t\t_ =\u003e panic! (\"Invalid mode: {}\", value),\n\t\t}\n\t}\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2019","aoc-2019-day-19-part-2","src","intcode.rs"],"content":"use std::collections::VecDeque;\nuse std::convert::TryFrom;\nuse std::convert::TryInto as _;\nuse std::iter;\n\npub struct Machine {\n\tmem: Mem,\n\tpos: i64,\n\trel: i64,\n\tinput_buffer: VecDeque \u003ci64\u003e,\n}\n\nimpl Machine {\n\n\tpub fn new (mem: Mem) -\u003e Machine {\n\t\tMachine {\n\t\t\tmem: mem,\n\t\t\tpos: 0,\n\t\t\trel: 0,\n\t\t\tinput_buffer: VecDeque::new (),\n\t\t}\n\t}\n\n\tpub fn input (\u0026 mut self, value: i64) {\n\t\tself.input_buffer.push_back (value);\n\t}\n\n\tpub fn input_str (\u0026 mut self, value: \u0026 str) {\n\t\tfor ch in value.chars () {\n\t\t\tself.input_buffer.push_back (ch as i64);\n\t\t}\n\t}\n\n\tpub fn run (\u0026 mut self) -\u003e RunResult {\n\t\tloop {\n\t\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().map_err (\n\t\t\t\t|error| format! (\"[pos={}] {}\", self.pos, error),\n\t\t\t).unwrap ();\n\t\t\tmatch opcode.instr {\n\t\t\t\tInstruction::Add =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 + param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Multiply =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 * param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Input =\u003e {\n\t\t\t\t\tif let Some (value) = self.input_buffer.pop_front () {\n\t\t\t\t\t\tself.param_set (0, value);\n\t\t\t\t\t\tself.pos += 2;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn RunResult::Input;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::Output =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t\treturn RunResult::Output (value);\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfTrue =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value != 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfFalse =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value == 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::LessThan =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 \u003c param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Equals =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 == param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::AdjustRelBase =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.rel += value;\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::Halt =\u003e {\n\t\t\t\t\treturn RunResult::Halt;\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}\n\n\tfn param_get (\u0026 mut self, num: u8) -\u003e i64 {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_get (param),\n\t\t\tMode::Immediate =\u003e param,\n\t\t\tMode::Relative =\u003e self.mem_get (param + self.rel),\n\t\t}\n\t}\n\n\tfn param_set (\u0026 mut self, num: u8, value: i64) {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_set (param, value),\n\t\t\tMode::Immediate =\u003e panic! (),\n\t\t\tMode::Relative =\u003e self.mem_set (param + self.rel, value),\n\t\t}\n\t}\n\n\tfn mem_get (\u0026 mut self, addr: i64) -\u003e i64 {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize]\n\t}\n\n\tfn mem_set (\u0026 mut self, addr: i64, value: i64) {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize] = value;\n\t}\n\n\tfn mem_extend (\u0026 mut self, addr: i64) {\n\t\tif addr \u003c 0 || addr == i64::MAX { panic! (); }\n\t\tlet size = addr as usize + 1;\n\t\tif size \u003c self.mem.len () {\n\t\t\treturn;\n\t\t}\n\t\tself.mem.extend (iter::repeat (0).take (size - self.mem.len ()));\n\t}\n\n}\n\npub type Mem = Vec \u003ci64\u003e;\n\npub fn from_str (source: \u0026 str) -\u003e Mem {\n\tsource.split (',').map (\n\t\t|item_str| item_str.trim ().parse ().unwrap (),\n\t).collect ()\n}\n\n#[ derive (Debug) ]\npub enum RunResult {\n\tHalt,\n\tOutput (i64),\n\tInput,\n}\n\n#[ derive (Clone, Copy) ]\nstruct Opcode {\n\tinstr: Instruction,\n\tmodes: [Mode; 3],\n}\n\nimpl TryFrom \u003ci64\u003e for Opcode {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cOpcode, String\u003e {\n\t\tOk (Opcode {\n\t\t\tinstr: (value % 100).try_into () ?,\n\t\t\tmodes: [\n\t\t\t\t((value / 100) % 10).into (),\n\t\t\t\t((value / 1000) % 10).into (),\n\t\t\t\t((value / 10000) % 10).into (),\n\t\t\t],\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Instruction {\n\tAdd,\n\tMultiply,\n\tInput,\n\tOutput,\n\tHalt,\n\tJumpIfTrue,\n\tJumpIfFalse,\n\tLessThan,\n\tEquals,\n\tAdjustRelBase,\n}\n\nimpl TryFrom \u003ci64\u003e for Instruction {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cInstruction, String\u003e {\n\t\tOk (match value {\n\t\t\t1 =\u003e Instruction::Add,\n\t\t\t2 =\u003e Instruction::Multiply,\n\t\t\t3 =\u003e Instruction::Input,\n\t\t\t4 =\u003e Instruction::Output,\n\t\t\t5 =\u003e Instruction::JumpIfTrue,\n\t\t\t6 =\u003e Instruction::JumpIfFalse,\n\t\t\t7 =\u003e Instruction::LessThan,\n\t\t\t8 =\u003e Instruction::Equals,\n\t\t\t9 =\u003e Instruction::AdjustRelBase,\n\t\t\t99 =\u003e Instruction::Halt,\n\t\t\t_ =\u003e return Err (format! (\"Invalid instruction: {}\", value)),\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Mode { Position, Immediate, Relative }\n\nimpl From \u003ci64\u003e for Mode {\n\n\tfn from (value: i64) -\u003e Mode {\n\t\tmatch value {\n\t\t\t0 =\u003e Mode::Position,\n\t\t\t1 =\u003e Mode::Immediate,\n\t\t\t2 =\u003e Mode::Relative,\n\t\t\t_ =\u003e panic! (\"Invalid mode: {}\", value),\n\t\t}\n\t}\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2019","aoc-2019-day-21-part-1","src","intcode.rs"],"content":"use std::collections::VecDeque;\nuse std::convert::TryFrom;\nuse std::convert::TryInto as _;\nuse std::iter;\n\npub struct Machine {\n\tmem: Mem,\n\tpos: i64,\n\trel: i64,\n\tinput_buffer: VecDeque \u003ci64\u003e,\n}\n\nimpl Machine {\n\n\tpub fn new (mem: Mem) -\u003e Machine {\n\t\tMachine {\n\t\t\tmem: mem,\n\t\t\tpos: 0,\n\t\t\trel: 0,\n\t\t\tinput_buffer: VecDeque::new (),\n\t\t}\n\t}\n\n\tpub fn input (\u0026 mut self, value: i64) {\n\t\tself.input_buffer.push_back (value);\n\t}\n\n\tpub fn input_str (\u0026 mut self, value: \u0026 str) {\n\t\tfor ch in value.chars () {\n\t\t\tself.input_buffer.push_back (ch as i64);\n\t\t}\n\t}\n\n\tpub fn run (\u0026 mut self) -\u003e RunResult {\n\t\tloop {\n\t\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().map_err (\n\t\t\t\t|error| format! (\"[pos={}] {}\", self.pos, error),\n\t\t\t).unwrap ();\n\t\t\tmatch opcode.instr {\n\t\t\t\tInstruction::Add =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 + param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Multiply =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 * param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Input =\u003e {\n\t\t\t\t\tif let Some (value) = self.input_buffer.pop_front () {\n\t\t\t\t\t\tself.param_set (0, value);\n\t\t\t\t\t\tself.pos += 2;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn RunResult::Input;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::Output =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t\treturn RunResult::Output (value);\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfTrue =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value != 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfFalse =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value == 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::LessThan =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 \u003c param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Equals =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 == param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::AdjustRelBase =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.rel += value;\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::Halt =\u003e {\n\t\t\t\t\treturn RunResult::Halt;\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}\n\n\tfn param_get (\u0026 mut self, num: u8) -\u003e i64 {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_get (param),\n\t\t\tMode::Immediate =\u003e param,\n\t\t\tMode::Relative =\u003e self.mem_get (param + self.rel),\n\t\t}\n\t}\n\n\tfn param_set (\u0026 mut self, num: u8, value: i64) {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_set (param, value),\n\t\t\tMode::Immediate =\u003e panic! (),\n\t\t\tMode::Relative =\u003e self.mem_set (param + self.rel, value),\n\t\t}\n\t}\n\n\tfn mem_get (\u0026 mut self, addr: i64) -\u003e i64 {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize]\n\t}\n\n\tfn mem_set (\u0026 mut self, addr: i64, value: i64) {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize] = value;\n\t}\n\n\tfn mem_extend (\u0026 mut self, addr: i64) {\n\t\tif addr \u003c 0 || addr == i64::MAX { panic! (); }\n\t\tlet size = addr as usize + 1;\n\t\tif size \u003c self.mem.len () {\n\t\t\treturn;\n\t\t}\n\t\tself.mem.extend (iter::repeat (0).take (size - self.mem.len ()));\n\t}\n\n}\n\npub type Mem = Vec \u003ci64\u003e;\n\npub fn from_str (source: \u0026 str) -\u003e Mem {\n\tsource.split (',').map (\n\t\t|item_str| item_str.trim ().parse ().unwrap (),\n\t).collect ()\n}\n\n#[ derive (Debug) ]\npub enum RunResult {\n\tHalt,\n\tOutput (i64),\n\tInput,\n}\n\n#[ derive (Clone, Copy) ]\nstruct Opcode {\n\tinstr: Instruction,\n\tmodes: [Mode; 3],\n}\n\nimpl TryFrom \u003ci64\u003e for Opcode {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cOpcode, String\u003e {\n\t\tOk (Opcode {\n\t\t\tinstr: (value % 100).try_into () ?,\n\t\t\tmodes: [\n\t\t\t\t((value / 100) % 10).into (),\n\t\t\t\t((value / 1000) % 10).into (),\n\t\t\t\t((value / 10000) % 10).into (),\n\t\t\t],\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Instruction {\n\tAdd,\n\tMultiply,\n\tInput,\n\tOutput,\n\tHalt,\n\tJumpIfTrue,\n\tJumpIfFalse,\n\tLessThan,\n\tEquals,\n\tAdjustRelBase,\n}\n\nimpl TryFrom \u003ci64\u003e for Instruction {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cInstruction, String\u003e {\n\t\tOk (match value {\n\t\t\t1 =\u003e Instruction::Add,\n\t\t\t2 =\u003e Instruction::Multiply,\n\t\t\t3 =\u003e Instruction::Input,\n\t\t\t4 =\u003e Instruction::Output,\n\t\t\t5 =\u003e Instruction::JumpIfTrue,\n\t\t\t6 =\u003e Instruction::JumpIfFalse,\n\t\t\t7 =\u003e Instruction::LessThan,\n\t\t\t8 =\u003e Instruction::Equals,\n\t\t\t9 =\u003e Instruction::AdjustRelBase,\n\t\t\t99 =\u003e Instruction::Halt,\n\t\t\t_ =\u003e return Err (format! (\"Invalid instruction: {}\", value)),\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Mode { Position, Immediate, Relative }\n\nimpl From \u003ci64\u003e for Mode {\n\n\tfn from (value: i64) -\u003e Mode {\n\t\tmatch value {\n\t\t\t0 =\u003e Mode::Position,\n\t\t\t1 =\u003e Mode::Immediate,\n\t\t\t2 =\u003e Mode::Relative,\n\t\t\t_ =\u003e panic! (\"Invalid mode: {}\", value),\n\t\t}\n\t}\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2019","aoc-2019-day-21-part-2","src","intcode.rs"],"content":"use std::collections::VecDeque;\nuse std::convert::TryFrom;\nuse std::convert::TryInto as _;\nuse std::iter;\n\npub struct Machine {\n\tmem: Mem,\n\tpos: i64,\n\trel: i64,\n\tinput_buffer: VecDeque \u003ci64\u003e,\n}\n\nimpl Machine {\n\n\tpub fn new (mem: Mem) -\u003e Machine {\n\t\tMachine {\n\t\t\tmem: mem,\n\t\t\tpos: 0,\n\t\t\trel: 0,\n\t\t\tinput_buffer: VecDeque::new (),\n\t\t}\n\t}\n\n\tpub fn input (\u0026 mut self, value: i64) {\n\t\tself.input_buffer.push_back (value);\n\t}\n\n\tpub fn input_str (\u0026 mut self, value: \u0026 str) {\n\t\tfor ch in value.chars () {\n\t\t\tself.input_buffer.push_back (ch as i64);\n\t\t}\n\t}\n\n\tpub fn run (\u0026 mut self) -\u003e RunResult {\n\t\tloop {\n\t\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().map_err (\n\t\t\t\t|error| format! (\"[pos={}] {}\", self.pos, error),\n\t\t\t).unwrap ();\n\t\t\tmatch opcode.instr {\n\t\t\t\tInstruction::Add =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 + param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Multiply =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 * param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Input =\u003e {\n\t\t\t\t\tif let Some (value) = self.input_buffer.pop_front () {\n\t\t\t\t\t\tself.param_set (0, value);\n\t\t\t\t\t\tself.pos += 2;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn RunResult::Input;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::Output =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t\treturn RunResult::Output (value);\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfTrue =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value != 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfFalse =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value == 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::LessThan =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 \u003c param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Equals =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 == param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::AdjustRelBase =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.rel += value;\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::Halt =\u003e {\n\t\t\t\t\treturn RunResult::Halt;\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}\n\n\tfn param_get (\u0026 mut self, num: u8) -\u003e i64 {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_get (param),\n\t\t\tMode::Immediate =\u003e param,\n\t\t\tMode::Relative =\u003e self.mem_get (param + self.rel),\n\t\t}\n\t}\n\n\tfn param_set (\u0026 mut self, num: u8, value: i64) {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_set (param, value),\n\t\t\tMode::Immediate =\u003e panic! (),\n\t\t\tMode::Relative =\u003e self.mem_set (param + self.rel, value),\n\t\t}\n\t}\n\n\tfn mem_get (\u0026 mut self, addr: i64) -\u003e i64 {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize]\n\t}\n\n\tfn mem_set (\u0026 mut self, addr: i64, value: i64) {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize] = value;\n\t}\n\n\tfn mem_extend (\u0026 mut self, addr: i64) {\n\t\tif addr \u003c 0 || addr == i64::MAX { panic! (); }\n\t\tlet size = addr as usize + 1;\n\t\tif size \u003c self.mem.len () {\n\t\t\treturn;\n\t\t}\n\t\tself.mem.extend (iter::repeat (0).take (size - self.mem.len ()));\n\t}\n\n}\n\npub type Mem = Vec \u003ci64\u003e;\n\npub fn from_str (source: \u0026 str) -\u003e Mem {\n\tsource.split (',').map (\n\t\t|item_str| item_str.trim ().parse ().unwrap (),\n\t).collect ()\n}\n\n#[ derive (Debug) ]\npub enum RunResult {\n\tHalt,\n\tOutput (i64),\n\tInput,\n}\n\n#[ derive (Clone, Copy) ]\nstruct Opcode {\n\tinstr: Instruction,\n\tmodes: [Mode; 3],\n}\n\nimpl TryFrom \u003ci64\u003e for Opcode {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cOpcode, String\u003e {\n\t\tOk (Opcode {\n\t\t\tinstr: (value % 100).try_into () ?,\n\t\t\tmodes: [\n\t\t\t\t((value / 100) % 10).into (),\n\t\t\t\t((value / 1000) % 10).into (),\n\t\t\t\t((value / 10000) % 10).into (),\n\t\t\t],\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Instruction {\n\tAdd,\n\tMultiply,\n\tInput,\n\tOutput,\n\tHalt,\n\tJumpIfTrue,\n\tJumpIfFalse,\n\tLessThan,\n\tEquals,\n\tAdjustRelBase,\n}\n\nimpl TryFrom \u003ci64\u003e for Instruction {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cInstruction, String\u003e {\n\t\tOk (match value {\n\t\t\t1 =\u003e Instruction::Add,\n\t\t\t2 =\u003e Instruction::Multiply,\n\t\t\t3 =\u003e Instruction::Input,\n\t\t\t4 =\u003e Instruction::Output,\n\t\t\t5 =\u003e Instruction::JumpIfTrue,\n\t\t\t6 =\u003e Instruction::JumpIfFalse,\n\t\t\t7 =\u003e Instruction::LessThan,\n\t\t\t8 =\u003e Instruction::Equals,\n\t\t\t9 =\u003e Instruction::AdjustRelBase,\n\t\t\t99 =\u003e Instruction::Halt,\n\t\t\t_ =\u003e return Err (format! (\"Invalid instruction: {}\", value)),\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Mode { Position, Immediate, Relative }\n\nimpl From \u003ci64\u003e for Mode {\n\n\tfn from (value: i64) -\u003e Mode {\n\t\tmatch value {\n\t\t\t0 =\u003e Mode::Position,\n\t\t\t1 =\u003e Mode::Immediate,\n\t\t\t2 =\u003e Mode::Relative,\n\t\t\t_ =\u003e panic! (\"Invalid mode: {}\", value),\n\t\t}\n\t}\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2019","aoc-2019-day-23-part-1","src","intcode.rs"],"content":"use std::collections::VecDeque;\nuse std::convert::TryFrom;\nuse std::convert::TryInto as _;\nuse std::iter;\n\npub struct Machine {\n\tmem: Mem,\n\tpos: i64,\n\trel: i64,\n\tinput_buffer: VecDeque \u003ci64\u003e,\n}\n\nimpl Machine {\n\n\tpub fn new (mem: Mem) -\u003e Machine {\n\t\tMachine {\n\t\t\tmem: mem,\n\t\t\tpos: 0,\n\t\t\trel: 0,\n\t\t\tinput_buffer: VecDeque::new (),\n\t\t}\n\t}\n\n\tpub fn input (\u0026 mut self, value: i64) {\n\t\tself.input_buffer.push_back (value);\n\t}\n\n\tpub fn input_str (\u0026 mut self, value: \u0026 str) {\n\t\tfor ch in value.chars () {\n\t\t\tself.input_buffer.push_back (ch as i64);\n\t\t}\n\t}\n\n\tpub fn run (\u0026 mut self) -\u003e RunResult {\n\t\tloop {\n\t\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().map_err (\n\t\t\t\t|error| format! (\"[pos={}] {}\", self.pos, error),\n\t\t\t).unwrap ();\n\t\t\tmatch opcode.instr {\n\t\t\t\tInstruction::Add =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 + param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Multiply =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 * param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Input =\u003e {\n\t\t\t\t\tif let Some (value) = self.input_buffer.pop_front () {\n\t\t\t\t\t\tself.param_set (0, value);\n\t\t\t\t\t\tself.pos += 2;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn RunResult::Input;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::Output =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t\treturn RunResult::Output (value);\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfTrue =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value != 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfFalse =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value == 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::LessThan =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 \u003c param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Equals =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 == param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::AdjustRelBase =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.rel += value;\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::Halt =\u003e {\n\t\t\t\t\treturn RunResult::Halt;\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}\n\n\tfn param_get (\u0026 mut self, num: u8) -\u003e i64 {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_get (param),\n\t\t\tMode::Immediate =\u003e param,\n\t\t\tMode::Relative =\u003e self.mem_get (param + self.rel),\n\t\t}\n\t}\n\n\tfn param_set (\u0026 mut self, num: u8, value: i64) {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_set (param, value),\n\t\t\tMode::Immediate =\u003e panic! (),\n\t\t\tMode::Relative =\u003e self.mem_set (param + self.rel, value),\n\t\t}\n\t}\n\n\tfn mem_get (\u0026 mut self, addr: i64) -\u003e i64 {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize]\n\t}\n\n\tfn mem_set (\u0026 mut self, addr: i64, value: i64) {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize] = value;\n\t}\n\n\tfn mem_extend (\u0026 mut self, addr: i64) {\n\t\tif addr \u003c 0 || addr == i64::MAX { panic! (); }\n\t\tlet size = addr as usize + 1;\n\t\tif size \u003c self.mem.len () {\n\t\t\treturn;\n\t\t}\n\t\tself.mem.extend (iter::repeat (0).take (size - self.mem.len ()));\n\t}\n\n}\n\npub type Mem = Vec \u003ci64\u003e;\n\npub fn from_str (source: \u0026 str) -\u003e Mem {\n\tsource.split (',').map (\n\t\t|item_str| item_str.trim ().parse ().unwrap (),\n\t).collect ()\n}\n\n#[ derive (Debug) ]\npub enum RunResult {\n\tHalt,\n\tOutput (i64),\n\tInput,\n}\n\n#[ derive (Clone, Copy) ]\nstruct Opcode {\n\tinstr: Instruction,\n\tmodes: [Mode; 3],\n}\n\nimpl TryFrom \u003ci64\u003e for Opcode {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cOpcode, String\u003e {\n\t\tOk (Opcode {\n\t\t\tinstr: (value % 100).try_into () ?,\n\t\t\tmodes: [\n\t\t\t\t((value / 100) % 10).into (),\n\t\t\t\t((value / 1000) % 10).into (),\n\t\t\t\t((value / 10000) % 10).into (),\n\t\t\t],\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Instruction {\n\tAdd,\n\tMultiply,\n\tInput,\n\tOutput,\n\tHalt,\n\tJumpIfTrue,\n\tJumpIfFalse,\n\tLessThan,\n\tEquals,\n\tAdjustRelBase,\n}\n\nimpl TryFrom \u003ci64\u003e for Instruction {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cInstruction, String\u003e {\n\t\tOk (match value {\n\t\t\t1 =\u003e Instruction::Add,\n\t\t\t2 =\u003e Instruction::Multiply,\n\t\t\t3 =\u003e Instruction::Input,\n\t\t\t4 =\u003e Instruction::Output,\n\t\t\t5 =\u003e Instruction::JumpIfTrue,\n\t\t\t6 =\u003e Instruction::JumpIfFalse,\n\t\t\t7 =\u003e Instruction::LessThan,\n\t\t\t8 =\u003e Instruction::Equals,\n\t\t\t9 =\u003e Instruction::AdjustRelBase,\n\t\t\t99 =\u003e Instruction::Halt,\n\t\t\t_ =\u003e return Err (format! (\"Invalid instruction: {}\", value)),\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Mode { Position, Immediate, Relative }\n\nimpl From \u003ci64\u003e for Mode {\n\n\tfn from (value: i64) -\u003e Mode {\n\t\tmatch value {\n\t\t\t0 =\u003e Mode::Position,\n\t\t\t1 =\u003e Mode::Immediate,\n\t\t\t2 =\u003e Mode::Relative,\n\t\t\t_ =\u003e panic! (\"Invalid mode: {}\", value),\n\t\t}\n\t}\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2019","aoc-2019-day-23-part-2","src","intcode.rs"],"content":"use std::collections::VecDeque;\nuse std::convert::TryFrom;\nuse std::convert::TryInto as _;\nuse std::iter;\n\npub struct Machine {\n\tmem: Mem,\n\tpos: i64,\n\trel: i64,\n\tinput_buffer: VecDeque \u003ci64\u003e,\n}\n\nimpl Machine {\n\n\tpub fn new (mem: Mem) -\u003e Machine {\n\t\tMachine {\n\t\t\tmem: mem,\n\t\t\tpos: 0,\n\t\t\trel: 0,\n\t\t\tinput_buffer: VecDeque::new (),\n\t\t}\n\t}\n\n\tpub fn input (\u0026 mut self, value: i64) {\n\t\tself.input_buffer.push_back (value);\n\t}\n\n\tpub fn input_str (\u0026 mut self, value: \u0026 str) {\n\t\tfor ch in value.chars () {\n\t\t\tself.input_buffer.push_back (ch as i64);\n\t\t}\n\t}\n\n\tpub fn run (\u0026 mut self) -\u003e RunResult {\n\t\tloop {\n\t\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().map_err (\n\t\t\t\t|error| format! (\"[pos={}] {}\", self.pos, error),\n\t\t\t).unwrap ();\n\t\t\tmatch opcode.instr {\n\t\t\t\tInstruction::Add =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 + param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Multiply =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 * param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Input =\u003e {\n\t\t\t\t\tif let Some (value) = self.input_buffer.pop_front () {\n\t\t\t\t\t\tself.param_set (0, value);\n\t\t\t\t\t\tself.pos += 2;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn RunResult::Input;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::Output =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t\treturn RunResult::Output (value);\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfTrue =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value != 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfFalse =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value == 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::LessThan =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 \u003c param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Equals =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 == param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::AdjustRelBase =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.rel += value;\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::Halt =\u003e {\n\t\t\t\t\treturn RunResult::Halt;\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}\n\n\tfn param_get (\u0026 mut self, num: u8) -\u003e i64 {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_get (param),\n\t\t\tMode::Immediate =\u003e param,\n\t\t\tMode::Relative =\u003e self.mem_get (param + self.rel),\n\t\t}\n\t}\n\n\tfn param_set (\u0026 mut self, num: u8, value: i64) {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_set (param, value),\n\t\t\tMode::Immediate =\u003e panic! (),\n\t\t\tMode::Relative =\u003e self.mem_set (param + self.rel, value),\n\t\t}\n\t}\n\n\tfn mem_get (\u0026 mut self, addr: i64) -\u003e i64 {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize]\n\t}\n\n\tfn mem_set (\u0026 mut self, addr: i64, value: i64) {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize] = value;\n\t}\n\n\tfn mem_extend (\u0026 mut self, addr: i64) {\n\t\tif addr \u003c 0 || addr == i64::MAX { panic! (); }\n\t\tlet size = addr as usize + 1;\n\t\tif size \u003c self.mem.len () {\n\t\t\treturn;\n\t\t}\n\t\tself.mem.extend (iter::repeat (0).take (size - self.mem.len ()));\n\t}\n\n}\n\npub type Mem = Vec \u003ci64\u003e;\n\npub fn from_str (source: \u0026 str) -\u003e Mem {\n\tsource.split (',').map (\n\t\t|item_str| item_str.trim ().parse ().unwrap (),\n\t).collect ()\n}\n\n#[ derive (Debug) ]\npub enum RunResult {\n\tHalt,\n\tOutput (i64),\n\tInput,\n}\n\n#[ derive (Clone, Copy) ]\nstruct Opcode {\n\tinstr: Instruction,\n\tmodes: [Mode; 3],\n}\n\nimpl TryFrom \u003ci64\u003e for Opcode {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cOpcode, String\u003e {\n\t\tOk (Opcode {\n\t\t\tinstr: (value % 100).try_into () ?,\n\t\t\tmodes: [\n\t\t\t\t((value / 100) % 10).into (),\n\t\t\t\t((value / 1000) % 10).into (),\n\t\t\t\t((value / 10000) % 10).into (),\n\t\t\t],\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Instruction {\n\tAdd,\n\tMultiply,\n\tInput,\n\tOutput,\n\tHalt,\n\tJumpIfTrue,\n\tJumpIfFalse,\n\tLessThan,\n\tEquals,\n\tAdjustRelBase,\n}\n\nimpl TryFrom \u003ci64\u003e for Instruction {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cInstruction, String\u003e {\n\t\tOk (match value {\n\t\t\t1 =\u003e Instruction::Add,\n\t\t\t2 =\u003e Instruction::Multiply,\n\t\t\t3 =\u003e Instruction::Input,\n\t\t\t4 =\u003e Instruction::Output,\n\t\t\t5 =\u003e Instruction::JumpIfTrue,\n\t\t\t6 =\u003e Instruction::JumpIfFalse,\n\t\t\t7 =\u003e Instruction::LessThan,\n\t\t\t8 =\u003e Instruction::Equals,\n\t\t\t9 =\u003e Instruction::AdjustRelBase,\n\t\t\t99 =\u003e Instruction::Halt,\n\t\t\t_ =\u003e return Err (format! (\"Invalid instruction: {}\", value)),\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Mode { Position, Immediate, Relative }\n\nimpl From \u003ci64\u003e for Mode {\n\n\tfn from (value: i64) -\u003e Mode {\n\t\tmatch value {\n\t\t\t0 =\u003e Mode::Position,\n\t\t\t1 =\u003e Mode::Immediate,\n\t\t\t2 =\u003e Mode::Relative,\n\t\t\t_ =\u003e panic! (\"Invalid mode: {}\", value),\n\t\t}\n\t}\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2019","aoc-2019-day-25","src","intcode.rs"],"content":"use std::collections::VecDeque;\nuse std::convert::TryFrom;\nuse std::convert::TryInto as _;\nuse std::iter;\n\n#[ derive (Clone) ]\npub struct Machine {\n\tmem: Mem,\n\tpos: i64,\n\trel: i64,\n\tinput_buffer: VecDeque \u003ci64\u003e,\n}\n\nimpl Machine {\n\n\tpub fn new (mem: Mem) -\u003e Machine {\n\t\tMachine {\n\t\t\tmem: mem,\n\t\t\tpos: 0,\n\t\t\trel: 0,\n\t\t\tinput_buffer: VecDeque::new (),\n\t\t}\n\t}\n\n\tpub fn input (\u0026 mut self, value: i64) {\n\t\tself.input_buffer.push_back (value);\n\t}\n\n\tpub fn input_char (\u0026 mut self, value: char) {\n\t\tself.input (value as i64);\n\t}\n\n\tpub fn input_str (\u0026 mut self, value: \u0026 str) {\n\t\tfor ch in value.chars () {\n\t\t\tself.input_buffer.push_back (ch as i64);\n\t\t}\n\t}\n\n\tpub fn input_line (\u0026 mut self, value: \u0026 str) {\n\t\tfor ch in value.chars () {\n\t\t\tself.input_char (ch);\n\t\t}\n\t\tself.input_char ('\\n');\n\t}\n\n\tpub fn run (\u0026 mut self) -\u003e RunResult {\n\t\tloop {\n\t\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().map_err (\n\t\t\t\t|error| format! (\"[pos={}] {}\", self.pos, error),\n\t\t\t).unwrap ();\n\t\t\tmatch opcode.instr {\n\t\t\t\tInstruction::Add =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 + param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Multiply =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 * param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Input =\u003e {\n\t\t\t\t\tif let Some (value) = self.input_buffer.pop_front () {\n\t\t\t\t\t\tself.param_set (0, value);\n\t\t\t\t\t\tself.pos += 2;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn RunResult::Input;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::Output =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t\treturn RunResult::Output (value);\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfTrue =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value != 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfFalse =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value == 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::LessThan =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 \u003c param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Equals =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 == param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::AdjustRelBase =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.rel += value;\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::Halt =\u003e {\n\t\t\t\t\treturn RunResult::Halt;\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}\n\n\tfn param_get (\u0026 mut self, num: u8) -\u003e i64 {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_get (param),\n\t\t\tMode::Immediate =\u003e param,\n\t\t\tMode::Relative =\u003e self.mem_get (param + self.rel),\n\t\t}\n\t}\n\n\tfn param_set (\u0026 mut self, num: u8, value: i64) {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_set (param, value),\n\t\t\tMode::Immediate =\u003e panic! (),\n\t\t\tMode::Relative =\u003e self.mem_set (param + self.rel, value),\n\t\t}\n\t}\n\n\tfn mem_get (\u0026 mut self, addr: i64) -\u003e i64 {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize]\n\t}\n\n\tfn mem_set (\u0026 mut self, addr: i64, value: i64) {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize] = value;\n\t}\n\n\tfn mem_extend (\u0026 mut self, addr: i64) {\n\t\tif addr \u003c 0 || addr == i64::MAX { panic! (); }\n\t\tlet size = addr as usize + 1;\n\t\tif size \u003c self.mem.len () {\n\t\t\treturn;\n\t\t}\n\t\tself.mem.extend (iter::repeat (0).take (size - self.mem.len ()));\n\t}\n\n}\n\npub type Mem = Vec \u003ci64\u003e;\n\npub fn from_str (source: \u0026 str) -\u003e Mem {\n\tsource.split (',').map (\n\t\t|item_str| item_str.trim ().parse ().unwrap (),\n\t).collect ()\n}\n\n#[ derive (Debug) ]\npub enum RunResult {\n\tHalt,\n\tOutput (i64),\n\tInput,\n}\n\n#[ derive (Clone, Copy) ]\nstruct Opcode {\n\tinstr: Instruction,\n\tmodes: [Mode; 3],\n}\n\nimpl TryFrom \u003ci64\u003e for Opcode {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cOpcode, String\u003e {\n\t\tOk (Opcode {\n\t\t\tinstr: (value % 100).try_into () ?,\n\t\t\tmodes: [\n\t\t\t\t((value / 100) % 10).into (),\n\t\t\t\t((value / 1000) % 10).into (),\n\t\t\t\t((value / 10000) % 10).into (),\n\t\t\t],\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Instruction {\n\tAdd,\n\tMultiply,\n\tInput,\n\tOutput,\n\tHalt,\n\tJumpIfTrue,\n\tJumpIfFalse,\n\tLessThan,\n\tEquals,\n\tAdjustRelBase,\n}\n\nimpl TryFrom \u003ci64\u003e for Instruction {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cInstruction, String\u003e {\n\t\tOk (match value {\n\t\t\t1 =\u003e Instruction::Add,\n\t\t\t2 =\u003e Instruction::Multiply,\n\t\t\t3 =\u003e Instruction::Input,\n\t\t\t4 =\u003e Instruction::Output,\n\t\t\t5 =\u003e Instruction::JumpIfTrue,\n\t\t\t6 =\u003e Instruction::JumpIfFalse,\n\t\t\t7 =\u003e Instruction::LessThan,\n\t\t\t8 =\u003e Instruction::Equals,\n\t\t\t9 =\u003e Instruction::AdjustRelBase,\n\t\t\t99 =\u003e Instruction::Halt,\n\t\t\t_ =\u003e return Err (format! (\"Invalid instruction: {}\", value)),\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Mode { Position, Immediate, Relative }\n\nimpl From \u003ci64\u003e for Mode {\n\n\tfn from (value: i64) -\u003e Mode {\n\t\tmatch value {\n\t\t\t0 =\u003e Mode::Position,\n\t\t\t1 =\u003e Mode::Immediate,\n\t\t\t2 =\u003e Mode::Relative,\n\t\t\t_ =\u003e panic! (\"Invalid mode: {}\", value),\n\t\t}\n\t}\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2019","aoc-2019-day-7-part-1","src","intcode.rs"],"content":"use rustyline::Editor;\n\nuse std::collections::VecDeque;\n\npub struct Machine {\n\tmem: Mem,\n\tpos: usize,\n\tinput_buffer: VecDeque \u003ci64\u003e,\n\tinput_readline: Option \u003cEditor \u003c()\u003e\u003e,\n\toutput_buffer: Option \u003cVecDeque \u003ci64\u003e\u003e,\n}\n\nimpl Machine {\n\n\tpub fn new (mem: Mem) -\u003e Machine {\n\t\tMachine {\n\t\t\tmem: mem,\n\t\t\tpos: 0,\n\t\t\tinput_buffer: VecDeque::new (),\n\t\t\tinput_readline: None,\n\t\t\toutput_buffer: None,\n\t\t}\n\t}\n\n\tpub fn with_input_buffer (mut self, input_buffer: VecDeque \u003ci64\u003e) -\u003e Machine {\n\t\tself.input_buffer = input_buffer;\n\t\tself\n\t}\n\n\tpub fn with_input_readline (mut self, input_readline: Editor \u003c()\u003e) -\u003e Machine {\n\t\tself.input_readline = Some (input_readline);\n\t\tself\n\t}\n\n\tpub fn with_output_buffer (mut self) -\u003e Machine {\n\t\tself.output_buffer = Some (VecDeque::new ());\n\t\tself\n\t}\n\n\tpub fn input_buffer (\u0026 mut self) -\u003e \u0026 mut VecDeque \u003ci64\u003e {\n\t\t\u0026 mut self.input_buffer\n\t}\n\n\tpub fn output_buffer (\u0026 mut self) -\u003e \u0026 mut VecDeque \u003ci64\u003e {\n\t\tself.output_buffer.as_mut ().unwrap ()\n\t}\n\n\tpub fn queue_input (\u0026 mut self, value: i64) {\n\t\tself.input_buffer.push_back (value);\n\t}\n\n\tpub fn run (\u0026 mut self) {\n\t\tloop {\n\t\t\tlet opcode: Opcode = self.mem [self.pos].into ();\n\t\t\tmatch opcode.instr {\n\t\t\t\tInstruction::Add =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 + param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Multiply =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 * param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Input =\u003e {\n\t\t\t\t\tlet value = self.get_input ();\n\t\t\t\t\tself.param_set (0, value);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::Output =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tif let Some (output_buffer) = self.output_buffer.as_mut () {\n\t\t\t\t\t\toutput_buffer.push_back (value);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tprintln! (\"Output: {}\", value);\n\t\t\t\t\t}\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfTrue =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value != 0 {\n\t\t\t\t\t\tself.pos = dest as usize;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfFalse =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value == 0 {\n\t\t\t\t\t\tself.pos = dest as usize;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::LessThan =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 \u003c param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Equals =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 == param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Halt =\u003e {\n\t\t\t\t\treturn;\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}\n\n\tfn get_input (\u0026 mut self) -\u003e i64 {\n\t\tif let Some (value) = self.input_buffer.pop_front () {\n\t\t\treturn value;\n\t\t} else if let Some (input_readline) = self.input_readline.as_mut () {\n\t\t\tlet value_str = input_readline.readline (\"Input: \").unwrap ();\n\t\t\treturn value_str.parse ().unwrap ();\n\t\t} else {\n\t\t\tpanic! (\"No input\");\n\t\t}\n\t}\n\n\tfn param_get (\u0026 mut self, num: usize) -\u003e i64 {\n\t\tlet opcode: Opcode = self.mem [self.pos].into ();\n\t\tlet param = self.mem [self.pos + 1 + num];\n\t\tmatch opcode.modes [num] {\n\t\t\tMode::Position =\u003e self.mem [param as usize],\n\t\t\tMode::Immediate =\u003e param,\n\t\t}\n\t}\n\n\tfn param_set (\u0026 mut self, num: usize, value: i64) {\n\t\tlet opcode: Opcode = self.mem [self.pos].into ();\n\t\tlet param = self.mem [self.pos + 1 + num];\n\t\tmatch opcode.modes [num] {\n\t\t\tMode::Position =\u003e self.mem [param as usize] = value,\n\t\t\tMode::Immediate =\u003e panic! (),\n\t\t}\n\t}\n\n}\n\npub fn from_str (source: \u0026 str) -\u003e Mem {\n\tsource.split (',').map (\n\t\t|item_str| item_str.trim ().parse ().unwrap (),\n\t).collect ()\n}\n\ntype Mem = Vec \u003ci64\u003e;\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Instruction {\n\tAdd,\n\tMultiply,\n\tInput,\n\tOutput,\n\tHalt,\n\tJumpIfTrue,\n\tJumpIfFalse,\n\tLessThan,\n\tEquals,\n}\n\nimpl From \u003ci64\u003e for Instruction {\n\n\tfn from (value: i64) -\u003e Instruction {\n\t\tmatch value {\n\t\t\t1 =\u003e Instruction::Add,\n\t\t\t2 =\u003e Instruction::Multiply,\n\t\t\t3 =\u003e Instruction::Input,\n\t\t\t4 =\u003e Instruction::Output,\n\t\t\t5 =\u003e Instruction::JumpIfTrue,\n\t\t\t6 =\u003e Instruction::JumpIfFalse,\n\t\t\t7 =\u003e Instruction::LessThan,\n\t\t\t8 =\u003e Instruction::Equals,\n\t\t\t99 =\u003e Instruction::Halt,\n\t\t\t_ =\u003e panic! (\"Invalid instruction: {}\", value),\n\t\t}\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Mode { Position, Immediate }\n\nimpl From \u003ci64\u003e for Mode {\n\n\tfn from (value: i64) -\u003e Mode {\n\t\tmatch value {\n\t\t\t0 =\u003e Mode::Position,\n\t\t\t1 =\u003e Mode::Immediate,\n\t\t\t_ =\u003e panic! (\"Invalid mode: {}\", value),\n\t\t}\n\t}\n\n}\n\n#[ derive (Clone, Copy) ]\nstruct Opcode {\n\tinstr: Instruction,\n\tmodes: [Mode; 3],\n}\n\nimpl From \u003ci64\u003e for Opcode {\n\n\tfn from (value: i64) -\u003e Opcode {\n\t\tOpcode {\n\t\t\tinstr: (value % 100).into (),\n\t\t\tmodes: [\n\t\t\t\t((value / 100) % 10).into (),\n\t\t\t\t((value / 1000) % 10).into (),\n\t\t\t\t((value / 10000) % 10).into (),\n\t\t\t],\n\t\t}\n\t}\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2019","aoc-2019-day-7-part-2","src","intcode.rs"],"content":"use std::collections::VecDeque;\nuse std::convert::TryFrom;\nuse std::convert::TryInto as _;\n\npub struct Machine {\n\tmem: Mem,\n\tpos: usize,\n\tinput_buffer: VecDeque \u003ci64\u003e,\n}\n\nimpl Machine {\n\n\tpub fn new (mem: Mem) -\u003e Machine {\n\t\tMachine {\n\t\t\tmem: mem,\n\t\t\tpos: 0,\n\t\t\tinput_buffer: VecDeque::new (),\n\t\t}\n\t}\n\n\tpub fn with_input_buffer (mut self, input_buffer: VecDeque \u003ci64\u003e) -\u003e Machine {\n\t\tself.input_buffer = input_buffer;\n\t\tself\n\t}\n\n\tpub fn input_buffer (\u0026 mut self) -\u003e \u0026 mut VecDeque \u003ci64\u003e {\n\t\t\u0026 mut self.input_buffer\n\t}\n\n\tpub fn queue_input (\u0026 mut self, value: i64) {\n\t\tself.input_buffer.push_back (value);\n\t}\n\n\tpub fn run (\u0026 mut self) -\u003e RunResult {\n\t\tloop {\n\t\t\tlet opcode: Opcode = self.mem [self.pos].try_into ().map_err (\n\t\t\t\t|error| format! (\"[pos={}] {}\", self.pos, error),\n\t\t\t).unwrap ();\n\t\t\tmatch opcode.instr {\n\t\t\t\tInstruction::Add =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 + param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Multiply =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 * param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Input =\u003e {\n\t\t\t\t\tlet value = self.get_input ();\n\t\t\t\t\tself.param_set (0, value);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::Output =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t\treturn RunResult::Output (value);\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfTrue =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value != 0 {\n\t\t\t\t\t\tself.pos = dest as usize;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfFalse =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value == 0 {\n\t\t\t\t\t\tself.pos = dest as usize;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::LessThan =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 \u003c param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Equals =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 == param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Halt =\u003e {\n\t\t\t\t\treturn RunResult::Halt;\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}\n\n\tfn get_input (\u0026 mut self) -\u003e i64 {\n\t\tif let Some (value) = self.input_buffer.pop_front () {\n\t\t\treturn value;\n\t\t} else {\n\t\t\tpanic! (\"No input\");\n\t\t}\n\t}\n\n\tfn param_get (\u0026 mut self, num: usize) -\u003e i64 {\n\t\tlet opcode: Opcode = self.mem [self.pos].try_into ().unwrap ();\n\t\tlet param = self.mem [self.pos + 1 + num];\n\t\tmatch opcode.modes [num] {\n\t\t\tMode::Position =\u003e self.mem [param as usize],\n\t\t\tMode::Immediate =\u003e param,\n\t\t}\n\t}\n\n\tfn param_set (\u0026 mut self, num: usize, value: i64) {\n\t\tlet opcode: Opcode = self.mem [self.pos].try_into ().unwrap ();\n\t\tlet param = self.mem [self.pos + 1 + num];\n\t\tmatch opcode.modes [num] {\n\t\t\tMode::Position =\u003e self.mem [param as usize] = value,\n\t\t\tMode::Immediate =\u003e panic! (),\n\t\t}\n\t}\n\n}\n\ntype Mem = Vec \u003ci64\u003e;\n\npub fn from_str (source: \u0026 str) -\u003e Mem {\n\tsource.split (',').map (\n\t\t|item_str| item_str.trim ().parse ().unwrap (),\n\t).collect ()\n}\n\npub enum RunResult {\n\tHalt,\n\tOutput (i64),\n}\n\n#[ derive (Clone, Copy) ]\nstruct Opcode {\n\tinstr: Instruction,\n\tmodes: [Mode; 3],\n}\n\nimpl TryFrom \u003ci64\u003e for Opcode {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cOpcode, String\u003e {\n\t\tOk (Opcode {\n\t\t\tinstr: (value % 100).try_into () ?,\n\t\t\tmodes: [\n\t\t\t\t((value / 100) % 10).into (),\n\t\t\t\t((value / 1000) % 10).into (),\n\t\t\t\t((value / 10000) % 10).into (),\n\t\t\t],\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Instruction {\n\tAdd,\n\tMultiply,\n\tInput,\n\tOutput,\n\tHalt,\n\tJumpIfTrue,\n\tJumpIfFalse,\n\tLessThan,\n\tEquals,\n}\n\nimpl TryFrom \u003ci64\u003e for Instruction {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cInstruction, String\u003e {\n\t\tOk (match value {\n\t\t\t1 =\u003e Instruction::Add,\n\t\t\t2 =\u003e Instruction::Multiply,\n\t\t\t3 =\u003e Instruction::Input,\n\t\t\t4 =\u003e Instruction::Output,\n\t\t\t5 =\u003e Instruction::JumpIfTrue,\n\t\t\t6 =\u003e Instruction::JumpIfFalse,\n\t\t\t7 =\u003e Instruction::LessThan,\n\t\t\t8 =\u003e Instruction::Equals,\n\t\t\t99 =\u003e Instruction::Halt,\n\t\t\t_ =\u003e return Err (format! (\"Invalid instruction: {}\", value)),\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Mode { Position, Immediate }\n\nimpl From \u003ci64\u003e for Mode {\n\n\tfn from (value: i64) -\u003e Mode {\n\t\tmatch value {\n\t\t\t0 =\u003e Mode::Position,\n\t\t\t1 =\u003e Mode::Immediate,\n\t\t\t_ =\u003e panic! (\"Invalid mode: {}\", value),\n\t\t}\n\t}\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2019","aoc-2019-day-9-part-1","src","intcode.rs"],"content":"use std::collections::VecDeque;\nuse std::convert::TryFrom;\nuse std::convert::TryInto as _;\nuse std::iter;\n\npub struct Machine {\n\tmem: Mem,\n\tpos: i64,\n\trel: i64,\n\tinput_buffer: VecDeque \u003ci64\u003e,\n}\n\nimpl Machine {\n\n\tpub fn new (mem: Mem) -\u003e Machine {\n\t\tMachine {\n\t\t\tmem: mem,\n\t\t\tpos: 0,\n\t\t\trel: 0,\n\t\t\tinput_buffer: VecDeque::new (),\n\t\t}\n\t}\n\n\tpub fn with_input_buffer (mut self, input_buffer: VecDeque \u003ci64\u003e) -\u003e Machine {\n\t\tself.input_buffer = input_buffer;\n\t\tself\n\t}\n\n\tpub fn input_buffer (\u0026 mut self) -\u003e \u0026 mut VecDeque \u003ci64\u003e {\n\t\t\u0026 mut self.input_buffer\n\t}\n\n\tpub fn queue_input (\u0026 mut self, value: i64) {\n\t\tself.input_buffer.push_back (value);\n\t}\n\n\tpub fn run (\u0026 mut self) -\u003e RunResult {\n\t\tloop {\n\t\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().map_err (\n\t\t\t\t|error| format! (\"[pos={}] {}\", self.pos, error),\n\t\t\t).unwrap ();\n\t\t\tmatch opcode.instr {\n\t\t\t\tInstruction::Add =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 + param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Multiply =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 * param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Input =\u003e {\n\t\t\t\t\tlet value = self.get_input ();\n\t\t\t\t\tself.param_set (0, value);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::Output =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t\treturn RunResult::Output (value);\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfTrue =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value != 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfFalse =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value == 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::LessThan =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 \u003c param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Equals =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 == param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::AdjustRelBase =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.rel += value;\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::Halt =\u003e {\n\t\t\t\t\treturn RunResult::Halt;\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}\n\n\tfn get_input (\u0026 mut self) -\u003e i64 {\n\t\tif let Some (value) = self.input_buffer.pop_front () {\n\t\t\treturn value;\n\t\t} else {\n\t\t\tpanic! (\"No input\");\n\t\t}\n\t}\n\n\tfn param_get (\u0026 mut self, num: u8) -\u003e i64 {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_get (param),\n\t\t\tMode::Immediate =\u003e param,\n\t\t\tMode::Relative =\u003e self.mem_get (param + self.rel),\n\t\t}\n\t}\n\n\tfn param_set (\u0026 mut self, num: u8, value: i64) {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_set (param, value),\n\t\t\tMode::Immediate =\u003e panic! (),\n\t\t\tMode::Relative =\u003e self.mem_set (param + self.rel, value),\n\t\t}\n\t}\n\n\tfn mem_get (\u0026 mut self, addr: i64) -\u003e i64 {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize]\n\t}\n\n\tfn mem_set (\u0026 mut self, addr: i64, value: i64) {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize] = value;\n\t}\n\n\tfn mem_extend (\u0026 mut self, addr: i64) {\n\t\tif addr \u003c 0 || addr == i64::MAX { panic! (); }\n\t\tlet size = addr as usize + 1;\n\t\tif size \u003c self.mem.len () {\n\t\t\treturn;\n\t\t}\n\t\tself.mem.extend (iter::repeat (0).take (size - self.mem.len ()));\n\t}\n\n}\n\ntype Mem = Vec \u003ci64\u003e;\n\npub fn from_str (source: \u0026 str) -\u003e Mem {\n\tsource.split (',').map (\n\t\t|item_str| item_str.trim ().parse ().unwrap (),\n\t).collect ()\n}\n\npub enum RunResult {\n\tHalt,\n\tOutput (i64),\n}\n\n#[ derive (Clone, Copy) ]\nstruct Opcode {\n\tinstr: Instruction,\n\tmodes: [Mode; 3],\n}\n\nimpl TryFrom \u003ci64\u003e for Opcode {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cOpcode, String\u003e {\n\t\tOk (Opcode {\n\t\t\tinstr: (value % 100).try_into () ?,\n\t\t\tmodes: [\n\t\t\t\t((value / 100) % 10).into (),\n\t\t\t\t((value / 1000) % 10).into (),\n\t\t\t\t((value / 10000) % 10).into (),\n\t\t\t],\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Instruction {\n\tAdd,\n\tMultiply,\n\tInput,\n\tOutput,\n\tHalt,\n\tJumpIfTrue,\n\tJumpIfFalse,\n\tLessThan,\n\tEquals,\n\tAdjustRelBase,\n}\n\nimpl TryFrom \u003ci64\u003e for Instruction {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cInstruction, String\u003e {\n\t\tOk (match value {\n\t\t\t1 =\u003e Instruction::Add,\n\t\t\t2 =\u003e Instruction::Multiply,\n\t\t\t3 =\u003e Instruction::Input,\n\t\t\t4 =\u003e Instruction::Output,\n\t\t\t5 =\u003e Instruction::JumpIfTrue,\n\t\t\t6 =\u003e Instruction::JumpIfFalse,\n\t\t\t7 =\u003e Instruction::LessThan,\n\t\t\t8 =\u003e Instruction::Equals,\n\t\t\t9 =\u003e Instruction::AdjustRelBase,\n\t\t\t99 =\u003e Instruction::Halt,\n\t\t\t_ =\u003e return Err (format! (\"Invalid instruction: {}\", value)),\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Mode { Position, Immediate, Relative }\n\nimpl From \u003ci64\u003e for Mode {\n\n\tfn from (value: i64) -\u003e Mode {\n\t\tmatch value {\n\t\t\t0 =\u003e Mode::Position,\n\t\t\t1 =\u003e Mode::Immediate,\n\t\t\t2 =\u003e Mode::Relative,\n\t\t\t_ =\u003e panic! (\"Invalid mode: {}\", value),\n\t\t}\n\t}\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2019","aoc-2019-day-9-part-2","src","intcode.rs"],"content":"use std::collections::VecDeque;\nuse std::convert::TryFrom;\nuse std::convert::TryInto as _;\nuse std::iter;\n\npub struct Machine {\n\tmem: Mem,\n\tpos: i64,\n\trel: i64,\n\tinput_buffer: VecDeque \u003ci64\u003e,\n}\n\nimpl Machine {\n\n\tpub fn new (mem: Mem) -\u003e Machine {\n\t\tMachine {\n\t\t\tmem: mem,\n\t\t\tpos: 0,\n\t\t\trel: 0,\n\t\t\tinput_buffer: VecDeque::new (),\n\t\t}\n\t}\n\n\tpub fn with_input_buffer (mut self, input_buffer: VecDeque \u003ci64\u003e) -\u003e Machine {\n\t\tself.input_buffer = input_buffer;\n\t\tself\n\t}\n\n\tpub fn input_buffer (\u0026 mut self) -\u003e \u0026 mut VecDeque \u003ci64\u003e {\n\t\t\u0026 mut self.input_buffer\n\t}\n\n\tpub fn queue_input (\u0026 mut self, value: i64) {\n\t\tself.input_buffer.push_back (value);\n\t}\n\n\tpub fn run (\u0026 mut self) -\u003e RunResult {\n\t\tloop {\n\t\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().map_err (\n\t\t\t\t|error| format! (\"[pos={}] {}\", self.pos, error),\n\t\t\t).unwrap ();\n\t\t\tmatch opcode.instr {\n\t\t\t\tInstruction::Add =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 + param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Multiply =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tself.param_set (2, param_0 * param_1);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Input =\u003e {\n\t\t\t\t\tlet value = self.get_input ();\n\t\t\t\t\tself.param_set (0, value);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::Output =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t\treturn RunResult::Output (value);\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfTrue =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value != 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::JumpIfFalse =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tlet dest = self.param_get (1);\n\t\t\t\t\tif value == 0 {\n\t\t\t\t\t\tself.pos = dest;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.pos += 3;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tInstruction::LessThan =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 \u003c param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::Equals =\u003e {\n\t\t\t\t\tlet param_0 = self.param_get (0);\n\t\t\t\t\tlet param_1 = self.param_get (1);\n\t\t\t\t\tlet value = if param_0 == param_1 { 1 } else { 0 };\n\t\t\t\t\tself.param_set (2, value);\n\t\t\t\t\tself.pos += 4;\n\t\t\t\t},\n\t\t\t\tInstruction::AdjustRelBase =\u003e {\n\t\t\t\t\tlet value = self.param_get (0);\n\t\t\t\t\tself.rel += value;\n\t\t\t\t\tself.pos += 2;\n\t\t\t\t},\n\t\t\t\tInstruction::Halt =\u003e {\n\t\t\t\t\treturn RunResult::Halt;\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}\n\n\tfn get_input (\u0026 mut self) -\u003e i64 {\n\t\tif let Some (value) = self.input_buffer.pop_front () {\n\t\t\treturn value;\n\t\t} else {\n\t\t\tpanic! (\"No input\");\n\t\t}\n\t}\n\n\tfn param_get (\u0026 mut self, num: u8) -\u003e i64 {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_get (param),\n\t\t\tMode::Immediate =\u003e param,\n\t\t\tMode::Relative =\u003e self.mem_get (param + self.rel),\n\t\t}\n\t}\n\n\tfn param_set (\u0026 mut self, num: u8, value: i64) {\n\t\tlet opcode: Opcode = self.mem_get (self.pos).try_into ().unwrap ();\n\t\tlet param = self.mem_get (self.pos + 1 + num as i64);\n\t\tmatch opcode.modes [num as usize] {\n\t\t\tMode::Position =\u003e self.mem_set (param, value),\n\t\t\tMode::Immediate =\u003e panic! (),\n\t\t\tMode::Relative =\u003e self.mem_set (param + self.rel, value),\n\t\t}\n\t}\n\n\tfn mem_get (\u0026 mut self, addr: i64) -\u003e i64 {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize]\n\t}\n\n\tfn mem_set (\u0026 mut self, addr: i64, value: i64) {\n\t\tself.mem_extend (addr);\n\t\tself.mem [addr as usize] = value;\n\t}\n\n\tfn mem_extend (\u0026 mut self, addr: i64) {\n\t\tif addr \u003c 0 || addr == i64::MAX { panic! (); }\n\t\tlet size = addr as usize + 1;\n\t\tif size \u003c self.mem.len () {\n\t\t\treturn;\n\t\t}\n\t\tself.mem.extend (iter::repeat (0).take (size - self.mem.len ()));\n\t}\n\n}\n\ntype Mem = Vec \u003ci64\u003e;\n\npub fn from_str (source: \u0026 str) -\u003e Mem {\n\tsource.split (',').map (\n\t\t|item_str| item_str.trim ().parse ().unwrap (),\n\t).collect ()\n}\n\npub enum RunResult {\n\tHalt,\n\tOutput (i64),\n}\n\n#[ derive (Clone, Copy) ]\nstruct Opcode {\n\tinstr: Instruction,\n\tmodes: [Mode; 3],\n}\n\nimpl TryFrom \u003ci64\u003e for Opcode {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cOpcode, String\u003e {\n\t\tOk (Opcode {\n\t\t\tinstr: (value % 100).try_into () ?,\n\t\t\tmodes: [\n\t\t\t\t((value / 100) % 10).into (),\n\t\t\t\t((value / 1000) % 10).into (),\n\t\t\t\t((value / 10000) % 10).into (),\n\t\t\t],\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Instruction {\n\tAdd,\n\tMultiply,\n\tInput,\n\tOutput,\n\tHalt,\n\tJumpIfTrue,\n\tJumpIfFalse,\n\tLessThan,\n\tEquals,\n\tAdjustRelBase,\n}\n\nimpl TryFrom \u003ci64\u003e for Instruction {\n\n\ttype Error = String;\n\n\tfn try_from (value: i64) -\u003e Result \u003cInstruction, String\u003e {\n\t\tOk (match value {\n\t\t\t1 =\u003e Instruction::Add,\n\t\t\t2 =\u003e Instruction::Multiply,\n\t\t\t3 =\u003e Instruction::Input,\n\t\t\t4 =\u003e Instruction::Output,\n\t\t\t5 =\u003e Instruction::JumpIfTrue,\n\t\t\t6 =\u003e Instruction::JumpIfFalse,\n\t\t\t7 =\u003e Instruction::LessThan,\n\t\t\t8 =\u003e Instruction::Equals,\n\t\t\t9 =\u003e Instruction::AdjustRelBase,\n\t\t\t99 =\u003e Instruction::Halt,\n\t\t\t_ =\u003e return Err (format! (\"Invalid instruction: {}\", value)),\n\t\t})\n\t}\n\n}\n\n#[ derive (Clone, Copy, Eq, PartialEq) ]\nenum Mode { Position, Immediate, Relative }\n\nimpl From \u003ci64\u003e for Mode {\n\n\tfn from (value: i64) -\u003e Mode {\n\t\tmatch value {\n\t\t\t0 =\u003e Mode::Position,\n\t\t\t1 =\u003e Mode::Immediate,\n\t\t\t2 =\u003e Mode::Relative,\n\t\t\t_ =\u003e panic! (\"Invalid mode: {}\", value),\n\t\t}\n\t}\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-01","src","lib.rs"],"content":"//! Advent of Code 2021: Day 1: Sonar Sweep\n//!\n//! [https://adventofcode.com/2021/day/1](https://adventofcode.com/2021/day/1)\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Sonar Sweep\";\n\tyear = 2021;\n\tday = 1;\n\tpart_one = |lines| logic::part_one (lines);\n\tpart_two = |lines| logic::part_two (lines);\n}\n\nmod logic {\n\n\tuse super::*;\n\n\tpub fn part_one (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cu64\u003e {\n\t\tlet mut last = None;\n\t\tlet mut num: u64 = 0;\n\t\tfor line in lines {\n\t\t\tif line.trim ().is_empty () { continue }\n\t\t\tlet cur: u64 = line.parse () ?;\n\t\t\tif let Some (last) = last {\n\t\t\t\tif last \u003c cur {\n\t\t\t\t\tnum += 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tlast = Some (cur);\n\t\t}\n\t\tOk (num)\n\t}\n\n\tpub fn part_two (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cu64\u003e {\n\t\tlet mut last_0 = None;\n\t\tlet mut last_1 = None;\n\t\tlet mut last_2 = None;\n\t\tlet mut num: u64 = 0;\n\t\tfor line in lines {\n\t\t\tif line.trim ().is_empty () { continue }\n\t\t\tlet cur: u64 = line.parse () ?;\n\t\t\tif let Some (last_2) = last_2 {\n\t\t\t\tif last_2 \u003c cur {\n\t\t\t\t\tnum += 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tlast_2 = last_1;\n\t\t\tlast_1 = last_0;\n\t\t\tlast_0 = Some (cur);\n\t\t}\n\t\tOk (num)\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"199\", \"200\", \"208\", \"210\", \"200\", \"207\", \"240\", \"269\", \"260\", \"263\"\n\t];\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (7, logic::part_one (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (5, logic::part_two (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":7,"address":[26361,26825],"length":1,"stats":{"Line":0},"fn_name":null},{"line":11,"address":[26446],"length":1,"stats":{"Line":0},"fn_name":null},{"line":12,"address":[26910],"length":1,"stats":{"Line":0},"fn_name":null},{"line":19,"address":[31776],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":20,"address":[31835],"length":1,"stats":{"Line":1},"fn_name":null},{"line":21,"address":[31844],"length":1,"stats":{"Line":1},"fn_name":null},{"line":22,"address":[31853,31962,32263],"length":1,"stats":{"Line":3},"fn_name":null},{"line":23,"address":[31983],"length":1,"stats":{"Line":1},"fn_name":null},{"line":24,"address":[32043,32147],"length":1,"stats":{"Line":1},"fn_name":null},{"line":25,"address":[32194,32132],"length":1,"stats":{"Line":2},"fn_name":null},{"line":26,"address":[32207,32297],"length":1,"stats":{"Line":2},"fn_name":null},{"line":27,"address":[32268,32299],"length":1,"stats":{"Line":1},"fn_name":null},{"line":30,"address":[32217],"length":1,"stats":{"Line":1},"fn_name":null},{"line":32,"address":[31941],"length":1,"stats":{"Line":1},"fn_name":null},{"line":35,"address":[32336],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":36,"address":[32395],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[32404],"length":1,"stats":{"Line":1},"fn_name":null},{"line":38,"address":[32413],"length":1,"stats":{"Line":1},"fn_name":null},{"line":39,"address":[32425],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[32437,32908,32555],"length":1,"stats":{"Line":3},"fn_name":null},{"line":41,"address":[32576],"length":1,"stats":{"Line":1},"fn_name":null},{"line":42,"address":[32743,32636],"length":1,"stats":{"Line":1},"fn_name":null},{"line":43,"address":[32725,32790],"length":1,"stats":{"Line":2},"fn_name":null},{"line":44,"address":[32948,32806],"length":1,"stats":{"Line":2},"fn_name":null},{"line":45,"address":[32953,32913],"length":1,"stats":{"Line":1},"fn_name":null},{"line":48,"address":[32816],"length":1,"stats":{"Line":1},"fn_name":null},{"line":49,"address":[32842],"length":1,"stats":{"Line":1},"fn_name":null},{"line":50,"address":[32862],"length":1,"stats":{"Line":1},"fn_name":null},{"line":52,"address":[32531],"length":1,"stats":{"Line":1},"fn_name":null},{"line":67,"address":[21600,21609],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":68,"address":[23463,23703],"length":1,"stats":{"Line":1},"fn_name":null},{"line":69,"address":[23683],"length":1,"stats":{"Line":1},"fn_name":null},{"line":73,"address":[21657,21648],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":74,"address":[23991,23751],"length":1,"stats":{"Line":1},"fn_name":null},{"line":75,"address":[23971],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":32,"coverable":35},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-02","src","lib.rs"],"content":"//! Advent of Code 2021: Day 2: Dive!\n//!\n//! [https://adventofcode.com/2021/day/2](https://adventofcode.com/2021/day/2)\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Dive!\";\n\tyear = 2021;\n\tday = 2;\n\tpart_one = |lines| logic::part_one (lines);\n\tpart_two = |lines| logic::part_two (lines);\n}\n\nmod logic {\n\n\tuse super::*;\n\n\tpub fn part_one (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003ci64\u003e {\n\t\tlet mut distance: i64 = 0;\n\t\tlet mut depth: i64 = 0;\n\t\tfor line in lines.iter () {\n\t\t\tif line.trim ().is_empty () { continue }\n\t\t\tlet line_parts: Vec \u003c_\u003e = line.split (' ').collect ();\n\t\t\tif line_parts.len () != 2 { panic! () }\n\t\t\tlet line_verb = line_parts [0];\n\t\t\tlet line_arg: i64 = line_parts [1].parse () ?;\n\t\t\tmatch line_verb {\n\t\t\t\t\"forward\" =\u003e distance += line_arg,\n\t\t\t\t\"down\" =\u003e depth += line_arg,\n\t\t\t\t\"up\" =\u003e depth -= line_arg,\n\t\t\t\t_ =\u003e panic! (),\n\t\t\t}\n\t\t}\n\t\tOk (distance * depth)\n\t}\n\n\tpub fn part_two (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003ci64\u003e {\n\t\tlet mut distance: i64 = 0;\n\t\tlet mut depth: i64 = 0;\n\t\tlet mut aim: i64 = 0;\n\t\tfor line in lines.iter () {\n\t\t\tif line.trim ().is_empty () { continue }\n\t\t\tlet line_parts: Vec \u003c_\u003e = line.split (' ').collect ();\n\t\t\tif line_parts.len () != 2 { panic! () }\n\t\t\tlet line_verb = line_parts [0];\n\t\t\tlet line_arg: i64 = line_parts [1].parse () ?;\n\t\t\tmatch line_verb {\n\t\t\t\t\"forward\" =\u003e {\n\t\t\t\t\tdistance += line_arg;\n\t\t\t\t\tdepth += aim * line_arg;\n\t\t\t\t},\n\t\t\t\t\"down\" =\u003e aim += line_arg,\n\t\t\t\t\"up\" =\u003e aim -= line_arg,\n\t\t\t\t_ =\u003e panic! (),\n\t\t\t}\n\t\t}\n\t\tOk (distance * depth)\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"forward 5\",\n\t\t\"down 5\",\n\t\t\"forward 8\",\n\t\t\"up 3\",\n\t\t\"down 8\",\n\t\t\"forward 2\",\n\t];\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (150, logic::part_one (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (900, logic::part_two (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":7,"address":[24985,25449],"length":1,"stats":{"Line":0},"fn_name":null},{"line":11,"address":[25070],"length":1,"stats":{"Line":0},"fn_name":null},{"line":12,"address":[25534],"length":1,"stats":{"Line":0},"fn_name":null},{"line":19,"address":[19056,20269],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":20,"address":[19133],"length":1,"stats":{"Line":1},"fn_name":null},{"line":21,"address":[19145],"length":1,"stats":{"Line":1},"fn_name":null},{"line":22,"address":[19337,19157],"length":1,"stats":{"Line":2},"fn_name":null},{"line":23,"address":[19358],"length":1,"stats":{"Line":1},"fn_name":null},{"line":24,"address":[19424],"length":1,"stats":{"Line":1},"fn_name":null},{"line":25,"address":[19586,19472,19545],"length":1,"stats":{"Line":2},"fn_name":null},{"line":26,"address":[19551,19623],"length":1,"stats":{"Line":2},"fn_name":null},{"line":27,"address":[19656,19834],"length":1,"stats":{"Line":1},"fn_name":null},{"line":29,"address":[19803,19900,19944],"length":1,"stats":{"Line":3},"fn_name":null},{"line":30,"address":[20035,19916,20079],"length":1,"stats":{"Line":3},"fn_name":null},{"line":31,"address":[20051,20195,20151],"length":1,"stats":{"Line":3},"fn_name":null},{"line":32,"address":[20157],"length":1,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[20311,20327,19296],"length":1,"stats":{"Line":2},"fn_name":null},{"line":38,"address":[20368,21734],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":39,"address":[20445],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[20457],"length":1,"stats":{"Line":1},"fn_name":null},{"line":41,"address":[20469],"length":1,"stats":{"Line":1},"fn_name":null},{"line":42,"address":[20661,20481],"length":1,"stats":{"Line":2},"fn_name":null},{"line":43,"address":[20682],"length":1,"stats":{"Line":1},"fn_name":null},{"line":44,"address":[20754],"length":1,"stats":{"Line":1},"fn_name":null},{"line":45,"address":[20875,20916,20802],"length":1,"stats":{"Line":2},"fn_name":null},{"line":46,"address":[20953,20881],"length":1,"stats":{"Line":2},"fn_name":null},{"line":47,"address":[20986,21164],"length":1,"stats":{"Line":1},"fn_name":null},{"line":49,"address":[21230,21133,21444],"length":1,"stats":{"Line":3},"fn_name":null},{"line":50,"address":[21277,21338],"length":1,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[21376,21446,21315],"length":1,"stats":{"Line":2},"fn_name":null},{"line":53,"address":[21246,21546,21502],"length":1,"stats":{"Line":3},"fn_name":null},{"line":54,"address":[21618,21662,21518],"length":1,"stats":{"Line":3},"fn_name":null},{"line":55,"address":[21624],"length":1,"stats":{"Line":0},"fn_name":null},{"line":58,"address":[20620,21776,21792],"length":1,"stats":{"Line":2},"fn_name":null},{"line":78,"address":[27497,27488],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":79,"address":[28006,27767],"length":1,"stats":{"Line":1},"fn_name":null},{"line":80,"address":[27986],"length":1,"stats":{"Line":1},"fn_name":null},{"line":84,"address":[27545,27536],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":85,"address":[28055,28294],"length":1,"stats":{"Line":1},"fn_name":null},{"line":86,"address":[28274],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":35,"coverable":40},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-03","src","lib.rs"],"content":"//! Advent of Code 2021: Day 3: Binary Diagnostic\n//!\n//! [https://adventofcode.com/2021/day/3](https://adventofcode.com/2021/day/3)\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Binary Diagnostic\";\n\tyear = 2021;\n\tday = 3;\n\tpart_one = |lines| logic::part_one (lines);\n\tpart_two = |lines| logic::part_two (lines);\n}\n\nmod logic {\n\n\tuse super::*;\n\tuse model::Mode;\n\n\tpub fn part_one (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003ci64\u003e {\n\t\tlet mut sums: Vec \u003ci64\u003e = Vec::new ();\n\t\tfor line in lines {\n\t\t\tif line.trim ().is_empty () { continue }\n\t\t\tlet sums_temp = sums;\n\t\t\tlet prev_sums = Iterator::chain (sums_temp.iter_vals (), iter::repeat (0));\n\t\t\tsums = Vec::new ();\n\t\t\tfor (ch, sum) in iter::zip (line.chars (), prev_sums) {\n\t\t\t\tsums.push (sum + match ch {\n\t\t\t\t\t'0' =\u003e -1,\n\t\t\t\t\t'1' =\u003e 1,\n\t\t\t\t\t_ =\u003e Err (format! (\"Invalid bit: {}\", ch)) ?,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tfor sum in sums.iter_vals () {\n\t\t\tif sum == 0 {\n\t\t\t\tErr (\"Equal number of bits\") ?;\n\t\t\t}\n\t\t}\n\t\tlet gamma_str: String = sums.iter ().map (|sum|\n\t\t\tmatch sum.signum () {\n\t\t\t\t-1 =\u003e '0',\n\t\t\t\t1 =\u003e '1',\n\t\t\t\t_ =\u003e unreachable! (),\n\t\t\t}\n\t\t).collect ();\n\t\tlet gamma = i64::from_str_radix (\u0026 gamma_str, 2) ?;\n\t\tlet epsilon_str: String = sums.iter ().map (|sum|\n\t\t\tmatch sum.signum () {\n\t\t\t\t-1 =\u003e '1',\n\t\t\t\t1 =\u003e '0',\n\t\t\t\t_ =\u003e unreachable! (),\n\t\t\t}\n\t\t).collect ();\n\t\tlet epsilon = i64::from_str_radix (\u0026 epsilon_str, 2) ?;\n\t\tOk (gamma * epsilon)\n\t}\n\n\tpub fn part_two (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003ci64\u003e {\n\t\tlet oxygen = calc_rating (lines.to_vec (), Mode::Oxygen) ?;\n\t\tlet co2 = calc_rating (lines.to_vec (), Mode::CO2) ?;\n\t\tOk (oxygen * co2)\n\t}\n\n\tfn calc_rating (mut lines: Vec \u003c\u0026 str\u003e, mode: Mode) -\u003e GenResult \u003ci64\u003e {\n\t\tlet mut offset: usize = 0;\n\t\twhile lines.len () \u003e 1 {\n\t\t\tlet mut sum: i64 = 0;\n\t\t\tfor line in lines.iter () {\n\t\t\t\tsum += if line.chars ().nth (offset).unwrap () == '1' { 1 } else { -1 };\n\t\t\t}\n\t\t\tlet sel = if (sum \u003c 0) == (mode == Mode::Oxygen) { '0' } else { '1' };\n\t\t\tlines.retain (|line| line.chars ().nth (offset).unwrap () == sel);\n\t\t\toffset += 1;\n\t\t}\n\t\tOk (i64::from_str_radix (lines [0], 2) ?)\n\t}\n\n}\n\nmod model {\n\n\t#[ derive (Clone, Copy, PartialEq, Eq) ]\n\tpub enum Mode { Oxygen, CO2 }\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"00100\", \"11110\", \"10110\", \"10111\", \"10101\", \"01111\",\n\t\t\"00111\", \"11100\", \"10000\", \"11001\", \"00010\", \"01010\",\n\t];\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (198, logic::part_one (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (230, logic::part_two (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":7,"address":[52345,52809],"length":1,"stats":{"Line":0},"fn_name":null},{"line":11,"address":[52430],"length":1,"stats":{"Line":0},"fn_name":null},{"line":12,"address":[52894],"length":1,"stats":{"Line":0},"fn_name":null},{"line":20,"address":[34256,37038,35805],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":21,"address":[34311],"length":1,"stats":{"Line":1},"fn_name":null},{"line":22,"address":[34558,34440,34356],"length":1,"stats":{"Line":3},"fn_name":null},{"line":23,"address":[34582],"length":1,"stats":{"Line":1},"fn_name":null},{"line":24,"address":[34659],"length":1,"stats":{"Line":1},"fn_name":null},{"line":25,"address":[34806,34707],"length":1,"stats":{"Line":2},"fn_name":null},{"line":26,"address":[34868],"length":1,"stats":{"Line":1},"fn_name":null},{"line":27,"address":[34923,35177],"length":1,"stats":{"Line":2},"fn_name":null},{"line":28,"address":[35722,35215],"length":1,"stats":{"Line":2},"fn_name":null},{"line":29,"address":[35285],"length":1,"stats":{"Line":1},"fn_name":null},{"line":30,"address":[35302],"length":1,"stats":{"Line":1},"fn_name":null},{"line":31,"address":[35335,35250],"length":1,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[34532,35832,36003],"length":1,"stats":{"Line":3},"fn_name":null},{"line":36,"address":[36019],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[36029],"length":1,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[35977,36231],"length":1,"stats":{"Line":4},"fn_name":null},{"line":41,"address":[50974,51054],"length":1,"stats":{"Line":2},"fn_name":null},{"line":42,"address":[51104],"length":1,"stats":{"Line":1},"fn_name":null},{"line":43,"address":[51114],"length":1,"stats":{"Line":1},"fn_name":null},{"line":44,"address":[51074],"length":1,"stats":{"Line":0},"fn_name":null},{"line":47,"address":[36385,36314,36512],"length":1,"stats":{"Line":2},"fn_name":null},{"line":48,"address":[36578,36487],"length":1,"stats":{"Line":4},"fn_name":null},{"line":49,"address":[51230,51150],"length":1,"stats":{"Line":2},"fn_name":null},{"line":50,"address":[51280],"length":1,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[51290],"length":1,"stats":{"Line":1},"fn_name":null},{"line":52,"address":[51250],"length":1,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[36726,36850,36655],"length":1,"stats":{"Line":2},"fn_name":null},{"line":56,"address":[36820,36971,36941],"length":1,"stats":{"Line":2},"fn_name":null},{"line":59,"address":[37088],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":60,"address":[37131,37265],"length":1,"stats":{"Line":1},"fn_name":null},{"line":61,"address":[37244,37451,37318],"length":1,"stats":{"Line":2},"fn_name":null},{"line":62,"address":[37526,37428,37510],"length":1,"stats":{"Line":2},"fn_name":null},{"line":65,"address":[37568,38550],"length":1,"stats":{"Line":1},"fn_name":"calc_rating"},{"line":66,"address":[37607],"length":1,"stats":{"Line":1},"fn_name":null},{"line":67,"address":[38334,37686,37624],"length":1,"stats":{"Line":3},"fn_name":null},{"line":68,"address":[37732],"length":1,"stats":{"Line":1},"fn_name":null},{"line":69,"address":[37744,37960,38159],"length":1,"stats":{"Line":3},"fn_name":null},{"line":70,"address":[38164,37976],"length":1,"stats":{"Line":1},"fn_name":null},{"line":72,"address":[37915,38204],"length":1,"stats":{"Line":2},"fn_name":null},{"line":73,"address":[38252],"length":1,"stats":{"Line":3},"fn_name":null},{"line":74,"address":[38339,38299],"length":1,"stats":{"Line":1},"fn_name":null},{"line":76,"address":[37697,38377,38505],"length":1,"stats":{"Line":2},"fn_name":null},{"line":99,"address":[40752],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":100,"address":[40759,40998],"length":1,"stats":{"Line":1},"fn_name":null},{"line":101,"address":[40978],"length":1,"stats":{"Line":1},"fn_name":null},{"line":105,"address":[41040],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":106,"address":[41047,41286],"length":1,"stats":{"Line":1},"fn_name":null},{"line":107,"address":[41266],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":44,"coverable":51},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-04","src","lib.rs"],"content":"//! Advent of Code 2021: Day 4: Giant Squid\n//!\n//! [https://adventofcode.com/2021/day/4](https://adventofcode.com/2021/day/4)\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Giant Squid\";\n\tyear = 2021;\n\tday = 4;\n\tpart_one = |lines| logic::part_one (lines);\n\tpart_two = |lines| logic::part_two (lines);\n}\n\nmod logic {\n\n\tuse super::*;\n\tuse model::Board;\n\tuse model::Input;\n\tuse nums::IntConv;\n\n\tpub fn part_one (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003ci64\u003e {\n\t\tlet input = Input::parse (lines) ?;\n\t\tOk (scores_iter (\u0026 input).next ().unwrap ())\n\t}\n\n\tpub fn part_two (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003ci64\u003e {\n\t\tlet input = Input::parse (lines) ?;\n\t\tOk (scores_iter (\u0026 input).last ().unwrap ())\n\t}\n\n\tfn scores_iter (input: \u0026 Rc \u003cInput\u003e) -\u003e ScoresIter {\n\t\tScoresIter {\n\t\t\tinput: Rc::clone (input),\n\t\t\tboards: iter::repeat (false).take (input.boards.len ()).collect (),\n\t\t\tcall_idx: 0,\n\t\t\tboard_idx: 0,\n\t\t}\n\t}\n\n\tstruct ScoresIter {\n\t\tinput: Rc \u003cInput\u003e,\n\t\tboards: Vec \u003cbool\u003e,\n\t\tcall_idx: usize,\n\t\tboard_idx: usize,\n\t}\n\n\timpl Iterator for ScoresIter {\n\t\ttype Item = i64;\n\t\tfn next (\u0026 mut self) -\u003e Option \u003ci64\u003e {\n\t\t\tloop {\n\t\t\t\tif self.board_idx == self.boards.len () {\n\t\t\t\t\tself.board_idx = 0;\n\t\t\t\t\tself.call_idx += 1;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif self.call_idx == self.input.call_order.len () {\n\t\t\t\t\treturn None;\n\t\t\t\t}\n\t\t\t\tif self.boards [self.board_idx] {\n\t\t\t\t\tself.board_idx += 1;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif let Some (score) = calc_score (\n\t\t\t\t\t\u0026 self.input.call_order [0 .. self.call_idx + 1],\n\t\t\t\t\t\u0026 self.input.boards [self.board_idx],\n\t\t\t\t) {\n\t\t\t\t\tself.boards [self.board_idx] = true;\n\t\t\t\t\tself.board_idx += 1;\n\t\t\t\t\treturn Some (score.as_i64 ()\n\t\t\t\t\t\t* self.input.call_order [self.call_idx].as_i64 (),\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t\tself.board_idx += 1;\n\t\t\t}\n\t\t}\n\t}\n\n\tfn calc_score (called: \u0026 [u8], board: \u0026 Board) -\u003e Option \u003cu16\u003e {\n\t\tfn check \u003cI: Iterator \u003cItem = u8\u003e\u003e (called: \u0026 [u8], mut nums: I) -\u003e bool {\n\t\t\tnums.all (|num| called.contains (\u0026 num))\n\t\t}\n\t\tlet mut winner = false;\n\t\tfor row in 0 .. 5 {\n\t\t\tif check (called, board.iter_vals ().skip (row * 5).take (5)) { winner = true }\n\t\t}\n\t\tfor col in 0 .. 5 {\n\t\t\tif check (called, board.iter_vals ().skip (col).step_by (5)) { winner = true }\n\t\t}\n\t\twinner.then_some (board.iter_vals ()\n\t\t\t.filter (|num| ! called.contains (num))\n\t\t\t.map (IntConv::as_u16)\n\t\t\t.sum ())\n\t}\n\n}\n\nmod model {\n\n\tuse super::*;\n\n\tpub type Board = [u8; 25];\n\n\tpub struct Input {\n\t\tpub call_order: Vec \u003cu8\u003e,\n\t\tpub boards: Vec \u003cBoard\u003e,\n\t}\n\n\timpl Input {\n\t\tpub fn parse (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cRc \u003cSelf\u003e\u003e {\n\n\t\t\tlet call_order: Vec \u003cu8\u003e =\n\t\t\t\tlines [0]\n\t\t\t\t\t.split (',')\n\t\t\t\t\t.map (|num_str| num_str\n\t\t\t\t\t\t.parse ()\n\t\t\t\t\t\t.map_err (|_err| \"Invalid input\".into ()))\n\t\t\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e () ?;\n\n\t\t\tlet boards: Vec \u003cBoard\u003e =\n\t\t\t\tlines [2 ..].chunks (6)\n\t\t\t\t\t.map (|board_lines| board_lines.iter ()\n\t\t\t\t\t\t.take (5)\n\t\t\t\t\t\t.flat_map (|board_line| board_line\n\t\t\t\t\t\t\t.split_whitespace ()\n\t\t\t\t\t\t\t.map (|num_str| num_str\n\t\t\t\t\t\t\t\t.parse ()\n\t\t\t\t\t\t\t\t.unwrap ()))\n\t\t\t\t\t\t.collect_array ()\n\t\t\t\t\t\t.ok_or_else (|| \"Invalid input\".into ()))\n\t\t\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e () ?;\n\n\t\t\tOk (Self { call_order, boards }.into ())\n\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"7,4,9,5,11,17,23,2,0,14,21,24,10,16,13,6,15,25,12,22,18,20,8,19,3,26,1\",\n\t\t\"\",\n\t\t\"22 13 17 11  0\",\n\t\t\" 8  2 23  4 24\",\n\t\t\"21  9 14 16  7\",\n\t\t\" 6 10  3 18  5\",\n\t\t\" 1 12 20 15 19\",\n\t\t\"\",\n\t\t\" 3 15  0  2 22\",\n\t\t\" 9 18 13 17  5\",\n\t\t\"19  8  7 25 23\",\n\t\t\"20 11 10 24  4\",\n\t\t\"14 21 16 12  6\",\n\t\t\"\",\n\t\t\"14 21 17 24  4\",\n\t\t\"10 16 15  9 19\",\n\t\t\"18  8 23 26 20\",\n\t\t\"22 11 13  6  5\",\n\t\t\" 2  0 12  3  7\",\n\t];\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (4512, logic::part_one (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (1924, logic::part_two (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":7,"address":[87849,88313],"length":1,"stats":{"Line":0},"fn_name":null},{"line":11,"address":[87934],"length":1,"stats":{"Line":0},"fn_name":null},{"line":12,"address":[88398],"length":1,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[83663,83440],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":23,"address":[83473,83554],"length":1,"stats":{"Line":1},"fn_name":null},{"line":24,"address":[83733,83646,83542],"length":1,"stats":{"Line":3},"fn_name":null},{"line":27,"address":[84130,83840],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":28,"address":[83873,83954],"length":1,"stats":{"Line":1},"fn_name":null},{"line":29,"address":[83942,84046],"length":1,"stats":{"Line":2},"fn_name":null},{"line":32,"address":[84443,84160],"length":1,"stats":{"Line":1},"fn_name":"scores_iter"},{"line":34,"address":[84195],"length":1,"stats":{"Line":1},"fn_name":null},{"line":35,"address":[84207,84300],"length":1,"stats":{"Line":2},"fn_name":null},{"line":50,"address":[84480],"length":1,"stats":{"Line":1},"fn_name":"next"},{"line":51,"address":[85396],"length":1,"stats":{"Line":1},"fn_name":null},{"line":52,"address":[84511],"length":1,"stats":{"Line":1},"fn_name":null},{"line":53,"address":[84641],"length":1,"stats":{"Line":1},"fn_name":null},{"line":54,"address":[84697,84649],"length":1,"stats":{"Line":1},"fn_name":null},{"line":57,"address":[84631,84569,84735],"length":1,"stats":{"Line":3},"fn_name":null},{"line":58,"address":[84812],"length":1,"stats":{"Line":1},"fn_name":null},{"line":60,"address":[84856,84778],"length":1,"stats":{"Line":2},"fn_name":null},{"line":61,"address":[84929,84977],"length":1,"stats":{"Line":1},"fn_name":null},{"line":65,"address":[85028,84869,84919],"length":1,"stats":{"Line":3},"fn_name":null},{"line":66,"address":[85216,85156],"length":1,"stats":{"Line":2},"fn_name":null},{"line":68,"address":[85444,85320],"length":1,"stats":{"Line":2},"fn_name":null},{"line":69,"address":[85447,85505],"length":1,"stats":{"Line":1},"fn_name":null},{"line":70,"address":[85489,85700,85654],"length":1,"stats":{"Line":2},"fn_name":null},{"line":71,"address":[85543,85603],"length":1,"stats":{"Line":2},"fn_name":null},{"line":74,"address":[85359,85401],"length":1,"stats":{"Line":1},"fn_name":null},{"line":79,"address":[85744],"length":1,"stats":{"Line":1},"fn_name":"calc_score"},{"line":80,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":81,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":83,"address":[85796],"length":1,"stats":{"Line":1},"fn_name":null},{"line":84,"address":[86019,85804],"length":1,"stats":{"Line":2},"fn_name":null},{"line":85,"address":[86040],"length":1,"stats":{"Line":1},"fn_name":null},{"line":87,"address":[86232,85950,86347],"length":1,"stats":{"Line":3},"fn_name":null},{"line":88,"address":[86368],"length":1,"stats":{"Line":1},"fn_name":null},{"line":90,"address":[86308,86532],"length":1,"stats":{"Line":2},"fn_name":null},{"line":91,"address":[86516],"length":1,"stats":{"Line":3},"fn_name":null},{"line":110,"address":[47705,46720],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":112,"address":[46763],"length":1,"stats":{"Line":1},"fn_name":null},{"line":115,"address":[91824,91879],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":117,"address":[91936,91947],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":120,"address":[47165,46999,47533],"length":1,"stats":{"Line":2},"fn_name":null},{"line":122,"address":[92000,92065],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":124,"address":[92200,92176],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":126,"address":[92301,92256],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":130,"address":[92368,92372],"length":1,"stats":{"Line":0},"fn_name":"{closure#1}"},{"line":133,"address":[47335,47658],"length":1,"stats":{"Line":2},"fn_name":null},{"line":168,"address":[47904],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":169,"address":[48150,47911],"length":1,"stats":{"Line":1},"fn_name":null},{"line":170,"address":[48130],"length":1,"stats":{"Line":1},"fn_name":null},{"line":174,"address":[48192],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":175,"address":[48438,48199],"length":1,"stats":{"Line":1},"fn_name":null},{"line":176,"address":[48418],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":49,"coverable":54},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-05","src","lib.rs"],"content":"//! Advent of Code 2021: Day 5: Hydrothermal Venture\n//!\n//! [https://adventofcode.com/2021/day/5](https://adventofcode.com/2021/day/5)\n\nuse aoc_common::*;\nuse aoc_grid as grid;\nuse aoc_pos as pos;\n\npuzzle_info! {\n\tname = \"Hydrothermal Venture\";\n\tyear = 2021;\n\tday = 5;\n\tpart_one = |lines| logic::part_one (lines);\n\tpart_two = |lines| logic::part_two (lines);\n}\n\nmod logic {\n\n\tuse super::*;\n\tuse grid::Grid;\n\tuse model::Pos;\n\tuse nums::IntConv;\n\n\tpub fn part_one (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003ci64\u003e {\n\t\tcalc_result (lines, false)\n\t}\n\n\tpub fn part_two (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003ci64\u003e {\n\t\tcalc_result (lines, true)\n\t}\n\n\tpub fn calc_result (lines: \u0026 [\u0026 str], include_diagonal: bool) -\u003e GenResult \u003ci64\u003e {\n\t\tlet mut vents = model::parse_input (lines) ?;\n\t\tif ! include_diagonal {\n\t\t\tvents.retain (|vent| ! vent.is_diagonal ());\n\t\t}\n\t\tlet size = vents.iter ()\n\t\t\t.flat_map (|vent| [ vent.start, vent.end ])\n\t\t\t.fold (Pos::ZERO, |max, pos| Pos {\n\t\t\t\tx: cmp::max (max.x, pos.x + 1),\n\t\t\t\ty: cmp::max (max.y, pos.y + 1),\n\t\t\t});\n\t\tlet mut points: Grid \u003cVec \u003cu16\u003e, Pos\u003e =\n\t\t\tGrid::wrap (\n\t\t\t\titer::repeat (0).take (size.x.as_usize () * size.y.as_usize ()).collect (),\n\t\t\t\t[0, 0],\n\t\t\t\t[size.y.as_usize (), size.x.as_usize ()]);\n\t\tfor vent in vents {\n\t\t\tlet step = Pos {\n\t\t\t\tx: (vent.end.x - vent.start.x).signum (),\n\t\t\t\ty: (vent.end.y - vent.start.y).signum (),\n\t\t\t};\n\t\t\tlet mut pos = vent.start;\n\t\t\tloop {\n\t\t\t\t* points.get_mut (pos).unwrap () += 1;\n\t\t\t\tif pos == vent.end { break }\n\t\t\t\tpos.x += step.x;\n\t\t\t\tpos.y += step.y;\n\t\t\t}\n\t\t}\n\t\tOk (points.values ().filter (|\u0026 num| num \u003e 1).count ().as_i64 ())\n\t}\n\n}\n\nmod model {\n\n\tuse super::*;\n\n\tpub type Pos = pos::PosYX \u003ci16\u003e;\n\n\tpub fn parse_input (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cVec \u003cVent\u003e\u003e {\n\t\tlet mut vents: Vec \u003cVent\u003e = Vec::new ();\n\t\tfor line in lines {\n\t\t\tlet line_parts: Vec \u003c\u0026 str\u003e = line.split (\" -\u003e \").collect ();\n\t\t\tif line_parts.len () != 2 {\n\t\t\t\tErr (format! (\"Invalid input: {}\", line)) ?;\n\t\t\t}\n\t\t\tvents.push (Vent {\n\t\t\t\tstart: parse_pos (line_parts [0]) ?,\n\t\t\t\tend: parse_pos (line_parts [1]) ?,\n\t\t\t});\n\t\t}\n\t\tOk (vents)\n\t}\n\n\tpub fn parse_pos (input: \u0026 str) -\u003e GenResult \u003cPos\u003e {\n\t\tlet input_parts: Vec \u003c\u0026 str\u003e = input.split (',').collect ();\n\t\tif input_parts.len () != 2 {\n\t\t\tErr (format! (\"Input position: {}\", input)) ?;\n\t\t}\n\t\tOk (Pos {\n\t\t\tx: input_parts [0].parse () ?,\n\t\t\ty: input_parts [1].parse () ?,\n\t\t})\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, Hash, PartialEq) ]\n\tpub struct Vent { pub start: Pos, pub end: Pos }\n\n\timpl Vent {\n\t\tpub const fn is_diagonal (self) -\u003e bool {\n\t\t\tself.start.x != self.end.x \u0026\u0026 self.start.y != self.end.y\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"0,9 -\u003e 5,9\",\n\t\t\"8,0 -\u003e 0,8\",\n\t\t\"9,4 -\u003e 3,4\",\n\t\t\"2,2 -\u003e 2,1\",\n\t\t\"7,0 -\u003e 7,4\",\n\t\t\"6,4 -\u003e 2,0\",\n\t\t\"0,9 -\u003e 2,9\",\n\t\t\"3,4 -\u003e 1,4\",\n\t\t\"0,0 -\u003e 8,8\",\n\t\t\"5,5 -\u003e 8,2\",\n\t];\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (5, logic::part_one (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (12, logic::part_two (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":9,"address":[55209,55673],"length":1,"stats":{"Line":0},"fn_name":null},{"line":13,"address":[55294],"length":1,"stats":{"Line":0},"fn_name":null},{"line":14,"address":[55758],"length":1,"stats":{"Line":0},"fn_name":null},{"line":24,"address":[31520],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":25,"address":[31541],"length":1,"stats":{"Line":1},"fn_name":null},{"line":28,"address":[31568],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":29,"address":[31589],"length":1,"stats":{"Line":1},"fn_name":null},{"line":32,"address":[33765,32679,31616],"length":1,"stats":{"Line":1},"fn_name":"calc_result"},{"line":33,"address":[31673,31869],"length":1,"stats":{"Line":1},"fn_name":null},{"line":34,"address":[31853],"length":1,"stats":{"Line":1},"fn_name":null},{"line":35,"address":[33934,33920],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":37,"address":[32042,31945],"length":1,"stats":{"Line":2},"fn_name":null},{"line":38,"address":[33984,34001],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":39,"address":[34257,34048],"length":1,"stats":{"Line":2},"fn_name":"{closure#2}"},{"line":40,"address":[34096],"length":1,"stats":{"Line":1},"fn_name":null},{"line":41,"address":[34174],"length":1,"stats":{"Line":1},"fn_name":null},{"line":45,"address":[32197],"length":1,"stats":{"Line":1},"fn_name":null},{"line":46,"address":[32406],"length":1,"stats":{"Line":1},"fn_name":null},{"line":47,"address":[32669,32430,32590],"length":1,"stats":{"Line":2},"fn_name":null},{"line":48,"address":[32730,32598],"length":1,"stats":{"Line":2},"fn_name":null},{"line":50,"address":[32910,33040],"length":1,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[33073,33203],"length":1,"stats":{"Line":1},"fn_name":null},{"line":53,"address":[33262],"length":1,"stats":{"Line":1},"fn_name":null},{"line":54,"address":[33582],"length":1,"stats":{"Line":1},"fn_name":null},{"line":55,"address":[33294,33418],"length":1,"stats":{"Line":1},"fn_name":null},{"line":56,"address":[33391,33455],"length":1,"stats":{"Line":2},"fn_name":null},{"line":57,"address":[33465,33536],"length":1,"stats":{"Line":1},"fn_name":null},{"line":58,"address":[33574,33587,33506],"length":1,"stats":{"Line":2},"fn_name":null},{"line":61,"address":[33628],"length":1,"stats":{"Line":3},"fn_name":null},{"line":72,"address":[37248,38647],"length":1,"stats":{"Line":1},"fn_name":"parse_input"},{"line":73,"address":[37291],"length":1,"stats":{"Line":1},"fn_name":null},{"line":74,"address":[37311,37379,37549],"length":1,"stats":{"Line":3},"fn_name":null},{"line":75,"address":[37565],"length":1,"stats":{"Line":1},"fn_name":null},{"line":76,"address":[37631,37977,37704],"length":1,"stats":{"Line":2},"fn_name":null},{"line":77,"address":[37987,37748],"length":1,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[38467],"length":1,"stats":{"Line":1},"fn_name":null},{"line":80,"address":[38349,37710,38129,38276],"length":1,"stats":{"Line":2},"fn_name":null},{"line":81,"address":[38524,38235,38361],"length":1,"stats":{"Line":2},"fn_name":null},{"line":84,"address":[37462],"length":1,"stats":{"Line":1},"fn_name":null},{"line":87,"address":[38688,39709],"length":1,"stats":{"Line":1},"fn_name":"parse_pos"},{"line":88,"address":[38715],"length":1,"stats":{"Line":1},"fn_name":null},{"line":89,"address":[38763,39097,38830],"length":1,"stats":{"Line":2},"fn_name":null},{"line":90,"address":[39107,38871],"length":1,"stats":{"Line":0},"fn_name":null},{"line":92,"address":[39595],"length":1,"stats":{"Line":1},"fn_name":null},{"line":93,"address":[39249,38836,39412],"length":1,"stats":{"Line":2},"fn_name":null},{"line":94,"address":[39374,39465,39661],"length":1,"stats":{"Line":2},"fn_name":null},{"line":102,"address":[39744],"length":1,"stats":{"Line":1},"fn_name":"is_diagonal"},{"line":103,"address":[39762],"length":1,"stats":{"Line":1},"fn_name":null},{"line":128,"address":[43840],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":129,"address":[43847,44086],"length":1,"stats":{"Line":1},"fn_name":null},{"line":130,"address":[44066],"length":1,"stats":{"Line":1},"fn_name":null},{"line":133,"address":[44128],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":134,"address":[44374,44135],"length":1,"stats":{"Line":1},"fn_name":null},{"line":135,"address":[44354],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":49,"coverable":54},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-06","src","lib.rs"],"content":"//! Advent of Code 2021: Day 6: Lanternfish\n//!\n//! [https://adventofcode.com/2021/day/6](https://adventofcode.com/2021/day/6)\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Lanternfish\";\n\tyear = 2021;\n\tday = 6;\n\tpart_one = |lines| logic::part_one (lines [0]);\n\tpart_two = |lines| logic::part_two (lines [0]);\n}\n\nmod logic {\n\n\tuse super::*;\n\tuse nums::IntConv;\n\n\tpub fn part_one (input: \u0026 str) -\u003e GenResult \u003cu64\u003e {\n\t\tcalc_result (input, 80)\n\t}\n\n\tpub fn part_two (input: \u0026 str) -\u003e GenResult \u003cu64\u003e {\n\t\tcalc_result (input, 256)\n\t}\n\n\tpub fn calc_result (input: \u0026 str, days: u64) -\u003e GenResult \u003cu64\u003e {\n\t\tlet mut fishes: [u64; 9] = [0; 9];\n\t\tfor fish_str in input.split (',') {\n\t\t\tlet fish: usize = fish_str.parse () ?;\n\t\t\tfishes [fish] += 1;\n\t\t}\n\t\tfor _ in 0 .. days {\n\t\t\tfishes = [\n\t\t\t\tfishes [1],\n\t\t\t\tfishes [2],\n\t\t\t\tfishes [3],\n\t\t\t\tfishes [4],\n\t\t\t\tfishes [5],\n\t\t\t\tfishes [6],\n\t\t\t\tfishes [7] + fishes [0],\n\t\t\t\tfishes [8],\n\t\t\t\tfishes [0],\n\t\t\t];\n\t\t}\n\t\tOk (fishes.into_iter ().sum::\u003cu64\u003e ().as_u64 ())\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 str = \"3,4,3,1,2\";\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (5934, logic::part_one (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (26984457539, logic::part_two (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":7,"address":[17881,18409],"length":1,"stats":{"Line":0},"fn_name":null},{"line":11,"address":[17997,17976],"length":1,"stats":{"Line":0},"fn_name":null},{"line":12,"address":[18504,18525],"length":1,"stats":{"Line":0},"fn_name":null},{"line":20,"address":[28080],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":21,"address":[28101],"length":1,"stats":{"Line":1},"fn_name":null},{"line":24,"address":[28128],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":25,"address":[28149],"length":1,"stats":{"Line":1},"fn_name":null},{"line":28,"address":[28176],"length":1,"stats":{"Line":2},"fn_name":"calc_result"},{"line":29,"address":[28241],"length":1,"stats":{"Line":2},"fn_name":null},{"line":30,"address":[28716,28277,28463],"length":1,"stats":{"Line":6},"fn_name":null},{"line":31,"address":[28495,28594],"length":1,"stats":{"Line":2},"fn_name":null},{"line":32,"address":[28721,28644,28576],"length":1,"stats":{"Line":4},"fn_name":null},{"line":34,"address":[28407,28761,29114],"length":1,"stats":{"Line":6},"fn_name":null},{"line":35,"address":[29042],"length":1,"stats":{"Line":2},"fn_name":null},{"line":36,"address":[28881],"length":1,"stats":{"Line":2},"fn_name":null},{"line":37,"address":[28894],"length":1,"stats":{"Line":2},"fn_name":null},{"line":38,"address":[28907],"length":1,"stats":{"Line":2},"fn_name":null},{"line":39,"address":[28920],"length":1,"stats":{"Line":2},"fn_name":null},{"line":40,"address":[28933],"length":1,"stats":{"Line":2},"fn_name":null},{"line":41,"address":[28946],"length":1,"stats":{"Line":2},"fn_name":null},{"line":42,"address":[29119,28959],"length":1,"stats":{"Line":2},"fn_name":null},{"line":43,"address":[29026],"length":1,"stats":{"Line":2},"fn_name":null},{"line":44,"address":[29034],"length":1,"stats":{"Line":2},"fn_name":null},{"line":47,"address":[29149,28829],"length":1,"stats":{"Line":4},"fn_name":null},{"line":60,"address":[24009,24000],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":61,"address":[37111,37349],"length":1,"stats":{"Line":1},"fn_name":null},{"line":62,"address":[37329],"length":1,"stats":{"Line":1},"fn_name":null},{"line":66,"address":[24048,24057],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":67,"address":[37637,37399],"length":1,"stats":{"Line":1},"fn_name":null},{"line":68,"address":[37617],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":27,"coverable":30},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-07","src","lib.rs"],"content":"//! Advent of Code 2021: Day 7: The Treachery of Whales\n//!\n//! [https://adventofcode.com/2021/day/7](https://adventofcode.com/2021/day/7)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"The Treachery of Whales\";\n\tyear = 2021;\n\tday = 7;\n\tpart_one = |lines| logic::part_one (lines [0]);\n\tpart_two = |lines| logic::part_two (lines [0]);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse nums::IntConv;\n\n\tpub fn part_one (input: \u0026 str) -\u003e GenResult \u003cu64\u003e {\n\t\tlet start_posns = model::parse_input (input) ?;\n\t\tcalc_result (\n\t\t\t\u0026 start_posns,\n\t\t\t(0, 0),\n\t\t\t|\u0026 mut (ref mut fuel, ref mut crabs), pos| {\n\t\t\t\t* fuel += * crabs;\n\t\t\t\t* crabs += start_posns.iter_vals ()\n\t\t\t\t\t.filter (|start_pos| * start_pos == pos)\n\t\t\t\t\t.count ()\n\t\t\t\t\t.as_u64 ();\n\t\t\t\tSome (* fuel)\n\t\t\t})\n\t}\n\n\tpub fn part_two (input: \u0026 str) -\u003e GenResult \u003cu64\u003e {\n\t\tlet start_posns = model::parse_input (input) ?;\n\t\tcalc_result (\n\t\t\t\u0026 start_posns,\n\t\t\t(0, 0, 0),\n\t\t\t|\u0026 mut (ref mut fuel, ref mut incr, ref mut crabs), pos| {\n\t\t\t\t* incr += * crabs;\n\t\t\t\t* fuel += * incr;\n\t\t\t\t* crabs += start_posns.iter_vals ()\n\t\t\t\t\t.filter (|start_pos| * start_pos == pos)\n\t\t\t\t\t.count ()\n\t\t\t\t\t.as_u64 ();\n\t\t\t\tSome (* fuel)\n\t\t\t})\n\t}\n\n\t#[ allow (clippy::needless_collect) ]\n\tpub fn calc_result \u003c\n\t\tState: Copy,\n\t\tScanFn: Fn (\u0026 mut State, u64) -\u003e Option \u003cu64\u003e + Clone,\n\t\u003e (\n\t\tstart_posns: \u0026 [u64],\n\t\tinitial_state: State,\n\t\tscan_fn: ScanFn,\n\t) -\u003e GenResult \u003cu64\u003e {\n\t\tlet max = start_posns.iter ().copied ().max ().unwrap ();\n\t\tOk (Iterator::zip (\n\t\t\t(0 ..= max).scan (initial_state, scan_fn.clone ()),\n\t\t\t(0 ..= max).rev ()\n\t\t\t\t.scan (initial_state, scan_fn)\n\t\t\t\t.collect::\u003cVec \u003c_\u003e\u003e ()\n\t\t\t\t.into_iter ()\n\t\t\t\t.rev ())\n\t\t\t.map (|(lower, higher)| lower + higher)\n\t\t\t.min ()\n\t\t\t.unwrap ()\n\t\t)\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\n\tpub fn parse_input (input: \u0026 str) -\u003e GenResult \u003cVec \u003cu64\u003e\u003e {\n\t\tOk (\n\t\t\tinput.split (',')\n\t\t\t\t.map (str::parse)\n\t\t\t\t.collect::\u003cResult \u003c_, _\u003e\u003e ()\n\t\t\t\t.map_err (|_err| \"Invalid input\") ?\n\t\t)\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\"16,1,2,0,4,2,7,1,2,14\"];\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"37\", puzzle.part_one (EXAMPLE));\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"168\", puzzle.part_two (EXAMPLE));\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":9,"address":[73289,73817],"length":1,"stats":{"Line":2},"fn_name":null},{"line":13,"address":[73405,73384],"length":1,"stats":{"Line":2},"fn_name":null},{"line":14,"address":[73912,73933],"length":1,"stats":{"Line":2},"fn_name":null},{"line":22,"address":[61165,60816],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":23,"address":[60973,60849],"length":1,"stats":{"Line":1},"fn_name":null},{"line":25,"address":[60943],"length":1,"stats":{"Line":1},"fn_name":null},{"line":26,"address":[61081],"length":1,"stats":{"Line":1},"fn_name":null},{"line":27,"address":[61110],"length":1,"stats":{"Line":4},"fn_name":null},{"line":28,"address":[40670,40613],"length":1,"stats":{"Line":1},"fn_name":null},{"line":29,"address":[40650,40723,40850],"length":1,"stats":{"Line":2},"fn_name":null},{"line":30,"address":[40880,40893,40710],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":33,"address":[40815],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[61200,61553],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":38,"address":[61233,61357],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[61327],"length":1,"stats":{"Line":1},"fn_name":null},{"line":41,"address":[61465],"length":1,"stats":{"Line":1},"fn_name":null},{"line":42,"address":[40961,40928,41303],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":43,"address":[41075,41017],"length":1,"stats":{"Line":1},"fn_name":null},{"line":44,"address":[41120,41055,41143],"length":1,"stats":{"Line":2},"fn_name":null},{"line":45,"address":[41196,41123,41321],"length":1,"stats":{"Line":2},"fn_name":null},{"line":46,"address":[41373,41360,41183],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":49,"address":[41286],"length":1,"stats":{"Line":1},"fn_name":null},{"line":54,"address":[42970,42192,42161,41408],"length":1,"stats":{"Line":2},"fn_name":"calc_result\u003c(u64, u64), aoc_2021_day_07::logic::part_one::{closure_env#0}\u003e"},{"line":62,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":63,"address":[41994,42057,42077,42803,42866,42886],"length":1,"stats":{"Line":6},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":65,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":82,"address":[43216],"length":1,"stats":{"Line":2},"fn_name":"parse_input"},{"line":84,"address":[43503,43249],"length":1,"stats":{"Line":2},"fn_name":null},{"line":87,"address":[50664,50656],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":101,"address":[57088,57651,57706],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":102,"address":[57095],"length":1,"stats":{"Line":1},"fn_name":null},{"line":103,"address":[57192,57258,57118],"length":1,"stats":{"Line":3},"fn_name":null},{"line":104,"address":[57662],"length":1,"stats":{"Line":1},"fn_name":null},{"line":108,"address":[57744,58307,58362],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":109,"address":[57751],"length":1,"stats":{"Line":1},"fn_name":null},{"line":110,"address":[57774,57848,57914],"length":1,"stats":{"Line":3},"fn_name":null},{"line":111,"address":[58318],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":40,"coverable":45},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-08","src","lib.rs"],"content":"//! Advent of Code 2021: Day 8: Seven Segment Search\n//!\n//! [https://adventofcode.com/2021/day/8](https://adventofcode.com/2021/day/8)\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Seven Segment Search\";\n\tyear = 2021;\n\tday = 8;\n\tpart_one = |lines| logic::part_one (lines);\n\tpart_two = |lines| logic::part_two (lines);\n}\n\nmod logic {\n\n\tuse super::*;\n\tuse model::Digit;\n\tuse model::Display;\n\tuse nums::IntConv;\n\n\tpub fn part_one (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cu64\u003e {\n\t\tlet displays = model::parse_input (lines) ?;\n\t\tlet mut count: u64 = 0;\n\t\tfor display in displays.iter () {\n\t\t\tfor digit in display.value.iter () {\n\t\t\t\tlet num = digit.segments.iter_vals ().filter (|\u0026 segment| segment).count ();\n\t\t\t\tif [2, 3, 4, 7].contains (\u0026 num) { count += 1 }\n\t\t\t}\n\t\t}\n\t\tOk (count)\n\t}\n\n\t#[ allow (clippy::identity_op) ]\n\tpub fn part_two (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cu64\u003e {\n\t\tlet displays = model::parse_input (lines) ?;\n\t\tlet mut sum: u64 = 0;\n\t\tfor display in displays.iter () {\n\t\t\tlet digits = get_digits (display);\n\t\t\tlet digit_val = |digit| {\n\t\t\t\tdigits.iter ().position (|\u0026 some_digit| some_digit == digit).unwrap ().as_u64 ()\n\t\t\t};\n\t\t\tsum += [\n\t\t\t\tdigit_val (display.value [0]) * 1000,\n\t\t\t\tdigit_val (display.value [1]) * 100,\n\t\t\t\tdigit_val (display.value [2]) * 10,\n\t\t\t\tdigit_val (display.value [3]) * 1,\n\t\t\t].into_iter ().sum::\u003cu64\u003e ();\n\t\t}\n\t\tOk (sum)\n\t}\n\n\tfn get_digits (display: \u0026 Display) -\u003e Vec \u003cDigit\u003e {\n\t\tfn find_one \u003cT, I: Iterator \u003cItem = T\u003e\u003e (mut iter: I) -\u003e T {\n\t\t\tlet val = iter.next ().unwrap ();\n\t\t\tif iter.next ().is_some () { panic! () }\n\t\t\tval\n\t\t}\n\t\tlet without_segment = |segment: usize| move |digit: \u0026 Digit|\n\t\t\t! digit.segments [segment];\n\t\tlet has_num_segments = |num_segments: usize| move |digit: \u0026 Digit|\n\t\t\tdigit.segments.iter_vals ().filter (|\u0026 segment| segment).count () == num_segments;\n\t\tlet samples = || display.samples.iter_vals ();\n\t\tlet samples_with_segments = |num_segments| samples ().filter (has_num_segments (num_segments));\n\t\tlet digit_1 = find_one (samples_with_segments (2));\n\t\tlet digit_4 = find_one (samples_with_segments (4));\n\t\tlet digit_7 = find_one (samples_with_segments (3));\n\t\tlet digit_8 = find_one (samples_with_segments (7));\n\t\tlet segment_counts: Vec \u003cusize\u003e = (0 .. 7).map (\n\t\t\t|segment| display.samples.iter ().filter (\n\t\t\t\t|sample| sample.segments [segment],\n\t\t\t).count (),\n\t\t).collect ();\n\t\tlet find_segment_freq = |segment_freq| segment_counts.iter ().copied ().position (\n\t\t\t|some_freq| some_freq == segment_freq,\n\t\t).unwrap ();\n\t\tlet segment_b = find_segment_freq (6);\n\t\tlet segment_e = find_segment_freq (4);\n\t\tlet segment_f = find_segment_freq (9);\n\t\tlet digit_2 = find_one (samples_with_segments (5).filter (without_segment (segment_f)));\n\t\tlet segment_c = find_one (\n\t\t\tdigit_1.segments.iter_vals ().enumerate ()\n\t\t\t\t.filter (|\u0026 (index, value)| value \u0026\u0026 index != segment_f)\n\t\t\t\t.map (|(index, _value)| index));\n\t\tlet digit_5 = find_one (samples_with_segments (5).filter (without_segment (segment_c)));\n\t\tlet digit_6 = find_one (samples_with_segments (6).filter (without_segment (segment_c)));\n\t\tlet digit_9 = find_one (samples_with_segments (6).filter (without_segment (segment_e)));\n\t\tlet digit_3 = find_one (\n\t\t\tsamples_with_segments (5)\n\t\t\t\t.filter (without_segment (segment_b))\n\t\t\t\t.filter (without_segment (segment_e)),\n\t\t);\n\t\tlet digit_0 = find_one (\n\t\t\tsamples_with_segments (6)\n\t\t\t\t.filter (|\u0026 sample| sample != digit_6)\n\t\t\t\t.filter (|\u0026 sample| sample != digit_9),\n\t\t);\n\t\tvec! [\n\t\t\tdigit_0, digit_1, digit_2, digit_3, digit_4, digit_5, digit_6, digit_7, digit_8, digit_9,\n\t\t]\n\t}\n\n\t#[ test ]\n\tfn test_get_digits () {\n\t\tlet display = model::parse_display (\n\t\t\t\"acedgfb cdfbe gcdfa fbcad dab cefabd cdfgeb eafb cagedb ab \\\n\t\t\t| cdfeb fcadb cdfeb cdbaf\",\n\t\t).unwrap ();\n\t\tlet digits = get_digits (\u0026 display);\n\t\tassert_eq! (display.samples [0], digits [8]);\n\t\tassert_eq! (display.samples [1], digits [5]);\n\t\tassert_eq! (display.samples [2], digits [2]);\n\t\tassert_eq! (display.samples [3], digits [3]);\n\t\tassert_eq! (display.samples [4], digits [7]);\n\t\tassert_eq! (display.samples [5], digits [9]);\n\t\tassert_eq! (display.samples [6], digits [6]);\n\t\tassert_eq! (display.samples [7], digits [4]);\n\t\tassert_eq! (display.samples [8], digits [0]);\n\t\tassert_eq! (display.samples [9], digits [1]);\n\t}\n\n}\n\nmod model {\n\n\tuse super::*;\n\n\tpub fn parse_input (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cVec \u003cDisplay\u003e\u003e {\n\t\tlet mut displays: Vec \u003cDisplay\u003e = Vec::new ();\n\t\tfor line in lines {\n\t\t\tdisplays.push (parse_display (line) ?);\n\t\t}\n\t\tOk (displays)\n\t}\n\n\tpub fn parse_display (input: \u0026 str) -\u003e GenResult \u003cDisplay\u003e {\n\t\tlet err = || format! (\"Invalid input: {}\", input);\n\t\tlet line_parts: Vec \u003c\u0026 str\u003e = input.split (\" | \").collect ();\n\t\tif line_parts.len () != 2 { Err (err ()) ? }\n\t\tlet samples = parse_digits (line_parts [0]) ?;\n\t\tif samples.len () != 10 { Err (err ()) ? }\n\t\tlet values = parse_digits (line_parts [1]) ?;\n\t\tif values.len () != 4 { Err (err ()) ? }\n\t\tOk (Display {\n\t\t\tsamples: samples.try_into ().map_err (|_err| err ()) ?,\n\t\t\tvalue: values.try_into ().map_err (|_err| err ()) ?,\n\t\t})\n\t}\n\n\tfn parse_digits (input: \u0026 str) -\u003e GenResult \u003cVec \u003cDigit\u003e\u003e {\n\t\tlet input_parts: Vec \u003c\u0026 str\u003e = input.split (' ').collect ();\n\t\tlet mut digits: Vec \u003cDigit\u003e = Vec::new ();\n\t\tfor part in input_parts {\n\t\t\tdigits.push (parse_digit (part) ?);\n\t\t}\n\t\tOk (digits)\n\t}\n\n\tfn parse_digit (input: \u0026 str) -\u003e GenResult \u003cDigit\u003e {\n\t\tlet mut digit = Digit { segments: [false; 7] };\n\t\tif input.chars ()\n\t\t\t.any (|ch| ! ('a' ..= 'g').contains (\u0026 ch))\n\t\t\t{ Err (\"Invalid input\") ?; }\n\t\tfor (index, letter) in ('a' ..= 'g').enumerate () {\n\t\t\tif input.contains (letter) {\n\t\t\t\tdigit.segments [index] = true;\n\t\t\t}\n\t\t}\n\t\tOk (digit)\n\t}\n\n\t#[ derive (Clone, Copy, Debug, PartialEq, Eq) ]\n\tpub struct Digit {\n\t\tpub segments: [bool; 7],\n\t}\n\n\t#[ derive (Clone, Copy, Debug) ]\n\tpub struct Display {\n\t\tpub samples: [Digit; 10],\n\t\tpub value: [Digit; 4],\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"be cfbegad cbdgef fgaecd cgeb fdcge agebfd fecdb fabcd edb | fdgacbe cefdb cefbgd gcbe\",\n\t\t\"edbfga begcd cbg gc gcadebf fbgde acbgfd abcde gfcbed gfec | fcgedb cgb dgebacf gc\",\n\t\t\"fgaebd cg bdaec gdafb agbcfd gdcbef bgcad gfac gcb cdgabef | cg cg fdcagb cbg\",\n\t\t\"fbegcd cbd adcefb dageb afcb bc aefdc ecdab fgdeca fcdbega | efabcd cedba gadfec cb\",\n\t\t\"aecbfdg fbg gf bafeg dbefa fcge gcbea fcaegb dgceab fcbdga | gecf egdcabf bgf bfgea\",\n\t\t\"fgeab ca afcebg bdacfeg cfaedg gcfdb baec bfadeg bafgc acf | gebdcfa ecba ca fadegcb\",\n\t\t\"dbcfg fgd bdegcaf fgec aegbdf ecdfab fbedc dacgb gdcebf gf | cefg dcbef fcge gbcadfe\",\n\t\t\"bdfegc cbegaf gecbf dfcage bdacg ed bedf ced adcbefg gebcd | ed bcgafe cdgba cbgef\",\n\t\t\"egadfb cdbfeg cegd fecab cgb gbdefca cg fgcdab egfdb bfceg | gbdfcae bgc cg cgb\",\n\t\t\"gcafb gcf dcaebfg ecagb gf abcdeg gaef cafbge fdbac fegbdc | fgae cfgab fg bagce\",\n\t];\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (26, logic::part_one (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (61229, logic::part_two (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":7,"address":[113913,113449],"length":1,"stats":{"Line":0},"fn_name":null},{"line":11,"address":[113534],"length":1,"stats":{"Line":0},"fn_name":null},{"line":12,"address":[113998],"length":1,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[54432,53552],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":23,"address":[53591,53759],"length":1,"stats":{"Line":1},"fn_name":null},{"line":24,"address":[53708],"length":1,"stats":{"Line":1},"fn_name":null},{"line":25,"address":[53728,53877,54062],"length":1,"stats":{"Line":3},"fn_name":null},{"line":26,"address":[54078],"length":1,"stats":{"Line":1},"fn_name":null},{"line":27,"address":[54235],"length":1,"stats":{"Line":3},"fn_name":null},{"line":28,"address":[54314],"length":1,"stats":{"Line":1},"fn_name":null},{"line":31,"address":[54025],"length":1,"stats":{"Line":1},"fn_name":null},{"line":35,"address":[54464,55915],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":36,"address":[54503,54671],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[54620],"length":1,"stats":{"Line":1},"fn_name":null},{"line":38,"address":[54640,54789,54962],"length":1,"stats":{"Line":3},"fn_name":null},{"line":39,"address":[54991],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[55011],"length":1,"stats":{"Line":3},"fn_name":null},{"line":41,"address":[76270,76256,76112],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":43,"address":[55882,55720,55816],"length":1,"stats":{"Line":2},"fn_name":null},{"line":44,"address":[55019,55303,55171],"length":1,"stats":{"Line":2},"fn_name":null},{"line":45,"address":[55196,55340,55472],"length":1,"stats":{"Line":2},"fn_name":null},{"line":46,"address":[55365,55510,55642],"length":1,"stats":{"Line":2},"fn_name":null},{"line":47,"address":[55680,55535,55775],"length":1,"stats":{"Line":2},"fn_name":null},{"line":50,"address":[54925],"length":1,"stats":{"Line":1},"fn_name":null},{"line":53,"address":[55952,58907],"length":1,"stats":{"Line":1},"fn_name":"get_digits"},{"line":54,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":10},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":10},"fn_name":null},{"line":57,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":59,"address":[78279,78192,78224,78206],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":60,"address":[78294,78243],"length":1,"stats":{"Line":1},"fn_name":null},{"line":61,"address":[78352,78458,78334,78320],"length":1,"stats":{"Line":4},"fn_name":"{closure#1}"},{"line":62,"address":[78480,78384,78493],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":63,"address":[55991],"length":1,"stats":{"Line":3},"fn_name":null},{"line":64,"address":[55999],"length":1,"stats":{"Line":3},"fn_name":null},{"line":65,"address":[56031],"length":1,"stats":{"Line":1},"fn_name":null},{"line":66,"address":[56165],"length":1,"stats":{"Line":1},"fn_name":null},{"line":67,"address":[56299],"length":1,"stats":{"Line":1},"fn_name":null},{"line":68,"address":[56433],"length":1,"stats":{"Line":1},"fn_name":null},{"line":69,"address":[56575,56607],"length":1,"stats":{"Line":2},"fn_name":null},{"line":70,"address":[56599],"length":1,"stats":{"Line":4},"fn_name":null},{"line":71,"address":[78800,78819,78751],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":74,"address":[56673],"length":1,"stats":{"Line":4},"fn_name":null},{"line":75,"address":[79072,78996,79085],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":77,"address":[56681,56776],"length":1,"stats":{"Line":2},"fn_name":null},{"line":78,"address":[56784],"length":1,"stats":{"Line":1},"fn_name":null},{"line":79,"address":[56843],"length":1,"stats":{"Line":1},"fn_name":null},{"line":80,"address":[56902],"length":1,"stats":{"Line":1},"fn_name":null},{"line":82,"address":[57172,57114],"length":1,"stats":{"Line":2},"fn_name":null},{"line":83,"address":[57164],"length":1,"stats":{"Line":3},"fn_name":null},{"line":84,"address":[79200,79227],"length":1,"stats":{"Line":2},"fn_name":"{closure#7}"},{"line":85,"address":[57259],"length":1,"stats":{"Line":1},"fn_name":null},{"line":86,"address":[57460],"length":1,"stats":{"Line":1},"fn_name":null},{"line":87,"address":[57661],"length":1,"stats":{"Line":1},"fn_name":null},{"line":89,"address":[57865,58045,57973],"length":1,"stats":{"Line":3},"fn_name":null},{"line":90,"address":[57916],"length":1,"stats":{"Line":1},"fn_name":null},{"line":91,"address":[57988],"length":1,"stats":{"Line":1},"fn_name":null},{"line":94,"address":[58141,58247,58200],"length":1,"stats":{"Line":3},"fn_name":null},{"line":95,"address":[58192],"length":1,"stats":{"Line":3},"fn_name":null},{"line":96,"address":[58239],"length":1,"stats":{"Line":3},"fn_name":null},{"line":98,"address":[58377,58680],"length":1,"stats":{"Line":2},"fn_name":null},{"line":99,"address":[58400],"length":1,"stats":{"Line":1},"fn_name":null},{"line":104,"address":[58960,61206],"length":1,"stats":{"Line":3},"fn_name":"test_get_digits"},{"line":109,"address":[59020],"length":1,"stats":{"Line":1},"fn_name":null},{"line":110,"address":[59306,59148,59057],"length":1,"stats":{"Line":2},"fn_name":null},{"line":111,"address":[59368,59526,59239],"length":1,"stats":{"Line":2},"fn_name":null},{"line":112,"address":[59747,59459,59589],"length":1,"stats":{"Line":2},"fn_name":null},{"line":113,"address":[59968,59810,59680],"length":1,"stats":{"Line":2},"fn_name":null},{"line":114,"address":[60031,59901,60189],"length":1,"stats":{"Line":2},"fn_name":null},{"line":115,"address":[60122,60410,60252],"length":1,"stats":{"Line":2},"fn_name":null},{"line":116,"address":[60619,60343,60473],"length":1,"stats":{"Line":2},"fn_name":null},{"line":117,"address":[60676,60809,60561],"length":1,"stats":{"Line":2},"fn_name":null},{"line":118,"address":[60755,61000,60866],"length":1,"stats":{"Line":2},"fn_name":null},{"line":119,"address":[61159,60945,61057],"length":1,"stats":{"Line":2},"fn_name":null},{"line":128,"address":[26389,25680],"length":1,"stats":{"Line":2},"fn_name":"parse_input"},{"line":129,"address":[25723],"length":1,"stats":{"Line":2},"fn_name":null},{"line":130,"address":[25743,26384,25811,25966],"length":1,"stats":{"Line":8},"fn_name":null},{"line":131,"address":[25979],"length":1,"stats":{"Line":2},"fn_name":null},{"line":133,"address":[25879],"length":1,"stats":{"Line":2},"fn_name":null},{"line":136,"address":[26416,28195,28166],"length":1,"stats":{"Line":2},"fn_name":"parse_display"},{"line":137,"address":[26443],"length":1,"stats":{"Line":2},"fn_name":null},{"line":138,"address":[26469],"length":1,"stats":{"Line":2},"fn_name":null},{"line":139,"address":[26638,26517,26584],"length":1,"stats":{"Line":4},"fn_name":null},{"line":140,"address":[26871,27035,26590],"length":1,"stats":{"Line":4},"fn_name":null},{"line":141,"address":[27224,27015,27169],"length":1,"stats":{"Line":4},"fn_name":null},{"line":142,"address":[27459,27175,27622],"length":1,"stats":{"Line":4},"fn_name":null},{"line":143,"address":[27839,27754,27603],"length":1,"stats":{"Line":4},"fn_name":null},{"line":144,"address":[28885],"length":1,"stats":{"Line":2},"fn_name":null},{"line":145,"address":[53120,53146],"length":1,"stats":{"Line":4},"fn_name":"{closure#1}"},{"line":146,"address":[53258,53232],"length":1,"stats":{"Line":4},"fn_name":"{closure#2}"},{"line":150,"address":[30120,29216,30000],"length":1,"stats":{"Line":2},"fn_name":"parse_digits"},{"line":151,"address":[29249],"length":1,"stats":{"Line":2},"fn_name":null},{"line":152,"address":[29305],"length":1,"stats":{"Line":2},"fn_name":null},{"line":153,"address":[29353,29995,29451,29940],"length":1,"stats":{"Line":6},"fn_name":null},{"line":154,"address":[29701],"length":1,"stats":{"Line":2},"fn_name":null},{"line":156,"address":[30016],"length":1,"stats":{"Line":2},"fn_name":null},{"line":159,"address":[30160],"length":1,"stats":{"Line":2},"fn_name":"parse_digit"},{"line":160,"address":[30219],"length":1,"stats":{"Line":2},"fn_name":null},{"line":161,"address":[30251],"length":1,"stats":{"Line":2},"fn_name":null},{"line":162,"address":[53344,53357],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":163,"address":[30315],"length":1,"stats":{"Line":0},"fn_name":null},{"line":164,"address":[30439,30664,30290],"length":1,"stats":{"Line":6},"fn_name":null},{"line":165,"address":[30747,30698],"length":1,"stats":{"Line":4},"fn_name":null},{"line":166,"address":[30756,30725],"length":1,"stats":{"Line":2},"fn_name":null},{"line":169,"address":[30579],"length":1,"stats":{"Line":2},"fn_name":null},{"line":204,"address":[34832],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":205,"address":[35079,34839],"length":1,"stats":{"Line":1},"fn_name":null},{"line":206,"address":[35059],"length":1,"stats":{"Line":1},"fn_name":null},{"line":210,"address":[35120],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":211,"address":[35127,35367],"length":1,"stats":{"Line":1},"fn_name":null},{"line":212,"address":[35347],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":106,"coverable":111},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-09","src","lib.rs"],"content":"//! Advent of Code 2021: Day 9: Smoke Basin\n//!\n//! [https://adventofcode.com/2021/day/9](https://adventofcode.com/2021/day/9)\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Smoke Basin\";\n\tyear = 2021;\n\tday = 9;\n\tpart_one = |lines| logic::part_one (lines);\n\tpart_two = |lines| logic::part_two (lines);\n}\n\nmod logic {\n\n\tuse super::*;\n\tuse model::Pos;\n\tuse nums::IntConv;\n\n\tpub fn part_one (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cu64\u003e {\n\t\tlet floor = model::parse_input (lines) ?;\n\t\tlet mut sum: u64 = 0;\n\t\t'OUTER: for (\u0026 pos, \u0026 height) in floor.iter () {\n\t\t\tfor next_pos in [\n\t\t\t\tPos { row: pos.row, col: pos.col - 1 },\n\t\t\t\tPos { row: pos.row, col: pos.col + 1 },\n\t\t\t\tPos { row: pos.row - 1, col: pos.col },\n\t\t\t\tPos { row: pos.row + 1, col: pos.col },\n\t\t\t] {\n\t\t\t\tif let Some (\u0026 next_height) = floor.get (\u0026 next_pos) {\n\t\t\t\t\tif next_height \u003c= height { continue 'OUTER }\n\t\t\t\t}\n\t\t\t}\n\t\t\tsum += height.as_u64 () + 1;\n\t\t}\n\t\tOk (sum)\n\t}\n\n\tpub fn part_two (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cu64\u003e {\n\t\tlet floor = model::parse_input (lines) ?;\n\t\tlet mut basin_sizes: Vec \u003cu64\u003e = Vec::new ();\n\t\t'OUTER: for (\u0026 pos, \u0026 height) in floor.iter () {\n\t\t\tfor adj_pos in pos.adjacent () {\n\t\t\t\tif let Some (\u0026 adj_height) = floor.get (\u0026 adj_pos) {\n\t\t\t\t\tif adj_height \u003c= height { continue 'OUTER }\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet mut visited: HashSet \u003cPos\u003e = vec! [ pos ].into_iter ().collect ();\n\t\t\tlet mut todo: Vec \u003cPos\u003e = vec! [ pos ];\n\t\t\tlet mut basin_size: u64 = 1;\n\t\t\twhile ! todo.is_empty () {\n\t\t\t\tlet mut next_todo = Vec::new ();\n\t\t\t\tfor pos in todo {\n\t\t\t\t\tlet height = floor [\u0026 pos];\n\t\t\t\t\tfor adj_pos in pos.adjacent () {\n\t\t\t\t\t\tif visited.contains (\u0026 adj_pos) { continue }\n\t\t\t\t\t\tif let Some (\u0026 adj_height) = floor.get (\u0026 adj_pos) {\n\t\t\t\t\t\t\tif adj_height == 9 { continue }\n\t\t\t\t\t\t\tif adj_height \u003c= height { continue }\n\t\t\t\t\t\t\tnext_todo.push (adj_pos);\n\t\t\t\t\t\t\tvisited.insert (adj_pos);\n\t\t\t\t\t\t\tbasin_size += 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\ttodo = next_todo;\n\t\t\t}\n\t\t\tbasin_sizes.push (basin_size);\n\t\t}\n\t\tbasin_sizes.sort_unstable ();\n\t\tOk (basin_sizes.into_iter ().rev ().take (3).product ())\n\t}\n\n}\n\nmod model {\n\n\tuse super::*;\n\tuse nums::IntConv;\n\n\tpub fn parse_input (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cHashMap \u003cPos, u8\u003e\u003e {\n\t\tlet mut floor: HashMap \u003cPos, u8\u003e = HashMap::new ();\n\t\tfor (row, line) in lines.iter ().enumerate () {\n\t\t\tlet row = row.as_i32 ();\n\t\t\tfor (col, letter) in line.chars ().enumerate () {\n\t\t\t\tlet col = col.as_i32 ();\n\t\t\t\tfloor.insert (\n\t\t\t\t\tPos { row, col },\n\t\t\t\t\tletter.to_digit (10).ok_or (\"Invalid input\") ?.as_u8 ());\n\t\t\t}\n\t\t}\n\t\tOk (floor)\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, Hash, PartialEq) ]\n\tpub struct Pos { pub row: i32, pub col: i32 }\n\n\timpl Pos {\n\t\tpub fn adjacent (self) -\u003e Vec \u003cSelf\u003e {\n\t\t\tvec! [\n\t\t\t\tSelf { row: self.row, col: self.col - 1 },\n\t\t\t\tSelf { row: self.row, col: self.col + 1 },\n\t\t\t\tSelf { row: self.row - 1, col: self.col },\n\t\t\t\tSelf { row: self.row + 1, col: self.col },\n\t\t\t]\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"2199943210\",\n\t\t\"3987894921\",\n\t\t\"9856789892\",\n\t\t\"8767896789\",\n\t\t\"9899965678\",\n\t];\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (15, logic::part_one (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (1134, logic::part_two (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":7,"address":[41753,41289],"length":1,"stats":{"Line":0},"fn_name":null},{"line":11,"address":[41374],"length":1,"stats":{"Line":0},"fn_name":null},{"line":12,"address":[41838],"length":1,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[27204,27415,26032],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":22,"address":[26065,26245],"length":1,"stats":{"Line":1},"fn_name":null},{"line":23,"address":[26208],"length":1,"stats":{"Line":1},"fn_name":null},{"line":24,"address":[26233,27377,26505,26357],"length":1,"stats":{"Line":4},"fn_name":null},{"line":25,"address":[27252,26814,26982],"length":1,"stats":{"Line":3},"fn_name":null},{"line":26,"address":[26615,26561],"length":1,"stats":{"Line":1},"fn_name":null},{"line":27,"address":[26600,26655,26684],"length":1,"stats":{"Line":2},"fn_name":null},{"line":28,"address":[26669,26726,26759],"length":1,"stats":{"Line":2},"fn_name":null},{"line":29,"address":[26800,26949,26740],"length":1,"stats":{"Line":2},"fn_name":null},{"line":31,"address":[27219,27148],"length":1,"stats":{"Line":2},"fn_name":null},{"line":32,"address":[27236],"length":1,"stats":{"Line":1},"fn_name":null},{"line":35,"address":[27382,27266],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[26471],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[30019,27440,28352],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":41,"address":[27667,27479],"length":1,"stats":{"Line":1},"fn_name":null},{"line":42,"address":[27652],"length":1,"stats":{"Line":1},"fn_name":null},{"line":43,"address":[27854,27769,27995],"length":1,"stats":{"Line":3},"fn_name":null},{"line":44,"address":[28059,28400],"length":1,"stats":{"Line":2},"fn_name":null},{"line":45,"address":[28296,28367],"length":1,"stats":{"Line":2},"fn_name":null},{"line":46,"address":[28384],"length":1,"stats":{"Line":1},"fn_name":null},{"line":49,"address":[28420],"length":1,"stats":{"Line":1},"fn_name":null},{"line":50,"address":[28526,28591],"length":1,"stats":{"Line":2},"fn_name":null},{"line":51,"address":[28624],"length":1,"stats":{"Line":1},"fn_name":null},{"line":52,"address":[28700,29730,28644],"length":1,"stats":{"Line":3},"fn_name":null},{"line":53,"address":[28740],"length":1,"stats":{"Line":1},"fn_name":null},{"line":54,"address":[28747,28850],"length":1,"stats":{"Line":2},"fn_name":null},{"line":55,"address":[29041],"length":1,"stats":{"Line":1},"fn_name":null},{"line":56,"address":[29094],"length":1,"stats":{"Line":1},"fn_name":null},{"line":57,"address":[29353],"length":1,"stats":{"Line":1},"fn_name":null},{"line":58,"address":[29589,29394],"length":1,"stats":{"Line":2},"fn_name":null},{"line":59,"address":[29470],"length":1,"stats":{"Line":1},"fn_name":null},{"line":60,"address":[29486],"length":1,"stats":{"Line":1},"fn_name":null},{"line":61,"address":[29494],"length":1,"stats":{"Line":1},"fn_name":null},{"line":62,"address":[29523],"length":1,"stats":{"Line":1},"fn_name":null},{"line":63,"address":[29552,29594],"length":1,"stats":{"Line":1},"fn_name":null},{"line":67,"address":[29626],"length":1,"stats":{"Line":1},"fn_name":null},{"line":69,"address":[28706],"length":1,"stats":{"Line":1},"fn_name":null},{"line":71,"address":[27963,29804],"length":1,"stats":{"Line":2},"fn_name":null},{"line":72,"address":[29815],"length":1,"stats":{"Line":1},"fn_name":null},{"line":82,"address":[42256,43229],"length":1,"stats":{"Line":2},"fn_name":"parse_input"},{"line":83,"address":[42299],"length":1,"stats":{"Line":2},"fn_name":null},{"line":84,"address":[42401,42625,42322],"length":1,"stats":{"Line":6},"fn_name":null},{"line":85,"address":[42662],"length":1,"stats":{"Line":2},"fn_name":null},{"line":86,"address":[42693],"length":1,"stats":{"Line":2},"fn_name":null},{"line":87,"address":[42937],"length":1,"stats":{"Line":2},"fn_name":null},{"line":88,"address":[43192],"length":1,"stats":{"Line":2},"fn_name":null},{"line":89,"address":[42971],"length":1,"stats":{"Line":2},"fn_name":null},{"line":90,"address":[42990],"length":1,"stats":{"Line":2},"fn_name":null},{"line":93,"address":[42555],"length":1,"stats":{"Line":2},"fn_name":null},{"line":100,"address":[43691,43264],"length":1,"stats":{"Line":1},"fn_name":"adjacent"},{"line":101,"address":[43294,43411,43591],"length":1,"stats":{"Line":2},"fn_name":null},{"line":102,"address":[43376,43328],"length":1,"stats":{"Line":1},"fn_name":null},{"line":103,"address":[43361,43447,43470],"length":1,"stats":{"Line":2},"fn_name":null},{"line":104,"address":[43512,43455,43535],"length":1,"stats":{"Line":2},"fn_name":null},{"line":105,"address":[43520,43658,43583],"length":1,"stats":{"Line":2},"fn_name":null},{"line":126,"address":[32432],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":127,"address":[32439,32679],"length":1,"stats":{"Line":1},"fn_name":null},{"line":128,"address":[32659],"length":1,"stats":{"Line":1},"fn_name":null},{"line":132,"address":[32720],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":133,"address":[32967,32727],"length":1,"stats":{"Line":1},"fn_name":null},{"line":134,"address":[32947],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":61,"coverable":64},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-10","src","lib.rs"],"content":"//! Advent of Code 2021: Day 10: Syntax Scoring\n//!\n//! [https://adventofcode.com/2021/day/10](https://adventofcode.com/2021/day/10)\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Syntax Scoring\";\n\tyear = 2021;\n\tday = 10;\n\tpart_one = |lines| logic::part_one (lines);\n\tpart_two = |lines| logic::part_two (lines);\n}\n\nmod logic {\n\n\tuse super::*;\n\tuse model::Delim;\n\tuse model::Mode;\n\n\tpub fn part_one (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cu64\u003e {\n\t\tlet input = model::parse_input (lines) ?;\n\t\tlet score = input.iter ().flat_map (|line| {\n\t\t\tlet mut stack: Vec \u003cDelim\u003e = Vec::new ();\n\t\t\tline.iter ().copied ().map (move |(delim, mode)| match mode {\n\t\t\t\tMode::Open =\u003e { stack.push (delim); 0 },\n\t\t\t\tMode::Close =\u003e {\n\t\t\t\t\tif stack.pop ().unwrap () != delim {\n\t\t\t\t\t\tdelim.mismatched_points ()\n\t\t\t\t\t} else { 0 }\n\t\t\t\t},\n\t\t\t})\n\t\t}).sum ();\n\t\tOk (score)\n\t}\n\n\tpub fn part_two (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cu64\u003e {\n\t\tlet input = model::parse_input (lines) ?;\n\t\tlet mut scores: Vec \u003cu64\u003e = input.iter ().filter_map (|line| {\n\t\t\tlet mut stack: Vec \u003cDelim\u003e = Vec::new ();\n\t\t\tfor (delim, mode) in line.iter ().copied () {\n\t\t\t\tmatch mode {\n\t\t\t\t\tMode::Open =\u003e stack.push (delim),\n\t\t\t\t\tMode::Close =\u003e {\n\t\t\t\t\t\tlet expect = stack.pop ().unwrap ();\n\t\t\t\t\t\tif delim != expect { return None }\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\t\t\tSome (\n\t\t\t\tstack.into_iter ().rev ().map (Delim::not_closed_points)\n\t\t\t\t\t.fold (0, |total, value| total * 5 + value)\n\t\t\t)\n\t\t}).collect ();\n\t\tscores.sort_unstable ();\n\t\tOk (scores [(scores.len () - 1) / 2])\n\t}\n\n}\n\nmod model {\n\n\tuse super::*;\n\n\ttype Token = (Delim, Mode);\n\n\tpub fn parse_input (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cVec \u003cVec \u003cToken\u003e\u003e\u003e {\n\t\tlines.iter ().enumerate ().map (|(line_idx, line)| {\n\t\t\tlet line_err = || format! (\"Invalid input: {}: {}\", line_idx + 1, line);\n\t\t\tline.chars ().map (\n\t\t\t\t|letter| decode_char (letter).ok_or_else (|| line_err ().into ()),\n\t\t\t).collect::\u003cGenResult \u003cVec \u003cToken\u003e\u003e\u003e ()\n\t\t}).collect::\u003cGenResult \u003cVec \u003cVec \u003cToken\u003e\u003e\u003e\u003e ()\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\n\tpub enum Delim { Round, Square, Curly, Angle }\n\n\timpl Delim {\n\t\tpub const fn mismatched_points (self) -\u003e u64 {\n\t\t\tmatch self {\n\t\t\t\tSelf::Round =\u003e 3,\n\t\t\t\tSelf::Square =\u003e 57,\n\t\t\t\tSelf::Curly =\u003e 1197,\n\t\t\t\tSelf::Angle =\u003e 25137,\n\t\t\t}\n\t\t}\n\t\tpub const fn not_closed_points (self) -\u003e u64 {\n\t\t\tmatch self {\n\t\t\t\tSelf::Round =\u003e 1,\n\t\t\t\tSelf::Square =\u003e 2,\n\t\t\t\tSelf::Curly =\u003e 3,\n\t\t\t\tSelf::Angle =\u003e 4,\n\t\t\t}\n\t\t}\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\n\tpub enum Mode { Open, Close }\n\n\tpub const fn decode_char (letter: char) -\u003e Option \u003cToken\u003e {\n\t\tmatch letter {\n\t\t\t'(' =\u003e Some ((Delim::Round, Mode::Open)),\n\t\t\t')' =\u003e Some ((Delim::Round, Mode::Close)),\n\t\t\t'[' =\u003e Some ((Delim::Square, Mode::Open)),\n\t\t\t']' =\u003e Some ((Delim::Square, Mode::Close)),\n\t\t\t'{' =\u003e Some ((Delim::Curly, Mode::Open)),\n\t\t\t'}' =\u003e Some ((Delim::Curly, Mode::Close)),\n\t\t\t'\u003c' =\u003e Some ((Delim::Angle, Mode::Open)),\n\t\t\t'\u003e' =\u003e Some ((Delim::Angle, Mode::Close)),\n\t\t\t_ =\u003e None,\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"[({(\u003c(())[]\u003e[[{[]{\u003c()\u003c\u003e\u003e\",\n\t\t\"[(()[\u003c\u003e])]({[\u003c{\u003c\u003c[]\u003e\u003e(\",\n\t\t\"{([(\u003c{}[\u003c\u003e[]}\u003e{[]{[(\u003c()\u003e\",\n\t\t\"(((({\u003c\u003e}\u003c{\u003c{\u003c\u003e}{[]{[]{}\",\n\t\t\"[[\u003c[([]))\u003c([[{}[[()]]]\",\n\t\t\"[{[{({}]{}}([{[{{{}}([]\",\n\t\t\"{\u003c[[]]\u003e}\u003c{[{[{[]{()[[[]\",\n\t\t\"[\u003c(\u003c(\u003c(\u003c{}))\u003e\u003c([]([]()\",\n\t\t\"\u003c{([([[(\u003c\u003e()){}]\u003e(\u003c\u003c{{\",\n\t\t\"\u003c{([{{}}[\u003c[[[\u003c\u003e{}]]]\u003e[]]\",\n\t];\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (26397, logic::part_one (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (288957, logic::part_two (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":7,"address":[47145,46681],"length":1,"stats":{"Line":0},"fn_name":null},{"line":11,"address":[46766],"length":1,"stats":{"Line":0},"fn_name":null},{"line":12,"address":[47230],"length":1,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[79181,78816],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":22,"address":[78975,78849],"length":1,"stats":{"Line":1},"fn_name":null},{"line":23,"address":[65002,64967,64720],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":24,"address":[64758],"length":1,"stats":{"Line":1},"fn_name":null},{"line":25,"address":[65024,64857,65053,65185,64789],"length":1,"stats":{"Line":5},"fn_name":"{closure#0}"},{"line":26,"address":[65195,65081],"length":1,"stats":{"Line":2},"fn_name":null},{"line":28,"address":[65168,65098],"length":1,"stats":{"Line":2},"fn_name":null},{"line":29,"address":[65170],"length":1,"stats":{"Line":1},"fn_name":null},{"line":30,"address":[65159],"length":1,"stats":{"Line":1},"fn_name":null},{"line":33,"address":[64806,64995,64959],"length":1,"stats":{"Line":1},"fn_name":null},{"line":34,"address":[79155],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[79216,79810,79836],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":38,"address":[79390,79249],"length":1,"stats":{"Line":1},"fn_name":null},{"line":39,"address":[65908,65759,65879,65216],"length":1,"stats":{"Line":5},"fn_name":"{closure#0}"},{"line":40,"address":[65244],"length":1,"stats":{"Line":1},"fn_name":null},{"line":41,"address":[65343,65571,65275],"length":1,"stats":{"Line":3},"fn_name":null},{"line":42,"address":[65599],"length":1,"stats":{"Line":1},"fn_name":null},{"line":43,"address":[65777,65617],"length":1,"stats":{"Line":2},"fn_name":null},{"line":45,"address":[65645],"length":1,"stats":{"Line":1},"fn_name":null},{"line":46,"address":[65708],"length":1,"stats":{"Line":1},"fn_name":null},{"line":50,"address":[65857],"length":1,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[65508,65798],"length":1,"stats":{"Line":2},"fn_name":null},{"line":52,"address":[65920,65947],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":54,"address":[65292,65871,65901,65741],"length":1,"stats":{"Line":2},"fn_name":null},{"line":55,"address":[79565,79648],"length":1,"stats":{"Line":2},"fn_name":null},{"line":56,"address":[79667],"length":1,"stats":{"Line":1},"fn_name":null},{"line":67,"address":[71936],"length":1,"stats":{"Line":2},"fn_name":"parse_input"},{"line":68,"address":[63116,63227,63088],"length":1,"stats":{"Line":8},"fn_name":"{closure#0}"},{"line":69,"address":[63262,63126,63232],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":70,"address":[63146,63193],"length":1,"stats":{"Line":4},"fn_name":null},{"line":71,"address":[63600,63488,63609,63527,63183],"length":1,"stats":{"Line":6},"fn_name":"{closure#1}"},{"line":80,"address":[72064],"length":1,"stats":{"Line":1},"fn_name":"mismatched_points"},{"line":81,"address":[72075],"length":1,"stats":{"Line":1},"fn_name":null},{"line":82,"address":[72106],"length":1,"stats":{"Line":1},"fn_name":null},{"line":83,"address":[72117],"length":1,"stats":{"Line":1},"fn_name":null},{"line":84,"address":[72128],"length":1,"stats":{"Line":1},"fn_name":null},{"line":85,"address":[72139],"length":1,"stats":{"Line":1},"fn_name":null},{"line":88,"address":[72160],"length":1,"stats":{"Line":1},"fn_name":"not_closed_points"},{"line":89,"address":[72171],"length":1,"stats":{"Line":1},"fn_name":null},{"line":90,"address":[72202],"length":1,"stats":{"Line":1},"fn_name":null},{"line":91,"address":[72213],"length":1,"stats":{"Line":1},"fn_name":null},{"line":92,"address":[72224],"length":1,"stats":{"Line":1},"fn_name":null},{"line":93,"address":[72235],"length":1,"stats":{"Line":1},"fn_name":null},{"line":101,"address":[72256],"length":1,"stats":{"Line":2},"fn_name":"decode_char"},{"line":102,"address":[72268],"length":1,"stats":{"Line":2},"fn_name":null},{"line":103,"address":[72378],"length":1,"stats":{"Line":2},"fn_name":null},{"line":104,"address":[72405],"length":1,"stats":{"Line":2},"fn_name":null},{"line":105,"address":[72432],"length":1,"stats":{"Line":2},"fn_name":null},{"line":106,"address":[72456],"length":1,"stats":{"Line":2},"fn_name":null},{"line":107,"address":[72480],"length":1,"stats":{"Line":2},"fn_name":null},{"line":108,"address":[72504],"length":1,"stats":{"Line":2},"fn_name":null},{"line":109,"address":[72528],"length":1,"stats":{"Line":2},"fn_name":null},{"line":110,"address":[72552],"length":1,"stats":{"Line":2},"fn_name":null},{"line":111,"address":[72368],"length":1,"stats":{"Line":0},"fn_name":null},{"line":136,"address":[38425,38416],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":137,"address":[73079,73319],"length":1,"stats":{"Line":1},"fn_name":null},{"line":138,"address":[73299],"length":1,"stats":{"Line":1},"fn_name":null},{"line":142,"address":[38473,38464],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":143,"address":[73607,73367],"length":1,"stats":{"Line":1},"fn_name":null},{"line":144,"address":[73587],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":59,"coverable":63},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-11","src","lib.rs"],"content":"//! Advent of Code 2021: Day 11: Dumbo Octopus\n//!\n//! [https://adventofcode.com/2021/day/11](https://adventofcode.com/2021/day/11)\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Dumbo Octopus\";\n\tyear = 2021;\n\tday = 11;\n\tpart_one = |lines| logic::part_one (lines);\n\tpart_two = |lines| logic::part_two (lines);\n}\n\nmod logic {\n\n\tuse super::*;\n\tuse model::Octopodes;\n\tuse model::Pos;\n\tuse nums::IntConv;\n\n\tpub fn part_one (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cu64\u003e {\n\t\tlet octopodes = model::parse_input (lines) ?;\n\t\tOk (\n\t\t\tstep_iter (octopodes)\n\t\t\t\t.take (100)\n\t\t\t\t.sum ()\n\t\t)\n\t}\n\n\tpub fn part_two (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cu64\u003e {\n\t\tlet octopodes = model::parse_input (lines) ?;\n\t\tlet num_octopodes = octopodes.len ().as_u64 ();\n\t\tOk (\n\t\t\tstep_iter (octopodes)\n\t\t\t\t.take_while (|\u0026 num_flashes| num_flashes \u003c num_octopodes)\n\t\t\t\t.count ().as_u64 () + 1\n\t\t)\n\t}\n\n\tfn step_iter (octopodes: Octopodes) -\u003e impl Iterator \u003cItem = u64\u003e {\n\t\titer::repeat (()).scan (octopodes, |octopodes, _| {\n\t\t\tlet mut num_flashes: u64 = 0;\n\t\t\tlet mut flashed: HashSet \u003cPos\u003e = HashSet::new ();\n\t\t\tlet mut todo: Vec \u003cPos\u003e = Vec::new ();\n\t\t\tfor (\u0026 pos, energy) in octopodes.iter_mut () {\n\t\t\t\t* energy += 1;\n\t\t\t\tif * energy \u003e 9 {\n\t\t\t\t\t* energy = 0;\n\t\t\t\t\tflashed.insert (pos);\n\t\t\t\t\ttodo.push (pos);\n\t\t\t\t\tnum_flashes += 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\twhile ! todo.is_empty () {\n\t\t\t\tlet todo_temp = todo;\n\t\t\t\ttodo = Vec::new ();\n\t\t\t\tfor pos in todo_temp {\n\t\t\t\t\tfor adj_pos in pos.adjacent () {\n\t\t\t\t\t\tif let Some (adj_energy) = octopodes.get_mut (\u0026 adj_pos) {\n\t\t\t\t\t\t\tif flashed.contains (\u0026 adj_pos) { continue }\n\t\t\t\t\t\t\t* adj_energy += 1;\n\t\t\t\t\t\t\tif * adj_energy \u003e 9 {\n\t\t\t\t\t\t\t\t* adj_energy = 0;\n\t\t\t\t\t\t\t\tflashed.insert (adj_pos);\n\t\t\t\t\t\t\t\ttodo.push (adj_pos);\n\t\t\t\t\t\t\t\tnum_flashes += 1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tSome (num_flashes)\n\t\t})\n\t}\n\n}\n\nmod model {\n\n\tuse super::*;\n\tuse nums::IntConv;\n\n\tpub type Octopodes = HashMap \u003cPos, u8\u003e;\n\n\tpub fn parse_input (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cOctopodes\u003e {\n\t\tlet mut octopodes: HashMap \u003cPos, u8\u003e = HashMap::new ();\n\t\tfor (row, line) in lines.iter ().enumerate () {\n\t\t\tlet row = row.as_i16 ();\n\t\t\tfor (col, letter) in line.chars ().enumerate () {\n\t\t\t\tlet col = col.as_i16 ();\n\t\t\t\toctopodes.insert (\n\t\t\t\t\tPos { row, col },\n\t\t\t\t\tletter.to_digit (10).ok_or (\"Invalid input\") ?.as_u8 ());\n\t\t\t}\n\t\t}\n\t\tOk (octopodes)\n\t}\n\n\t#[ derive (Clone, Copy, Eq, Hash, PartialEq) ]\n\tpub struct Pos { pub row: i16, pub col: i16 }\n\n\timpl Pos {\n\t\tpub fn adjacent (self) -\u003e Vec \u003cSelf\u003e {\n\t\t\tvec! [\n\t\t\t\tSelf { row: self.row - 1, col: self.col - 1 },\n\t\t\t\tSelf { row: self.row - 1, col: self.col     },\n\t\t\t\tSelf { row: self.row - 1, col: self.col + 1 },\n\t\t\t\tSelf { row: self.row    , col: self.col - 1 },\n\t\t\t\tSelf { row: self.row    , col: self.col + 1 },\n\t\t\t\tSelf { row: self.row + 1, col: self.col - 1 },\n\t\t\t\tSelf { row: self.row + 1, col: self.col     },\n\t\t\t\tSelf { row: self.row + 1, col: self.col + 1 },\n\t\t\t]\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"5483143223\",\n\t\t\"2745854711\",\n\t\t\"5264556173\",\n\t\t\"6141336146\",\n\t\t\"6357385478\",\n\t\t\"4167524645\",\n\t\t\"2176841721\",\n\t\t\"6882881134\",\n\t\t\"4846848554\",\n\t\t\"5283751526\",\n\t];\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (1656, logic::part_one (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (195, logic::part_two (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n}\n\n","traces":[{"line":7,"address":[35129,35593],"length":1,"stats":{"Line":0},"fn_name":null},{"line":11,"address":[35214],"length":1,"stats":{"Line":0},"fn_name":null},{"line":12,"address":[35678],"length":1,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[42376,41952,42403],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":23,"address":[41985,42204],"length":1,"stats":{"Line":1},"fn_name":null},{"line":25,"address":[42129,42318],"length":1,"stats":{"Line":2},"fn_name":null},{"line":31,"address":[42416,43000,43027],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":32,"address":[42449,42618],"length":1,"stats":{"Line":1},"fn_name":null},{"line":33,"address":[42726,42601],"length":1,"stats":{"Line":2},"fn_name":null},{"line":35,"address":[42841,42755,42968],"length":1,"stats":{"Line":2},"fn_name":null},{"line":36,"address":[37840,37853],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":41,"address":[43040,43188,43164],"length":1,"stats":{"Line":1},"fn_name":"step_iter"},{"line":42,"address":[39734,39651,37888],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":43,"address":[37916],"length":1,"stats":{"Line":1},"fn_name":null},{"line":44,"address":[37944],"length":1,"stats":{"Line":1},"fn_name":null},{"line":45,"address":[37965],"length":1,"stats":{"Line":1},"fn_name":null},{"line":46,"address":[38094,38225,38017],"length":1,"stats":{"Line":3},"fn_name":null},{"line":47,"address":[38287,38323],"length":1,"stats":{"Line":1},"fn_name":null},{"line":48,"address":[38313,38462],"length":1,"stats":{"Line":2},"fn_name":null},{"line":49,"address":[38370],"length":1,"stats":{"Line":1},"fn_name":null},{"line":50,"address":[38373],"length":1,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[38404],"length":1,"stats":{"Line":1},"fn_name":null},{"line":52,"address":[38467,38425],"length":1,"stats":{"Line":1},"fn_name":null},{"line":55,"address":[39670,38211,38504],"length":1,"stats":{"Line":3},"fn_name":null},{"line":56,"address":[38553],"length":1,"stats":{"Line":1},"fn_name":null},{"line":57,"address":[38657,38609],"length":1,"stats":{"Line":2},"fn_name":null},{"line":58,"address":[38996,38697,38985],"length":1,"stats":{"Line":3},"fn_name":null},{"line":59,"address":[38977,38988,39023],"length":1,"stats":{"Line":3},"fn_name":null},{"line":60,"address":[39315],"length":1,"stats":{"Line":1},"fn_name":null},{"line":61,"address":[39407],"length":1,"stats":{"Line":1},"fn_name":null},{"line":62,"address":[39473,39437],"length":1,"stats":{"Line":1},"fn_name":null},{"line":63,"address":[39463,39613],"length":1,"stats":{"Line":2},"fn_name":null},{"line":64,"address":[39511],"length":1,"stats":{"Line":1},"fn_name":null},{"line":65,"address":[39514],"length":1,"stats":{"Line":1},"fn_name":null},{"line":66,"address":[39545],"length":1,"stats":{"Line":1},"fn_name":null},{"line":67,"address":[39618,39576],"length":1,"stats":{"Line":1},"fn_name":null},{"line":73,"address":[38510],"length":1,"stats":{"Line":1},"fn_name":null},{"line":86,"address":[80488,79504],"length":1,"stats":{"Line":1},"fn_name":"parse_input"},{"line":87,"address":[79547],"length":1,"stats":{"Line":1},"fn_name":null},{"line":88,"address":[79873,79649,79570],"length":1,"stats":{"Line":3},"fn_name":null},{"line":89,"address":[79910],"length":1,"stats":{"Line":1},"fn_name":null},{"line":90,"address":[79944],"length":1,"stats":{"Line":1},"fn_name":null},{"line":91,"address":[80188],"length":1,"stats":{"Line":1},"fn_name":null},{"line":92,"address":[80449],"length":1,"stats":{"Line":1},"fn_name":null},{"line":93,"address":[80226],"length":1,"stats":{"Line":1},"fn_name":null},{"line":94,"address":[80247],"length":1,"stats":{"Line":1},"fn_name":null},{"line":97,"address":[79803],"length":1,"stats":{"Line":1},"fn_name":null},{"line":104,"address":[80528,81646],"length":1,"stats":{"Line":1},"fn_name":"adjacent"},{"line":105,"address":[80577,80684,81446],"length":1,"stats":{"Line":2},"fn_name":null},{"line":106,"address":[80760,80612,80733],"length":1,"stats":{"Line":2},"fn_name":null},{"line":107,"address":[80832,80805,80743],"length":1,"stats":{"Line":2},"fn_name":null},{"line":108,"address":[80870,80815,80962],"length":1,"stats":{"Line":2},"fn_name":null},{"line":109,"address":[81010,81037,80945],"length":1,"stats":{"Line":2},"fn_name":null},{"line":110,"address":[81020,81080,81107],"length":1,"stats":{"Line":2},"fn_name":null},{"line":111,"address":[81237,81145,81090],"length":1,"stats":{"Line":2},"fn_name":null},{"line":112,"address":[81220,81318,81285],"length":1,"stats":{"Line":2},"fn_name":null},{"line":113,"address":[81613,81301,81356],"length":1,"stats":{"Line":2},"fn_name":null},{"line":139,"address":[31385,31376],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":140,"address":[40503,40263],"length":1,"stats":{"Line":1},"fn_name":null},{"line":141,"address":[40483],"length":1,"stats":{"Line":1},"fn_name":null},{"line":145,"address":[31433,31424],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":146,"address":[40791,40551],"length":1,"stats":{"Line":1},"fn_name":null},{"line":147,"address":[40771],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":60,"coverable":63},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-12","src","lib.rs"],"content":"//! Advent of Code 2021: Day 12: Passage Pathing\n//!\n//! [https://adventofcode.com/2021/day/12](https://adventofcode.com/2021/day/12)\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Passage Pathing\";\n\tyear = 2021;\n\tday = 12;\n\tpart_one = |lines| logic::part_one (lines);\n\tpart_two = |lines| logic::part_two (lines);\n}\n\nmod logic {\n\n\tuse super::*;\n\tuse model::Caves;\n\n\tpub fn part_one (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cu64\u003e {\n\t\tlet caves = model::parse_input (lines) ?;\n\t\tOk (calc_result (\u0026 caves, (), |_, route, next_cave| {\n\t\t\tif caves.is_small (next_cave) \u0026\u0026 route.contains (\u0026 next_cave) { return false }\n\t\t\ttrue\n\t\t}))\n\t}\n\n\tpub fn part_two (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cu64\u003e {\n\t\tlet caves = model::parse_input (lines) ?;\n\t\tlet dupe_index: Option \u003c(usize, usize)\u003e = None;\n\t\tOk (calc_result (\u0026 caves, dupe_index, |dupe_index, route, next_cave| {\n\t\t\tif let Some (dupe_index_val) = * dupe_index {\n\t\t\t\tif dupe_index_val.1 + 1 \u003e route.len ()\n\t\t\t\t\t\t|| route [dupe_index_val.0] != route [dupe_index_val.1] {\n\t\t\t\t\t* dupe_index = None;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif caves.is_small (next_cave) {\n\t\t\t\tif next_cave == caves.start { return false }\n\t\t\t\tif let Some (prev_pos) = route.iter ()\n\t\t\t\t\t\t.position (|\u0026 some_cave| some_cave == next_cave) {\n\t\t\t\t\tif dupe_index.is_some () { return false }\n\t\t\t\t\t* dupe_index = Some ((prev_pos, route.len ()));\n\t\t\t\t}\n\t\t\t}\n\t\t\ttrue\n\t\t}))\n\t}\n\n\tfn calc_result \u003c\n\t\tState,\n\t\tCheckFn: Fn (\u0026 mut State, \u0026 [usize], usize) -\u003e bool,\n\t\u003e (\n\t\tcaves: \u0026 Caves,\n\t\tstate: State,\n\t\tcheck_fn: CheckFn,\n\t) -\u003e u64 {\n\t\tlet mut state = state;\n\t\tlet mut cache: HashMap \u003c(usize, Vec \u003cusize\u003e), u64\u003e = HashMap::new ();\n\t\tlet mut route: Vec \u003cusize\u003e = vec! [ caves.start ];\n\t\tcalc_recurse (caves, \u0026 mut state, \u0026 check_fn, \u0026 mut cache, \u0026 mut route)\n\t}\n\n\tfn calc_recurse \u003c\n\t\tState,\n\t\tCheckFn: Fn (\u0026 mut State, \u0026 [usize], usize) -\u003e bool,\n\t\u003e (\n\t\tcaves: \u0026 Caves,\n\t\tstate: \u0026 mut State,\n\t\tcheck_fn: \u0026 CheckFn,\n\t\tcache: \u0026 mut HashMap \u003c(usize, Vec \u003cusize\u003e), u64\u003e,\n\t\troute: \u0026 mut Vec \u003cusize\u003e,\n\t) -\u003e u64 {\n\t\tlet this_cave = route.last ().unwrap ().to_owned ();\n\t\tif this_cave == caves.end { return 1 }\n\t\tlet mut route_sorted = route.clone ();\n\t\troute_sorted.sort_unstable ();\n\t\tlet cache_key = (this_cave, route_sorted);\n\t\tif let Some (\u0026 cached_val) = cache.get (\u0026 cache_key) { return cached_val }\n\t\tlet mut num_routes: u64 = 0;\n\t\tfor next_cave in caves.connexions [\u0026 this_cave].iter_vals () {\n\t\t\tif ! check_fn (state, route, next_cave) { continue }\n\t\t\troute.push (next_cave);\n\t\t\tnum_routes += calc_recurse (caves, state, check_fn, cache, route);\n\t\t\troute.pop ();\n\t\t}\n\t\tcache.insert (cache_key, num_routes);\n\t\tnum_routes\n\t}\n\n}\n\nmod model {\n\n\tuse super::*;\n\n\tpub fn parse_input (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cCaves\u003e {\n\t\tlet mut caves = Caves::new ();\n\t\tfor line in lines {\n\t\t\tlet line_parts: Vec \u003c\u0026 str\u003e = line.split ('-').collect ();\n\t\t\tif line_parts.len () != 2 { Err (format! (\"Invalid input: {}\", line)) ? }\n\t\t\tlet cave_a = caves.name_idx (line_parts [0]);\n\t\t\tlet cave_b = caves.name_idx (line_parts [1]);\n\t\t\tfor (cave_0, cave_1) in [(cave_a, cave_b), (cave_b, cave_a)] {\n\t\t\t\tcaves.connexions.entry (cave_0).or_insert (Vec::new ()).push (cave_1);\n\t\t\t}\n\t\t}\n\t\tOk (caves)\n\t}\n\n\tpub struct Caves {\n\t\tpub connexions: HashMap \u003cusize, Vec \u003cusize\u003e\u003e,\n\t\tpub names: Vec \u003cString\u003e,\n\t\tpub start: usize,\n\t\tpub end: usize,\n\t}\n\n\timpl Caves {\n\t\tfn new () -\u003e Self {\n\t\t\tSelf {\n\t\t\t\tconnexions: HashMap::new (),\n\t\t\t\tnames: vec! [ \"start\".to_owned (), \"end\".to_owned () ],\n\t\t\t\tstart: 0,\n\t\t\t\tend: 1,\n\t\t\t}\n\t\t}\n\t\tfn name_idx (\u0026 mut self, name: \u0026 str) -\u003e usize {\n\t\t\tif let Some (pos) = self.names.iter ().position (|some_name| some_name == name) {\n\t\t\t\treturn pos;\n\t\t\t}\n\t\t\tlet pos = self.names.len ();\n\t\t\tself.names.push (name.to_owned ());\n\t\t\tpos\n\t\t}\n\t\tpub fn is_small (\u0026 self, index: usize) -\u003e bool {\n\t\t\tself.names [index].chars ().next ().unwrap ().is_lowercase ()\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE_0: \u0026 [\u0026 str] = \u0026 [\n\t\t\"start-A\",\n\t\t\"start-b\",\n\t\t\"A-c\",\n\t\t\"A-b\",\n\t\t\"b-d\",\n\t\t\"A-end\",\n\t\t\"b-end\",\n\t];\n\n\tconst EXAMPLE_1: \u0026 [\u0026 str] = \u0026 [\n\t\t\"dc-end\",\n\t\t\"HN-start\",\n\t\t\"start-kj\",\n\t\t\"dc-start\",\n\t\t\"dc-HN\",\n\t\t\"LN-dc\",\n\t\t\"HN-end\",\n\t\t\"kj-sa\",\n\t\t\"kj-HN\",\n\t\t\"kj-dc\",\n\t];\n\n\tconst EXAMPLE_2: \u0026 [\u0026 str] = \u0026 [\n\t\t\"fs-end\",\n\t\t\"he-DX\",\n\t\t\"fs-he\",\n\t\t\"start-DX\",\n\t\t\"pj-DX\",\n\t\t\"end-zg\",\n\t\t\"zg-sl\",\n\t\t\"zg-pj\",\n\t\t\"pj-he\",\n\t\t\"RW-he\",\n\t\t\"fs-DX\",\n\t\t\"pj-RW\",\n\t\t\"zg-RW\",\n\t\t\"start-pj\",\n\t\t\"he-WI\",\n\t\t\"zg-he\",\n\t\t\"pj-fs\",\n\t\t\"start-RW\",\n\t];\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (10, logic::part_one (EXAMPLE_0) ?);\n\t\tassert_eq! (19, logic::part_one (EXAMPLE_1) ?);\n\t\tassert_eq! (226, logic::part_one (EXAMPLE_2) ?);\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (36, logic::part_two (EXAMPLE_0) ?);\n\t\tassert_eq! (103, logic::part_two (EXAMPLE_1) ?);\n\t\tassert_eq! (3509, logic::part_two (EXAMPLE_2) ?);\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":7,"address":[28921,29385],"length":1,"stats":{"Line":0},"fn_name":null},{"line":11,"address":[29006],"length":1,"stats":{"Line":0},"fn_name":null},{"line":12,"address":[29470],"length":1,"stats":{"Line":0},"fn_name":null},{"line":20,"address":[27296,27723],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":21,"address":[27597,27329],"length":1,"stats":{"Line":1},"fn_name":null},{"line":22,"address":[90976,91095,91102],"length":1,"stats":{"Line":5},"fn_name":"{closure#0}"},{"line":23,"address":[91015,91097],"length":1,"stats":{"Line":2},"fn_name":null},{"line":24,"address":[91090],"length":1,"stats":{"Line":1},"fn_name":null},{"line":28,"address":[28239,27760],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":29,"address":[28113,27793],"length":1,"stats":{"Line":1},"fn_name":null},{"line":30,"address":[28023],"length":1,"stats":{"Line":1},"fn_name":null},{"line":31,"address":[91120,91611,91548],"length":1,"stats":{"Line":5},"fn_name":"{closure#0}"},{"line":32,"address":[91184],"length":1,"stats":{"Line":1},"fn_name":null},{"line":33,"address":[91229,91284,91528,91343,91452],"length":1,"stats":{"Line":5},"fn_name":null},{"line":34,"address":[91331,91470,91381],"length":1,"stats":{"Line":2},"fn_name":null},{"line":35,"address":[91493],"length":1,"stats":{"Line":1},"fn_name":null},{"line":38,"address":[91537,91252],"length":1,"stats":{"Line":2},"fn_name":null},{"line":39,"address":[91606,91555],"length":1,"stats":{"Line":2},"fn_name":null},{"line":40,"address":[91846,91641,91579],"length":1,"stats":{"Line":3},"fn_name":null},{"line":41,"address":[91885,91633,91872],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":42,"address":[91851,91718],"length":1,"stats":{"Line":2},"fn_name":null},{"line":43,"address":[91751],"length":1,"stats":{"Line":1},"fn_name":null},{"line":46,"address":[91543],"length":1,"stats":{"Line":1},"fn_name":null},{"line":50,"address":[92509,92208,92240,92179,91920,92480],"length":1,"stats":{"Line":2},"fn_name":"calc_result\u003ccore::option::Option\u003c(usize, usize)\u003e, aoc_2021_day_12::logic::part_two::{closure_env#0}\u003e"},{"line":58,"address":[91945],"length":1,"stats":{"Line":1},"fn_name":null},{"line":59,"address":[92267,91967],"length":1,"stats":{"Line":2},"fn_name":null},{"line":60,"address":[92006,92306,92065,92365],"length":1,"stats":{"Line":4},"fn_name":null},{"line":61,"address":[92414,92114],"length":1,"stats":{"Line":2},"fn_name":null},{"line":64,"address":[95223,95255,92544,93879,93847,93920],"length":1,"stats":{"Line":2},"fn_name":"calc_recurse\u003c(), aoc_2021_day_12::logic::part_one::{closure_env#0}\u003e"},{"line":74,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":75,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":80,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":81,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":82,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":83,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":85,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":97,"address":[55933,54512,55900],"length":1,"stats":{"Line":2},"fn_name":"parse_input"},{"line":98,"address":[54555],"length":1,"stats":{"Line":2},"fn_name":null},{"line":99,"address":[54797,54578,54649],"length":1,"stats":{"Line":6},"fn_name":null},{"line":100,"address":[54813],"length":1,"stats":{"Line":2},"fn_name":null},{"line":101,"address":[54879,54996,54952],"length":1,"stats":{"Line":4},"fn_name":null},{"line":102,"address":[55398,54958],"length":1,"stats":{"Line":4},"fn_name":null},{"line":103,"address":[55438],"length":1,"stats":{"Line":2},"fn_name":null},{"line":104,"address":[55524],"length":1,"stats":{"Line":2},"fn_name":null},{"line":105,"address":[55822],"length":1,"stats":{"Line":2},"fn_name":null},{"line":108,"address":[54727],"length":1,"stats":{"Line":2},"fn_name":null},{"line":119,"address":[56239,56331,55952],"length":1,"stats":{"Line":2},"fn_name":"new"},{"line":121,"address":[55969],"length":1,"stats":{"Line":2},"fn_name":null},{"line":122,"address":[55989,56047],"length":1,"stats":{"Line":4},"fn_name":null},{"line":127,"address":[56352],"length":1,"stats":{"Line":2},"fn_name":"name_idx"},{"line":128,"address":[56382],"length":1,"stats":{"Line":6},"fn_name":null},{"line":129,"address":[56487],"length":1,"stats":{"Line":2},"fn_name":null},{"line":131,"address":[56499],"length":1,"stats":{"Line":2},"fn_name":null},{"line":132,"address":[56527],"length":1,"stats":{"Line":2},"fn_name":null},{"line":133,"address":[56575],"length":1,"stats":{"Line":2},"fn_name":null},{"line":135,"address":[56608],"length":1,"stats":{"Line":1},"fn_name":"is_small"},{"line":136,"address":[56622],"length":1,"stats":{"Line":2},"fn_name":null},{"line":192,"address":[47897,47888],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":193,"address":[88247,88507],"length":1,"stats":{"Line":1},"fn_name":null},{"line":194,"address":[88551,88808,88468],"length":1,"stats":{"Line":2},"fn_name":null},{"line":195,"address":[89092,88769,88852],"length":1,"stats":{"Line":2},"fn_name":null},{"line":196,"address":[89069],"length":1,"stats":{"Line":1},"fn_name":null},{"line":200,"address":[47945,47936],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":201,"address":[89403,89143],"length":1,"stats":{"Line":1},"fn_name":null},{"line":202,"address":[89447,89364,89704],"length":1,"stats":{"Line":2},"fn_name":null},{"line":203,"address":[89748,89988,89665],"length":1,"stats":{"Line":2},"fn_name":null},{"line":204,"address":[89965],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":71,"coverable":74},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-13","src","lib.rs"],"content":"//! Advent of Code 2021: Day 13: Transparent Origami\n//!\n//! [https://adventofcode.com/2021/day/13](https://adventofcode.com/2021/day/13)\n\nuse aoc_common::*;\nuse aoc_ocr as ocr;\nuse aoc_pos as pos;\n\npuzzle_info! {\n\tname = \"Transparent Origami\";\n\tyear = 2021;\n\tday = 13;\n\tpart_one = |lines| logic::part_one (lines);\n\tpart_two = |lines| logic::part_two (lines);\n\tcommands = [\n\t\t( name = \"run\"; method = tool::run; ),\n\t];\n}\n\nmod tool {\n\n\tuse super::*;\n\tuse model::Input;\n\tuse model::Pos;\n\n\t#[ derive (clap::Parser) ]\n\tpub struct RunArgs {\n\n\t\t#[ clap (long, value_parser, default_value = \"inputs/day-13\") ]\n\t\tinput: String,\n\n\t}\n\n\t#[ allow (clippy::print_stdout) ]\n\tpub fn run (args: RunArgs) -\u003e GenResult \u003c()\u003e {\n\t\tlet input_string = fs::read_to_string (args.input) ?;\n\t\tlet input_lines: Vec \u003c\u0026 str\u003e = input_string.trim ().split ('\\n').collect ();\n\t\tlet input = Input::parse (\u0026 input_lines) ?;\n\t\tlet mut dots = input.dots;\n\t\tfor fold in input.folds.iter () {\n\t\t\tdots = logic::fold_dots (fold, \u0026 dots);\n\t\t}\n\t\tprint! (\"{}\", ocr::DrawDots (dots.iter_vals ().map (|Pos { y, x }| (y, x))));\n\t\tOk (())\n\t}\n\n}\n\nmod logic {\n\n\tuse super::*;\n\tuse model::Axis;\n\tuse model::Fold;\n\tuse model::Input;\n\tuse model::Pos;\n\tuse nums::IntConv;\n\n\tpub fn part_one (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cu64\u003e {\n\t\tlet input = Input::parse (lines) ?;\n\t\tlet dots = fold_dots (\u0026 input.folds [0], \u0026 input.dots);\n\t\tOk (dots.len ().as_u64 ())\n\t}\n\n\tpub fn part_two (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cString\u003e {\n\t\tlet input = Input::parse (lines) ?;\n\t\tlet mut dots = input.dots;\n\t\tfor fold in input.folds.iter () {\n\t\t\tdots = fold_dots (fold, \u0026 dots);\n\t\t}\n\t\tlet result = ocr::read_dots (\u0026 |y, x| dots.contains (\u0026 Pos { y, x })) ?;\n\t\tOk (result)\n\t}\n\n\tpub fn fold_dots (fold: \u0026 Fold, dots: \u0026 HashSet \u003cPos\u003e) -\u003e HashSet \u003cPos\u003e {\n\t\tlet mut new_dots = HashSet::new ();\n\t\tfor mut dot in dots.iter_vals () {\n\t\t\tmatch fold.axis {\n\t\t\t\tAxis::X =\u003e if dot.x \u003e fold.val { dot.x = fold.val - (dot.x - fold.val) },\n\t\t\t\tAxis::Y =\u003e if dot.y \u003e fold.val { dot.y = fold.val - (dot.y - fold.val) },\n\t\t\t}\n\t\t\tnew_dots.insert (dot);\n\t\t}\n\t\tnew_dots\n\t}\n\n}\n\nmod model {\n\n\tuse super::*;\n\n\tpub type Pos = pos::PosYX \u003ci64\u003e;\n\n\t#[ derive (Debug) ]\n\tpub struct Input {\n\t\tpub dots: HashSet \u003cPos\u003e,\n\t\tpub folds: Vec \u003cFold\u003e,\n\t}\n\n\timpl Input {\n\t\tpub fn parse (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet mut lines_iter = lines.iter ();\n\t\t\tlet mut dots = HashSet::new ();\n\t\t\tfor line in lines_iter.by_ref () {\n\t\t\t\tif line.is_empty () { break }\n\t\t\t\tlet line_err = || format! (\"Invalid input: {}\", line);\n\t\t\t\tlet line_parts: Vec \u003c\u0026 str\u003e = line.split (',').collect ();\n\t\t\t\tif line_parts.len () != 2 { Err (line_err ()) ? }\n\t\t\t\tdots.insert (Pos {\n\t\t\t\t\tx: line_parts [0].parse ().map_err (|_err| line_err ()) ?,\n\t\t\t\t\ty: line_parts [1].parse ().map_err (|_err| line_err ()) ?,\n\t\t\t\t});\n\t\t\t}\n\t\t\tlet mut folds = Vec::new ();\n\t\t\tfor line in lines_iter.by_ref () {\n\t\t\t\tlet line_err = || format! (\"Invalid input: {}\", line);\n\t\t\t\tif let Some (line) = line.strip_prefix (\"fold along x=\") {\n\t\t\t\t\tfolds.push (Fold { axis: Axis::X, val: line.parse () ? });\n\t\t\t\t} else if let Some (line) = line.strip_prefix (\"fold along y=\") {\n\t\t\t\t\tfolds.push (Fold { axis: Axis::Y, val: line.parse () ? });\n\t\t\t\t} else {\n\t\t\t\t\tErr (line_err ()) ?;\n\t\t\t\t}\n\t\t\t}\n\t\t\tOk (Self { dots, folds })\n\t\t}\n\t}\n\n\t#[ derive (Debug) ]\n\tpub struct Fold {\n\t\tpub axis: Axis,\n\t\tpub val: i64,\n\t}\n\n\t#[ derive (Clone, Copy, Debug) ]\n\tpub enum Axis { X, Y }\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"6,10\",\n\t\t\"0,14\",\n\t\t\"9,10\",\n\t\t\"0,3\",\n\t\t\"10,4\",\n\t\t\"4,11\",\n\t\t\"6,0\",\n\t\t\"6,12\",\n\t\t\"4,1\",\n\t\t\"0,13\",\n\t\t\"10,12\",\n\t\t\"3,4\",\n\t\t\"3,0\",\n\t\t\"8,4\",\n\t\t\"1,10\",\n\t\t\"2,14\",\n\t\t\"8,10\",\n\t\t\"9,0\",\n\t\t\"\",\n\t\t\"fold along y=7\",\n\t\t\"fold along x=5\",\n\t];\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (17, logic::part_one (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":9,"address":[97817,98281],"length":1,"stats":{"Line":0},"fn_name":null},{"line":13,"address":[97902],"length":1,"stats":{"Line":0},"fn_name":null},{"line":14,"address":[98366],"length":1,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[136432,137950,138089],"length":1,"stats":{"Line":0},"fn_name":"run"},{"line":36,"address":[136439,136639],"length":1,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[136616,136769],"length":1,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[137242,136847,136938],"length":1,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[137166],"length":1,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[137451,137605,137222,137738],"length":1,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[137637],"length":1,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[72243,72224],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":44,"address":[137923],"length":1,"stats":{"Line":0},"fn_name":null},{"line":58,"address":[118320,118822,118848],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":59,"address":[118587,118353],"length":1,"stats":{"Line":1},"fn_name":null},{"line":60,"address":[118559,118701],"length":1,"stats":{"Line":2},"fn_name":null},{"line":61,"address":[118716,118770],"length":1,"stats":{"Line":2},"fn_name":null},{"line":64,"address":[118864,120033,119913],"length":1,"stats":{"Line":0},"fn_name":"part_two"},{"line":65,"address":[118897,119197],"length":1,"stats":{"Line":0},"fn_name":null},{"line":66,"address":[119128],"length":1,"stats":{"Line":0},"fn_name":null},{"line":67,"address":[119616,119306,119175,119483],"length":1,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[119515],"length":1,"stats":{"Line":0},"fn_name":null},{"line":70,"address":[119621,119442,119825],"length":1,"stats":{"Line":0},"fn_name":null},{"line":71,"address":[119739],"length":1,"stats":{"Line":0},"fn_name":null},{"line":74,"address":[120064,120689],"length":1,"stats":{"Line":1},"fn_name":"fold_dots"},{"line":75,"address":[120110],"length":1,"stats":{"Line":1},"fn_name":null},{"line":76,"address":[120185,120275,120128],"length":1,"stats":{"Line":3},"fn_name":null},{"line":77,"address":[120307],"length":1,"stats":{"Line":1},"fn_name":null},{"line":78,"address":[120326,120542],"length":1,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[120350,120399],"length":1,"stats":{"Line":2},"fn_name":null},{"line":81,"address":[120368,120684],"length":1,"stats":{"Line":2},"fn_name":null},{"line":101,"address":[75031,73732,72288],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":102,"address":[72359],"length":1,"stats":{"Line":1},"fn_name":null},{"line":103,"address":[72384],"length":1,"stats":{"Line":1},"fn_name":null},{"line":104,"address":[72405,72462,72563],"length":1,"stats":{"Line":3},"fn_name":null},{"line":105,"address":[72579],"length":1,"stats":{"Line":1},"fn_name":null},{"line":106,"address":[136002,135984],"length":1,"stats":{"Line":1},"fn_name":"{closure#0}"},{"line":107,"address":[72631],"length":1,"stats":{"Line":1},"fn_name":null},{"line":108,"address":[72770,72830,72697],"length":1,"stats":{"Line":2},"fn_name":null},{"line":109,"address":[73516],"length":1,"stats":{"Line":1},"fn_name":null},{"line":110,"address":[136096,136118],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":111,"address":[136144,136166],"length":1,"stats":{"Line":2},"fn_name":"{closure#2}"},{"line":114,"address":[72553],"length":1,"stats":{"Line":1},"fn_name":null},{"line":115,"address":[73808,74092,73751],"length":1,"stats":{"Line":3},"fn_name":null},{"line":116,"address":[74116],"length":1,"stats":{"Line":1},"fn_name":null},{"line":117,"address":[74124],"length":1,"stats":{"Line":1},"fn_name":null},{"line":118,"address":[74256,74871,75026],"length":1,"stats":{"Line":3},"fn_name":null},{"line":119,"address":[74286,74549],"length":1,"stats":{"Line":1},"fn_name":null},{"line":120,"address":[74711,74416],"length":1,"stats":{"Line":2},"fn_name":null},{"line":122,"address":[74462,74562],"length":1,"stats":{"Line":0},"fn_name":null},{"line":125,"address":[73894],"length":1,"stats":{"Line":1},"fn_name":null},{"line":170,"address":[77616],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":171,"address":[77863,77623],"length":1,"stats":{"Line":1},"fn_name":null},{"line":172,"address":[77843],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":32,"coverable":53},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-14","src","lib.rs"],"content":"//! Advent of Code 2021: Day 14: Extended Polymerization\n//!\n//! [https://adventofcode.com/2021/day/14](https://adventofcode.com/2021/day/14)\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Extended Polymerization\";\n\tyear = 2021;\n\tday = 14;\n\tpart_one = |lines| logic::part_one (lines);\n\tpart_two = |lines| logic::part_two (lines);\n}\n\nmod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\tuse nums::IntConv;\n\n\tpub fn part_one (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cu64\u003e {\n\t\tcalc_result (10, lines)\n\t}\n\n\tpub fn part_two (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cu64\u003e {\n\t\tcalc_result (40, lines)\n\t}\n\n\tpub fn calc_result (loops: usize, lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cu64\u003e {\n\t\tlet input = Input::parse (lines) ?;\n\t\tlet mut global_counts = {\n\t\t\tlet mut global_counts = HashMap::new ();\n\t\t\tfor letter in input.template.chars () {\n\t\t\t\t* global_counts.entry (letter).or_insert (0) += 1;\n\t\t\t}\n\t\t\tglobal_counts\n\t\t};\n\t\tstruct Frame {\n\t\t\tcounts: HashMap \u003cchar, usize\u003e,\n\t\t\tletter_0: char,\n\t\t\tletter_1: char,\n\t\t\tloops: usize,\n\t\t\tpending: bool,\n\t\t}\n\t\tlet mut stack = {\n\t\t\tlet mut stack = Vec::new ();\n\t\t\tlet mut letter_0 = input.template.chars ().next ().unwrap ();\n\t\t\tfor letter_1 in input.template.chars ().skip (1) {\n\t\t\t\tstack.push (Frame {\n\t\t\t\t\tcounts: HashMap::new (),\n\t\t\t\t\tletter_0,\n\t\t\t\t\tletter_1,\n\t\t\t\t\tloops,\n\t\t\t\t\tpending: true,\n\t\t\t\t});\n\t\t\t\tletter_0 = letter_1;\n\t\t\t}\n\t\t\tstack\n\t\t};\n\t\tlet mut cache: HashMap \u003c(char, char, usize), HashMap \u003cchar, usize\u003e\u003e = HashMap::new ();\n\t\twhile let Some (frame) = stack.last_mut () {\n\t\t\tlet cache_key = (frame.letter_0, frame.letter_1, frame.loops);\n\t\t\tif frame.pending \u0026\u0026 frame.loops \u003e 0 {\n\t\t\t\tif let Some (cached_counts) = cache.get (\u0026 cache_key) {\n\t\t\t\t\tframe.counts = cached_counts.clone ();\n\t\t\t\t\tframe.pending = false;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif let Some (\u0026 letter_insert) = input.rules.get (\u0026 (frame.letter_0, frame.letter_1)) {\n\t\t\t\t\t* frame.counts.entry (letter_insert).or_insert (0) += 1;\n\t\t\t\t\tframe.pending = false;\n\t\t\t\t\tfor new_frame in vec! [\n\t\t\t\t\t\tFrame {\n\t\t\t\t\t\t\tcounts: HashMap::new (),\n\t\t\t\t\t\t\tletter_0: frame.letter_0,\n\t\t\t\t\t\t\tletter_1: letter_insert,\n\t\t\t\t\t\t\tloops: frame.loops - 1,\n\t\t\t\t\t\t\tpending: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tFrame {\n\t\t\t\t\t\t\tcounts: HashMap::new (),\n\t\t\t\t\t\t\tletter_0: letter_insert,\n\t\t\t\t\t\t\tletter_1: frame.letter_1,\n\t\t\t\t\t\t\tloops: frame.loops - 1,\n\t\t\t\t\t\t\tpending: true,\n\t\t\t\t\t\t}\n\t\t\t\t\t] {\n\t\t\t\t\t\tstack.push (new_frame);\n\t\t\t\t\t}\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tframe.pending = false;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet frame = stack.pop ().unwrap ();\n\t\t\tlet prev_counts =\n\t\t\t\tif let Some (prev_frame) =\n\t\t\t\t\tstack.iter_mut ().rev ()\n\t\t\t\t\t\t.find (|some_frame| some_frame.loops != frame.loops)\n\t\t\t\t{ \u0026 mut prev_frame.counts } else { \u0026 mut global_counts };\n\t\t\tfor (\u0026 letter, count) in frame.counts.iter () {\n\t\t\t\t* prev_counts.entry (letter).or_insert (0) += count;\n\t\t\t}\n\t\t\tif frame.loops \u003e 0 {\n\t\t\t\tcache.entry (cache_key).or_insert (frame.counts);\n\t\t\t}\n\t\t}\n\t\tlet most = global_counts.values ().max ().unwrap ();\n\t\tlet least = global_counts.values ().min ().unwrap ();\n\t\tOk ((most - least).as_u64 ())\n\t}\n\n}\n\nmod model {\n\n\tuse super::*;\n\n\tpub struct Input {\n\t\tpub template: String,\n\t\tpub rules: HashMap \u003c(char, char), char\u003e,\n\t}\n\n\timpl Input {\n\t\tpub fn parse (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet template = lines [0].to_owned ();\n\t\t\tlet mut rules = HashMap::new ();\n\t\t\tfor line in lines.iter ().skip (2) {\n\t\t\t\tlet line_err = || format! (\"Invalid input: {}\", line);\n\t\t\t\tlet mut line_iter = line.chars ();\n\t\t\t\tlet letter_before = line_iter.next ().ok_or_else (line_err) ?;\n\t\t\t\tlet letter_after = line_iter.next ().ok_or_else (line_err) ?;\n\t\t\t\tif iter::from_fn (|| line_iter.next ()).take (4).collect::\u003cString\u003e () != \" -\u003e \" {\n\t\t\t\t\tErr (line_err ()) ?;\n\t\t\t\t}\n\t\t\t\tlet letter_insert = line_iter.next ().ok_or_else (line_err) ?;\n\t\t\t\trules.insert ((letter_before, letter_after), letter_insert);\n\t\t\t}\n\t\t\tOk (Self { template, rules })\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"NNCB\",\n\t\t\"\",\n\t\t\"CH -\u003e B\",\n\t\t\"HH -\u003e N\",\n\t\t\"CB -\u003e H\",\n\t\t\"NH -\u003e C\",\n\t\t\"HB -\u003e C\",\n\t\t\"HC -\u003e B\",\n\t\t\"HN -\u003e C\",\n\t\t\"NN -\u003e C\",\n\t\t\"BH -\u003e H\",\n\t\t\"NC -\u003e B\",\n\t\t\"NB -\u003e B\",\n\t\t\"BN -\u003e B\",\n\t\t\"BB -\u003e N\",\n\t\t\"BC -\u003e B\",\n\t\t\"CC -\u003e N\",\n\t\t\"CN -\u003e C\",\n\t];\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (1588, logic::part_one (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (2188189693529, logic::part_two (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":7,"address":[28425,28889],"length":1,"stats":{"Line":0},"fn_name":null},{"line":11,"address":[28510],"length":1,"stats":{"Line":0},"fn_name":null},{"line":12,"address":[28974],"length":1,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[42064],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":22,"address":[42091],"length":1,"stats":{"Line":1},"fn_name":null},{"line":25,"address":[42112],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":26,"address":[42139],"length":1,"stats":{"Line":1},"fn_name":null},{"line":29,"address":[46864,42160,43066],"length":1,"stats":{"Line":2},"fn_name":"calc_result"},{"line":30,"address":[42253,42500],"length":1,"stats":{"Line":2},"fn_name":null},{"line":32,"address":[42485],"length":1,"stats":{"Line":2},"fn_name":null},{"line":33,"address":[43029,42610,42690,42916],"length":1,"stats":{"Line":8},"fn_name":null},{"line":34,"address":[43034,42946],"length":1,"stats":{"Line":2},"fn_name":null},{"line":36,"address":[42850],"length":1,"stats":{"Line":2},"fn_name":null},{"line":46,"address":[42906],"length":1,"stats":{"Line":2},"fn_name":null},{"line":47,"address":[43129,43205],"length":1,"stats":{"Line":4},"fn_name":null},{"line":48,"address":[43336,43629,43802],"length":1,"stats":{"Line":6},"fn_name":null},{"line":49,"address":[43687],"length":1,"stats":{"Line":2},"fn_name":null},{"line":50,"address":[43658],"length":1,"stats":{"Line":2},"fn_name":null},{"line":51,"address":[43680],"length":1,"stats":{"Line":2},"fn_name":null},{"line":56,"address":[43795],"length":1,"stats":{"Line":2},"fn_name":null},{"line":58,"address":[43579],"length":1,"stats":{"Line":2},"fn_name":null},{"line":60,"address":[43847,43619],"length":1,"stats":{"Line":4},"fn_name":null},{"line":61,"address":[46840,43933,43857],"length":1,"stats":{"Line":6},"fn_name":null},{"line":62,"address":[44014],"length":1,"stats":{"Line":2},"fn_name":null},{"line":63,"address":[44046,44389],"length":1,"stats":{"Line":4},"fn_name":null},{"line":64,"address":[44476],"length":1,"stats":{"Line":2},"fn_name":null},{"line":65,"address":[45978,44557],"length":1,"stats":{"Line":4},"fn_name":null},{"line":66,"address":[46076],"length":1,"stats":{"Line":2},"fn_name":null},{"line":69,"address":[44575],"length":1,"stats":{"Line":2},"fn_name":null},{"line":70,"address":[44708,44744,44845],"length":1,"stats":{"Line":4},"fn_name":null},{"line":71,"address":[44816],"length":1,"stats":{"Line":2},"fn_name":null},{"line":72,"address":[45577,44911,44830,45172,45938,45342],"length":1,"stats":{"Line":6},"fn_name":null},{"line":73,"address":[44994],"length":1,"stats":{"Line":2},"fn_name":null},{"line":74,"address":[44899],"length":1,"stats":{"Line":2},"fn_name":null},{"line":75,"address":[44951],"length":1,"stats":{"Line":2},"fn_name":null},{"line":77,"address":[44958,45087],"length":1,"stats":{"Line":2},"fn_name":null},{"line":80,"address":[45264],"length":1,"stats":{"Line":2},"fn_name":null},{"line":81,"address":[45080],"length":1,"stats":{"Line":2},"fn_name":null},{"line":83,"address":[45212],"length":1,"stats":{"Line":2},"fn_name":null},{"line":84,"address":[45219,45484],"length":1,"stats":{"Line":2},"fn_name":null},{"line":88,"address":[45835],"length":1,"stats":{"Line":2},"fn_name":null},{"line":92,"address":[44723],"length":1,"stats":{"Line":0},"fn_name":null},{"line":93,"address":[44727],"length":1,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[46085,44450],"length":1,"stats":{"Line":4},"fn_name":null},{"line":96,"address":[46376,46326],"length":1,"stats":{"Line":4},"fn_name":null},{"line":97,"address":[46131,46199,46285],"length":1,"stats":{"Line":6},"fn_name":null},{"line":99,"address":[46269],"length":1,"stats":{"Line":6},"fn_name":null},{"line":100,"address":[46368,46378],"length":1,"stats":{"Line":4},"fn_name":null},{"line":101,"address":[46555,46410],"length":1,"stats":{"Line":4},"fn_name":null},{"line":102,"address":[46593],"length":1,"stats":{"Line":2},"fn_name":null},{"line":104,"address":[46542],"length":1,"stats":{"Line":2},"fn_name":null},{"line":105,"address":[46679],"length":1,"stats":{"Line":2},"fn_name":null},{"line":108,"address":[44077],"length":1,"stats":{"Line":2},"fn_name":null},{"line":109,"address":[44169],"length":1,"stats":{"Line":2},"fn_name":null},{"line":110,"address":[44253],"length":1,"stats":{"Line":2},"fn_name":null},{"line":125,"address":[36278,34352,35706],"length":1,"stats":{"Line":2},"fn_name":"parse"},{"line":126,"address":[34398],"length":1,"stats":{"Line":2},"fn_name":null},{"line":127,"address":[34474],"length":1,"stats":{"Line":2},"fn_name":null},{"line":128,"address":[34535,34951,34616],"length":1,"stats":{"Line":6},"fn_name":null},{"line":129,"address":[34975],"length":1,"stats":{"Line":2},"fn_name":null},{"line":130,"address":[34983],"length":1,"stats":{"Line":2},"fn_name":null},{"line":131,"address":[35180,35049],"length":1,"stats":{"Line":2},"fn_name":null},{"line":132,"address":[35317,35447,35161],"length":1,"stats":{"Line":4},"fn_name":null},{"line":133,"address":[35414,35721,35852,35575],"length":1,"stats":{"Line":10},"fn_name":null},{"line":134,"address":[35765,35859],"length":1,"stats":{"Line":0},"fn_name":null},{"line":136,"address":[35735,35981,36125],"length":1,"stats":{"Line":4},"fn_name":null},{"line":137,"address":[36273,36074],"length":1,"stats":{"Line":4},"fn_name":null},{"line":139,"address":[34755],"length":1,"stats":{"Line":2},"fn_name":null},{"line":172,"address":[27552,27561],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":173,"address":[66839,67079],"length":1,"stats":{"Line":1},"fn_name":null},{"line":174,"address":[67059],"length":1,"stats":{"Line":1},"fn_name":null},{"line":178,"address":[27600,27609],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":179,"address":[67367,67127],"length":1,"stats":{"Line":1},"fn_name":null},{"line":180,"address":[67347],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":68,"coverable":74},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-15","src","lib.rs"],"content":"//! Advent of Code 2021: Day 15: Chiton\n//!\n//! [https://adventofcode.com/2021/day/15](https://adventofcode.com/2021/day/15)\n//!\n//! This is a relatively simple path finder. We use [`PrioritySearch`](search::PrioritySearch) to\n//! prioritise the routes with the lowest risk, and keep a cache of the best ones so far to each\n//! point so we can short-circuit appropriately.\n\nuse aoc_common::*;\nuse aoc_grid as grid;\nuse aoc_pos as pos;\nuse aoc_search as search;\n\npuzzle_info! {\n\tname = \"Chiton\";\n\tyear = 2021;\n\tday = 15;\n\tpart_one = |lines| logic::part_one (lines);\n\tpart_two = |lines| logic::part_two (lines);\n}\n\nmod logic {\n\n\tuse super::*;\n\tuse model::Cave;\n\tuse model::Grid;\n\tuse model::Pos;\n\tuse nums::IntConv;\n\tuse search::PrioritySearch;\n\tuse search::PrioritySearchAdder;\n\n\tpub fn part_one (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cu64\u003e {\n\t\tlet cave = Cave::parse (lines) ?;\n\t\tOk (calc_result (\u0026 cave))\n\t}\n\n\tpub fn part_two (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cu64\u003e {\n\t\tlet mut cave = Cave::parse (lines) ?;\n\t\tlet risks = {\n\t\t\tlet cave_risks = \u0026 cave.risks;\n\t\t\t(0 .. 5).flat_map (move |rep_y| (0 ..= cave.end.y).flat_map (move |y|\n\t\t\t\t(0 .. 5).flat_map (move |rep_x| (0 ..= cave.end.x).map (move |x| {\n\t\t\t\t\tlet orig_risk = cave_risks.get (Pos { y, x }).unwrap ();\n\t\t\t\t\t(orig_risk + rep_y + rep_x - 1) % 9 + 1\n\t\t\t\t})),\n\t\t\t)).collect ()\n\t\t};\n\t\tlet new_size = [cave.risks.size () [0] * 5, cave.risks.size () [1] * 5];\n\t\tcave.risks = Grid::wrap (risks, [0, 0], new_size);\n\t\tcave.end = Pos { y: (cave.end.y + 1) * 5 - 1, x: (cave.end.x + 1) * 5 - 1 };\n\t\tOk (calc_result (\u0026 cave))\n\t}\n\n\tpub fn calc_result (cave: \u0026 Cave) -\u003e u64 {\n\t\tlet mut search = PrioritySearch::with_grid (\n\t\t\t[0, 0],\n\t\t\tcave.risks.size (),\n\t\t\t|pos: Pos, path_risk, mut adder: PrioritySearchAdder \u003cPos, u64, _\u003e| {\n\t\t\t\tfor adj_pos in pos.adjacent_4 () {\n\t\t\t\t\tif let Some (adj_risk) = cave.risks.get (adj_pos) {\n\t\t\t\t\t\tlet adj_path_risk = path_risk + adj_risk.as_u64 ();\n\t\t\t\t\t\tadder.add (adj_pos, adj_path_risk);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t(pos, path_risk)\n\t\t\t},\n\t\t);\n\t\tsearch.push (cave.start, 0);\n\t\tsearch\n\t\t\t.filter (|\u0026 (pos, _)| pos == cave.end)\n\t\t\t.map (|(_, score)| score)\n\t\t\t.next ()\n\t\t\t.unwrap ()\n\t}\n\n}\n\nmod model {\n\n\tuse super::*;\n\tuse nums::IntConv;\n\n\tpub type Grid \u003cVal\u003e = grid::Grid \u003cVec \u003cVal\u003e, Pos, 2\u003e;\n\tpub type Pos = pos::PosYX \u003ci16\u003e;\n\n\tpub struct Cave {\n\t\tpub risks: Grid \u003cu8\u003e,\n\t\tpub start: Pos,\n\t\tpub end: Pos,\n\t}\n\n\timpl Cave {\n\t\tpub fn parse (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet mut risks = Vec::new ();\n\t\t\tfor (line_idx, line) in lines.iter ().enumerate () {\n\t\t\t\tlet line_err = || format! (\"Invalid input on line {}: {}\", line_idx + 1, line);\n\t\t\t\tfor letter in line.chars () {\n\t\t\t\t\trisks.push (letter.to_digit (10).ok_or_else (line_err) ?.as_u8 ());\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet risks = Grid::wrap (risks, [0, 0], [lines.len (), lines [0].len ()]);\n\t\t\tlet start = Pos { x: 0, y: 0 };\n\t\t\tlet end = Pos { x: risks.size () [1].as_i16 () - 1, y: risks.size () [0].as_i16 () - 1 };\n\t\t\tOk (Self { risks, start, end })\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"1163751742\", \"1381373672\", \"2136511328\", \"3694931569\", \"7463417111\",\n\t\t\"1319128137\", \"1359912421\", \"3125421639\", \"1293138521\", \"2311944581\",\n\t];\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (40, logic::part_one (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (315, logic::part_two (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":14,"address":[69849,69385],"length":1,"stats":{"Line":0},"fn_name":null},{"line":18,"address":[69470],"length":1,"stats":{"Line":0},"fn_name":null},{"line":19,"address":[69934],"length":1,"stats":{"Line":0},"fn_name":null},{"line":32,"address":[97856,98191],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":33,"address":[97889,98071],"length":1,"stats":{"Line":1},"fn_name":null},{"line":34,"address":[98054,98168],"length":1,"stats":{"Line":2},"fn_name":null},{"line":37,"address":[98224,99577],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":38,"address":[98544,98257],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[98442],"length":1,"stats":{"Line":1},"fn_name":null},{"line":41,"address":[98656,98450],"length":1,"stats":{"Line":6},"fn_name":null},{"line":42,"address":[58144,58445,57984,57913,58018],"length":1,"stats":{"Line":5},"fn_name":"{closure#0}"},{"line":43,"address":[58169],"length":1,"stats":{"Line":1},"fn_name":null},{"line":44,"address":[58262,58450],"length":1,"stats":{"Line":1},"fn_name":null},{"line":46,"address":[98663],"length":1,"stats":{"Line":1},"fn_name":null},{"line":48,"address":[98684,98729,98986],"length":1,"stats":{"Line":2},"fn_name":null},{"line":49,"address":[99024,98867],"length":1,"stats":{"Line":2},"fn_name":null},{"line":50,"address":[99104,99478],"length":1,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[99521,99466],"length":1,"stats":{"Line":2},"fn_name":null},{"line":54,"address":[100007,99616,99980],"length":1,"stats":{"Line":1},"fn_name":"calc_result"},{"line":56,"address":[99647],"length":1,"stats":{"Line":1},"fn_name":null},{"line":57,"address":[99668],"length":1,"stats":{"Line":1},"fn_name":null},{"line":58,"address":[58480,59093,59031],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":59,"address":[58544],"length":1,"stats":{"Line":1},"fn_name":null},{"line":60,"address":[58902,58826],"length":1,"stats":{"Line":2},"fn_name":null},{"line":61,"address":[58912,58994,58894],"length":1,"stats":{"Line":2},"fn_name":null},{"line":62,"address":[59026,58976],"length":1,"stats":{"Line":2},"fn_name":null},{"line":65,"address":[59072],"length":1,"stats":{"Line":1},"fn_name":null},{"line":68,"address":[99738],"length":1,"stats":{"Line":1},"fn_name":null},{"line":69,"address":[99901,99807,100065],"length":1,"stats":{"Line":3},"fn_name":null},{"line":70,"address":[99893],"length":1,"stats":{"Line":3},"fn_name":null},{"line":71,"address":[59192,59184],"length":1,"stats":{"Line":2},"fn_name":"{closure#2}"},{"line":93,"address":[82032,83280,83752],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":94,"address":[82084],"length":1,"stats":{"Line":1},"fn_name":null},{"line":95,"address":[82215,82469,82135],"length":1,"stats":{"Line":3},"fn_name":null},{"line":96,"address":[82509],"length":1,"stats":{"Line":1},"fn_name":null},{"line":97,"address":[82533,83013],"length":1,"stats":{"Line":2},"fn_name":null},{"line":98,"address":[82991,82701],"length":1,"stats":{"Line":2},"fn_name":null},{"line":101,"address":[83018,83258,82382],"length":1,"stats":{"Line":1},"fn_name":null},{"line":102,"address":[83215],"length":1,"stats":{"Line":1},"fn_name":null},{"line":103,"address":[83331,83719,83251],"length":1,"stats":{"Line":2},"fn_name":null},{"line":104,"address":[83505],"length":1,"stats":{"Line":1},"fn_name":null},{"line":121,"address":[100544,100553],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":122,"address":[105255,105495],"length":1,"stats":{"Line":1},"fn_name":null},{"line":123,"address":[105475],"length":1,"stats":{"Line":1},"fn_name":null},{"line":127,"address":[100592,100601],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":128,"address":[105783,105543],"length":1,"stats":{"Line":1},"fn_name":null},{"line":129,"address":[105763],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":44,"coverable":47},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-16","src","lib.rs"],"content":"//! Advent of Code 2021: Day 15: Packet Decoder\n//!\n//! [https://adventofcode.com/2021/day/16](https://adventofcode.com/2021/day/16)\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Packet Decoder\";\n\tyear = 2021;\n\tday = 16;\n\tpart_one = |lines| Ok::\u003c_, Infallible\u003e (logic::part_one (lines [0]));\n\tpart_two = |lines| Ok::\u003c_, Infallible\u003e (logic::part_two (lines [0]));\n}\n\nmod logic {\n\n\tuse super::*;\n\tuse model::BitIter;\n\tuse model::Packet;\n\n\tpub fn part_one (input: \u0026 str) -\u003e u64 {\n\t\tlet mut input_iter = BitIter::new (input);\n\t\tlet packet = Packet::decode (\u0026 mut input_iter).unwrap ();\n\t\tpacket.version_sum ()\n\t}\n\n\tpub fn part_two (input: \u0026 str) -\u003e u64 {\n\t\tlet mut input_iter = BitIter::new (input);\n\t\tlet packet = Packet::decode (\u0026 mut input_iter).unwrap ();\n\t\tpacket_eval (\u0026 packet)\n\t}\n\n\tfn packet_eval (packet: \u0026 Packet) -\u003e u64 {\n\t\tlet child_vals = || packet.children.iter ().map (packet_eval);\n\t\tlet child_at = |pos| child_vals ().nth (pos).unwrap ();\n\t\tlet from_bool = |val| if val { 1 } else { 0 };\n\t\tmatch packet.packet_type {\n\t\t\t0 =\u003e child_vals ().sum (),\n\t\t\t1 =\u003e child_vals ().product (),\n\t\t\t2 =\u003e child_vals ().min ().unwrap (),\n\t\t\t3 =\u003e child_vals ().max ().unwrap (),\n\t\t\t4 =\u003e packet.value,\n\t\t\t5 =\u003e from_bool (child_at (0) \u003e child_at (1)),\n\t\t\t6 =\u003e from_bool (child_at (0) \u003c child_at (1)),\n\t\t\t7 =\u003e from_bool (child_at (0) == child_at (1)),\n\t\t\t_ =\u003e panic! (),\n\t\t}\n\t}\n\n}\n\nmod model {\n\n\tuse super::*;\n\tuse nums::IntConv;\n\n\t#[ allow (dead_code) ]\n\t#[ derive (Debug) ]\n\tpub struct Packet {\n\t\tpub version: u64,\n\t\tpub packet_type: u64,\n\t\tpub value: u64,\n\t\tpub children: Vec \u003cPacket\u003e,\n\t}\n\n\timpl Packet {\n\t\tpub fn decode (iter: \u0026 mut BitIter \u003c'_\u003e) -\u003e Option \u003cSelf\u003e {\n\t\t\tif ! iter.has_next () { return None }\n\t\t\tlet version = iter.next_uint (3).unwrap ();\n\t\t\tlet packet_type = iter.next_uint (3).unwrap ();\n\t\t\tlet mut value = 0;\n\t\t\tlet mut children = Vec::new ();\n\t\t\tif packet_type == 4 {\n\t\t\t\tlet mut bits = 0_i32;\n\t\t\t\tloop {\n\t\t\t\t\tlet is_last = iter.next_bit ().unwrap () == 0;\n\t\t\t\t\tif bits + 4_i32 \u003e 64_i32 { panic! (); }\n\t\t\t\t\tvalue = value \u003c\u003c 4_i32 | iter.next_uint (4).unwrap ();\n\t\t\t\t\tbits += 4_i32;\n\t\t\t\t\tif is_last { break }\n\t\t\t\t}\n\t\t\t} else if iter.next_bit ().unwrap () == 0 {\n\t\t\t\tlet child_bits = iter.next_uint (15).unwrap ();\n\t\t\t\tlet end_position = iter.position + child_bits;\n\t\t\t\twhile iter.position \u003c end_position {\n\t\t\t\t\tchildren.push (Self::decode (iter).unwrap ());\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet num_children = iter.next_uint (11).unwrap ();\n\t\t\t\tfor _ in 0 .. num_children {\n\t\t\t\t\tchildren.push (Self::decode (iter).unwrap ());\n\t\t\t\t}\n\t\t\t}\n\t\t\tSome (Self { version, packet_type, value, children })\n\t\t}\n\t\tpub fn version_sum (\u0026 self) -\u003e u64 {\n\t\t\tself.version + self.children.iter ()\n\t\t\t\t.map (Self::version_sum)\n\t\t\t\t.sum::\u003cu64\u003e ()\n\t\t}\n\t}\n\n\tpub struct BitIter \u003c'inr\u003e {\n\t\tinner: Chars \u003c'inr\u003e,\n\t\tbuffer: Vec \u003cu64\u003e,\n\t\tposition: u64,\n\t}\n\n\timpl \u003c'inr\u003e BitIter \u003c'inr\u003e {\n\t\tpub fn new (inner_str: \u0026 'inr str) -\u003e BitIter \u003c'inr\u003e {\n\t\t\tBitIter {\n\t\t\t\tinner: inner_str.chars (),\n\t\t\t\tbuffer: Vec::with_capacity (4),\n\t\t\t\tposition: 0,\n\t\t\t}\n\t\t}\n\t\tfn next_uint (\u0026 mut self, bits: u8) -\u003e Option \u003cu64\u003e {\n\t\t\tif bits \u003e 64 { panic! (); }\n\t\t\tlet mut val = 0;\n\t\t\tfor _ in 0 .. bits {\n\t\t\t\tlet next_bit = some_or! (self.next_bit (), return None);\n\t\t\t\tval = val \u003c\u003c 1_i32 | next_bit;\n\t\t\t}\n\t\t\tSome (val)\n\t\t}\n\t\tfn next_bit (\u0026 mut self) -\u003e Option \u003cu64\u003e {\n\t\t\tif ! self.has_next () { return None }\n\t\t\tself.position += 1;\n\t\t\tself.buffer.pop ()\n\t\t}\n\t\tfn has_next (\u0026 mut self) -\u003e bool {\n\t\t\tif self.buffer.is_empty () {\n\t\t\t\tif let Some (next_char) = self.inner.next () {\n\t\t\t\t\tlet mut next_nibble = next_char.to_digit (16).unwrap ().as_u64 ();\n\t\t\t\t\tfor _ in 0_i32 .. 4_i32 {\n\t\t\t\t\t\tself.buffer.push (next_nibble \u0026 1);\n\t\t\t\t\t\tnext_nibble \u003e\u003e= 1_i32;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t! self.buffer.is_empty ()\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"6\", puzzle.part_one (\u0026 [\"D2FE28\"]));\n\t\tassert_eq_ok! (\"9\", puzzle.part_one (\u0026 [\"38006F45291200\"]));\n\t\tassert_eq_ok! (\"14\", puzzle.part_one (\u0026 [\"EE00D40C823060\"]));\n\t\tassert_eq_ok! (\"16\", puzzle.part_one (\u0026 [\"8A004A801A8002F478\"]));\n\t\tassert_eq_ok! (\"12\", puzzle.part_one (\u0026 [\"620080001611562C8802118E34\"]));\n\t\tassert_eq_ok! (\"23\", puzzle.part_one (\u0026 [\"C0015000016115A2E0802F182340\"]));\n\t\tassert_eq_ok! (\"31\", puzzle.part_one (\u0026 [\"A0016C880162017C3686B18A3D4780\"]));\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"3\", puzzle.part_two (\u0026 [\"C200B40A82\"]));\n\t\tassert_eq_ok! (\"54\", puzzle.part_two (\u0026 [\"04005AC33890\"]));\n\t\tassert_eq_ok! (\"7\", puzzle.part_two (\u0026 [\"880086C3E88112\"]));\n\t\tassert_eq_ok! (\"9\", puzzle.part_two (\u0026 [\"CE00C43D881120\"]));\n\t\tassert_eq_ok! (\"1\", puzzle.part_two (\u0026 [\"D8005AC2A8F0\"]));\n\t\tassert_eq_ok! (\"0\", puzzle.part_two (\u0026 [\"F600BC2D8F\"]));\n\t\tassert_eq_ok! (\"0\", puzzle.part_two (\u0026 [\"9C005AC2F8F0\"]));\n\t\tassert_eq_ok! (\"1\", puzzle.part_two (\u0026 [\"9C0141080250320F1802104A08\"]));\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":7,"address":[47689,48169],"length":1,"stats":{"Line":2},"fn_name":null},{"line":11,"address":[47784,47805],"length":1,"stats":{"Line":2},"fn_name":null},{"line":12,"address":[48264,48285],"length":1,"stats":{"Line":2},"fn_name":null},{"line":21,"address":[48899,48720,48922],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":22,"address":[48749],"length":1,"stats":{"Line":1},"fn_name":null},{"line":23,"address":[48813,48769],"length":1,"stats":{"Line":2},"fn_name":null},{"line":24,"address":[48842],"length":1,"stats":{"Line":1},"fn_name":null},{"line":27,"address":[49139,48960,49162],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":28,"address":[48989],"length":1,"stats":{"Line":1},"fn_name":null},{"line":29,"address":[49053,49009],"length":1,"stats":{"Line":2},"fn_name":null},{"line":30,"address":[49082],"length":1,"stats":{"Line":1},"fn_name":null},{"line":33,"address":[49200],"length":1,"stats":{"Line":1},"fn_name":"packet_eval"},{"line":34,"address":[69488,69497],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":35,"address":[69584,69603],"length":1,"stats":{"Line":3},"fn_name":"{closure#1}"},{"line":36,"address":[69696,69717],"length":1,"stats":{"Line":2},"fn_name":"{closure#2}"},{"line":37,"address":[49247],"length":1,"stats":{"Line":1},"fn_name":null},{"line":38,"address":[49319,50061],"length":1,"stats":{"Line":2},"fn_name":null},{"line":39,"address":[50027,49353],"length":1,"stats":{"Line":2},"fn_name":null},{"line":40,"address":[49968,49381],"length":1,"stats":{"Line":2},"fn_name":null},{"line":41,"address":[49907,49409],"length":1,"stats":{"Line":2},"fn_name":null},{"line":42,"address":[49445],"length":1,"stats":{"Line":1},"fn_name":null},{"line":43,"address":[49462,49796],"length":1,"stats":{"Line":2},"fn_name":null},{"line":44,"address":[49698,49505],"length":1,"stats":{"Line":2},"fn_name":null},{"line":45,"address":[49548],"length":1,"stats":{"Line":1},"fn_name":null},{"line":46,"address":[49289],"length":1,"stats":{"Line":0},"fn_name":null},{"line":67,"address":[30400,31984],"length":1,"stats":{"Line":2},"fn_name":"decode"},{"line":68,"address":[30450,30519],"length":1,"stats":{"Line":2},"fn_name":null},{"line":69,"address":[30483,30559],"length":1,"stats":{"Line":4},"fn_name":null},{"line":70,"address":[30596],"length":1,"stats":{"Line":2},"fn_name":null},{"line":71,"address":[30667],"length":1,"stats":{"Line":2},"fn_name":null},{"line":72,"address":[30679],"length":1,"stats":{"Line":2},"fn_name":null},{"line":73,"address":[30700],"length":1,"stats":{"Line":2},"fn_name":null},{"line":74,"address":[30706],"length":1,"stats":{"Line":1},"fn_name":null},{"line":75,"address":[30717],"length":1,"stats":{"Line":1},"fn_name":null},{"line":76,"address":[31626],"length":1,"stats":{"Line":1},"fn_name":null},{"line":77,"address":[31785,31701],"length":1,"stats":{"Line":1},"fn_name":null},{"line":78,"address":[31766,31831],"length":1,"stats":{"Line":3},"fn_name":null},{"line":79,"address":[31902,31951],"length":1,"stats":{"Line":2},"fn_name":null},{"line":80,"address":[31938],"length":1,"stats":{"Line":2},"fn_name":null},{"line":82,"address":[30730,30809],"length":1,"stats":{"Line":2},"fn_name":null},{"line":83,"address":[30862,31410],"length":1,"stats":{"Line":2},"fn_name":null},{"line":84,"address":[31485,31454],"length":1,"stats":{"Line":1},"fn_name":null},{"line":85,"address":[31530,31483],"length":1,"stats":{"Line":2},"fn_name":null},{"line":86,"address":[31556],"length":1,"stats":{"Line":1},"fn_name":null},{"line":89,"address":[30901],"length":1,"stats":{"Line":1},"fn_name":null},{"line":90,"address":[30982],"length":1,"stats":{"Line":1},"fn_name":null},{"line":91,"address":[31329],"length":1,"stats":{"Line":1},"fn_name":null},{"line":94,"address":[31162],"length":1,"stats":{"Line":2},"fn_name":null},{"line":96,"address":[32016],"length":1,"stats":{"Line":1},"fn_name":"version_sum"},{"line":97,"address":[32157,32025],"length":1,"stats":{"Line":1},"fn_name":null},{"line":110,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":113,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":117,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":118,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":119,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":120,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":121,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":122,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":124,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":126,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":127,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":128,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":129,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":131,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":132,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":133,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":134,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":135,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":136,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":137,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":141,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":153,"address":[50473,50464],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":154,"address":[50567],"length":1,"stats":{"Line":1},"fn_name":null},{"line":155,"address":[50803,50644,50728],"length":1,"stats":{"Line":3},"fn_name":null},{"line":156,"address":[51255,51377],"length":1,"stats":{"Line":2},"fn_name":null},{"line":157,"address":[51819,51941],"length":1,"stats":{"Line":2},"fn_name":null},{"line":158,"address":[52383,52505],"length":1,"stats":{"Line":2},"fn_name":null},{"line":159,"address":[52947,53069],"length":1,"stats":{"Line":2},"fn_name":null},{"line":160,"address":[53493,53609],"length":1,"stats":{"Line":2},"fn_name":null},{"line":161,"address":[54018,54134],"length":1,"stats":{"Line":2},"fn_name":null},{"line":162,"address":[54543],"length":1,"stats":{"Line":1},"fn_name":null},{"line":166,"address":[50521,50512],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":167,"address":[54807],"length":1,"stats":{"Line":1},"fn_name":null},{"line":168,"address":[55051,54892,54976],"length":1,"stats":{"Line":3},"fn_name":null},{"line":169,"address":[55625,55503],"length":1,"stats":{"Line":2},"fn_name":null},{"line":170,"address":[56189,56067],"length":1,"stats":{"Line":2},"fn_name":null},{"line":171,"address":[56631,56753],"length":1,"stats":{"Line":2},"fn_name":null},{"line":172,"address":[57195,57317],"length":1,"stats":{"Line":2},"fn_name":null},{"line":173,"address":[57759,57881],"length":1,"stats":{"Line":2},"fn_name":null},{"line":174,"address":[58305,58421],"length":1,"stats":{"Line":2},"fn_name":null},{"line":175,"address":[58830,58946],"length":1,"stats":{"Line":2},"fn_name":null},{"line":176,"address":[59355],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":92,"coverable":93},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-17","src","lib.rs"],"content":"//! Advent of Code 2021: Day 17: Trick Shot\n//!\n//! [https://adventofcode.com/2021/day/17](https://adventofcode.com/2021/day/17)\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Trick Shot\";\n\tyear = 2021;\n\tday = 17;\n\tpart_one = |lines| logic::part_one (lines [0]);\n\tpart_two = |lines| logic::part_two (lines [0]);\n}\n\nmod logic {\n\n\tuse super::*;\n\tuse model::Input;\n\tuse model::Position;\n\tuse model::Velocity;\n\tuse nums::IntConv;\n\n\tpub fn part_one (input: \u0026 str) -\u003e GenResult \u003ci64\u003e {\n\t\tlet input = Input::parse (input) ?;\n\t\tlet results = find_solutions (\u0026 input);\n\t\tOk (results.into_iter ().map (|(_, height)| height).max ().unwrap ())\n\t}\n\n\tpub fn part_two (input: \u0026 str) -\u003e GenResult \u003ci64\u003e {\n\t\tlet input = Input::parse (input) ?;\n\t\tlet results = find_solutions (\u0026 input);\n\t\tOk (results.len ().as_i64 ())\n\t}\n\n\tfn find_solutions (input: \u0026 Input) -\u003e Vec \u003c(Velocity, i64)\u003e {\n\t\tlet mut results: Vec \u003c(Velocity, i64)\u003e = Vec::new ();\n\t\tfor x_velocity in 1 ..= * input.target_x.end () {\n\t\t\tfor y_velocity in * input.target_y.start () ..= -2 * input.target_y.end () {\n\t\t\t\tlet velocity = Velocity { x: x_velocity, y: y_velocity };\n\t\t\t\tif let Some (max_height) = simulate (input, velocity) {\n\t\t\t\t\tresults.push ((velocity, max_height));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tresults\n\t}\n\n\tfn simulate (input: \u0026 Input, velocity: Velocity) -\u003e Option \u003ci64\u003e {\n\t\tlet mut position = Position { x: 0, y: 0 };\n\t\tlet mut velocity = velocity;\n\t\tlet mut max_height = 0;\n\t\twhile ! ((velocity.x == 0 \u0026\u0026 position.x \u003c * input.target_x.start ())\n\t\t\t\t|| (position.x \u003e * input.target_x.end ())\n\t\t\t\t|| (velocity.y \u003c= 0 \u0026\u0026 position.y \u003c * input.target_y.start ())) {\n\t\t\tif input.target_x.contains (\u0026 position.x)\n\t\t\t\t\t\u0026\u0026 input.target_y.contains (\u0026 position.y) {\n\t\t\t\treturn Some (max_height);\n\t\t\t}\n\t\t\tposition.x += velocity.x;\n\t\t\tif velocity.x \u003e 0 { velocity.x -= 1; }\n\t\t\tposition.y += velocity.y;\n\t\t\tvelocity.y -= 1;\n\t\t\tif position.y \u003e max_height { max_height = position.y; }\n\t\t}\n\t\tNone\n\t}\n\n}\n\nmod model {\n\n\tuse super::*;\n\n\t#[ derive (Clone, Debug) ]\n\tpub struct Input {\n\t\tpub target_x: RangeInclusive \u003ci64\u003e,\n\t\tpub target_y: RangeInclusive \u003ci64\u003e,\n\t}\n\n\timpl Input {\n\t\tpub fn parse (input: \u0026 str) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tuse parser::*;\n\t\t\tParser::wrap (input, |parser| {\n\t\t\t\tlet x_min = parser.expect (\"target area: x=\") ?.int () ?;\n\t\t\t\tlet x_max = parser.expect (\"..\") ?.int () ?;\n\t\t\t\tlet y_min = parser.expect (\", y=\") ?.int () ?;\n\t\t\t\tlet y_max = parser.expect (\"..\") ?.int () ?;\n\t\t\t\tparser.end () ?;\n\t\t\t\tOk (Self {\n\t\t\t\t\ttarget_x: x_min ..= x_max,\n\t\t\t\t\ttarget_y: y_min ..= y_max,\n\t\t\t\t})\n\t\t\t}).map_parse_err (|char_idx|\n\t\t\t\tformat! (\"Invalid input: col {}: {}\", char_idx + 1, input)\n\t\t\t)\n\t\t}\n\t}\n\n\t#[ derive (Clone, Copy, Debug) ]\n\tpub struct Position {\n\t\tpub x: i64,\n\t\tpub y: i64,\n\t}\n\n\t#[ derive (Clone, Copy, Debug) ]\n\tpub struct Velocity {\n\t\tpub x: i64,\n\t\tpub y: i64,\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 str = \"target area: x=20..30, y=-10..-5\";\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (45, logic::part_one (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn test_example () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (112, logic::part_two (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":7,"address":[53081,52553],"length":1,"stats":{"Line":0},"fn_name":null},{"line":11,"address":[52648,52669],"length":1,"stats":{"Line":0},"fn_name":null},{"line":12,"address":[53197,53176],"length":1,"stats":{"Line":0},"fn_name":null},{"line":23,"address":[25888],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":24,"address":[25921,26043],"length":1,"stats":{"Line":1},"fn_name":null},{"line":25,"address":[26018],"length":1,"stats":{"Line":1},"fn_name":null},{"line":26,"address":[26096],"length":1,"stats":{"Line":3},"fn_name":null},{"line":29,"address":[26272,26592],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":30,"address":[26427,26305],"length":1,"stats":{"Line":1},"fn_name":null},{"line":31,"address":[26402],"length":1,"stats":{"Line":1},"fn_name":null},{"line":32,"address":[26542,26488],"length":1,"stats":{"Line":2},"fn_name":null},{"line":35,"address":[27385,26624],"length":1,"stats":{"Line":1},"fn_name":"find_solutions"},{"line":36,"address":[26657],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[26725,26911,26667],"length":1,"stats":{"Line":3},"fn_name":null},{"line":38,"address":[26932],"length":1,"stats":{"Line":1},"fn_name":null},{"line":39,"address":[27214],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[27230],"length":1,"stats":{"Line":1},"fn_name":null},{"line":41,"address":[27325],"length":1,"stats":{"Line":1},"fn_name":null},{"line":48,"address":[27424],"length":1,"stats":{"Line":1},"fn_name":"simulate"},{"line":49,"address":[27460],"length":1,"stats":{"Line":1},"fn_name":null},{"line":50,"address":[27478],"length":1,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[27494],"length":1,"stats":{"Line":1},"fn_name":null},{"line":52,"address":[27506,27620,27656,27768,27680],"length":1,"stats":{"Line":5},"fn_name":null},{"line":53,"address":[27650,27597],"length":1,"stats":{"Line":2},"fn_name":null},{"line":54,"address":[27667,27703],"length":1,"stats":{"Line":2},"fn_name":null},{"line":55,"address":[27805,27870],"length":1,"stats":{"Line":2},"fn_name":null},{"line":56,"address":[27844],"length":1,"stats":{"Line":1},"fn_name":null},{"line":57,"address":[27916],"length":1,"stats":{"Line":1},"fn_name":null},{"line":59,"address":[27961,27889,27979],"length":1,"stats":{"Line":2},"fn_name":null},{"line":60,"address":[27966,28036],"length":1,"stats":{"Line":2},"fn_name":null},{"line":61,"address":[28138,28009,28109],"length":1,"stats":{"Line":2},"fn_name":null},{"line":62,"address":[28172,28200,28114],"length":1,"stats":{"Line":2},"fn_name":null},{"line":63,"address":[28230,28180],"length":1,"stats":{"Line":2},"fn_name":null},{"line":65,"address":[27786],"length":1,"stats":{"Line":1},"fn_name":null},{"line":81,"address":[28432],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":83,"address":[28491,28456],"length":1,"stats":{"Line":5},"fn_name":null},{"line":84,"address":[49578,49262,49481],"length":1,"stats":{"Line":2},"fn_name":null},{"line":85,"address":[49703,50006,49900,49543],"length":1,"stats":{"Line":3},"fn_name":null},{"line":86,"address":[49974,50127,50324,50430],"length":1,"stats":{"Line":3},"fn_name":null},{"line":87,"address":[50398,50842,50551,50748],"length":1,"stats":{"Line":3},"fn_name":null},{"line":88,"address":[51042,50963,50822],"length":1,"stats":{"Line":2},"fn_name":null},{"line":89,"address":[51192],"length":1,"stats":{"Line":1},"fn_name":null},{"line":90,"address":[51021],"length":1,"stats":{"Line":1},"fn_name":null},{"line":91,"address":[51173],"length":1,"stats":{"Line":1},"fn_name":null},{"line":93,"address":[28481],"length":1,"stats":{"Line":1},"fn_name":null},{"line":94,"address":[51366],"length":1,"stats":{"Line":0},"fn_name":null},{"line":121,"address":[22992],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":122,"address":[22999,23236],"length":1,"stats":{"Line":1},"fn_name":null},{"line":123,"address":[23216],"length":1,"stats":{"Line":1},"fn_name":null},{"line":127,"address":[23280],"length":1,"stats":{"Line":3},"fn_name":"test_example"},{"line":128,"address":[23287,23524],"length":1,"stats":{"Line":1},"fn_name":null},{"line":129,"address":[23504],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":48,"coverable":52},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-18","src","lib.rs"],"content":"//! Advent of Code 2021: Day 18: Snailfish\n//!\n//! [https://adventofcode.com/2021/day/18](https://adventofcode.com/2021/day/18)\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Snailfish\";\n\tyear = 2021;\n\tday = 18;\n\tpart_one = |lines| Ok::\u003c_, Infallible\u003e (logic::part_one (lines));\n\tpart_two = |lines| Ok::\u003c_, Infallible\u003e (logic::part_two (lines));\n}\n\nmod logic {\n\n\tuse super::*;\n\tuse snailfish::Snailfish;\n\n\tpub fn part_one (lines: \u0026 [\u0026 str]) -\u003e i64 {\n\t\tlet sum = Snailfish::sum (lines.iter ().copied ().map (Snailfish::parse));\n\t\tsum.magnitude ()\n\t}\n\n\tpub fn part_two (lines: \u0026 [\u0026 str]) -\u003e i64 {\n\t\tlet numbers: Vec \u003cSnailfish\u003e = lines.iter ().copied ().map (Snailfish::parse).collect ();\n\t\tlet mut best: i64 = i64::MIN;\n\t\tfor i in 0 .. numbers.len () {\n\t\t\tfor j in 0 .. numbers.len () {\n\t\t\t\tif i == j { continue }\n\t\t\t\tlet value = Snailfish::add (numbers [i].clone (), numbers [j].clone ()).magnitude ();\n\t\t\t\tif value \u003e best { best = value; }\n\t\t\t}\n\t\t}\n\t\tbest\n\t}\n\n}\n\nmod snailfish {\n\n\tuse super::*;\n\tuse model::Token;\n\tuse model::Tokens;\n\n\t#[ derive (Clone, Eq, PartialEq) ]\n\tpub struct Snailfish {\n\t\ttokens: Rc \u003cTokens\u003e,\n\t}\n\n\timpl Snailfish {\n\n\t\tpub fn magnitude (\u0026 self) -\u003e i64 {\n\t\t\tlet mut pos: usize = 0;\n\t\t\tlet result = self.magnitude_real (\u0026 mut pos);\n\t\t\tif pos != self.tokens.len () { panic! () }\n\t\t\tresult\n\t\t}\n\n\t\tfn magnitude_real (\u0026 self, pos: \u0026 mut usize) -\u003e i64 {\n\t\t\tif * pos + 1 \u003e self.tokens.len () { panic! () }\n\t\t\tif self.tokens [* pos].is_value () {\n\t\t\t\tlet value = self.tokens [* pos].value ();\n\t\t\t\t* pos += 1;\n\t\t\t\treturn value;\n\t\t\t}\n\t\t\tif ! self.tokens [* pos].is_open () { panic! () }\n\t\t\t* pos += 1;\n\t\t\tlet left = self.magnitude_real (pos);\n\t\t\tif ! self.tokens [* pos].is_comma () { panic! () }\n\t\t\t* pos += 1;\n\t\t\tlet right = self.magnitude_real (pos);\n\t\t\tif ! self.tokens [* pos].is_close () { panic! () }\n\t\t\t* pos += 1;\n\t\t\tleft * 3 + right * 2\n\t\t}\n\n\t\tpub fn sum \u003cItem, Iter\u003e (iter: Iter) -\u003e Self\n\t\t\twhere\n\t\t\t\tItem: Borrow \u003cSelf\u003e,\n\t\t\t\tIter: Iterator \u003cItem = Item\u003e {\n\t\t\tlet mut sum = None;\n\t\t\tfor item in iter {\n\t\t\t\tlet item = item.borrow ();\n\t\t\t\tif let Some (prev_sum) = sum {\n\t\t\t\t\tsum = Some (Self::add (prev_sum, item));\n\t\t\t\t} else {\n\t\t\t\t\tsum = Some (item.clone ());\n\t\t\t\t}\n\t\t\t}\n\t\t\tsum.unwrap ()\n\t\t}\n\n\t\tpub fn add (left: impl Into \u003cSelf\u003e, right: impl Into \u003cSelf\u003e) -\u003e Self {\n\t\t\tSelf::pair (left, right).reduce ()\n\t\t}\n\n\t\tpub fn pair (left: impl Into \u003cSelf\u003e, right: impl Into \u003cSelf\u003e) -\u003e Self {\n\t\t\tlet Self { tokens: left_tokens } = left.into ();\n\t\t\tlet Self { tokens: right_tokens } = right.into ();\n\t\t\tmatch Rc::try_unwrap (left_tokens) {\n\t\t\t\tOk (mut left_tokens) =\u003e {\n\t\t\t\t\tleft_tokens.insert (0, Token::Open);\n\t\t\t\t\tleft_tokens.extend (\n\t\t\t\t\t\titer::once (Token::Comma)\n\t\t\t\t\t\t\t.chain (right_tokens.iter ().copied ())\n\t\t\t\t\t\t\t.chain (iter::once (Token::Close)));\n\t\t\t\t\tSelf { tokens: left_tokens.into () }\n\t\t\t\t},\n\t\t\t\tErr (left_tokens) =\u003e match Rc::try_unwrap (right_tokens) {\n\t\t\t\t\tOk (mut right_tokens) =\u003e {\n\t\t\t\t\t\tright_tokens.splice (0 .. 0,\n\t\t\t\t\t\t\titer::once (Token::Open)\n\t\t\t\t\t\t\t\t.chain (left_tokens.iter ().copied ())\n\t\t\t\t\t\t\t\t.chain (iter::once (Token::Comma)));\n\t\t\t\t\t\tright_tokens.push (Token::Close);\n\t\t\t\t\t\tSelf { tokens: right_tokens.into () }\n\t\t\t\t\t},\n\t\t\t\t\tErr (right_tokens) =\u003e {\n\t\t\t\t\t\tlet tokens =\n\t\t\t\t\t\t\titer::once (Token::Open)\n\t\t\t\t\t\t\t\t.chain (left_tokens.iter ().copied ())\n\t\t\t\t\t\t\t\t.chain (iter::once (Token::Comma))\n\t\t\t\t\t\t\t\t.chain (right_tokens.iter ().copied ())\n\t\t\t\t\t\t\t\t.chain (iter::once (Token::Close))\n\t\t\t\t\t\t\t\t.collect::\u003cTokens\u003e ();\n\t\t\t\t\t\tSelf { tokens: tokens.into () }\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\n\t\tpub fn reduce (self) -\u003e Self {\n\t\t\tlet mut val = self;\n\t\t\tloop {\n\t\t\t\tlet reduced;\n\t\t\t\t(reduced, val) = val.reduce_once ();\n\t\t\t\tif ! reduced { return val }\n\t\t\t}\n\t\t}\n\n\t\tpub fn reduce_once (self) -\u003e (bool, Self) {\n\t\t\tlet mut depth = 0_u32;\n\t\t\tfor (pos, token) in self.tokens.iter ().enumerate () {\n\t\t\t\tmatch * token {\n\t\t\t\t\tToken::Open =\u003e {\n\t\t\t\t\t\tif depth == 4 {\n\t\t\t\t\t\t\treturn (true, self.reduce_explode (pos));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdepth += 1;\n\t\t\t\t\t},\n\t\t\t\t\tToken::Close =\u003e {\n\t\t\t\t\t\tif depth == 0 { panic! () }\n\t\t\t\t\t\tdepth -= 1;\n\t\t\t\t\t},\n\t\t\t\t\tToken::Comma | Token::Value (_) =\u003e (),\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (pos, token) in self.tokens.iter ().enumerate () {\n\t\t\t\tif let \u0026 Token::Value (value) = token {\n\t\t\t\t\tif value \u003e= 10 {\n\t\t\t\t\t\treturn (true, self.reduce_split (pos));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t(false, self)\n\t\t}\n\n\t\tfn reduce_explode (self, pos: usize) -\u003e Self {\n\t\t\tif ! (self.tokens [pos].is_open ()\n\t\t\t\t\t\u0026\u0026 self.tokens [pos + 1].is_value ()\n\t\t\t\t\t\u0026\u0026 self.tokens [pos + 2].is_comma ()\n\t\t\t\t\t\u0026\u0026 self.tokens [pos + 3].is_value ()\n\t\t\t\t\t\u0026\u0026 self.tokens [pos + 4].is_close ()) {\n\t\t\t\tpanic! ();\n\t\t\t}\n\t\t\tlet explode_left = self.tokens [pos + 1].value ();\n\t\t\tlet explode_right = self.tokens [pos + 3].value ();\n\t\t\tmatch Rc::try_unwrap (self.tokens) {\n\t\t\t\tOk (mut tokens) =\u003e {\n\t\t\t\t\tif let Some (pos_left) =\n\t\t\t\t\t\t\ttokens [0 .. pos].iter ().rposition (Token::is_value) {\n\t\t\t\t\t\ttokens [pos_left] =\n\t\t\t\t\t\t\tToken::Value (tokens [pos_left].value () + explode_left);\n\t\t\t\t\t}\n\t\t\t\t\ttokens.splice (pos .. pos + 5, iter::once (Token::Value (0)));\n\t\t\t\t\tif let Some (pos_right) =\n\t\t\t\t\t\t\ttokens [pos + 1 ..].iter ().position (Token::is_value) {\n\t\t\t\t\t\ttokens [pos + 1 + pos_right] =\n\t\t\t\t\t\t\tToken::Value (tokens [pos + 1 + pos_right].value () + explode_right);\n\t\t\t\t\t}\n\t\t\t\t\tSelf { tokens: tokens.into () }\n\t\t\t\t},\n\t\t\t\tErr (tokens) =\u003e {\n\t\t\t\t\tlet mut result = Tokens::new ();\n\t\t\t\t\tif let Some (pos_left) = tokens [0 .. pos].iter ().rposition (Token::is_value) {\n\t\t\t\t\t\tresult.extend (tokens [0 .. pos_left].iter ().copied ());\n\t\t\t\t\t\tresult.push (Token::Value (tokens [pos_left].value () + explode_left));\n\t\t\t\t\t\tresult.extend (tokens [pos_left + 1 .. pos].iter ().copied ());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.extend (tokens [0 .. pos].iter ().copied ());\n\t\t\t\t\t}\n\t\t\t\t\tresult.push (Token::Value (0));\n\t\t\t\t\tif let Some (pos_right) = tokens [pos + 5 ..].iter ().position (Token::is_value) {\n\t\t\t\t\t\tlet pos_right = pos + 5 + pos_right;\n\t\t\t\t\t\tresult.extend (tokens [pos + 5 .. pos_right].iter ().copied ());\n\t\t\t\t\t\tresult.push (Token::Value (tokens [pos_right].value () + explode_right));\n\t\t\t\t\t\tresult.extend (tokens [pos_right + 1 ..].iter ().copied ());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.extend (tokens [pos + 5 ..].iter ().copied ());\n\t\t\t\t\t}\n\t\t\t\t\tSelf { tokens: result.into () }\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\n\t\tfn reduce_split (self, pos: usize) -\u003e Self {\n\t\t\tlet value = self.tokens [pos].value ();\n\t\t\tmatch Rc::try_unwrap (self.tokens) {\n\t\t\t\tOk (mut tokens) =\u003e {\n\t\t\t\t\ttokens.splice (pos .. pos + 1, [\n\t\t\t\t\t\tToken::Open,\n\t\t\t\t\t\tToken::Value (value / 2),\n\t\t\t\t\t\tToken::Comma,\n\t\t\t\t\t\tToken::Value ((value + 1) / 2),\n\t\t\t\t\t\tToken::Close,\n\t\t\t\t\t]);\n\t\t\t\t\tSelf { tokens: tokens.into () }\n\t\t\t\t},\n\t\t\t\tErr (tokens) =\u003e {\n\t\t\t\t\tlet mut result = Tokens::new ();\n\t\t\t\t\tresult.extend (tokens [0 .. pos].iter ().copied ());\n\t\t\t\t\tresult.push (Token::Open);\n\t\t\t\t\tresult.push (Token::Value (value / 2));\n\t\t\t\t\tresult.push (Token::Comma);\n\t\t\t\t\tresult.push (Token::Value ((value + 1) / 2));\n\t\t\t\t\tresult.push (Token::Close);\n\t\t\t\t\tresult.extend (tokens [pos + 1 ..].iter ().copied ());\n\t\t\t\t\tSelf { tokens: result.into () }\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\n\t\tpub fn parse (input: \u0026 str) -\u003e Self {\n\t\t\tSelf {\n\t\t\t\ttokens: model::parse_tokens (\u0026 mut input.chars ().peekable ()).into (),\n\t\t\t}\n\t\t}\n\n\t}\n\n\timpl From \u003c\u0026 Self\u003e for Snailfish {\n\t\tfn from (val: \u0026 Self) -\u003e Self {\n\t\t\tSelf { tokens: Rc::clone (\u0026 val.tokens) }\n\t\t}\n\t}\n\n\timpl Display for Snailfish {\n\t\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\t\tfor token in self.tokens.iter_vals () {\n\t\t\t\tmatch token {\n\t\t\t\t\tToken::Open =\u003e write! (formatter, \"[\") ?,\n\t\t\t\t\tToken::Close =\u003e write! (formatter, \"]\") ?,\n\t\t\t\t\tToken::Comma =\u003e write! (formatter, \",\") ?,\n\t\t\t\t\tToken::Value (value) =\u003e write! (formatter, \"{}\", value) ?,\n\t\t\t\t}\n\t\t\t}\n\t\t\tOk (())\n\t\t}\n\t}\n\n\timpl Debug for Snailfish {\n\t\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\t\twrite! (formatter, \"Snaifish \\\"{}\\\"\", self) ?;\n\t\t\tOk (())\n\t\t}\n\t}\n\n\t#[ cfg (test) ]\n\tmod tests {\n\n\t\tuse super::*;\n\n\t\t#[ test ]\n\t\tfn test_reduce_once_explode () {\n\t\t\tassert_eq! (\n\t\t\t\t(true, Snailfish::parse (\"[[[[0,9],2],3],4]\")),\n\t\t        Snailfish::parse (\"[[[[[9,8],1],2],3],4]\").reduce_once (),\n\t\t\t);\n\t\t\tassert_eq! (\n\t\t\t\t(true, Snailfish::parse (\"[7,[6,[5,[7,0]]]]\")),\n\t\t\t\tSnailfish::parse (\"[7,[6,[5,[4,[3,2]]]]]\").reduce_once (),\n\t\t\t);\n\t\t\tassert_eq! (\n\t\t\t\t(true, Snailfish::parse (\"[[6,[5,[7,0]]],3]\")),\n\t\t\t\tSnailfish::parse (\"[[6,[5,[4,[3,2]]]],1]\").reduce_once (),\n\t\t\t);\n\t\t\tassert_eq! (\n\t\t\t\t(true, Snailfish::parse (\"[[3,[2,[8,0]]],[9,[5,[4,[3,2]]]]]\")),\n\t\t\t    Snailfish::parse (\"[[3,[2,[1,[7,3]]]],[6,[5,[4,[3,2]]]]]\").reduce_once (),\n\t\t\t);\n\t\t\tassert_eq! (\n\t\t\t\t(true, Snailfish::parse (\"[[3,[2,[8,0]]],[9,[5,[7,0]]]]\")),\n\t\t\t\tSnailfish::parse (\"[[3,[2,[8,0]]],[9,[5,[4,[3,2]]]]]\").reduce_once (),\n\t\t\t);\n\t\t}\n\n\t\t#[ test ]\n\t\tfn test_reduce_once_split () {\n\t\t\tassert_eq! (\n\t\t\t\t(true, Snailfish::parse (\"[5,5]\")),\n\t\t\t\tSnailfish::parse (\"10\").reduce_once (),\n\t\t\t);\n\t\t\tassert_eq! (\n\t\t\t\t(true, Snailfish::parse (\"[5,6]\")),\n\t\t\t\tSnailfish::parse (\"11\").reduce_once (),\n\t\t\t);\n\t\t\tassert_eq! (\n\t\t\t\t(true, Snailfish::parse (\"[6,6]\")),\n\t\t\t\tSnailfish::parse (\"12\").reduce_once (),\n\t\t\t);\n\t\t}\n\n\t\t#[ test ]\n\t\tfn test_add () {\n\t\t\tassert_eq! (\n\t\t\t\tSnailfish::parse (\"[[[[0,7],4],[[7,8],[6,0]]],[8,1]]\"),\n\t\t\t\tSnailfish::add (\n\t\t\t\t\tSnailfish::parse (\"[[[[4,3],4],4],[7,[[8,4],9]]]\"),\n\t\t\t\t\tSnailfish::parse (\"[1,1]\"),\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\n\t\t#[ test ]\n\t\tfn test_sum () {\n\t\t\tassert_eq! (\n\t\t\t\tSnailfish::parse (\"[[[[1,1],[2,2]],[3,3]],[4,4]]\"),\n\t\t\t\tSnailfish::sum (vec! [\"[1,1]\", \"[2,2]\", \"[3,3]\", \"[4,4]\"].into_iter ().map (Snailfish::parse)),\n\t\t\t);\n\t\t\tassert_eq! (\n\t\t\t\tSnailfish::parse (\"[[[[3,0],[5,3]],[4,4]],[5,5]]\"),\n\t\t\t\tSnailfish::sum (vec! [\"[1,1]\", \"[2,2]\", \"[3,3]\", \"[4,4]\", \"[5,5]\"].into_iter ().map (Snailfish::parse)),\n\t\t\t);\n\t\t\tassert_eq! (\n\t\t\t\tSnailfish::parse (\"[[[[5,0],[7,4]],[5,5]],[6,6]]\"),\n\t\t\t\tSnailfish::sum (vec! [\"[1,1]\", \"[2,2]\", \"[3,3]\", \"[4,4]\", \"[5,5]\", \"[6,6]\"].into_iter ().map (Snailfish::parse)),\n\t\t\t);\n\t\t\tassert_eq! (\n\t\t\t\tSnailfish::parse (\"[[[[8,7],[7,7]],[[8,6],[7,7]]],[[[0,7],[6,6]],[8,7]]]\"),\n\t\t\t\tSnailfish::sum (vec! [\n\t\t\t\t\t\"[[[0,[4,5]],[0,0]],[[[4,5],[2,6]],[9,5]]]\",\n\t\t\t\t\t\"[7,[[[3,7],[4,3]],[[6,3],[8,8]]]]\",\n\t\t\t\t\t\"[[2,[[0,8],[3,4]]],[[[6,7],1],[7,[1,6]]]]\",\n\t\t\t\t\t\"[[[[2,4],7],[6,[0,5]]],[[[6,8],[2,8]],[[2,1],[4,5]]]]\",\n\t\t\t\t\t\"[7,[5,[[3,8],[1,4]]]]\",\n\t\t\t\t\t\"[[2,[2,2]],[8,[8,1]]]\",\n\t\t\t\t\t\"[2,9]\",\n\t\t\t\t\t\"[1,[[[9,3],9],[[9,0],[0,7]]]]\",\n\t\t\t\t\t\"[[[5,[7,4]],7],1]\",\n\t\t\t\t\t\"[[[[4,2],2],6],[8,7]]\",\n\t\t\t\t].into_iter ().map (Snailfish::parse)),\n\t\t\t);\n\t\t}\n\n\t\t#[ test ]\n\t\tfn test_magnitude () {\n\t\t\tassert_eq! (143, Snailfish::parse (\"[[1,2],[[3,4],5]]\").magnitude ());\n\t\t\tassert_eq! (1384, Snailfish::parse (\"[[[[0,7],4],[[7,8],[6,0]]],[8,1]]\").magnitude ());\n\t\t\tassert_eq! (445, Snailfish::parse (\"[[[[1,1],[2,2]],[3,3]],[4,4]]\").magnitude ());\n\t\t\tassert_eq! (791, Snailfish::parse (\"[[[[3,0],[5,3]],[4,4]],[5,5]]\").magnitude ());\n\t\t\tassert_eq! (1137, Snailfish::parse (\"[[[[5,0],[7,4]],[5,5]],[6,6]]\").magnitude ());\n\t\t\tassert_eq! (3488, Snailfish::parse (\"[[[[8,7],[7,7]],[[8,6],[7,7]]],[[[0,7],[6,6]],[8,7]]]\").magnitude ());\n\t\t}\n\n\t}\n\n}\n\nmod model {\n\n\tuse super::*;\n\n\t//pub type Tokens = ArrayVec \u003cToken, 125\u003e;\n\tpub type Tokens = Vec \u003cToken\u003e;\n\n\tpub fn parse_tokens (input_iter: \u0026 mut Peekable \u003cChars \u003c'_\u003e\u003e) -\u003e Tokens {\n\t\tlet mut result = Tokens::new ();\n\t\twhile let Some (letter) = input_iter.peek () {\n\t\t\tmatch * letter {\n\t\t\t\t'[' =\u003e { input_iter.next ().unwrap (); result.push (Token::Open); },\n\t\t\t\t']' =\u003e { input_iter.next ().unwrap (); result.push (Token::Close); },\n\t\t\t\t',' =\u003e { input_iter.next ().unwrap (); result.push (Token::Comma); },\n\t\t\t\t'0' ..= '9' =\u003e {\n\t\t\t\t\tlet mut value_buf = String::new ();\n\t\t\t\t\tloop {\n\t\t\t\t\t\tif let Some (letter) = input_iter.peek () {\n\t\t\t\t\t\t\tif ('0' ..= '9').contains (letter) {\n\t\t\t\t\t\t\t\tvalue_buf.push (input_iter.next ().unwrap ());\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tresult.push (Token::Value (value_buf.parse ().unwrap ()));\n\t\t\t\t},\n\t\t\t\t_ =\u003e panic! (),\n\t\t\t}\n\t\t}\n\t\tresult\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\n\tpub enum Token {\n\t\tOpen,\n\t\tClose,\n\t\tComma,\n\t\tValue (i64),\n\t}\n\n\timpl Token {\n\t\tpub const fn is_open (\u0026 self) -\u003e bool { matches! (* self, Self::Open) }\n\t\tpub const fn is_close (\u0026 self) -\u003e bool { matches! (* self, Self::Close) }\n\t\tpub const fn is_comma (\u0026 self) -\u003e bool { matches! (* self, Self::Comma) }\n\t\tpub const fn is_value (\u0026 self) -\u003e bool { matches! (* self, Self::Value (_)) }\n\t\tpub fn value (\u0026 self) -\u003e i64 {\n\t\t\tif let Self::Value (value) = * self {\n\t\t\t\tvalue\n\t\t\t} else {\n\t\t\t\tpanic! (\"Called Token::value() on Token::{:?}\", self);\n\t\t\t}\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"[[[0,[5,8]],[[1,7],[9,6]]],[[4,[1,2]],[[1,4],2]]]\",\n\t\t\"[[[5,[2,8]],4],[5,[[9,9],0]]]\",\n\t\t\"[6,[[[6,2],[5,6]],[[7,6],[4,7]]]]\",\n\t\t\"[[[6,[0,7]],[0,9]],[4,[9,[9,0]]]]\",\n\t\t\"[[[7,[6,4]],[3,[1,3]]],[[[5,5],1],9]]\",\n\t\t\"[[6,[[7,3],[3,2]]],[[[3,8],[5,7]],4]]\",\n\t\t\"[[[[5,4],[7,7]],8],[[8,3],8]]\",\n\t\t\"[[9,3],[[9,9],[6,[4,9]]]]\",\n\t\t\"[[2,[[7,7],7]],[[5,8],[[9,3],[0,2]]]]\",\n\t\t\"[[[[5,2],5],[8,[3,7]]],[[5,[7,5]],[4,4]]]\",\n\t];\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"4140\", puzzle.part_one (EXAMPLE));\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tlet puzzle = puzzle_metadata ();\n\t\tassert_eq_ok! (\"3993\", puzzle.part_two (EXAMPLE));\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":7,"address":[58089,58489],"length":1,"stats":{"Line":2},"fn_name":null},{"line":11,"address":[58174,58193],"length":1,"stats":{"Line":2},"fn_name":null},{"line":12,"address":[58574,58593],"length":1,"stats":{"Line":2},"fn_name":null},{"line":20,"address":[117376,117534],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":21,"address":[117390],"length":1,"stats":{"Line":1},"fn_name":null},{"line":22,"address":[117482],"length":1,"stats":{"Line":1},"fn_name":null},{"line":25,"address":[118487,118586,117568],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":26,"address":[117591],"length":1,"stats":{"Line":1},"fn_name":null},{"line":27,"address":[117735],"length":1,"stats":{"Line":1},"fn_name":null},{"line":28,"address":[118001,117751,117814],"length":1,"stats":{"Line":3},"fn_name":null},{"line":29,"address":[118030],"length":1,"stats":{"Line":1},"fn_name":null},{"line":30,"address":[118234],"length":1,"stats":{"Line":1},"fn_name":null},{"line":31,"address":[118244,118506],"length":1,"stats":{"Line":1},"fn_name":null},{"line":32,"address":[118571,118606],"length":1,"stats":{"Line":2},"fn_name":null},{"line":53,"address":[103232],"length":1,"stats":{"Line":1},"fn_name":"magnitude"},{"line":54,"address":[103246],"length":1,"stats":{"Line":1},"fn_name":null},{"line":55,"address":[103255],"length":1,"stats":{"Line":1},"fn_name":null},{"line":56,"address":[103280,103327,103362],"length":1,"stats":{"Line":3},"fn_name":null},{"line":60,"address":[103392],"length":1,"stats":{"Line":1},"fn_name":"magnitude_real"},{"line":61,"address":[103508,103639,103431],"length":1,"stats":{"Line":2},"fn_name":null},{"line":62,"address":[103637,103685],"length":1,"stats":{"Line":3},"fn_name":null},{"line":63,"address":[103872],"length":1,"stats":{"Line":1},"fn_name":null},{"line":64,"address":[103991,103932],"length":1,"stats":{"Line":2},"fn_name":null},{"line":65,"address":[103981],"length":1,"stats":{"Line":1},"fn_name":null},{"line":67,"address":[103796,104053,104126],"length":1,"stats":{"Line":3},"fn_name":null},{"line":68,"address":[104200,104177,104105],"length":1,"stats":{"Line":3},"fn_name":null},{"line":69,"address":[104180],"length":1,"stats":{"Line":2},"fn_name":null},{"line":70,"address":[104295,104368],"length":1,"stats":{"Line":2},"fn_name":null},{"line":71,"address":[104419,104442,104347],"length":1,"stats":{"Line":3},"fn_name":null},{"line":72,"address":[104422],"length":1,"stats":{"Line":1},"fn_name":null},{"line":73,"address":[104610,104537],"length":1,"stats":{"Line":2},"fn_name":null},{"line":74,"address":[104658,104589,104684],"length":1,"stats":{"Line":3},"fn_name":null},{"line":75,"address":[104845,104661,104719],"length":1,"stats":{"Line":3},"fn_name":null},{"line":78,"address":[86848,87504,88124,88234,87340,87438],"length":1,"stats":{"Line":2},"fn_name":"sum\u003caoc_2021_day_18::snailfish::Snailfish, core::iter::adapters::map::Map\u003ccore::iter::adapters::copied::Copied\u003ccore::slice::iter::Iter\u003c\u0026str\u003e\u003e, fn(\u0026str) -\u003e aoc_2021_day_18::snailfish::Snailfish\u003e\u003e"},{"line":82,"address":[87511,86868],"length":1,"stats":{"Line":2},"fn_name":null},{"line":83,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":85,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":86,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":94,"address":[88368,88304],"length":1,"stats":{"Line":2},"fn_name":"add\u003caoc_2021_day_18::snailfish::Snailfish, \u0026aoc_2021_day_18::snailfish::Snailfish\u003e"},{"line":95,"address":[88318,88382],"length":1,"stats":{"Line":2},"fn_name":null},{"line":98,"address":[88769,88432,91189,91545,91216,93965],"length":1,"stats":{"Line":2},"fn_name":"pair\u003caoc_2021_day_18::snailfish::Snailfish, \u0026aoc_2021_day_18::snailfish::Snailfish\u003e"},{"line":99,"address":[91351,88583,91239,88463],"length":1,"stats":{"Line":4},"fn_name":null},{"line":100,"address":[88599,91367,88668,91444],"length":1,"stats":{"Line":4},"fn_name":null},{"line":101,"address":[88798,91460,91528,91574,88752,88684],"length":1,"stats":{"Line":4},"fn_name":null},{"line":102,"address":[91576,88800],"length":1,"stats":{"Line":2},"fn_name":null},{"line":103,"address":[88840,91616],"length":1,"stats":{"Line":2},"fn_name":null},{"line":104,"address":[90989,93765],"length":1,"stats":{"Line":2},"fn_name":null},{"line":105,"address":[93442,90888,93664,90666,90966,93742],"length":1,"stats":{"Line":6},"fn_name":null},{"line":106,"address":[90789,93565],"length":1,"stats":{"Line":2},"fn_name":null},{"line":107,"address":[90895,93671],"length":1,"stats":{"Line":2},"fn_name":null},{"line":108,"address":[90996,93772],"length":1,"stats":{"Line":2},"fn_name":null},{"line":110,"address":[91666,88890,91753,88977],"length":1,"stats":{"Line":2},"fn_name":null},{"line":111,"address":[88996,91772],"length":1,"stats":{"Line":0},"fn_name":null},{"line":112,"address":[89036,93135,91812,90359],"length":1,"stats":{"Line":0},"fn_name":null},{"line":113,"address":[90352,89060,91836,93128,93050,90274],"length":1,"stats":{"Line":0},"fn_name":null},{"line":114,"address":[90133,92909],"length":1,"stats":{"Line":0},"fn_name":null},{"line":115,"address":[90281,93057,93190,90414],"length":1,"stats":{"Line":0},"fn_name":null},{"line":116,"address":[93197,90421],"length":1,"stats":{"Line":0},"fn_name":null},{"line":117,"address":[93240,90464],"length":1,"stats":{"Line":0},"fn_name":null},{"line":119,"address":[89114,91890],"length":1,"stats":{"Line":1},"fn_name":null},{"line":120,"address":[92536,89760,92312,92626,91906,89536,92222,89850,89130,89446],"length":1,"stats":{"Line":5},"fn_name":null},{"line":122,"address":[89305,92081],"length":1,"stats":{"Line":1},"fn_name":null},{"line":123,"address":[89453,92229],"length":1,"stats":{"Line":1},"fn_name":null},{"line":124,"address":[92403,89627],"length":1,"stats":{"Line":1},"fn_name":null},{"line":125,"address":[89767,92543],"length":1,"stats":{"Line":1},"fn_name":null},{"line":127,"address":[92656,89880],"length":1,"stats":{"Line":1},"fn_name":null},{"line":133,"address":[104880],"length":1,"stats":{"Line":1},"fn_name":"reduce"},{"line":134,"address":[104889],"length":1,"stats":{"Line":1},"fn_name":null},{"line":137,"address":[104894],"length":1,"stats":{"Line":1},"fn_name":null},{"line":138,"address":[104950],"length":1,"stats":{"Line":2},"fn_name":null},{"line":142,"address":[106241,104976,106211],"length":1,"stats":{"Line":1},"fn_name":"reduce_once"},{"line":143,"address":[104991],"length":1,"stats":{"Line":2},"fn_name":null},{"line":144,"address":[105475,105145],"length":1,"stats":{"Line":4},"fn_name":null},{"line":145,"address":[105512],"length":1,"stats":{"Line":2},"fn_name":null},{"line":146,"address":[105736],"length":1,"stats":{"Line":2},"fn_name":null},{"line":147,"address":[105547],"length":1,"stats":{"Line":2},"fn_name":null},{"line":148,"address":[105676,105776],"length":1,"stats":{"Line":4},"fn_name":null},{"line":150,"address":[105704,105741],"length":1,"stats":{"Line":2},"fn_name":null},{"line":152,"address":[105634],"length":1,"stats":{"Line":2},"fn_name":null},{"line":153,"address":[105562],"length":1,"stats":{"Line":2},"fn_name":null},{"line":154,"address":[105639,105602],"length":1,"stats":{"Line":2},"fn_name":null},{"line":159,"address":[106073,105820],"length":1,"stats":{"Line":4},"fn_name":null},{"line":160,"address":[106115],"length":1,"stats":{"Line":2},"fn_name":null},{"line":161,"address":[106142],"length":1,"stats":{"Line":2},"fn_name":null},{"line":162,"address":[106157],"length":1,"stats":{"Line":2},"fn_name":null},{"line":166,"address":[106036],"length":1,"stats":{"Line":2},"fn_name":null},{"line":169,"address":[113113,106256,111601],"length":1,"stats":{"Line":2},"fn_name":"reduce_explode"},{"line":170,"address":[106454,106287,107431,106726,106961,107196],"length":1,"stats":{"Line":12},"fn_name":null},{"line":171,"address":[106608],"length":1,"stats":{"Line":2},"fn_name":null},{"line":172,"address":[106842],"length":1,"stats":{"Line":2},"fn_name":null},{"line":173,"address":[107077],"length":1,"stats":{"Line":2},"fn_name":null},{"line":174,"address":[107312],"length":1,"stats":{"Line":2},"fn_name":null},{"line":175,"address":[107531],"length":1,"stats":{"Line":0},"fn_name":null},{"line":177,"address":[107572],"length":1,"stats":{"Line":2},"fn_name":null},{"line":178,"address":[107785],"length":1,"stats":{"Line":2},"fn_name":null},{"line":179,"address":[107914],"length":1,"stats":{"Line":2},"fn_name":null},{"line":180,"address":[107972],"length":1,"stats":{"Line":2},"fn_name":null},{"line":181,"address":[108012,111709],"length":1,"stats":{"Line":4},"fn_name":null},{"line":183,"address":[112092,112021],"length":1,"stats":{"Line":4},"fn_name":null},{"line":184,"address":[111936,111862,112051],"length":1,"stats":{"Line":4},"fn_name":null},{"line":186,"address":[112136,111900],"length":1,"stats":{"Line":4},"fn_name":null},{"line":187,"address":[112326],"length":1,"stats":{"Line":2},"fn_name":null},{"line":189,"address":[112862,112923],"length":1,"stats":{"Line":4},"fn_name":null},{"line":190,"address":[112880,112578,112669],"length":1,"stats":{"Line":4},"fn_name":null},{"line":192,"address":[112596,113074],"length":1,"stats":{"Line":4},"fn_name":null},{"line":194,"address":[108089],"length":1,"stats":{"Line":0},"fn_name":null},{"line":195,"address":[108113],"length":1,"stats":{"Line":0},"fn_name":null},{"line":196,"address":[108160,108303],"length":1,"stats":{"Line":0},"fn_name":null},{"line":197,"address":[108962],"length":1,"stats":{"Line":0},"fn_name":null},{"line":198,"address":[109229],"length":1,"stats":{"Line":0},"fn_name":null},{"line":199,"address":[109484],"length":1,"stats":{"Line":0},"fn_name":null},{"line":201,"address":[108711],"length":1,"stats":{"Line":0},"fn_name":null},{"line":203,"address":[108888],"length":1,"stats":{"Line":0},"fn_name":null},{"line":204,"address":[109820],"length":1,"stats":{"Line":0},"fn_name":null},{"line":205,"address":[110530,110681,110111],"length":1,"stats":{"Line":0},"fn_name":null},{"line":206,"address":[110722],"length":1,"stats":{"Line":0},"fn_name":null},{"line":207,"address":[111061],"length":1,"stats":{"Line":0},"fn_name":null},{"line":208,"address":[111316],"length":1,"stats":{"Line":0},"fn_name":null},{"line":210,"address":[110223],"length":1,"stats":{"Line":0},"fn_name":null},{"line":212,"address":[111552,110448],"length":1,"stats":{"Line":0},"fn_name":null},{"line":217,"address":[114738,115530,113152],"length":1,"stats":{"Line":2},"fn_name":"reduce_split"},{"line":218,"address":[113350,113183],"length":1,"stats":{"Line":4},"fn_name":null},{"line":219,"address":[113411],"length":1,"stats":{"Line":2},"fn_name":null},{"line":220,"address":[113469],"length":1,"stats":{"Line":2},"fn_name":null},{"line":221,"address":[114872,113525,114816,115173],"length":1,"stats":{"Line":6},"fn_name":null},{"line":222,"address":[114832],"length":1,"stats":{"Line":2},"fn_name":null},{"line":223,"address":[114844,114954,115024],"length":1,"stats":{"Line":4},"fn_name":null},{"line":224,"address":[114995],"length":1,"stats":{"Line":2},"fn_name":null},{"line":225,"address":[115062,115380,115007],"length":1,"stats":{"Line":4},"fn_name":null},{"line":226,"address":[115161],"length":1,"stats":{"Line":2},"fn_name":null},{"line":228,"address":[115428],"length":1,"stats":{"Line":2},"fn_name":null},{"line":230,"address":[113553],"length":1,"stats":{"Line":0},"fn_name":null},{"line":231,"address":[113577],"length":1,"stats":{"Line":0},"fn_name":null},{"line":232,"address":[113624,113767],"length":1,"stats":{"Line":0},"fn_name":null},{"line":233,"address":[113918],"length":1,"stats":{"Line":0},"fn_name":null},{"line":234,"address":[113969],"length":1,"stats":{"Line":0},"fn_name":null},{"line":235,"address":[114095],"length":1,"stats":{"Line":0},"fn_name":null},{"line":236,"address":[114146],"length":1,"stats":{"Line":0},"fn_name":null},{"line":237,"address":[114322],"length":1,"stats":{"Line":0},"fn_name":null},{"line":238,"address":[114446],"length":1,"stats":{"Line":0},"fn_name":null},{"line":239,"address":[114624],"length":1,"stats":{"Line":0},"fn_name":null},{"line":244,"address":[115568],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":246,"address":[115582],"length":1,"stats":{"Line":1},"fn_name":null},{"line":253,"address":[115680],"length":1,"stats":{"Line":1},"fn_name":"from"},{"line":254,"address":[115689],"length":1,"stats":{"Line":1},"fn_name":null},{"line":259,"address":[115728],"length":1,"stats":{"Line":0},"fn_name":"fmt"},{"line":260,"address":[115805,115918],"length":1,"stats":{"Line":0},"fn_name":null},{"line":261,"address":[115944],"length":1,"stats":{"Line":0},"fn_name":null},{"line":262,"address":[116514,115980],"length":1,"stats":{"Line":0},"fn_name":null},{"line":263,"address":[116417,116022],"length":1,"stats":{"Line":0},"fn_name":null},{"line":264,"address":[116323,116064],"length":1,"stats":{"Line":0},"fn_name":null},{"line":265,"address":[116106],"length":1,"stats":{"Line":0},"fn_name":null},{"line":268,"address":[115908],"length":1,"stats":{"Line":0},"fn_name":null},{"line":273,"address":[116608],"length":1,"stats":{"Line":0},"fn_name":"fmt"},{"line":274,"address":[116770,116630],"length":1,"stats":{"Line":0},"fn_name":null},{"line":275,"address":[116763],"length":1,"stats":{"Line":0},"fn_name":null},{"line":285,"address":[94000,94005],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":286,"address":[139211,139311,139538],"length":1,"stats":{"Line":2},"fn_name":null},{"line":287,"address":[139127],"length":1,"stats":{"Line":1},"fn_name":null},{"line":288,"address":[139176,139251],"length":1,"stats":{"Line":2},"fn_name":null},{"line":290,"address":[139652,139749],"length":1,"stats":{"Line":1},"fn_name":null},{"line":291,"address":[139568],"length":1,"stats":{"Line":1},"fn_name":null},{"line":292,"address":[139689,139617],"length":1,"stats":{"Line":2},"fn_name":null},{"line":294,"address":[140163,140063],"length":1,"stats":{"Line":1},"fn_name":null},{"line":295,"address":[139979],"length":1,"stats":{"Line":1},"fn_name":null},{"line":296,"address":[140028,140103],"length":1,"stats":{"Line":2},"fn_name":null},{"line":298,"address":[140547,140462],"length":1,"stats":{"Line":1},"fn_name":null},{"line":299,"address":[140387],"length":1,"stats":{"Line":1},"fn_name":null},{"line":300,"address":[140430,140499],"length":1,"stats":{"Line":2},"fn_name":null},{"line":302,"address":[140834,140919],"length":1,"stats":{"Line":1},"fn_name":null},{"line":303,"address":[140759],"length":1,"stats":{"Line":1},"fn_name":null},{"line":304,"address":[140802,140871],"length":1,"stats":{"Line":2},"fn_name":null},{"line":309,"address":[94032,94037],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":310,"address":[141564,141343,141243],"length":1,"stats":{"Line":2},"fn_name":null},{"line":311,"address":[141159],"length":1,"stats":{"Line":1},"fn_name":null},{"line":312,"address":[141283,141208],"length":1,"stats":{"Line":2},"fn_name":null},{"line":314,"address":[141669,141751],"length":1,"stats":{"Line":1},"fn_name":null},{"line":315,"address":[141594],"length":1,"stats":{"Line":1},"fn_name":null},{"line":316,"address":[141703,141637],"length":1,"stats":{"Line":2},"fn_name":null},{"line":318,"address":[142123,142038],"length":1,"stats":{"Line":1},"fn_name":null},{"line":319,"address":[141963],"length":1,"stats":{"Line":1},"fn_name":null},{"line":320,"address":[142006,142075],"length":1,"stats":{"Line":2},"fn_name":null},{"line":325,"address":[94069,94064],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":326,"address":[142675,142583,142359,142418],"length":1,"stats":{"Line":2},"fn_name":null},{"line":327,"address":[142367],"length":1,"stats":{"Line":1},"fn_name":null},{"line":328,"address":[142535],"length":1,"stats":{"Line":1},"fn_name":null},{"line":329,"address":[142389,142455],"length":1,"stats":{"Line":2},"fn_name":null},{"line":330,"address":[142468],"length":1,"stats":{"Line":1},"fn_name":null},{"line":336,"address":[94101,94096],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":337,"address":[143117,142881,143344],"length":1,"stats":{"Line":2},"fn_name":null},{"line":338,"address":[142823],"length":1,"stats":{"Line":1},"fn_name":null},{"line":339,"address":[142921,142858],"length":1,"stats":{"Line":2},"fn_name":null},{"line":341,"address":[143429,143672],"length":1,"stats":{"Line":1},"fn_name":null},{"line":342,"address":[143374],"length":1,"stats":{"Line":1},"fn_name":null},{"line":343,"address":[143409,143463],"length":1,"stats":{"Line":2},"fn_name":null},{"line":345,"address":[143939,144204],"length":1,"stats":{"Line":1},"fn_name":null},{"line":346,"address":[143884],"length":1,"stats":{"Line":1},"fn_name":null},{"line":347,"address":[143919,143976],"length":1,"stats":{"Line":2},"fn_name":null},{"line":349,"address":[144824,144471],"length":1,"stats":{"Line":1},"fn_name":null},{"line":350,"address":[144416],"length":1,"stats":{"Line":1},"fn_name":null},{"line":351,"address":[144508,144451],"length":1,"stats":{"Line":2},"fn_name":null},{"line":367,"address":[94128,94133],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":368,"address":[145063],"length":1,"stats":{"Line":1},"fn_name":null},{"line":369,"address":[145364],"length":1,"stats":{"Line":1},"fn_name":null},{"line":370,"address":[145619],"length":1,"stats":{"Line":1},"fn_name":null},{"line":371,"address":[145877],"length":1,"stats":{"Line":1},"fn_name":null},{"line":372,"address":[146135],"length":1,"stats":{"Line":1},"fn_name":null},{"line":373,"address":[146393],"length":1,"stats":{"Line":1},"fn_name":null},{"line":387,"address":[98636,97728,98422],"length":1,"stats":{"Line":1},"fn_name":"parse_tokens"},{"line":388,"address":[97761],"length":1,"stats":{"Line":1},"fn_name":null},{"line":389,"address":[97825,97771],"length":1,"stats":{"Line":4},"fn_name":null},{"line":390,"address":[97871],"length":1,"stats":{"Line":2},"fn_name":null},{"line":391,"address":[97940,98573],"length":1,"stats":{"Line":4},"fn_name":null},{"line":392,"address":[97959,98506],"length":1,"stats":{"Line":4},"fn_name":null},{"line":393,"address":[97978,98439],"length":1,"stats":{"Line":4},"fn_name":null},{"line":394,"address":[98030,97924],"length":1,"stats":{"Line":4},"fn_name":null},{"line":395,"address":[98043],"length":1,"stats":{"Line":2},"fn_name":null},{"line":397,"address":[98118,98057],"length":1,"stats":{"Line":4},"fn_name":null},{"line":398,"address":[98168,98219],"length":1,"stats":{"Line":4},"fn_name":null},{"line":399,"address":[98230],"length":1,"stats":{"Line":2},"fn_name":null},{"line":405,"address":[98301,98198],"length":1,"stats":{"Line":4},"fn_name":null},{"line":407,"address":[97992],"length":1,"stats":{"Line":0},"fn_name":null},{"line":422,"address":[98656,98665],"length":1,"stats":{"Line":4},"fn_name":"is_open"},{"line":423,"address":[98704,98713],"length":1,"stats":{"Line":4},"fn_name":"is_close"},{"line":424,"address":[98752,98761],"length":1,"stats":{"Line":4},"fn_name":"is_comma"},{"line":425,"address":[98800,98809],"length":1,"stats":{"Line":4},"fn_name":"is_value"},{"line":426,"address":[98848],"length":1,"stats":{"Line":2},"fn_name":"value"},{"line":427,"address":[98857],"length":1,"stats":{"Line":2},"fn_name":null},{"line":430,"address":[98887],"length":1,"stats":{"Line":0},"fn_name":null},{"line":456,"address":[35488,36051,36106],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":457,"address":[35495],"length":1,"stats":{"Line":1},"fn_name":null},{"line":458,"address":[35518,35592,35658],"length":1,"stats":{"Line":3},"fn_name":null},{"line":459,"address":[36062],"length":1,"stats":{"Line":1},"fn_name":null},{"line":463,"address":[36707,36144,36762],"length":1,"stats":{"Line":3},"fn_name":"part_two"},{"line":464,"address":[36151],"length":1,"stats":{"Line":1},"fn_name":null},{"line":465,"address":[36174,36248,36314],"length":1,"stats":{"Line":3},"fn_name":null},{"line":466,"address":[36718],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":194,"coverable":240},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-19","src","lib.rs"],"content":"//! Advent of Code 2021: Day 19: Beacon Scanner\n//!\n//! [https://adventofcode.com/2021/day/19](https://adventofcode.com/2021/day/19)\n//!\n//! This algorithm uses bloom filters to allow it to scale better. For each scanner we generate a\n//! set of bits which have bits set according to the arrangement of the beacons they contain. If\n//! there are two beacons with a specific offset between them, then a number of bits are guaranteed\n//! to be set. Once we have this information for every scanner, we can prioritise the slower\n//! matching process to pairs of scanners which share a large number of bits.\n//!\n//! Generating these hashes for each scanner is slow, so there is some further optimisation going\n//! on as well. Firstly, we have to rotate scanners so that they will match. Instead of rotating\n//! each scanner in every direction, we rotate scanners which we have placed in one set of\n//! directions and the ones we haven't placed in another. We choose a set of directions in each\n//! case to guarntee a match. Specifically we rotate placed scanners around the Z axis only, giving\n//! four hashes for each scanner. We rotate unplaced scanners to move its Z axis into one of the\n//! six other positions. since almost all scanners will first be unplaced and later placed, this\n//! means we do a total of ten hashes for each scanner, instead of the twenty four we would have to\n//! with a more naïve algorithm.\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\nuse aoc_bithash::*;\nuse aoc_pos as pos;\n\npub mod rotation;\n\npuzzle_info! {\n\tname = \"Beacon Scanner\";\n\tyear = 2021;\n\tday = 19;\n\tpart_one = |lines| logic::part_one (lines);\n\tpart_two = |lines| logic::part_two (lines);\n}\n\nmod logic {\n\n\tuse super::*;\n\tuse model::Coord;\n\tuse model::Input;\n\tuse model::Pos;\n\tuse nums::IntConv;\n\tuse rotation::Rotation;\n\n\tconst SCANNER_HASH_U64S: usize = 64; // 4096 bits per hash\n\tconst SCANNER_HASH_BITS: usize = 3;  // 2 bits per entry (pair of scanners)\n\n\ttype ScannerHash = BitHash \u003cSCANNER_HASH_U64S\u003e;\n\ttype ScannerHasher = BitHasher \u003cRandomHasher, SCANNER_HASH_U64S, SCANNER_HASH_BITS\u003e;\n\n\tpub fn part_one (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003ci64\u003e {\n\t\tlet input = Input::parse (lines) ?;\n\t\tlet (_, beacons) = calc_result (\u0026 input) ?;\n\t\tOk (beacons.len ().as_i64 ())\n\t}\n\n\tpub fn part_two (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003ci64\u003e {\n\t\tlet input = Input::parse (lines) ?;\n\t\tlet (scanners, _) = calc_result (\u0026 input) ?;\n\t\tlet scanners: Vec \u003cPos\u003e = scanners.into_iter ().collect ();\n\t\tOk (\n\t\t\tscanners.iter ().combinations (2).map (|scanners| {\n\t\t\t\tlet (pos_0, pos_1) = (scanners [0], scanners [1]);\n\t\t\t\tCoord::abs_diff (pos_0.x, pos_1.x)\n\t\t\t\t\t+ Coord::abs_diff (pos_0.y, pos_1.y)\n\t\t\t\t\t+ Coord::abs_diff (pos_0.z, pos_1.z)\n\t\t\t}).max ().unwrap ().as_i64 ()\n\t\t)\n\t}\n\n\tfn calc_result (input: \u0026 Input) -\u003e GenResult \u003c(HashSet \u003cPos\u003e, HashSet \u003cPos\u003e)\u003e {\n\t\tlet mut arranger = ScannerArranger::new ();\n\t\tif ! arranger.init (input) { Err (\"Failed to arrange scanners\") ? }\n\t\tif ! arranger.run () { Err (\"Failed to arrange scanners\") ? }\n\t\tOk ((arranger.scanner_positions, arranger.beacon_positions))\n\t}\n\n\t#[ derive (Default) ]\n\tstruct ScannerArranger {\n\t\thash_builder: RandomHasher,\n\t\toriginal_scanners: Vec \u003cRc \u003cOriginalScanner\u003e\u003e,\n\t\tunplaced_scanners: Vec \u003cRc \u003cUnplacedScanner\u003e\u003e,\n\t\tscanner_matches: BinaryHeap \u003cScannerMatch\u003e,\n\t\tscanner_positions: HashSet \u003cPos\u003e,\n\t\tbeacon_positions: HashSet \u003cPos\u003e,\n\t}\n\n\timpl ScannerArranger {\n\n\t\tfn new () -\u003e Self { default () }\n\n\t\t#[ must_use ]\n\t\tfn init (\u0026 mut self, input: \u0026 Input) -\u003e bool {\n\t\t\tself.original_scanners.extend (\n\t\t\t\tinput.scanners.iter ().map (|scanner|\n\t\t\t\t\tRc::new (OriginalScanner {\n\t\t\t\t\t\tbeacons: scanner.beacons.iter ().copied ().sorted ().collect (),\n\t\t\t\t\t\tmatched: Cell::new (false),\n\t\t\t\t\t})));\n\t\t\tif self.original_scanners.is_empty () { return false }\n\t\t\tself.unplaced_scanners = self.original_scanners.iter ()\n\t\t\t\t.map (|scanner|\n\t\t\t\t\tRc::new (UnplacedScanner {\n\t\t\t\t\t\toriginal: Rc::clone (scanner),\n\t\t\t\t\t\thashes: self.calc_scanner_hashes (\u0026 scanner.beacons, UNPLACED_ROTATIONS),\n\t\t\t\t\t}))\n\t\t\t\t.collect::\u003cVec \u003c_\u003e\u003e ();\n\t\t\ttrue\n\t\t}\n\n\t\tfn run (\u0026 mut self) -\u003e bool {\n\t\t\tself.place_scanner (\n\t\t\t\t\u0026 Rc::clone (\u0026 self.unplaced_scanners [0]),\n\t\t\t\tRotation::None,\n\t\t\t\tPos::ZERO);\n\t\t\tlet mut scanner_matches_buffer = Vec::new ();\n\t\t\t'OUTER: loop {\n\t\t\t\tif self.unplaced_scanners.is_empty () { break }\n\t\t\t\tself.scanner_matches.extend (scanner_matches_buffer.drain ( .. ));\n\t\t\t\twhile let Some (scanner_match) = self.scanner_matches.pop () {\n\t\t\t\t\tif self.unplaced_scanners.is_empty () { break 'OUTER }\n\t\t\t\t\tif scanner_match.unplaced.original.matched.get () { continue }\n\t\t\t\t\tif self.process_match (\u0026 scanner_match) { continue 'OUTER }\n\t\t\t\t\tscanner_matches_buffer.push (scanner_match);\n\t\t\t\t}\n\t\t\t\tself.unplaced_scanners.retain (|scanner| ! scanner.original.matched.get ());\n\t\t\t}\n\t\t\ttrue\n\t\t}\n\n\t\tfn process_match (\u0026 mut self, scanner_match: \u0026 ScannerMatch) -\u003e bool {\n\t\t\tlet placed = Rc::clone (\u0026 scanner_match.placed);\n\t\t\tlet unplaced = Rc::clone (\u0026 scanner_match.unplaced);\n\t\t\tlet rotate = Rotation::combine (\n\t\t\t\tscanner_match.placed_rotate.rev (),\n\t\t\t\tscanner_match.unplaced_rotate);\n\t\t\tlet offset = match Self::find_offset (\u0026 placed, \u0026 unplaced, rotate) {\n\t\t\t\tSome (value) =\u003e value,\n\t\t\t\tNone =\u003e { return false },\n\t\t\t};\n\t\t\tself.place_scanner (\u0026 unplaced, rotate, offset);\n\t\t\ttrue\n\t\t}\n\n\t\tfn find_offset (\n\t\t\tplaced: \u0026 PlacedScanner,\n\t\t\tunplaced: \u0026 UnplacedScanner,\n\t\t\trotate: Rotation,\n\t\t) -\u003e Option \u003cPos\u003e {\n\t\t\tlet offsets_grouped =\n\t\t\t\tunplaced.original.beacons.iter ().copied ()\n\t\t\t\t\t.map (|beacon| rotate.apply (beacon))\n\t\t\t\t\t.cartesian_product (placed.beacons.iter ().copied ())\n\t\t\t\t\t.map (|(unplaced_beacon, placed_beacon)| placed_beacon - unplaced_beacon)\n\t\t\t\t\t.sorted ()\n\t\t\t\t\t.group_by (|\u0026 offset| offset);\n\t\t\toffsets_grouped.into_iter ()\n\t\t\t\t.map (|(offset, iter)| (offset, iter.count ()))\n\t\t\t\t.filter (|\u0026 (_, count)| count \u003e= 12)\n\t\t\t\t.map (|(offset, _)| offset)\n\t\t\t\t.next ()\n\t\t}\n\n\t\tfn place_scanner (\u0026 mut self, scanner: \u0026 Rc \u003cUnplacedScanner\u003e, rotate: Rotation, offset: Pos) {\n\t\t\tlet beacons = scanner.original.beacons.iter ().copied ()\n\t\t\t\t.map (|beacon| rotate.apply (beacon) + offset)\n\t\t\t\t.sorted ()\n\t\t\t\t.collect::\u003cVec \u003c_\u003e\u003e ();\n\t\t\tlet hashes = self.calc_scanner_hashes (\u0026 beacons, PLACED_ROTATIONS);\n\t\t\tlet scanner = Rc::new (PlacedScanner {\n\t\t\t\toriginal: Rc::clone (\u0026 scanner.original),\n\t\t\t\tbeacons,\n\t\t\t\thashes,\n\t\t\t});\n\t\t\tscanner.original.matched.set (true);\n\t\t\tself.scanner_positions.insert (offset);\n\t\t\tself.beacon_positions.extend (scanner.beacons.iter ().copied ());\n\t\t\tself.add_scanner_matches (\u0026 scanner);\n\t\t}\n\n\t\tfn add_scanner_matches (\u0026 mut self, placed: \u0026 Rc \u003cPlacedScanner\u003e) {\n\t\t\tfor unplaced in self.unplaced_scanners.iter () {\n\t\t\t\tif unplaced.original.matched.get () { continue }\n\t\t\t\tfor (unplaced_rotate_idx, unplaced_rotate)\n\t\t\t\t\t\tin UNPLACED_ROTATIONS.iter ().copied ().enumerate () {\n\t\t\t\t\tlet unplaced_hash = unplaced.hashes [unplaced_rotate_idx];\n\t\t\t\t\tfor (placed_rotate_idx, placed_rotate)\n\t\t\t\t\t\t\tin PLACED_ROTATIONS.iter ().copied ().enumerate () {\n\t\t\t\t\t\tlet placed_hash = placed.hashes [placed_rotate_idx];\n\t\t\t\t\t\tself.scanner_matches.push (ScannerMatch {\n\t\t\t\t\t\t\tplaced: Rc::clone (placed),\n\t\t\t\t\t\t\tunplaced: Rc::clone (unplaced),\n\t\t\t\t\t\t\tpriority: (placed_hash \u0026 unplaced_hash).bits ().as_u32 (),\n\t\t\t\t\t\t\tplaced_rotate,\n\t\t\t\t\t\t\tunplaced_rotate,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfn calc_scanner_hashes \u003cconst LEN: usize\u003e (\n\t\t\t\u0026 self,\n\t\t\tbeacons: \u0026 [Pos],\n\t\t\trotates: \u0026 [Rotation; LEN],\n\t\t) -\u003e [ScannerHash; LEN] {\n\t\t\tlet mut hashers =\n\t\t\t\t[0_i32; LEN].map (|_| ScannerHasher::new_with_hasher (self.hash_builder.clone ()));\n\t\t\tfor offset in beacons.iter ().copied ().enumerate ()\n\t\t\t\t.flat_map (|(beacon_0_idx, beacon_0)| beacons.iter ().copied ()\n\t\t\t\t\t.skip (beacon_0_idx + 1)\n\t\t\t\t\t.map (move |beacon_1| beacon_1 - beacon_0)) {\n\t\t\t\tfor idx in 0 .. rotates.len () {\n\t\t\t\t\tlet offset = rotates [idx].apply (offset);\n\t\t\t\t\thashers [idx].update (cmp::max (offset, - offset));\n\t\t\t\t}\n\t\t\t}\n\t\t\thashers.map (|hasher| hasher.finish ())\n\t\t}\n\n\t}\n\n\tstruct OriginalScanner {\n\t\tbeacons: Vec \u003cPos\u003e,\n\t\tmatched: Cell \u003cbool\u003e,\n\t}\n\n\tstruct UnplacedScanner {\n\t\toriginal: Rc \u003cOriginalScanner\u003e,\n\t\thashes: [ScannerHash; 6],\n\t}\n\n\tstruct PlacedScanner {\n\t\toriginal: Rc \u003cOriginalScanner\u003e,\n\t\thashes: [ScannerHash; 4],\n\t\tbeacons: Vec \u003cPos\u003e,\n\t}\n\n\t#[ derive (Clone) ]\n\tstruct ScannerMatch {\n\t\tplaced: Rc \u003cPlacedScanner\u003e,\n\t\tunplaced: Rc \u003cUnplacedScanner\u003e,\n\t\tpriority: u32,\n\t\tplaced_rotate: Rotation,\n\t\tunplaced_rotate: Rotation,\n\t}\n\n\timpl PartialEq for ScannerMatch {\n\t\tfn eq (\u0026 self, other: \u0026 Self) -\u003e bool {\n\t\t\tself.priority == other.priority\n\t\t}\n\t}\n\n\timpl Eq for ScannerMatch {}\n\n\timpl PartialOrd for ScannerMatch {\n\t\tfn partial_cmp (\u0026 self, other: \u0026 Self) -\u003e Option \u003ccmp::Ordering\u003e {\n\t\t\tu32::partial_cmp (\u0026 self.priority, \u0026 other.priority)\n\t\t}\n\t}\n\n\timpl Ord for ScannerMatch {\n\t\tfn cmp (\u0026 self, other: \u0026 Self) -\u003e cmp::Ordering {\n\t\t\tu32::cmp (\u0026 self.priority, \u0026 other.priority)\n\t\t}\n\t}\n\n\tconst PLACED_ROTATIONS: \u0026 [Rotation; 4] = \u0026 [\n\t\tRotation::None, Rotation::Clockwise,\n\t\tRotation::UpsideDown, Rotation::CounterClockwise,\n\t];\n\n\tconst UNPLACED_ROTATIONS: \u0026 [Rotation; 6] = \u0026 [\n\t\tRotation::None, Rotation::Up, Rotation::Right,\n\t\tRotation::Around, Rotation::Down, Rotation::Left,\n\t];\n\n}\n\nmod model {\n\n\tuse super::*;\n\n\tpub type Coord = i16;\n\tpub type Pos = pos::PosXYZ \u003cCoord\u003e;\n\n\tpub struct Input {\n\t\tpub scanners: Vec \u003cInputScanner\u003e,\n\t}\n\n\t#[ derive (Debug) ]\n\tpub struct InputScanner {\n\t\tpub name: Rc \u003cstr\u003e,\n\t\tpub beacons: Vec \u003cPos\u003e,\n\t}\n\n\timpl Input {\n\t\t#[ allow (clippy::string_slice) ]\n\t\tpub fn parse (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tuse parser::*;\n\t\t\tlet mut scanners = Vec::new ();\n\t\t\tlet mut lines_iter = lines.iter ().enumerate ();\n\t\t\tlet err = |line_idx, line| format! (\"Invalid input: line {}: {}\", line_idx + 1, line);\n\t\t\twhile let Some ((line_idx, line)) = lines_iter.next () {\n\t\t\t\tif ! line.starts_with (\"--- \") { Err (err (line_idx, line)) ? }\n\t\t\t\tif ! line.ends_with (\" ---\") { Err (err (line_idx, line)) ? }\n\t\t\t\tlet name = Rc::from (\u0026 line [4 .. line.len () - 4]);\n\t\t\t\tlet mut beacons = Vec::new ();\n\t\t\t\tfor (line_idx, line) in lines_iter.by_ref () {\n\t\t\t\t\tif line.is_empty () { break }\n\t\t\t\t\tParser::wrap (line, |parser| {\n\t\t\t\t\t\tbeacons.push (Pos {\n\t\t\t\t\t\t\tx: parser.int () ?,\n\t\t\t\t\t\t\ty: parser.expect (\",\") ?.int () ?,\n\t\t\t\t\t\t\tz: parser.expect (\",\") ?.int () ?,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tparser.end () ?;\n\t\t\t\t\t\tOk (())\n\t\t\t\t\t}).map_parse_err (|_| err (line_idx, line)) ?;\n\t\t\t\t}\n\t\t\t\tscanners.push (InputScanner { name, beacons });\n\t\t\t}\n\t\t\tOk (Self { scanners })\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse aoc_common::*;\n\tuse crate::logic;\n\n\tconst EXAMPLE: \u0026 [\u0026 str] = \u0026 [\n\t\t\"--- scanner 0 ---\",\n\t\t\"404,-588,-901\", \"528,-643,409\", \"-838,591,734\", \"390,-675,-793\", \"-537,-823,-458\",\n\t\t\"-485,-357,347\", \"-345,-311,381\", \"-661,-816,-575\", \"-876,649,763\", \"-618,-824,-621\",\n\t\t\"553,345,-567\", \"474,580,667\", \"-447,-329,318\", \"-584,868,-557\", \"544,-627,-890\",\n\t\t\"564,392,-477\", \"455,729,728\", \"-892,524,684\", \"-689,845,-530\", \"423,-701,434\",\n\t\t\"7,-33,-71\", \"630,319,-379\", \"443,580,662\", \"-789,900,-551\", \"459,-707,401\",\n\t\t\"\",\n\t\t\"--- scanner 1 ---\",\n\t\t\"686,422,578\", \"605,423,415\", \"515,917,-361\", \"-336,658,858\", \"95,138,22\", \"-476,619,847\",\n\t\t\"-340,-569,-846\", \"567,-361,727\", \"-460,603,-452\", \"669,-402,600\", \"729,430,532\",\n\t\t\"-500,-761,534\", \"-322,571,750\", \"-466,-666,-811\", \"-429,-592,574\", \"-355,545,-477\",\n\t\t\"703,-491,-529\", \"-328,-685,520\", \"413,935,-424\", \"-391,539,-444\", \"586,-435,557\",\n\t\t\"-364,-763,-893\", \"807,-499,-711\", \"755,-354,-619\", \"553,889,-390\",\n\t\t\"\",\n\t\t\"--- scanner 2 ---\",\n\t\t\"649,640,665\", \"682,-795,504\", \"-784,533,-524\", \"-644,584,-595\", \"-588,-843,648\",\n\t\t\"-30,6,44\", \"-674,560,763\", \"500,723,-460\", \"609,671,-379\", \"-555,-800,653\",\n\t\t\"-675,-892,-343\", \"697,-426,-610\", \"578,704,681\", \"493,664,-388\", \"-671,-858,530\",\n\t\t\"-667,343,800\", \"571,-461,-707\", \"-138,-166,112\", \"-889,563,-600\", \"646,-828,498\",\n\t\t\"640,759,510\", \"-630,509,768\", \"-681,-892,-333\", \"673,-379,-804\", \"-742,-814,-386\",\n\t\t\"577,-820,562\",\n\t\t\"\",\n\t\t\"--- scanner 3 ---\",\n\t\t\"-589,542,597\", \"605,-692,669\", \"-500,565,-823\", \"-660,373,557\", \"-458,-679,-417\",\n\t\t\"-488,449,543\", \"-626,468,-788\", \"338,-750,-386\", \"528,-832,-391\", \"562,-778,733\",\n\t\t\"-938,-730,414\", \"543,643,-506\", \"-524,371,-870\", \"407,773,750\", \"-104,29,83\",\n\t\t\"378,-903,-323\", \"-778,-728,485\", \"426,699,580\", \"-438,-605,-362\", \"-469,-447,-387\",\n\t\t\"509,732,623\", \"647,635,-688\", \"-868,-804,481\", \"614,-800,639\", \"595,780,-596\",\n\t\t\"\",\n\t\t\"--- scanner 4 ---\",\n\t\t\"727,592,562\", \"-293,-554,779\", \"441,611,-461\", \"-714,465,-776\", \"-743,427,-804\",\n\t\t\"-660,-479,-426\", \"832,-632,460\", \"927,-485,-438\", \"408,393,-506\", \"466,436,-512\",\n\t\t\"110,16,151\", \"-258,-428,682\", \"-393,719,612\", \"-211,-452,876\", \"808,-476,-593\",\n\t\t\"-575,615,604\", \"-485,667,467\", \"-680,325,-822\", \"-627,-443,-432\", \"872,-547,-609\",\n\t\t\"833,512,582\", \"807,604,487\", \"839,-516,451\", \"891,-625,532\", \"-652,-548,-490\",\n\t\t\"30,-46,-14\",\n\t];\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (79, logic::part_one (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (3621, logic::part_two (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":29,"address":[235353,234889],"length":1,"stats":{"Line":0},"fn_name":null},{"line":33,"address":[234974],"length":1,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[235438],"length":1,"stats":{"Line":0},"fn_name":null},{"line":52,"address":[153423,153397,152624],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":53,"address":[152775,152657],"length":1,"stats":{"Line":1},"fn_name":null},{"line":54,"address":[152881,152763,153258],"length":1,"stats":{"Line":2},"fn_name":null},{"line":55,"address":[153347,153290],"length":1,"stats":{"Line":2},"fn_name":null},{"line":58,"address":[154579,153440,154527],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":59,"address":[153605,153473],"length":1,"stats":{"Line":1},"fn_name":null},{"line":60,"address":[153593,153711,154096],"length":1,"stats":{"Line":2},"fn_name":null},{"line":61,"address":[154256,154120],"length":1,"stats":{"Line":2},"fn_name":null},{"line":63,"address":[100096,100480],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":64,"address":[100126,100190],"length":1,"stats":{"Line":2},"fn_name":null},{"line":65,"address":[100278,100450,100381,100336],"length":1,"stats":{"Line":2},"fn_name":null},{"line":66,"address":[100306],"length":1,"stats":{"Line":1},"fn_name":null},{"line":67,"address":[100361],"length":1,"stats":{"Line":1},"fn_name":null},{"line":68,"address":[100154,100443],"length":1,"stats":{"Line":1},"fn_name":null},{"line":72,"address":[154608,155390],"length":1,"stats":{"Line":1},"fn_name":"calc_result"},{"line":73,"address":[154638],"length":1,"stats":{"Line":1},"fn_name":null},{"line":74,"address":[154658,154710,154735],"length":1,"stats":{"Line":3},"fn_name":null},{"line":75,"address":[154721,154918,155219],"length":1,"stats":{"Line":4},"fn_name":null},{"line":76,"address":[154933],"length":1,"stats":{"Line":2},"fn_name":null},{"line":91,"address":[155544,155536],"length":1,"stats":{"Line":2},"fn_name":"new"},{"line":94,"address":[155914,155568],"length":1,"stats":{"Line":1},"fn_name":"init"},{"line":95,"address":[155609,155698],"length":1,"stats":{"Line":2},"fn_name":null},{"line":96,"address":[100528,100779],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":97,"address":[100725],"length":1,"stats":{"Line":1},"fn_name":null},{"line":98,"address":[100564],"length":1,"stats":{"Line":1},"fn_name":null},{"line":99,"address":[100676],"length":1,"stats":{"Line":1},"fn_name":null},{"line":101,"address":[155708,155757],"length":1,"stats":{"Line":1},"fn_name":null},{"line":102,"address":[155789,155736,155827,155956],"length":1,"stats":{"Line":4},"fn_name":null},{"line":103,"address":[100832,101117],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":104,"address":[101060],"length":1,"stats":{"Line":1},"fn_name":null},{"line":105,"address":[100884],"length":1,"stats":{"Line":1},"fn_name":null},{"line":106,"address":[101006,100907],"length":1,"stats":{"Line":2},"fn_name":null},{"line":109,"address":[155992],"length":1,"stats":{"Line":1},"fn_name":null},{"line":112,"address":[156016,156202],"length":1,"stats":{"Line":2},"fn_name":"run"},{"line":113,"address":[156036,156094],"length":1,"stats":{"Line":4},"fn_name":null},{"line":114,"address":[156044],"length":1,"stats":{"Line":2},"fn_name":null},{"line":115,"address":[156089],"length":1,"stats":{"Line":2},"fn_name":null},{"line":116,"address":[156161],"length":1,"stats":{"Line":0},"fn_name":null},{"line":117,"address":[156228],"length":1,"stats":{"Line":2},"fn_name":null},{"line":119,"address":[156243,156296],"length":1,"stats":{"Line":4},"fn_name":null},{"line":120,"address":[156307,156358],"length":1,"stats":{"Line":4},"fn_name":null},{"line":121,"address":[156489,156372,156643,156938],"length":1,"stats":{"Line":4},"fn_name":null},{"line":122,"address":[156559,156466],"length":1,"stats":{"Line":4},"fn_name":null},{"line":123,"address":[156565,156703,156755],"length":1,"stats":{"Line":6},"fn_name":null},{"line":124,"address":[156793,156836],"length":1,"stats":{"Line":4},"fn_name":null},{"line":125,"address":[156842],"length":1,"stats":{"Line":0},"fn_name":null},{"line":127,"address":[101168,101219,101259],"length":1,"stats":{"Line":8},"fn_name":"{closure#0}"},{"line":132,"address":[156976,157510,157560],"length":1,"stats":{"Line":2},"fn_name":"process_match"},{"line":133,"address":[157019],"length":1,"stats":{"Line":2},"fn_name":null},{"line":134,"address":[157034,157097],"length":1,"stats":{"Line":4},"fn_name":null},{"line":136,"address":[157102],"length":1,"stats":{"Line":2},"fn_name":null},{"line":138,"address":[157324],"length":1,"stats":{"Line":2},"fn_name":null},{"line":139,"address":[157408],"length":1,"stats":{"Line":2},"fn_name":null},{"line":140,"address":[157379],"length":1,"stats":{"Line":0},"fn_name":null},{"line":142,"address":[157444],"length":1,"stats":{"Line":2},"fn_name":null},{"line":143,"address":[157493],"length":1,"stats":{"Line":2},"fn_name":null},{"line":146,"address":[157584,158160],"length":1,"stats":{"Line":2},"fn_name":"find_offset"},{"line":151,"address":[157779,157682,157624,157890],"length":1,"stats":{"Line":8},"fn_name":null},{"line":153,"address":[101341,101296],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":154,"address":[157808],"length":1,"stats":{"Line":2},"fn_name":null},{"line":155,"address":[101456,101465],"length":1,"stats":{"Line":4},"fn_name":"{closure#1}"},{"line":157,"address":[101646,101632],"length":1,"stats":{"Line":4},"fn_name":"{closure#2}"},{"line":158,"address":[157982,158039],"length":1,"stats":{"Line":4},"fn_name":null},{"line":159,"address":[101680,101699],"length":1,"stats":{"Line":4},"fn_name":"{closure#3}"},{"line":160,"address":[101869,101856],"length":1,"stats":{"Line":4},"fn_name":"{closure#4}"},{"line":161,"address":[101904,101913],"length":1,"stats":{"Line":4},"fn_name":"{closure#5}"},{"line":165,"address":[158208,159536,159563],"length":1,"stats":{"Line":2},"fn_name":"place_scanner"},{"line":166,"address":[158379,158316,158437,158580],"length":1,"stats":{"Line":8},"fn_name":null},{"line":167,"address":[102002,101952],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":170,"address":[158667,158755],"length":1,"stats":{"Line":4},"fn_name":null},{"line":171,"address":[158957],"length":1,"stats":{"Line":2},"fn_name":null},{"line":172,"address":[158840],"length":1,"stats":{"Line":2},"fn_name":null},{"line":173,"address":[158852],"length":1,"stats":{"Line":2},"fn_name":null},{"line":174,"address":[158935],"length":1,"stats":{"Line":2},"fn_name":null},{"line":176,"address":[159212,159160],"length":1,"stats":{"Line":4},"fn_name":null},{"line":177,"address":[159236],"length":1,"stats":{"Line":2},"fn_name":null},{"line":178,"address":[159398,159309],"length":1,"stats":{"Line":4},"fn_name":null},{"line":179,"address":[159514],"length":1,"stats":{"Line":2},"fn_name":null},{"line":182,"address":[159600,161166],"length":1,"stats":{"Line":2},"fn_name":"add_scanner_matches"},{"line":183,"address":[159639,159824],"length":1,"stats":{"Line":4},"fn_name":null},{"line":184,"address":[159961,159903],"length":1,"stats":{"Line":4},"fn_name":null},{"line":185,"address":[160225],"length":1,"stats":{"Line":2},"fn_name":null},{"line":186,"address":[159994],"length":1,"stats":{"Line":2},"fn_name":null},{"line":187,"address":[160408,160319],"length":1,"stats":{"Line":2},"fn_name":null},{"line":188,"address":[160611],"length":1,"stats":{"Line":2},"fn_name":null},{"line":189,"address":[160441,160374],"length":1,"stats":{"Line":4},"fn_name":null},{"line":190,"address":[160699,160796],"length":1,"stats":{"Line":2},"fn_name":null},{"line":191,"address":[160767,161095],"length":1,"stats":{"Line":4},"fn_name":null},{"line":192,"address":[160776],"length":1,"stats":{"Line":2},"fn_name":null},{"line":193,"address":[160884,160827],"length":1,"stats":{"Line":4},"fn_name":null},{"line":194,"address":[161043,160935],"length":1,"stats":{"Line":4},"fn_name":null},{"line":203,"address":[102208,103599,103616,104999],"length":1,"stats":{"Line":3},"fn_name":"calc_scanner_hashes\u003c6\u003e"},{"line":208,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":209,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":210,"address":[],"length":0,"stats":{"Line":12},"fn_name":null},{"line":211,"address":[],"length":0,"stats":{"Line":15},"fn_name":null},{"line":212,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":213,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":214,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":215,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":216,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":219,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":250,"address":[161200],"length":1,"stats":{"Line":0},"fn_name":"eq"},{"line":251,"address":[161213],"length":1,"stats":{"Line":0},"fn_name":null},{"line":258,"address":[161232],"length":1,"stats":{"Line":2},"fn_name":"partial_cmp"},{"line":259,"address":[161246],"length":1,"stats":{"Line":2},"fn_name":null},{"line":264,"address":[161280],"length":1,"stats":{"Line":0},"fn_name":"cmp"},{"line":265,"address":[161294],"length":1,"stats":{"Line":0},"fn_name":null},{"line":300,"address":[73985,74014,71728],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":302,"address":[71783],"length":1,"stats":{"Line":1},"fn_name":null},{"line":303,"address":[71828,71919],"length":1,"stats":{"Line":2},"fn_name":null},{"line":304,"address":[246992,247030],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":305,"address":[71936,73962],"length":1,"stats":{"Line":2},"fn_name":null},{"line":306,"address":[72065,72341,72275],"length":1,"stats":{"Line":2},"fn_name":null},{"line":307,"address":[72289,72629,72697],"length":1,"stats":{"Line":2},"fn_name":null},{"line":308,"address":[72643,72971],"length":1,"stats":{"Line":2},"fn_name":null},{"line":309,"address":[73170],"length":1,"stats":{"Line":1},"fn_name":null},{"line":310,"address":[73809,73289,73218,73531],"length":1,"stats":{"Line":4},"fn_name":null},{"line":311,"address":[73568],"length":1,"stats":{"Line":1},"fn_name":null},{"line":312,"address":[73854,73605,73712],"length":1,"stats":{"Line":5},"fn_name":null},{"line":313,"address":[247294,248186],"length":1,"stats":{"Line":2},"fn_name":null},{"line":314,"address":[247398,247302],"length":1,"stats":{"Line":1},"fn_name":null},{"line":315,"address":[247366,247499,247795,247697],"length":1,"stats":{"Line":3},"fn_name":null},{"line":316,"address":[247917,248115,247763,248234],"length":1,"stats":{"Line":3},"fn_name":null},{"line":318,"address":[248454,248374],"length":1,"stats":{"Line":1},"fn_name":null},{"line":319,"address":[248440],"length":1,"stats":{"Line":1},"fn_name":null},{"line":320,"address":[73822,73868,73664],"length":1,"stats":{"Line":1},"fn_name":null},{"line":322,"address":[73393],"length":1,"stats":{"Line":1},"fn_name":null},{"line":324,"address":[72113],"length":1,"stats":{"Line":1},"fn_name":null},{"line":376,"address":[115504,115513],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":377,"address":[199287,199526],"length":1,"stats":{"Line":1},"fn_name":null},{"line":378,"address":[199506],"length":1,"stats":{"Line":1},"fn_name":null},{"line":382,"address":[115561,115552],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":383,"address":[199814,199575],"length":1,"stats":{"Line":1},"fn_name":null},{"line":384,"address":[199794],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":126,"coverable":138},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-19","src","rotation.rs"],"content":"use super::*;\nuse model::Pos;\n\n#[ derive (Clone, Copy, Debug, Eq, Hash, PartialEq) ]\npub enum Rotation {\n\tNone, Clockwise, CounterClockwise, UpsideDown,\n\tUp, ClockwiseUp, CounterClockwiseUp, UpsideDownUp,\n\tDown, ClockwiseDown, CounterClockwiseDown, UpsideDownDown,\n\tLeft, ClockwiseLeft, CounterClockwiseLeft, UpsideDownLeft,\n\tRight, ClockwiseRight, CounterClockwiseRight, UpsideDownRight,\n\tAround, ClockwiseAround, CounterClockwiseAround, UpsideDownAround,\n}\n\n#[ allow (dead_code) ]\nimpl Rotation {\n\n\tpub const ALL: \u0026 'static [Self; 24] = \u0026 [\n\t\tSelf::None, Self::Clockwise,\n\t\tSelf::CounterClockwise, Self::UpsideDown,\n\t\tSelf::Up, Self::ClockwiseUp,\n\t\tSelf::CounterClockwiseUp, Self::UpsideDownUp,\n\t\tSelf::Down, Self::ClockwiseDown,\n\t\tSelf::CounterClockwiseDown, Self::UpsideDownDown,\n\t\tSelf::Left, Self::ClockwiseLeft,\n\t\tSelf::CounterClockwiseLeft, Self::UpsideDownLeft,\n\t\tSelf::Right, Self::ClockwiseRight,\n\t\tSelf::CounterClockwiseRight, Self::UpsideDownRight,\n\t\tSelf::Around, Self::ClockwiseAround,\n\t\tSelf::CounterClockwiseAround, Self::UpsideDownAround,\n\t];\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub const fn idx (self) -\u003e usize {\n\t\tmatch self {\n\t\t\tSelf::None =\u003e 0,\n\t\t\tSelf::Clockwise =\u003e 1,\n\t\t\tSelf::CounterClockwise =\u003e 2,\n\t\t\tSelf::UpsideDown =\u003e 3,\n\t\t\tSelf::Up =\u003e 4,\n\t\t\tSelf::ClockwiseUp =\u003e 5,\n\t\t\tSelf::CounterClockwiseUp =\u003e 6,\n\t\t\tSelf::UpsideDownUp =\u003e 7,\n\t\t\tSelf::Down =\u003e 8,\n\t\t\tSelf::ClockwiseDown =\u003e 9,\n\t\t\tSelf::CounterClockwiseDown =\u003e 10,\n\t\t\tSelf::UpsideDownDown =\u003e 11,\n\t\t\tSelf::Left =\u003e 12,\n\t\t\tSelf::ClockwiseLeft =\u003e 13,\n\t\t\tSelf::CounterClockwiseLeft =\u003e 14,\n\t\t\tSelf::UpsideDownLeft =\u003e 15,\n\t\t\tSelf::Right =\u003e 16,\n\t\t\tSelf::ClockwiseRight =\u003e 17,\n\t\t\tSelf::CounterClockwiseRight =\u003e 18,\n\t\t\tSelf::UpsideDownRight =\u003e 19,\n\t\t\tSelf::Around =\u003e 20,\n\t\t\tSelf::ClockwiseAround =\u003e 21,\n\t\t\tSelf::CounterClockwiseAround =\u003e 22,\n\t\t\tSelf::UpsideDownAround =\u003e 23,\n\t\t}\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub const fn apply (self, pos: Pos) -\u003e Pos {\n\t\tmatch self {\n\t\t\tSelf::None =\u003e Pos { x: pos.x, y: pos.y, z: pos.z },\n\t\t\tSelf::Clockwise =\u003e Pos { x: - pos.y, y: pos.x, z: pos.z },\n\t\t\tSelf::CounterClockwise =\u003e Pos { x: pos.y, y: - pos.x, z: pos.z },\n\t\t\tSelf::UpsideDown =\u003e Pos { x: - pos.x, y: - pos.y, z: pos.z },\n\t\t\tSelf::Up =\u003e Pos { x: pos.x, y: - pos.z, z: pos.y },\n\t\t\tSelf::ClockwiseUp =\u003e Pos { x: pos.z, y: pos.x, z: pos.y },\n\t\t\tSelf::CounterClockwiseUp =\u003e Pos { x: - pos.z, y: - pos.x, z: pos.y },\n\t\t\tSelf::UpsideDownUp =\u003e Pos { x: - pos.x, y: pos.z, z: pos.y },\n\t\t\tSelf::Down =\u003e Pos { x: pos.x, y: pos.z, z: - pos.y },\n\t\t\tSelf::ClockwiseDown =\u003e Pos { x: - pos.z, y: pos.x, z: - pos.y },\n\t\t\tSelf::CounterClockwiseDown =\u003e Pos { x: pos.z, y: - pos.x, z: - pos.y },\n\t\t\tSelf::UpsideDownDown =\u003e Pos { x: - pos.x, y: - pos.z, z: - pos.y },\n\t\t\tSelf::Left =\u003e Pos { x: pos.z, y: pos.y, z: - pos.x },\n\t\t\tSelf::ClockwiseLeft =\u003e Pos { x: - pos.y, y: pos.z, z: - pos.x },\n\t\t\tSelf::CounterClockwiseLeft =\u003e Pos { x: pos.y, y: - pos.z, z: - pos.x },\n\t\t\tSelf::UpsideDownLeft =\u003e Pos { x: - pos.z, y: - pos.y, z: - pos.x },\n\t\t\tSelf::Right =\u003e Pos { x: - pos.z, y: pos.y, z: pos.x },\n\t\t\tSelf::ClockwiseRight =\u003e Pos { x: - pos.y, y: - pos.z, z: pos.x },\n\t\t\tSelf::CounterClockwiseRight =\u003e Pos { x: pos.y, y: pos.z, z: pos.x },\n\t\t\tSelf::UpsideDownRight =\u003e Pos { x: pos.z, y: - pos.y, z: pos.x },\n\t\t\tSelf::Around =\u003e Pos { x: - pos.x, y: pos.y, z: - pos.z },\n\t\t\tSelf::ClockwiseAround =\u003e Pos { x: - pos.y, y: - pos.x, z: - pos.z },\n\t\t\tSelf::CounterClockwiseAround =\u003e Pos { x: pos.y, y: pos.x, z: - pos.z },\n\t\t\tSelf::UpsideDownAround =\u003e Pos { x: pos.x, y: - pos.y, z: - pos.z },\n\t\t}\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub const fn left (self) -\u003e Self {\n\t\tmatch self {\n\t\t\tSelf::None =\u003e Self::Left,\n\t\t\tSelf::Clockwise =\u003e Self::ClockwiseUp,\n\t\t\tSelf::CounterClockwise =\u003e Self::CounterClockwiseDown,\n\t\t\tSelf::UpsideDown =\u003e Self::UpsideDownRight,\n\t\t\tSelf::Up =\u003e Self::CounterClockwiseLeft,\n\t\t\tSelf::ClockwiseUp =\u003e Self::CounterClockwiseAround,\n\t\t\tSelf::CounterClockwiseUp =\u003e Self::CounterClockwise,\n\t\t\tSelf::UpsideDownUp =\u003e Self::CounterClockwiseRight,\n\t\t\tSelf::Down =\u003e Self::ClockwiseLeft,\n\t\t\tSelf::ClockwiseDown =\u003e Self::Clockwise,\n\t\t\tSelf::CounterClockwiseDown =\u003e Self::ClockwiseAround,\n\t\t\tSelf::UpsideDownDown =\u003e Self::ClockwiseRight,\n\t\t\tSelf::Left =\u003e Self::Around,\n\t\t\tSelf::ClockwiseLeft =\u003e Self::UpsideDownUp,\n\t\t\tSelf::CounterClockwiseLeft =\u003e Self::UpsideDownDown,\n\t\t\tSelf::UpsideDownLeft =\u003e Self::UpsideDown,\n\t\t\tSelf::Right =\u003e Self::None,\n\t\t\tSelf::ClockwiseRight =\u003e Self::Up,\n\t\t\tSelf::CounterClockwiseRight =\u003e Self::Down,\n\t\t\tSelf::UpsideDownRight =\u003e Self::UpsideDownAround,\n\t\t\tSelf::Around =\u003e Self::Right,\n\t\t\tSelf::ClockwiseAround =\u003e Self::CounterClockwiseUp,\n\t\t\tSelf::CounterClockwiseAround =\u003e Self::ClockwiseDown,\n\t\t\tSelf::UpsideDownAround =\u003e Self::UpsideDownLeft,\n\t\t}\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub const fn around (self) -\u003e Self {\n\t\tself.left ().left ()\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub const fn right (self) -\u003e Self {\n\t\tself.left ().left ().left ()\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub const fn clockwise (self) -\u003e Self {\n\t\tmatch self {\n\t\t\tSelf::None =\u003e Self::Clockwise,\n\t\t\tSelf::Clockwise =\u003e Self::UpsideDown,\n\t\t\tSelf::CounterClockwise =\u003e Self::None,\n\t\t\tSelf::UpsideDown =\u003e Self::CounterClockwise,\n\t\t\tSelf::Up =\u003e Self::ClockwiseUp,\n\t\t\tSelf::ClockwiseUp =\u003e Self::UpsideDownUp,\n\t\t\tSelf::CounterClockwiseUp =\u003e Self::Up,\n\t\t\tSelf::UpsideDownUp =\u003e Self::CounterClockwiseUp,\n\t\t\tSelf::Down =\u003e Self::ClockwiseDown,\n\t\t\tSelf::ClockwiseDown =\u003e Self::UpsideDownDown,\n\t\t\tSelf::CounterClockwiseDown =\u003e Self::Down,\n\t\t\tSelf::UpsideDownDown =\u003e Self::CounterClockwiseDown,\n\t\t\tSelf::Left =\u003e Self::ClockwiseLeft,\n\t\t\tSelf::ClockwiseLeft =\u003e Self::UpsideDownLeft,\n\t\t\tSelf::CounterClockwiseLeft =\u003e Self::Left,\n\t\t\tSelf::UpsideDownLeft =\u003e Self::CounterClockwiseLeft,\n\t\t\tSelf::Right =\u003e Self::ClockwiseRight,\n\t\t\tSelf::ClockwiseRight =\u003e Self::UpsideDownRight,\n\t\t\tSelf::CounterClockwiseRight =\u003e Self::Right,\n\t\t\tSelf::UpsideDownRight =\u003e Self::CounterClockwiseRight,\n\t\t\tSelf::Around =\u003e Self::ClockwiseAround,\n\t\t\tSelf::ClockwiseAround =\u003e Self::UpsideDownAround,\n\t\t\tSelf::CounterClockwiseAround =\u003e Self::Around,\n\t\t\tSelf::UpsideDownAround =\u003e Self::CounterClockwiseAround,\n\t\t}\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub const fn upside_down (self) -\u003e Self {\n\t\tself.clockwise ().clockwise ()\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub const fn counter_clockwise (self) -\u003e Self {\n\t\tself.clockwise ().clockwise ().clockwise ()\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub const fn up (self) -\u003e Self {\n\t\tmatch self {\n\t\t\tSelf::None =\u003e Self::Up,\n\t\t\tSelf::Clockwise =\u003e Self::ClockwiseRight,\n\t\t\tSelf::CounterClockwise =\u003e Self::CounterClockwiseLeft,\n\t\t\tSelf::UpsideDown =\u003e Self::UpsideDownDown,\n\t\t\tSelf::Up =\u003e Self::UpsideDownAround,\n\t\t\tSelf::ClockwiseUp =\u003e Self::UpsideDownRight,\n\t\t\tSelf::CounterClockwiseUp =\u003e Self::UpsideDownLeft,\n\t\t\tSelf::UpsideDownUp =\u003e Self::UpsideDown,\n\t\t\tSelf::Down =\u003e Self::None,\n\t\t\tSelf::ClockwiseDown =\u003e Self::Right,\n\t\t\tSelf::CounterClockwiseDown =\u003e Self::Left,\n\t\t\tSelf::UpsideDownDown =\u003e Self::Around,\n\t\t\tSelf::Left =\u003e Self::ClockwiseUp,\n\t\t\tSelf::ClockwiseLeft =\u003e Self::Clockwise,\n\t\t\tSelf::CounterClockwiseLeft =\u003e Self::CounterClockwiseAround,\n\t\t\tSelf::UpsideDownLeft =\u003e Self::ClockwiseDown,\n\t\t\tSelf::Right =\u003e Self::CounterClockwiseUp,\n\t\t\tSelf::ClockwiseRight =\u003e Self::ClockwiseAround,\n\t\t\tSelf::CounterClockwiseRight =\u003e Self::CounterClockwise,\n\t\t\tSelf::UpsideDownRight =\u003e Self::CounterClockwiseDown,\n\t\t\tSelf::Around =\u003e Self::UpsideDownUp,\n\t\t\tSelf::ClockwiseAround =\u003e Self::ClockwiseLeft,\n\t\t\tSelf::CounterClockwiseAround =\u003e Self::CounterClockwiseRight,\n\t\t\tSelf::UpsideDownAround =\u003e Self::Down,\n\t\t}\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub const fn flip (self) -\u003e Self {\n\t\tself.up ().up ()\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub const fn down (self) -\u003e Self {\n\t\tself.up ().up ().up ()\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub const fn rev (self) -\u003e Self {\n\t\tmatch self {\n\t\t\tSelf::None =\u003e Self::None,\n\t\t\tSelf::Clockwise =\u003e Self::CounterClockwise,\n\t\t\tSelf::CounterClockwise =\u003e Self::Clockwise,\n\t\t\tSelf::UpsideDown =\u003e Self::UpsideDown,\n\t\t\tSelf::Up =\u003e Self::Down,\n\t\t\tSelf::ClockwiseUp =\u003e Self::CounterClockwiseRight,\n\t\t\tSelf::CounterClockwiseUp =\u003e Self::ClockwiseLeft,\n\t\t\tSelf::UpsideDownUp =\u003e Self::UpsideDownUp,\n\t\t\tSelf::Down =\u003e Self::Up,\n\t\t\tSelf::ClockwiseDown =\u003e Self::CounterClockwiseLeft,\n\t\t\tSelf::CounterClockwiseDown =\u003e Self::ClockwiseRight,\n\t\t\tSelf::UpsideDownDown =\u003e Self::UpsideDownDown,\n\t\t\tSelf::Left =\u003e Self::Right,\n\t\t\tSelf::ClockwiseLeft =\u003e Self::CounterClockwiseUp,\n\t\t\tSelf::CounterClockwiseLeft =\u003e Self::ClockwiseDown,\n\t\t\tSelf::UpsideDownLeft =\u003e Self::UpsideDownLeft,\n\t\t\tSelf::Right =\u003e Self::Left,\n\t\t\tSelf::ClockwiseRight =\u003e Self::CounterClockwiseDown,\n\t\t\tSelf::CounterClockwiseRight =\u003e Self::ClockwiseUp,\n\t\t\tSelf::UpsideDownRight =\u003e Self::UpsideDownRight,\n\t\t\tSelf::Around =\u003e Self::Around,\n\t\t\tSelf::ClockwiseAround =\u003e Self::ClockwiseAround,\n\t\t\tSelf::CounterClockwiseAround =\u003e Self::CounterClockwiseAround,\n\t\t\tSelf::UpsideDownAround =\u003e Self::UpsideDownAround,\n\t\t}\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub const fn combine (self, other: Self) -\u003e Self {\n\t\tmatch self {\n\t\t\tSelf::None =\u003e other,\n\t\t\tSelf::Clockwise =\u003e other.clockwise (),\n\t\t\tSelf::CounterClockwise =\u003e other.counter_clockwise (),\n\t\t\tSelf::UpsideDown =\u003e other.upside_down (),\n\t\t\tSelf::Up =\u003e other.up (),\n\t\t\tSelf::ClockwiseUp =\u003e other.up ().clockwise (),\n\t\t\tSelf::CounterClockwiseUp =\u003e other.up ().counter_clockwise (),\n\t\t\tSelf::UpsideDownUp =\u003e other.up ().upside_down (),\n\t\t\tSelf::Down =\u003e other.down (),\n\t\t\tSelf::ClockwiseDown =\u003e other.down ().clockwise (),\n\t\t\tSelf::CounterClockwiseDown =\u003e other.down ().counter_clockwise (),\n\t\t\tSelf::UpsideDownDown =\u003e other.down ().upside_down (),\n\t\t\tSelf::Left =\u003e other.left (),\n\t\t\tSelf::ClockwiseLeft =\u003e other.left ().clockwise (),\n\t\t\tSelf::CounterClockwiseLeft =\u003e other.left ().counter_clockwise (),\n\t\t\tSelf::UpsideDownLeft =\u003e other.left ().upside_down (),\n\t\t\tSelf::Right =\u003e other.right (),\n\t\t\tSelf::ClockwiseRight =\u003e other.right ().clockwise (),\n\t\t\tSelf::CounterClockwiseRight =\u003e other.right ().counter_clockwise (),\n\t\t\tSelf::UpsideDownRight =\u003e other.right ().upside_down (),\n\t\t\tSelf::Around =\u003e other.around (),\n\t\t\tSelf::ClockwiseAround =\u003e other.around ().clockwise (),\n\t\t\tSelf::CounterClockwiseAround =\u003e other.around ().counter_clockwise (),\n\t\t\tSelf::UpsideDownAround =\u003e other.around ().upside_down (),\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod tests {\n\n\tuse aoc_common::*;\n\tuse super::*;\n\n\t#[ test ]\n\tfn test_rotation () {\n\t\tlet base = Pos { x: 1, y: 2, z: 3 };\n\t\tlet mut seen: HashSet \u003cPos\u003e = HashSet::new ();\n\t\tlet mut seen_left: HashSet \u003cRotation\u003e = HashSet::new ();\n\t\tlet mut seen_up: HashSet \u003cRotation\u003e = HashSet::new ();\n\t\tlet mut seen_clockwise: HashSet \u003cRotation\u003e = HashSet::new ();\n\t\tfn right_handed (pos: Pos) -\u003e bool {\n\t\t\tlet sign = match (pos.x.abs (), pos.y.abs (), pos.z.abs ()) {\n\t\t\t\t(1, 2, 3) =\u003e 1,\n\t\t\t\t(2, 3, 1) =\u003e 1,\n\t\t\t\t(3, 1, 2) =\u003e 1,\n\t\t\t\t(3, 2, 1) =\u003e -1,\n\t\t\t\t(2, 1, 3) =\u003e -1,\n\t\t\t\t(1, 3, 2) =\u003e -1,\n\t\t\t\t_ =\u003e panic! (),\n\t\t\t} * pos.x.signum () * pos.y.signum () * pos.z.signum ();\n\t\t\tsign \u003e 0\n\t\t}\n\t\tfor rotate in Rotation::ALL.iter ().copied () {\n\t\t\tlet result = rotate.apply (base);\n\t\t\tassert! (right_handed (result));\n\t\t\tassert! (! seen.contains (\u0026 result), \"Duplicated rotation {:?}\", result);\n\t\t\tseen.insert (result);\n\t\t\tlet rotate_left = rotate.left ();\n\t\t\tassert! (! seen_left.contains (\u0026 rotate_left), \"Duplicated rotation left {:?}\", rotate_left);\n\t\t\tseen_left.insert (rotate_left);\n\t\t\tlet rotate_up = rotate.up ();\n\t\t\tassert! (! seen_up.contains (\u0026 rotate_up), \"Duplicated rotation up {:?}\", rotate_up);\n\t\t\tseen_up.insert (rotate_up);\n\t\t\tlet rotate_clockwise = rotate.clockwise ();\n\t\t\tassert! (! seen_clockwise.contains (\u0026 rotate_clockwise), \"Duplicated rotation clockwise {:?}\", rotate_clockwise);\n\t\t\tseen_clockwise.insert (rotate_clockwise);\n\t\t\tlet rotate_four_lefts = rotate.left ().left ().left ().left ();\n\t\t\tassert_eq! (rotate, rotate_four_lefts, \"Four lefts from {:?} arrives at {:?}\", rotate, rotate_four_lefts);\n\t\t\tlet rotate_four_ups = rotate.up ().up ().up ().up ();\n\t\t\tassert_eq! (rotate, rotate_four_ups, \"Four ups from {:?} arrives at {:?}\", rotate, rotate_four_ups);\n\t\t\tlet rotate_four_clockwises = rotate.clockwise ().clockwise ().clockwise ().clockwise ();\n\t\t\tassert_eq! (rotate, rotate_four_clockwises, \"Four clockwises from {:?} arrives at {:?}\", rotate, rotate_four_clockwises);\n\t\t\tassert_eq! (rotate, rotate.up ().right ().down ().counter_clockwise ());\n\t\t\tassert_eq! (rotate, rotate.flip ().around ().upside_down ());\n\t\t\tlet rotate_two_revs = rotate.rev ().rev ();\n\t\t\tassert_eq! (rotate, rotate_two_revs, \"Two reverses of {:?} arrives at {:?}\", rotate, rotate_two_revs);\n\t\t\tlet pos_forward_rev = rotate.rev ().apply (rotate.apply (base));\n\t\t\tassert_eq! (base, pos_forward_rev, \"Applying forward and reverse to {:?} arrives at {:?}\", base, pos_forward_rev);\n\t\t\tfor other in Rotation::ALL.iter ().copied () {\n\t\t\t\tlet pos_apply_twice = other.apply (rotate.apply (base));\n\t\t\t\tlet pos_combine = other.combine (rotate).apply (base);\n\t\t\t\tassert_eq! (pos_apply_twice, pos_combine,\n\t\t\t\t\t\"Applying {:?} then {:?} gives {:?} but combining then applying gives {:?}\",\n\t\t\t\t\trotate, other, pos_apply_twice, pos_combine);\n\t\t\t\tfor other_base in Rotation::ALL.iter ().copied ().map (|rot| rot.apply (base)) {\n\t\t\t\t\tif other.apply (other_base) != result { continue }\n\t\t\t\t\tassert_eq! (other.rev ().combine (rotate).apply (base), other_base);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n}\n","traces":[{"line":34,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":45,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":46,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":47,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":49,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":50,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":52,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":57,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":58,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":59,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":65,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":74,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":75,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":80,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":81,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":82,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":83,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":85,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":86,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":89,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":99,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":101,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":102,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":103,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":107,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":108,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":109,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":110,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":111,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":113,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":114,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":115,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":116,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":117,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":118,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":119,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":120,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":121,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":127,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":128,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":133,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":134,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":139,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":140,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":141,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":142,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":143,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":144,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":145,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":146,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":147,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":148,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":149,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":150,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":151,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":152,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":153,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":154,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":155,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":156,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":157,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":158,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":159,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":160,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":161,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":162,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":163,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":164,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":170,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":171,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":176,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":177,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":182,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":183,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":184,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":185,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":186,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":187,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":188,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":189,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":190,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":191,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":192,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":193,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":194,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":195,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":196,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":197,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":198,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":199,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":200,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":201,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":202,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":203,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":204,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":205,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":206,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":207,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":213,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":214,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":219,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":220,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":225,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":226,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":227,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":228,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":229,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":230,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":231,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":232,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":233,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":234,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":235,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":236,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":237,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":238,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":239,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":240,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":241,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":242,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":243,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":244,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":245,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":246,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":247,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":248,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":249,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":250,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":256,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":257,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":258,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":259,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":260,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":261,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":262,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":263,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":264,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":265,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":266,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":267,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":268,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":269,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":270,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":271,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":272,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":273,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":274,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":275,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":276,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":277,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":278,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":279,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":280,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":281,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":294,"address":[74368,74373],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":295,"address":[174103],"length":1,"stats":{"Line":1},"fn_name":null},{"line":296,"address":[174133],"length":1,"stats":{"Line":1},"fn_name":null},{"line":297,"address":[174154],"length":1,"stats":{"Line":1},"fn_name":null},{"line":298,"address":[174209],"length":1,"stats":{"Line":1},"fn_name":null},{"line":299,"address":[174261],"length":1,"stats":{"Line":1},"fn_name":null},{"line":300,"address":[181088],"length":1,"stats":{"Line":1},"fn_name":"right_handed"},{"line":301,"address":[181505,181826,181128,181277,181909,181548,181602,181695],"length":1,"stats":{"Line":5},"fn_name":null},{"line":302,"address":[181585],"length":1,"stats":{"Line":1},"fn_name":null},{"line":303,"address":[181539],"length":1,"stats":{"Line":1},"fn_name":null},{"line":304,"address":[181496],"length":1,"stats":{"Line":1},"fn_name":null},{"line":305,"address":[181414],"length":1,"stats":{"Line":1},"fn_name":null},{"line":306,"address":[181530],"length":1,"stats":{"Line":1},"fn_name":null},{"line":307,"address":[181573],"length":1,"stats":{"Line":1},"fn_name":null},{"line":308,"address":[181247],"length":1,"stats":{"Line":0},"fn_name":null},{"line":309,"address":[181421,181494,181693,181620,181751,181824],"length":1,"stats":{"Line":6},"fn_name":null},{"line":310,"address":[181892],"length":1,"stats":{"Line":1},"fn_name":null},{"line":312,"address":[174564,174393,174305],"length":1,"stats":{"Line":3},"fn_name":null},{"line":313,"address":[174578],"length":1,"stats":{"Line":1},"fn_name":null},{"line":314,"address":[174825,174714],"length":1,"stats":{"Line":1},"fn_name":null},{"line":315,"address":[174811,174952,174864],"length":1,"stats":{"Line":2},"fn_name":null},{"line":316,"address":[174872],"length":1,"stats":{"Line":1},"fn_name":null},{"line":317,"address":[175075],"length":1,"stats":{"Line":1},"fn_name":null},{"line":318,"address":[175190,175127],"length":1,"stats":{"Line":1},"fn_name":null},{"line":319,"address":[175156],"length":1,"stats":{"Line":1},"fn_name":null},{"line":320,"address":[175313],"length":1,"stats":{"Line":1},"fn_name":null},{"line":321,"address":[175428,175365],"length":1,"stats":{"Line":1},"fn_name":null},{"line":322,"address":[175394],"length":1,"stats":{"Line":1},"fn_name":null},{"line":323,"address":[175551],"length":1,"stats":{"Line":1},"fn_name":null},{"line":324,"address":[175603,175666],"length":1,"stats":{"Line":1},"fn_name":null},{"line":325,"address":[175632],"length":1,"stats":{"Line":1},"fn_name":null},{"line":326,"address":[175789],"length":1,"stats":{"Line":1},"fn_name":null},{"line":327,"address":[175905,176029],"length":1,"stats":{"Line":1},"fn_name":null},{"line":328,"address":[176332,176004],"length":1,"stats":{"Line":2},"fn_name":null},{"line":329,"address":[176543,176419],"length":1,"stats":{"Line":1},"fn_name":null},{"line":330,"address":[176518,176846],"length":1,"stats":{"Line":2},"fn_name":null},{"line":331,"address":[177057,176933],"length":1,"stats":{"Line":1},"fn_name":null},{"line":332,"address":[177360,177584,177032],"length":1,"stats":{"Line":2},"fn_name":null},{"line":333,"address":[177546,177638,177838],"length":1,"stats":{"Line":2},"fn_name":null},{"line":334,"address":[177892,177800],"length":1,"stats":{"Line":2},"fn_name":null},{"line":335,"address":[178055,177931],"length":1,"stats":{"Line":1},"fn_name":null},{"line":336,"address":[178030,178351],"length":1,"stats":{"Line":2},"fn_name":null},{"line":337,"address":[178603,178740],"length":1,"stats":{"Line":1},"fn_name":null},{"line":338,"address":[179052,178702],"length":1,"stats":{"Line":2},"fn_name":null},{"line":339,"address":[179223],"length":1,"stats":{"Line":1},"fn_name":null},{"line":340,"address":[179481],"length":1,"stats":{"Line":1},"fn_name":null},{"line":341,"address":[179657,179794],"length":1,"stats":{"Line":1},"fn_name":null},{"line":344,"address":[74400,74416],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":345,"address":[180499],"length":1,"stats":{"Line":1},"fn_name":null},{"line":346,"address":[180670],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":217,"coverable":244},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-20","src","lib.rs"],"content":"//! Advent of Code 2021: Day 20: Trench Map\n//!\n//! [https://adventofcode.com/2021/day/20](https://adventofcode.com/2021/day/20)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\nuse aoc_grid as grid;\nuse aoc_pos as pos;\n\npuzzle_info! {\n\tname = \"Trench Map\";\n\tyear = 2021;\n\tday = 20;\n\tpart_one = |lines| logic::part_one (lines);\n\tpart_two = |lines| logic::part_two (lines);\n\tcommands = [\n\t\t( name = \"run\"; method = tool::run; ),\n\t];\n}\n\nmod logic {\n\n\tuse super::*;\n\tuse model::Algorithm;\n\tuse model::Image;\n\tuse model::Input;\n\tuse model::Pixels;\n\tuse model::Pos;\n\tuse nums::IntConv;\n\n\tpub fn part_one (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003ci64\u003e {\n\t\tcalc_result (lines, 2)\n\t}\n\n\tpub fn part_two (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003ci64\u003e {\n\t\tcalc_result (lines, 50)\n\t}\n\n\tpub fn calc_result (lines: \u0026 [\u0026 str], loops: usize) -\u003e GenResult \u003ci64\u003e {\n\t\tlet input = Input::parse (lines) ?;\n\t\tlet image = Image::new_from (input.pixels, false);\n\t\tOk (\n\t\t\timage_iter (input.algorithm, image)\n\t\t\t\t.nth (loops)\n\t\t\t\t.unwrap ()\n\t\t\t\t.num_pixels ().as_i64 ()\n\t\t)\n\t}\n\n\tpub struct ImageIter {\n\t\talgorithm: Algorithm,\n\t\timage: Rc \u003cImage\u003e,\n\t\tfirst: bool,\n\t}\n\n\t#[ allow (clippy::large_types_passed_by_value) ]\n\tpub fn image_iter \u003cIntoImage: Into \u003cRc \u003cImage\u003e\u003e\u003e (\n\t\talgorithm: Algorithm,\n\t\timage: IntoImage,\n\t) -\u003e ImageIter {\n\t\tlet image = image.into ();\n\t\tImageIter { algorithm, image, first: true }\n\t}\n\n\timpl Iterator for ImageIter {\n\t\ttype Item = Rc \u003cImage\u003e;\n\t\tfn next (\u0026 mut self) -\u003e Option \u003cRc \u003cImage\u003e\u003e {\n\t\t\tif self.first {\n\t\t\t\tself.first = false;\n\t\t\t} else {\n\t\t\t\tself.image = Rc::new (calc_next (\u0026 self.algorithm, \u0026 self.image));\n\t\t\t}\n\t\t\tSome (Rc::clone (\u0026 self.image))\n\t\t}\n\t}\n\n\tpub fn calc_next (algorithm: \u0026 Algorithm, image: \u0026 Image) -\u003e Image {\n\t\tlet (origin, peak) = image.range ();\n\t\tlet new_pixels = (origin.y - 1 .. peak.y + 1).flat_map (|y|\n\t\t\t(origin.x - 3 .. peak.x + 1).map (move |x| [\n\t\t\t\timage.get (Pos { y: y - 1, x: x + 1 }),\n\t\t\t\timage.get (Pos { y, x: x + 1 }),\n\t\t\t\timage.get (Pos { y: y + 1, x: x + 1 }),\n\t\t\t]).scan ([false; 9], |state, next| {\n\t\t\t\t* state = [\n\t\t\t\t\tstate [1], state [2], next [0],\n\t\t\t\t\tstate [4], state [5], next [1],\n\t\t\t\t\tstate [7], state [8], next [2],\n\t\t\t\t];\n\t\t\t\tSome (* state)\n\t\t\t}).skip (2).map (|bits| {\n\t\t\t\tlet algorithm_idx = bits.into_iter ()\n\t\t\t\t\t.fold (0, |val, bit| (val \u003c\u003c 1_i32) | if bit { 1 } else { 0 });\n\t\t\t\talgorithm [algorithm_idx]\n\t\t\t})\n\t\t).collect ();\n\t\tlet new_size = [image.height () + 2, image.width () + 2];\n\t\tlet new_pixels = Pixels::wrap (new_pixels, [0, 0], new_size);\n\t\tlet new_inverted = algorithm [if image.inverted () { 0x1ff } else { 0 }];\n\t\tImage::new_from (new_pixels, new_inverted)\n\t}\n\n}\n\nmod model {\n\n\tuse super::*;\n\n\tpub type Algorithm = [bool; 512];\n\tpub type Pixels = grid::Grid \u003cVec \u003cbool\u003e, Pos\u003e;\n\tpub type Pos = pos::PosYX \u003ci16\u003e;\n\n\tpub struct Input {\n\t\tpub algorithm: Algorithm,\n\t\tpub pixels: Pixels,\n\t}\n\n\timpl Input {\n\t\tpub fn parse (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet err = |idx, msg| format! (\"Invalid input: {}: {}\", idx + 1, msg);\n\t\t\tlet algorithm = {\n\t\t\t\tlet line_0_len = lines [0].chars ().count ();\n\t\t\t\tif line_0_len != 512 {\n\t\t\t\t\tErr (err (0, format! (\"Algorithm is {} chars, expected 512\", line_0_len))) ?;\n\t\t\t\t}\n\t\t\t\tlet mut algorithm = [false; 512];\n\t\t\t\tfor (letter_idx, letter) in lines [0].chars ().enumerate () {\n\t\t\t\t\tmatch letter {\n\t\t\t\t\t\t'#' =\u003e algorithm [letter_idx] = true,\n\t\t\t\t\t\t'.' =\u003e (),\n\t\t\t\t\t\t_ =\u003e Err (err (0, \"Invalid character in algorithm\".to_owned ())) ?,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\talgorithm\n\t\t\t};\n\t\t\tif ! lines [1].is_empty () { Err (err (1, \"Expected blank line\".to_owned ())) ?; }\n\t\t\tlet pixels = lines.iter ().enumerate ().skip (2).flat_map (|(line_idx, line)| {\n\t\t\t\tline.chars ().map (move |letter| { match letter {\n\t\t\t\t\t'#' =\u003e Ok (true),\n\t\t\t\t\t'.' =\u003e Ok (false),\n\t\t\t\t\t_ =\u003e Err (err (line_idx, \"Invalid character\".to_owned ())),\n\t\t\t\t}})\n\t\t\t}).collect::\u003cResult \u003c_, _\u003e\u003e () ?;\n\t\t\tlet size = [lines.len () - 2, lines [2].chars ().count ()];\n\t\t\tlet pixels = Pixels::wrap (pixels, [0, 0], size);\n\t\t\tOk (Self { algorithm, pixels })\n\t\t}\n\t}\n\n\t#[ derive (Debug) ]\n\tpub struct Image {\n\t\tpixels: Pixels,\n\t\tinverted: bool,\n\t}\n\n\timpl Image {\n\t\tpub const fn new_from (pixels: Pixels, inverted: bool) -\u003e Self {\n\t\t\tSelf { pixels, inverted }\n\t\t}\n\t\tpub fn num_pixels (\u0026 self) -\u003e usize {\n\t\t\tself.pixels.values ().filter (|\u0026 val| val != self.inverted).count ()\n\t\t}\n\t\tpub const fn height (\u0026 self) -\u003e usize { self.pixels.size () [0] }\n\t\tpub const fn width (\u0026 self) -\u003e usize { self.pixels.size () [1] }\n\t\tpub const fn inverted (\u0026 self) -\u003e bool { self.inverted }\n\t\tpub fn get (\u0026 self, pos: Pos) -\u003e bool {\n\t\t\tself.pixels.get (pos).unwrap_or (self.inverted)\n\t\t}\n\t\tpub fn range (\u0026 self) -\u003e (Pos, Pos) {\n\t\t\t(self.pixels.origin (), self.pixels.peak () + Pos { y: 1, x: 1 })\n\t\t}\n\t\tpub const fn dump (\u0026 self) -\u003e ImageDump {\n\t\t\tImageDump (self)\n\t\t}\n\t}\n\n\tpub struct ImageDump \u003c'img\u003e (\u0026 'img Image);\n\n\timpl \u003c'img\u003e fmt::Display for ImageDump \u003c'img\u003e {\n\t\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\t\tlet ImageDump (image) = * self;\n\t\t\tlet (origin, peak) = image.range ();\n\t\t\tfor y in origin.y .. peak.y {\n\t\t\t\tfor x in origin.x .. peak.x {\n\t\t\t\t\tlet pos = Pos { y, x };\n\t\t\t\t\twrite! (formatter, \"{}\", if image.get (pos) { '#' } else { '.' }) ?;\n\t\t\t\t}\n\t\t\t\twrite! (formatter, \"\\n\") ?;\n\t\t\t}\n\t\t\tOk (())\n\t\t}\n\t}\n\n}\n\npub mod tool {\n\n\tuse super::*;\n\tuse model::Image;\n\tuse model::Input;\n\n\t#[ derive (Debug, clap::Parser) ]\n\tpub struct RunArgs {\n\n\t\t/// File to read algorithm and initial image from\n\t\t#[ clap (long, value_parser, default_value = \"inputs/day-20\") ]\n\t\tinput: String,\n\n\t\t/// Print the image after each step\n\t\t#[ clap (long) ]\n\t\tverbose: bool,\n\n\t\t/// Number of times to apply the algorithm\n\t\t#[ clap (long, value_parser, default_value_t = 2) ]\n\t\tloops: usize,\n\n\t}\n\n\t#[ allow (clippy::needless_pass_by_value) ]\n\t#[ allow (clippy::print_stdout) ]\n\tpub fn run (args: RunArgs) -\u003e GenResult \u003c()\u003e {\n\t\tlet input_string = fs::read_to_string (\u0026 args.input) ?;\n\t\tlet input_lines: Vec \u003c\u0026 str\u003e = input_string.trim ().split ('\\n').collect ();\n\t\tlet input = Input::parse (\u0026 input_lines) ?;\n\t\tlet start_image = Image::new_from (input.pixels, false);\n\t\tlet end_image = logic::image_iter (input.algorithm, start_image)\n\t\t\t.enumerate ()\n\t\t\t.inspect (|\u0026 (ref steps, ref image)| if args.verbose {\n\t\t\t\tprint! (\n\t\t\t\t\t\"After {} steps: {} pixels {}\\n{}\",\n\t\t\t\t\tsteps,\n\t\t\t\t\timage.num_pixels (),\n\t\t\t\t\tif image.inverted () { \"inactive\" } else { \"active\" },\n\t\t\t\t\timage.dump (),\n\t\t\t\t);\n\t\t\t},\n\t\t).map (|(_, image)| image).nth (args.loops).unwrap ();\n\t\tprintln! (\"Result: {}\", end_image.num_pixels ());\n\t\tOk (())\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse aoc_common::*;\n\tuse crate::logic;\n\n\tconst EXAMPLE: \u0026 'static [\u0026 'static str] = \u0026 [\n\t\t\"..#.#..#####.#.#.#.###.##.....###.##.#..###.####..#####..#....#..#..##..###..######.###..\\\n\t\t.####..#..#####..##..#.#####...##.#.#..#.##..#.#......#.###.######.###.####...#.##.##..#..\\\n\t\t#..#####.....#.#....###..#.##......#.....#..#..#..##..#...##.######.####.####.#.#...#.....\\\n\t\t..#..#.#.#...####.##.#......#..#...##.#.##..#...##.#.##..###.#......#.#.......#.#.#.####.#\\\n\t\t##.##...#.....####.#..#..#.##.#....##..#.####....##...##..#...#......#.#.......#.......##.\\\n\t\t.####..#...#.#.#...##..#.#..###..#####........#..####......#..#\",\n\t\t\"\",\n\t\t\"#..#.\",\n\t\t\"#....\",\n\t\t\"##..#\",\n\t\t\"..#..\",\n\t\t\"..###\",\n\t];\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (35, logic::part_one (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (3351, logic::part_two (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":11,"address":[103977,104441],"length":1,"stats":{"Line":0},"fn_name":null},{"line":15,"address":[104062],"length":1,"stats":{"Line":0},"fn_name":null},{"line":16,"address":[104526],"length":1,"stats":{"Line":0},"fn_name":null},{"line":32,"address":[72688],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":33,"address":[72709],"length":1,"stats":{"Line":1},"fn_name":null},{"line":36,"address":[72736],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":37,"address":[72757],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[73323,73350,72784],"length":1,"stats":{"Line":1},"fn_name":"calc_result"},{"line":41,"address":[73065,72830],"length":1,"stats":{"Line":1},"fn_name":null},{"line":42,"address":[72969],"length":1,"stats":{"Line":1},"fn_name":null},{"line":44,"address":[73555,73171,73403],"length":1,"stats":{"Line":3},"fn_name":null},{"line":58,"address":[70736],"length":1,"stats":{"Line":1},"fn_name":"image_iter\u003caoc_2021_day_20::model::Image\u003e"},{"line":62,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":68,"address":[73648,73827],"length":1,"stats":{"Line":1},"fn_name":"next"},{"line":69,"address":[73665,73870],"length":1,"stats":{"Line":2},"fn_name":null},{"line":70,"address":[73745],"length":1,"stats":{"Line":1},"fn_name":null},{"line":72,"address":[73679,73867,73779,73738],"length":1,"stats":{"Line":4},"fn_name":null},{"line":74,"address":[73757,73877],"length":1,"stats":{"Line":2},"fn_name":null},{"line":78,"address":[73904,74937],"length":1,"stats":{"Line":1},"fn_name":"calc_next"},{"line":79,"address":[73939],"length":1,"stats":{"Line":1},"fn_name":null},{"line":80,"address":[71281,70896],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":81,"address":[71296,71258,71777,70942,71190],"length":1,"stats":{"Line":5},"fn_name":"{closure#0}"},{"line":82,"address":[71323],"length":1,"stats":{"Line":1},"fn_name":null},{"line":83,"address":[71491],"length":1,"stats":{"Line":1},"fn_name":null},{"line":84,"address":[71607],"length":1,"stats":{"Line":1},"fn_name":null},{"line":85,"address":[71824,71170,72014],"length":1,"stats":{"Line":3},"fn_name":"{closure#1}"},{"line":86,"address":[71917],"length":1,"stats":{"Line":1},"fn_name":null},{"line":87,"address":[71880],"length":1,"stats":{"Line":1},"fn_name":null},{"line":88,"address":[71892],"length":1,"stats":{"Line":1},"fn_name":null},{"line":89,"address":[71905],"length":1,"stats":{"Line":1},"fn_name":null},{"line":91,"address":[71984],"length":1,"stats":{"Line":1},"fn_name":null},{"line":92,"address":[72136,72032,71246],"length":1,"stats":{"Line":3},"fn_name":"{closure#2}"},{"line":93,"address":[72046],"length":1,"stats":{"Line":1},"fn_name":null},{"line":94,"address":[72176,72202],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":95,"address":[72151,72105],"length":1,"stats":{"Line":1},"fn_name":null},{"line":98,"address":[74286,74581,74349],"length":1,"stats":{"Line":2},"fn_name":null},{"line":99,"address":[74614,74465],"length":1,"stats":{"Line":2},"fn_name":null},{"line":100,"address":[74856,74683,74622],"length":1,"stats":{"Line":2},"fn_name":null},{"line":101,"address":[74769],"length":1,"stats":{"Line":1},"fn_name":null},{"line":120,"address":[82041,79152,82007],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":121,"address":[79207],"length":1,"stats":{"Line":1},"fn_name":null},{"line":123,"address":[79215],"length":1,"stats":{"Line":1},"fn_name":null},{"line":124,"address":[79730,79314],"length":1,"stats":{"Line":1},"fn_name":null},{"line":125,"address":[79377,79743],"length":1,"stats":{"Line":0},"fn_name":null},{"line":127,"address":[79328],"length":1,"stats":{"Line":1},"fn_name":null},{"line":128,"address":[79885,79356,80149],"length":1,"stats":{"Line":3},"fn_name":null},{"line":129,"address":[80188],"length":1,"stats":{"Line":1},"fn_name":null},{"line":130,"address":[80242,80598],"length":1,"stats":{"Line":2},"fn_name":null},{"line":132,"address":[80210,80264],"length":1,"stats":{"Line":0},"fn_name":null},{"line":135,"address":[80091],"length":1,"stats":{"Line":1},"fn_name":null},{"line":137,"address":[80647,80744,80125],"length":1,"stats":{"Line":2},"fn_name":null},{"line":138,"address":[81460,80723,81108],"length":1,"stats":{"Line":5},"fn_name":null},{"line":139,"address":[115808,115849,115742,116052],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":140,"address":[115917],"length":1,"stats":{"Line":1},"fn_name":null},{"line":141,"address":[115931],"length":1,"stats":{"Line":1},"fn_name":null},{"line":142,"address":[115950,115872],"length":1,"stats":{"Line":0},"fn_name":null},{"line":144,"address":[81364],"length":1,"stats":{"Line":0},"fn_name":null},{"line":145,"address":[81539,81341],"length":1,"stats":{"Line":2},"fn_name":null},{"line":146,"address":[81722],"length":1,"stats":{"Line":1},"fn_name":null},{"line":147,"address":[81841],"length":1,"stats":{"Line":1},"fn_name":null},{"line":158,"address":[82064],"length":1,"stats":{"Line":1},"fn_name":"new_from"},{"line":161,"address":[82160],"length":1,"stats":{"Line":1},"fn_name":"num_pixels"},{"line":162,"address":[82174],"length":1,"stats":{"Line":3},"fn_name":null},{"line":164,"address":[82256,82268],"length":1,"stats":{"Line":2},"fn_name":"height"},{"line":165,"address":[82288,82300],"length":1,"stats":{"Line":2},"fn_name":"width"},{"line":166,"address":[82325,82320],"length":1,"stats":{"Line":2},"fn_name":"inverted"},{"line":167,"address":[82336],"length":1,"stats":{"Line":1},"fn_name":"get"},{"line":168,"address":[82366],"length":1,"stats":{"Line":1},"fn_name":null},{"line":170,"address":[82432],"length":1,"stats":{"Line":1},"fn_name":"range"},{"line":171,"address":[82446],"length":1,"stats":{"Line":1},"fn_name":null},{"line":173,"address":[82592],"length":1,"stats":{"Line":0},"fn_name":"dump"},{"line":174,"address":[82601],"length":1,"stats":{"Line":0},"fn_name":null},{"line":181,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":182,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":183,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":184,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":185,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":186,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":187,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":189,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":191,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":222,"address":[83568,84962,85340],"length":1,"stats":{"Line":0},"fn_name":"run"},{"line":223,"address":[83655,83799,83592],"length":1,"stats":{"Line":0},"fn_name":null},{"line":224,"address":[83982,83773],"length":1,"stats":{"Line":0},"fn_name":null},{"line":225,"address":[84157,84387,84066],"length":1,"stats":{"Line":0},"fn_name":null},{"line":226,"address":[84287],"length":1,"stats":{"Line":0},"fn_name":null},{"line":227,"address":[84858,84614,84784,84915],"length":1,"stats":{"Line":0},"fn_name":null},{"line":229,"address":[76231,76208],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":230,"address":[76603,76272,76512,76359],"length":1,"stats":{"Line":0},"fn_name":null},{"line":233,"address":[76346],"length":1,"stats":{"Line":0},"fn_name":null},{"line":234,"address":[76437],"length":1,"stats":{"Line":0},"fn_name":null},{"line":235,"address":[76590],"length":1,"stats":{"Line":0},"fn_name":null},{"line":239,"address":[85091],"length":1,"stats":{"Line":0},"fn_name":null},{"line":240,"address":[85231],"length":1,"stats":{"Line":0},"fn_name":null},{"line":267,"address":[148432,148441],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":268,"address":[174230,173991],"length":1,"stats":{"Line":1},"fn_name":null},{"line":269,"address":[174210],"length":1,"stats":{"Line":1},"fn_name":null},{"line":273,"address":[148489,148480],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":274,"address":[174518,174279],"length":1,"stats":{"Line":1},"fn_name":null},{"line":275,"address":[174498],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":69,"coverable":100},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-21","src","lib.rs"],"content":"//! Advent of Code 2021: Day 21: Dirac Dice\n//!\n//! [https://adventofcode.com/2021/day/21](https://adventofcode.com/2021/day/21)\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Dirac Dice\";\n\tyear = 2021;\n\tday = 21;\n\tpart_one = |lines| logic::part_one (lines);\n\tpart_two = |lines| logic::part_two (lines);\n}\n\nmod logic {\n\n\tuse super::*;\n\tuse nums::IntConv;\n\n\tpub fn part_one (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cu64\u003e {\n\t\tlet (start_1, start_2) = model::parse_input (lines) ?;\n\t\tlet mut die_state: u16 = 0;\n\t\tlet mut die_count: u64 = 0;\n\t\tlet mut die_roll = || {\n\t\t\tlet roll = die_state + 1;\n\t\t\tdie_state = (die_state + 1) % 100;\n\t\t\tdie_count += 1;\n\t\t\troll\n\t\t};\n\t\tstruct Player { score: u16, pos: u8 }\n\t\tlet mut players = [\n\t\t\tPlayer { score: 0, pos: start_1 - 1 },\n\t\t\tPlayer { score: 0, pos: start_2 - 1 },\n\t\t];\n\t\tlet winner = 'OUTER: loop {\n\t\t\tfor (player_idx, player) in players.iter_mut ().enumerate () {\n\t\t\t\tlet roll = iter::from_fn (|| Some (die_roll ())).take (3).sum::\u003cu16\u003e ();\n\t\t\t\tplayer.pos = ((player.pos.as_u16 () + roll.as_u16 ()) % 10).as_u8 ();\n\t\t\t\tplayer.score += player.pos.as_u16 () + 1;\n\t\t\t\tif player.score \u003e= 1000 { break 'OUTER player_idx }\n\t\t\t}\n\t\t};\n\t\tlet loser = (winner + 1) % 2;\n\t\tOk (die_count * players [loser].score.as_u64 ())\n\t}\n\n\tpub fn part_two (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cu128\u003e {\n\t\tlet (start_1, start_2) = model::parse_input (lines) ?;\n\t\t#[ derive (Clone, Copy, Debug, Default, Eq, Hash, PartialEq) ]\n\t\tstruct Player { score: u8, pos: u8 }\n\t\t#[ derive (Clone, Copy, Debug, Default, Eq, Hash, PartialEq) ]\n\t\tstruct Game { players: [Player; 2], turn: u8 }\n\t\tstruct Frame { game: Game, counts: [u128; 2], progress: usize }\n\t\tlet start_game = Game {\n\t\t\tplayers: [ Player { score: 0, pos: start_1 }, Player { score: 0, pos: start_2 } ],\n\t\t\tturn: 0,\n\t\t};\n\t\tlet mut solved: HashMap \u003cGame, [u128; 2]\u003e = HashMap::new ();\n\t\tlet mut stack: Vec \u003cFrame\u003e = Vec::new ();\n\t\tstack.push (Frame { game: start_game, counts: [0; 2], progress: 0 });\n\t\tlet roll_freqs: [(u8, usize); 7] = [(3, 1), (4, 3), (5, 6), (6, 7), (7, 6), (8, 3), (9, 1)];\n\t\twhile let Some (frame) = stack.last_mut () {\n\t\t\tif frame.progress == roll_freqs.len () {\n\t\t\t\tsolved.insert (frame.game, frame.counts);\n\t\t\t\tstack.pop ().unwrap ();\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet old_player = frame.game.players [frame.game.turn.as_usize ()];\n\t\t\tlet (roll_val, roll_freq) = roll_freqs [frame.progress];\n\t\t\tlet mut new_game = frame.game;\n\t\t\tlet new_player = \u0026 mut new_game.players [frame.game.turn.as_usize ()];\n\t\t\tnew_player.pos = ((old_player.pos - 1) + roll_val) % 10 + 1;\n\t\t\tnew_player.score = old_player.score + new_player.pos;\n\t\t\tif new_player.score \u003e= 21 {\n\t\t\t\tframe.counts [frame.game.turn.as_usize ()] = u128::checked_add (\n\t\t\t\t\tframe.counts [frame.game.turn.as_usize ()], roll_freq.as_u128 ()).unwrap ();\n\t\t\t\tframe.progress += 1;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tnew_game.turn = (frame.game.turn + 1) % 2;\n\t\t\tif let Some (solved_counts) = solved.get (\u0026 new_game) {\n\t\t\t\tframe.counts = [\n\t\t\t\t\tu128::checked_add (frame.counts [0],\n\t\t\t\t\t\tu128::checked_mul (solved_counts [0], roll_freq.as_u128 ()).unwrap (),\n\t\t\t\t\t).unwrap (),\n\t\t\t\t\tu128::checked_add (frame.counts [1],\n\t\t\t\t\t\tu128::checked_mul (solved_counts [1], roll_freq.as_u128 ()).unwrap (),\n\t\t\t\t\t).unwrap (),\n\t\t\t\t];\n\t\t\t\tframe.progress += 1;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet new_frame = Frame {\n\t\t\t\tgame: new_game,\n\t\t\t\tcounts: [0; 2],\n\t\t\t\tprogress: 0,\n\t\t\t};\n\t\t\tstack.push (new_frame);\n\t\t}\n\t\tOk (solved [\u0026 start_game].into_iter ().max ().unwrap ())\n\t}\n\n}\n\nmod model {\n\n\tuse super::*;\n\n\tpub fn parse_input (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003c(u8, u8)\u003e {\n\t\tuse parser::*;\n\t\tif lines.len () != 2 { Err (\"Invalid input: expected two lines\") ? }\n\t\tlet mut parser = Parser::new (lines [0]);\n\t\tlet start_1: u8 = parser.expect (\"Player 1 starting position: \") ?.int () ?;\n\t\tparser.end () ?;\n\t\tlet mut parser = Parser::new (lines [1]);\n\t\tlet start_2: u8 = parser.expect (\"Player 2 starting position: \") ?.int () ?;\n\t\tparser.end () ?;\n\t\tOk ((start_1, start_2))\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 'static [\u0026 'static str] = \u0026 [\n\t\t\"Player 1 starting position: 4\",\n\t\t\"Player 2 starting position: 8\",\n\t];\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (739785, logic::part_one (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (444356092776315, logic::part_two (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":7,"address":[58281,58745],"length":1,"stats":{"Line":0},"fn_name":null},{"line":11,"address":[58366],"length":1,"stats":{"Line":0},"fn_name":null},{"line":12,"address":[58830],"length":1,"stats":{"Line":0},"fn_name":null},{"line":20,"address":[31520],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":21,"address":[31734,31559],"length":1,"stats":{"Line":1},"fn_name":null},{"line":22,"address":[31657],"length":1,"stats":{"Line":1},"fn_name":null},{"line":23,"address":[31667],"length":1,"stats":{"Line":1},"fn_name":null},{"line":24,"address":[31679],"length":1,"stats":{"Line":3},"fn_name":null},{"line":25,"address":[53419,53358],"length":1,"stats":{"Line":1},"fn_name":null},{"line":26,"address":[53504,53395,53459],"length":1,"stats":{"Line":2},"fn_name":null},{"line":27,"address":[53549,53479,53561],"length":1,"stats":{"Line":2},"fn_name":null},{"line":31,"address":[31887],"length":1,"stats":{"Line":1},"fn_name":null},{"line":32,"address":[31711,31836,31804],"length":1,"stats":{"Line":2},"fn_name":null},{"line":33,"address":[31821,31870,31949],"length":1,"stats":{"Line":2},"fn_name":null},{"line":35,"address":[31947],"length":1,"stats":{"Line":1},"fn_name":null},{"line":36,"address":[31979],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[32199],"length":1,"stats":{"Line":3},"fn_name":null},{"line":38,"address":[32291],"length":1,"stats":{"Line":1},"fn_name":null},{"line":39,"address":[32539,32421],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[32527,32574],"length":1,"stats":{"Line":2},"fn_name":null},{"line":43,"address":[32582,32646],"length":1,"stats":{"Line":1},"fn_name":null},{"line":44,"address":[32784,32681,32620],"length":1,"stats":{"Line":2},"fn_name":null},{"line":47,"address":[32816,36634],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":48,"address":[32855,33083],"length":1,"stats":{"Line":1},"fn_name":null},{"line":55,"address":[32952],"length":1,"stats":{"Line":1},"fn_name":null},{"line":58,"address":[33060],"length":1,"stats":{"Line":1},"fn_name":null},{"line":59,"address":[33153],"length":1,"stats":{"Line":1},"fn_name":null},{"line":60,"address":[33200],"length":1,"stats":{"Line":1},"fn_name":null},{"line":61,"address":[33382],"length":1,"stats":{"Line":1},"fn_name":null},{"line":62,"address":[33740],"length":1,"stats":{"Line":1},"fn_name":null},{"line":63,"address":[33860,34180],"length":1,"stats":{"Line":2},"fn_name":null},{"line":64,"address":[34226],"length":1,"stats":{"Line":1},"fn_name":null},{"line":65,"address":[34340],"length":1,"stats":{"Line":1},"fn_name":null},{"line":68,"address":[34390,34193,34491],"length":1,"stats":{"Line":2},"fn_name":null},{"line":69,"address":[34532,34631,34455],"length":1,"stats":{"Line":2},"fn_name":null},{"line":70,"address":[34581],"length":1,"stats":{"Line":1},"fn_name":null},{"line":71,"address":[34601,34750,34665],"length":1,"stats":{"Line":2},"fn_name":null},{"line":72,"address":[34955,34724,34790],"length":1,"stats":{"Line":2},"fn_name":null},{"line":73,"address":[35003,34936,35012],"length":1,"stats":{"Line":2},"fn_name":null},{"line":74,"address":[35005],"length":1,"stats":{"Line":1},"fn_name":null},{"line":75,"address":[35496,35278],"length":1,"stats":{"Line":1},"fn_name":null},{"line":76,"address":[35089],"length":1,"stats":{"Line":1},"fn_name":null},{"line":77,"address":[35538,35547,35463],"length":1,"stats":{"Line":2},"fn_name":null},{"line":80,"address":[35627,35587,35053],"length":1,"stats":{"Line":2},"fn_name":null},{"line":81,"address":[35668,35612],"length":1,"stats":{"Line":2},"fn_name":null},{"line":82,"address":[36546],"length":1,"stats":{"Line":1},"fn_name":null},{"line":83,"address":[35742,36166],"length":1,"stats":{"Line":2},"fn_name":null},{"line":84,"address":[36045,35765],"length":1,"stats":{"Line":2},"fn_name":null},{"line":86,"address":[36279,36447],"length":1,"stats":{"Line":2},"fn_name":null},{"line":87,"address":[36297],"length":1,"stats":{"Line":1},"fn_name":null},{"line":90,"address":[36601,36561],"length":1,"stats":{"Line":1},"fn_name":null},{"line":95,"address":[35846],"length":1,"stats":{"Line":1},"fn_name":null},{"line":98,"address":[35937],"length":1,"stats":{"Line":1},"fn_name":null},{"line":100,"address":[33903],"length":1,"stats":{"Line":1},"fn_name":null},{"line":109,"address":[55568],"length":1,"stats":{"Line":2},"fn_name":"parse_input"},{"line":111,"address":[55643,55611],"length":1,"stats":{"Line":2},"fn_name":null},{"line":112,"address":[55772,55622],"length":1,"stats":{"Line":4},"fn_name":null},{"line":113,"address":[56125,55818,56045],"length":1,"stats":{"Line":4},"fn_name":null},{"line":114,"address":[56325,56100,56243],"length":1,"stats":{"Line":4},"fn_name":null},{"line":115,"address":[56451,56296],"length":1,"stats":{"Line":4},"fn_name":null},{"line":116,"address":[56732,56502,56824],"length":1,"stats":{"Line":4},"fn_name":null},{"line":117,"address":[56796,57053,56945],"length":1,"stats":{"Line":4},"fn_name":null},{"line":118,"address":[57006],"length":1,"stats":{"Line":2},"fn_name":null},{"line":134,"address":[68505,68496],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":135,"address":[85431,85191],"length":1,"stats":{"Line":1},"fn_name":null},{"line":136,"address":[85411],"length":1,"stats":{"Line":1},"fn_name":null},{"line":140,"address":[68553,68544],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":141,"address":[85749,85479],"length":1,"stats":{"Line":1},"fn_name":null},{"line":142,"address":[85729],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":66,"coverable":69},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-22","lib.rs"],"content":"//! Advent of Code 2021 day 22: Reactor Reboot\n//!\n//! [https://adventofcode.com/2021/day/22](https://adventofcode.com/2021/day/22)\n//!\n//! This uses a slightly unintuitive algorithm to count up the activated locations. Instead of\n//! splitting up cubes to enusre they never intersect, we simply add them all together, then keep\n//! track of where they overlapped. Every time we overlap we track the overlapping section as well,\n//! but we add it up as the negative. If we overlap a negative we add it again as a positive.\n//!\n//! To make part two quicker, we split the referenced area up into a 10×10×10 grid and calculate\n//! the value for each section individually. This drastically cuts down on the number of\n//! intersections we need to make.\n\nuse aoc_common::*;\n\npuzzle! {\n\tname = \"Reactor Reboot\";\n\tyear = 2021;\n\tday = 22;\n\tpart_one = |lines| logic::calc_result_part_one (lines);\n\tpart_two = |lines| logic::calc_result_part_two (lines);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Cube;\n\tuse model::Step;\n\n\tpub const BOUND_50: Cube = Cube { x0: -50, y0: -50, z0: -50, x1: 51, y1: 51, z1: 51 };\n\n\tpub fn calc_result_part_one (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003ci64\u003e {\n\t\tlet input = model::parse_input (lines) ?;\n\t\tlet steps = bound_steps (\u0026 input, BOUND_50);\n\t\tOk (calc_result (\u0026 steps))\n\t}\n\n\tpub fn calc_result_part_two (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003ci64\u003e {\n\t\tlet input = model::parse_input (lines) ?;\n\t\tOk (calc_result_with_splits (\u0026 input, 10))\n\t}\n\n\tpub fn calc_result_with_splits (steps: \u0026 [Step], num_splits: i32) -\u003e i64 {\n\t\tlet bound = steps.iter ().copied ().fold (Cube::ZERO, |bound, step| Cube {\n\t\t\tx0: cmp::min (bound.x0, step.cube.x0),\n\t\t\tx1: cmp::max (bound.x1, step.cube.x1),\n\t\t\ty0: cmp::min (bound.y0, step.cube.y0),\n\t\t\ty1: cmp::max (bound.y1, step.cube.y1),\n\t\t\tz0: cmp::min (bound.z0, step.cube.z0),\n\t\t\tz1: cmp::max (bound.z1, step.cube.z1),\n\t\t});\n\t\tlet x_bounds: Vec \u003c_\u003e = (0 .. num_splits).map (|idx| Cube {\n\t\t\tx0: bound.x0 + (bound.x1 - bound.x0) * idx / num_splits,\n\t\t\tx1: bound.x0 + (bound.x1 - bound.x0) * (idx + 1) / num_splits,\n\t\t\t.. bound\n\t\t}).collect ();\n\t\tlet y_bounds: Vec \u003c_\u003e = (0 .. num_splits).map (|idx| Cube {\n\t\t\ty0: bound.y0 + (bound.y1 - bound.y0) * idx / num_splits,\n\t\t\ty1: bound.y0 + (bound.y1 - bound.y0) * (idx + 1) / num_splits,\n\t\t\t.. bound\n\t\t}).collect ();\n\t\tlet z_bounds: Vec \u003c_\u003e = (0 .. num_splits).map (|idx| Cube {\n\t\t\tz0: bound.z0 + (bound.z1 - bound.z0) * idx / num_splits,\n\t\t\tz1: bound.z0 + (bound.z1 - bound.z0) * (idx + 1) / num_splits,\n\t\t\t.. bound\n\t\t}).collect ();\n\t\tlet mut total = 0;\n\t\tfor x_bound in x_bounds.iter ().copied () {\n\t\t\tlet steps = bound_steps (\u0026 steps, x_bound);\n\t\t\tfor y_bound in y_bounds.iter ().copied () {\n\t\t\t\tlet steps = bound_steps (\u0026 steps, y_bound);\n\t\t\t\tfor z_bound in z_bounds.iter ().copied () {\n\t\t\t\t\tlet steps = bound_steps (\u0026 steps, z_bound);\n\t\t\t\t\ttotal += calc_result (\u0026 steps);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\ttotal\n\t}\n\n\tpub fn calc_result (steps: \u0026 [Step]) -\u003e i64 {\n\t\tlet mut core: Vec \u003c(Cube, bool)\u003e = Vec::new ();\n\t\tlet mut buffer: Vec \u003c(Cube, bool)\u003e = Vec::new ();\n\t\tfor step in steps.iter () {\n\t\t\tif step.state {\n\t\t\t\tbuffer.push ((step.cube, true));\n\t\t\t}\n\t\t\tfor (core_cube, core_state) in core.iter ().cloned () {\n\t\t\t\tif let Some (intersect) = core_cube.intersect (step.cube) {\n\t\t\t\t\tbuffer.push ((intersect, ! core_state));\n\t\t\t\t}\n\t\t\t}\n\t\t\tcore.extend (buffer.drain ( .. ));\n\t\t}\n\t\tcore.iter ().cloned ()\n\t\t\t.map (|(cube, state)| cube.volume () * if state { 1 } else { -1 })\n\t\t\t.sum::\u003ci64\u003e ()\n\t}\n\n\tfn bound_steps (steps: \u0026 [Step], bound: Cube) -\u003e Vec \u003cStep\u003e {\n\t\tsteps.iter ().cloned ().filter_map (\n\t\t\t|mut step| step.cube.intersect (bound).map (|cube| { step.cube = cube; step }),\n\t\t).collect ()\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\n\tpub fn parse_input (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cVec \u003cStep\u003e\u003e {\n\t\tlet err = || format! (\"Invalid input\");\n\t\tlines.iter ().enumerate ().map (|(line_idx, line)| {\n\t\t\tlet mut parser = parser::Parser::new (line, |char_idx|\n\t\t\t\tformat! (\"Invalid input: line {}: char {}: {}\", line_idx + 1, char_idx + 1, line));\n\t\t\tlet state = match parser.word () ? {\n\t\t\t\t\"on\" =\u003e true,\n\t\t\t\t\"off\" =\u003e false,\n\t\t\t\t_ =\u003e Err (err ()) ?,\n\t\t\t};\n\t\t\tlet cube = Cube {\n\t\t\t\tx0: parser.expect (\"x=\") ?.int () ?,\n\t\t\t\tx1: parser.expect (\"..\") ?.int::\u003ci32\u003e () ? + 1,\n\t\t\t\ty0: parser.expect (\",y=\") ?.int () ?,\n\t\t\t\ty1: parser.expect (\"..\") ?.int::\u003ci32\u003e () ? + 1,\n\t\t\t\tz0: parser.expect (\",z=\") ?.int () ?,\n\t\t\t\tz1: parser.expect (\"..\") ?.int::\u003ci32\u003e () ? + 1,\n\t\t\t};\n\t\t\tparser.end () ?;\n\t\t\tOk (Step { state, cube })\n\t\t}).collect ()\n\t}\n\n\t#[ derive (Clone, Copy, Debug) ]\n\tpub struct Step {\n\t\tpub state: bool,\n\t\tpub cube: Cube,\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, Hash, PartialEq) ]\n\tpub struct Cube {\n\t\tpub x0: i32, pub x1: i32,\n\t\tpub y0: i32, pub y1: i32,\n\t\tpub z0: i32, pub z1: i32,\n\t}\n\n\timpl Cube {\n\t\tpub fn overlaps (self, other: Cube) -\u003e bool {\n\t\t\tself.x0 \u003c other.x1 \u0026\u0026 other.x0 \u003c self.x1\n\t\t\t\t\u0026\u0026 self.y0 \u003c other.y1 \u0026\u0026 other.y0 \u003c self.y1\n\t\t\t\t\u0026\u0026 self.z0 \u003c other.z1 \u0026\u0026 other.z0 \u003c self.z1\n\t\t}\n\t\tpub fn intersect (self, other: Cube) -\u003e Option \u003cCube\u003e {\n\t\t\tif self.overlaps (other) {\n\t\t\t\tSome (Cube {\n\t\t\t\t\tx0: cmp::max (self.x0, other.x0),\n\t\t\t\t\tx1: cmp::min (self.x1, other.x1),\n\t\t\t\t\ty0: cmp::max (self.y0, other.y0),\n\t\t\t\t\ty1: cmp::min (self.y1, other.y1),\n\t\t\t\t\tz0: cmp::max (self.z0, other.z0),\n\t\t\t\t\tz1: cmp::min (self.z1, other.z1),\n\t\t\t\t})\n\t\t\t} else { None }\n\t\t}\n\t\tpub fn volume (self) -\u003e i64 {\n\t\t\t(self.x1 as i64 - self.x0 as i64)\n\t\t\t\t* (self.y1 as i64 - self.y0 as i64)\n\t\t\t\t* (self.z1 as i64 - self.z0 as i64)\n\t\t}\n\t\tpub const ZERO: Cube = Cube { x0: 0, x1: 0, y0: 0, y1: 0, z0: 0, z1: 0 };\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, Hash, Ord, PartialEq, PartialOrd) ]\n\tpub struct Pos { pub z: i32, pub y: i32, pub x: i32 }\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE_0: \u0026 [\u0026 str] = \u0026 [\n\t\t\"on x=10..12,y=10..12,z=10..12\",\n\t\t\"on x=11..13,y=11..13,z=11..13\",\n\t\t\"off x=9..11,y=9..11,z=9..11\",\n\t\t\"on x=10..10,y=10..10,z=10..10\",\n\t];\n\n\tconst EXAMPLE_1: \u0026 [\u0026 str] = \u0026 [\n\t\t\"on x=-20..26,y=-36..17,z=-47..7\",\n\t\t\"on x=-20..33,y=-21..23,z=-26..28\",\n\t\t\"on x=-22..28,y=-29..23,z=-38..16\",\n\t\t\"on x=-46..7,y=-6..46,z=-50..-1\",\n\t\t\"on x=-49..1,y=-3..46,z=-24..28\",\n\t\t\"on x=2..47,y=-22..22,z=-23..27\",\n\t\t\"on x=-27..23,y=-28..26,z=-21..29\",\n\t\t\"on x=-39..5,y=-6..47,z=-3..44\",\n\t\t\"on x=-30..21,y=-8..43,z=-13..34\",\n\t\t\"on x=-22..26,y=-27..20,z=-29..19\",\n\t\t\"off x=-48..-32,y=26..41,z=-47..-37\",\n\t\t\"on x=-12..35,y=6..50,z=-50..-2\",\n\t\t\"off x=-48..-32,y=-32..-16,z=-15..-5\",\n\t\t\"on x=-18..26,y=-33..15,z=-7..46\",\n\t\t\"off x=-40..-22,y=-38..-28,z=23..41\",\n\t\t\"on x=-16..35,y=-41..10,z=-47..6\",\n\t\t\"off x=-32..-23,y=11..30,z=-14..3\",\n\t\t\"on x=-49..-5,y=-3..45,z=-29..18\",\n\t\t\"off x=18..30,y=-20..-8,z=-3..13\",\n\t\t\"on x=-41..9,y=-7..43,z=-33..15\",\n\t\t\"on x=-54112..-39298,y=-85059..-49293,z=-27449..7877\",\n\t\t\"on x=967..23432,y=45373..81175,z=27513..53682\",\n\t];\n\n\tconst EXAMPLE_2: \u0026 [\u0026 str] = \u0026 [\n\t\t\"on x=-5..47,y=-31..22,z=-19..33\",\n\t\t\"on x=-44..5,y=-27..21,z=-14..35\",\n\t\t\"on x=-49..-1,y=-11..42,z=-10..38\",\n\t\t\"on x=-20..34,y=-40..6,z=-44..1\",\n\t\t\"off x=26..39,y=40..50,z=-2..11\",\n\t\t\"on x=-41..5,y=-41..6,z=-36..8\",\n\t\t\"off x=-43..-33,y=-45..-28,z=7..25\",\n\t\t\"on x=-33..15,y=-32..19,z=-34..11\",\n\t\t\"off x=35..47,y=-46..-34,z=-11..5\",\n\t\t\"on x=-14..36,y=-6..44,z=-16..29\",\n\t\t\"on x=-57795..-6158,y=29564..72030,z=20435..90618\",\n\t\t\"on x=36731..105352,y=-21140..28532,z=16094..90401\",\n\t\t\"on x=30999..107136,y=-53464..15513,z=8553..71215\",\n\t\t\"on x=13528..83982,y=-99403..-27377,z=-24141..23996\",\n\t\t\"on x=-72682..-12347,y=18159..111354,z=7391..80950\",\n\t\t\"on x=-1060..80757,y=-65301..-20884,z=-103788..-16709\",\n\t\t\"on x=-83015..-9461,y=-72160..-8347,z=-81239..-26856\",\n\t\t\"on x=-52752..22273,y=-49450..9096,z=54442..119054\",\n\t\t\"on x=-29982..40483,y=-108474..-28371,z=-24328..38471\",\n\t\t\"on x=-4958..62750,y=40422..118853,z=-7672..65583\",\n\t\t\"on x=55694..108686,y=-43367..46958,z=-26781..48729\",\n\t\t\"on x=-98497..-18186,y=-63569..3412,z=1232..88485\",\n\t\t\"on x=-726..56291,y=-62629..13224,z=18033..85226\",\n\t\t\"on x=-110886..-34664,y=-81338..-8658,z=8914..63723\",\n\t\t\"on x=-55829..24974,y=-16897..54165,z=-121762..-28058\",\n\t\t\"on x=-65152..-11147,y=22489..91432,z=-58782..1780\",\n\t\t\"on x=-120100..-32970,y=-46592..27473,z=-11695..61039\",\n\t\t\"on x=-18631..37533,y=-124565..-50804,z=-35667..28308\",\n\t\t\"on x=-57817..18248,y=49321..117703,z=5745..55881\",\n\t\t\"on x=14781..98692,y=-1341..70827,z=15753..70151\",\n\t\t\"on x=-34419..55919,y=-19626..40991,z=39015..114138\",\n\t\t\"on x=-60785..11593,y=-56135..2999,z=-95368..-26915\",\n\t\t\"on x=-32178..58085,y=17647..101866,z=-91405..-8878\",\n\t\t\"on x=-53655..12091,y=50097..105568,z=-75335..-4862\",\n\t\t\"on x=-111166..-40997,y=-71714..2688,z=5609..50954\",\n\t\t\"on x=-16602..70118,y=-98693..-44401,z=5197..76897\",\n\t\t\"on x=16383..101554,y=4615..83635,z=-44907..18747\",\n\t\t\"off x=-95822..-15171,y=-19987..48940,z=10804..104439\",\n\t\t\"on x=-89813..-14614,y=16069..88491,z=-3297..45228\",\n\t\t\"on x=41075..99376,y=-20427..49978,z=-52012..13762\",\n\t\t\"on x=-21330..50085,y=-17944..62733,z=-112280..-30197\",\n\t\t\"on x=-16478..35915,y=36008..118594,z=-7885..47086\",\n\t\t\"off x=-98156..-27851,y=-49952..43171,z=-99005..-8456\",\n\t\t\"off x=2032..69770,y=-71013..4824,z=7471..94418\",\n\t\t\"on x=43670..120875,y=-42068..12382,z=-24787..38892\",\n\t\t\"off x=37514..111226,y=-45862..25743,z=-16714..54663\",\n\t\t\"off x=25699..97951,y=-30668..59918,z=-15349..69697\",\n\t\t\"off x=-44271..17935,y=-9516..60759,z=49131..112598\",\n\t\t\"on x=-61695..-5813,y=40978..94975,z=8655..80240\",\n\t\t\"off x=-101086..-9439,y=-7088..67543,z=33935..83858\",\n\t\t\"off x=18020..114017,y=-48931..32606,z=21474..89843\",\n\t\t\"off x=-77139..10506,y=-89994..-18797,z=-80..59318\",\n\t\t\"off x=8476..79288,y=-75520..11602,z=-96624..-24783\",\n\t\t\"on x=-47488..-1262,y=24338..100707,z=16292..72967\",\n\t\t\"off x=-84341..13987,y=2429..92914,z=-90671..-1318\",\n\t\t\"off x=-37810..49457,y=-71013..-7894,z=-105357..-13188\",\n\t\t\"off x=-27365..46395,y=31009..98017,z=15428..76570\",\n\t\t\"off x=-70369..-16548,y=22648..78696,z=-1892..86821\",\n\t\t\"on x=-53470..21291,y=-120233..-33476,z=-44150..38147\",\n\t\t\"off x=-93533..-4276,y=-16170..68771,z=-104985..-24507\",\n\t];\n\n\t#[ test ]\n\tfn part_one_0 () {\n\t\tassert_eq! (39, logic::calc_result_part_one (EXAMPLE_0).unwrap ());\n\t}\n\n\t#[ test ]\n\tfn part_one_1 () {\n\t\tassert_eq! (590784, logic::calc_result_part_one (EXAMPLE_1).unwrap ());\n\t}\n\n\t#[ test ]\n\tfn part_two () {\n\t\tassert_eq! (2758514936282235, logic::calc_result_part_two (EXAMPLE_2).unwrap ());\n\t}\n\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-22","src","lib.rs"],"content":"//! Advent of Code 2021: Day 22: Reactor Reboot\n//!\n//! [https://adventofcode.com/2021/day/22](https://adventofcode.com/2021/day/22)\n//!\n//! This uses a slightly unintuitive algorithm to count up the activated locations. Instead of\n//! splitting up cubes to enusre they never intersect, we simply add them all together, then keep\n//! track of where they overlapped. Every time we overlap we track the overlapping section as well,\n//! but we add it up as the negative. If we overlap a negative we add it again as a positive.\n//!\n//! To make part two quicker, we split the referenced area up into a 10×10×10 grid and calculate\n//! the value for each section individually. This drastically cuts down on the number of\n//! intersections we need to make.\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Reactor Reboot\";\n\tyear = 2021;\n\tday = 22;\n\tpart_one = |lines| logic::part_one (lines);\n\tpart_two = |lines| logic::part_two (lines);\n}\n\npub mod logic {\n\n\tuse super::*;\n\tuse model::Cube;\n\tuse model::Step;\n\n\tpub const BOUND_50: Cube = Cube { x0: -50, y0: -50, z0: -50, x1: 51, y1: 51, z1: 51 };\n\n\tpub fn part_one (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003ci64\u003e {\n\t\tlet input = model::parse_input (lines) ?;\n\t\tlet steps = bound_steps (\u0026 input, BOUND_50);\n\t\tOk (calc_result (\u0026 steps))\n\t}\n\n\tpub fn part_two (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003ci64\u003e {\n\t\tlet input = model::parse_input (lines) ?;\n\t\tOk (calc_result_with_splits (\u0026 input, 10))\n\t}\n\n\t#[ must_use ]\n\tpub fn calc_result_with_splits (steps: \u0026 [Step], num_splits: i32) -\u003e i64 {\n\t\tlet bound = steps.iter ().copied ().fold (Cube::ZERO, |bound, step| Cube {\n\t\t\tx0: cmp::min (bound.x0, step.cube.x0),\n\t\t\tx1: cmp::max (bound.x1, step.cube.x1),\n\t\t\ty0: cmp::min (bound.y0, step.cube.y0),\n\t\t\ty1: cmp::max (bound.y1, step.cube.y1),\n\t\t\tz0: cmp::min (bound.z0, step.cube.z0),\n\t\t\tz1: cmp::max (bound.z1, step.cube.z1),\n\t\t});\n\t\tlet x_bounds: Vec \u003c_\u003e = (0_i32 .. num_splits).map (|idx| Cube {\n\t\t\tx0: bound.x0 + (bound.x1 - bound.x0) * idx / num_splits,\n\t\t\tx1: bound.x0 + (bound.x1 - bound.x0) * (idx + 1) / num_splits,\n\t\t\t.. bound\n\t\t}).collect ();\n\t\tlet y_bounds: Vec \u003c_\u003e = (0_i32 .. num_splits).map (|idx| Cube {\n\t\t\ty0: bound.y0 + (bound.y1 - bound.y0) * idx / num_splits,\n\t\t\ty1: bound.y0 + (bound.y1 - bound.y0) * (idx + 1) / num_splits,\n\t\t\t.. bound\n\t\t}).collect ();\n\t\tlet z_bounds: Vec \u003c_\u003e = (0_i32 .. num_splits).map (|idx| Cube {\n\t\t\tz0: bound.z0 + (bound.z1 - bound.z0) * idx / num_splits,\n\t\t\tz1: bound.z0 + (bound.z1 - bound.z0) * (idx + 1) / num_splits,\n\t\t\t.. bound\n\t\t}).collect ();\n\t\tlet mut total = 0;\n\t\tfor x_bound in x_bounds.iter ().copied () {\n\t\t\tlet steps = bound_steps (steps, x_bound);\n\t\t\tfor y_bound in y_bounds.iter ().copied () {\n\t\t\t\tlet steps = bound_steps (\u0026 steps, y_bound);\n\t\t\t\tfor z_bound in z_bounds.iter ().copied () {\n\t\t\t\t\tlet steps = bound_steps (\u0026 steps, z_bound);\n\t\t\t\t\ttotal += calc_result (\u0026 steps);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\ttotal\n\t}\n\n\t#[ must_use ]\n\tpub fn calc_result (steps: \u0026 [Step]) -\u003e i64 {\n\t\tlet mut core: Vec \u003c(Cube, bool)\u003e = Vec::new ();\n\t\tlet mut buffer: Vec \u003c(Cube, bool)\u003e = Vec::new ();\n\t\tfor step in steps.iter () {\n\t\t\tif step.state {\n\t\t\t\tbuffer.push ((step.cube, true));\n\t\t\t}\n\t\t\tfor (core_cube, core_state) in core.iter_vals () {\n\t\t\t\tif let Some (intersect) = core_cube.intersect (step.cube) {\n\t\t\t\t\tbuffer.push ((intersect, ! core_state));\n\t\t\t\t}\n\t\t\t}\n\t\t\tcore.append (\u0026 mut buffer);\n\t\t}\n\t\tcore.iter_vals ()\n\t\t\t.map (|(cube, state)| cube.volume () * if state { 1 } else { -1 })\n\t\t\t.sum::\u003ci64\u003e ()\n\t}\n\n\tfn bound_steps (steps: \u0026 [Step], bound: Cube) -\u003e Vec \u003cStep\u003e {\n\t\tsteps.iter ().copied ().filter_map (\n\t\t\t|mut step| step.cube.intersect (bound).map (|cube| { step.cube = cube; step }),\n\t\t).collect ()\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse nums::IntConv;\n\n\tpub fn parse_input (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cVec \u003cStep\u003e\u003e {\n\t\tuse parser::*;\n\t\tlines.iter ().enumerate ().map (|(line_idx, line)|\n\t\t\tParser::wrap (line, |parser| {\n\t\t\t\tparser.set_ignore_whitespace (true);\n\t\t\t\tlet state = match parser.word () ? {\n\t\t\t\t\t\"on\" =\u003e true,\n\t\t\t\t\t\"off\" =\u003e false,\n\t\t\t\t\t_ =\u003e Err (parser.err ()) ?,\n\t\t\t\t};\n\t\t\t\tlet cube = Cube {\n\t\t\t\t\tx0: parser.expect (\"x=\") ?.int () ?,\n\t\t\t\t\tx1: parser.expect (\"..\") ?.int::\u003ci32\u003e () ? + 1,\n\t\t\t\t\ty0: parser.expect (\",y=\") ?.int () ?,\n\t\t\t\t\ty1: parser.expect (\"..\") ?.int::\u003ci32\u003e () ? + 1,\n\t\t\t\t\tz0: parser.expect (\",z=\") ?.int () ?,\n\t\t\t\t\tz1: parser.expect (\"..\") ?.int::\u003ci32\u003e () ? + 1,\n\t\t\t\t};\n\t\t\t\tparser.end () ?;\n\t\t\t\tOk (Step { state, cube })\n\t\t\t}).map_parse_err (|char_idx|\n\t\t\t\tformat! (\"Invalid input: line {}: char {}: {}\", line_idx + 1, char_idx + 1, line))\n\t\t).collect ()\n\t}\n\n\t#[ derive (Clone, Copy, Debug) ]\n\tpub struct Step {\n\t\tpub state: bool,\n\t\tpub cube: Cube,\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, Hash, PartialEq) ]\n\tpub struct Cube {\n\t\tpub x0: i32, pub x1: i32,\n\t\tpub y0: i32, pub y1: i32,\n\t\tpub z0: i32, pub z1: i32,\n\t}\n\n\timpl Cube {\n\n\t\t#[ must_use ]\n\t\tpub const fn overlaps (self, other: Self) -\u003e bool {\n\t\t\tself.x0 \u003c other.x1 \u0026\u0026 other.x0 \u003c self.x1\n\t\t\t\t\u0026\u0026 self.y0 \u003c other.y1 \u0026\u0026 other.y0 \u003c self.y1\n\t\t\t\t\u0026\u0026 self.z0 \u003c other.z1 \u0026\u0026 other.z0 \u003c self.z1\n\t\t}\n\n\t\t#[ must_use ]\n\t\tpub fn intersect (self, other: Self) -\u003e Option \u003cSelf\u003e {\n\t\t\tself.overlaps (other).then_some (Self {\n\t\t\t\tx0: cmp::max (self.x0, other.x0),\n\t\t\t\tx1: cmp::min (self.x1, other.x1),\n\t\t\t\ty0: cmp::max (self.y0, other.y0),\n\t\t\t\ty1: cmp::min (self.y1, other.y1),\n\t\t\t\tz0: cmp::max (self.z0, other.z0),\n\t\t\t\tz1: cmp::min (self.z1, other.z1),\n\t\t\t} )\n\t\t}\n\n\t\t#[ must_use ]\n\t\tpub fn volume (self) -\u003e i64 {\n\t\t\t(self.x1.as_i64 () - self.x0.as_i64 ())\n\t\t\t\t* (self.y1.as_i64 () - self.y0.as_i64 ())\n\t\t\t\t* (self.z1.as_i64 () - self.z0.as_i64 ())\n\t\t}\n\n\t\tpub const ZERO: Self = Self { x0: 0, x1: 0, y0: 0, y1: 0, z0: 0, z1: 0 };\n\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, Hash, Ord, PartialEq, PartialOrd) ]\n\tpub struct Pos { pub z: i32, pub y: i32, pub x: i32 }\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE_0: \u0026 [\u0026 str] = \u0026 [\n\t\t\"on x=10..12,y=10..12,z=10..12\",\n\t\t\"on x=11..13,y=11..13,z=11..13\",\n\t\t\"off x=9..11,y=9..11,z=9..11\",\n\t\t\"on x=10..10,y=10..10,z=10..10\",\n\t];\n\n\tconst EXAMPLE_1: \u0026 [\u0026 str] = \u0026 [\n\t\t\"on x=-20..26,y=-36..17,z=-47..7\",\n\t\t\"on x=-20..33,y=-21..23,z=-26..28\",\n\t\t\"on x=-22..28,y=-29..23,z=-38..16\",\n\t\t\"on x=-46..7,y=-6..46,z=-50..-1\",\n\t\t\"on x=-49..1,y=-3..46,z=-24..28\",\n\t\t\"on x=2..47,y=-22..22,z=-23..27\",\n\t\t\"on x=-27..23,y=-28..26,z=-21..29\",\n\t\t\"on x=-39..5,y=-6..47,z=-3..44\",\n\t\t\"on x=-30..21,y=-8..43,z=-13..34\",\n\t\t\"on x=-22..26,y=-27..20,z=-29..19\",\n\t\t\"off x=-48..-32,y=26..41,z=-47..-37\",\n\t\t\"on x=-12..35,y=6..50,z=-50..-2\",\n\t\t\"off x=-48..-32,y=-32..-16,z=-15..-5\",\n\t\t\"on x=-18..26,y=-33..15,z=-7..46\",\n\t\t\"off x=-40..-22,y=-38..-28,z=23..41\",\n\t\t\"on x=-16..35,y=-41..10,z=-47..6\",\n\t\t\"off x=-32..-23,y=11..30,z=-14..3\",\n\t\t\"on x=-49..-5,y=-3..45,z=-29..18\",\n\t\t\"off x=18..30,y=-20..-8,z=-3..13\",\n\t\t\"on x=-41..9,y=-7..43,z=-33..15\",\n\t\t\"on x=-54112..-39298,y=-85059..-49293,z=-27449..7877\",\n\t\t\"on x=967..23432,y=45373..81175,z=27513..53682\",\n\t];\n\n\tconst EXAMPLE_2: \u0026 [\u0026 str] = \u0026 [\n\t\t\"on x=-5..47,y=-31..22,z=-19..33\",\n\t\t\"on x=-44..5,y=-27..21,z=-14..35\",\n\t\t\"on x=-49..-1,y=-11..42,z=-10..38\",\n\t\t\"on x=-20..34,y=-40..6,z=-44..1\",\n\t\t\"off x=26..39,y=40..50,z=-2..11\",\n\t\t\"on x=-41..5,y=-41..6,z=-36..8\",\n\t\t\"off x=-43..-33,y=-45..-28,z=7..25\",\n\t\t\"on x=-33..15,y=-32..19,z=-34..11\",\n\t\t\"off x=35..47,y=-46..-34,z=-11..5\",\n\t\t\"on x=-14..36,y=-6..44,z=-16..29\",\n\t\t\"on x=-57795..-6158,y=29564..72030,z=20435..90618\",\n\t\t\"on x=36731..105352,y=-21140..28532,z=16094..90401\",\n\t\t\"on x=30999..107136,y=-53464..15513,z=8553..71215\",\n\t\t\"on x=13528..83982,y=-99403..-27377,z=-24141..23996\",\n\t\t\"on x=-72682..-12347,y=18159..111354,z=7391..80950\",\n\t\t\"on x=-1060..80757,y=-65301..-20884,z=-103788..-16709\",\n\t\t\"on x=-83015..-9461,y=-72160..-8347,z=-81239..-26856\",\n\t\t\"on x=-52752..22273,y=-49450..9096,z=54442..119054\",\n\t\t\"on x=-29982..40483,y=-108474..-28371,z=-24328..38471\",\n\t\t\"on x=-4958..62750,y=40422..118853,z=-7672..65583\",\n\t\t\"on x=55694..108686,y=-43367..46958,z=-26781..48729\",\n\t\t\"on x=-98497..-18186,y=-63569..3412,z=1232..88485\",\n\t\t\"on x=-726..56291,y=-62629..13224,z=18033..85226\",\n\t\t\"on x=-110886..-34664,y=-81338..-8658,z=8914..63723\",\n\t\t\"on x=-55829..24974,y=-16897..54165,z=-121762..-28058\",\n\t\t\"on x=-65152..-11147,y=22489..91432,z=-58782..1780\",\n\t\t\"on x=-120100..-32970,y=-46592..27473,z=-11695..61039\",\n\t\t\"on x=-18631..37533,y=-124565..-50804,z=-35667..28308\",\n\t\t\"on x=-57817..18248,y=49321..117703,z=5745..55881\",\n\t\t\"on x=14781..98692,y=-1341..70827,z=15753..70151\",\n\t\t\"on x=-34419..55919,y=-19626..40991,z=39015..114138\",\n\t\t\"on x=-60785..11593,y=-56135..2999,z=-95368..-26915\",\n\t\t\"on x=-32178..58085,y=17647..101866,z=-91405..-8878\",\n\t\t\"on x=-53655..12091,y=50097..105568,z=-75335..-4862\",\n\t\t\"on x=-111166..-40997,y=-71714..2688,z=5609..50954\",\n\t\t\"on x=-16602..70118,y=-98693..-44401,z=5197..76897\",\n\t\t\"on x=16383..101554,y=4615..83635,z=-44907..18747\",\n\t\t\"off x=-95822..-15171,y=-19987..48940,z=10804..104439\",\n\t\t\"on x=-89813..-14614,y=16069..88491,z=-3297..45228\",\n\t\t\"on x=41075..99376,y=-20427..49978,z=-52012..13762\",\n\t\t\"on x=-21330..50085,y=-17944..62733,z=-112280..-30197\",\n\t\t\"on x=-16478..35915,y=36008..118594,z=-7885..47086\",\n\t\t\"off x=-98156..-27851,y=-49952..43171,z=-99005..-8456\",\n\t\t\"off x=2032..69770,y=-71013..4824,z=7471..94418\",\n\t\t\"on x=43670..120875,y=-42068..12382,z=-24787..38892\",\n\t\t\"off x=37514..111226,y=-45862..25743,z=-16714..54663\",\n\t\t\"off x=25699..97951,y=-30668..59918,z=-15349..69697\",\n\t\t\"off x=-44271..17935,y=-9516..60759,z=49131..112598\",\n\t\t\"on x=-61695..-5813,y=40978..94975,z=8655..80240\",\n\t\t\"off x=-101086..-9439,y=-7088..67543,z=33935..83858\",\n\t\t\"off x=18020..114017,y=-48931..32606,z=21474..89843\",\n\t\t\"off x=-77139..10506,y=-89994..-18797,z=-80..59318\",\n\t\t\"off x=8476..79288,y=-75520..11602,z=-96624..-24783\",\n\t\t\"on x=-47488..-1262,y=24338..100707,z=16292..72967\",\n\t\t\"off x=-84341..13987,y=2429..92914,z=-90671..-1318\",\n\t\t\"off x=-37810..49457,y=-71013..-7894,z=-105357..-13188\",\n\t\t\"off x=-27365..46395,y=31009..98017,z=15428..76570\",\n\t\t\"off x=-70369..-16548,y=22648..78696,z=-1892..86821\",\n\t\t\"on x=-53470..21291,y=-120233..-33476,z=-44150..38147\",\n\t\t\"off x=-93533..-4276,y=-16170..68771,z=-104985..-24507\",\n\t];\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (39, logic::part_one (EXAMPLE_0) ?);\n\t\tassert_eq! (590784, logic::part_one (EXAMPLE_1) ?);\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (2758514936282235, logic::part_two (EXAMPLE_2) ?);\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":18,"address":[58329,58793],"length":1,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[58414],"length":1,"stats":{"Line":0},"fn_name":null},{"line":23,"address":[58878],"length":1,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[79741,79715,79280],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":35,"address":[79313,79439],"length":1,"stats":{"Line":1},"fn_name":null},{"line":36,"address":[79417,79539],"length":1,"stats":{"Line":2},"fn_name":null},{"line":37,"address":[79667,79600],"length":1,"stats":{"Line":2},"fn_name":null},{"line":40,"address":[79760,80060],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":41,"address":[79913,79793],"length":1,"stats":{"Line":1},"fn_name":null},{"line":42,"address":[79891,80015],"length":1,"stats":{"Line":2},"fn_name":null},{"line":46,"address":[82287,82328,80096],"length":1,"stats":{"Line":1},"fn_name":"calc_result_with_splits"},{"line":47,"address":[54476,54272],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":48,"address":[54301],"length":1,"stats":{"Line":1},"fn_name":null},{"line":49,"address":[54324],"length":1,"stats":{"Line":1},"fn_name":null},{"line":50,"address":[54349],"length":1,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[54374],"length":1,"stats":{"Line":1},"fn_name":null},{"line":52,"address":[54399],"length":1,"stats":{"Line":1},"fn_name":null},{"line":53,"address":[54424],"length":1,"stats":{"Line":1},"fn_name":null},{"line":55,"address":[55183,54512],"length":1,"stats":{"Line":3},"fn_name":"{closure#1}"},{"line":56,"address":[54544,54847],"length":1,"stats":{"Line":1},"fn_name":null},{"line":57,"address":[55233,54881,54814],"length":1,"stats":{"Line":2},"fn_name":null},{"line":60,"address":[55264,55938],"length":1,"stats":{"Line":4},"fn_name":"{closure#2}"},{"line":61,"address":[55296,55603],"length":1,"stats":{"Line":1},"fn_name":null},{"line":62,"address":[55568,55637,55988],"length":1,"stats":{"Line":2},"fn_name":null},{"line":65,"address":[56705,56032],"length":1,"stats":{"Line":4},"fn_name":"{closure#3}"},{"line":66,"address":[56064,56371],"length":1,"stats":{"Line":1},"fn_name":null},{"line":67,"address":[56756,56405,56336],"length":1,"stats":{"Line":2},"fn_name":null},{"line":70,"address":[80969],"length":1,"stats":{"Line":1},"fn_name":null},{"line":71,"address":[80989,81273,81065],"length":1,"stats":{"Line":3},"fn_name":null},{"line":72,"address":[81305],"length":1,"stats":{"Line":1},"fn_name":null},{"line":73,"address":[81368,81447,81639],"length":1,"stats":{"Line":3},"fn_name":null},{"line":74,"address":[81679],"length":1,"stats":{"Line":1},"fn_name":null},{"line":75,"address":[81992,81769,81836],"length":1,"stats":{"Line":3},"fn_name":null},{"line":76,"address":[82032],"length":1,"stats":{"Line":1},"fn_name":null},{"line":77,"address":[82122,82189,82255],"length":1,"stats":{"Line":2},"fn_name":null},{"line":85,"address":[83352,82368,83326],"length":1,"stats":{"Line":1},"fn_name":"calc_result"},{"line":86,"address":[82407],"length":1,"stats":{"Line":1},"fn_name":null},{"line":87,"address":[82428],"length":1,"stats":{"Line":1},"fn_name":null},{"line":88,"address":[82561,82491,82690],"length":1,"stats":{"Line":3},"fn_name":null},{"line":89,"address":[82711],"length":1,"stats":{"Line":1},"fn_name":null},{"line":90,"address":[82747],"length":1,"stats":{"Line":1},"fn_name":null},{"line":92,"address":[82965,82725,82845],"length":1,"stats":{"Line":3},"fn_name":null},{"line":93,"address":[83015],"length":1,"stats":{"Line":1},"fn_name":null},{"line":94,"address":[83154],"length":1,"stats":{"Line":1},"fn_name":null},{"line":97,"address":[82950,83257],"length":1,"stats":{"Line":2},"fn_name":null},{"line":99,"address":[83272,82670],"length":1,"stats":{"Line":2},"fn_name":null},{"line":100,"address":[56800,56809],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":104,"address":[83392],"length":1,"stats":{"Line":1},"fn_name":"bound_steps"},{"line":105,"address":[83505,83447],"length":1,"stats":{"Line":2},"fn_name":null},{"line":106,"address":[57015,57147,56992,57136],"length":1,"stats":{"Line":5},"fn_name":"{closure#0}"},{"line":117,"address":[40752],"length":1,"stats":{"Line":1},"fn_name":"parse_input"},{"line":119,"address":[70480,70589,70508],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":120,"address":[71270,70518,74161,70608,70564],"length":1,"stats":{"Line":5},"fn_name":"{closure#0}"},{"line":121,"address":[70654],"length":1,"stats":{"Line":1},"fn_name":null},{"line":122,"address":[70669,70782],"length":1,"stats":{"Line":1},"fn_name":null},{"line":123,"address":[70937,70898,70754],"length":1,"stats":{"Line":3},"fn_name":null},{"line":124,"address":[70914,70981,71007],"length":1,"stats":{"Line":3},"fn_name":null},{"line":125,"address":[70992,71014],"length":1,"stats":{"Line":0},"fn_name":null},{"line":127,"address":[73854],"length":1,"stats":{"Line":1},"fn_name":null},{"line":128,"address":[70947,71569,71475,71278],"length":1,"stats":{"Line":3},"fn_name":null},{"line":129,"address":[71690,71537,71887,72117],"length":1,"stats":{"Line":3},"fn_name":null},{"line":130,"address":[72344,72147,72090,72438],"length":1,"stats":{"Line":3},"fn_name":null},{"line":131,"address":[72406,72756,72559,72986],"length":1,"stats":{"Line":3},"fn_name":null},{"line":132,"address":[73016,73213,73307,72959],"length":1,"stats":{"Line":3},"fn_name":null},{"line":133,"address":[73275,73913,73428,73625],"length":1,"stats":{"Line":3},"fn_name":null},{"line":135,"address":[73943,74171,73898],"length":1,"stats":{"Line":2},"fn_name":null},{"line":136,"address":[73999],"length":1,"stats":{"Line":1},"fn_name":null},{"line":137,"address":[70544,74304,74685],"length":1,"stats":{"Line":1},"fn_name":"{closure#1}"},{"line":138,"address":[74347],"length":1,"stats":{"Line":0},"fn_name":null},{"line":158,"address":[40880],"length":1,"stats":{"Line":1},"fn_name":"overlaps"},{"line":159,"address":[40962,41076,41000,40893,41038],"length":1,"stats":{"Line":5},"fn_name":null},{"line":160,"address":[40953,40991],"length":1,"stats":{"Line":2},"fn_name":null},{"line":161,"address":[41067,41029],"length":1,"stats":{"Line":2},"fn_name":null},{"line":165,"address":[41104],"length":1,"stats":{"Line":1},"fn_name":"intersect"},{"line":166,"address":[41131,41384],"length":1,"stats":{"Line":2},"fn_name":null},{"line":167,"address":[41212],"length":1,"stats":{"Line":1},"fn_name":null},{"line":168,"address":[41235],"length":1,"stats":{"Line":1},"fn_name":null},{"line":169,"address":[41260],"length":1,"stats":{"Line":1},"fn_name":null},{"line":170,"address":[41285],"length":1,"stats":{"Line":1},"fn_name":null},{"line":171,"address":[41310],"length":1,"stats":{"Line":1},"fn_name":null},{"line":172,"address":[41335],"length":1,"stats":{"Line":1},"fn_name":null},{"line":177,"address":[41456],"length":1,"stats":{"Line":1},"fn_name":"volume"},{"line":178,"address":[41780,41627,41543,41838,41696,41465],"length":1,"stats":{"Line":3},"fn_name":null},{"line":179,"address":[41527,41578,41645],"length":1,"stats":{"Line":2},"fn_name":null},{"line":180,"address":[41731,41798,41680],"length":1,"stats":{"Line":2},"fn_name":null},{"line":293,"address":[31145,31136],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":294,"address":[88231,88490],"length":1,"stats":{"Line":1},"fn_name":null},{"line":295,"address":[88451,88534,88775],"length":1,"stats":{"Line":2},"fn_name":null},{"line":296,"address":[88751],"length":1,"stats":{"Line":1},"fn_name":null},{"line":300,"address":[31184,31193],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":301,"address":[89078,88839],"length":1,"stats":{"Line":1},"fn_name":null},{"line":302,"address":[89058],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":87,"coverable":92},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-23","src","lib.rs"],"content":"//! Advent of Code 2021: Day 23: Amphipod\n//!\n//! [https://adventofcode.com/2021/day/23](https://adventofcode.com/2021/day/23)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\nuse aoc_search as search;\n\npuzzle_info! {\n\tname = \"Amphipod\";\n\tyear = 2021;\n\tday = 23;\n\tpart_one = |lines| logic::part_one (lines);\n\tpart_two = |lines| logic::part_two (lines);\n\tcommands = [\n\t\t( name = \"run\"; method = tools::run; ),\n\t\t( name = \"internals\"; method = tools::internals; ),\n\t];\n}\n\nmod logic {\n\n\tuse super::*;\n\tuse model::Amph;\n\tuse model::Place;\n\tuse model::State;\n\tuse model::StateCompact;\n\tuse nums::IntConv;\n\tuse search::PrioritySearch;\n\tuse search::PrioritySearchAdder;\n\n\tpub fn part_one (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003ci64\u003e {\n\t\tlet input = State::parse (lines) ?;\n\t\tcalc_result (\u0026 input)\n\t}\n\n\tpub fn part_two (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003ci64\u003e {\n\t\tlet lines_modified = modify_input_for_part_two (lines);\n\t\tlet input = State::parse (\u0026 lines_modified) ?;\n\t\tcalc_result (\u0026 input)\n\t}\n\n\tpub fn modify_input_for_part_two \u003c'lin\u003e (lines: \u0026 [\u0026 'lin str]) -\u003e Vec \u003c\u0026 'lin str\u003e {\n\t\tvec! [\n\t\t\tlines [0],\n\t\t\tlines [1],\n\t\t\tlines [2],\n\t\t\t\"  #D#C#B#A#\",\n\t\t\t\"  #D#B#A#C#\",\n\t\t\tlines [3],\n\t\t\tlines [4],\n\t\t]\n\t}\n\n\tpub fn calc_result (input: \u0026 State) -\u003e GenResult \u003ci64\u003e {\n\t\tOk (\n\t\t\titerator (input)\n\t\t\t\t.filter (|\u0026 (ref state_compact, _)| state_compact.is_finished ())\n\t\t\t\t.map (|(_, score)| score)\n\t\t\t\t.next ()\n\t\t\t\t.ok_or (\"Failed to find solution\") ?\n\t\t)\n\t}\n\n\tpub fn iterator (input: \u0026 State) -\u003e impl Iterator \u003cItem = (StateCompact, i64)\u003e {\n\t\tlet mut search = PrioritySearch::with_hash_map (\n\t\t\t|state: StateCompact, score: i64, mut adder: PrioritySearchAdder \u003c'_, _, _, _\u003e| {\n\t\t\t\tfor (next_state, next_cost) in calc_next_states (state) {\n\t\t\t\t\tlet next_score = score + next_cost;\n\t\t\t\t\tadder.add (next_state, next_score);\n\t\t\t\t}\n\t\t\t\t(state, score)\n\t\t\t},\n\t\t);\n\t\tsearch.push (input.compact (), 0);\n\t\tsearch\n\t}\n\n\tpub fn calc_next_states (state_compact: StateCompact) -\u003e ArrayVec \u003c(StateCompact, i64), 28\u003e {\n\t\tlet state = state_compact.expand ();\n\n\t\tlet out_cost = |room| state.room_size () - state.room (room).len () + 1;\n\t\tlet in_cost = |room| state.room_size () - state.room (room).len ();\n\t\tlet hall_cost = |room: Amph, hall: Place|\n\t\t\tusize::abs_diff (2 + room.idx () * 2, hall.idx ());\n\n\t\tlet next_moves = calc_next_moves (\u0026 state);\n\t\tif next_moves.is_empty () { return ArrayVec::new () }\n\n\t\tlet blocking = (state.hall () [3], state.hall () [5], state.hall () [7]);\n\t\tuse Amph::{ Amber, Bronze, Copper, Desert };\n\t\tlet sections = [\n\t\t\t! matches! (blocking,\n\t\t\t\t(Some (Copper | Desert), _, _) |\n\t\t\t\t(_, Some (Bronze | Copper | Desert), _) |\n\t\t\t\t(_, _, Some (Desert))),\n\t\t\t! matches! (blocking,\n\t\t\t\t(Some (Amber), _, _) |\n\t\t\t\t(_, Some (Copper | Desert), _) |\n\t\t\t\t(_, _, Some (Desert))),\n\t\t\t! matches! (blocking,\n\t\t\t\t(Some (Amber), _, _) |\n\t\t\t\t(_, Some (Amber | Bronze), _) |\n\t\t\t\t(_, _, Some (Desert))),\n\t\t\t! matches! (blocking,\n\t\t\t\t(Some (Amber), _, _) |\n\t\t\t\t(_, Some (Amber | Bronze), _) |\n\t\t\t\t(_, _, Some (Amber | Bronze | Copper))),\n\t\t];\n\n\t\tlet mut next_states = ArrayVec::new ();\n\t\tfor next_move in next_moves.iter ().copied () {\n\t\t\tmatch next_move {\n\t\t\t\tMove::Between (amph, from_room, to_room) =\u003e {\n\t\t\t\t\tif ! sections [from_room.idx ()] || ! sections [to_room.idx ()] { continue }\n\t\t\t\t\tlet cost = amph.cost () * (out_cost (from_room) + in_cost (to_room)\n\t\t\t\t\t\t+ usize::abs_diff (from_room.idx (), to_room.idx ()) * 2).as_i64 ();\n\t\t\t\t\tlet next_state = state.move_between (from_room, to_room);\n\t\t\t\t\treturn iter::once ((next_state.compact (), cost)).collect ();\n\t\t\t\t},\n\t\t\t\tMove::In (amph, from_hall, to_room) =\u003e {\n\t\t\t\t\tif ! sections [to_room.idx ()] { continue }\n\t\t\t\t\tlet cost = amph.cost () * (in_cost (to_room) + hall_cost (to_room, from_hall)).as_i64 ();\n\t\t\t\t\tlet next_state = state.move_in (from_hall, to_room);\n\t\t\t\t\treturn iter::once ((next_state.compact (), cost)).collect ();\n\t\t\t\t},\n\t\t\t\tMove::Out (..) =\u003e (),\n\t\t\t}\n\t\t}\n\t\tfor next_move in next_moves.iter ().copied () {\n\t\t\tif let Move::Out (amph, from_room, to_hall) = next_move {\n\t\t\t\tif ! sections [from_room.idx ()] { continue }\n\t\t\t\tlet cost = amph.cost () * (out_cost (from_room)\n\t\t\t\t\t+ hall_cost (from_room, to_hall)).as_i64 ();\n\t\t\t\tlet next_state = state.move_out (from_room, to_hall);\n\t\t\t\tnext_states.push ((next_state.compact (), cost));\n\t\t\t}\n\t\t}\n\n\t\tnext_states\n\n\t}\n\n\t#[ derive (Clone, Copy) ]\n\tpub enum Move {\n\t\tOut (Amph, Amph, Place),\n\t\tIn (Amph, Place, Amph),\n\t\tBetween (Amph, Amph, Amph),\n\t}\n\n\tpub fn calc_next_moves (state: \u0026 State) -\u003e ArrayVec \u003cMove, 28\u003e {\n\t\tlet mut result = ArrayVec::new ();\n\t\tlet path_clear = |from: Place, to: Place|\n\t\t\tstate.hall ().iter ().enumerate ()\n\t\t\t\t.skip (cmp::min (to.idx (), from.idx ()))\n\t\t\t\t.take (usize::abs_diff (from.idx (), to.idx ()) + 1)\n\t\t\t\t.map (|(idx, amph)| (Place::for_idx (idx), amph))\n\t\t\t\t.filter (|\u0026 (hall, _)| hall != from)\n\t\t\t\t.all (|(_, amph)| amph.is_none ());\n\t\tlet room_entrance = |room: Amph| Place::for_idx (2 + room.idx () * 2);\n\t\tfor (idx, amph) in state.hall ().iter ().enumerate ()\n\t\t\t\t.filter_map (|(idx, amph)| amph.map (|amph| (idx, amph))) {\n\t\t\tlet to_room = amph;\n\t\t\tlet hall = Place::for_idx (idx);\n\t\t\tif ! state.room_is_happy (to_room) { continue }\n\t\t\tif ! path_clear (hall, room_entrance (to_room)) { continue }\n\t\t\tresult.clear ();\n\t\t\tresult.push (Move::In (amph, hall, to_room));\n\t\t\treturn result;\n\t\t}\n\t\tfor (from_room, amphs) in [\n\t\t\t(Amph::Amber, state.room (Amph::Amber)),\n\t\t\t(Amph::Bronze, state.room (Amph::Bronze)),\n\t\t\t(Amph::Copper, state.room (Amph::Copper)),\n\t\t\t(Amph::Desert, state.room (Amph::Desert)),\n\t\t] {\n\t\t\tif let Some (\u0026 amph) = amphs.last () {\n\t\t\t\tlet to_room = amph;\n\t\t\t\tif state.room_is_happy (from_room) { continue }\n\t\t\t\tif state.room_is_happy (to_room) {\n\t\t\t\t\tif ! path_clear (room_entrance (from_room), room_entrance (to_room)) { continue }\n\t\t\t\t\tresult.clear ();\n\t\t\t\t\tresult.push (Move::Between (amph, from_room, to_room));\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t\tfor hall in\n\t\t\t\t\titer::successors (\n\t\t\t\t\t\t\tSome (room_entrance (from_room)),\n\t\t\t\t\t\t\t|prev_hall| (prev_hall.idx () \u003e 0).then (||\n\t\t\t\t\t\t\t\tPlace::for_idx (prev_hall.idx () - 1)))\n\t\t\t\t\t\t.take_while (|\u0026 hall| state.get (hall).is_none ())\n\t\t\t\t\t\t.chain (\n\t\t\t\t\t\t\titer::successors (\n\t\t\t\t\t\t\t\t\tSome (room_entrance (from_room)),\n\t\t\t\t\t\t\t\t\t|prev_hall| (prev_hall.idx () + 1 \u003c 11).then_some (\n\t\t\t\t\t\t\t\t\t\tPlace::for_idx (prev_hall.idx () + 1)))\n\t\t\t\t\t\t\t\t.take_while (|\u0026 hall| state.get (hall).is_none ()))\n\t\t\t\t\t\t.filter (|hall| ! hall.entrance ()) {\n\t\t\t\t\tif ! path_clear (room_entrance (from_room), hall) { continue }\n\t\t\t\t\tresult.push (Move::Out (amph, from_room, hall));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tresult\n\t}\n\n}\n\nmod model {\n\n\tuse aoc_common::*;\n\tuse nums::IntConv;\n\tuse parser::*;\n\n\t#[ derive (Clone, Debug, Eq, PartialEq) ]\n\tpub struct State {\n\t\troom_size: usize,\n\t\thall: ArrayVec \u003cOption \u003cAmph\u003e, 11\u003e,\n\t\tamber: ArrayVec \u003cAmph, 4\u003e,\n\t\tbronze: ArrayVec \u003cAmph, 4\u003e,\n\t\tcopper: ArrayVec \u003cAmph, 4\u003e,\n\t\tdesert: ArrayVec \u003cAmph, 4\u003e,\n\t}\n\n\timpl State {\n\n\t\tpub fn from_array (room_size: usize, places: [Option \u003cAmph\u003e; 27]) -\u003e Self {\n\t\t\tlet mut state = Self {\n\t\t\t\troom_size,\n\t\t\t\thall: ArrayVec::new (),\n\t\t\t\tamber: ArrayVec::new (),\n\t\t\t\tbronze: ArrayVec::new (),\n\t\t\t\tcopper: ArrayVec::new (),\n\t\t\t\tdesert: ArrayVec::new (),\n\t\t\t};\n\t\t\tstate.hall = places [0 .. 11].iter ().copied ().collect ();\n\t\t\tfor room in Amph::ALL.iter ().copied () {\n\t\t\t\tstate.room_mut (room).extend (\n\t\t\t\t\tplaces [11 + room.idx () * 4 .. ].iter ().copied ().take (room_size).rev ()\n\t\t\t\t\t\t.while_some ());\n\t\t\t}\n\t\t\tstate\n\t\t}\n\n\t\tpub fn as_array (\u0026 self) -\u003e [Option \u003cAmph\u003e; 27] {\n\t\t\tlet mut result = [None; 27];\n\t\t\t#[ allow (clippy::needless_range_loop) ]\n\t\t\tfor idx in 0 .. 11 { result [idx] = self.hall [idx]; }\n\t\t\tfor (idx, amph) in self.amber.iter ().copied ().enumerate () {\n\t\t\t\tresult [11 + self.room_size - idx - 1] = Some (amph);\n\t\t\t}\n\t\t\tfor (idx, amph) in self.bronze.iter ().copied ().enumerate () {\n\t\t\t\tresult [15 + self.room_size - idx - 1] = Some (amph);\n\t\t\t}\n\t\t\tfor (idx, amph) in self.copper.iter ().copied ().enumerate () {\n\t\t\t\tresult [19 + self.room_size - idx - 1] = Some (amph);\n\t\t\t}\n\t\t\tfor (idx, amph) in self.desert.iter ().copied ().enumerate () {\n\t\t\t\tresult [23 + self.room_size - idx - 1] = Some (amph);\n\t\t\t}\n\t\t\tresult\n\t\t}\n\n\t\tpub const fn room_size (\u0026 self) -\u003e usize { self.room_size }\n\n\t\tpub fn get (\u0026 self, place: Place) -\u003e Option \u003cAmph\u003e {\n\t\t\tmatch place {\n\t\t\t\tPlace::Hall (id) =\u003e self.hall [id.as_usize ()],\n\t\t\t\tPlace::Room (Amph::Amber, depth) =\u003e\n\t\t\t\t\tself.amber.get (self.room_size - depth.as_usize () - 1).copied (),\n\t\t\t\tPlace::Room (Amph::Bronze, depth) =\u003e\n\t\t\t\t\tself.bronze.get (self.room_size - depth.as_usize () - 1).copied (),\n\t\t\t\tPlace::Room (Amph::Copper, depth) =\u003e\n\t\t\t\t\tself.copper.get (self.room_size - depth.as_usize () - 1).copied (),\n\t\t\t\tPlace::Room (Amph::Desert, depth) =\u003e\n\t\t\t\t\tself.desert.get (self.room_size - depth.as_usize () - 1).copied (),\n\t\t\t}\n\t\t}\n\n\t\tpub fn hall (\u0026 self) -\u003e \u0026 [Option \u003cAmph\u003e] { \u0026 self.hall }\n\n\t\tpub fn room (\u0026 self, amph: Amph) -\u003e \u0026 [Amph] {\n\t\t\tmatch amph {\n\t\t\t\tAmph::Amber =\u003e \u0026 self.amber,\n\t\t\t\tAmph::Bronze =\u003e \u0026 self.bronze,\n\t\t\t\tAmph::Copper =\u003e \u0026 self.copper,\n\t\t\t\tAmph::Desert =\u003e \u0026 self.desert,\n\t\t\t}\n\t\t}\n\n\t\tfn room_mut (\u0026 mut self, amph: Amph) -\u003e \u0026 mut ArrayVec \u003cAmph, 4\u003e {\n\t\t\tmatch amph {\n\t\t\t\tAmph::Amber =\u003e \u0026 mut self.amber,\n\t\t\t\tAmph::Bronze =\u003e \u0026 mut self.bronze,\n\t\t\t\tAmph::Copper =\u003e \u0026 mut self.copper,\n\t\t\t\tAmph::Desert =\u003e \u0026 mut self.desert,\n\t\t\t}\n\t\t}\n\n\t\tpub fn is_finished (\u0026 self) -\u003e bool {\n\t\t\tself.hall.iter ().all (Option::is_none)\n\t\t\t\t\u0026\u0026 self.amber.iter ().all (|\u0026 amph| amph == Amph::Amber)\n\t\t\t\t\u0026\u0026 self.bronze.iter ().all (|\u0026 amph| amph == Amph::Bronze)\n\t\t\t\t\u0026\u0026 self.copper.iter ().all (|\u0026 amph| amph == Amph::Copper)\n\t\t\t\t\u0026\u0026 self.desert.iter ().all (|\u0026 amph| amph == Amph::Desert)\n\t\t}\n\n\t\tpub fn room_is_happy (\u0026 self, room: Amph) -\u003e bool {\n\t\t\tself.room (room).iter ().copied ().all (|amph| amph == room)\n\t\t}\n\n\t\tpub fn move_out (\u0026 self, room: Amph, hall: Place) -\u003e Self {\n\t\t\tlet mut state = self.clone ();\n\t\t\tlet amph = state.room_mut (room).pop ().unwrap ();\n\t\t\tassert! (state.get (hall).is_none ());\n\t\t\tstate.hall [hall.idx ()] = Some (amph);\n\t\t\tstate\n\t\t}\n\n\t\tpub fn move_in (\u0026 self, hall: Place, room: Amph) -\u003e Self {\n\t\t\tlet mut state = self.clone ();\n\t\t\tlet amph = state.hall [hall.idx ()].take ().unwrap ();\n\t\t\tstate.room_mut (room).push (amph);\n\t\t\tstate\n\t\t}\n\n\t\tpub fn move_between (\u0026 self, from: Amph, to: Amph) -\u003e Self {\n\t\t\tlet mut state = self.clone ();\n\t\t\tlet amph = state.room_mut (from).pop ().unwrap ();\n\t\t\tlet to = match to {\n\t\t\t\tAmph::Amber =\u003e \u0026 mut state.amber, Amph::Bronze =\u003e \u0026 mut state.bronze,\n\t\t\t\tAmph::Copper =\u003e \u0026 mut state.copper, Amph::Desert =\u003e \u0026 mut state.desert,\n\t\t\t};\n\t\t\tassert! (to.len () \u003c self.room_size);\n\t\t\tto.push (amph);\n\t\t\tstate\n\t\t}\n\n\t\tpub fn pretty_line (\u0026 self, line: usize) -\u003e String {\n\t\t\tlet print_amph = |amph: Option \u003cAmph\u003e| amph.map_or (' ', Amph::letter);\n\t\t\tif line == 0 {\n\t\t\t\t\"┌───────────┐\".to_owned ()\n\t\t\t} else if line == 1 {\n\t\t\t\tformat! (\"│{}│\",\n\t\t\t\t\tself.hall.iter ().copied ().map (print_amph).collect::\u003cString\u003e ())\n\t\t\t} else if line == 2 {\n\t\t\t\tformat! (\"└─┐{}╷{}╷{}╷{}┌─┘\",\n\t\t\t\t\tprint_amph (self.get (Place::Room (Amph::Amber, 0))),\n\t\t\t\t\tprint_amph (self.get (Place::Room (Amph::Bronze, 0))),\n\t\t\t\t\tprint_amph (self.get (Place::Room (Amph::Copper, 0))),\n\t\t\t\t\tprint_amph (self.get (Place::Room (Amph::Desert, 0))))\n\t\t\t} else if line \u003c self.room_size.as_usize () + 2 {\n\t\t\t\tlet depth = (line - 2).as_u8 ();\n\t\t\t\tformat! (\"  │{}│{}│{}│{}│\",\n\t\t\t\t\tprint_amph (self.get (Place::Room (Amph::Amber, depth))),\n\t\t\t\t\tprint_amph (self.get (Place::Room (Amph::Bronze, depth))),\n\t\t\t\t\tprint_amph (self.get (Place::Room (Amph::Copper, depth))),\n\t\t\t\t\tprint_amph (self.get (Place::Room (Amph::Desert, depth))))\n\t\t\t} else if line == self.room_size.as_usize () + 2 {\n\t\t\t\t\"  └─┴─┴─┴─┘\".to_owned ()\n\t\t\t} else {\n\t\t\t\tpanic! ();\n\t\t\t}\n\t\t}\n\n\t\t#[ allow (clippy::print_stdout) ]\n\t\tpub fn print (\u0026 self) {\n\t\t\tfor line in 0 .. self.room_size.as_usize () + 3 {\n\t\t\t\tprintln! (\"{}\", self.pretty_line (line));\n\t\t\t}\n\t\t}\n\n\t\t#[ allow (dead_code) ]\n\t\tpub fn from_str (input: \u0026 str) -\u003e Option \u003cSelf\u003e {\n\t\t\tlet num_chars = input.chars ().count ();\n\t\t\tif ! [23, 27, 31].contains (\u0026 num_chars) { return None }\n\t\t\tlet room_size = (num_chars - 11) / 5;\n\t\t\tlet mut places = [None; 27];\n\t\t\tlet mut place_idx = 0;\n\t\t\tfor (char_idx, letter) in input.chars ().enumerate () {\n\t\t\t\tif 11 \u003c= char_idx \u0026\u0026 (char_idx - 11) % (room_size + 1) == 0 {\n\t\t\t\t\tif letter != '/' { return None }\n\t\t\t\t\tif 11 \u003c char_idx { place_idx += 4 - room_size; }\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tplaces [place_idx] = match Amph::from_letter (letter) {\n\t\t\t\t\tSome (amph) =\u003e amph,\n\t\t\t\t\tNone =\u003e return None,\n\t\t\t\t};\n\t\t\t\tplace_idx += 1;\n\t\t\t}\n\t\t\tSome (Self::from_array (room_size, places))\n\t\t}\n\n\t\tpub fn parse (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tlet err = |line_idx| format! (\"Invalid input: {}: {}\", line_idx, lines [line_idx]);\n\t\t\tif lines.len () \u003c 5 || lines.len () \u003e 7 { Err (err (5)) ?; }\n\t\t\tif lines [0] != \"#############\" { Err (err (0)) ?; }\n\t\t\tif lines [1] != \"#...........#\" { Err (err (1)) ?; }\n\t\t\tlet mut places = [None; 27];\n\t\t\tfor line_idx in 0 .. lines.len () - 1 {\n\t\t\t\tParser::wrap (lines [line_idx], |parser| {\n\t\t\t\t\tfn parse_amph (parser: \u0026 mut Parser) -\u003e ParseResult \u003cOption \u003cAmph\u003e\u003e {\n\t\t\t\t\t\tAmph::from_letter (parser.expect_next () ?)\n\t\t\t\t\t\t\t.ok_or_else (|| parser.err ())\n\t\t\t\t\t}\n\t\t\t\t\tif line_idx == 0 {\n\t\t\t\t\t\tparser.expect (\"#############\") ?.end () ?;\n\t\t\t\t\t} else if line_idx == 1 {\n\t\t\t\t\t\tparser.expect (\"#\") ?;\n\t\t\t\t\t\t#[ allow (clippy::needless_range_loop) ]\n\t\t\t\t\t\tfor idx in 0 .. 11 {\n\t\t\t\t\t\t\tplaces [idx] = parse_amph (parser) ?;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tparser.expect (\"#\") ?.end () ?;\n\t\t\t\t\t} else if line_idx \u003c lines.len () - 1 {\n\t\t\t\t\t\tif line_idx == 2 {\n\t\t\t\t\t\t\tparser.expect (\"###\") ?;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tparser.expect (\"  #\") ?;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tplaces [11 + (line_idx - 2)] = parse_amph (parser) ?;\n\t\t\t\t\t\tparser.expect (\"#\") ?;\n\t\t\t\t\t\tplaces [15 + (line_idx - 2)] = parse_amph (parser) ?;\n\t\t\t\t\t\tparser.expect (\"#\") ?;\n\t\t\t\t\t\tplaces [19 + (line_idx - 2)] = parse_amph (parser) ?;\n\t\t\t\t\t\tparser.expect (\"#\") ?;\n\t\t\t\t\t\tplaces [23 + (line_idx - 2)] = parse_amph (parser) ?;\n\t\t\t\t\t\tif line_idx == 2 {\n\t\t\t\t\t\t\tparser.expect (\"###\") ?;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tparser.expect (\"#\") ?;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tparser.end () ?;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tparser.expect (\"  ##########\") ?.end () ?;\n\t\t\t\t\t}\n\t\t\t\t\tOk (())\n\t\t\t\t}) ?;\n\t\t\t}\n\t\t\tlet room_size = lines.len () - 3;\n\t\t\tOk (Self::from_array (room_size, places))\n\t\t}\n\n\t\tpub fn compact (\u0026 self) -\u003e StateCompact {\n\t\t\tlet mut place_bits: u64 = 0;\n\t\t\tlet mut amph_bits: u64 = 0;\n\t\t\tfor amph in self.as_array () {\n\t\t\t\tplace_bits \u003c\u003c= 1_u64;\n\t\t\t\tif let Some (amph) = amph {\n\t\t\t\t\tplace_bits |= 1;\n\t\t\t\t\tamph_bits \u003c\u003c= 2_i32;\n\t\t\t\t\tamph_bits |= match amph {\n\t\t\t\t\t\tAmph::Amber =\u003e 0, Amph::Bronze =\u003e 1,\n\t\t\t\t\t\tAmph::Copper =\u003e 2, Amph::Desert =\u003e 3,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tassert! (64 - place_bits.leading_zeros () \u003c= 27);\n\t\t\tassert! (64 - amph_bits.leading_zeros () \u003c= 32);\n\t\t\tlet data = ((self.room_size.as_u64 ()) \u003c\u003c 59_i32) | (place_bits \u003c\u003c 32_i32) | amph_bits;\n\t\t\tStateCompact { data }\n\t\t}\n\n\t}\n\n\timpl fmt::Display for State {\n\t\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\t\tfor amph in self.hall.iter ().copied () {\n\t\t\t\twrite! (formatter, \"{}\", amph.map_or ('.', Amph::letter)) ?;\n\t\t\t}\n\t\t\tfor room in [\u0026 self.amber, \u0026 self.bronze, \u0026 self.copper, \u0026 self.desert] {\n\t\t\t\twrite! (formatter, \"/\") ?;\n\t\t\t\tfor amph in iter::repeat (None).take (self.room_size - room.len ())\n\t\t\t\t\t\t.chain (room.iter ().copied ().rev ().map (Some)) {\n\t\t\t\t\twrite! (formatter, \"{}\", amph.map_or ('.', Amph::letter)) ?;\n\t\t\t\t}\n\t\t\t}\n\t\t\tOk (())\n\t\t}\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, Hash, Ord, PartialEq, PartialOrd) ]\n\tpub struct StateCompact {\n\t\tdata: u64,\n\t}\n\n\timpl StateCompact {\n\t\tpub fn expand (self) -\u003e State {\n\t\t\tlet mut present_bits = (self.data \u0026 0x_07ff_ffff_0000_0000) \u003e\u003e 32_i32;\n\t\t\tlet mut amph_bits = self.data \u0026 0x_0000_0000_ffff_ffff;\n\t\t\tlet mut places = [None; 27];\n\t\t\tfor place_idx in (0 .. 27).rev () {\n\t\t\t\tif present_bits \u0026 1 != 0 {\n\t\t\t\t\tmatch amph_bits \u0026 0x3 {\n\t\t\t\t\t\t0 =\u003e places [place_idx] = Some (Amph::Amber),\n\t\t\t\t\t\t1 =\u003e places [place_idx] = Some (Amph::Bronze),\n\t\t\t\t\t\t2 =\u003e places [place_idx] = Some (Amph::Copper),\n\t\t\t\t\t\t3 =\u003e places [place_idx] = Some (Amph::Desert),\n\t\t\t\t\t\t_ =\u003e unreachable! (),\n\t\t\t\t\t}\n\t\t\t\t\tamph_bits \u003e\u003e= 2_i32;\n\t\t\t\t}\n\t\t\t\tpresent_bits \u003e\u003e= 1_i32;\n\t\t\t}\n\t\t\tlet room_size = (self.data \u003e\u003e 59_i32).as_usize ();\n\t\t\tState::from_array (room_size, places)\n\t\t}\n\t\tpub fn is_finished (self) -\u003e bool {\n\t\t\tlet mut present_bits = (self.data \u0026 0x_07ff_ffff_0000_0000) \u003e\u003e 32_i32;\n\t\t\tif present_bits \u0026 0x_07ff_0000 != 0 { return false }\n\t\t\tlet mut amph_bits = self.data \u0026 0x_0000_0000_ffff_ffff;\n\t\t\tfor idx in (0 .. 4).rev () {\n\t\t\t\tfor _ in 0_i32 .. 4_i32 {\n\t\t\t\t\tif present_bits \u0026 1 != 0 {\n\t\t\t\t\t\tif amph_bits \u0026 0x3 != idx { return false }\n\t\t\t\t\t\tamph_bits \u003e\u003e= 2_i32;\n\t\t\t\t\t}\n\t\t\t\t\tpresent_bits \u003e\u003e= 1_i32;\n\t\t\t\t}\n\t\t\t}\n\t\t\ttrue\n\t\t}\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, Hash, PartialEq) ]\n\tpub enum Place {\n\t\tHall (u8),\n\t\tRoom (Amph, u8),\n\t}\n\n\timpl Place {\n\t\tpub fn idx (self) -\u003e usize {\n\t\t\tmatch self {\n\t\t\t\tSelf::Hall (id) =\u003e id.as_usize (),\n\t\t\t\tSelf::Room (Amph::Amber, depth) =\u003e 11 + depth.as_usize (),\n\t\t\t\tSelf::Room (Amph::Bronze, depth) =\u003e 15 + depth.as_usize (),\n\t\t\t\tSelf::Room (Amph::Copper, depth) =\u003e 19 + depth.as_usize (),\n\t\t\t\tSelf::Room (Amph::Desert, depth) =\u003e 23 + depth.as_usize (),\n\t\t\t}\n\t\t}\n\t\tpub fn for_idx (idx: usize) -\u003e Self {\n\t\t\tmatch idx {\n\t\t\t\t0 ..= 10 =\u003e Self::Hall (idx.as_u8 ()),\n\t\t\t\t11 ..= 14 =\u003e Self::Room (Amph::Amber, idx.as_u8 () - 11),\n\t\t\t\t15 ..= 18 =\u003e Self::Room (Amph::Bronze, idx.as_u8 () - 15),\n\t\t\t\t19 ..= 22 =\u003e Self::Room (Amph::Copper, idx.as_u8 () - 19),\n\t\t\t\t23 ..= 26 =\u003e Self::Room (Amph::Desert, idx.as_u8 () - 23),\n\t\t\t\t_ =\u003e panic! (\"Invalid index: {}\", idx),\n\t\t\t}\n\t\t}\n\t\tpub fn entrance (self) -\u003e bool { [2, 4, 6, 8].contains (\u0026 self.idx ()) }\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, Hash, Ord, PartialEq, PartialOrd) ]\n\tpub enum Amph { Amber, Bronze, Copper, Desert }\n\n\timpl Amph {\n\t\tpub const fn idx (self) -\u003e usize {\n\t\t\tmatch self {\n\t\t\t\tSelf::Amber =\u003e 0,\n\t\t\t\tSelf::Bronze =\u003e 1,\n\t\t\t\tSelf::Copper =\u003e 2,\n\t\t\t\tSelf::Desert =\u003e 3,\n\t\t\t}\n\t\t}\n\t\t#[ allow (clippy::option_option) ]\n\t\tpub const fn from_letter (letter: char) -\u003e Option \u003cOption \u003cSelf\u003e\u003e {\n\t\t\tmatch letter {\n\t\t\t\t'A' =\u003e Some (Some (Self::Amber)),\n\t\t\t\t'B' =\u003e Some (Some (Self::Bronze)),\n\t\t\t\t'C' =\u003e Some (Some (Self::Copper)),\n\t\t\t\t'D' =\u003e Some (Some (Self::Desert)),\n\t\t\t\t'.' =\u003e Some (None), _ =\u003e None,\n\t\t\t}\n\t\t}\n\t\tpub const fn cost (self) -\u003e i64 { Self::COSTS [self.idx ()] }\n\t\tpub const fn letter (self) -\u003e char { Self::LETTERS [self.idx ()] }\n\t\tconst COSTS: \u0026 'static [i64; 4] = \u0026 [1, 10, 100, 1000];\n\t\tconst LETTERS: \u0026 'static [char; 4] = \u0026 ['A', 'B', 'C', 'D'];\n\t\tpub const ALL: \u0026 'static [Self] = \u0026 [\n\t\t\tSelf::Amber, Self::Bronze, Self::Copper, Self::Desert\n\t\t];\n\t}\n\n\t#[ cfg (test) ]\n\tmod tests {\n\n\t\tuse super::*;\n\n\t\t#[ test ]\n\t\tfn test_state_finished () {\n\t\t\tassert! (State::from_str (\".........../AA/BB/CC/DD\").unwrap ().is_finished ());\n\t\t\tassert! (! State::from_str (\"A........../.A/BB/CC/DD\").unwrap ().is_finished ());\n\t\t}\n\n\t}\n\n}\n\npub mod tools {\n\n\tuse super::*;\n\tuse model::State;\n\tuse model::StateCompact;\n\tuse nums::IntConv;\n\tuse search::PrioritySearch;\n\tuse search::PrioritySearchAdder;\n\n\t#[ derive (Debug, clap::Parser) ]\n\t#[ allow (clippy::struct_excessive_bools) ]\n\tpub struct RunArgs {\n\n\t\t#[ clap (long, default_value (\"inputs/day-23\")) ]\n\t\tinput: String,\n\n\t\t#[ clap (long) ]\n\t\tverbose: bool,\n\n\t\t#[ clap (long) ]\n\t\tdead_ends: bool,\n\n\t\t#[ clap (long) ]\n\t\tpart_1: bool,\n\n\t\t#[ clap (long) ]\n\t\tpart_2: bool,\n\n\t}\n\n\t#[ allow (clippy::needless_pass_by_value) ]\n\tpub fn run (args: RunArgs) -\u003e GenResult \u003c()\u003e {\n\t\tlet mut args = args;\n\t\tif ! (args.part_1 || args.part_2) { args.part_1 = true; args.part_2 = true; }\n\t\tlet input_string = fs::read_to_string (\u0026 args.input) ?;\n\t\tlet input_lines: Vec \u003c_\u003e = input_string.trim ().split ('\\n').collect ();\n\t\tif args.part_1 {\n\t\t\trun_part (\u0026 args, \u0026 input_lines) ?;\n\t\t}\n\t\tif args.part_2 {\n\t\t\tlet input_lines_modified = logic::modify_input_for_part_two (\u0026 input_lines);\n\t\t\trun_part (\u0026 args, \u0026 input_lines_modified) ?;\n\t\t}\n\t\tOk (())\n\t}\n\n\t#[ allow (clippy::print_stdout) ]\n\tpub fn run_part (args: \u0026 RunArgs, lines: \u0026 [\u0026 str]) -\u003e GenResult \u003c()\u003e {\n\t\tlet input = State::parse (lines) ?;\n\t\tlet mut num_loops = 0_i32;\n\t\tlet mut last_cost = -1_i64;\n\t\tlet mut prev_states = HashMap::new ();\n\t\tlet mut search = PrioritySearch::with_hash_map (\n\t\t\t|state_compact, score, mut adder: PrioritySearchAdder \u003c_, _, _\u003e| {\n\t\t\t\tlet next_states_compact = logic::calc_next_states (state_compact);\n\t\t\t\tfor (next_state_compact, next_cost) in next_states_compact.iter ().copied () {\n\t\t\t\t\tlet next_score = score + next_cost;\n\t\t\t\t\tadder.add (next_state_compact, next_score);\n\t\t\t\t}\n\t\t\t\t(state_compact, score, next_states_compact)\n\t\t\t},\n\t\t);\n\t\tsearch.push (input.compact (), 0);\n\t\tlet final_cost = loop {\n\t\t\tlet (state_compact, cost, next_states_compact) = match search.next () {\n\t\t\t\tSome (val) =\u003e val,\n\t\t\t\tNone =\u003e break None,\n\t\t\t};\n\t\t\tnum_loops += 1_i32;\n\t\t\tlet state = state_compact.expand ();\n\t\t\tif state.is_finished () {\n\t\t\t\tbreak Some ((state_compact, cost));\n\t\t\t}\n\t\t\tif args.verbose {\n\t\t\t\tlet next_states: Vec \u003c_\u003e =\n\t\t\t\t\tnext_states_compact.iter ().copied ()\n\t\t\t\t\t\t.map (|(state_compact, cost)| (state_compact.expand (), cost))\n\t\t\t\t\t\t.sorted_by_key (|\u0026 (_, cost)| cost)\n\t\t\t\t\t\t.collect ();\n\t\t\t\tif cost != last_cost {\n\t\t\t\t\tprintln! ();\n\t\t\t\t\tprintln! (\"Evaluating states with cost: {}\", cost);\n\t\t\t\t\tprintln! (\"Number of iterations: {}\", num_loops);\n\t\t\t\t\tprintln! (\"Size of backlog: {}\", search.len ());\n\t\t\t\t}\n\t\t\t\tprintln! ();\n\t\t\t\tif next_states.is_empty () \u0026\u0026 args.dead_ends {\n\t\t\t\t\tlet all_states =\n\t\t\t\t\t\titer::successors (\n\t\t\t\t\t\t\t\tSome (state_compact),\n\t\t\t\t\t\t\t\t|state| prev_states.get (state).copied ())\n\t\t\t\t\t\t\t.map (StateCompact::expand)\n\t\t\t\t\t\t\t.collect::\u003cVec \u003c_\u003e\u003e ();\n\t\t\t\t\tprintln! (\"  ▒▒▒▒  Dead end:\");\n\t\t\t\t\tfor chunk in all_states.chunks (11) {\n\t\t\t\t\t\tfor line in 0 .. state.room_size () + 3 {\n\t\t\t\t\t\t\tprint! (\"  ▒▒▒▒  \");\n\t\t\t\t\t\t\tfor (idx, state) in chunk.iter ().enumerate () {\n\t\t\t\t\t\t\t\tif idx \u003e 0 { print! (\" \"); }\n\t\t\t\t\t\t\t\tprint! (\"{:13}\", state.pretty_line (line));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tprint! (\"\\n\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tprint_next_states (\u0026 state, \u0026 next_states);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (next_state_compact, _) in next_states_compact {\n\t\t\t\tprev_states.insert (next_state_compact, state_compact);\n\t\t\t}\n\t\t\tlast_cost = cost;\n\t\t};\n\t\tlet (final_state_compact, final_cost) =\n\t\t\tfinal_cost.ok_or (\"Failed to find a solution\") ?;\n\t\tlet final_state = final_state_compact.expand ();\n\t\tlet mut all_states =\n\t\t\titer::successors (\n\t\t\t\t\tSome (final_state_compact),\n\t\t\t\t\t|state| prev_states.get (state).copied ())\n\t\t\t\t.map (StateCompact::expand)\n\t\t\t\t.collect::\u003cVec \u003c_\u003e\u003e ();\n\t\tall_states.reverse ();\n\t\tif args.verbose {\n\t\t\tprintln! ();\n\t\t\tprintln! (\"═══════════════════════════ Found solution ═══════════════════════════\");\n\t\t\tprintln! ();\n\t\t}\n\t\tprintln! (\"Solved with cost: {}\", final_cost);\n\t\tprintln! (\"Number of steps in solution: {}\", all_states.len () - 1);\n\t\tprintln! ();\n\t\tprintln! (\"Number of iterations: {}\", num_loops);\n\t\tprintln! (\"Total states genereated: {}\", prev_states.len ());\n\t\tif args.verbose { println! (); }\n\t\tfor chunk in all_states.chunks (11) {\n\t\t\tfor line in 0 .. final_state.room_size () + 3 {\n\t\t\t\tfor (idx, state) in chunk.iter ().enumerate () {\n\t\t\t\t\tif idx \u003e 0 { print! (\" \"); }\n\t\t\t\t\tprint! (\"{:13}\", state.pretty_line (line));\n\t\t\t\t}\n\t\t\t\tprint! (\"\\n\");\n\t\t\t}\n\t\t}\n\t\tif args.verbose { println! (); }\n\t\tOk (())\n\t}\n\n\t#[ allow (clippy::print_stdout) ]\n\tpub fn print_next_states (cur_state: \u0026 State, next_states: \u0026 [(State, i64)]) {\n\t\tif next_states.is_empty () {\n\t\t\tprintln! (\"{:^13}\", \"START\");\n\t\t\tfor line in 0 .. cur_state.room_size () + 3 {\n\t\t\t\tprint! (\"{:13}\", cur_state.pretty_line (line));\n\t\t\t\tif line == (cur_state.room_size () + 3) / 2 {\n\t\t\t\t\tprint! (\"   (dead end)\");\n\t\t\t\t}\n\t\t\t\tprint! (\"\\n\");\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tfor (chunk_idx, chunk) in next_states.chunks (10).enumerate () {\n\t\t\tprint! (\"{:^13}  \", if chunk_idx == 0 { \"START\" } else { \"\" });\n\t\t\tfor \u0026 (_, ref cost) in chunk.iter () {\n\t\t\t\tprint! (\" {:^13}\", cost);\n\t\t\t}\n\t\t\tprint! (\"\\n\");\n\t\t\tfor line in 0 .. (cur_state.room_size ().as_usize () + 3) {\n\t\t\t\tprint! (\"{:13}  \", if chunk_idx == 0 { cur_state.pretty_line (line) } else { String::new () });\n\t\t\t\tfor \u0026 (ref next_state, _) in chunk.iter () {\n\t\t\t\t\tprint! (\" {:13}\", next_state.pretty_line (line));\n\t\t\t\t}\n\t\t\t\tprint! (\"\\n\");\n\t\t\t}\n\t\t}\n\t}\n\n\t#[ derive (Debug, clap::Parser) ]\n\tpub struct InternalsArgs;\n\n\t#[ allow (clippy::needless_pass_by_value) ]\n\t#[ allow (clippy::print_stdout) ]\n\tpub fn internals (_args: InternalsArgs) -\u003e GenResult \u003c()\u003e {\n\t\tprintln! (\"Data structures:\");\n\t\tfn show_struct \u003cType\u003e () {\n\t\t\tlet name = std::any::type_name::\u003cType\u003e ();\n\t\t\tlet size = mem::size_of::\u003cType\u003e ();\n\t\t\tlet align = mem::align_of::\u003cType\u003e ();\n\t\t\tprintln! (\" - {} {} bytes (align = {})\", name, size, align);\n\t\t}\n\t\tshow_struct::\u003clogic::Move\u003e ();\n\t\tshow_struct::\u003cmodel::Amph\u003e ();\n\t\tshow_struct::\u003cmodel::Place\u003e ();\n\t\tshow_struct::\u003cmodel::State\u003e ();\n\t\tshow_struct::\u003cmodel::StateCompact\u003e ();\n\t\tOk (())\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE: \u0026 'static [\u0026 'static str] = \u0026 [\n\t\t\"#############\",\n\t\t\"#...........#\",\n\t\t\"###B#C#B#D###\",\n\t\t\"  #A#D#C#A#\",\n\t\t\"  #########\",\n\t];\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (12521, logic::part_one (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n\t#[ test ]\n\tfn part_two () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (44169, logic::part_two (EXAMPLE) ?);\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":10,"address":[124457,124921],"length":1,"stats":{"Line":0},"fn_name":null},{"line":14,"address":[124542],"length":1,"stats":{"Line":0},"fn_name":null},{"line":15,"address":[125006],"length":1,"stats":{"Line":0},"fn_name":null},{"line":33,"address":[88401,88096],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":34,"address":[88128,88302],"length":1,"stats":{"Line":1},"fn_name":null},{"line":35,"address":[88291],"length":1,"stats":{"Line":1},"fn_name":null},{"line":38,"address":[88432,88899,88923],"length":1,"stats":{"Line":1},"fn_name":"part_two"},{"line":39,"address":[88465],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[88475,88560,88753],"length":1,"stats":{"Line":2},"fn_name":null},{"line":41,"address":[88738],"length":1,"stats":{"Line":1},"fn_name":null},{"line":44,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":45,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":46,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":47,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":48,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":51,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":52,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":56,"address":[89900,89600],"length":1,"stats":{"Line":2},"fn_name":"calc_result"},{"line":58,"address":[89625,89744,89874],"length":1,"stats":{"Line":3},"fn_name":null},{"line":59,"address":[203406,203392],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":60,"address":[203440,203461],"length":1,"stats":{"Line":2},"fn_name":"{closure#1}"},{"line":62,"address":[89848],"length":1,"stats":{"Line":0},"fn_name":null},{"line":66,"address":[89952,90058],"length":1,"stats":{"Line":2},"fn_name":"iterator"},{"line":68,"address":[203840,203472,203794],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":69,"address":[203518],"length":1,"stats":{"Line":2},"fn_name":null},{"line":70,"address":[203757,203713],"length":1,"stats":{"Line":2},"fn_name":null},{"line":71,"address":[203750,203789],"length":1,"stats":{"Line":4},"fn_name":null},{"line":73,"address":[203830],"length":1,"stats":{"Line":2},"fn_name":null},{"line":76,"address":[90041,89989],"length":1,"stats":{"Line":4},"fn_name":null},{"line":80,"address":[90096,92966,94754],"length":1,"stats":{"Line":2},"fn_name":"calc_next_states"},{"line":81,"address":[90127],"length":1,"stats":{"Line":2},"fn_name":null},{"line":83,"address":[90148],"length":1,"stats":{"Line":6},"fn_name":null},{"line":84,"address":[90156],"length":1,"stats":{"Line":6},"fn_name":null},{"line":85,"address":[204192,204432],"length":1,"stats":{"Line":4},"fn_name":"{closure#2}"},{"line":86,"address":[204243],"length":1,"stats":{"Line":2},"fn_name":null},{"line":88,"address":[90172],"length":1,"stats":{"Line":2},"fn_name":null},{"line":89,"address":[90285,90227,90330],"length":1,"stats":{"Line":5},"fn_name":null},{"line":91,"address":[90680,90299,90365],"length":1,"stats":{"Line":4},"fn_name":null},{"line":93,"address":[91378],"length":1,"stats":{"Line":2},"fn_name":null},{"line":94,"address":[90706,90640],"length":1,"stats":{"Line":4},"fn_name":null},{"line":98,"address":[90856],"length":1,"stats":{"Line":2},"fn_name":null},{"line":102,"address":[91030],"length":1,"stats":{"Line":2},"fn_name":null},{"line":106,"address":[91197],"length":1,"stats":{"Line":2},"fn_name":null},{"line":112,"address":[91425],"length":1,"stats":{"Line":2},"fn_name":null},{"line":113,"address":[91440,91519,91791],"length":1,"stats":{"Line":6},"fn_name":null},{"line":114,"address":[91821],"length":1,"stats":{"Line":2},"fn_name":null},{"line":115,"address":[91961],"length":1,"stats":{"Line":2},"fn_name":null},{"line":116,"address":[92024],"length":1,"stats":{"Line":2},"fn_name":null},{"line":117,"address":[92769,92426,92259,92623,92562],"length":1,"stats":{"Line":6},"fn_name":null},{"line":118,"address":[92408,92466,92582],"length":1,"stats":{"Line":4},"fn_name":null},{"line":119,"address":[92740],"length":1,"stats":{"Line":2},"fn_name":null},{"line":120,"address":[92810,92881],"length":1,"stats":{"Line":4},"fn_name":null},{"line":122,"address":[91868],"length":1,"stats":{"Line":1},"fn_name":null},{"line":123,"address":[93003,91940],"length":1,"stats":{"Line":2},"fn_name":null},{"line":124,"address":[93084,93502],"length":1,"stats":{"Line":1},"fn_name":null},{"line":125,"address":[93425],"length":1,"stats":{"Line":1},"fn_name":null},{"line":126,"address":[93543,93614],"length":1,"stats":{"Line":2},"fn_name":null},{"line":131,"address":[91765,93991,93747],"length":1,"stats":{"Line":6},"fn_name":null},{"line":132,"address":[94021],"length":1,"stats":{"Line":2},"fn_name":null},{"line":133,"address":[94105],"length":1,"stats":{"Line":2},"fn_name":null},{"line":134,"address":[94381,94197,94570],"length":1,"stats":{"Line":4},"fn_name":null},{"line":135,"address":[94255],"length":1,"stats":{"Line":2},"fn_name":null},{"line":136,"address":[94493],"length":1,"stats":{"Line":2},"fn_name":null},{"line":137,"address":[94611,94671],"length":1,"stats":{"Line":4},"fn_name":null},{"line":141,"address":[93971],"length":1,"stats":{"Line":2},"fn_name":null},{"line":152,"address":[94784,98317,98375],"length":1,"stats":{"Line":2},"fn_name":"calc_next_moves"},{"line":153,"address":[94823],"length":1,"stats":{"Line":2},"fn_name":null},{"line":154,"address":[94860],"length":1,"stats":{"Line":6},"fn_name":null},{"line":155,"address":[205000,204736,204966,204534,204913],"length":1,"stats":{"Line":10},"fn_name":null},{"line":156,"address":[204600],"length":1,"stats":{"Line":2},"fn_name":null},{"line":157,"address":[204757,204936],"length":1,"stats":{"Line":2},"fn_name":null},{"line":158,"address":[205118,205072],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":159,"address":[205216,204987,205230],"length":1,"stats":{"Line":6},"fn_name":"{closure#1}"},{"line":160,"address":[205280,205289],"length":1,"stats":{"Line":4},"fn_name":"{closure#2}"},{"line":161,"address":[205328,205344],"length":1,"stats":{"Line":4},"fn_name":"{closure#1}"},{"line":162,"address":[95234,94868,94948],"length":1,"stats":{"Line":6},"fn_name":null},{"line":163,"address":[205631,205616,205555,205536],"length":1,"stats":{"Line":7},"fn_name":"{closure#2}"},{"line":164,"address":[95268],"length":1,"stats":{"Line":2},"fn_name":null},{"line":165,"address":[95275],"length":1,"stats":{"Line":2},"fn_name":null},{"line":166,"address":[95353],"length":1,"stats":{"Line":2},"fn_name":null},{"line":167,"address":[95385],"length":1,"stats":{"Line":2},"fn_name":null},{"line":168,"address":[95647],"length":1,"stats":{"Line":1},"fn_name":null},{"line":169,"address":[95658],"length":1,"stats":{"Line":1},"fn_name":null},{"line":170,"address":[95787],"length":1,"stats":{"Line":1},"fn_name":null},{"line":172,"address":[96136,97125],"length":1,"stats":{"Line":4},"fn_name":null},{"line":173,"address":[95187,95847],"length":1,"stats":{"Line":4},"fn_name":null},{"line":174,"address":[95877],"length":1,"stats":{"Line":2},"fn_name":null},{"line":175,"address":[95966],"length":1,"stats":{"Line":2},"fn_name":null},{"line":176,"address":[96055],"length":1,"stats":{"Line":2},"fn_name":null},{"line":178,"address":[96467],"length":1,"stats":{"Line":2},"fn_name":null},{"line":179,"address":[96555],"length":1,"stats":{"Line":2},"fn_name":null},{"line":180,"address":[96562],"length":1,"stats":{"Line":2},"fn_name":null},{"line":181,"address":[96602],"length":1,"stats":{"Line":2},"fn_name":null},{"line":182,"address":[96671],"length":1,"stats":{"Line":1},"fn_name":null},{"line":183,"address":[96996],"length":1,"stats":{"Line":1},"fn_name":null},{"line":184,"address":[97011],"length":1,"stats":{"Line":1},"fn_name":null},{"line":185,"address":[97087],"length":1,"stats":{"Line":2},"fn_name":null},{"line":187,"address":[97899],"length":1,"stats":{"Line":2},"fn_name":null},{"line":188,"address":[97236,97339,97677],"length":1,"stats":{"Line":6},"fn_name":null},{"line":189,"address":[96630,97155],"length":1,"stats":{"Line":4},"fn_name":null},{"line":190,"address":[205972,205824,205683,205664],"length":1,"stats":{"Line":8},"fn_name":"{closure#3}"},{"line":191,"address":[205838],"length":1,"stats":{"Line":2},"fn_name":null},{"line":192,"address":[97331],"length":1,"stats":{"Line":6},"fn_name":null},{"line":194,"address":[97609,97506],"length":1,"stats":{"Line":4},"fn_name":null},{"line":195,"address":[97387],"length":1,"stats":{"Line":2},"fn_name":null},{"line":196,"address":[206255,206112,206383,206131],"length":1,"stats":{"Line":6},"fn_name":"{closure#5}"},{"line":197,"address":[206213,206290],"length":1,"stats":{"Line":4},"fn_name":null},{"line":198,"address":[97601],"length":1,"stats":{"Line":6},"fn_name":null},{"line":199,"address":[206576,206590],"length":1,"stats":{"Line":4},"fn_name":"{closure#7}"},{"line":200,"address":[97929],"length":1,"stats":{"Line":2},"fn_name":null},{"line":201,"address":[98191],"length":1,"stats":{"Line":2},"fn_name":null},{"line":205,"address":[98336],"length":1,"stats":{"Line":2},"fn_name":null},{"line":228,"address":[251888,252444],"length":1,"stats":{"Line":2},"fn_name":"from_array"},{"line":231,"address":[251935],"length":1,"stats":{"Line":2},"fn_name":null},{"line":232,"address":[252011,251948],"length":1,"stats":{"Line":4},"fn_name":null},{"line":233,"address":[252035,252095],"length":1,"stats":{"Line":4},"fn_name":null},{"line":234,"address":[252179,252119],"length":1,"stats":{"Line":4},"fn_name":null},{"line":235,"address":[252287,252203],"length":1,"stats":{"Line":4},"fn_name":null},{"line":237,"address":[252374,252523],"length":1,"stats":{"Line":4},"fn_name":null},{"line":238,"address":[252914,252714],"length":1,"stats":{"Line":4},"fn_name":null},{"line":239,"address":[252932,253273],"length":1,"stats":{"Line":4},"fn_name":null},{"line":240,"address":[252951],"length":1,"stats":{"Line":2},"fn_name":null},{"line":246,"address":[253296],"length":1,"stats":{"Line":2},"fn_name":"as_array"},{"line":247,"address":[253338],"length":1,"stats":{"Line":2},"fn_name":null},{"line":249,"address":[253558,253366],"length":1,"stats":{"Line":4},"fn_name":null},{"line":250,"address":[253786,253520,254039,254308],"length":1,"stats":{"Line":8},"fn_name":null},{"line":251,"address":[254077,254321],"length":1,"stats":{"Line":2},"fn_name":null},{"line":253,"address":[254001,254613,254360,254882],"length":1,"stats":{"Line":8},"fn_name":null},{"line":254,"address":[254895,254651],"length":1,"stats":{"Line":2},"fn_name":null},{"line":256,"address":[255175,254575,255417,254934],"length":1,"stats":{"Line":8},"fn_name":null},{"line":257,"address":[255210,255427],"length":1,"stats":{"Line":2},"fn_name":null},{"line":259,"address":[255460,255667,255909,255143],"length":1,"stats":{"Line":8},"fn_name":null},{"line":260,"address":[255919,255702],"length":1,"stats":{"Line":2},"fn_name":null},{"line":265,"address":[255952,255957],"length":1,"stats":{"Line":4},"fn_name":"room_size"},{"line":267,"address":[255968],"length":1,"stats":{"Line":2},"fn_name":"get"},{"line":268,"address":[256045,256122],"length":1,"stats":{"Line":2},"fn_name":null},{"line":269,"address":[256071,257246],"length":1,"stats":{"Line":4},"fn_name":null},{"line":270,"address":[256170],"length":1,"stats":{"Line":0},"fn_name":null},{"line":271,"address":[256191,257054],"length":1,"stats":{"Line":0},"fn_name":null},{"line":272,"address":[256229],"length":1,"stats":{"Line":0},"fn_name":null},{"line":273,"address":[256250,256854],"length":1,"stats":{"Line":0},"fn_name":null},{"line":274,"address":[256288],"length":1,"stats":{"Line":0},"fn_name":null},{"line":275,"address":[256648,256309],"length":1,"stats":{"Line":0},"fn_name":null},{"line":276,"address":[256347],"length":1,"stats":{"Line":0},"fn_name":null},{"line":277,"address":[256368],"length":1,"stats":{"Line":0},"fn_name":null},{"line":281,"address":[257344,257353],"length":1,"stats":{"Line":4},"fn_name":"hall"},{"line":283,"address":[257392],"length":1,"stats":{"Line":2},"fn_name":"room"},{"line":284,"address":[257536,257413,257510,257484],"length":1,"stats":{"Line":8},"fn_name":null},{"line":285,"address":[257451,257640],"length":1,"stats":{"Line":4},"fn_name":null},{"line":286,"address":[257480,257618],"length":1,"stats":{"Line":4},"fn_name":null},{"line":287,"address":[257506,257596],"length":1,"stats":{"Line":4},"fn_name":null},{"line":288,"address":[257561,257532],"length":1,"stats":{"Line":4},"fn_name":null},{"line":292,"address":[257664],"length":1,"stats":{"Line":2},"fn_name":"room_mut"},{"line":293,"address":[257684,257775],"length":1,"stats":{"Line":4},"fn_name":null},{"line":294,"address":[257721],"length":1,"stats":{"Line":2},"fn_name":null},{"line":295,"address":[257736],"length":1,"stats":{"Line":2},"fn_name":null},{"line":296,"address":[257751],"length":1,"stats":{"Line":2},"fn_name":null},{"line":297,"address":[257766],"length":1,"stats":{"Line":2},"fn_name":null},{"line":301,"address":[257792],"length":1,"stats":{"Line":1},"fn_name":"is_finished"},{"line":302,"address":[257812,258086,257981,258191,258296],"length":1,"stats":{"Line":5},"fn_name":null},{"line":303,"address":[186864,186878],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":304,"address":[186942,186928],"length":1,"stats":{"Line":3},"fn_name":"{closure#1}"},{"line":305,"address":[186992,187006],"length":1,"stats":{"Line":3},"fn_name":"{closure#2}"},{"line":306,"address":[187056,187070],"length":1,"stats":{"Line":3},"fn_name":"{closure#3}"},{"line":309,"address":[258336],"length":1,"stats":{"Line":2},"fn_name":"room_is_happy"},{"line":310,"address":[187120,187136],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":313,"address":[258480,258963],"length":1,"stats":{"Line":2},"fn_name":"move_out"},{"line":314,"address":[258548],"length":1,"stats":{"Line":2},"fn_name":null},{"line":315,"address":[258619,258562],"length":1,"stats":{"Line":4},"fn_name":null},{"line":316,"address":[258671,258783],"length":1,"stats":{"Line":2},"fn_name":null},{"line":317,"address":[258758,258834,258942],"length":1,"stats":{"Line":4},"fn_name":null},{"line":321,"address":[259355,258992],"length":1,"stats":{"Line":1},"fn_name":"move_in"},{"line":322,"address":[259062],"length":1,"stats":{"Line":1},"fn_name":null},{"line":323,"address":[259072,259144],"length":1,"stats":{"Line":2},"fn_name":null},{"line":324,"address":[259310],"length":1,"stats":{"Line":1},"fn_name":null},{"line":328,"address":[259392,259746],"length":1,"stats":{"Line":2},"fn_name":"move_between"},{"line":329,"address":[259436],"length":1,"stats":{"Line":2},"fn_name":null},{"line":330,"address":[259450,259501],"length":1,"stats":{"Line":4},"fn_name":null},{"line":331,"address":[259545],"length":1,"stats":{"Line":2},"fn_name":null},{"line":332,"address":[259583],"length":1,"stats":{"Line":1},"fn_name":null},{"line":333,"address":[259615],"length":1,"stats":{"Line":2},"fn_name":null},{"line":335,"address":[259670,259701,259640],"length":1,"stats":{"Line":4},"fn_name":null},{"line":336,"address":[259686],"length":1,"stats":{"Line":2},"fn_name":null},{"line":340,"address":[262139,259776],"length":1,"stats":{"Line":0},"fn_name":"pretty_line"},{"line":341,"address":[187184,187168],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":342,"address":[259831],"length":1,"stats":{"Line":0},"fn_name":null},{"line":343,"address":[259845],"length":1,"stats":{"Line":0},"fn_name":null},{"line":344,"address":[262249,259875],"length":1,"stats":{"Line":0},"fn_name":null},{"line":345,"address":[262165,261959],"length":1,"stats":{"Line":0},"fn_name":null},{"line":346,"address":[259889,261871],"length":1,"stats":{"Line":0},"fn_name":null},{"line":347,"address":[259927,261850],"length":1,"stats":{"Line":0},"fn_name":null},{"line":348,"address":[261488,261363,261226,261613],"length":1,"stats":{"Line":0},"fn_name":null},{"line":349,"address":[261191,259941],"length":1,"stats":{"Line":0},"fn_name":null},{"line":350,"address":[261264],"length":1,"stats":{"Line":0},"fn_name":null},{"line":351,"address":[261395],"length":1,"stats":{"Line":0},"fn_name":null},{"line":352,"address":[261520],"length":1,"stats":{"Line":0},"fn_name":null},{"line":353,"address":[260011],"length":1,"stats":{"Line":0},"fn_name":null},{"line":354,"address":[260146],"length":1,"stats":{"Line":0},"fn_name":null},{"line":355,"address":[260481,260767,260624,260338],"length":1,"stats":{"Line":0},"fn_name":null},{"line":356,"address":[260240],"length":1,"stats":{"Line":0},"fn_name":null},{"line":357,"address":[260383],"length":1,"stats":{"Line":0},"fn_name":null},{"line":358,"address":[260526],"length":1,"stats":{"Line":0},"fn_name":null},{"line":359,"address":[260669],"length":1,"stats":{"Line":0},"fn_name":null},{"line":360,"address":[261052,260116],"length":1,"stats":{"Line":0},"fn_name":null},{"line":361,"address":[261162],"length":1,"stats":{"Line":0},"fn_name":null},{"line":363,"address":[261124],"length":1,"stats":{"Line":0},"fn_name":null},{"line":368,"address":[262659,262256],"length":1,"stats":{"Line":0},"fn_name":"print"},{"line":369,"address":[262276,262461],"length":1,"stats":{"Line":0},"fn_name":null},{"line":370,"address":[262474],"length":1,"stats":{"Line":0},"fn_name":null},{"line":375,"address":[262688],"length":1,"stats":{"Line":1},"fn_name":"from_str"},{"line":376,"address":[262759],"length":1,"stats":{"Line":1},"fn_name":null},{"line":377,"address":[262809,262886],"length":1,"stats":{"Line":1},"fn_name":null},{"line":378,"address":[262848,263015,262914],"length":1,"stats":{"Line":2},"fn_name":null},{"line":379,"address":[262937],"length":1,"stats":{"Line":1},"fn_name":null},{"line":380,"address":[262986],"length":1,"stats":{"Line":1},"fn_name":null},{"line":381,"address":[263306,262998,263933,263055],"length":1,"stats":{"Line":4},"fn_name":null},{"line":382,"address":[263345],"length":1,"stats":{"Line":1},"fn_name":null},{"line":383,"address":[263588,263621],"length":1,"stats":{"Line":1},"fn_name":null},{"line":384,"address":[263598,263638],"length":1,"stats":{"Line":2},"fn_name":null},{"line":387,"address":[263763,263824,263567,263897],"length":1,"stats":{"Line":3},"fn_name":null},{"line":388,"address":[263806],"length":1,"stats":{"Line":1},"fn_name":null},{"line":389,"address":[263794],"length":1,"stats":{"Line":0},"fn_name":null},{"line":391,"address":[263866,263938,263925],"length":1,"stats":{"Line":2},"fn_name":null},{"line":393,"address":[263202,263976],"length":1,"stats":{"Line":2},"fn_name":null},{"line":396,"address":[264032],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":397,"address":[187216,187251],"length":1,"stats":{"Line":1},"fn_name":"{closure#0}"},{"line":398,"address":[264085,264149],"length":1,"stats":{"Line":1},"fn_name":null},{"line":399,"address":[264500,264128,264415],"length":1,"stats":{"Line":2},"fn_name":null},{"line":400,"address":[264768,264895,264476],"length":1,"stats":{"Line":2},"fn_name":null},{"line":401,"address":[264829],"length":1,"stats":{"Line":1},"fn_name":null},{"line":402,"address":[264870,265163,265360,265580],"length":1,"stats":{"Line":5},"fn_name":null},{"line":403,"address":[191231,187488,188065],"length":1,"stats":{"Line":7},"fn_name":"{closure#1}"},{"line":404,"address":[265904],"length":1,"stats":{"Line":2},"fn_name":"parse_amph"},{"line":405,"address":[265934,266121],"length":1,"stats":{"Line":4},"fn_name":null},{"line":406,"address":[193072,193089],"length":1,"stats":{"Line":2},"fn_name":"{closure#0}"},{"line":408,"address":[192936,187543],"length":1,"stats":{"Line":4},"fn_name":null},{"line":409,"address":[187560,192684,192888,192949],"length":1,"stats":{"Line":6},"fn_name":null},{"line":410,"address":[192549,187598],"length":1,"stats":{"Line":4},"fn_name":null},{"line":411,"address":[191748,187615,191623],"length":1,"stats":{"Line":4},"fn_name":null},{"line":413,"address":[191679,192264,191880,191994],"length":1,"stats":{"Line":8},"fn_name":null},{"line":414,"address":[192015,192257,192274],"length":1,"stats":{"Line":4},"fn_name":null},{"line":416,"address":[192562,192297,191956,192501],"length":1,"stats":{"Line":6},"fn_name":null},{"line":417,"address":[191081,191488,187653],"length":1,"stats":{"Line":4},"fn_name":null},{"line":418,"address":[188155,187925,187789],"length":1,"stats":{"Line":6},"fn_name":null},{"line":419,"address":[187806,188099,188165],"length":1,"stats":{"Line":4},"fn_name":null},{"line":421,"address":[187938,187844],"length":1,"stats":{"Line":2},"fn_name":null},{"line":423,"address":[188518,188678,188287,188081],"length":1,"stats":{"Line":6},"fn_name":null},{"line":424,"address":[188791,188701,188646],"length":1,"stats":{"Line":4},"fn_name":null},{"line":425,"address":[188765,189144,188913,189304],"length":1,"stats":{"Line":6},"fn_name":null},{"line":426,"address":[189327,189272,189417],"length":1,"stats":{"Line":4},"fn_name":null},{"line":427,"address":[189770,189930,189391,189539],"length":1,"stats":{"Line":6},"fn_name":null},{"line":428,"address":[189898,190043,189953],"length":1,"stats":{"Line":4},"fn_name":null},{"line":429,"address":[190017,190534,190165,190396],"length":1,"stats":{"Line":6},"fn_name":null},{"line":430,"address":[190901,190518,190684],"length":1,"stats":{"Line":6},"fn_name":null},{"line":431,"address":[190565,190845,190911],"length":1,"stats":{"Line":4},"fn_name":null},{"line":433,"address":[190603,190697],"length":1,"stats":{"Line":2},"fn_name":null},{"line":435,"address":[190827,191033,191094],"length":1,"stats":{"Line":4},"fn_name":null},{"line":437,"address":[187751,191236,191501,191440],"length":1,"stats":{"Line":0},"fn_name":null},{"line":439,"address":[191224],"length":1,"stats":{"Line":2},"fn_name":null},{"line":442,"address":[265330,265716,265825],"length":1,"stats":{"Line":4},"fn_name":null},{"line":443,"address":[265860,265724],"length":1,"stats":{"Line":4},"fn_name":null},{"line":446,"address":[266144,266508],"length":1,"stats":{"Line":2},"fn_name":"compact"},{"line":447,"address":[266167],"length":1,"stats":{"Line":2},"fn_name":null},{"line":448,"address":[266176],"length":1,"stats":{"Line":2},"fn_name":null},{"line":449,"address":[266185],"length":1,"stats":{"Line":2},"fn_name":null},{"line":450,"address":[266364],"length":1,"stats":{"Line":2},"fn_name":null},{"line":451,"address":[266608,266388],"length":1,"stats":{"Line":4},"fn_name":null},{"line":452,"address":[266436],"length":1,"stats":{"Line":2},"fn_name":null},{"line":453,"address":[266450],"length":1,"stats":{"Line":2},"fn_name":null},{"line":454,"address":[266590,266474,266534],"length":1,"stats":{"Line":4},"fn_name":null},{"line":455,"address":[266536],"length":1,"stats":{"Line":2},"fn_name":null},{"line":456,"address":[266564],"length":1,"stats":{"Line":2},"fn_name":null},{"line":460,"address":[266785,266613,266667],"length":1,"stats":{"Line":4},"fn_name":null},{"line":461,"address":[266783,266733,266819,266906],"length":1,"stats":{"Line":6},"fn_name":null},{"line":462,"address":[266890,266941],"length":1,"stats":{"Line":4},"fn_name":null},{"line":469,"address":[267008,268770],"length":1,"stats":{"Line":0},"fn_name":"fmt"},{"line":470,"address":[267047,267349],"length":1,"stats":{"Line":0},"fn_name":null},{"line":471,"address":[267363],"length":1,"stats":{"Line":0},"fn_name":null},{"line":473,"address":[267987,267606,267266],"length":1,"stats":{"Line":0},"fn_name":null},{"line":474,"address":[267946,267778],"length":1,"stats":{"Line":0},"fn_name":null},{"line":475,"address":[268021,268508,268338,268066,267916],"length":1,"stats":{"Line":0},"fn_name":null},{"line":476,"address":[268188],"length":1,"stats":{"Line":0},"fn_name":null},{"line":477,"address":[268500,268523],"length":1,"stats":{"Line":0},"fn_name":null},{"line":480,"address":[268796],"length":1,"stats":{"Line":0},"fn_name":null},{"line":490,"address":[268816],"length":1,"stats":{"Line":2},"fn_name":"expand"},{"line":491,"address":[268849],"length":1,"stats":{"Line":2},"fn_name":null},{"line":492,"address":[268886],"length":1,"stats":{"Line":2},"fn_name":null},{"line":493,"address":[268904],"length":1,"stats":{"Line":2},"fn_name":null},{"line":494,"address":[268940,269605,269119],"length":1,"stats":{"Line":5},"fn_name":null},{"line":495,"address":[269590,269140],"length":1,"stats":{"Line":4},"fn_name":null},{"line":496,"address":[269174],"length":1,"stats":{"Line":1},"fn_name":null},{"line":497,"address":[269249,269533],"length":1,"stats":{"Line":2},"fn_name":null},{"line":498,"address":[269282,269484],"length":1,"stats":{"Line":4},"fn_name":null},{"line":499,"address":[269315,269435],"length":1,"stats":{"Line":3},"fn_name":null},{"line":500,"address":[269341],"length":1,"stats":{"Line":1},"fn_name":null},{"line":503,"address":[269585,269411],"length":1,"stats":{"Line":4},"fn_name":null},{"line":505,"address":[269600,269155],"length":1,"stats":{"Line":2},"fn_name":null},{"line":507,"address":[269615,269105],"length":1,"stats":{"Line":4},"fn_name":null},{"line":508,"address":[269642],"length":1,"stats":{"Line":2},"fn_name":null},{"line":510,"address":[269760],"length":1,"stats":{"Line":2},"fn_name":"is_finished"},{"line":511,"address":[269783],"length":1,"stats":{"Line":2},"fn_name":null},{"line":512,"address":[269815,269900],"length":1,"stats":{"Line":4},"fn_name":null},{"line":513,"address":[269837],"length":1,"stats":{"Line":2},"fn_name":null},{"line":514,"address":[269932,270028,269855],"length":1,"stats":{"Line":6},"fn_name":null},{"line":515,"address":[270049,270267],"length":1,"stats":{"Line":3},"fn_name":null},{"line":516,"address":[270255,270169],"length":1,"stats":{"Line":3},"fn_name":null},{"line":517,"address":[270205,270235],"length":1,"stats":{"Line":2},"fn_name":null},{"line":518,"address":[270219,270250],"length":1,"stats":{"Line":2},"fn_name":null},{"line":520,"address":[270262,270184],"length":1,"stats":{"Line":2},"fn_name":null},{"line":523,"address":[270021],"length":1,"stats":{"Line":1},"fn_name":null},{"line":534,"address":[270272],"length":1,"stats":{"Line":2},"fn_name":"idx"},{"line":535,"address":[270312,270354],"length":1,"stats":{"Line":2},"fn_name":null},{"line":536,"address":[270327],"length":1,"stats":{"Line":2},"fn_name":null},{"line":537,"address":[270385,270689],"length":1,"stats":{"Line":0},"fn_name":null},{"line":538,"address":[270412,270626],"length":1,"stats":{"Line":0},"fn_name":null},{"line":539,"address":[270439,270563],"length":1,"stats":{"Line":0},"fn_name":null},{"line":540,"address":[270463],"length":1,"stats":{"Line":0},"fn_name":null},{"line":543,"address":[270752],"length":1,"stats":{"Line":2},"fn_name":"for_idx"},{"line":545,"address":[270764,270787],"length":1,"stats":{"Line":4},"fn_name":null},{"line":546,"address":[270899,270773],"length":1,"stats":{"Line":4},"fn_name":null},{"line":547,"address":[271050,270878],"length":1,"stats":{"Line":0},"fn_name":null},{"line":548,"address":[271029,271201],"length":1,"stats":{"Line":0},"fn_name":null},{"line":549,"address":[271180,271369],"length":1,"stats":{"Line":0},"fn_name":null},{"line":550,"address":[271521,271343],"length":1,"stats":{"Line":0},"fn_name":null},{"line":553,"address":[271600,271640],"length":1,"stats":{"Line":4},"fn_name":"entrance"},{"line":560,"address":[271728],"length":1,"stats":{"Line":2},"fn_name":"idx"},{"line":561,"address":[271739],"length":1,"stats":{"Line":2},"fn_name":null},{"line":562,"address":[271770],"length":1,"stats":{"Line":2},"fn_name":null},{"line":563,"address":[271781],"length":1,"stats":{"Line":2},"fn_name":null},{"line":564,"address":[271792],"length":1,"stats":{"Line":2},"fn_name":null},{"line":565,"address":[271803],"length":1,"stats":{"Line":2},"fn_name":null},{"line":569,"address":[271824],"length":1,"stats":{"Line":2},"fn_name":"from_letter"},{"line":570,"address":[271834],"length":1,"stats":{"Line":2},"fn_name":null},{"line":571,"address":[271875],"length":1,"stats":{"Line":2},"fn_name":null},{"line":572,"address":[271882],"length":1,"stats":{"Line":2},"fn_name":null},{"line":573,"address":[271889],"length":1,"stats":{"Line":2},"fn_name":null},{"line":574,"address":[271896],"length":1,"stats":{"Line":2},"fn_name":null},{"line":575,"address":[271903,271868],"length":1,"stats":{"Line":2},"fn_name":null},{"line":578,"address":[271931,271920],"length":1,"stats":{"Line":4},"fn_name":"cost"},{"line":579,"address":[272027,272016],"length":1,"stats":{"Line":0},"fn_name":"letter"},{"line":593,"address":[125600,125723],"length":1,"stats":{"Line":3},"fn_name":"test_state_finished"},{"line":594,"address":[125607,125753,125786],"length":1,"stats":{"Line":2},"fn_name":null},{"line":595,"address":[125946,125816,125759],"length":1,"stats":{"Line":2},"fn_name":null},{"line":633,"address":[208288,209701,209792],"length":1,"stats":{"Line":0},"fn_name":"run"},{"line":634,"address":[208295],"length":1,"stats":{"Line":0},"fn_name":null},{"line":635,"address":[208342,208414],"length":1,"stats":{"Line":0},"fn_name":null},{"line":636,"address":[208616,208407,208472],"length":1,"stats":{"Line":0},"fn_name":null},{"line":637,"address":[208799,208590],"length":1,"stats":{"Line":0},"fn_name":null},{"line":638,"address":[209126,208889],"length":1,"stats":{"Line":0},"fn_name":null},{"line":639,"address":[208918,209131,209021],"length":1,"stats":{"Line":0},"fn_name":null},{"line":641,"address":[208899],"length":1,"stats":{"Line":0},"fn_name":null},{"line":642,"address":[209300],"length":1,"stats":{"Line":0},"fn_name":null},{"line":643,"address":[209445,209354,209566],"length":1,"stats":{"Line":0},"fn_name":null},{"line":645,"address":[209266],"length":1,"stats":{"Line":0},"fn_name":null},{"line":649,"address":[213452,216577,209808],"length":1,"stats":{"Line":0},"fn_name":"run_part"},{"line":650,"address":[210086,209853],"length":1,"stats":{"Line":0},"fn_name":null},{"line":651,"address":[210045],"length":1,"stats":{"Line":0},"fn_name":null},{"line":652,"address":[210056],"length":1,"stats":{"Line":0},"fn_name":null},{"line":653,"address":[210076],"length":1,"stats":{"Line":0},"fn_name":null},{"line":655,"address":[82930,82432,82798],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":656,"address":[82496],"length":1,"stats":{"Line":0},"fn_name":null},{"line":657,"address":[82811,82584,82517],"length":1,"stats":{"Line":0},"fn_name":null},{"line":658,"address":[82848,82893],"length":1,"stats":{"Line":0},"fn_name":null},{"line":659,"address":[82886,82925],"length":1,"stats":{"Line":0},"fn_name":null},{"line":661,"address":[82723],"length":1,"stats":{"Line":0},"fn_name":null},{"line":664,"address":[210276,210348],"length":1,"stats":{"Line":0},"fn_name":null},{"line":665,"address":[213744],"length":1,"stats":{"Line":0},"fn_name":null},{"line":666,"address":[210373,210472],"length":1,"stats":{"Line":0},"fn_name":null},{"line":667,"address":[210416],"length":1,"stats":{"Line":0},"fn_name":null},{"line":668,"address":[210399],"length":1,"stats":{"Line":0},"fn_name":null},{"line":670,"address":[210550,210610],"length":1,"stats":{"Line":0},"fn_name":null},{"line":671,"address":[210603],"length":1,"stats":{"Line":0},"fn_name":null},{"line":672,"address":[210691,210749],"length":1,"stats":{"Line":0},"fn_name":null},{"line":673,"address":[210786],"length":1,"stats":{"Line":0},"fn_name":null},{"line":675,"address":[210763],"length":1,"stats":{"Line":0},"fn_name":null},{"line":676,"address":[211042],"length":1,"stats":{"Line":0},"fn_name":null},{"line":678,"address":[82960,83010],"length":1,"stats":{"Line":0},"fn_name":"{closure#1}"},{"line":679,"address":[83088,83101],"length":1,"stats":{"Line":0},"fn_name":"{closure#2}"},{"line":681,"address":[211236],"length":1,"stats":{"Line":0},"fn_name":null},{"line":682,"address":[211375,211296],"length":1,"stats":{"Line":0},"fn_name":null},{"line":683,"address":[211394],"length":1,"stats":{"Line":0},"fn_name":null},{"line":684,"address":[211529],"length":1,"stats":{"Line":0},"fn_name":null},{"line":685,"address":[211652],"length":1,"stats":{"Line":0},"fn_name":null},{"line":687,"address":[211254,211815],"length":1,"stats":{"Line":0},"fn_name":null},{"line":688,"address":[211842],"length":1,"stats":{"Line":0},"fn_name":null},{"line":691,"address":[211951],"length":1,"stats":{"Line":0},"fn_name":null},{"line":692,"address":[83120,83134],"length":1,"stats":{"Line":0},"fn_name":"{closure#3}"},{"line":695,"address":[212072,212151],"length":1,"stats":{"Line":0},"fn_name":null},{"line":696,"address":[212178,212414],"length":1,"stats":{"Line":0},"fn_name":null},{"line":697,"address":[212470],"length":1,"stats":{"Line":0},"fn_name":null},{"line":698,"address":[212762],"length":1,"stats":{"Line":0},"fn_name":null},{"line":699,"address":[212836,213091],"length":1,"stats":{"Line":0},"fn_name":null},{"line":700,"address":[213131,213168],"length":1,"stats":{"Line":0},"fn_name":null},{"line":701,"address":[213228,213161],"length":1,"stats":{"Line":0},"fn_name":null},{"line":703,"address":[213049,213463],"length":1,"stats":{"Line":0},"fn_name":null},{"line":707,"address":[211917,213529],"length":1,"stats":{"Line":0},"fn_name":null},{"line":710,"address":[213538,210962],"length":1,"stats":{"Line":0},"fn_name":null},{"line":711,"address":[213693],"length":1,"stats":{"Line":0},"fn_name":null},{"line":713,"address":[213705],"length":1,"stats":{"Line":0},"fn_name":null},{"line":715,"address":[213883,210892,213783],"length":1,"stats":{"Line":0},"fn_name":null},{"line":717,"address":[213873],"length":1,"stats":{"Line":0},"fn_name":null},{"line":720,"address":[214033],"length":1,"stats":{"Line":0},"fn_name":null},{"line":721,"address":[83198,83184],"length":1,"stats":{"Line":0},"fn_name":"{closure#4}"},{"line":724,"address":[214202,214281],"length":1,"stats":{"Line":0},"fn_name":null},{"line":725,"address":[214296],"length":1,"stats":{"Line":0},"fn_name":null},{"line":726,"address":[214340],"length":1,"stats":{"Line":0},"fn_name":null},{"line":727,"address":[214398],"length":1,"stats":{"Line":0},"fn_name":null},{"line":728,"address":[214456],"length":1,"stats":{"Line":0},"fn_name":null},{"line":730,"address":[214535,214302],"length":1,"stats":{"Line":0},"fn_name":null},{"line":731,"address":[214619],"length":1,"stats":{"Line":0},"fn_name":null},{"line":732,"address":[214837],"length":1,"stats":{"Line":0},"fn_name":null},{"line":733,"address":[214903],"length":1,"stats":{"Line":0},"fn_name":null},{"line":734,"address":[215026],"length":1,"stats":{"Line":0},"fn_name":null},{"line":735,"address":[215192,215229],"length":1,"stats":{"Line":0},"fn_name":null},{"line":736,"address":[215507,215206,215318],"length":1,"stats":{"Line":0},"fn_name":null},{"line":737,"address":[215563],"length":1,"stats":{"Line":0},"fn_name":null},{"line":738,"address":[215838,216069],"length":1,"stats":{"Line":0},"fn_name":null},{"line":739,"address":[216106,216137],"length":1,"stats":{"Line":0},"fn_name":null},{"line":740,"address":[216130,216197],"length":1,"stats":{"Line":0},"fn_name":null},{"line":742,"address":[216027,216403],"length":1,"stats":{"Line":0},"fn_name":null},{"line":745,"address":[215492,216454],"length":1,"stats":{"Line":0},"fn_name":null},{"line":746,"address":[216427],"length":1,"stats":{"Line":0},"fn_name":null},{"line":750,"address":[216592,217395],"length":1,"stats":{"Line":0},"fn_name":"print_next_states"},{"line":751,"address":[216685],"length":1,"stats":{"Line":0},"fn_name":null},{"line":752,"address":[216749],"length":1,"stats":{"Line":0},"fn_name":null},{"line":753,"address":[217140,216902],"length":1,"stats":{"Line":0},"fn_name":null},{"line":754,"address":[217164],"length":1,"stats":{"Line":0},"fn_name":null},{"line":755,"address":[217429],"length":1,"stats":{"Line":0},"fn_name":null},{"line":756,"address":[217565],"length":1,"stats":{"Line":0},"fn_name":null},{"line":758,"address":[217618,217526],"length":1,"stats":{"Line":0},"fn_name":null},{"line":762,"address":[217637,216726],"length":1,"stats":{"Line":0},"fn_name":null},{"line":763,"address":[217865],"length":1,"stats":{"Line":0},"fn_name":null},{"line":764,"address":[218267,218089],"length":1,"stats":{"Line":0},"fn_name":null},{"line":765,"address":[218287],"length":1,"stats":{"Line":0},"fn_name":null},{"line":767,"address":[218225,218436],"length":1,"stats":{"Line":0},"fn_name":null},{"line":768,"address":[218458],"length":1,"stats":{"Line":0},"fn_name":null},{"line":769,"address":[218717],"length":1,"stats":{"Line":0},"fn_name":null},{"line":770,"address":[218980,219139],"length":1,"stats":{"Line":0},"fn_name":null},{"line":771,"address":[219155],"length":1,"stats":{"Line":0},"fn_name":null},{"line":773,"address":[219092,219371],"length":1,"stats":{"Line":0},"fn_name":null},{"line":783,"address":[219392],"length":1,"stats":{"Line":0},"fn_name":"internals"},{"line":784,"address":[219396],"length":1,"stats":{"Line":0},"fn_name":null},{"line":785,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":786,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":787,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":788,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":789,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":791,"address":[219441],"length":1,"stats":{"Line":0},"fn_name":null},{"line":792,"address":[219446],"length":1,"stats":{"Line":0},"fn_name":null},{"line":793,"address":[219451],"length":1,"stats":{"Line":0},"fn_name":null},{"line":794,"address":[219456],"length":1,"stats":{"Line":0},"fn_name":null},{"line":795,"address":[219461],"length":1,"stats":{"Line":0},"fn_name":null},{"line":796,"address":[219466],"length":1,"stats":{"Line":0},"fn_name":null},{"line":815,"address":[241881,241872],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":816,"address":[305687,305926],"length":1,"stats":{"Line":1},"fn_name":null},{"line":817,"address":[305906],"length":1,"stats":{"Line":1},"fn_name":null},{"line":821,"address":[241920,241929],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":822,"address":[305975,306214],"length":1,"stats":{"Line":1},"fn_name":null},{"line":823,"address":[306194],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":291,"coverable":459},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-24","src","lib.rs"],"content":"//! Advent of Code 2021: Day 24: Arithmetic Logic Unit\n//!\n//! [https://adventofcode.com/2021/day/24](https://adventofcode.com/2021/day/24)\n\n#![ allow (clippy::missing_inline_in_public_items) ]\n#![ allow (dead_code) ]\n\nuse aoc_common::*;\n\npuzzle_info! {\n\tname = \"Arithmetic Logic Unit\";\n\tyear = 2021;\n\tday = 24;\n\tpart_one = |lines| logic::part_one (lines);\n\tpart_two = |lines| logic::part_two (lines);\n\tcommands = [\n\t\t( name = \"all\"; method = tool::all; ),\n\t\t( name = \"machine\"; method = tool::machine; ),\n\t\t( name = \"solver\"; method = tool::solver; ),\n\t];\n}\n\npub mod machine;\npub mod quick;\npub mod solver;\n\npub mod logic {\n\n\tuse super::*;\n\tuse machine::Instr;\n\n\tpub fn part_one (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cString\u003e {\n\t\tlet prog = machine::parse_prog (lines) ?;\n\t\tcalc_result (\u0026 prog, true)\n\t}\n\n\tpub fn part_two (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cString\u003e {\n\t\tlet prog = machine::parse_prog (lines) ?;\n\t\tcalc_result (\u0026 prog, false)\n\t}\n\n\tpub fn calc_result (prog: \u0026 [Instr], reverse: bool) -\u003e GenResult \u003cString\u003e {\n\t\tlet steps = quick::steps_for (prog) ?;\n\t\tlet result = quick::iterator (\u0026 steps, reverse).next ()\n\t\t\t.ok_or (\"Not found\") ?;\n\t\tOk (model::input_to_str (result))\n\t}\n\n}\n\npub mod model {\n\n\tuse super::*;\n\tuse nums::IntConv;\n\n\tpub type Input = [u8; 14];\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn input_from_str (input_str: \u0026 str) -\u003e Input {\n\t\tinput_str.chars ().map (\n\t\t\t|letter| letter.to_digit (10).unwrap ().as_u8 (),\n\t\t).collect::\u003cVec \u003cu8\u003e\u003e ().try_into ().unwrap ()\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn input_to_str (input: Input) -\u003e String {\n\t\tinput.into_iter ().map (\n\t\t\t|val| char::from_digit (val.as_u32 (), 10).unwrap (),\n\t\t).collect::\u003cString\u003e ()\n\t}\n\n}\n\npub mod tool {\n\n\tuse super::*;\n\tuse machine::Instr;\n\tuse machine::Machine;\n\tuse machine::MachineRegs;\n\tuse solver::Solver;\n\n\t#[ derive (clap::Parser) ]\n\tpub struct AllArgs {\n\t\tinput: String,\n\t}\n\n\t#[ allow (clippy::print_stdout) ]\n\tpub fn all (args: AllArgs) -\u003e GenResult \u003c()\u003e {\n\t\tlet input_string = fs::read_to_string (args.input) ?;\n\t\tlet input_lines: Vec \u003c\u0026 str\u003e = input_string.trim ().split ('\\n').collect ();\n\t\tlet prog = machine::parse_prog (\u0026 input_lines) ?;\n\t\tlet steps = quick::steps_for (\u0026 prog) ?;\n\t\tquick::iterator (\u0026 steps, false).for_each (\n\t\t\t|input| println! (\"{}\", model::input_to_str (input)),\n\t\t);\n\t\tOk (())\n\t}\n\n\t#[ derive (clap::Parser) ]\n\tpub struct MachineArgs { inputs: Vec \u003cString\u003e }\n\n\t#[ allow (clippy::needless_pass_by_value) ]\n\t#[ allow (clippy::print_stdout) ]\n\tpub fn machine (args: MachineArgs) -\u003e GenResult \u003c()\u003e {\n\t\tfn dump_regs (regs: \u0026 MachineRegs) -\u003e String {\n\t\t\tformat! (\"{:2}  {:10}  {:2}  {:10}\", regs.w, regs.x, regs.y, regs.z)\n\t\t}\n\t\tlet mut machines: Vec \u003c(Machine, [i64; 14])\u003e = args.inputs.iter ().map (\n\t\t\t|input_str| (\n\t\t\t\tMachine::new (),\n\t\t\t\tmachine::machine_input (model::input_from_str (input_str)),\n\t\t\t),\n\t\t).collect ();\n\t\tlet prog = load_prog () ?;\n\t\tlet mut done = false;\n\t\twhile ! done {\n\t\t\tif machines [0].0.regs.pc % 18 == 0 {\n\t\t\t\tprinter (\u0026 machines,\n\t\t\t\t\t|| print! (\"+-- {:2} ---------+\", machines [0].0.regs.pc / 18),\n\t\t\t\t\t|_| print! (\"--------------------------------+\"));\n\t\t\t}\n\t\t\tprinter (\u0026 machines,\n\t\t\t\t|| print! (\"| {:2}  {:9} |\", machines [0].0.regs.pc % 18 + 1,\n\t\t\t\t\tprog.get (machines [0].0.regs.pc)\n\t\t\t\t\t\t.map_or_else (|| \"(end)\".to_owned (), |instr| format! (\"{}\", instr))),\n\t\t\t\t|machine| print! (\" {:30} |\", dump_regs (\u0026 machine.regs)));\n\t\t\tfor \u0026 mut (ref mut machine, ref mut input) in machines.iter_mut () {\n\t\t\t\tif machine.step (\u0026 prog, input).map_err (|err| format! (\"{:?}\", err)) ? {\n\t\t\t\t\tdone = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tprinter (\u0026 machines,\n\t\t\t|| print! (\"+---------------+\"),\n\t\t\t|_| print! (\"--------------------------------+\"));\n\t\tprinter (\u0026 machines,\n\t\t\t|| print! (\"|               |\"),\n\t\t\t|machine| print! (\" {:30} |\", format! (\"Result: {}\", machine.regs.z)));\n\t\tprinter (\u0026 machines,\n\t\t\t|| print! (\"+---------------+\"),\n\t\t\t|_| print! (\"--------------------------------+\"));\n\t\treturn Ok (());\n\t\tfn printer \u003c\n\t\t\tBeforeFn: Fn (),\n\t\t\tEachFn: Fn (\u0026 Machine),\n\t\t\u003e (machines: \u0026 [(Machine, [i64; 14])], before_fn: BeforeFn, each_fn: EachFn) {\n\t\t\tbefore_fn ();\n\t\t\tfor \u0026 (ref machine, _) in machines.iter () {\n\t\t\t\teach_fn (machine);\n\t\t\t}\n\t\t\tprint! (\"\\n\");\n\t\t}\n\t}\n\n\t#[ derive (clap::Parser) ]\n\tpub struct SolverArgs {\n\t\targs: Vec \u003cString\u003e,\n\t}\n\n\t#[ allow (clippy::needless_pass_by_value) ]\n\tpub fn solver (args: SolverArgs) -\u003e GenResult \u003c()\u003e {\n\t\tlet prog = load_prog () ?;\n\t\tlet (solver, regs) = Solver::from_prog (\u0026 prog);\n\t\tlet reg_z =\n\t\t\tregs.into_iter ()\n\t\t\t\t.filter (|\u0026 (ref name, _)| name.as_ref () == \"z\")\n\t\t\t\t.map (|(_, reg)| reg)\n\t\t\t\t.next ()\n\t\t\t\t.unwrap ();\n\t\tmatch args.args [0].as_str () {\n\t\t\t\"solver-full\" =\u003e {\n\t\t\t\tsolver.dump (3, true);\n\t\t\t},\n\t\t\t\"solver-z\" =\u003e {\n\t\t\t\tsolver.dump_symbol (3, true, \u0026 reg_z);\n\t\t\t},\n\t\t\t\"solver-z-auto\" =\u003e {\n\t\t\t\tsolver.dump_symbol_auto (\u0026 reg_z);\n\t\t\t},\n\t\t\t_ =\u003e panic! (),\n\t\t}\n\t\tOk (())\n\t}\n\n\tfn load_prog () -\u003e GenResult \u003cVec \u003cInstr\u003e\u003e {\n\t\tlet input_string = fs::read_to_string (\"inputs/day-24\") ?;\n\t\tlet input_lines: Vec \u003c\u0026 str\u003e = input_string.trim ().split ('\\n').collect ();\n\t\tmachine::parse_prog (\u0026 input_lines)\n\t}\n\n}\n","traces":[{"line":10,"address":[262793,263385],"length":1,"stats":{"Line":0},"fn_name":null},{"line":14,"address":[262878],"length":1,"stats":{"Line":0},"fn_name":null},{"line":15,"address":[263470],"length":1,"stats":{"Line":0},"fn_name":null},{"line":32,"address":[444037,443760],"length":1,"stats":{"Line":0},"fn_name":"part_one"},{"line":33,"address":[443912,443793],"length":1,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[443891,444018],"length":1,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[444064,444338],"length":1,"stats":{"Line":0},"fn_name":"part_two"},{"line":38,"address":[444097,444216],"length":1,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[444195,444319],"length":1,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[444931,444368],"length":1,"stats":{"Line":0},"fn_name":"calc_result"},{"line":43,"address":[444557,444416],"length":1,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[444679,444632,444899,444526],"length":1,"stats":{"Line":0},"fn_name":null},{"line":46,"address":[444957],"length":1,"stats":{"Line":0},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":90,"address":[446247,445088,446296],"length":1,"stats":{"Line":0},"fn_name":"all"},{"line":91,"address":[445095,445281],"length":1,"stats":{"Line":0},"fn_name":null},{"line":92,"address":[445405,445264],"length":1,"stats":{"Line":0},"fn_name":null},{"line":93,"address":[445574,445483,445715],"length":1,"stats":{"Line":0},"fn_name":null},{"line":94,"address":[445695,445908,446057],"length":1,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[446213,446047],"length":1,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[317039,317024],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":98,"address":[446220],"length":1,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[447919,446320,447893],"length":1,"stats":{"Line":0},"fn_name":"machine"},{"line":107,"address":[447968],"length":1,"stats":{"Line":0},"fn_name":"dump_regs"},{"line":108,"address":[448006],"length":1,"stats":{"Line":0},"fn_name":null},{"line":110,"address":[446418,446335],"length":1,"stats":{"Line":0},"fn_name":null},{"line":111,"address":[317264,317376],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":112,"address":[317302],"length":1,"stats":{"Line":0},"fn_name":null},{"line":113,"address":[317317],"length":1,"stats":{"Line":0},"fn_name":null},{"line":116,"address":[446721,446523,446586],"length":1,"stats":{"Line":0},"fn_name":null},{"line":117,"address":[446708],"length":1,"stats":{"Line":0},"fn_name":null},{"line":118,"address":[446716,446864],"length":1,"stats":{"Line":0},"fn_name":null},{"line":119,"address":[446911,446993],"length":1,"stats":{"Line":0},"fn_name":null},{"line":120,"address":[447021,447107],"length":1,"stats":{"Line":0},"fn_name":null},{"line":121,"address":[317440,317449],"length":1,"stats":{"Line":0},"fn_name":"{closure#1}"},{"line":122,"address":[317616,317630],"length":1,"stats":{"Line":0},"fn_name":"{closure#2}"},{"line":124,"address":[447172,447052],"length":1,"stats":{"Line":0},"fn_name":null},{"line":125,"address":[317680,317798,317700,317912],"length":1,"stats":{"Line":0},"fn_name":"{closure#3}"},{"line":126,"address":[317777,317833],"length":1,"stats":{"Line":0},"fn_name":null},{"line":127,"address":[323571,323552,323504,323516],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":128,"address":[318308,318288],"length":1,"stats":{"Line":0},"fn_name":"{closure#4}"},{"line":129,"address":[447203],"length":1,"stats":{"Line":0},"fn_name":null},{"line":130,"address":[318544,318565],"length":1,"stats":{"Line":0},"fn_name":"{closure#5}"},{"line":131,"address":[447758],"length":1,"stats":{"Line":0},"fn_name":null},{"line":135,"address":[446885,447787],"length":1,"stats":{"Line":0},"fn_name":null},{"line":136,"address":[318672,318681],"length":1,"stats":{"Line":0},"fn_name":"{closure#6}"},{"line":137,"address":[318750,318736],"length":1,"stats":{"Line":0},"fn_name":"{closure#7}"},{"line":138,"address":[447802],"length":1,"stats":{"Line":0},"fn_name":null},{"line":139,"address":[318809,318800],"length":1,"stats":{"Line":0},"fn_name":"{closure#8}"},{"line":140,"address":[318900,318864],"length":1,"stats":{"Line":0},"fn_name":"{closure#9}"},{"line":141,"address":[447844],"length":1,"stats":{"Line":0},"fn_name":null},{"line":142,"address":[319273,319264],"length":1,"stats":{"Line":0},"fn_name":"{closure#10}"},{"line":143,"address":[319342,319328],"length":1,"stats":{"Line":0},"fn_name":"{closure#11}"},{"line":144,"address":[447876],"length":1,"stats":{"Line":0},"fn_name":null},{"line":145,"address":[319712,319682,320688,320368,320002,319392,320330,320978,320663,320032],"length":1,"stats":{"Line":0},"fn_name":"printer\u003caoc_2021_day_24::tool::machine::{closure_env#10}, aoc_2021_day_24::tool::machine::{closure_env#11}\u003e"},{"line":149,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":150,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":151,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":153,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":163,"address":[449025,448288,449510],"length":1,"stats":{"Line":0},"fn_name":"solver"},{"line":164,"address":[448376,448494,448300],"length":1,"stats":{"Line":0},"fn_name":null},{"line":165,"address":[448474,448687],"length":1,"stats":{"Line":0},"fn_name":null},{"line":166,"address":[448886,448978,448766],"length":1,"stats":{"Line":0},"fn_name":null},{"line":168,"address":[321008,321035],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":169,"address":[321104,321126],"length":1,"stats":{"Line":0},"fn_name":"{closure#1}"},{"line":172,"address":[449081],"length":1,"stats":{"Line":0},"fn_name":null},{"line":173,"address":[449156],"length":1,"stats":{"Line":0},"fn_name":null},{"line":174,"address":[449240],"length":1,"stats":{"Line":0},"fn_name":null},{"line":176,"address":[449199,449280],"length":1,"stats":{"Line":0},"fn_name":null},{"line":177,"address":[449345],"length":1,"stats":{"Line":0},"fn_name":null},{"line":179,"address":[449358,449296],"length":1,"stats":{"Line":0},"fn_name":null},{"line":180,"address":[449410],"length":1,"stats":{"Line":0},"fn_name":null},{"line":182,"address":[449364],"length":1,"stats":{"Line":0},"fn_name":null},{"line":184,"address":[449249],"length":1,"stats":{"Line":0},"fn_name":null},{"line":187,"address":[449973,449536,450000],"length":1,"stats":{"Line":0},"fn_name":"load_prog"},{"line":188,"address":[449553,449692],"length":1,"stats":{"Line":0},"fn_name":null},{"line":189,"address":[449670,449783],"length":1,"stats":{"Line":0},"fn_name":null},{"line":190,"address":[449861,449947],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":83},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-24","src","machine.rs"],"content":"use aoc_common::*;\nuse nums::IntConv;\n\npub fn parse_prog (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cVec \u003cInstr\u003e\u003e {\n\tlines.iter ().enumerate ().map (|(line_idx, line)| -\u003e GenResult \u003cInstr\u003e {\n\t\tlet err = || format! (\"Invalid input: {}: {}\", line_idx + 1, line);\n\t\tlet parse_reg = |input| Ok (match input {\n\t\t\t\"w\" =\u003e Reg::W,\n\t\t\t\"x\" =\u003e Reg::X,\n\t\t\t\"y\" =\u003e Reg::Y,\n\t\t\t\"z\" =\u003e Reg::Z,\n\t\t\t_ =\u003e return Err (err ()),\n\t\t});\n\t\tlet parse_reg_or_int = |input| -\u003e GenResult \u003cRegOrInt\u003e {\n\t\t\tOk (match input {\n\t\t\t\t\"w\" =\u003e RegOrInt::W,\n\t\t\t\t\"x\" =\u003e RegOrInt::X,\n\t\t\t\t\"y\" =\u003e RegOrInt::Y,\n\t\t\t\t\"z\" =\u003e RegOrInt::Z,\n\t\t\t\t_ =\u003e RegOrInt::Int (input.parse::\u003ci64\u003e ()\n\t\t\t\t\t.map_err (|_err| err ()) ?),\n\t\t\t})\n\t\t};\n\t\tlet line_parts: Vec \u003c\u0026 str\u003e = line.split (' ').collect ();\n\t\tlet instr_str = line_parts [0];\n\t\tlet instr_args = \u0026 line_parts [1 .. ];\n\t\tOk (match (instr_str, instr_args.len ()) {\n\t\t\t(\"inp\", 1) =\u003e Instr::Inp (parse_reg (instr_args [0]) ?),\n\t\t\t(\"add\", 2) =\u003e Instr::Add (parse_reg (instr_args [0]) ?, parse_reg_or_int (instr_args [1]) ?),\n\t\t\t(\"mul\", 2) =\u003e Instr::Mul (parse_reg (instr_args [0]) ?, parse_reg_or_int (instr_args [1]) ?),\n\t\t\t(\"div\", 2) =\u003e Instr::Div (parse_reg (instr_args [0]) ?, parse_reg_or_int (instr_args [1]) ?),\n\t\t\t(\"mod\", 2) =\u003e Instr::Mod (parse_reg (instr_args [0]) ?, parse_reg_or_int (instr_args [1]) ?),\n\t\t\t(\"eql\", 2) =\u003e Instr::Eql (parse_reg (instr_args [0]) ?, parse_reg_or_int (instr_args [1]) ?),\n\t\t\t_ =\u003e Err (err ()) ?,\n\t\t})\n\t}).collect ()\n}\n\n#[ must_use ]\npub fn machine_input (input: [u8; 14]) -\u003e [i64; 14] {\n\tlet mut result = [0; 14];\n\tfor idx in 0 .. 14 { result [idx] = input [idx].as_i64 (); }\n\tresult\n}\n\n#[ derive (Clone, Debug, Default, Eq, Hash, PartialEq) ]\npub struct Machine {\n\tpub regs: MachineRegs,\n}\n\n#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\npub enum MachineError {\n\tNoMoreInput,\n\tDivideByZero,\n\tNegativeModulo,\n}\n\nimpl Machine {\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn new () -\u003e Self {\n\t\tSelf { regs: default () }\n\t}\n\n\tpub fn step (\u0026 mut self, prog: \u0026 [Instr], input: \u0026 [i64]) -\u003e Result \u003cbool, MachineError\u003e {\n\t\tlet instr = match prog.get (self.regs.pc) {\n\t\t\tSome (\u0026 instr) =\u003e instr,\n\t\t\tNone =\u003e return Ok (true),\n\t\t};\n\t\tmatch instr {\n\t\t\tInstr::Inp (dest) =\u003e {\n\t\t\t\tlet val = match input.get (self.regs.ic) {\n\t\t\t\t\tSome (\u0026 val) =\u003e val,\n\t\t\t\t\tNone =\u003e return Err (MachineError::NoMoreInput),\n\t\t\t\t};\n\t\t\t\tself.regs.ic += 1;\n\t\t\t\tself.regs.store (dest, val);\n\t\t\t},\n\t\t\tInstr::Add (dest, src) =\u003e {\n\t\t\t\tlet src_val = self.regs.retrieve_or_int (src);\n\t\t\t\tlet dst_val = self.regs.retrieve (dest);\n\t\t\t\tself.regs.store (dest, dst_val + src_val);\n\t\t\t},\n\t\t\tInstr::Mul (dest, src) =\u003e {\n\t\t\t\tlet src_val = self.regs.retrieve_or_int (src);\n\t\t\t\tlet dst_val = self.regs.retrieve (dest);\n\t\t\t\tself.regs.store (dest, dst_val * src_val);\n\t\t\t},\n\t\t\tInstr::Div (dest, src) =\u003e {\n\t\t\t\tlet src_val = self.regs.retrieve_or_int (src);\n\t\t\t\tif src_val == 0 { Err (MachineError::DivideByZero) ? }\n\t\t\t\tlet dst_val = self.regs.retrieve (dest);\n\t\t\t\tself.regs.store (dest, dst_val / src_val);\n\t\t\t},\n\t\t\tInstr::Mod (dest, src) =\u003e {\n\t\t\t\tlet src_val = self.regs.retrieve_or_int (src);\n\t\t\t\tif src_val == 0 { Err (MachineError::DivideByZero) ? }\n\t\t\t\tlet dst_val = self.regs.retrieve (dest);\n\t\t\t\tself.regs.store (dest, dst_val % src_val);\n\t\t\t},\n\t\t\tInstr::Eql (dest, src) =\u003e {\n\t\t\t\tlet src_val = self.regs.retrieve_or_int (src);\n\t\t\t\tlet dst_val = self.regs.retrieve (dest);\n\t\t\t\tself.regs.store (dest, if dst_val == src_val { 1 } else { 0 });\n\t\t\t},\n\t\t}\n\t\tself.regs.pc += 1;\n\t\tOk (false)\n\t}\n\t#[ allow (dead_code) ]\n\tfn execute (\u0026 mut self, prog: \u0026 [Instr], input: \u0026 [i64]) -\u003e Result \u003c(), MachineError\u003e {\n\t\tloop {\n\t\t\tmatch self.step (prog, input) {\n\t\t\t\tOk (true) =\u003e break,\n\t\t\t\tOk (false) =\u003e continue,\n\t\t\t\tErr (err) =\u003e Err (err) ?,\n\t\t\t}\n\t\t}\n\t\tOk (())\n\t}\n}\n\n#[ derive (Clone, Copy, Debug, Default, Eq, Hash, PartialEq) ]\npub struct MachineRegs {\n\tpub w: i64,\n\tpub x: i64,\n\tpub y: i64,\n\tpub z: i64,\n\tpub pc: usize,\n\tpub ic: usize,\n}\n\nimpl MachineRegs {\n\tfn store (\u0026 mut self, reg: Reg, val: i64) {\n\t\tmatch reg {\n\t\t\tReg::W =\u003e self.w = val,\n\t\t\tReg::X =\u003e self.x = val,\n\t\t\tReg::Y =\u003e self.y = val,\n\t\t\tReg::Z =\u003e self.z = val,\n\t\t}\n\t}\n\tconst fn retrieve (\u0026 self, reg: Reg) -\u003e i64 {\n\t\tmatch reg {\n\t\t\tReg::W =\u003e self.w,\n\t\t\tReg::X =\u003e self.x,\n\t\t\tReg::Y =\u003e self.y,\n\t\t\tReg::Z =\u003e self.z,\n\t\t}\n\t}\n\tconst fn retrieve_or_int (\u0026 self, reg_or_int: RegOrInt) -\u003e i64 {\n\t\tmatch reg_or_int {\n\t\t\tRegOrInt::W =\u003e self.w,\n\t\t\tRegOrInt::X =\u003e self.x,\n\t\t\tRegOrInt::Y =\u003e self.y,\n\t\t\tRegOrInt::Z =\u003e self.z,\n\t\t\tRegOrInt::Int (val) =\u003e val,\n\t\t}\n\t}\n}\n\n#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\npub enum Instr {\n\tInp (Reg),\n\tAdd (Reg, RegOrInt),\n\tMul (Reg, RegOrInt),\n\tDiv (Reg, RegOrInt),\n\tMod (Reg, RegOrInt),\n\tEql (Reg, RegOrInt),\n}\n\nimpl fmt::Display for Instr {\n\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\tmatch * self {\n\t\t\tSelf::Inp (arg) =\u003e write! (formatter, \"inp {}\", arg) ?,\n\t\t\tSelf::Add (left, right) =\u003e write! (formatter, \"add {} {}\", left, right) ?,\n\t\t\tSelf::Mul (left, right) =\u003e write! (formatter, \"mul {} {}\", left, right) ?,\n\t\t\tSelf::Div (left, right) =\u003e write! (formatter, \"div {} {}\", left, right) ?,\n\t\t\tSelf::Mod (left, right) =\u003e write! (formatter, \"mod {} {}\", left, right) ?,\n\t\t\tSelf::Eql (left, right) =\u003e write! (formatter, \"eql {} {}\", left, right) ?,\n\t\t}\n\t\tOk (())\n\t}\n}\n\n#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\npub enum RegOrInt { W, X, Y, Z, Int (i64) }\n\nimpl fmt::Display for RegOrInt {\n\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\tmatch * self {\n\t\t\tSelf::W =\u003e write! (formatter, \"w\") ?,\n\t\t\tSelf::X =\u003e write! (formatter, \"x\") ?,\n\t\t\tSelf::Y =\u003e write! (formatter, \"y\") ?,\n\t\t\tSelf::Z =\u003e write! (formatter, \"z\") ?,\n\t\t\tSelf::Int (val) =\u003e write! (formatter, \"{}\", val) ?,\n\t\t}\n\t\tOk (())\n\t}\n}\n\n#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\npub enum Reg { W, X, Y, Z }\n\nimpl fmt::Display for Reg {\n\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\tmatch * self {\n\t\t\tSelf::W =\u003e write! (formatter, \"w\") ?,\n\t\t\tSelf::X =\u003e write! (formatter, \"x\") ?,\n\t\t\tSelf::Y =\u003e write! (formatter, \"y\") ?,\n\t\t\tSelf::Z =\u003e write! (formatter, \"z\") ?,\n\t\t}\n\t\tOk (())\n\t}\n}\n","traces":[{"line":4,"address":[118224],"length":1,"stats":{"Line":0},"fn_name":"parse_prog"},{"line":5,"address":[118274],"length":1,"stats":{"Line":0},"fn_name":null},{"line":6,"address":[117038,112371,117008],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":7,"address":[117398,117264,117558,117598,112394],"length":1,"stats":{"Line":0},"fn_name":"{closure#1}"},{"line":8,"address":[117388,117324],"length":1,"stats":{"Line":0},"fn_name":null},{"line":9,"address":[117456,117417,117365],"length":1,"stats":{"Line":0},"fn_name":null},{"line":10,"address":[117467,117506,117433],"length":1,"stats":{"Line":0},"fn_name":null},{"line":11,"address":[117517,117483,117543],"length":1,"stats":{"Line":0},"fn_name":null},{"line":12,"address":[117528,117568],"length":1,"stats":{"Line":0},"fn_name":null},{"line":14,"address":[117600,112407,117775,118158],"length":1,"stats":{"Line":0},"fn_name":"{closure#2}"},{"line":15,"address":[117750],"length":1,"stats":{"Line":0},"fn_name":null},{"line":16,"address":[117672,117736],"length":1,"stats":{"Line":0},"fn_name":null},{"line":17,"address":[117784,117823,117713],"length":1,"stats":{"Line":0},"fn_name":null},{"line":18,"address":[117800,117838,117877],"length":1,"stats":{"Line":0},"fn_name":null},{"line":19,"address":[117927,117895,117854],"length":1,"stats":{"Line":0},"fn_name":null},{"line":20,"address":[117911,117957,118138],"length":1,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[118041,118198,117946,118176],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":24,"address":[112420],"length":1,"stats":{"Line":0},"fn_name":null},{"line":25,"address":[112473,112557],"length":1,"stats":{"Line":0},"fn_name":null},{"line":26,"address":[112590],"length":1,"stats":{"Line":0},"fn_name":null},{"line":27,"address":[115349,113973,114661,112826,112684,113171,113285,116018],"length":1,"stats":{"Line":0},"fn_name":null},{"line":28,"address":[112735,112842],"length":1,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[113630,113301,112784,113237],"length":1,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[113925,113989,113243,114318],"length":1,"stats":{"Line":0},"fn_name":null},{"line":31,"address":[113931,114613,114677,115006],"length":1,"stats":{"Line":0},"fn_name":null},{"line":32,"address":[115365,114619,115694,115301],"length":1,"stats":{"Line":0},"fn_name":null},{"line":33,"address":[115307,116034,115989,116363],"length":1,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[116654,116008],"length":1,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[113147,112508,113214],"length":1,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[118352],"length":1,"stats":{"Line":0},"fn_name":"machine_input"},{"line":41,"address":[118374],"length":1,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[118386,118500],"length":1,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":63,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":66,"address":[118720],"length":1,"stats":{"Line":0},"fn_name":"step"},{"line":67,"address":[118829],"length":1,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[118892],"length":1,"stats":{"Line":0},"fn_name":null},{"line":69,"address":[118871],"length":1,"stats":{"Line":0},"fn_name":null},{"line":71,"address":[118955],"length":1,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[119021],"length":1,"stats":{"Line":0},"fn_name":null},{"line":73,"address":[120613,119042],"length":1,"stats":{"Line":0},"fn_name":null},{"line":74,"address":[120667],"length":1,"stats":{"Line":0},"fn_name":null},{"line":75,"address":[120638],"length":1,"stats":{"Line":0},"fn_name":null},{"line":77,"address":[120761,120699],"length":1,"stats":{"Line":0},"fn_name":null},{"line":78,"address":[120748],"length":1,"stats":{"Line":0},"fn_name":null},{"line":80,"address":[119072],"length":1,"stats":{"Line":0},"fn_name":null},{"line":81,"address":[119125],"length":1,"stats":{"Line":0},"fn_name":null},{"line":82,"address":[120491],"length":1,"stats":{"Line":0},"fn_name":null},{"line":83,"address":[120538],"length":1,"stats":{"Line":0},"fn_name":null},{"line":85,"address":[119159],"length":1,"stats":{"Line":0},"fn_name":null},{"line":86,"address":[119212],"length":1,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[120353],"length":1,"stats":{"Line":0},"fn_name":null},{"line":88,"address":[120400],"length":1,"stats":{"Line":0},"fn_name":null},{"line":90,"address":[119246],"length":1,"stats":{"Line":0},"fn_name":null},{"line":91,"address":[119299],"length":1,"stats":{"Line":0},"fn_name":null},{"line":92,"address":[120084,120010],"length":1,"stats":{"Line":0},"fn_name":null},{"line":93,"address":[120061],"length":1,"stats":{"Line":0},"fn_name":null},{"line":94,"address":[120177],"length":1,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[119333],"length":1,"stats":{"Line":0},"fn_name":null},{"line":97,"address":[119386],"length":1,"stats":{"Line":0},"fn_name":null},{"line":98,"address":[119734,119660],"length":1,"stats":{"Line":0},"fn_name":null},{"line":99,"address":[119711],"length":1,"stats":{"Line":0},"fn_name":null},{"line":100,"address":[119844],"length":1,"stats":{"Line":0},"fn_name":null},{"line":102,"address":[119420],"length":1,"stats":{"Line":0},"fn_name":null},{"line":103,"address":[119473],"length":1,"stats":{"Line":0},"fn_name":null},{"line":104,"address":[119509],"length":1,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[119556],"length":1,"stats":{"Line":0},"fn_name":null},{"line":108,"address":[120829,119623,120804],"length":1,"stats":{"Line":0},"fn_name":null},{"line":109,"address":[120808],"length":1,"stats":{"Line":0},"fn_name":null},{"line":112,"address":[120864],"length":1,"stats":{"Line":0},"fn_name":"execute"},{"line":114,"address":[120941],"length":1,"stats":{"Line":0},"fn_name":null},{"line":117,"address":[120978],"length":1,"stats":{"Line":0},"fn_name":null},{"line":120,"address":[121060],"length":1,"stats":{"Line":0},"fn_name":null},{"line":135,"address":[121072],"length":1,"stats":{"Line":0},"fn_name":"store"},{"line":136,"address":[121102],"length":1,"stats":{"Line":0},"fn_name":null},{"line":137,"address":[121144],"length":1,"stats":{"Line":0},"fn_name":null},{"line":138,"address":[121158],"length":1,"stats":{"Line":0},"fn_name":null},{"line":139,"address":[121173],"length":1,"stats":{"Line":0},"fn_name":null},{"line":140,"address":[121188],"length":1,"stats":{"Line":0},"fn_name":null},{"line":143,"address":[121200],"length":1,"stats":{"Line":0},"fn_name":"retrieve"},{"line":144,"address":[121220],"length":1,"stats":{"Line":0},"fn_name":null},{"line":145,"address":[121257],"length":1,"stats":{"Line":0},"fn_name":null},{"line":146,"address":[121271],"length":1,"stats":{"Line":0},"fn_name":null},{"line":147,"address":[121286],"length":1,"stats":{"Line":0},"fn_name":null},{"line":148,"address":[121301],"length":1,"stats":{"Line":0},"fn_name":null},{"line":151,"address":[121328],"length":1,"stats":{"Line":0},"fn_name":"retrieve_or_int"},{"line":152,"address":[121351],"length":1,"stats":{"Line":0},"fn_name":null},{"line":153,"address":[121388],"length":1,"stats":{"Line":0},"fn_name":null},{"line":154,"address":[121402],"length":1,"stats":{"Line":0},"fn_name":null},{"line":155,"address":[121417],"length":1,"stats":{"Line":0},"fn_name":null},{"line":156,"address":[121432],"length":1,"stats":{"Line":0},"fn_name":null},{"line":157,"address":[121443],"length":1,"stats":{"Line":0},"fn_name":null},{"line":173,"address":[121472],"length":1,"stats":{"Line":0},"fn_name":"fmt"},{"line":174,"address":[121511],"length":1,"stats":{"Line":0},"fn_name":null},{"line":175,"address":[123111,121556],"length":1,"stats":{"Line":0},"fn_name":null},{"line":176,"address":[122874,121608],"length":1,"stats":{"Line":0},"fn_name":null},{"line":177,"address":[121684,122653],"length":1,"stats":{"Line":0},"fn_name":null},{"line":178,"address":[122432,121760],"length":1,"stats":{"Line":0},"fn_name":null},{"line":179,"address":[121836,122211],"length":1,"stats":{"Line":0},"fn_name":null},{"line":180,"address":[121912,122169],"length":1,"stats":{"Line":0},"fn_name":null},{"line":182,"address":[122159],"length":1,"stats":{"Line":0},"fn_name":null},{"line":190,"address":[123280],"length":1,"stats":{"Line":0},"fn_name":"fmt"},{"line":191,"address":[123313],"length":1,"stats":{"Line":0},"fn_name":null},{"line":192,"address":[123344,124002],"length":1,"stats":{"Line":0},"fn_name":null},{"line":193,"address":[123383,123914],"length":1,"stats":{"Line":0},"fn_name":null},{"line":194,"address":[123422,123817],"length":1,"stats":{"Line":0},"fn_name":null},{"line":195,"address":[123727,123464],"length":1,"stats":{"Line":0},"fn_name":null},{"line":196,"address":[123511,123686],"length":1,"stats":{"Line":0},"fn_name":null},{"line":198,"address":[123679],"length":1,"stats":{"Line":0},"fn_name":null},{"line":206,"address":[124096],"length":1,"stats":{"Line":0},"fn_name":"fmt"},{"line":207,"address":[124124],"length":1,"stats":{"Line":0},"fn_name":null},{"line":208,"address":[124155,124607],"length":1,"stats":{"Line":0},"fn_name":null},{"line":209,"address":[124194,124519],"length":1,"stats":{"Line":0},"fn_name":null},{"line":210,"address":[124233,124429],"length":1,"stats":{"Line":0},"fn_name":null},{"line":211,"address":[124388,124275],"length":1,"stats":{"Line":0},"fn_name":null},{"line":213,"address":[124381],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":116},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-24","src","quick.rs"],"content":"//! Quick algorithm found by reverse engineering the input programme.\n//!\n//! # Quick start\n//!\n//! Call [`iterator`] to create an iterator over the valid solutions:\n//!\n//! ```\n//! # use aoc_2021_day_24::*;\n//! # let steps = [quick::Step { random: false, check: 0, increment: 0 }; 14];\n//! for solution in quick::iterator (\u0026 steps, true) {\n//!   println! (\"{:?}\", solution);\n//! }\n//! ```\n//!\n//! # Description\n//!\n//! Looking carefully at the provided programme, it seems to be the same 18 instructions repeated,\n//! once for every input character. There are only three that vary. Here's the template:\n//!\n//! ```text\n//!  1  inp w\n//!  2  mul x 0\n//!  3  add x z\n//!  4  mod x 26\n//!  5  div z (1 or 26)\n//!  6  add x (-16 to 13)\n//!  7  eql x w\n//!  8  eql x 0\n//!  9  mul y 0\n//! 10  add y 25\n//! 11  mul y x\n//! 12  add y 1\n//! 13  mul z y\n//! 14  mul y 0\n//! 15  mul y w\n//! 16  add y (3 to 15)\n//! 17  mul y x\n//! 18  add z y\n//! ```\n//!\n//! So, the registers seem to be used as follows:\n//!\n//!\n//! * `w` --- The current input value. This is loaded in the first instruction and not modified\n//! again.\n//! * `x` --- Temporary value, the value from the previous step is discarded. This is set to `0` if\n//! the input value matches a calculation based on `z` and a parameter which varies for each step,\n//! or to `1` otherwise.\n//! * `y` --- Another temporary value, this is used to calculate values based on `x`, `w` and a\n//! parameter, and then used to update `z`. The value is carefully calculated to not update `z` if\n//! `x` is set to `0`, by setting it to `1` for a multiply or `0` for an add.\n//! * `z` --- An accumulator, which is kept between steps. This starts off at `0` and gets\n//! conditionally multiplied by 26, divided by 26, and added to.\n//!\n//! We can compile the differences in each step into a table of parameters. Since a divide by one\n//! is an identity operation, we reduce the first difference into a boolean, tracking whether we\n//! will divide of not. We will name the other two parameters `check` and `increment`, based on\n//! how they are used. So using the programme I was given as an example, we end up with the\n//! following:\n//!\n//! | Parameter   | 1    | 2    | 3    | 4    | 5    | 6     | 7    | 8     | 9     | 10   | 11   | 12   | 13   | 14    |\n//! |-------------|:----:|:----:|:----:|:----:|:----:|:-----:|:----:|:-----:|:-----:|:----:|:----:|:----:|:----:|:-----:|\n//! | `divide`    |      |      |      |      |      | yes   |      | yes   | yes   |      | yes  | yes  | yes  | yes   |\n//! | `check`     | `10` | `12` | `10` | `12` | `11` | `-16` | `10` | `-11` | `-13` | `13` | `-8` | `-1` | `-4` | `-14` |\n//! | `increment` | `12` | `7`  | `8`  | `8`  | `15` | `12`  | `8`  | `13`  | `3`   | `13` | `3`  | `9`  | `4`  | `13`  |\n//!\n//! And we can descibe the algorithm for each step as code. Here we use `acc` to refer to the\n//! shared state stored in register `z`, and we expect the parameters for each step to be passed in\n//! a struct:\n//!\n//! ```\n//! struct StepParams {\n//!     divide: bool,\n//!     check: i64,\n//!     increment: i64,\n//! }\n//! fn apply_step (params: \u0026 StepParams, acc: \u0026 mut i64, input: i64) {\n//!     if input == * acc % 26 + params.check { // instructions 2-4,6-8\n//!         if params.divide { * acc /= 26; }   // instruction 5\n//!     } else {\n//!         if ! params.divide { * acc *= 26; } // instructions 9-13\n//!         * acc += input + params.increment;  // instructions 14-18\n//!     }\n//! }\n//! ```\n//!\n//! We can either divide `acc` by 26, multiply it by 26 and add something, or just add something.\n//! Furthermore, in seven of our fourteen steps we always multiply, so to get this value down to\n//! zero we are going to have to make sure we divide on all seven of the other steps. The extra\n//! addition from increment will have to be removed as a rounding error from the division - this\n//! presumably is intended to reduce the total number of valid inputs.\n//!\n//! Since we are deciding whether to divide based on a value derived from `acc` and `check`, we\n//! can simply calculate the correct value based on the previous digits. This reduces our problem\n//! from searching 9¹⁴ (twenty-three trillion) combinations, down to only 9⁷ (five million). What's\n//! more, we will often be able to shortcut the search if there is no matching next digit.\n//!\n//! This leads to the algorithm implemented here. The steps are encoded in the [`Step`] struct, and\n//! the `steps_for` function reads an input programme and identifies the correct parameters for\n//! step. I inverted the `divide` parameter around and called it [`random`][Step::random] - this\n//! indicates that we should choose a random value for this input value, or in practice try all\n//! possible values. The `iterator` function returns an iterator over all of the valid inputs,\n//! actually 14 nested iterators plus a final call to `map` at the end to check the final sum, and\n//! to convert to match the function signature.\n//!\n//! The actual algorithm is implemented in the [`NextNumIter`] struct. This is an iterator adapter,\n//! which takes an iterator over partial solutions and provides the possible answers with the\n//! next digit included. If this is a `random` step, then this expands every `n`-digit entry into\n//! nine `n+1`-digit entries, one for each valid digit. Otherwise, it will either provide a single\n//! entry with the appropriate next digit, or no entries if the correct next digit is not in the\n//! valid range.\n//!\n//! # Performance\n//!\n//! This shows the time for finding the answers for the puzzle, and for finding all valid codes,\n//! plus the peak memory usage, for each build version.\n//!\n//! | Version | Puzzle    | All        | Memory   |\n//! |:-------:|:---------:|:----------:|:--------:|\n//! | Debug   | 0.56 secs | 2.23 secs  | 2.88 MiB |\n//! | Release | 0.10 secs | 0.39 secs  | 2.20 MiB |\n\nuse super::*;\nuse machine::Instr;\nuse machine::Reg;\nuse machine::RegOrInt;\nuse model::Input;\nuse nums::IntConv;\n\n#[ derive (Clone, Copy, Debug) ]\npub struct Step {\n\tpub random: bool,\n\tpub check: i64,\n\tpub increment: i64,\n}\n\nimpl Step {\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub const fn new (random: bool, check: i64, increment: i64) -\u003e Self {\n\t\tSelf { random, check, increment }\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn solve (self, progress: i64) -\u003e Option \u003cu8\u003e {\n\t\tlet next = progress % 26 + self.check;\n\t\t(1 ..= 9).contains (\u0026 next).then (|| next.as_u8 ())\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn incr (self, progress: i64, next: u8) -\u003e i64 {\n\t\tif self.random {\n\t\t\tprogress * 26 + next.as_i64 () + self.increment\n\t\t} else {\n\t\t\tprogress / 26\n\t\t}\n\t}\n\n}\n\npub fn steps_for (prog: \u0026 [Instr]) -\u003e GenResult \u003c[Step; 14]\u003e {\n\tif prog.len () != 14 * 18 { Err (\"Programme is not the right length\") ? }\n\tOk (prog.chunks (18).enumerate ().map (|(chunk_idx, chunk)| {\n\t\tlet err = |line_idx|\n\t\t\tformat! (\"Unable to generate quick steps for programme at line {}\",\n\t\t\t\tchunk_idx * 18 + line_idx + 1).into ();\n\t\tlet expect = |line_idx, val| -\u003e GenResult \u003c()\u003e {\n\t\t\tif chunk [line_idx] == val { Ok (()) } else { Err (err (line_idx)) ? }\n\t\t};\n\t\texpect (0, Instr::Inp (Reg::W)) ?;\n\t\texpect (1, Instr::Mul (Reg::X, RegOrInt::Int (0))) ?;\n\t\texpect (2, Instr::Add (Reg::X, RegOrInt::Z)) ?;\n\t\texpect (3, Instr::Mod (Reg::X, RegOrInt::Int (26))) ?;\n\t\tlet random = if let Instr::Div (Reg::Z, RegOrInt::Int (val)) = chunk [4] {\n\t\t\tif val == 26 { false } else if val == 1 { true } else { return Err (err (4)); }\n\t\t} else { Err (err (4)) ? };\n\t\tlet check = if let Instr::Add (Reg::X, RegOrInt::Int (check)) = chunk [5] {\n\t\t\tcheck\n\t\t} else { Err (err (5)) ? };\n\t\texpect (6, Instr::Eql (Reg::X, RegOrInt::W)) ?;\n\t\texpect (7, Instr::Eql (Reg::X, RegOrInt::Int (0))) ?;\n\t\texpect (8, Instr::Mul (Reg::Y, RegOrInt::Int (0))) ?;\n\t\texpect (9, Instr::Add (Reg::Y, RegOrInt::Int (25))) ?;\n\t\texpect (10, Instr::Mul (Reg::Y, RegOrInt::X)) ?;\n\t\texpect (11, Instr::Add (Reg::Y, RegOrInt::Int (1))) ?;\n\t\texpect (12, Instr::Mul (Reg::Z, RegOrInt::Y)) ?;\n\t\texpect (13, Instr::Mul (Reg::Y, RegOrInt::Int (0))) ?;\n\t\texpect (14, Instr::Add (Reg::Y, RegOrInt::W)) ?;\n\t\tlet increment = if let Instr::Add (Reg::Y, RegOrInt::Int (increment)) = chunk [15] {\n\t\t\tincrement\n\t\t} else { Err (err (15)) ? };\n\t\texpect (16, Instr::Mul (Reg::Y, RegOrInt::X)) ?;\n\t\texpect (17, Instr::Add (Reg::Z, RegOrInt::Y)) ?;\n\t\tOk (Step { random, check, increment })\n\t}).collect::\u003cGenResult \u003cVec \u003cStep\u003e\u003e\u003e () ?.try_into ().unwrap ())\n}\n\npub fn iterator (steps: \u0026 [Step; 14], reverse: bool) -\u003e impl Iterator \u003cItem = Input\u003e + '_ {\n\tNextNumIter::new (steps, reverse).nest ().nest ().nest ().nest ().nest ().nest ().nest ().nest ()\n\t\t.nest ().nest ().nest ().nest ().nest ().filter_map (|(nums, progress)| {\n\t\t\t(progress == 0).then_some ({\n\t\t\t\tlet mut answer = [0; 14];\n\t\t\t\tfor idx in 0 .. 14 { answer [idx] = nums [idx] }\n\t\t\t\tanswer\n\t\t\t})\n\t\t})\n}\n\ntype TempAnswer = (ArrayVec \u003cu8, 14\u003e, i64);\n\npub enum NextNumIter \u003c'stp, Nested\u003e {\n\tOuter {\n\t\tsteps: \u0026 'stp [Step; 14],\n\t\tnested: Nested,\n\t\treverse: bool,\n\t},\n\tInner {\n\t\tsteps: \u0026 'stp [Step; 14],\n\t\tnested: Nested,\n\t\treverse: bool,\n\t\tnums: ArrayVec \u003cu8, 14\u003e,\n\t\tprogress: i64,\n\t\tnext_iter: ops::RangeInclusive \u003cu8\u003e,\n\t},\n\tPoison,\n}\n\nimpl \u003c'stp\u003e NextNumIter \u003c'stp, std::option::IntoIter \u003cTempAnswer\u003e\u003e {\n\tfn new (\n\t\tsteps: \u0026 'stp [Step; 14],\n\t\treverse: bool,\n\t) -\u003e NextNumIter \u003c'stp, std::option::IntoIter \u003cTempAnswer\u003e\u003e {\n\t\tlet a: TempAnswer = (ArrayVec::new (), 0);\n\t\tNextNumIter::Outer { steps, nested: Some (a).into_iter (), reverse }\n\t}\n}\n\nimpl \u003c'stp, Nested: Iterator \u003cItem = TempAnswer\u003e\u003e NextNumIter \u003c'stp, Nested\u003e {\n\tfn nest (self) -\u003e NextNumIter \u003c'stp, Self\u003e {\n\t\tmatch \u0026 self {\n\t\t\t\u0026 NextNumIter::Outer { steps, reverse, .. } =\u003e\n\t\t\t\tNextNumIter::Outer { steps, nested: self, reverse },\n\t\t\t\u0026 NextNumIter::Inner { .. } | \u0026 NextNumIter::Poison =\u003e panic! (),\n\t\t}\n\t}\n}\n\nimpl \u003c'stp, Nested: Iterator \u003cItem = TempAnswer\u003e\u003e Iterator for NextNumIter \u003c'stp, Nested\u003e {\n\ttype Item = TempAnswer;\n\t#[ allow (clippy::reversed_empty_ranges) ]\n\tfn next (\u0026 mut self) -\u003e Option \u003cTempAnswer\u003e {\n\t\tloop { match mem::replace (self, NextNumIter::Poison) {\n\t\t\tNextNumIter::Outer { steps, mut nested, reverse } =\u003e match nested.next () {\n\t\t\t\tSome ((nums, progress)) =\u003e {\n\t\t\t\t\tlet step = steps [nums.len ()];\n\t\t\t\t\tlet next_iter = if step.random {\n\t\t\t\t\t\t1 ..= 9\n\t\t\t\t\t} else if let Some (next) = step.solve (progress) {\n\t\t\t\t\t\tnext ..= next\n\t\t\t\t\t} else {\n\t\t\t\t\t\t10 ..= 9\n\t\t\t\t\t};\n\t\t\t\t\t* self = NextNumIter::Inner { steps, nested, reverse, nums, progress, next_iter };\n\t\t\t\t\tcontinue;\n\t\t\t\t},\n\t\t\t\tNone =\u003e {\n\t\t\t\t\treturn None;\n\t\t\t\t},\n\t\t\t},\n\t\t\tNextNumIter::Inner { steps, nested, reverse, nums, progress, mut next_iter } =\u003e {\n\t\t\t\tif let Some (next) = if reverse { next_iter.next_back () } else { next_iter.next () } {\n\t\t\t\t\tlet step = steps [nums.len ()];\n\t\t\t\t\tlet mut new_nums = nums.clone ();\n\t\t\t\t\tnew_nums.push (next);\n\t\t\t\t\tlet new_progress = step.incr (progress, next);\n\t\t\t\t\t* self = NextNumIter::Inner { steps, nested, reverse, nums, progress, next_iter };\n\t\t\t\t\treturn Some ((new_nums, new_progress));\n\t\t\t\t}\n\t\t\t\t* self = NextNumIter::Outer { steps, nested, reverse };\n\t\t\t\tcontinue;\n\t\t\t},\n\t\t\tNextNumIter::Poison =\u003e panic! (),\n\t\t} }\n\t}\n}\n","traces":[{"line":141,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":147,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":148,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":149,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":154,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":155,"address":[259197,259408,259470],"length":1,"stats":{"Line":0},"fn_name":null},{"line":156,"address":[259410,259244],"length":1,"stats":{"Line":0},"fn_name":null},{"line":158,"address":[259208,259472,259455],"length":1,"stats":{"Line":0},"fn_name":null},{"line":164,"address":[259504],"length":1,"stats":{"Line":0},"fn_name":"steps_for"},{"line":165,"address":[259584,259546],"length":1,"stats":{"Line":0},"fn_name":null},{"line":166,"address":[259564,259984,259708,259967],"length":1,"stats":{"Line":0},"fn_name":null},{"line":167,"address":[361584,361950,355778],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":168,"address":[361761,361827],"length":1,"stats":{"Line":0},"fn_name":null},{"line":169,"address":[361612,361787],"length":1,"stats":{"Line":0},"fn_name":null},{"line":170,"address":[362154,361968,355794,362322],"length":1,"stats":{"Line":0},"fn_name":"{closure#1}"},{"line":171,"address":[362006,362182],"length":1,"stats":{"Line":0},"fn_name":null},{"line":173,"address":[355826,356211],"length":1,"stats":{"Line":0},"fn_name":null},{"line":174,"address":[356289,356020,356521],"length":1,"stats":{"Line":0},"fn_name":null},{"line":175,"address":[356586,356830,356342],"length":1,"stats":{"Line":0},"fn_name":null},{"line":176,"address":[356895,356978,356639],"length":1,"stats":{"Line":0},"fn_name":null},{"line":177,"address":[357155,357312,357035,356953],"length":1,"stats":{"Line":0},"fn_name":null},{"line":178,"address":[357403,357190],"length":1,"stats":{"Line":0},"fn_name":null},{"line":179,"address":[357322,357096,357221],"length":1,"stats":{"Line":0},"fn_name":null},{"line":180,"address":[357812,357658,357379,357699,357538],"length":1,"stats":{"Line":0},"fn_name":null},{"line":181,"address":[357691],"length":1,"stats":{"Line":0},"fn_name":null},{"line":182,"address":[357822,357599,357720],"length":1,"stats":{"Line":0},"fn_name":null},{"line":183,"address":[357871,358300],"length":1,"stats":{"Line":0},"fn_name":null},{"line":184,"address":[358109,358365,358609],"length":1,"stats":{"Line":0},"fn_name":null},{"line":185,"address":[358674,358918,358418],"length":1,"stats":{"Line":0},"fn_name":null},{"line":186,"address":[358983,359209,358727],"length":1,"stats":{"Line":0},"fn_name":null},{"line":187,"address":[359268,359506,359036],"length":1,"stats":{"Line":0},"fn_name":null},{"line":188,"address":[359565,359791,359321],"length":1,"stats":{"Line":0},"fn_name":null},{"line":189,"address":[360088,359618,359850],"length":1,"stats":{"Line":0},"fn_name":null},{"line":190,"address":[359903,360373,360147],"length":1,"stats":{"Line":0},"fn_name":null},{"line":191,"address":[360432,360515,360200],"length":1,"stats":{"Line":0},"fn_name":null},{"line":192,"address":[360490,360692,360840,360733,360572],"length":1,"stats":{"Line":0},"fn_name":null},{"line":193,"address":[360725],"length":1,"stats":{"Line":0},"fn_name":null},{"line":194,"address":[360639,360748,360850],"length":1,"stats":{"Line":0},"fn_name":null},{"line":195,"address":[361297,360899],"length":1,"stats":{"Line":0},"fn_name":null},{"line":196,"address":[361355,361521,361125],"length":1,"stats":{"Line":0},"fn_name":null},{"line":197,"address":[361413],"length":1,"stats":{"Line":0},"fn_name":null},{"line":198,"address":[259935],"length":1,"stats":{"Line":0},"fn_name":null},{"line":201,"address":[260064],"length":1,"stats":{"Line":0},"fn_name":"iterator"},{"line":202,"address":[260109],"length":1,"stats":{"Line":0},"fn_name":null},{"line":204,"address":[362661,362388],"length":1,"stats":{"Line":0},"fn_name":null},{"line":205,"address":[362398],"length":1,"stats":{"Line":0},"fn_name":null},{"line":206,"address":[362530,362422,362685],"length":1,"stats":{"Line":0},"fn_name":null},{"line":207,"address":[362629],"length":1,"stats":{"Line":0},"fn_name":null},{"line":232,"address":[260432],"length":1,"stats":{"Line":0},"fn_name":"new"},{"line":236,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":237,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":242,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":243,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":244,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":246,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":254,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":255,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":256,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":257,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":258,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":259,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":260,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":261,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":262,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":264,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":266,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":267,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":269,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":270,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":273,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":274,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":275,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":276,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":277,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":278,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":279,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":280,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":282,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":283,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":285,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":80},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-24","src","solver.rs"],"content":"use super::*;\nuse machine::Instr;\nuse machine::MachineError;\nuse machine::Reg;\nuse machine::RegOrInt;\n\n#[ derive (Clone) ]\npub struct Solver {\n\tinner: Rc \u003cSolverInner\u003e,\n\tinner_weak: RcWeak \u003cSolverInner\u003e,\n}\n\nstruct SolverInner {\n\tstate: RefCell \u003cSolverState\u003e,\n}\n\nstruct SolverState {\n\tsymbols: HashMap \u003cRc \u003cstr\u003e, Symbol\u003e,\n\tsymbols_ordered: Vec \u003cSymbol\u003e,\n}\n\n#[ derive (Clone) ]\npub struct Symbol {\n\tinner: Rc \u003cSymbolInner\u003e,\n}\n\nstruct SymbolInner {\n\tsolver_inner: RcWeak \u003cSolverInner\u003e,\n\tname: Rc \u003cstr\u003e,\n\toriginal_value: Option \u003cSymVal\u003e,\n\toriginal_depth: usize,\n\toriginal_len: usize,\n\toriginal_children: ArrayVec \u003cSymbol, 2\u003e,\n\tstate: RefCell \u003cSymbolState\u003e,\n}\n\n#[ derive (Debug) ]\nstruct SymbolState {\n\tvalue: SymVal,\n\tdepth: usize,\n\tlen: usize,\n}\n\n#[ derive (Clone, Debug, Eq, PartialEq) ]\npub enum SymVal {\n\tSymbol (Symbol),\n\tInput (usize),\n\tAdd (Symbol, Symbol),\n\tMultiply (Symbol, Symbol),\n\tDivide (Symbol, Symbol),\n\tModulo (Symbol, Symbol),\n\tIsEqual (Symbol, Symbol),\n\tIsUnequal (Symbol, Symbol),\n\tValue (i64),\n\tError (MachineError),\n}\n\nimpl Solver {\n\n\t#[ allow (clippy::too_many_lines) ]\n\t#[ must_use ]\n\tpub fn from_prog (input: \u0026 [Instr]) -\u003e (Self, Vec \u003c(Rc \u003cstr\u003e, Symbol)\u003e) {\n\t\tstruct Context {\n\t\t\tnamer: VerNamer,\n\t\t\tsolver: Solver,\n\t\t\tliteral_name: Rc \u003cstr\u003e,\n\t\t\treg_w_name: Rc \u003cstr\u003e,\n\t\t\treg_x_name: Rc \u003cstr\u003e,\n\t\t\treg_y_name: Rc \u003cstr\u003e,\n\t\t\treg_z_name: Rc \u003cstr\u003e,\n\t\t\treg_w: Symbol,\n\t\t\treg_x: Symbol,\n\t\t\treg_y: Symbol,\n\t\t\treg_z: Symbol,\n\t\t}\n\t\timpl Context {\n\t\t\tfn get (\u0026 self, reg: Reg) -\u003e Symbol {\n\t\t\t\tmatch reg {\n\t\t\t\t\tReg::W =\u003e self.reg_w.clone (),\n\t\t\t\t\tReg::X =\u003e self.reg_x.clone (),\n\t\t\t\t\tReg::Y =\u003e self.reg_y.clone (),\n\t\t\t\t\tReg::Z =\u003e self.reg_z.clone (),\n\t\t\t\t}\n\t\t\t}\n\t\t\tfn get_val (\u0026 mut self, reg_or_int: RegOrInt) -\u003e Symbol {\n\t\t\t\tmatch reg_or_int {\n\t\t\t\t\tRegOrInt::W =\u003e self.reg_w.clone (),\n\t\t\t\t\tRegOrInt::X =\u003e self.reg_x.clone (),\n\t\t\t\t\tRegOrInt::Y =\u003e self.reg_y.clone (),\n\t\t\t\t\tRegOrInt::Z =\u003e self.reg_z.clone (),\n\t\t\t\t\tRegOrInt::Int (value) =\u003e self.lit (value),\n\t\t\t\t}\n\t\t\t}\n\t\t\tfn set (\u0026 mut self, reg: Reg, value: SymVal) {\n\t\t\t\tlet (reg_name, reg) = match reg {\n\t\t\t\t\tReg::W =\u003e (\u0026 self.reg_w_name, \u0026 mut self.reg_w),\n\t\t\t\t\tReg::X =\u003e (\u0026 self.reg_x_name, \u0026 mut self.reg_x),\n\t\t\t\t\tReg::Y =\u003e (\u0026 self.reg_y_name, \u0026 mut self.reg_y),\n\t\t\t\t\tReg::Z =\u003e (\u0026 self.reg_z_name, \u0026 mut self.reg_z),\n\t\t\t\t};\n\t\t\t\tlet symbol_name = self.namer.define (reg_name);\n\t\t\t\tlet symbol = self.solver.define (symbol_name, value);\n\t\t\t\t* reg = symbol;\n\t\t\t}\n\t\t\tfn lit (\u0026 mut self, value: i64) -\u003e Symbol {\n\t\t\t\tlet symbol_name = self.namer.define (\u0026 self.literal_name);\n\t\t\t\tlet symbol_value = SymVal::Value (value);\n\t\t\t\tself.solver.define (symbol_name, symbol_value)\n\t\t\t}\n\t\t}\n\t\tlet mut ctx = {\n\t\t\tlet mut namer = VerNamer::new ();\n\t\t\tlet solver = Self::new ();\n\t\t\tlet literal_name = \"lit\".into ();\n\t\t\tlet reg_w_name: Rc \u003cstr\u003e = \"w\".into ();\n\t\t\tlet reg_x_name: Rc \u003cstr\u003e = \"x\".into ();\n\t\t\tlet reg_y_name: Rc \u003cstr\u003e = \"y\".into ();\n\t\t\tlet reg_z_name: Rc \u003cstr\u003e = \"z\".into ();\n\t\t\tlet reg_w = solver.define (namer.define (\u0026 reg_w_name), SymVal::Value (0));\n\t\t\tlet reg_x = solver.define (namer.define (\u0026 reg_x_name), SymVal::Value (0));\n\t\t\tlet reg_y = solver.define (namer.define (\u0026 reg_y_name), SymVal::Value (0));\n\t\t\tlet reg_z = solver.define (namer.define (\u0026 reg_z_name), SymVal::Value (0));\n\t\t\tContext {\n\t\t\t\tnamer, solver,\n\t\t\t\tliteral_name, reg_w_name, reg_x_name, reg_y_name, reg_z_name,\n\t\t\t\treg_w, reg_x, reg_y, reg_z,\n\t\t\t}\n\t\t};\n\t\tlet mut input_count = 0;\n\t\tfor instr in input.iter ().copied () {\n\t\t\tmatch instr {\n\t\t\t\tInstr::Inp (dest) =\u003e {\n\t\t\t\t\tctx.set (dest, SymVal::Input (input_count));\n\t\t\t\t\tinput_count += 1;\n\t\t\t\t},\n\t\t\t\tInstr::Add (dest, src) =\u003e {\n\t\t\t\t\tlet dest_val = ctx.get (dest);\n\t\t\t\t\tlet src_val = ctx.get_val (src);\n\t\t\t\t\tctx.set (dest, SymVal::Add (dest_val, src_val));\n\t\t\t\t},\n\t\t\t\tInstr::Mul (dest, src) =\u003e {\n\t\t\t\t\tlet dest_val = ctx.get (dest);\n\t\t\t\t\tlet src_val = ctx.get_val (src);\n\t\t\t\t\tctx.set (dest, SymVal::Multiply (dest_val, src_val));\n\t\t\t\t},\n\t\t\t\tInstr::Div (dest, src) =\u003e {\n\t\t\t\t\tlet dest_val = ctx.get (dest);\n\t\t\t\t\tlet src_val = ctx.get_val (src);\n\t\t\t\t\tctx.set (dest, SymVal::Divide (dest_val, src_val));\n\t\t\t\t},\n\t\t\t\tInstr::Mod (dest, src) =\u003e {\n\t\t\t\t\tlet dest_val = ctx.get (dest);\n\t\t\t\t\tlet src_val = ctx.get_val (src);\n\t\t\t\t\tctx.set (dest, SymVal::Modulo (dest_val, src_val));\n\t\t\t\t},\n\t\t\t\tInstr::Eql (dest, src) =\u003e {\n\t\t\t\t\tlet dest_val = ctx.get (dest);\n\t\t\t\t\tlet src_val = ctx.get_val (src);\n\t\t\t\t\tctx.set (dest, SymVal::IsEqual (dest_val, src_val));\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t\t(ctx.solver, vec! [\n\t\t\t(ctx.reg_w_name, ctx.reg_w),\n\t\t\t(ctx.reg_x_name, ctx.reg_x),\n\t\t\t(ctx.reg_y_name, ctx.reg_y),\n\t\t\t(ctx.reg_z_name, ctx.reg_z),\n\t\t])\n\t}\n\n\t#[ allow (clippy::todo) ]\n\tpub fn eval (\u0026 self, input: \u0026 [\u0026 [i64]], symbol: \u0026 Symbol) -\u003e Result \u003cVec \u003ci64\u003e, MachineError\u003e {\n\t\tself.require_own_symbol (\"eval\", symbol);\n\t\tlet inner = self.inner.as_ref ();\n\t\tlet state = inner.state.borrow ();\n\t\tlet mut seen: HashSet \u003cSymbol\u003e = HashSet::new ();\n\t\tseen.insert (symbol.clone ());\n\t\tlet mut todo: Vec \u003cSymbol\u003e = vec! [ symbol.clone () ];\n\t\twhile let Some (symbol) = todo.pop () {\n\t\t\tfor child in symbol.children () {\n\t\t\t\tif seen.insert (child.clone ()) {\n\t\t\t\t\ttodo.push (child);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tlet mut values: HashMap \u003cSymbol, Rc \u003c[i64]\u003e\u003e = HashMap::new ();\n\t\tfor symbol in state.symbols_ordered.iter () {\n\t\t\tif ! seen.contains (symbol) { continue }\n\t\t\tlet value = symbol.eval (\u0026 |sym| Rc::clone (\u0026 values [sym]), input) ?;\n\t\t\tlet value = Rc::from (value.as_slice ());\n\t\t\tvalues.insert (symbol.clone (), Rc::clone (\u0026 value));\n\t\t}\n\t\ttodo! ();\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn new () -\u003e Self {\n\t\tlet inner = Rc::new (SolverInner {\n\t\t\tstate: RefCell::new (SolverState {\n\t\t\t\tsymbols: HashMap::new (),\n\t\t\t\tsymbols_ordered: Vec::new (),\n\t\t\t}),\n\t\t});\n\t\tlet inner_weak = Rc::downgrade (\u0026 inner);\n\t\tSelf { inner, inner_weak }\n\t}\n\n\t#[ must_use ]\n\tpub fn fork (\u0026 self, symbols: \u0026 mut [\u0026 mut Symbol], input: \u0026 [i64]) -\u003e Self {\n\t\tlet inner = self.inner.as_ref ();\n\t\tlet state = inner.state.borrow ();\n\t\tlet mut seen: HashSet \u003cSymbol\u003e = symbols.iter ().map (|a| \u0026 ** a).cloned ().collect ();\n\t\tlet mut todo: Vec \u003cSymbol\u003e = seen.iter ().cloned ().collect ();\n\t\twhile let Some (symbol) = todo.pop () {\n\t\t\tfor child in symbol.children () {\n\t\t\t\tif seen.insert (child.clone ()) {\n\t\t\t\t\ttodo.push (child);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tlet mut new_solver = Self::new ();\n\t\tfor symbol in state.symbols_ordered.iter () {\n\t\t\tif ! seen.contains (symbol) { continue }\n\t\t\tlet new_value = symbol.value ().migrate (\u0026 mut new_solver, input);\n\t\t\tlet _symbol = new_solver.define (Rc::clone (symbol.name ()), new_value);\n\t\t}\n\t\tfor old_symbol in symbols.iter_mut () {\n\t\t\tlet new_symbol = new_solver.get (old_symbol.name ()).unwrap ();\n\t\t\t** old_symbol = new_symbol;\n\t\t}\n\t\tnew_solver\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn get (\u0026 self, name: \u0026 Rc \u003cstr\u003e) -\u003e Option \u003cSymbol\u003e {\n\t\tlet state = self.inner.state.borrow ();\n\t\tstate.symbols.get (name).cloned ()\n\t}\n\n\t#[ must_use ]\n\tpub fn define (\u0026 self, name: Rc \u003cstr\u003e, value: SymVal) -\u003e Symbol {\n\t\tvalue.children ().iter ().for_each (|child| self.require_own_symbol (\"define\", child));\n\t\tlet mut state = self.inner.state.borrow_mut ();\n\t\tif state.symbols.contains_key (\u0026 name) { panic! () }\n\t\tlet mut value = value;\n\t\tlet mut depth = value.depth ();\n\t\tlet mut len = value.len ();\n\t\tlet mut original_value = None;\n\t\tlet original_depth = value.original_depth ();\n\t\tlet original_len = value.original_len ();\n\t\tlet original_children = value.children ();\n\t\tif let Some (simplified_value) = value.simplify () {\n\t\t\toriginal_value = Some (value);\n\t\t\tvalue = simplified_value;\n\t\t\tdepth = value.depth ();\n\t\t\tlen = value.len ();\n\t\t}\n\t\tlet symbol = Symbol {\n\t\t\tinner: Rc::new (SymbolInner {\n\t\t\t\tsolver_inner: Rc::downgrade (\u0026 self.inner),\n\t\t\t\tname: Rc::clone (\u0026 name),\n\t\t\t\toriginal_value,\n\t\t\t\toriginal_depth,\n\t\t\t\toriginal_len,\n\t\t\t\toriginal_children,\n\t\t\t\tstate: RefCell::new (SymbolState {\n\t\t\t\t\tvalue,\n\t\t\t\t\tdepth,\n\t\t\t\t\tlen,\n\t\t\t\t}),\n\t\t\t}),\n\t\t};\n\t\tstate.symbols.insert (name, symbol.clone ());\n\t\tstate.symbols_ordered.push (symbol.clone ());\n\t\tsymbol\n\t}\n\n\tpub fn dump (\u0026 self, depth: usize, show_original: bool) {\n\t\tlet options = FormatExpandOptions::Depth (depth);\n\t\tlet state = self.inner.state.borrow ();\n\t\tfor symbol in state.symbols_ordered.iter () {\n\t\t\tsymbol.dump (options, show_original, None);\n\t\t}\n\t}\n\n\tfn require_own_symbol (\u0026 self, fn_name: \u0026 str, symbol: \u0026 Symbol) {\n\t\tassert! (\n\t\t\tRcWeak::ptr_eq (\u0026 self.inner_weak, \u0026 symbol.inner.solver_inner),\n\t\t\t\"Tried to call Solver::{} on solver at {:p} with a symbol from solver at {:p}\",\n\t\t\tfn_name,\n\t\t\tRc::as_ptr (\u0026 self.inner),\n\t\t\tRcWeak::as_ptr (\u0026 symbol.inner.solver_inner));\n\t}\n\n\tpub fn dump_symbol (\u0026 self, depth: usize, show_original: bool, symbol: \u0026 Symbol) {\n\t\tself.require_own_symbol (\"dump_symbol\", symbol);\n\t\tlet state = self.inner.state.borrow ();\n\t\tlet counts = symbol.use_counts ();\n\t\tlet options = FormatExpandOptions::Depth (depth);\n\t\tfor symbol in state.symbols_ordered.iter () {\n\t\t\tlet count = match counts.get (symbol) {\n\t\t\t\tSome (\u0026 count) =\u003e count,\n\t\t\t\tNone =\u003e continue,\n\t\t\t};\n\t\t\tsymbol.dump (options, show_original, Some (count));\n\t\t}\n\t}\n\n\tpub fn dump_symbol_auto (\u0026 self, symbol: \u0026 Symbol) {\n\t\tself.require_own_symbol (\"dump_symbol_auto\", symbol);\n\t\tlet state = self.inner.state.borrow ();\n\t\tlet counts = symbol.use_counts ();\n\t\tlet break_symbols: HashSet \u003cSymbol\u003e =\n\t\t\tcounts.iter ()\n\t\t\t\t.filter_map (|(symbol, \u0026 count)| (count \u003e 1).then_some (symbol))\n\t\t\t\t.cloned ()\n\t\t\t\t.collect ();\n\t\tlet options = FormatExpandOptions::BreakSymbols (\u0026 break_symbols);\n\t\tfor symbol in state.symbols_ordered.iter () {\n\t\t\tif counts.get (symbol).map_or (true, |count| * count == 1) { continue }\n\t\t\tsymbol.dump (options, true, None);\n\t\t}\n\t}\n\n}\n\nimpl Symbol {\n\n\tpub fn eval (\n\t\t\u0026 self,\n\t\tlookup: \u0026 dyn Fn (\u0026 Self) -\u003e Rc \u003c[i64]\u003e, input: \u0026 [\u0026 [i64]],\n\t) -\u003e Result \u003cVec \u003ci64\u003e, MachineError\u003e {\n\t\tlet inner = self.inner.as_ref ();\n\t\tlet state = inner.state.borrow ();\n\t\tstate.value.eval (lookup, input)\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn name (\u0026 self) -\u003e \u0026 Rc \u003cstr\u003e {\n\t\t\u0026 self.inner.name\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn value (\u0026 self) -\u003e SymVal {\n\t\tlet inner = self.inner.as_ref ();\n\t\tlet state = inner.state.borrow ();\n\t\tstate.value.clone ()\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn children (\u0026 self) -\u003e ArrayVec \u003cSelf, 2\u003e {\n\t\tlet inner = self.inner.as_ref ();\n\t\tlet state = inner.state.borrow ();\n\t\tstate.value.children ()\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn original_children (\u0026 self) -\u003e ArrayVec \u003cSelf, 2\u003e {\n\t\tlet inner = self.inner.as_ref ();\n\t\tinner.original_children.clone ()\n\t}\n\n\t#[ allow (clippy::print_stdout) ]\n\tfn dump (\n\t\t\u0026 self,\n\t\toptions: FormatExpandOptions,\n\t\tshow_original: bool,\n\t\tuse_count: Option \u003cusize\u003e,\n\t) {\n\t\tlet inner = self.inner.as_ref ();\n\t\tlet state = inner.state.borrow ();\n\t\tprint! (\"{}\", inner.name);\n\t\tif let Some (use_count) = use_count {\n\t\t\tprint! (\" ({})\", use_count);\n\t\t}\n\t\tmatch options {\n\t\t\tFormatExpandOptions::Depth (depth) =\u003e {\n\t\t\t\tif show_original {\n\t\t\t\t\tif let Some (original_value) = inner.original_value.as_ref () {\n\t\t\t\t\t\tprint! (\" ← {}\", original_value.expand (1));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tprint! (\" ← {}\", state.value);\n\t\t\t\tprint! (\" ≡ {}\", state.value.expand (depth));\n\t\t\t},\n\t\t\tFormatExpandOptions::BreakSymbols (_) =\u003e\n\t\t\t\tprint! (\" ← {}\", FormatExpand::SymVal (options, false, \u0026 state.value)),\n\t\t}\n\t\tprint! (\"\\n\");\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn depth (\u0026 self) -\u003e usize {\n\t\tlet inner = self.inner.as_ref ();\n\t\tlet state = inner.state.borrow ();\n\t\tstate.depth\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn len (\u0026 self) -\u003e usize {\n\t\tlet inner = self.inner.as_ref ();\n\t\tlet state = inner.state.borrow ();\n\t\tstate.len\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn is_empty (\u0026 self) -\u003e bool {\n\t\tself.len () == 0\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn original_depth (\u0026 self) -\u003e usize {\n\t\tlet inner = self.inner.as_ref ();\n\t\tinner.original_depth\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn original_len (\u0026 self) -\u003e usize {\n\t\tlet inner = self.inner.as_ref ();\n\t\tinner.original_len\n\t}\n\n\tfn fmt_expand (\n\t\t\u0026 self,\n\t\tformatter: \u0026 mut fmt::Formatter,\n\t\toptions: FormatExpandOptions,\n\t\twrap: bool,\n\t) -\u003e fmt::Result {\n\t\tlet inner = self.inner.as_ref ();\n\t\tlet state = inner.state.borrow ();\n\t\tmatch options {\n\t\t\tFormatExpandOptions::Depth (depth) =\u003e {\n\t\t\t\tif depth \u003e 0 {\n\t\t\t\t\tlet options = FormatExpandOptions::Depth (depth - 1);\n\t\t\t\t\twrite! (formatter, \"C{}\", FormatExpand::SymVal (options, wrap, \u0026 state.value)) ?;\n\t\t\t\t} else {\n\t\t\t\t\twrite! (formatter, \"D{}\", inner.name) ?;\n\t\t\t\t}\n\t\t\t},\n\t\t\tFormatExpandOptions::BreakSymbols (break_symbols) =\u003e {\n\t\t\t\tif break_symbols.contains (self) {\n\t\t\t\t\twrite! (formatter, \"A{}\", inner.name) ?;\n\t\t\t\t} else {\n\t\t\t\t\tlet value = inner.original_value.clone ().unwrap_or_else (|| state.value.clone ()).simplified ();\n\t\t\t\t\twrite! (formatter, \"B{}\", FormatExpand::SymVal (options, wrap, \u0026 value)) ?;\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t\tOk (())\n\t}\n\n\tfn use_counts (\u0026 self) -\u003e HashMap \u003cSelf, usize\u003e {\n\t\tlet mut counts: HashMap \u003cSelf, usize\u003e = HashMap::new ();\n\t\tcounts.insert (self.clone (), 0);\n\t\tlet mut todo: Vec \u003cSelf\u003e = Vec::new ();\n\t\ttodo.push (self.clone ());\n\t\twhile let Some (symbol) = todo.pop () {\n\t\t\tfor child in symbol.original_children () {\n\t\t\t\tlet child_count = counts.entry (child.clone ()).or_insert (0);\n\t\t\t\tif * child_count == 0 {\n\t\t\t\t\ttodo.push (child.clone ());\n\t\t\t\t}\n\t\t\t\t* child_count += 1;\n\t\t\t}\n\t\t}\n\t\tcounts\n\t}\n\n}\n\nimpl cmp::PartialOrd for Symbol {\n\tfn partial_cmp (\u0026 self, other: \u0026 Self) -\u003e Option \u003ccmp::Ordering\u003e {\n\t\tself.inner.name.partial_cmp (\u0026 other.inner.name)\n\t}\n}\n\nimpl fmt::Debug for Symbol {\n\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\tlet inner = self.inner.as_ref ();\n\t\twrite! (formatter, \"Symbol {:?}\", inner.name) ?;\n\t\tOk (())\n\t}\n}\n\nimpl fmt::Display for Symbol {\n\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\twrite! (formatter, \"{}\",\n\t\t\tFormatExpand::Symbol (\n\t\t\t\tFormatExpandOptions::Depth (formatter.precision ().unwrap_or (0)),\n\t\t\t\tfalse,\n\t\t\t\tself)) ?;\n\t\tOk (())\n\t}\n}\n\nimpl hash::Hash for Symbol {\n\tfn hash \u003cHasher: hash::Hasher\u003e (\u0026 self, state: \u0026 mut Hasher) {\n\t\tself.inner.name.hash (state);\n\t}\n}\n\nimpl PartialEq for Symbol {\n\tfn eq (\u0026 self, other: \u0026 Self) -\u003e bool { self.inner.name == other.inner.name }\n}\n\nimpl Eq for Symbol {}\n\nimpl SymVal {\n\n\tfn eval (\n\t\t\u0026 self,\n\t\tlookup: \u0026 dyn Fn (\u0026 Symbol) -\u003e Rc \u003c[i64]\u003e,\n\t\tinput: \u0026 [\u0026 [i64]],\n\t) -\u003e Result \u003cVec \u003ci64\u003e, MachineError\u003e {\n\n\t\tfn combine \u003cCombine: Fn (i64, i64) -\u003e i64\u003e (\n\t\t\tleft: \u0026 Rc \u003c[i64]\u003e,\n\t\t\tright: \u0026 Rc \u003c[i64]\u003e,\n\t\t\tcombine: Combine,\n\t\t) -\u003e Vec \u003ci64\u003e {\n\t\t\tlet mut results = HashSet::new ();\n\t\t\tfor left in left.iter ().copied () { for right in right.iter ().copied () {\n\t\t\t\tresults.insert (combine (left, right));\n\t\t\t} }\n\t\t\tlet mut results: Vec \u003ci64\u003e = results.into_iter ().collect ();\n\t\t\tresults.sort_unstable ();\n\t\t\tresults\n\t\t}\n\n\t\tOk (match * self {\n\t\t\tSelf::Symbol (ref arg) =\u003e\n\t\t\t\tlookup (arg).to_vec (),\n\t\t\tSelf::Input (ref arg) =\u003e\n\t\t\t\tinput.get (* arg).copied ().ok_or (MachineError::NoMoreInput) ?.to_vec (),\n\t\t\tSelf::Add (ref left, ref right) =\u003e\n\t\t\t\tcombine (\u0026 lookup (left), \u0026 lookup (right), |a, b| a + b),\n\t\t\tSelf::Multiply (ref left, ref right) =\u003e\n\t\t\t\tcombine (\u0026 lookup (left), \u0026 lookup (right), |a, b| a * b),\n\t\t\tSelf::Divide (ref left, ref right) =\u003e\n\t\t\t\tcombine (\u0026 lookup (left), \u0026 lookup (right), |a, b| a / b),\n\t\t\tSelf::Modulo (ref left, ref right) =\u003e\n\t\t\t\tcombine (\u0026 lookup (left), \u0026 lookup (right), |a, b| a % b),\n\t\t\tSelf::IsEqual (ref left, ref right) =\u003e\n\t\t\t\tcombine (\u0026 lookup (left), \u0026 lookup (right), |a, b| if a == b { 1 } else { 0 }),\n\t\t\tSelf::IsUnequal (ref left, ref right) =\u003e\n\t\t\t\tcombine (\u0026 lookup (left), \u0026 lookup (right), |a, b| if a != b { 1 } else { 0 }),\n\t\t\tSelf::Value (ref arg) =\u003e\n\t\t\t\tvec! [ * arg ],\n\t\t\tSelf::Error (ref arg) =\u003e\n\t\t\t\tErr (* arg) ?,\n\t\t})\n\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn depth (\u0026 self) -\u003e usize {\n\t\tself.children ().iter ()\n\t\t\t.map (Symbol::depth)\n\t\t\t.max ()\n\t\t\t.unwrap_or (0) + 1\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn len (\u0026 self) -\u003e usize {\n\t\tself.children ().iter ().fold (1, |len, child| len + child.len ())\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn is_empty (\u0026 self) -\u003e bool {\n\t\tself.children ().iter ().next ().is_some ()\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn original_depth (\u0026 self) -\u003e usize {\n\t\tself.children ().iter ()\n\t\t\t.map (Symbol::original_depth)\n\t\t\t.max ()\n\t\t\t.unwrap_or (0) + 1\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn original_len (\u0026 self) -\u003e usize {\n\t\tself.children ().iter ().fold (1, |len, child| len + child.original_len ())\n\t}\n\n\t#[ must_use ]\n\tpub fn children (\u0026 self) -\u003e ArrayVec \u003cSymbol, 2\u003e {\n\t\tfn make \u003cconst CAP: usize\u003e (arg: [\u0026 Symbol; CAP]) -\u003e ArrayVec \u003cSymbol, 2\u003e {\n\t\t\targ.into_iter ().cloned ().collect ()\n\t\t}\n\t\tmatch * self {\n\t\t\tSelf::Symbol (ref arg) =\u003e make ([ arg ]),\n\t\t\tSelf::Input (_) =\u003e make ([ ]),\n\t\t\tSelf::Add (ref left, ref right) =\u003e make ([ left, right ]),\n\t\t\tSelf::Multiply (ref left, ref right) =\u003e make ([ left, right ]),\n\t\t\tSelf::Divide (ref left, ref right) =\u003e make ([ left, right ]),\n\t\t\tSelf::Modulo (ref left, ref right) =\u003e make ([ left, right ]),\n\t\t\tSelf::IsEqual (ref left, ref right) =\u003e make ([ left, right ]),\n\t\t\tSelf::IsUnequal (ref left, ref right) =\u003e make ([ left, right ]),\n\t\t\tSelf::Value (_) =\u003e make ([ ]),\n\t\t\tSelf::Error (_) =\u003e make ([ ]),\n\t\t}\n\t}\n\tfn fmt_expand (\n\t\t\u0026 self,\n\t\tformatter: \u0026 mut fmt::Formatter,\n\t\toptions: FormatExpandOptions,\n\t\twrap: bool,\n\t) -\u003e fmt::Result {\n\t\tlet expand = |symbol, wrap| FormatExpand::Symbol (options, wrap, symbol);\n\t\tlet (open, close) = if wrap { (\"(\", \")\") } else { (\"\", \"\") };\n\t\tmatch * self {\n\t\t\tSelf::Symbol (ref other_symbol) =\u003e\n\t\t\t\twrite! (formatter, \"{}\", expand (other_symbol, wrap)) ?,\n\t\t\tSelf::Input (ref index) =\u003e\n\t\t\t\twrite! (formatter, \"input [{}]\", index) ?,\n\t\t\tSelf::Add (ref left, ref right) =\u003e\n\t\t\t\twrite! (formatter, \"{}{} + {}{}\", open, expand (left, true), expand (right, true), close) ?,\n\t\t\tSelf::Multiply (ref left, ref right) =\u003e\n\t\t\t\twrite! (formatter, \"{}{} × {}{}\", open, expand (left, true), expand (right, true), close) ?,\n\t\t\tSelf::Divide (ref left, ref right) =\u003e\n\t\t\t\twrite! (formatter, \"{}{} ÷ {}{}\", open, expand (left, true), expand (right, true), close) ?,\n\t\t\tSelf::Modulo (ref left, ref right) =\u003e\n\t\t\t\twrite! (formatter, \"{}{} mod {}{}\", open, expand (left, true), expand (right, true), close) ?,\n\t\t\tSelf::IsEqual (ref left, ref right) =\u003e\n\t\t\t\twrite! (formatter, \"{}{} = {}{}\", open, expand (left, true), expand (right, true), close) ?,\n\t\t\tSelf::IsUnequal (ref left, ref right) =\u003e\n\t\t\t\twrite! (formatter, \"{}{} ≠ {}{}\", open, expand (left, true), expand (right, true), close) ?,\n\t\t\tSelf::Value (ref value) =\u003e\n\t\t\t\twrite! (formatter, \"{}\", value) ?,\n\t\t\tSelf::Error (ref arg) =\u003e\n\t\t\t\twrite! (formatter, \"{:?}\", arg) ?,\n\t\t}\n\t\tOk (())\n\t}\n\tconst fn expand (\u0026 self, depth: usize) -\u003e FormatExpand {\n\t\tlet options = FormatExpandOptions::Depth (depth);\n\t\tFormatExpand::SymVal (options, false, self)\n\t}\n\tfn simplified (\u0026 self) -\u003e Self {\n\t\tmatch self.simplify () {\n\t\t\tSome (val) =\u003e val,\n\t\t\tNone =\u003e self.clone (),\n\t\t}\n\t}\n\tfn simplify (\u0026 self) -\u003e Option \u003cSelf\u003e {\n\t\tlet mut value = self;\n\t\tlet mut result = None;\n\t\twhile let Some (temp) = value.simplify_real () {\n\t\t\tresult = Some (temp);\n\t\t\tvalue = result.as_ref ().unwrap ();\n\t\t}\n\t\tresult\n\t}\n\t#[ allow (clippy::todo) ]\n\tfn simplify_real (\u0026 self) -\u003e Option \u003cSelf\u003e {\n\t\tmatch * self {\n\t\t\tSelf::Input (_) =\u003e None,\n\t\t\tSelf::Add (ref left_sym, ref right_sym) =\u003e {\n\t\t\t\tlet left_symval = left_sym.value ();\n\t\t\t\tlet right_symval = right_sym.value ();\n\t\t\t\tmatch (\u0026 left_symval, \u0026 right_symval) {\n\t\t\t\t\t(\u0026 Self::Error (_), _) =\u003e Some (left_symval),\n\t\t\t\t\t(_, \u0026 Self::Error (_)) =\u003e Some (right_symval),\n\t\t\t\t\t(\u0026 Self::Value (ref left_val), \u0026 Self::Value (ref right_val)) =\u003e\n\t\t\t\t\t\tSome (Self::Value (left_val + right_val)),\n\t\t\t\t\t(_, \u0026 Self::Value (0)) =\u003e Some (left_symval),\n\t\t\t\t\t(\u0026 Self::Value (0), _) =\u003e Some (right_symval),\n\t\t\t\t\t(_, _) if left_symval == right_symval =\u003e todo! (),\n\t\t\t\t\t_ =\u003e None,\n\t\t\t\t}\n\t\t\t},\n\t\t\tSelf::Multiply (ref left_sym, ref right_sym) =\u003e {\n\t\t\t\tlet left_symval = left_sym.value ();\n\t\t\t\tlet right_symval = right_sym.value ();\n\t\t\t\tmatch (\u0026 left_symval, \u0026 right_symval) {\n\t\t\t\t\t(\u0026 Self::Error (_), _) =\u003e Some (left_symval),\n\t\t\t\t\t(_, \u0026 Self::Error (_)) =\u003e Some (right_symval),\n\t\t\t\t\t(\u0026 Self::Value (left_val), \u0026 Self::Value (right_val)) =\u003e\n\t\t\t\t\t\tSome (Self::Value (left_val * right_val)),\n\t\t\t\t\t(_, \u0026 Self::Value (0)) =\u003e Some (Self::Value (0)),\n\t\t\t\t\t(\u0026 Self::Value (0), _) =\u003e Some (Self::Value (0)),\n\t\t\t\t\t_ =\u003e None,\n\t\t\t\t}\n\t\t\t},\n\t\t\tSelf::Divide (ref left_sym, ref right_sym) =\u003e {\n\t\t\t\tlet left_symval = left_sym.value ();\n\t\t\t\tlet right_symval = right_sym.value ();\n\t\t\t\tmatch (\u0026 left_symval, \u0026 right_symval) {\n\t\t\t\t\t(\u0026 Self::Error (_), _) =\u003e Some (left_symval),\n\t\t\t\t\t(_, \u0026 Self::Error (_)) =\u003e Some (right_symval),\n\t\t\t\t\t(\u0026 Self::Value (left_val), \u0026 Self::Value (right_val)) =\u003e\n\t\t\t\t\t\tSome (Self::Value (left_val / right_val)),\n\t\t\t\t\t(_, \u0026 Self::Value (1)) =\u003e Some (left_symval),\n\t\t\t\t\t(_, \u0026 Self::Value (0)) =\u003e\n\t\t\t\t\t\tSome (Self::Error (MachineError::DivideByZero)),\n\t\t\t\t\t(\u0026 Self::Value (0), _) =\u003e Some (Self::Value (0)),\n\t\t\t\t\t(_, _) if left_symval == right_symval =\u003e todo! (),\n\t\t\t\t\t_ =\u003e None,\n\t\t\t\t}\n\t\t\t}\n\t\t\tSelf::Modulo (ref left_sym, ref right_sym) =\u003e {\n\t\t\t\tlet left_symval = left_sym.value ();\n\t\t\t\tlet right_symval = right_sym.value ();\n\t\t\t\tmatch (\u0026 left_symval, \u0026 right_symval) {\n\t\t\t\t\t(\u0026 Self::Error (_), _) =\u003e Some (left_symval),\n\t\t\t\t\t(_, \u0026 Self::Error (_)) =\u003e Some (right_symval),\n\t\t\t\t\t(\u0026 Self::Value (left_val), \u0026 Self::Value (right_val)) =\u003e {\n\t\t\t\t\t\tif left_val \u003e= 0 \u0026\u0026 right_val \u003e 0 {\n\t\t\t\t\t\t\tSome (Self::Value (left_val % right_val))\n\t\t\t\t\t\t} else if right_val == 0 {\n\t\t\t\t\t\t\tSome (Self::Error (MachineError::DivideByZero))\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tSome (Self::Error (MachineError::NegativeModulo))\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t(_, \u0026 Self::Value (0)) =\u003e\n\t\t\t\t\t\tSome (Self::Error (MachineError::DivideByZero)),\n\t\t\t\t\t(_, \u0026 Self::Value (right_val)) if right_val \u003c 0 =\u003e\n\t\t\t\t\t\tSome (Self::Error (MachineError::NegativeModulo)),\n\t\t\t\t\t(\u0026 Self::Value (left_val), _) if left_val \u003c 0 =\u003e\n\t\t\t\t\t\tSome (Self::Error (MachineError::NegativeModulo)),\n\t\t\t\t\t_ =\u003e None,\n\t\t\t\t}\n\t\t\t},\n\t\t\tSelf::IsEqual (ref left_sym, ref right_sym) =\u003e {\n\t\t\t\tlet left_symval = left_sym.value ();\n\t\t\t\tlet right_symval = right_sym.value ();\n\t\t\t\tmatch (\u0026 left_symval, \u0026 right_symval) {\n\t\t\t\t\t(\u0026 Self::Error (_), _) =\u003e Some (left_symval),\n\t\t\t\t\t(_, \u0026 Self::Error (_)) =\u003e Some (right_symval),\n\t\t\t\t\t(\u0026 Self::IsEqual (ref inner_left_sym, ref inner_right_sym), \u0026 Self::Value (0)) =\u003e\n\t\t\t\t\t\tSome (Self::IsUnequal (inner_left_sym.clone (), inner_right_sym.clone ())),\n\t\t\t\t\t(\u0026 Self::Value (0), \u0026 Self::IsEqual (ref inner_left_sym, ref inner_right_sym)) =\u003e\n\t\t\t\t\t\tSome (Self::IsUnequal (inner_left_sym.clone (), inner_right_sym.clone ())),\n\t\t\t\t\t(\u0026 Self::IsEqual (_, _), \u0026 Self::Value (1)) =\u003e Some (left_symval),\n\t\t\t\t\t(\u0026 Self::Value (1), \u0026 Self::IsEqual (_, _)) =\u003e Some (right_symval),\n\t\t\t\t\t(\u0026 Self::Value (left_val), \u0026 Self::Value (right_val)) =\u003e\n\t\t\t\t\t\tSome (Self::Value (if left_val == right_val { 1 } else { 0 })),\n\t\t\t\t\t_ =\u003e None,\n\t\t\t\t}\n\t\t\t},\n\t\t\tSelf::IsUnequal (ref left_sym, ref right_sym) =\u003e {\n\t\t\t\tlet left_symval = left_sym.value ();\n\t\t\t\tlet right_symval = right_sym.value ();\n\t\t\t\tmatch (\u0026 left_symval, \u0026 right_symval) {\n\t\t\t\t\t(\u0026 Self::Error (_), _) =\u003e Some (left_symval),\n\t\t\t\t\t(_, \u0026 Self::Error (_)) =\u003e Some (right_symval),\n\t\t\t\t\t(\u0026 Self::Value (ref left_val), \u0026 Self::Value (ref right_val)) =\u003e\n\t\t\t\t\t\tSome (Self::Value (if left_val != right_val { 1 } else { 0 })),\n\t\t\t\t\t_ =\u003e None,\n\t\t\t\t}\n\t\t\t},\n\t\t\tSelf::Value (_) =\u003e None,\n\t\t\tSelf::Symbol (_) | Self::Error (_) =\u003e todo! (\"SymVal::{:?}\", self),\n\t\t}\n\t}\n\tfn migrate (\u0026 self, solver: \u0026 mut Solver, input: \u0026 [i64]) -\u003e Self {\n\t\tlet dup = |arg: Symbol| solver.get (arg.name ()).unwrap ();\n\t\tmatch self.clone () {\n\t\t\tSelf::Symbol (arg) =\u003e Self::Symbol (dup (arg)),\n\t\t\tSelf::Input (arg) =\u003e\n\t\t\t\tif let Some (\u0026 val) = input.get (arg) {\n\t\t\t\t\tSelf::Value (val)\n\t\t\t\t} else {\n\t\t\t\t\tSelf::Input (arg)\n\t\t\t\t},\n\t\t\tSelf::Add (left, right) =\u003e Self::Add (dup (left), dup (right)),\n\t\t\tSelf::Multiply (left, right) =\u003e Self::Multiply (dup (left), dup (right)),\n\t\t\tSelf::Divide (left, right) =\u003e Self::Divide (dup (left), dup (right)),\n\t\t\tSelf::Modulo (left, right) =\u003e Self::Modulo (dup (left), dup (right)),\n\t\t\tSelf::IsEqual (left, right) =\u003e Self::IsEqual (dup (left), dup (right)),\n\t\t\tSelf::IsUnequal (left, right) =\u003e Self::IsUnequal (dup (left), dup (right)),\n\t\t\tSelf::Value (arg) =\u003e Self::Value (arg),\n\t\t\tSelf::Error (arg) =\u003e Self::Error (arg),\n\t\t}\n\t}\n}\n\nimpl fmt::Display for SymVal {\n\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\tlet options = FormatExpandOptions::Depth (formatter.precision ().unwrap_or (0));\n\t\twrite! (formatter, \"{}\",\n\t\t\tFormatExpand::SymVal (options, false, self)) ?;\n\t\tOk (())\n\t}\n}\n\nenum FormatExpand \u003c'dat\u003e {\n\tSymbol (FormatExpandOptions \u003c'dat\u003e, bool, \u0026 'dat Symbol),\n\tSymVal (FormatExpandOptions \u003c'dat\u003e, bool, \u0026 'dat SymVal),\n}\n\nimpl \u003c'dat\u003e fmt::Display for FormatExpand \u003c'dat\u003e {\n\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\tmatch * self {\n\t\t\tFormatExpand::Symbol (options, wrap, symbol) =\u003e\n\t\t\t\tsymbol.fmt_expand (formatter, options, wrap),\n\t\t\tFormatExpand::SymVal (options, wrap, symbol_value) =\u003e\n\t\t\t\tsymbol_value.fmt_expand (formatter, options, wrap),\n\t\t}\n\t}\n}\n\n#[ derive (Clone, Copy) ]\nenum FormatExpandOptions \u003c'dat\u003e {\n\tDepth (usize),\n\tBreakSymbols (\u0026 'dat HashSet \u003cSymbol\u003e),\n}\n\nstruct VerNamer {\n\tentries: HashMap \u003cRc \u003cstr\u003e, VerNamerEntry\u003e,\n}\n\nstruct VerNamerEntry {\n\tbase_name: Rc \u003cstr\u003e,\n\tlatest_name: Rc \u003cstr\u003e,\n\tlatest_rev: usize,\n}\n\nimpl VerNamer {\n\n\tfn new () -\u003e Self {\n\t\tSelf {\n\t\t\tentries: HashMap::new (),\n\t\t}\n\t}\n\n\tfn define (\u0026 mut self, base_name: \u0026 Rc \u003cstr\u003e) -\u003e Rc \u003cstr\u003e {\n\t\tlet entry =\n\t\t\tself.entries.entry (Rc::clone (base_name))\n\t\t\t\t.and_modify (|entry| entry.latest_rev += 1)\n\t\t\t\t.or_insert (VerNamerEntry {\n\t\t\t\t\tbase_name: Rc::clone (base_name),\n\t\t\t\t\tlatest_name: Rc::clone (base_name),\n\t\t\t\t\tlatest_rev: 0,\n\t\t\t\t});\n\t\tentry.latest_name = format! (\"{}{}\", entry.base_name, entry.latest_rev).into ();\n\t\tRc::clone (\u0026 entry.latest_name)\n\t}\n\n}\n","traces":[{"line":62,"address":[192784,194709],"length":1,"stats":{"Line":0},"fn_name":"from_prog"},{"line":77,"address":[197632],"length":1,"stats":{"Line":0},"fn_name":"get"},{"line":78,"address":[197652],"length":1,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[197689],"length":1,"stats":{"Line":0},"fn_name":null},{"line":80,"address":[197712],"length":1,"stats":{"Line":0},"fn_name":null},{"line":81,"address":[197735],"length":1,"stats":{"Line":0},"fn_name":null},{"line":82,"address":[197758],"length":1,"stats":{"Line":0},"fn_name":null},{"line":85,"address":[197792],"length":1,"stats":{"Line":0},"fn_name":"get_val"},{"line":86,"address":[197815],"length":1,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[197852],"length":1,"stats":{"Line":0},"fn_name":null},{"line":88,"address":[197875],"length":1,"stats":{"Line":0},"fn_name":null},{"line":89,"address":[197898],"length":1,"stats":{"Line":0},"fn_name":null},{"line":90,"address":[197921],"length":1,"stats":{"Line":0},"fn_name":null},{"line":91,"address":[197944],"length":1,"stats":{"Line":0},"fn_name":null},{"line":94,"address":[198456,197984,198429],"length":1,"stats":{"Line":0},"fn_name":"set"},{"line":95,"address":[198182,198013],"length":1,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[198061],"length":1,"stats":{"Line":0},"fn_name":null},{"line":97,"address":[198091],"length":1,"stats":{"Line":0},"fn_name":null},{"line":98,"address":[198121],"length":1,"stats":{"Line":0},"fn_name":null},{"line":99,"address":[198151],"length":1,"stats":{"Line":0},"fn_name":null},{"line":101,"address":[198213,198288],"length":1,"stats":{"Line":0},"fn_name":null},{"line":102,"address":[198304],"length":1,"stats":{"Line":0},"fn_name":null},{"line":103,"address":[198363],"length":1,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[198480],"length":1,"stats":{"Line":0},"fn_name":"lit"},{"line":106,"address":[198510],"length":1,"stats":{"Line":0},"fn_name":null},{"line":107,"address":[198562],"length":1,"stats":{"Line":0},"fn_name":null},{"line":108,"address":[198572],"length":1,"stats":{"Line":0},"fn_name":null},{"line":111,"address":[192849],"length":1,"stats":{"Line":0},"fn_name":null},{"line":112,"address":[192961],"length":1,"stats":{"Line":0},"fn_name":null},{"line":113,"address":[192974,193053],"length":1,"stats":{"Line":0},"fn_name":null},{"line":114,"address":[193157,193069],"length":1,"stats":{"Line":0},"fn_name":null},{"line":115,"address":[193261,193173],"length":1,"stats":{"Line":0},"fn_name":null},{"line":116,"address":[193365,193277],"length":1,"stats":{"Line":0},"fn_name":null},{"line":117,"address":[193381,193469],"length":1,"stats":{"Line":0},"fn_name":null},{"line":118,"address":[193573,193485],"length":1,"stats":{"Line":0},"fn_name":null},{"line":119,"address":[193605,193681],"length":1,"stats":{"Line":0},"fn_name":null},{"line":120,"address":[193764,193843],"length":1,"stats":{"Line":0},"fn_name":null},{"line":121,"address":[193926,194005],"length":1,"stats":{"Line":0},"fn_name":null},{"line":122,"address":[194167,194088],"length":1,"stats":{"Line":0},"fn_name":null},{"line":129,"address":[194674],"length":1,"stats":{"Line":0},"fn_name":null},{"line":130,"address":[194791,194999,194686],"length":1,"stats":{"Line":0},"fn_name":null},{"line":131,"address":[195031],"length":1,"stats":{"Line":0},"fn_name":null},{"line":132,"address":[195081],"length":1,"stats":{"Line":0},"fn_name":null},{"line":133,"address":[195091,195073],"length":1,"stats":{"Line":0},"fn_name":null},{"line":134,"address":[196638,196678],"length":1,"stats":{"Line":0},"fn_name":null},{"line":136,"address":[195141],"length":1,"stats":{"Line":0},"fn_name":null},{"line":137,"address":[196448,195210],"length":1,"stats":{"Line":0},"fn_name":null},{"line":138,"address":[196533,196472],"length":1,"stats":{"Line":0},"fn_name":null},{"line":139,"address":[196541],"length":1,"stats":{"Line":0},"fn_name":null},{"line":141,"address":[195239],"length":1,"stats":{"Line":0},"fn_name":null},{"line":142,"address":[195308,196234],"length":1,"stats":{"Line":0},"fn_name":null},{"line":143,"address":[196258,196319],"length":1,"stats":{"Line":0},"fn_name":null},{"line":144,"address":[196327],"length":1,"stats":{"Line":0},"fn_name":null},{"line":146,"address":[195337],"length":1,"stats":{"Line":0},"fn_name":null},{"line":147,"address":[196023,195400],"length":1,"stats":{"Line":0},"fn_name":null},{"line":148,"address":[196047,196105],"length":1,"stats":{"Line":0},"fn_name":null},{"line":149,"address":[196113],"length":1,"stats":{"Line":0},"fn_name":null},{"line":151,"address":[195429],"length":1,"stats":{"Line":0},"fn_name":null},{"line":152,"address":[195489,195815],"length":1,"stats":{"Line":0},"fn_name":null},{"line":153,"address":[195839,195897],"length":1,"stats":{"Line":0},"fn_name":null},{"line":154,"address":[195905],"length":1,"stats":{"Line":0},"fn_name":null},{"line":156,"address":[195515],"length":1,"stats":{"Line":0},"fn_name":null},{"line":157,"address":[195575],"length":1,"stats":{"Line":0},"fn_name":null},{"line":158,"address":[195695,195637],"length":1,"stats":{"Line":0},"fn_name":null},{"line":159,"address":[195703],"length":1,"stats":{"Line":0},"fn_name":null},{"line":163,"address":[197014,194931],"length":1,"stats":{"Line":0},"fn_name":null},{"line":164,"address":[196758],"length":1,"stats":{"Line":0},"fn_name":null},{"line":165,"address":[196822],"length":1,"stats":{"Line":0},"fn_name":null},{"line":166,"address":[196886],"length":1,"stats":{"Line":0},"fn_name":null},{"line":167,"address":[196950],"length":1,"stats":{"Line":0},"fn_name":null},{"line":172,"address":[198640,200907,199126],"length":1,"stats":{"Line":0},"fn_name":"eval"},{"line":173,"address":[198749],"length":1,"stats":{"Line":0},"fn_name":null},{"line":174,"address":[198790],"length":1,"stats":{"Line":0},"fn_name":null},{"line":175,"address":[198819],"length":1,"stats":{"Line":0},"fn_name":null},{"line":176,"address":[198855],"length":1,"stats":{"Line":0},"fn_name":null},{"line":177,"address":[198978,198910],"length":1,"stats":{"Line":0},"fn_name":null},{"line":178,"address":[199137,198990],"length":1,"stats":{"Line":0},"fn_name":null},{"line":179,"address":[199210,200875,199294,199147],"length":1,"stats":{"Line":0},"fn_name":null},{"line":180,"address":[199276,200446,200790,200818],"length":1,"stats":{"Line":0},"fn_name":null},{"line":181,"address":[200665,200724],"length":1,"stats":{"Line":0},"fn_name":null},{"line":182,"address":[200757],"length":1,"stats":{"Line":0},"fn_name":null},{"line":186,"address":[199309],"length":1,"stats":{"Line":0},"fn_name":null},{"line":187,"address":[199387,199615,199324],"length":1,"stats":{"Line":0},"fn_name":null},{"line":188,"address":[199644],"length":1,"stats":{"Line":0},"fn_name":null},{"line":189,"address":[182336,182350],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":190,"address":[199849,200060],"length":1,"stats":{"Line":0},"fn_name":null},{"line":191,"address":[200162,200108],"length":1,"stats":{"Line":0},"fn_name":null},{"line":198,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":199,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":200,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":201,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":202,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":205,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":210,"address":[203536,202427,201264],"length":1,"stats":{"Line":0},"fn_name":"fork"},{"line":211,"address":[201343],"length":1,"stats":{"Line":0},"fn_name":null},{"line":212,"address":[201388],"length":1,"stats":{"Line":0},"fn_name":null},{"line":213,"address":[182429,182416],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":214,"address":[201620,201683],"length":1,"stats":{"Line":0},"fn_name":null},{"line":215,"address":[201723,201783,203504,201867],"length":1,"stats":{"Line":0},"fn_name":null},{"line":216,"address":[201849,203419,203447,203075],"length":1,"stats":{"Line":0},"fn_name":null},{"line":217,"address":[203353,203294],"length":1,"stats":{"Line":0},"fn_name":null},{"line":218,"address":[203386],"length":1,"stats":{"Line":0},"fn_name":null},{"line":222,"address":[201874],"length":1,"stats":{"Line":0},"fn_name":null},{"line":223,"address":[202632,202243,202000,201937],"length":1,"stats":{"Line":0},"fn_name":null},{"line":224,"address":[202272],"length":1,"stats":{"Line":0},"fn_name":null},{"line":225,"address":[202310],"length":1,"stats":{"Line":0},"fn_name":null},{"line":226,"address":[202484],"length":1,"stats":{"Line":0},"fn_name":null},{"line":228,"address":[202217,202962,202790,202671],"length":1,"stats":{"Line":0},"fn_name":null},{"line":229,"address":[202811],"length":1,"stats":{"Line":0},"fn_name":null},{"line":230,"address":[202893],"length":1,"stats":{"Line":0},"fn_name":null},{"line":237,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":238,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":239,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":243,"address":[204131,203760,206474],"length":1,"stats":{"Line":0},"fn_name":"define"},{"line":244,"address":[182448,182465],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":245,"address":[204150,204208],"length":1,"stats":{"Line":0},"fn_name":null},{"line":246,"address":[204278,204349,204446],"length":1,"stats":{"Line":0},"fn_name":null},{"line":247,"address":[204384],"length":1,"stats":{"Line":0},"fn_name":null},{"line":248,"address":[204527,204431],"length":1,"stats":{"Line":0},"fn_name":null},{"line":249,"address":[204543],"length":1,"stats":{"Line":0},"fn_name":null},{"line":250,"address":[204568],"length":1,"stats":{"Line":0},"fn_name":null},{"line":251,"address":[204592,204650],"length":1,"stats":{"Line":0},"fn_name":null},{"line":252,"address":[204666],"length":1,"stats":{"Line":0},"fn_name":null},{"line":253,"address":[204707],"length":1,"stats":{"Line":0},"fn_name":null},{"line":254,"address":[205313,204786,204738],"length":1,"stats":{"Line":0},"fn_name":null},{"line":255,"address":[205002,204876],"length":1,"stats":{"Line":0},"fn_name":null},{"line":256,"address":[205125],"length":1,"stats":{"Line":0},"fn_name":null},{"line":257,"address":[205213,205264],"length":1,"stats":{"Line":0},"fn_name":null},{"line":258,"address":[205280],"length":1,"stats":{"Line":0},"fn_name":null},{"line":261,"address":[205752],"length":1,"stats":{"Line":0},"fn_name":null},{"line":275,"address":[206064,206002],"length":1,"stats":{"Line":0},"fn_name":null},{"line":276,"address":[206277],"length":1,"stats":{"Line":0},"fn_name":null},{"line":280,"address":[206949,206512],"length":1,"stats":{"Line":0},"fn_name":"dump"},{"line":281,"address":[206550],"length":1,"stats":{"Line":0},"fn_name":null},{"line":282,"address":[206564,206616],"length":1,"stats":{"Line":0},"fn_name":null},{"line":283,"address":[206643,206697,206866],"length":1,"stats":{"Line":0},"fn_name":null},{"line":284,"address":[206882],"length":1,"stats":{"Line":0},"fn_name":null},{"line":288,"address":[206992],"length":1,"stats":{"Line":0},"fn_name":"require_own_symbol"},{"line":289,"address":[207111,207125,207254,207164],"length":1,"stats":{"Line":0},"fn_name":null},{"line":290,"address":[207035,207098],"length":1,"stats":{"Line":0},"fn_name":null},{"line":293,"address":[207151],"length":1,"stats":{"Line":0},"fn_name":null},{"line":294,"address":[207241],"length":1,"stats":{"Line":0},"fn_name":null},{"line":297,"address":[208108,208134,207424],"length":1,"stats":{"Line":0},"fn_name":"dump_symbol"},{"line":298,"address":[207485],"length":1,"stats":{"Line":0},"fn_name":null},{"line":299,"address":[207559,207507],"length":1,"stats":{"Line":0},"fn_name":null},{"line":300,"address":[207600],"length":1,"stats":{"Line":0},"fn_name":null},{"line":301,"address":[207652],"length":1,"stats":{"Line":0},"fn_name":null},{"line":302,"address":[207734,207680,207911],"length":1,"stats":{"Line":0},"fn_name":null},{"line":303,"address":[207940],"length":1,"stats":{"Line":0},"fn_name":null},{"line":304,"address":[208003],"length":1,"stats":{"Line":0},"fn_name":null},{"line":307,"address":[208030],"length":1,"stats":{"Line":0},"fn_name":null},{"line":311,"address":[208895,208933,208160],"length":1,"stats":{"Line":0},"fn_name":"dump_symbol_auto"},{"line":312,"address":[208196],"length":1,"stats":{"Line":0},"fn_name":null},{"line":313,"address":[208270,208218],"length":1,"stats":{"Line":0},"fn_name":null},{"line":314,"address":[208305],"length":1,"stats":{"Line":0},"fn_name":null},{"line":315,"address":[208425,208365],"length":1,"stats":{"Line":0},"fn_name":null},{"line":317,"address":[182496,182515],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":320,"address":[208486],"length":1,"stats":{"Line":0},"fn_name":null},{"line":321,"address":[208745,208568,208511],"length":1,"stats":{"Line":0},"fn_name":null},{"line":322,"address":[182576,182585],"length":1,"stats":{"Line":0},"fn_name":"{closure#1}"},{"line":323,"address":[208826],"length":1,"stats":{"Line":0},"fn_name":null},{"line":331,"address":[209182,208960],"length":1,"stats":{"Line":0},"fn_name":"eval"},{"line":335,"address":[209035],"length":1,"stats":{"Line":0},"fn_name":null},{"line":336,"address":[209058],"length":1,"stats":{"Line":0},"fn_name":null},{"line":337,"address":[209089,209163],"length":1,"stats":{"Line":0},"fn_name":null},{"line":342,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":343,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":348,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":349,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":350,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":351,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":356,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":357,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":358,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":359,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":364,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":365,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":366,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":370,"address":[211021,209760],"length":1,"stats":{"Line":0},"fn_name":"dump"},{"line":376,"address":[209817],"length":1,"stats":{"Line":0},"fn_name":null},{"line":377,"address":[209846],"length":1,"stats":{"Line":0},"fn_name":null},{"line":378,"address":[209886,209963],"length":1,"stats":{"Line":0},"fn_name":null},{"line":379,"address":[210037],"length":1,"stats":{"Line":0},"fn_name":null},{"line":380,"address":[210126,210064],"length":1,"stats":{"Line":0},"fn_name":null},{"line":382,"address":[210101,210204],"length":1,"stats":{"Line":0},"fn_name":null},{"line":383,"address":[210221],"length":1,"stats":{"Line":0},"fn_name":null},{"line":384,"address":[210238],"length":1,"stats":{"Line":0},"fn_name":null},{"line":385,"address":[210519],"length":1,"stats":{"Line":0},"fn_name":null},{"line":386,"address":[210603],"length":1,"stats":{"Line":0},"fn_name":null},{"line":389,"address":[210496,210729],"length":1,"stats":{"Line":0},"fn_name":null},{"line":390,"address":[210838],"length":1,"stats":{"Line":0},"fn_name":null},{"line":393,"address":[210259],"length":1,"stats":{"Line":0},"fn_name":null},{"line":395,"address":[210987,210446],"length":1,"stats":{"Line":0},"fn_name":null},{"line":400,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":401,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":402,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":403,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":408,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":409,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":410,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":411,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":416,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":417,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":422,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":423,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":424,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":429,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":430,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":431,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":434,"address":[211520,212200,213188],"length":1,"stats":{"Line":0},"fn_name":"fmt_expand"},{"line":440,"address":[211582],"length":1,"stats":{"Line":0},"fn_name":null},{"line":441,"address":[211611],"length":1,"stats":{"Line":0},"fn_name":null},{"line":442,"address":[211648],"length":1,"stats":{"Line":0},"fn_name":null},{"line":443,"address":[211667],"length":1,"stats":{"Line":0},"fn_name":null},{"line":444,"address":[211684],"length":1,"stats":{"Line":0},"fn_name":null},{"line":445,"address":[212608,212685],"length":1,"stats":{"Line":0},"fn_name":null},{"line":446,"address":[212649,212729],"length":1,"stats":{"Line":0},"fn_name":null},{"line":448,"address":[212579,213002],"length":1,"stats":{"Line":0},"fn_name":null},{"line":451,"address":[211712],"length":1,"stats":{"Line":0},"fn_name":null},{"line":452,"address":[211724,211779],"length":1,"stats":{"Line":0},"fn_name":null},{"line":453,"address":[211823,212022],"length":1,"stats":{"Line":0},"fn_name":null},{"line":455,"address":[182627,182608],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":456,"address":[212263,212518],"length":1,"stats":{"Line":0},"fn_name":null},{"line":460,"address":[211996],"length":1,"stats":{"Line":0},"fn_name":null},{"line":463,"address":[214188,214098,213232],"length":1,"stats":{"Line":0},"fn_name":"use_counts"},{"line":464,"address":[213265],"length":1,"stats":{"Line":0},"fn_name":null},{"line":465,"address":[213358,213291],"length":1,"stats":{"Line":0},"fn_name":null},{"line":466,"address":[213370],"length":1,"stats":{"Line":0},"fn_name":null},{"line":467,"address":[213382,213438],"length":1,"stats":{"Line":0},"fn_name":null},{"line":468,"address":[213538,213452,214156],"length":1,"stats":{"Line":0},"fn_name":null},{"line":469,"address":[213642,213526,214109],"length":1,"stats":{"Line":0},"fn_name":null},{"line":470,"address":[213853,213923],"length":1,"stats":{"Line":0},"fn_name":null},{"line":471,"address":[213967],"length":1,"stats":{"Line":0},"fn_name":null},{"line":472,"address":[213981,214029],"length":1,"stats":{"Line":0},"fn_name":null},{"line":474,"address":[213998,214048,214066],"length":1,"stats":{"Line":0},"fn_name":null},{"line":477,"address":[213545],"length":1,"stats":{"Line":0},"fn_name":null},{"line":483,"address":[214224],"length":1,"stats":{"Line":0},"fn_name":"partial_cmp"},{"line":484,"address":[214300,214363],"length":1,"stats":{"Line":0},"fn_name":null},{"line":489,"address":[214496],"length":1,"stats":{"Line":0},"fn_name":"fmt"},{"line":490,"address":[214518],"length":1,"stats":{"Line":0},"fn_name":null},{"line":491,"address":[214541,214678],"length":1,"stats":{"Line":0},"fn_name":null},{"line":492,"address":[214671],"length":1,"stats":{"Line":0},"fn_name":null},{"line":497,"address":[214720],"length":1,"stats":{"Line":0},"fn_name":"fmt"},{"line":498,"address":[214893,215043],"length":1,"stats":{"Line":0},"fn_name":null},{"line":499,"address":[214837],"length":1,"stats":{"Line":0},"fn_name":null},{"line":500,"address":[214766],"length":1,"stats":{"Line":0},"fn_name":null},{"line":503,"address":[215036],"length":1,"stats":{"Line":0},"fn_name":null},{"line":508,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":509,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":514,"address":[215149,215088,215200],"length":1,"stats":{"Line":0},"fn_name":"eq"},{"line":521,"address":[215232,216712,216741],"length":1,"stats":{"Line":0},"fn_name":"eval"},{"line":527,"address":[183771,185976,183800,186016,184859,189240,184928,184888,187064,188123,183840,188192,185947,188152,187035,189211,182752,187104],"length":1,"stats":{"Line":0},"fn_name":"combine\u003caoc_2021_day_24::solver::{impl#8}::eval::{closure_env#4}\u003e"},{"line":532,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":533,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":534,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":536,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":537,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":538,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":541,"address":[216419,215335],"length":1,"stats":{"Line":0},"fn_name":null},{"line":542,"address":[215396],"length":1,"stats":{"Line":0},"fn_name":null},{"line":543,"address":[215408,218158],"length":1,"stats":{"Line":0},"fn_name":null},{"line":544,"address":[215475],"length":1,"stats":{"Line":0},"fn_name":null},{"line":545,"address":[217886,215490],"length":1,"stats":{"Line":0},"fn_name":null},{"line":546,"address":[215536],"length":1,"stats":{"Line":0},"fn_name":null},{"line":547,"address":[189280,189299],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":548,"address":[215638],"length":1,"stats":{"Line":0},"fn_name":null},{"line":549,"address":[189379,189360],"length":1,"stats":{"Line":0},"fn_name":"{closure#1}"},{"line":550,"address":[215740],"length":1,"stats":{"Line":0},"fn_name":null},{"line":551,"address":[189468,189440],"length":1,"stats":{"Line":0},"fn_name":"{closure#2}"},{"line":552,"address":[215842],"length":1,"stats":{"Line":0},"fn_name":null},{"line":553,"address":[189628,189600],"length":1,"stats":{"Line":0},"fn_name":"{closure#3}"},{"line":554,"address":[215944],"length":1,"stats":{"Line":0},"fn_name":null},{"line":555,"address":[189776,189795],"length":1,"stats":{"Line":0},"fn_name":"{closure#4}"},{"line":556,"address":[216046],"length":1,"stats":{"Line":0},"fn_name":null},{"line":557,"address":[189840,189859],"length":1,"stats":{"Line":0},"fn_name":"{closure#5}"},{"line":558,"address":[216132],"length":1,"stats":{"Line":0},"fn_name":null},{"line":559,"address":[216476,216152],"length":1,"stats":{"Line":0},"fn_name":null},{"line":560,"address":[216186],"length":1,"stats":{"Line":0},"fn_name":null},{"line":561,"address":[216201],"length":1,"stats":{"Line":0},"fn_name":null},{"line":568,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":569,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":570,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":571,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":572,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":577,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":578,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":583,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":584,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":589,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":590,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":591,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":592,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":593,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":598,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":599,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":603,"address":[219424],"length":1,"stats":{"Line":0},"fn_name":"children"},{"line":604,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":605,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":607,"address":[219453],"length":1,"stats":{"Line":0},"fn_name":null},{"line":608,"address":[219493],"length":1,"stats":{"Line":0},"fn_name":null},{"line":609,"address":[219530],"length":1,"stats":{"Line":0},"fn_name":null},{"line":610,"address":[219549],"length":1,"stats":{"Line":0},"fn_name":null},{"line":611,"address":[219610],"length":1,"stats":{"Line":0},"fn_name":null},{"line":612,"address":[219671],"length":1,"stats":{"Line":0},"fn_name":null},{"line":613,"address":[219732],"length":1,"stats":{"Line":0},"fn_name":null},{"line":614,"address":[219793],"length":1,"stats":{"Line":0},"fn_name":null},{"line":615,"address":[219851],"length":1,"stats":{"Line":0},"fn_name":null},{"line":616,"address":[219908],"length":1,"stats":{"Line":0},"fn_name":null},{"line":617,"address":[219920],"length":1,"stats":{"Line":0},"fn_name":null},{"line":620,"address":[219952],"length":1,"stats":{"Line":0},"fn_name":"fmt_expand"},{"line":626,"address":[190416,190445],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":627,"address":[220020],"length":1,"stats":{"Line":0},"fn_name":null},{"line":628,"address":[220206],"length":1,"stats":{"Line":0},"fn_name":null},{"line":629,"address":[220258],"length":1,"stats":{"Line":0},"fn_name":null},{"line":630,"address":[224438,220270],"length":1,"stats":{"Line":0},"fn_name":null},{"line":631,"address":[220341],"length":1,"stats":{"Line":0},"fn_name":null},{"line":632,"address":[220353,224280],"length":1,"stats":{"Line":0},"fn_name":null},{"line":633,"address":[220395],"length":1,"stats":{"Line":0},"fn_name":null},{"line":634,"address":[220438,223822],"length":1,"stats":{"Line":0},"fn_name":null},{"line":635,"address":[220481],"length":1,"stats":{"Line":0},"fn_name":null},{"line":636,"address":[223360,220524],"length":1,"stats":{"Line":0},"fn_name":null},{"line":637,"address":[220567],"length":1,"stats":{"Line":0},"fn_name":null},{"line":638,"address":[220610,222868],"length":1,"stats":{"Line":0},"fn_name":null},{"line":639,"address":[220653],"length":1,"stats":{"Line":0},"fn_name":null},{"line":640,"address":[220696,222376],"length":1,"stats":{"Line":0},"fn_name":null},{"line":641,"address":[220739],"length":1,"stats":{"Line":0},"fn_name":null},{"line":642,"address":[220782,221884],"length":1,"stats":{"Line":0},"fn_name":null},{"line":643,"address":[220825],"length":1,"stats":{"Line":0},"fn_name":null},{"line":644,"address":[220868,221392],"length":1,"stats":{"Line":0},"fn_name":null},{"line":645,"address":[220911],"length":1,"stats":{"Line":0},"fn_name":null},{"line":646,"address":[221222,220923],"length":1,"stats":{"Line":0},"fn_name":null},{"line":647,"address":[220966],"length":1,"stats":{"Line":0},"fn_name":null},{"line":648,"address":[220978,221164],"length":1,"stats":{"Line":0},"fn_name":null},{"line":650,"address":[221154],"length":1,"stats":{"Line":0},"fn_name":null},{"line":652,"address":[224640],"length":1,"stats":{"Line":0},"fn_name":"expand"},{"line":653,"address":[224657],"length":1,"stats":{"Line":0},"fn_name":null},{"line":654,"address":[224670],"length":1,"stats":{"Line":0},"fn_name":null},{"line":656,"address":[224736],"length":1,"stats":{"Line":0},"fn_name":"simplified"},{"line":657,"address":[224760],"length":1,"stats":{"Line":0},"fn_name":null},{"line":658,"address":[224812],"length":1,"stats":{"Line":0},"fn_name":null},{"line":659,"address":[224800],"length":1,"stats":{"Line":0},"fn_name":null},{"line":662,"address":[225259,224880],"length":1,"stats":{"Line":0},"fn_name":"simplify"},{"line":663,"address":[224908],"length":1,"stats":{"Line":0},"fn_name":null},{"line":664,"address":[224913],"length":1,"stats":{"Line":0},"fn_name":null},{"line":665,"address":[224970,224916,225254,225086,225195],"length":1,"stats":{"Line":0},"fn_name":null},{"line":666,"address":[225022,225111],"length":1,"stats":{"Line":0},"fn_name":null},{"line":667,"address":[225183,225227],"length":1,"stats":{"Line":0},"fn_name":null},{"line":672,"address":[225296,226686,226640],"length":1,"stats":{"Line":0},"fn_name":"simplify_real"},{"line":673,"address":[225327],"length":1,"stats":{"Line":0},"fn_name":null},{"line":674,"address":[225526],"length":1,"stats":{"Line":0},"fn_name":null},{"line":675,"address":[225534],"length":1,"stats":{"Line":0},"fn_name":null},{"line":676,"address":[225582],"length":1,"stats":{"Line":0},"fn_name":null},{"line":677,"address":[231900,231852],"length":1,"stats":{"Line":0},"fn_name":null},{"line":678,"address":[232442,232061,231908,232319],"length":1,"stats":{"Line":0},"fn_name":null},{"line":679,"address":[231965],"length":1,"stats":{"Line":0},"fn_name":null},{"line":680,"address":[232154],"length":1,"stats":{"Line":0},"fn_name":null},{"line":681,"address":[232264],"length":1,"stats":{"Line":0},"fn_name":null},{"line":682,"address":[232703,232304],"length":1,"stats":{"Line":0},"fn_name":null},{"line":683,"address":[232346],"length":1,"stats":{"Line":0},"fn_name":null},{"line":684,"address":[232495],"length":1,"stats":{"Line":0},"fn_name":null},{"line":686,"address":[232649],"length":1,"stats":{"Line":0},"fn_name":null},{"line":689,"address":[225608],"length":1,"stats":{"Line":0},"fn_name":null},{"line":690,"address":[225656],"length":1,"stats":{"Line":0},"fn_name":null},{"line":691,"address":[230950,230998],"length":1,"stats":{"Line":0},"fn_name":null},{"line":692,"address":[231159,231427,231006,231468],"length":1,"stats":{"Line":0},"fn_name":null},{"line":693,"address":[231063],"length":1,"stats":{"Line":0},"fn_name":null},{"line":694,"address":[231252],"length":1,"stats":{"Line":0},"fn_name":null},{"line":695,"address":[231362],"length":1,"stats":{"Line":0},"fn_name":null},{"line":696,"address":[231402,231667],"length":1,"stats":{"Line":0},"fn_name":null},{"line":697,"address":[231458,231614],"length":1,"stats":{"Line":0},"fn_name":null},{"line":698,"address":[231511,231566],"length":1,"stats":{"Line":0},"fn_name":null},{"line":699,"address":[231491],"length":1,"stats":{"Line":0},"fn_name":null},{"line":702,"address":[225682],"length":1,"stats":{"Line":0},"fn_name":null},{"line":703,"address":[225730],"length":1,"stats":{"Line":0},"fn_name":null},{"line":704,"address":[229748,229796],"length":1,"stats":{"Line":0},"fn_name":null},{"line":705,"address":[230230,229804,230409,229957],"length":1,"stats":{"Line":0},"fn_name":null},{"line":706,"address":[229861],"length":1,"stats":{"Line":0},"fn_name":null},{"line":707,"address":[230050],"length":1,"stats":{"Line":0},"fn_name":null},{"line":708,"address":[230160],"length":1,"stats":{"Line":0},"fn_name":null},{"line":709,"address":[230675,230210],"length":1,"stats":{"Line":0},"fn_name":null},{"line":710,"address":[230279],"length":1,"stats":{"Line":0},"fn_name":null},{"line":712,"address":[230375,230625],"length":1,"stats":{"Line":0},"fn_name":null},{"line":713,"address":[230463,230577],"length":1,"stats":{"Line":0},"fn_name":null},{"line":715,"address":[230528],"length":1,"stats":{"Line":0},"fn_name":null},{"line":718,"address":[225756],"length":1,"stats":{"Line":0},"fn_name":null},{"line":719,"address":[225804],"length":1,"stats":{"Line":0},"fn_name":null},{"line":720,"address":[228340,228388],"length":1,"stats":{"Line":0},"fn_name":null},{"line":721,"address":[228549,228817,228396],"length":1,"stats":{"Line":0},"fn_name":null},{"line":722,"address":[228453],"length":1,"stats":{"Line":0},"fn_name":null},{"line":723,"address":[228642],"length":1,"stats":{"Line":0},"fn_name":null},{"line":724,"address":[228752],"length":1,"stats":{"Line":0},"fn_name":null},{"line":725,"address":[228802,229488,229232],"length":1,"stats":{"Line":0},"fn_name":null},{"line":726,"address":[229298],"length":1,"stats":{"Line":0},"fn_name":null},{"line":727,"address":[229278,229646,229598],"length":1,"stats":{"Line":0},"fn_name":null},{"line":728,"address":[229493,229611],"length":1,"stats":{"Line":0},"fn_name":null},{"line":730,"address":[229524],"length":1,"stats":{"Line":0},"fn_name":null},{"line":734,"address":[229192,228832],"length":1,"stats":{"Line":0},"fn_name":null},{"line":735,"address":[228866],"length":1,"stats":{"Line":0},"fn_name":null},{"line":736,"address":[228999,228920],"length":1,"stats":{"Line":0},"fn_name":null},{"line":737,"address":[229085,229039],"length":1,"stats":{"Line":0},"fn_name":null},{"line":738,"address":[229105],"length":1,"stats":{"Line":0},"fn_name":null},{"line":739,"address":[229077],"length":1,"stats":{"Line":0},"fn_name":null},{"line":742,"address":[225830],"length":1,"stats":{"Line":0},"fn_name":null},{"line":743,"address":[225878],"length":1,"stats":{"Line":0},"fn_name":null},{"line":744,"address":[226760,226805],"length":1,"stats":{"Line":0},"fn_name":null},{"line":745,"address":[227233,226813,227041,227833,226966],"length":1,"stats":{"Line":0},"fn_name":null},{"line":746,"address":[226870],"length":1,"stats":{"Line":0},"fn_name":null},{"line":747,"address":[227123],"length":1,"stats":{"Line":0},"fn_name":null},{"line":748,"address":[227469],"length":1,"stats":{"Line":0},"fn_name":null},{"line":749,"address":[227517,227652],"length":1,"stats":{"Line":0},"fn_name":null},{"line":750,"address":[227879],"length":1,"stats":{"Line":0},"fn_name":null},{"line":751,"address":[228062,227927],"length":1,"stats":{"Line":0},"fn_name":null},{"line":752,"address":[227540],"length":1,"stats":{"Line":0},"fn_name":null},{"line":753,"address":[227950],"length":1,"stats":{"Line":0},"fn_name":null},{"line":754,"address":[227287],"length":1,"stats":{"Line":0},"fn_name":null},{"line":755,"address":[227429,227327],"length":1,"stats":{"Line":0},"fn_name":null},{"line":756,"address":[227033],"length":1,"stats":{"Line":0},"fn_name":null},{"line":759,"address":[225904],"length":1,"stats":{"Line":0},"fn_name":null},{"line":760,"address":[225952],"length":1,"stats":{"Line":0},"fn_name":null},{"line":761,"address":[226066,226018],"length":1,"stats":{"Line":0},"fn_name":null},{"line":762,"address":[226227,226283,226074],"length":1,"stats":{"Line":0},"fn_name":null},{"line":763,"address":[226131],"length":1,"stats":{"Line":0},"fn_name":null},{"line":764,"address":[226310],"length":1,"stats":{"Line":0},"fn_name":null},{"line":765,"address":[226420],"length":1,"stats":{"Line":0},"fn_name":null},{"line":766,"address":[226537,226476],"length":1,"stats":{"Line":0},"fn_name":null},{"line":767,"address":[226278],"length":1,"stats":{"Line":0},"fn_name":null},{"line":770,"address":[225983],"length":1,"stats":{"Line":0},"fn_name":null},{"line":774,"address":[233024,234129],"length":1,"stats":{"Line":0},"fn_name":"migrate"},{"line":775,"address":[190512,190526],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":776,"address":[233199],"length":1,"stats":{"Line":0},"fn_name":null},{"line":777,"address":[233248,235471],"length":1,"stats":{"Line":0},"fn_name":null},{"line":778,"address":[233319],"length":1,"stats":{"Line":0},"fn_name":null},{"line":779,"address":[233340,235372],"length":1,"stats":{"Line":0},"fn_name":null},{"line":780,"address":[235425],"length":1,"stats":{"Line":0},"fn_name":null},{"line":782,"address":[235448],"length":1,"stats":{"Line":0},"fn_name":null},{"line":784,"address":[233358,235131],"length":1,"stats":{"Line":0},"fn_name":null},{"line":785,"address":[234890,233437],"length":1,"stats":{"Line":0},"fn_name":null},{"line":786,"address":[234649,233516],"length":1,"stats":{"Line":0},"fn_name":null},{"line":787,"address":[233595,234408],"length":1,"stats":{"Line":0},"fn_name":null},{"line":788,"address":[234170,233674],"length":1,"stats":{"Line":0},"fn_name":null},{"line":789,"address":[233753,233906,234163],"length":1,"stats":{"Line":0},"fn_name":null},{"line":790,"address":[233837],"length":1,"stats":{"Line":0},"fn_name":null},{"line":791,"address":[233868],"length":1,"stats":{"Line":0},"fn_name":null},{"line":797,"address":[235488],"length":1,"stats":{"Line":0},"fn_name":"fmt"},{"line":798,"address":[235534],"length":1,"stats":{"Line":0},"fn_name":null},{"line":799,"address":[235681,235831],"length":1,"stats":{"Line":0},"fn_name":null},{"line":800,"address":[235599],"length":1,"stats":{"Line":0},"fn_name":null},{"line":801,"address":[235824],"length":1,"stats":{"Line":0},"fn_name":null},{"line":811,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":812,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":813,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":814,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":815,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":816,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":839,"address":[236128],"length":1,"stats":{"Line":0},"fn_name":"new"},{"line":841,"address":[236142],"length":1,"stats":{"Line":0},"fn_name":null},{"line":845,"address":[236192,236584,236633],"length":1,"stats":{"Line":0},"fn_name":"define"},{"line":846,"address":[236600,236246,236548],"length":1,"stats":{"Line":0},"fn_name":null},{"line":848,"address":[190672,190686],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":849,"address":[236488],"length":1,"stats":{"Line":0},"fn_name":null},{"line":850,"address":[236335,236408],"length":1,"stats":{"Line":0},"fn_name":null},{"line":851,"address":[236424],"length":1,"stats":{"Line":0},"fn_name":null},{"line":854,"address":[236616,236668],"length":1,"stats":{"Line":0},"fn_name":null},{"line":855,"address":[236958],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":464},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","day-25","src","lib.rs"],"content":"//! Advent of Code 2021: Day 25: Sea Cucumber\n//!\n//! [https://adventofcode.com/2021/day/25](https://adventofcode.com/2021/day/25)\n\nuse aoc_bitvec as bitvec;\nuse aoc_common::*;\nuse aoc_grid as grid;\nuse aoc_pos as pos;\n\npuzzle_info! {\n\tname = \"Sea Cucumber\";\n\tyear = 2021;\n\tday = 25;\n\tpart_one = |lines| logic::part_one (lines);\n}\n\nmod logic {\n\n\tuse super::*;\n\tuse model::Pos;\n\tuse model::Region;\n\tuse model::Seafloor;\n\tuse nums::IntConv;\n\n\tpub fn part_one (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003ci64\u003e {\n\t\tlet seafloor = Seafloor::parse (lines) ?;\n\t\tlet mut count = 0;\n\t\tlet mut prev_seafloor = seafloor;\n\t\tloop {\n\t\t\tlet next_seafloor = move_both (\u0026 prev_seafloor);\n\t\t\tcount += 1;\n\t\t\tif prev_seafloor == next_seafloor { break }\n\t\t\tprev_seafloor = next_seafloor;\n\t\t}\n\t\tOk (count)\n\t}\n\n\tpub fn move_both (seafloor: \u0026 Seafloor) -\u003e Seafloor {\n\t\tlet size = seafloor.size ();\n\t\tlet iter_row = |y|\n\t\t\titer::once (seafloor.get (Pos { y, x: size.x - 1 }))\n\t\t\t\t.chain (seafloor.values ()\n\t\t\t\t\t.skip (size.x.as_usize () * y.as_usize ())\n\t\t\t\t\t.take (size.x.as_usize ()))\n\t\t\t\t.chain (iter::once (seafloor.get (Pos { y, x: 0 })))\n\t\t\t\t.collect::\u003cVec \u003cRegion\u003e\u003e ();\n\t\tlet data =\n\t\t\titer::once (iter_row (size.y - 1))\n\t\t\t\t.chain ((0 .. size.y).map (iter_row))\n\t\t\t\t.chain (iter::once (iter_row (0)))\n\t\t\t\t.scan ((Rc::new (Vec::new ()), Rc::new (Vec::new ())),\n\t\t\t\t\tmove |rows, row| {\n\t\t\t\t\t\tlet row_0 = Rc::clone (\u0026 rows.0);\n\t\t\t\t\t\tlet row_1 = Rc::clone (\u0026 rows.1);\n\t\t\t\t\t\tlet row_2 = Rc::new (row);\n\t\t\t\t\t\t* rows = (Rc::clone (\u0026 row_1), Rc::clone (\u0026 row_2));\n\t\t\t\t\t\tif row_0.len () == 0 || row_1.len () == 0 {\n\t\t\t\t\t\t\treturn Some (Either::Left (iter::empty ()));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tSome (Either::Right (\n\t\t\t\t\t\t\t(0 .. size.x.as_usize ()).map (move |idx|\n\t\t\t\t\t\t\t\tcalc_one_region (\n\t\t\t\t\t\t\t\t\trow_0 [idx .. idx + 3].try_into ().unwrap (),\n\t\t\t\t\t\t\t\t\trow_1 [idx .. idx + 3].try_into ().unwrap (),\n\t\t\t\t\t\t\t\t\trow_2 [idx .. idx + 3].try_into ().unwrap (),\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t))\n\t\t\t\t\t})\n\t\t\t\t.flatten ()\n\t\t\t\t.collect::\u003cVec \u003c_\u003e\u003e ();\n\t\tSeafloor::new (size, data)\n\t}\n\n\tpub const fn calc_one_region (\n\t\tabove: [Region; 3],\n\t\tlevel: [Region; 3],\n\t\tbelow: [Region; 3],\n\t) -\u003e Region {\n\t\tuse Region::{ Empty as X, East as E, South as S };\n\t\t#[ allow (clippy::unnested_or_patterns) ]\n\t\tmatch (above, level, below) {\n\t\t\t([_, _, _], [E, X, _], [_, _, _]) =\u003e E,\n\t\t\t([_, S, _], [_, E, X], [_, _, _])\n\t\t\t\t| ([_, S, _], [_, X, _], [_, _, _])\n\t\t\t\t| ([_, _, _], [_, S, _], [E, X, _]) =\u003e S,\n\t\t\t([_, _, _], [_, E, X], [_, _, _])\n\t\t\t\t| ([_, _, _], [_, S, _], [_, E, X])\n\t\t\t\t| ([_, _, _], [_, S, _], [_, X, _]) =\u003e X,\n\t\t\t([_, _, _], [_, h, _], [_, _, _]) =\u003e h,\n\t\t}\n\t}\n\n\t#[ cfg (test) ]\n\tmod tests {\n\n\t\tuse super::*;\n\n\t\tfn test_sequence \u003cStepFn: Fn (\u0026 Seafloor) -\u003e Seafloor\u003e (\n\t\t\tstep_fn: StepFn,\n\t\t\tseafloor_strs: \u0026 [\u0026 [\u0026 str]],\n\t\t) -\u003e GenResult \u003c()\u003e {\n\t\t\tlet mut seafloor = Seafloor::parse (seafloor_strs [0]) ?;\n\t\t\tlet count = |seafloor: \u0026 Seafloor, region|\n\t\t\t\tseafloor.iter ()\n\t\t\t\t\t.filter (|\u0026 (_, other_region)| region == other_region)\n\t\t\t\t\t.count ();\n\t\t\tlet num_east = count (\u0026 seafloor, Region::East);\n\t\t\tlet num_south = count (\u0026 seafloor, Region::South);\n\t\t\tfor expect_str in seafloor_strs.iter ().skip (1) {\n\t\t\t\tlet expect = Seafloor::parse (expect_str) ?;\n\t\t\t\tseafloor = step_fn (\u0026 seafloor);\n\t\t\t\tassert_eq! (expect, seafloor);\n\t\t\t\tassert_eq! (num_east, count (\u0026 seafloor, Region::East));\n\t\t\t\tassert_eq! (num_south, count (\u0026 seafloor, Region::South));\n\t\t\t}\n\t\t\tOk (())\n\t\t}\n\n\t\t#[ test ]\n\t\tfn test_complex () -\u003e GenResult \u003c()\u003e {\n\t\t\ttest_sequence (move_both, \u0026 [\n\t\t\t\t\u0026 [ \"v...\u003e\u003e.vv\u003e\", \".vv\u003e\u003e.vv..\", \"\u003e\u003e.\u003ev\u003e...v\", \"\u003e\u003ev\u003e\u003e.\u003e.v.\", \"v\u003ev.vv.v..\",\n\t\t\t\t\t\"\u003e.\u003e\u003e..v...\", \".vv..\u003e.\u003ev.\", \"v.v..\u003e\u003ev.v\", \"....v..v.\u003e\" ],\n\t\t\t\t\u0026 [ \"....\u003e.\u003ev.\u003e\", \"v.v\u003e.\u003ev.v.\", \"\u003ev\u003e\u003e..\u003ev..\", \"\u003e\u003ev\u003ev\u003e.\u003e.v\", \".\u003ev.v...v.\",\n\t\t\t\t\t\"v\u003e\u003e.\u003evvv..\", \"..v...\u003e\u003e..\", \"vv...\u003e\u003evv.\", \"\u003e.v.v..v.v\" ],\n\t\t\t])\n\t\t}\n\n\t\t#[ test ]\n\t\tfn test_east () -\u003e GenResult \u003c()\u003e {\n\t\t\ttest_sequence (move_both, \u0026 [\n\t\t\t\t\u0026 [\"...\u003e\u003e\u003e\u003e\u003e...\"], \u0026 [\"...\u003e\u003e\u003e\u003e.\u003e..\"], \u0026 [\"...\u003e\u003e\u003e.\u003e.\u003e.\"], \u0026 [\"...\u003e\u003e.\u003e.\u003e.\u003e\"],\n\t\t\t])\n\t\t}\n\n\t\t#[ test ]\n\t\tfn test_both () -\u003e GenResult \u003c()\u003e {\n\t\t\ttest_sequence (move_both, \u0026 [\n\t\t\t\t\u0026 [\"..........\", \".\u003ev....v..\", \".......\u003e..\", \"..........\"],\n\t\t\t\t\u0026 [\"..........\", \".\u003e........\", \"..v....v\u003e.\", \"..........\"],\n\t\t\t\t\u0026 [\"..........\", \"..\u003e.......\", \".........\u003e\", \"..v....v..\"],\n\t\t\t])\n\t\t}\n\n\t}\n\n}\n\nmod model {\n\n\tuse super::*;\n\tuse bitvec::BitVecNative;\n\tuse grid::Grid;\n\tuse nums::IntConv;\n\tuse pos::PosYX;\n\n\tpub type Pos = PosYX \u003cCoord\u003e;\n\tpub type Coord = u16;\n\tpub type GridInner = Vec \u003cRegion\u003e;\n\n\t#[ derive (Clone, Eq, PartialEq) ]\n\tpub struct Seafloor {\n\t\tgrid: Grid \u003cGridInner, Pos\u003e,\n\t\tsize: Pos,\n\t}\n\n\timpl Seafloor {\n\t\tpub fn new (size: Pos, regions: GridInner) -\u003e Self {\n\t\t\tlet grid_size = [size.y.as_usize (), size.x.as_usize ()];\n\t\t\tlet grid = Grid::wrap (regions, [0, 0], grid_size);\n\t\t\tSelf { grid, size }\n\t\t}\n\t\tpub const fn size (\u0026 self) -\u003e Pos { self.size }\n\t\tpub fn parse (lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cSelf\u003e {\n\t\t\tif lines.is_empty () { Err (\"Invalid input\") ? }\n\t\t\tlet size = Pos { y: lines.len ().as_u16 (), x: lines [0].chars ().count ().as_u16 () };\n\t\t\tlet data = lines.iter ().enumerate ()\n\t\t\t\t.flat_map (|(line_idx, line)| {\n\t\t\t\t\tlet line_err = move || format! (\"Invalid input: {}: {}\", line_idx, line);\n\t\t\t\t\tline.chars ().map::\u003cResult \u003c_, String\u003e, _\u003e (move |letter|\n\t\t\t\t\t\tOk (match letter {\n\t\t\t\t\t\t\t'.' =\u003e Region::Empty,\n\t\t\t\t\t\t\t'\u003e' =\u003e Region::East,\n\t\t\t\t\t\t\t'v' =\u003e Region::South,\n\t\t\t\t\t\t\t_ =\u003e Err (line_err ()) ?,\n\t\t\t\t\t\t}),\n\t\t\t\t\t)\n\t\t\t\t}).collect::\u003cResult \u003c_, _\u003e\u003e () ?;\n\t\t\tlet grid_size = [size.y.as_usize (), size.x.as_usize ()];\n\t\t\tlet grid = Grid::wrap (data, [0, 0], grid_size);\n\t\t\tOk (Self { grid, size })\n\t\t}\n\t\tpub fn get (\u0026 self, pos: Pos) -\u003e Region {\n\t\t\tself.grid.get (pos).unwrap ()\n\t\t}\n\t\tpub fn iter (\u0026 self) -\u003e impl Iterator \u003cItem = (Pos, Region)\u003e + '_ {\n\t\t\tself.grid.iter ()\n\t\t}\n\t\tpub fn values (\u0026 self) -\u003e impl Iterator \u003cItem = Region\u003e + '_ {\n\t\t\tself.grid.values ()\n\t\t}\n\t}\n\n\timpl fmt::Debug for Seafloor {\n\t\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\t\twrite! (formatter, \"Seafloor {{ {:?}, \", self.size) ?;\n\t\t\tfor (pos, region) in self.iter () {\n\t\t\t\tif pos.x == 0 \u0026\u0026 pos.y \u003e 0 { write! (formatter, \", \") ?; }\n\t\t\t\tif pos.x == 0 { write! (formatter, \"\\\"\") ?; }\n\t\t\t\twrite! (formatter, \"{}\", region) ?;\n\t\t\t\tif pos.x + 1 == self.size.x { write! (formatter, \"\\\"\") ?; }\n\t\t\t}\n\t\t\twrite! (formatter, \" }}\") ?;\n\t\t\tOk (())\n\t\t}\n\t}\n\n\t#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\n\tpub enum Region {\n\t\tEmpty,\n\t\tEast,\n\t\tSouth,\n\t}\n\n\timpl BitVecNative for Region {\n\t\tconst BITS: u32 = 2;\n\t\tfn encode (self) -\u003e usize {\n\t\t\tmatch self {\n\t\t\t\tSelf::Empty =\u003e 0x0,\n\t\t\t\tSelf::East =\u003e 0x1,\n\t\t\t\tSelf::South =\u003e 0x2,\n\t\t\t}\n\t\t}\n\t\tfn decode (encoded: usize) -\u003e Self {\n\t\t\tmatch encoded {\n\t\t\t\t0 =\u003e Self::Empty,\n\t\t\t\t1 =\u003e Self::East,\n\t\t\t\t2 =\u003e Self::South,\n\t\t\t\t_ =\u003e panic! (\"Invalid encoded value for Region: {:#x}\", encoded),\n\t\t\t}\n\t\t}\n\t}\n\n\timpl Display for Region {\n\t\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\t\twrite! (formatter, \"{}\", match * self {\n\t\t\t\tSelf::Empty =\u003e '.',\n\t\t\t\tSelf::East =\u003e '\u003e',\n\t\t\t\tSelf::South =\u003e 'v',\n\t\t\t})\n\t\t}\n\t}\n\n}\n\n#[ cfg (test) ]\nmod examples {\n\n\tuse super::*;\n\n\tconst EXAMPLE_0: \u0026 [\u0026 str] = \u0026 [\n\t\t\"v...\u003e\u003e.vv\u003e\", \".vv\u003e\u003e.vv..\", \"\u003e\u003e.\u003ev\u003e...v\", \"\u003e\u003ev\u003e\u003e.\u003e.v.\", \"v\u003ev.vv.v..\", \"\u003e.\u003e\u003e..v...\",\n\t\t\".vv..\u003e.\u003ev.\", \"v.v..\u003e\u003ev.v\", \"....v..v.\u003e\",\n\t];\n\n\t#[ test ]\n\tfn part_one () -\u003e GenResult \u003c()\u003e {\n\t\tassert_eq! (58, logic::part_one (EXAMPLE_0) ?);\n\t\tOk (())\n\t}\n\n}\n","traces":[{"line":10,"address":[53001],"length":1,"stats":{"Line":0},"fn_name":null},{"line":14,"address":[53086],"length":1,"stats":{"Line":0},"fn_name":null},{"line":25,"address":[39020,38224],"length":1,"stats":{"Line":1},"fn_name":"part_one"},{"line":26,"address":[38257,38428],"length":1,"stats":{"Line":1},"fn_name":null},{"line":27,"address":[38378],"length":1,"stats":{"Line":1},"fn_name":null},{"line":28,"address":[38390],"length":1,"stats":{"Line":1},"fn_name":null},{"line":29,"address":[38997,38421],"length":1,"stats":{"Line":2},"fn_name":null},{"line":30,"address":[38503,38550],"length":1,"stats":{"Line":2},"fn_name":null},{"line":31,"address":[38621,38558],"length":1,"stats":{"Line":1},"fn_name":null},{"line":32,"address":[38698,38610],"length":1,"stats":{"Line":2},"fn_name":null},{"line":33,"address":[38910,38704],"length":1,"stats":{"Line":1},"fn_name":null},{"line":35,"address":[38822],"length":1,"stats":{"Line":1},"fn_name":null},{"line":38,"address":[39519,39072,39489],"length":1,"stats":{"Line":1},"fn_name":"move_both"},{"line":39,"address":[39110],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[79632,80163],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":41,"address":[80122,80019,79678],"length":1,"stats":{"Line":4},"fn_name":null},{"line":42,"address":[79921,79994,79821],"length":1,"stats":{"Line":3},"fn_name":null},{"line":43,"address":[79844,79936],"length":1,"stats":{"Line":1},"fn_name":null},{"line":44,"address":[79971],"length":1,"stats":{"Line":1},"fn_name":null},{"line":45,"address":[80053],"length":1,"stats":{"Line":2},"fn_name":null},{"line":47,"address":[39925,39396,39861,39963,39173,39587],"length":1,"stats":{"Line":11},"fn_name":null},{"line":49,"address":[39294,39512,39435],"length":1,"stats":{"Line":4},"fn_name":null},{"line":50,"address":[39665,39530,39626,39451],"length":1,"stats":{"Line":4},"fn_name":null},{"line":51,"address":[39650,39724],"length":1,"stats":{"Line":4},"fn_name":null},{"line":52,"address":[81473,81188,80176,80710],"length":1,"stats":{"Line":6},"fn_name":"{closure#1}"},{"line":53,"address":[80232,80335],"length":1,"stats":{"Line":4},"fn_name":null},{"line":54,"address":[80412,80348],"length":1,"stats":{"Line":4},"fn_name":null},{"line":55,"address":[80525,80428],"length":1,"stats":{"Line":4},"fn_name":null},{"line":56,"address":[80604,80726,80549],"length":1,"stats":{"Line":4},"fn_name":null},{"line":57,"address":[80870,80981],"length":1,"stats":{"Line":4},"fn_name":null},{"line":58,"address":[81050],"length":1,"stats":{"Line":2},"fn_name":null},{"line":60,"address":[81328],"length":1,"stats":{"Line":2},"fn_name":null},{"line":61,"address":[81200,82590,81504,81029],"length":1,"stats":{"Line":8},"fn_name":"{closure#0}"},{"line":62,"address":[82514],"length":1,"stats":{"Line":2},"fn_name":null},{"line":63,"address":[81537,81589],"length":1,"stats":{"Line":4},"fn_name":null},{"line":64,"address":[81861,81918],"length":1,"stats":{"Line":4},"fn_name":null},{"line":65,"address":[82190,82247],"length":1,"stats":{"Line":4},"fn_name":null},{"line":72,"address":[39983],"length":1,"stats":{"Line":2},"fn_name":null},{"line":75,"address":[40064],"length":1,"stats":{"Line":2},"fn_name":"calc_one_region"},{"line":82,"address":[40174,40492,40327,40395,40422],"length":1,"stats":{"Line":6},"fn_name":null},{"line":83,"address":[40317],"length":1,"stats":{"Line":1},"fn_name":null},{"line":84,"address":[40388],"length":1,"stats":{"Line":1},"fn_name":null},{"line":87,"address":[40485],"length":1,"stats":{"Line":1},"fn_name":null},{"line":90,"address":[40408],"length":1,"stats":{"Line":1},"fn_name":null},{"line":99,"address":[96395,96411,94336],"length":1,"stats":{"Line":1},"fn_name":"test_sequence\u003cfn(\u0026aoc_2021_day_25::model::Seafloor) -\u003e aoc_2021_day_25::model::Seafloor\u003e"},{"line":103,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":108,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":109,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":110,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":111,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":113,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":114,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":115,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":117,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":121,"address":[54256],"length":1,"stats":{"Line":3},"fn_name":"test_complex"},{"line":122,"address":[54260],"length":1,"stats":{"Line":1},"fn_name":null},{"line":131,"address":[54304],"length":1,"stats":{"Line":3},"fn_name":"test_east"},{"line":132,"address":[54308],"length":1,"stats":{"Line":1},"fn_name":null},{"line":138,"address":[54352],"length":1,"stats":{"Line":3},"fn_name":"test_both"},{"line":139,"address":[54356],"length":1,"stats":{"Line":1},"fn_name":null},{"line":169,"address":[97144,96752,97117],"length":1,"stats":{"Line":2},"fn_name":"new"},{"line":170,"address":[96806,96887],"length":1,"stats":{"Line":4},"fn_name":null},{"line":171,"address":[96931],"length":1,"stats":{"Line":2},"fn_name":null},{"line":174,"address":[97168,97173],"length":1,"stats":{"Line":2},"fn_name":"size"},{"line":175,"address":[98301,98331,97184],"length":1,"stats":{"Line":1},"fn_name":"parse"},{"line":176,"address":[97243,97292],"length":1,"stats":{"Line":1},"fn_name":null},{"line":177,"address":[97439,97276],"length":1,"stats":{"Line":2},"fn_name":null},{"line":178,"address":[97581,97902],"length":1,"stats":{"Line":1},"fn_name":null},{"line":179,"address":[93775,93648,93676],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":180,"address":[93689,93830,93792],"length":1,"stats":{"Line":1},"fn_name":"{closure#0}"},{"line":181,"address":[94298,93699,94328,93984],"length":1,"stats":{"Line":3},"fn_name":"{closure#1}"},{"line":182,"address":[94318,94025],"length":1,"stats":{"Line":2},"fn_name":null},{"line":183,"address":[94071],"length":1,"stats":{"Line":1},"fn_name":null},{"line":184,"address":[94081],"length":1,"stats":{"Line":1},"fn_name":null},{"line":185,"address":[94091],"length":1,"stats":{"Line":1},"fn_name":null},{"line":186,"address":[94101,94059],"length":1,"stats":{"Line":0},"fn_name":null},{"line":189,"address":[97806],"length":1,"stats":{"Line":0},"fn_name":null},{"line":190,"address":[97976,97774],"length":1,"stats":{"Line":2},"fn_name":null},{"line":191,"address":[98026],"length":1,"stats":{"Line":1},"fn_name":null},{"line":192,"address":[98145],"length":1,"stats":{"Line":1},"fn_name":null},{"line":194,"address":[98352],"length":1,"stats":{"Line":1},"fn_name":"get"},{"line":195,"address":[98377],"length":1,"stats":{"Line":1},"fn_name":null},{"line":197,"address":[98432],"length":1,"stats":{"Line":1},"fn_name":"iter"},{"line":198,"address":[98449],"length":1,"stats":{"Line":1},"fn_name":null},{"line":200,"address":[98464],"length":1,"stats":{"Line":1},"fn_name":"values"},{"line":201,"address":[98473],"length":1,"stats":{"Line":1},"fn_name":null},{"line":206,"address":[98512],"length":1,"stats":{"Line":0},"fn_name":"fmt"},{"line":207,"address":[98545,98706],"length":1,"stats":{"Line":0},"fn_name":null},{"line":208,"address":[98918,98742,98691],"length":1,"stats":{"Line":0},"fn_name":null},{"line":209,"address":[99041,98974],"length":1,"stats":{"Line":0},"fn_name":null},{"line":210,"address":[99240,99026,99171],"length":1,"stats":{"Line":0},"fn_name":null},{"line":211,"address":[99338,99483,99210],"length":1,"stats":{"Line":0},"fn_name":null},{"line":212,"address":[99465,99517],"length":1,"stats":{"Line":0},"fn_name":null},{"line":214,"address":[99697,98876,99771],"length":1,"stats":{"Line":0},"fn_name":null},{"line":215,"address":[99761],"length":1,"stats":{"Line":0},"fn_name":null},{"line":228,"address":[99808],"length":1,"stats":{"Line":0},"fn_name":"encode"},{"line":229,"address":[99819],"length":1,"stats":{"Line":0},"fn_name":null},{"line":230,"address":[99851],"length":1,"stats":{"Line":0},"fn_name":null},{"line":231,"address":[99862],"length":1,"stats":{"Line":0},"fn_name":null},{"line":232,"address":[99873],"length":1,"stats":{"Line":0},"fn_name":null},{"line":235,"address":[99904],"length":1,"stats":{"Line":0},"fn_name":"decode"},{"line":236,"address":[99913],"length":1,"stats":{"Line":0},"fn_name":null},{"line":237,"address":[99978],"length":1,"stats":{"Line":0},"fn_name":null},{"line":238,"address":[99985],"length":1,"stats":{"Line":0},"fn_name":null},{"line":239,"address":[99992],"length":1,"stats":{"Line":0},"fn_name":null},{"line":240,"address":[99956,100009],"length":1,"stats":{"Line":0},"fn_name":null},{"line":246,"address":[100112],"length":1,"stats":{"Line":0},"fn_name":"fmt"},{"line":247,"address":[100137,100197],"length":1,"stats":{"Line":0},"fn_name":null},{"line":248,"address":[100169],"length":1,"stats":{"Line":0},"fn_name":null},{"line":249,"address":[100179],"length":1,"stats":{"Line":0},"fn_name":null},{"line":250,"address":[100189],"length":1,"stats":{"Line":0},"fn_name":null},{"line":268,"address":[28608],"length":1,"stats":{"Line":3},"fn_name":"part_one"},{"line":269,"address":[28615,28854],"length":1,"stats":{"Line":1},"fn_name":null},{"line":270,"address":[28834],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":89,"coverable":118},{"path":["/","home","runner","work","advent-of-code","advent-of-code","2021","src","lib.rs"],"content":"#![ allow (clippy::missing_inline_in_public_items) ]\n\nuse aoc_common::*;\n\npub use aoc_2021_day_01 as day_01;\npub use aoc_2021_day_02 as day_02;\npub use aoc_2021_day_03 as day_03;\npub use aoc_2021_day_04 as day_04;\npub use aoc_2021_day_05 as day_05;\npub use aoc_2021_day_06 as day_06;\npub use aoc_2021_day_07 as day_07;\npub use aoc_2021_day_08 as day_08;\npub use aoc_2021_day_09 as day_09;\npub use aoc_2021_day_10 as day_10;\npub use aoc_2021_day_11 as day_11;\npub use aoc_2021_day_12 as day_12;\npub use aoc_2021_day_13 as day_13;\npub use aoc_2021_day_14 as day_14;\npub use aoc_2021_day_15 as day_15;\npub use aoc_2021_day_16 as day_16;\npub use aoc_2021_day_17 as day_17;\npub use aoc_2021_day_18 as day_18;\npub use aoc_2021_day_19 as day_19;\npub use aoc_2021_day_20 as day_20;\npub use aoc_2021_day_21 as day_21;\npub use aoc_2021_day_22 as day_22;\npub use aoc_2021_day_23 as day_23;\npub use aoc_2021_day_24 as day_24;\npub use aoc_2021_day_25 as day_25;\n\n#[ must_use ]\npub fn puzzle_metadata () -\u003e Vec \u003cBox \u003cdyn puzzle::Puzzle\u003e\u003e {\n\tvec! [\n\t\tday_01::puzzle_metadata (),\n\t\tday_02::puzzle_metadata (),\n\t\tday_03::puzzle_metadata (),\n\t\tday_04::puzzle_metadata (),\n\t\tday_05::puzzle_metadata (),\n\t\tday_06::puzzle_metadata (),\n\t\tday_07::puzzle_metadata (),\n\t\tday_08::puzzle_metadata (),\n\t\tday_09::puzzle_metadata (),\n\t\tday_10::puzzle_metadata (),\n\t\tday_11::puzzle_metadata (),\n\t\tday_12::puzzle_metadata (),\n\t\tday_13::puzzle_metadata (),\n\t\tday_14::puzzle_metadata (),\n\t\tday_15::puzzle_metadata (),\n\t\tday_16::puzzle_metadata (),\n\t\tday_17::puzzle_metadata (),\n\t\tday_18::puzzle_metadata (),\n\t\tday_19::puzzle_metadata (),\n\t\tday_20::puzzle_metadata (),\n\t\tday_21::puzzle_metadata (),\n\t\tday_22::puzzle_metadata (),\n\t\tday_23::puzzle_metadata (),\n\t\tday_24::puzzle_metadata (),\n\t\tday_25::puzzle_metadata (),\n\t]\n}\n","traces":[{"line":32,"address":[11008,14181],"length":1,"stats":{"Line":0},"fn_name":"puzzle_metadata"},{"line":33,"address":[12888,11300,11500,11800,12200,13152,12600,13328,11200,12100,12500,12976,12700,13064,13416,11600,11400,12300,11105,11900,12797,12400,11700,13240,11031,12000],"length":1,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[11070,11157],"length":1,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[11173,11257],"length":1,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[11273,11357],"length":1,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[11457,11373],"length":1,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[11473,11557],"length":1,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[11657,11573],"length":1,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[11673,11757],"length":1,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[11601,11521],"length":1,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[11697,11617],"length":1,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[11713,11793],"length":1,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[11889,11809],"length":1,"stats":{"Line":0},"fn_name":null},{"line":45,"address":[11905,11985],"length":1,"stats":{"Line":0},"fn_name":null},{"line":46,"address":[12273,12357],"length":1,"stats":{"Line":0},"fn_name":null},{"line":47,"address":[12457,12373],"length":1,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[12473,12557],"length":1,"stats":{"Line":0},"fn_name":null},{"line":49,"address":[12289,12369],"length":1,"stats":{"Line":0},"fn_name":null},{"line":50,"address":[12673,12757],"length":1,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[12555,12481],"length":1,"stats":{"Line":0},"fn_name":null},{"line":52,"address":[12639,12571],"length":1,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[12723,12655],"length":1,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[12739,12807],"length":1,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[12891,12823],"length":1,"stats":{"Line":0},"fn_name":null},{"line":56,"address":[12975,12907],"length":1,"stats":{"Line":0},"fn_name":null},{"line":57,"address":[12991,13059],"length":1,"stats":{"Line":0},"fn_name":null},{"line":58,"address":[13075],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":27},{"path":["/","home","runner","work","advent-of-code","advent-of-code","common","bithash","bithash.rs"],"content":"//! Bloom filter\n\nuse std::fmt::{ self, Display };\nuse std::hash::{ BuildHasher, Hash, Hasher };\nuse std::ops::{ BitAnd, Not };\n\nuse aoc_nums as nums;\nuse nums::IntConv;\n\n/// State for building a [`BitHash`] iteratively\n///\npub struct BitHasher \u003cBldHsh: BuildHasher, const LEN: usize, const BITS: usize\u003e {\n\n\t/// Current hash value\n\t///\n\tdata: [u64; LEN],\n\n\t/// Build hasher state\n\t///\n\thash_builder: BldHsh,\n\n}\n\nimpl \u003cBldHsh: BuildHasher, const LEN: usize, const BITS: usize\u003e BitHasher \u003cBldHsh, LEN, BITS\u003e {\n\n\t/// Construct a [`BitHasher`] with the provided [`BuildHasher`]\n\t///\n\t#[ inline ]\n\tpub const fn new_with_hasher (hash_builder: BldHsh) -\u003e Self {\n\t\tSelf { data: [0; LEN], hash_builder }\n\t}\n\n\t/// Update the hash value with a new item\n\t///\n\t#[ inline ]\n\tpub fn update \u003cVal: Hash\u003e (\u0026 mut self, val: Val) -\u003e \u0026 mut Self {\n\t\tlet mut hasher = self.hash_builder.build_hasher ();\n\t\tval.hash (\u0026 mut hasher);\n\t\tlet mut hash = hasher.finish ();\n\t\tfor _ in 0 .. BITS {\n\t\t\tlet bit = 1 \u003c\u003c (hash \u0026 0x3f);\n\t\t\thash \u003e\u003e= 6_u32;\n\t\t\tlet idx = (hash % LEN.to_u64 ().unwrap ()).to_usize ().unwrap ();\n\t\t\thash /= LEN.to_u64 ().unwrap ();\n\t\t\tself.data [idx] |= bit;\n\t\t}\n\t\tself\n\t}\n\n\t/// Stop hashing and return the hash value\n\t///\n\t#[ inline ]\n\tpub const fn finish (\u0026 self) -\u003e BitHash \u003cLEN\u003e {\n\t\tBitHash { data: self.data }\n\t}\n\n}\n\n/// A bit hash value\n///\n#[ derive (Clone, Copy) ]\npub struct BitHash \u003cconst LEN: usize\u003e {\n\n\t/// The hash value\n\t///\n\tdata: [u64; LEN],\n\n}\n\nimpl \u003cconst LEN: usize\u003e BitHash \u003cLEN\u003e {\n\n\t/// A zero hash value, with no items added\n\t///\n\t#[ inline ]\n\t#[ must_use ]\n\tpub const fn zero () -\u003e Self {\n\t\tSelf { data: [0; LEN] }\n\t}\n\n\t/// The number of one bits in the hash value\n\t///\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn bits (\u0026 self) -\u003e usize {\n\t\tlet mut sum = 0;\n\t\tfor idx in 0 .. LEN { sum += self.data [idx].count_ones ().to_usize ().unwrap (); }\n\t\tsum\n\t}\n\n\t/// Map the hash to an equivalent hash of a smaller size\n\t///\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn reduce \u003cconst OTHER_LEN: usize\u003e (\u0026 self) -\u003e BitHash \u003cOTHER_LEN\u003e {\n\t\tif LEN \u003c OTHER_LEN { panic! () }\n\t\tlet mut data = [0; OTHER_LEN];\n\t\tfor idx in 0 .. LEN { data [idx % OTHER_LEN] |= self.data [idx]; }\n\t\tBitHash { data }\n\t}\n\n\t/// Return true is this hash has no one bits\n\t///\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn is_zero (\u0026 self) -\u003e bool {\n\t\tfor idx in 0 .. LEN { if self.data [idx] != 0 { return false } }\n\t\ttrue\n\t}\n\n}\n\nimpl \u003cconst LEN: usize\u003e Display for BitHash \u003cLEN\u003e {\n\t#[ inline ]\n\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\tfor idx in 0 .. LEN {\n\t\t\twrite! (formatter, \"{:064b}\", self.data [idx]) ?;\n\t\t}\n\t\tOk (())\n\t}\n}\n\nimpl \u003cconst LEN: usize\u003e BitAnd for BitHash \u003cLEN\u003e {\n\n\ttype Output = Self;\n\n\t#[ inline ]\n\tfn bitand (mut self, other: Self) -\u003e Self {\n\t\tfor idx in 0 .. LEN { self.data [idx] \u0026= other.data [idx]; }\n\t\tself\n\t}\n\n}\n\nimpl \u003cconst LEN: usize\u003e Not for BitHash \u003cLEN\u003e {\n\n\ttype Output = Self;\n\n\t#[ inline ]\n\tfn not (mut self) -\u003e Self {\n\t\tfor idx in 0 .. LEN { self.data [idx] = ! self.data [idx]; }\n\t\tself\n\t}\n\n}\n\n/// Extension trait to [`Iterator`] for working with [`BitHash`]\n///\npub trait IteratorBitHash : Iterator {\n\n\t/// Construct a [`BitHash`] with the values from an iterator\n\t///\n\t#[ inline ]\n\tfn bit_hash \u003cBldHsh, const LEN: usize, const BITS: usize\u003e (self, hash_builder: BldHsh) -\u003e BitHash \u003cLEN\u003e\n\t\t\twhere BldHsh: BuildHasher, Self: Sized, Self::Item: Hash {\n\t\tlet mut hasher = BitHasher::\u003cBldHsh, LEN, BITS\u003e::new_with_hasher (hash_builder);\n\t\tfor item in self { hasher.update (\u0026 item); }\n\t\thasher.finish ()\n\t}\n\n}\n\nimpl \u003cSomeIter, SomeItem\u003e IteratorBitHash for SomeIter\n\twhere\n\t\tSomeIter: Iterator \u003cItem = SomeItem\u003e + Sized,\n\t\tSomeItem: Hash {\n}\n","traces":[{"line":29,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":30,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":36,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":38,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":39,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":42,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":43,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":44,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":45,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":47,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":54,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":85,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":86,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":107,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":114,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":115,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":116,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":118,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":127,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":128,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":129,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":139,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":140,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":141,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":155,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":156,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":157,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":20,"coverable":41},{"path":["/","home","runner","work","advent-of-code","advent-of-code","common","bitvec","bitvec.rs"],"content":"//! Dynamically sized array of items encoded as bits and packed\n\nuse std::cmp;\nuse std::marker::PhantomData;\n\nuse aoc_nums as nums;\nuse nums::IntConv;\n\n/// Dynamically sized array of items encoded as bits and packed\n///\n#[ derive (Debug, Clone, Eq, PartialEq) ]\npub struct BitVec \u003cItem, Encoding = BitVecEncodingDefault\u003e {\n\n\t/// The number of items stored\n\t///\n\tlen: usize,\n\n\t/// Data for stored items\n\t///\n\twords: Vec \u003cusize\u003e,\n\n\t/// Phantom data to make the type system happy\n\t///\n\tphantom: PhantomData \u003c(Item, Encoding)\u003e,\n\n}\n\nimpl \u003cItem, Encoding\u003e BitVec \u003cItem, Encoding\u003e\n\twhere\n\t\tEncoding: BitVecEncoding \u003cItem\u003e,\n\t\tItem: Clone {\n\n\t/// Create a new [`BitVec`] with no items\n\t///\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn new () -\u003e Self {\n\t\tdebug_assert! (Encoding::BITS \u003c usize::BITS);\n\t\tdebug_assert! (Encoding::MASK == (1 \u003c\u003c Encoding::BITS) - 1);\n\t\tSelf {\n\t\t\twords: Vec::new (),\n\t\t\tlen: 0,\n\t\t\tphantom: PhantomData,\n\t\t}\n\t}\n\n\t/// Number of items stored\n\t///\n\t#[ inline ]\n\t#[ must_use ]\n\tpub const fn len (\u0026 self) -\u003e usize { self.len }\n\n\t/// True if there are no stored items\n\t///\n\t#[ inline ]\n\t#[ must_use ]\n\tpub const fn is_empty (\u0026 self) -\u003e bool { self.len == 0 }\n\n\t/// Add a new item, increases the size by one\n\t///\n\t#[ inline ]\n\tpub fn push (\u0026 mut self, item: Item) {\n\t\tlet item_enc = Encoding::encode (item);\n\t\tself.push_real (item_enc);\n\t}\n\n\tfn push_real (\u0026 mut self, mut item_enc: usize) {\n\t\tdebug_assert! (item_enc \u0026 ! Encoding::MASK == 0);\n\t\tlet mut item_bits = Encoding::BITS;\n\t\tlet mut word_idx = self.len * Encoding::BITS.as_usize () / usize::BITS.as_usize ();\n\t\tlet mut bit_idx = (self.len * Encoding::BITS.as_usize () % usize::BITS.as_usize ()).as_u32 ();\n\t\twhile item_bits \u003e 0 {\n\t\t\tlet word_bits = cmp::min (item_bits, usize::BITS - bit_idx);\n\t\t\tlet word_mask = (1 \u003c\u003c word_bits) - 1;\n\t\t\tlet mut word_val = if word_idx \u003c self.words.len () {\n\t\t\t\tself.words [word_idx]\n\t\t\t} else { 0 };\n\t\t\tword_val |= (item_enc \u0026 word_mask) \u003c\u003c bit_idx;\n\t\t\tif word_idx \u003c self.words.len () {\n\t\t\t\tself.words [word_idx] = word_val;\n\t\t\t} else {\n\t\t\t\tself.words.push (word_val);\n\t\t\t}\n\t\t\titem_enc \u003e\u003e= word_bits;\n\t\t\titem_bits -= word_bits;\n\t\t\tword_idx += 1;\n\t\t\tbit_idx = 0;\n\t\t}\n\t\tself.len += 1;\n\t}\n\n\t/// Get a specific item given its index\n\t///\n\t#[ inline ]\n\tpub fn get (\u0026 self, idx: usize) -\u003e Option \u003cItem\u003e {\n\t\tself.get_real (idx).map (Encoding::decode)\n\t}\n\n\tfn get_real (\u0026 self, idx: usize) -\u003e Option \u003cusize\u003e {\n\t\tif self.len \u003c idx + 1 { return None }\n\t\tlet mut item_enc = 0;\n\t\tlet mut item_bits = 0;\n\t\tlet mut word_idx = idx * Encoding::BITS.as_usize () / usize::BITS.as_usize ();\n\t\tlet mut bit_idx = (idx * Encoding::BITS.as_usize () % usize::BITS.as_usize ()).as_u32 ();\n\t\twhile item_bits \u003c Encoding::BITS {\n\t\t\tlet word_bits = cmp::min (Encoding::BITS - item_bits, usize::BITS - bit_idx);\n\t\t\tlet word_mask = (1 \u003c\u003c word_bits) - 1;\n\t\t\tlet word_val = self.words [word_idx];\n\t\t\titem_enc |= ((word_val \u003e\u003e bit_idx) \u0026 word_mask) \u003c\u003c item_bits;\n\t\t\titem_bits += word_bits;\n\t\t\tword_idx += 1;\n\t\t\tbit_idx = 0;\n\t\t}\n\t\tSome (item_enc)\n\t}\n\n\t/// Replace the item at the specified index\n\t///\n\t#[ inline ]\n\tpub fn set (\u0026 mut self, idx: usize, item: Item) {\n\t\tlet item_enc = Encoding::encode (item);\n\t\tself.set_real (idx, item_enc);\n\t}\n\n\tfn set_real (\u0026 mut self, idx: usize, mut item_enc: usize) {\n\t\tassert! (idx \u003c self.len, \"Tried to set {} but len is {}\", idx, self.len);\n\t\tlet mut item_bits = Encoding::BITS;\n\t\tlet mut word_idx = idx * Encoding::BITS.as_usize () / usize::BITS.as_usize ();\n\t\tlet mut bit_idx = (idx * Encoding::BITS.as_usize () % usize::BITS.as_usize ()).as_u32 ();\n\t\twhile item_bits \u003e 0 {\n\t\t\tlet word_bits = cmp::min (item_bits, usize::BITS - bit_idx);\n\t\t\tlet word_mask = (1 \u003c\u003c word_bits) - 1;\n\t\t\tlet mut word_val = self.words [word_idx];\n\t\t\tword_val |= (item_enc \u0026 word_mask) \u003c\u003c bit_idx;\n\t\t\tself.words [word_idx] = word_val;\n\t\t\titem_enc \u003e\u003e= word_bits;\n\t\t\titem_bits -= word_bits;\n\t\t\tword_idx += 1;\n\t\t\tbit_idx = 0;\n\t\t}\n\t}\n\n\t/// Create an iterator over the stored items\n\t///\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn iter (\u0026 self) -\u003e BitVecIter \u003cItem, Encoding\u003e {\n\t\tBitVecIter {\n\t\t\twords: self.words.as_slice (),\n\t\t\tlen: self.len,\n\t\t\tword_val: 0,\n\t\t\tword_bits: 0,\n\t\t\tphantom: PhantomData,\n\t\t}\n\t}\n\n}\n\nimpl \u003cItem, Encoding\u003e Default for BitVec \u003cItem, Encoding\u003e\n\twhere\n\t\tEncoding: BitVecEncoding \u003cItem\u003e,\n\t\tItem: Clone {\n\n\t#[ inline ]\n\tfn default () -\u003e Self {\n\t\tSelf::new ()\n\t}\n\n}\n\nimpl \u003cItem, Encoding\u003e FromIterator \u003cItem\u003e for BitVec \u003cItem, Encoding\u003e\n\twhere\n\t\tEncoding: BitVecEncoding \u003cItem\u003e,\n\t\tItem: Clone {\n\t#[ inline ]\n\tfn from_iter \u003cIter: IntoIterator \u003cItem = Item\u003e\u003e (iter: Iter) -\u003e Self {\n\t\tlet mut bitvec = Self::new ();\n\t\tfor item in iter {\n\t\t\tbitvec.push (item);\n\t\t}\n\t\tbitvec\n\t}\n}\n\n/// Iterator over the items in a [`BitVec`]\n///\n#[ derive (Clone) ]\npub struct BitVecIter \u003c'dat, Item, Encoding = BitVecEncodingDefault\u003e {\n\n\t/// The remaining packed data\n\t///\n\twords: \u0026 'dat [usize],\n\n\t/// Number of items remaining\n\t///\n\tlen: usize,\n\n\t/// The word currently being unpacked\n\t///\n\tword_val: usize,\n\n\t/// Number of bits remaining in the current word\n\t///\n\tword_bits: u32,\n\n\t/// Phantom data to make the type system happy\n\t///\n\tphantom: PhantomData \u003c(Item, Encoding)\u003e,\n\n}\n\nimpl \u003c'dat, Item, Encoding\u003e BitVecIter \u003c'dat, Item, Encoding\u003e\n\twhere\n\t\tEncoding: BitVecEncoding \u003cItem\u003e,\n\t\tItem: Clone {\n\n\tfn next_real (\u0026 mut self) -\u003e Option \u003cusize\u003e {\n\t\tif self.len == 0 { return None }\n\t\tlet mut item_enc = 0;\n\t\tlet mut item_bits = 0;\n\t\twhile item_bits \u003c Encoding::BITS {\n\t\t\tlet word_bits = cmp::min (Encoding::BITS - item_bits, self.word_bits);\n\t\t\titem_enc |= (self.word_val \u0026 ((1 \u003c\u003c word_bits) - 1)) \u003c\u003c item_bits;\n\t\t\tself.word_val \u003e\u003e= word_bits;\n\t\t\tself.word_bits -= word_bits;\n\t\t\titem_bits += word_bits;\n\t\t\tif self.word_bits == 0 {\n\t\t\t\tself.word_val = self.words [0];\n\t\t\t\tself.word_bits = usize::BITS;\n\t\t\t\tself.words = \u0026 self.words [1 .. ];\n\t\t\t}\n\t\t}\n\t\tself.len -= 1;\n\t\tSome (item_enc)\n\t}\n\n\tfn nth_real (\u0026 mut self, num: usize) -\u003e Option \u003cusize\u003e {\n\t\tlet mut adv_bits = Encoding::BITS.as_usize () * num;\n\t\tlet adv_words =\n\t\t\t(usize::BITS.as_usize () - self.word_bits.as_usize () + adv_bits)\n\t\t\t\t/ usize::BITS.as_usize ();\n\t\tif adv_words \u003e 0 {\n\t\t\tself.word_val = self.words [adv_words - 1];\n\t\t\tself.words = \u0026 self.words [adv_words .. ];\n\t\t\tadv_bits -= (adv_words - 1) * usize::BITS.as_usize ();\n\t\t\tself.word_bits = usize::BITS;\n\t\t}\n\t\tdebug_assert! (adv_bits \u003c= self.word_bits.as_usize ());\n\t\tself.word_bits -= adv_bits.as_u32 ();\n\t\tself.word_val \u003e\u003e= adv_bits;\n\t\tself.len -= num;\n\t\tself.next_real ()\n\t}\n\n}\n\nimpl \u003c'dat, Item, Encoding\u003e Iterator for BitVecIter \u003c'dat, Item, Encoding\u003e\n\twhere\n\t\tEncoding: BitVecEncoding \u003cItem\u003e,\n\t\tItem: Clone {\n\n\ttype Item = Item;\n\n\t#[ inline ]\n\tfn next (\u0026 mut self) -\u003e Option \u003cItem\u003e {\n\t\tself.next_real ().map (Encoding::decode)\n\t}\n\n\t#[ inline ]\n\tfn nth (\u0026 mut self, num: usize) -\u003e Option \u003cItem\u003e {\n\t\tself.nth_real (num).map (Encoding::decode)\n\t}\n\n\t#[ inline ]\n\tfn count (self) -\u003e usize {\n\t\tself.len\n\t}\n\n}\n\n/// Trait for encoding an item as bits for storing in a [`BitVec`]\n///\npub trait BitVecEncoding \u003cItem\u003e {\n\n\t/// Number of bits in each encoded item\n\t///\n\tconst BITS: u32;\n\n\t/// Mask for the bits in an encoded item\n\t///\n\tconst MASK: usize = (1 \u003c\u003c Self::BITS) - 1;\n\n\t/// Encode an item into its representation as bits\n\t///\n\tfn encode (item: Item) -\u003e usize;\n\n\t/// Decode an item from its representation as bits\n\t///\n\tfn decode (bits: usize) -\u003e Item;\n\n}\n\n/// Trait for items which know how to encode themselves for storing in a [`BitVec`]\n///\npub trait BitVecNative {\n\n\t/// Number of bits in an encoded item\n\t///\n\tconst BITS: u32;\n\n\t/// Encode an item into its representation as bits\n\t///\n\tfn encode (self) -\u003e usize;\n\n\t/// Decode an item from its representation as bits\n\t///\n\tfn decode (encoded: usize) -\u003e Self;\n\n}\n\n/// Default implementation of [`BitVecEncoding`] for items which implement [`BitVecNative`]\n///\n#[ derive (Clone, Debug, Eq, PartialEq) ]\npub struct BitVecEncodingDefault;\n\nimpl \u003cItem\u003e BitVecEncoding \u003cItem\u003e for BitVecEncodingDefault where Item: BitVecNative {\n\n\tconst BITS: u32 = Item::BITS;\n\n\tconst MASK: usize = (1 \u003c\u003c Item::BITS) - 1;\n\n\t#[ inline ]\n\tfn encode (item: Item) -\u003e usize { Item::encode (item) }\n\n\t#[ inline ]\n\tfn decode (bits: usize) -\u003e Item { Item::decode (bits) }\n\n}\n","traces":[{"line":37,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":63,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":74,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":75,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":80,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":82,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":85,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":86,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":89,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":99,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":101,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":102,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":103,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":107,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":108,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":109,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":110,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":111,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":114,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":120,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":121,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":122,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":125,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":126,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":127,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":128,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":129,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":130,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":131,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":132,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":133,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":134,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":135,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":136,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":137,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":138,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":139,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":147,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":149,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":150,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":165,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":166,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":176,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":177,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":178,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":179,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":181,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":217,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":218,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":219,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":220,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":221,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":222,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":223,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":224,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":225,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":226,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":227,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":228,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":229,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":230,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":233,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":234,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":237,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":238,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":239,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":240,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":241,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":242,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":243,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":244,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":245,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":246,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":248,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":249,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":250,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":251,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":252,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":265,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":266,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":270,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":271,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":275,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":276,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":109},{"path":["/","home","runner","work","advent-of-code","advent-of-code","common","grid","grid.rs"],"content":"use std::fmt::Debug;\nuse std::iter;\nuse std::marker::PhantomData;\nuse std::slice::Iter as SliceIter;\n\nuse aoc_bitvec as bitvec;\nuse aoc_misc::*;\nuse aoc_nums as nums;\nuse aoc_pos as pos;\nuse bitvec::BitVec;\nuse bitvec::BitVecEncoding;\nuse bitvec::BitVecIter;\nuse nums::Int;\nuse pos::PosRowCol;\nuse pos::PosXY;\nuse pos::PosYX;\n\n/// Multi dimensional abstraction over a single dimensional collection\n///\n/// This allows a simple one-dimensional collection to be accessed in a multi-dimensional way. It\n/// wraps a backing collection which implements [`GridStorage`], and takes indexes which implement\n/// [`GridPos`].\n\n#[ derive (Clone, Debug, Eq, PartialEq) ]\npub struct Grid \u003cStorage, Pos, const DIMS: usize = 2\u003e {\n\tstorage: Storage,\n\torigin: [isize; DIMS],\n\tsize: [usize; DIMS],\n\tphantom: PhantomData \u003cPos\u003e,\n}\n\nimpl \u003cItem, Pos, const DIMS: usize\u003e Grid \u003cVec \u003cItem\u003e, Pos, DIMS\u003e\n\twhere\n\t\tItem: Clone + Default,\n\t\tPos: GridPos \u003cDIMS\u003e {\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn new_vec (\n\t\torigin: [isize; DIMS],\n\t\tsize: [usize; DIMS],\n\t) -\u003e Self {\n\t\tassert! (origin == [0; DIMS]);\n\t\tSelf::wrap (\n\t\t\titer::repeat (default ())\n\t\t\t\t.take (size.iter ().copied ().product ())\n\t\t\t\t.collect::\u003cVec \u003c_\u003e\u003e (),\n\t\t\torigin,\n\t\t\tsize)\n\t}\n\n}\n\nimpl \u003cStorage, Pos, const DIMS: usize\u003e Grid \u003cStorage, Pos, DIMS\u003e\n\twhere\n\t\tStorage: GridStorage + Clone,\n\t\tPos: GridPos \u003cDIMS\u003e {\n\n\t#[ inline ]\n\tpub fn wrap (\n\t\tstorage: Storage,\n\t\torigin: [isize; DIMS],\n\t\tsize: [usize; DIMS],\n\t) -\u003e Self {\n\t\tassert! (! size.into_iter ().any (|dim| dim == 0),\n\t\t\t\"Size must be positive in all dimensions: {:?}\", size);\n\t\tlet expected_len = size.into_iter ().product::\u003cusize\u003e ();\n\t\tlet actual_len = storage.storage_len ();\n\t\tassert! (expected_len == actual_len,\n\t\t\t\"Expected {} items but was passed {}\", expected_len, actual_len);\n\t\tSelf { storage, origin, size, phantom: PhantomData }\n\t}\n\n\t#[ inline ]\n\tpub fn len (\u0026 self) -\u003e usize {\n\t\tself.size.into_iter ().product ()\n\t}\n\n\t#[ inline ]\n\tpub fn is_empty (\u0026 self) -\u003e bool {\n\t\tself.size.into_iter ().any (|dim| dim == 0)\n\t}\n\n\t#[ inline ]\n\tpub const fn size (\u0026 self) -\u003e [usize; DIMS] {\n\t\tself.size\n\t}\n\n\t#[ inline ]\n\tpub const fn raw_origin (\u0026 self) -\u003e [isize; DIMS] {\n\t\tself.origin\n\t}\n\n\t#[ inline ]\n\tpub const fn raw_size (\u0026 self) -\u003e [usize; DIMS] {\n\t\tself.size\n\t}\n\n\t#[ inline ]\n\tpub fn origin (\u0026 self) -\u003e Pos {\n\t\tPos::from_scalar (0, self.origin, self.size).unwrap ()\n\t}\n\n\t#[ inline ]\n\tpub fn peak (\u0026 self) -\u003e Pos {\n\t\tPos::from_scalar (self.len () - 1, self.origin, self.size).unwrap ()\n\t}\n\n\t#[ inline ]\n\tpub fn get (\u0026 self, pos: Pos) -\u003e Option \u003cStorage::Item\u003e {\n\t\tPos::to_scalar (\u0026 pos, self.origin, self.size)\n\t\t\t.and_then (|index| self.storage.storage_get (index))\n\t}\n\n\t#[ inline ]\n\tpub fn set (\u0026 mut self, pos: Pos, item: Storage::Item) {\n\t\tlet idx = some_or! (\n\t\t\tPos::to_scalar (\u0026 pos, self.origin, self.size),\n\t\t\tpanic! (\"Unable to map GridPos to scalar: {:?}\", pos));\n\t\tself.storage.storage_set (idx, item);\n\t}\n\n\t#[ inline ]\n\tpub fn iter \u003c'sto\u003e (\u0026 'sto self) -\u003e GridIter \u003c\u003c\u0026 'sto Storage as GridStorageIntoIter\u003e::Iter, Pos, DIMS\u003e\n\t\t\twhere \u0026 'sto Storage: GridStorageIntoIter {\n\t\tGridIter {\n\t\t\tstorage: (\u0026 self.storage).storage_iter (),\n\t\t\tidx: 0,\n\t\t\torigin: self.origin,\n\t\t\tsize: self.size,\n\t\t\tphantom: PhantomData,\n\t\t}\n\t}\n\n\t#[ inline ]\n\tpub fn values \u003c'sto\u003e (\u0026 'sto self) -\u003e \u003c\u0026 'sto Storage as GridStorageIntoIter\u003e::Iter\n\t\t\twhere \u0026 'sto Storage: GridStorageIntoIter {\n\t\t(\u0026 self.storage).storage_iter ()\n\t}\n\n}\n\nimpl \u003cStorage, Pos, const DIMS: usize\u003e Grid \u003cStorage, Pos, DIMS\u003e\n\twhere\n\t\tStorage: GridStorageMut + Clone,\n\t\tPos: GridPos \u003cDIMS\u003e {\n\n\t#[ inline ]\n\tpub fn get_ref (\u0026 self, pos: Pos) -\u003e Option \u003c\u0026 Storage::Item\u003e {\n\t\tPos::to_scalar (\u0026 pos, self.origin, self.size)\n\t\t\t.and_then (|index| self.storage.storage_ref (index))\n\t}\n\n\t#[ inline ]\n\tpub fn get_mut (\u0026 mut self, pos: Pos) -\u003e Option \u003c\u0026 mut Storage::Item\u003e {\n\t\tPos::to_scalar (\u0026 pos, self.origin, self.size)\n\t\t\t.and_then (|index| self.storage.storage_mut (index))\n\t}\n\n}\n\n/// Iterator returned by [`Grid::iter`].\n///\n/// This iterator wraps the iterator from an implementation of [`GridStorage`] and maps from `Item`\n/// to `([GridPos], Item)`.\n///\n#[ derive (Clone) ]\npub struct GridIter \u003cStorage, Pos, const DIMS: usize\u003e {\n\tstorage: Storage,\n\tidx: usize,\n\torigin: [isize; DIMS],\n\tsize: [usize; DIMS],\n\tphantom: PhantomData \u003cPos\u003e,\n}\n\nimpl \u003cStorage, Pos, const DIMS: usize\u003e Iterator for GridIter \u003cStorage, Pos, DIMS\u003e\n\twhere\n\t\tStorage: Iterator,\n\t\tPos: GridPos \u003cDIMS\u003e {\n\n\ttype Item = (Pos, Storage::Item);\n\n\t#[ inline ]\n\tfn next (\u0026 mut self) -\u003e Option \u003c(Pos, Storage::Item)\u003e {\n\t\tif let Some (item) = self.storage.next () {\n\t\t\tlet idx = self.idx;\n\t\t\tself.idx += 1;\n\t\t\tSome ((Pos::from_scalar (idx, self.origin, self.size).unwrap (), item))\n\t\t} else { None }\n\t}\n\n\t#[ inline ]\n\tfn nth (\u0026 mut self, num: usize) -\u003e Option \u003c(Pos, Storage::Item)\u003e {\n\t\tif let Some (item) = self.storage.nth (num) {\n\t\t\tlet idx = self.idx;\n\t\t\tself.idx += num + 1;\n\t\t\tSome ((Pos::from_scalar (idx, self.origin, self.size).unwrap (), item))\n\t\t} else { None }\n\t}\n\n}\n\n/// Trait for backing stores for a [`Grid`]\n///\n/// This provides a simple abstraction over a fixed size array of items. It is implemented for\n/// [`Vec`] and [`BitVec`].\n\npub trait GridStorage {\n\n\ttype Item;\n\n\tfn storage_get (\u0026 self, idx: usize) -\u003e Option \u003cSelf::Item\u003e;\n\tfn storage_set (\u0026 mut self, idx: usize, item: Self::Item);\n\tfn storage_len (\u0026 self) -\u003e usize;\n\n}\n\nimpl \u003cItem\u003e GridStorage for Vec \u003cItem\u003e where Item: Clone {\n\ttype Item = Item;\n\n\t#[ inline ]\n\tfn storage_get (\u0026 self, idx: usize) -\u003e Option \u003cItem\u003e {\n\t\tself.get (idx).cloned ()\n\t}\n\n\t#[ inline ]\n\tfn storage_set (\u0026 mut self, idx: usize, item: Self::Item) {\n\t\tself [idx] = item;\n\t}\n\n\t#[ inline ]\n\tfn storage_len (\u0026 self) -\u003e usize {\n\t\tself.len ()\n\t}\n\n}\n\nimpl \u003cItem, Encoding\u003e GridStorage for BitVec \u003cItem, Encoding\u003e\n\twhere\n\t\tEncoding: BitVecEncoding \u003cItem\u003e,\n\t\tItem: Clone {\n\n\ttype Item = Item;\n\n\t#[ inline ]\n\tfn storage_get (\u0026 self, idx: usize) -\u003e Option \u003cItem\u003e {\n\t\tself.get (idx)\n\t}\n\n\t#[ inline ]\n\tfn storage_set (\u0026 mut self, idx: usize, item: Self::Item) {\n\t\tself.set (idx, item);\n\t}\n\n\t#[ inline ]\n\tfn storage_len (\u0026 self) -\u003e usize {\n\t\tself.len ()\n\t}\n\n}\n\n/// Additional trait for backing stores which which can provide references to items\n///\npub trait GridStorageMut: GridStorage {\n\tfn storage_ref (\u0026 self, idx: usize) -\u003e Option \u003c\u0026 Self::Item\u003e;\n\tfn storage_mut (\u0026 mut self, idx: usize) -\u003e Option \u003c\u0026 mut Self::Item\u003e;\n}\n\nimpl \u003cItem\u003e GridStorageMut for Vec \u003cItem\u003e where Item: Clone {\n\n\t#[ inline ]\n\tfn storage_ref (\u0026 self, idx: usize) -\u003e Option \u003c\u0026 Item\u003e {\n\t\tself.get (idx)\n\t}\n\n\t#[ inline ]\n\tfn storage_mut (\u0026 mut self, idx: usize) -\u003e Option \u003c\u0026 mut Item\u003e {\n\t\tself.get_mut (idx)\n\t}\n\n}\n\n/// Extra trait for [`GridStorage`] to support iteration.\n///\n/// This is a separate trait to make the lifetimes work. It should be implemented on a reference to\n/// the storage, rather than directly. This allows us to capture the lifetime without polluting the\n/// main trait.\n///\npub trait GridStorageIntoIter {\n\n\ttype Item;\n\ttype Iter: Iterator \u003cItem = Self::Item\u003e;\n\n\tfn storage_iter (\u0026 self) -\u003e Self::Iter;\n\n}\n\nimpl \u003c'sto, Item\u003e GridStorageIntoIter for \u0026 'sto Vec \u003cItem\u003e where Item: Clone {\n\n\ttype Item = Item;\n\ttype Iter = GridStorageClone \u003cSliceIter \u003c'sto, Item\u003e\u003e;\n\n\t#[ inline ]\n\tfn storage_iter (\u0026 self) -\u003e Self::Iter {\n\t\tGridStorageClone::new (self.iter ())\n\t}\n\n}\n\nimpl \u003c'sto, Item, Encoding\u003e GridStorageIntoIter for \u0026 'sto BitVec \u003cItem, Encoding\u003e\n\twhere\n\t\tEncoding: BitVecEncoding \u003cItem\u003e,\n\t\tItem: Clone {\n\n\ttype Item = Item;\n\ttype Iter = BitVecIter \u003c'sto, Item, Encoding\u003e;\n\n\t#[ inline ]\n\tfn storage_iter (\u0026 self) -\u003e Self::Iter {\n\t\tself.iter ()\n\t}\n\n}\n\n/// Trait for values to use as indices for a [`Grid`].\n///\n/// For example, a two dimensional grid might be indexed with a struct containing an `x` and a `y`\n/// coordinate.\n///\n/// This trait provides methods to translate whatever coordinate system is in use to and from a\n/// single `usize` value.\n///\npub trait GridPos \u003cconst DIMS: usize\u003e: Copy + Debug + Sized {\n\tfn to_scalar (\u0026 self, origin: [isize; DIMS], size: [usize; DIMS]) -\u003e Option \u003cusize\u003e;\n\tfn from_scalar (scalar: usize, origin: [isize; DIMS], size: [usize; DIMS]) -\u003e Option \u003cSelf\u003e;\n}\n\nimpl GridPos \u003c2\u003e for (usize, usize) {\n\n\t#[ inline ]\n\tfn to_scalar (\u0026 self, origin: [isize; 2], size: [usize; 2]) -\u003e Option \u003cusize\u003e {\n\t\tif origin != [0, 0] { unimplemented! () }\n\t\tusize::checked_add (match usize::checked_mul (self.0, size [1]) {\n\t\t\tSome (val) =\u003e val, None =\u003e return None }, self.1)\n\t}\n\n\t#[ inline ]\n\tfn from_scalar (scalar: usize, origin: [isize; 2], size: [usize; 2]) -\u003e Option \u003cSelf\u003e {\n\t\tif origin != [0, 0] { unimplemented! () }\n\t\tSome ((scalar / size [1], scalar % size [1]))\n\t}\n\n}\n\nimpl \u003cVal: Int\u003e GridPos \u003c2\u003e for PosXY \u003cVal\u003e {\n\n\t#[ inline ]\n\tfn to_scalar (\u0026 self, origin: [isize; 2], size: [usize; 2]) -\u003e Option \u003cusize\u003e {\n\t\tif origin != [0, 0] { unimplemented! () }\n\t\tlet x = ok_or! (self.x.to_usize (), return None);\n\t\tlet y = ok_or! (self.y.to_usize (), return None);\n\t\tif x \u003e= size [0] || y \u003e= size [1] { return None }\n\t\tSome (x * size [1] + y)\n\t}\n\n\t#[ inline ]\n\tfn from_scalar (scalar: usize, origin: [isize; 2], size: [usize; 2]) -\u003e Option \u003cSelf\u003e {\n\t\tif origin != [0, 0] { unimplemented! () }\n\t\tlet x = ok_or! (Val::from_usize (scalar / size [1]), return None);\n\t\tlet y = ok_or! (Val::from_usize (scalar % size [1]), return None);\n\t\tSome (Self { x, y })\n\t}\n\n}\n\nimpl \u003cVal: Int\u003e GridPos \u003c2\u003e for PosYX \u003cVal\u003e {\n\n\t#[ inline ]\n\tfn to_scalar (\u0026 self, origin: [isize; 2], size: [usize; 2]) -\u003e Option \u003cusize\u003e {\n\t\tif origin != [0, 0] { unimplemented! () }\n\t\tlet y = ok_or! (self.y.to_usize (), return None);\n\t\tlet x = ok_or! (self.x.to_usize (), return None);\n\t\tif y \u003e= size [0] || x \u003e= size [1] { return None }\n\t\tSome (y * size [1] + x)\n\t}\n\n\t#[ inline ]\n\tfn from_scalar (scalar: usize, origin: [isize; 2], size: [usize; 2]) -\u003e Option \u003cSelf\u003e {\n\t\tif origin != [0, 0] { unimplemented! () }\n\t\tlet y = ok_or! (Val::from_usize (scalar / size [1]), return None);\n\t\tlet x = ok_or! (Val::from_usize (scalar % size [1]), return None);\n\t\tSome (Self { y, x })\n\t}\n\n}\n\nimpl \u003cVal: Int\u003e GridPos \u003c2\u003e for PosRowCol \u003cVal\u003e {\n\n\t#[ inline ]\n\tfn to_scalar (\u0026 self, origin: [isize; 2], size: [usize; 2]) -\u003e Option \u003cusize\u003e {\n\t\tif origin != [0, 0] { unimplemented! () }\n\t\tlet row = ok_or! (self.row.to_usize (), return None);\n\t\tlet col = ok_or! (self.col.to_usize (), return None);\n\t\tif row \u003e= size [0] || col \u003e= size [1] { return None }\n\t\tSome (row * size [1] + col)\n\t}\n\n\t#[ inline ]\n\tfn from_scalar (scalar: usize, origin: [isize; 2], size: [usize; 2]) -\u003e Option \u003cSelf\u003e {\n\t\tif origin != [0, 0] { unimplemented! () }\n\t\tlet row = ok_or! (Val::from_usize (scalar / size [1]), return None);\n\t\tlet col = ok_or! (Val::from_usize (scalar % size [1]), return None);\n\t\tSome (Self { row, col })\n\t}\n\n}\n\n/// Wrapping iterator which clones items.\n///\n/// We don't use [`Cloned`](iter::Cloned) from the standard library because it doesn't handle\n/// [`Iterator::skip`] the way we would like. Although it says in the documentation that there is\n/// no guarantee each element will be processed, it seems like it does so. Instead, we want to\n/// completely bypass any elements which aren't required.\n///\n#[ derive (Clone) ]\npub struct GridStorageClone \u003cStorage\u003e {\n\tstorage: Storage,\n}\n\nimpl \u003cStorage\u003e GridStorageClone \u003cStorage\u003e {\n\tconst fn new (storage: Storage) -\u003e Self {\n\t\tSelf { storage }\n\t}\n}\n\nimpl \u003c'sto, Storage, Item\u003e Iterator for GridStorageClone \u003cStorage\u003e\n\twhere\n\t\tStorage: Iterator \u003cItem = \u0026 'sto Item\u003e,\n\t\tItem: Clone + 'sto {\n\n\ttype Item = Item;\n\n\t#[ inline ]\n\tfn next (\u0026 mut self) -\u003e Option \u003cItem\u003e {\n\t\tself.storage.next ().cloned ()\n\t}\n\n\t#[ inline ]\n\tfn nth (\u0026 mut self, num: usize) -\u003e Option \u003cItem\u003e {\n\t\tself.storage.nth (num).cloned ()\n\t}\n\n}\n","traces":[{"line":39,"address":[44288,44619],"length":1,"stats":{"Line":3},"fn_name":"new_vec\u003cbool, aoc_pos::dim_2::row_col::PosRowCol\u003cu32\u003e, 2\u003e"},{"line":43,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":45,"address":[],"length":0,"stats":{"Line":12},"fn_name":null},{"line":46,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":47,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":49,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":60,"address":[63110,63770,62928],"length":1,"stats":{"Line":11},"fn_name":"wrap\u003calloc::vec::Vec\u003cu16, alloc::alloc::Global\u003e, aoc_pos::dim_2::yx::PosYX\u003ci16\u003e, 2\u003e"},{"line":65,"address":[],"length":0,"stats":{"Line":55},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":22},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":75,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":80,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":81,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":85,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":86,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":101,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":110,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":111,"address":[],"length":0,"stats":{"Line":17},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":27},"fn_name":null},{"line":116,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":117,"address":[],"length":0,"stats":{"Line":12},"fn_name":null},{"line":118,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":119,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":120,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":124,"address":[68400],"length":1,"stats":{"Line":3},"fn_name":"iter\u003calloc::vec::Vec\u003caoc_2021_day_25::model::Region, alloc::alloc::Global\u003e, aoc_pos::dim_2::yx::PosYX\u003cu16\u003e, 2\u003e"},{"line":127,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":129,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":130,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":136,"address":[63824],"length":1,"stats":{"Line":6},"fn_name":"values\u003calloc::vec::Vec\u003cu16, alloc::alloc::Global\u003e, aoc_pos::dim_2::yx::PosYX\u003ci16\u003e, 2\u003e"},{"line":138,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":149,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":150,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":151,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":155,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":156,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":157,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":184,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":185,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":186,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":187,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":188,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":189,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":193,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":194,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":195,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":196,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":197,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":198,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":222,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":223,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":227,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":228,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":232,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":233,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":246,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":247,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":251,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":252,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":256,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":257,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":272,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":273,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":277,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":278,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":304,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":305,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":319,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":320,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":341,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":343,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":344,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":348,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":350,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":358,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":360,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":361,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":362,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":363,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":367,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":369,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":370,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":371,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":379,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":381,"address":[],"length":0,"stats":{"Line":12},"fn_name":null},{"line":382,"address":[],"length":0,"stats":{"Line":12},"fn_name":null},{"line":383,"address":[],"length":0,"stats":{"Line":13},"fn_name":null},{"line":384,"address":[],"length":0,"stats":{"Line":10},"fn_name":null},{"line":388,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":390,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":391,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":392,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":400,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":402,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":403,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":404,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":405,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":409,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":411,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":412,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":413,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":431,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":444,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":445,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":449,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":450,"address":[],"length":0,"stats":{"Line":2},"fn_name":null}],"covered":83,"coverable":117},{"path":["/","home","runner","work","advent-of-code","advent-of-code","common","list","list.rs"],"content":"//! Implementation of lisp-like lists\n//!\n//! A list is represented as the first list item and a reference to another list to represent the\n//! remaining items - these are referred to as the \"head\" and the \"tail\". There is a special case\n//! for the empty list.\n//!\n//! While this is much less efficient than a [`Vec`], it allows reuse in a way which can be very\n//! beneficial for certain types of algorithm. Adding new items to a list only creates one new\n//! allocation per item, and removing any number of items from the start of the list requires no\n//! allocation.\n//!\n//! We also declare [`CharList`] as `List \u003cchar\u003e`, and implement some extra methods and traits to\n//! make it work nicely with [`String`] and [`str`].\n\nuse aoc_misc::*;\n\npub use base_list::List;\npub use char_list::CharList;\n\nmod base_list {\n\n\tuse super::*;\n\n\tpub enum List \u003cItem\u003e {\n\t\tEmpty,\n\t\tPresent (Rc \u003c(Item, List \u003cItem\u003e)\u003e),\n\t}\n\n\timpl \u003cItem: Clone\u003e List \u003cItem\u003e {\n\n\t\t#[ inline ]\n\t\t#[ must_use ]\n\t\tpub const fn new () -\u003e Self { Self::Empty }\n\n\t\t#[ inline ]\n\t\t#[ must_use ]\n\t\tpub fn cons (\u0026 self) -\u003e Option \u003c(\u0026 Item, \u0026 Self)\u003e {\n\t\t\tmatch * self {\n\t\t\t\tSelf::Present (ref inner) =\u003e {\n\t\t\t\t\tlet (ref head, ref tail) = * inner.as_ref ();\n\t\t\t\t\tSome ((head, tail))\n\t\t\t\t},\n\t\t\t\tSelf::Empty =\u003e None,\n\t\t\t}\n\t\t}\n\n\t\t#[ inline ]\n\t\t#[ must_use ]\n\t\tpub fn head (\u0026 self) -\u003e Option \u003c\u0026 Item\u003e {\n\t\t\tself.cons ().map (|(head, _)| head)\n\t\t}\n\n\t\t#[ inline ]\n\t\t#[ must_use ]\n\t\tpub fn tail (\u0026 self) -\u003e Option \u003c\u0026 Self\u003e {\n\t\t\tself.cons ().map (|(_, tail)| tail)\n\t\t}\n\n\t\t#[ inline ]\n\t\t#[ must_use ]\n\t\tpub fn is_empty (\u0026 self) -\u003e bool {\n\t\t\tself.cons ().is_none ()\n\t\t}\n\n\t\t#[ inline ]\n\t\t#[ must_use ]\n\t\tpub fn len (\u0026 self) -\u003e usize {\n\t\t\tlet mut cur = self.clone ();\n\t\t\tlet mut len = 0;\n\t\t\twhile let Self::Present (inner) = cur {\n\t\t\t\tlet (_, ref new) = * inner.as_ref ();\n\t\t\t\tcur = new.clone ();\n\t\t\t\tlen += 1;\n\t\t\t}\n\t\t\tlen\n\t\t}\n\n\t\t#[ inline ]\n\t\t#[ must_use ]\n\t\tpub fn push_front (\u0026 self, head: Item) -\u003e Self {\n\t\t\tSelf::Present (Rc::new ((head, self.clone ())))\n\t\t}\n\n\t\t#[ inline ]\n\t\t#[ must_use ]\n\t\tpub const fn iter (\u0026 self) -\u003e ListIter \u003cItem\u003e {\n\t\t\tListIter { list: self }\n\t\t}\n\n\t}\n\n\timpl \u003cItem: Clone + Debug\u003e Debug for List \u003cItem\u003e {\n\n\t\t#[ inline ]\n\t\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\t\twrite! (formatter, \"[\") ?;\n\t\t\tlet mut cur = self;\n\t\t\tlet mut idx = 0_usize;\n\t\t\twhile let Some ((head, tail)) = cur.cons () {\n\t\t\t\tif idx \u003e 0 { write! (formatter, \", \") ?; }\n\t\t\t\tDebug::fmt (\u0026 head, formatter) ?;\n\t\t\t\tcur = tail;\n\t\t\t\tidx += 1;\n\t\t\t}\n\t\t\twrite! (formatter, \"]\") ?;\n\t\t\tOk (())\n\t\t}\n\n\t}\n\n\timpl \u003cItem: Clone\u003e Clone for List \u003cItem\u003e {\n\n\t\t#[ inline ]\n\t\tfn clone (\u0026 self) -\u003e Self {\n\t\t\tmatch * self {\n\t\t\t\tSelf::Present (ref inner) =\u003e Self::Present (Rc::clone (inner)),\n\t\t\t\tSelf::Empty =\u003e Self::Empty,\n\t\t\t}\n\t\t}\n\n\t}\n\n\timpl \u003cItem: Clone + PartialEq\u003e PartialEq for List \u003cItem\u003e {\n\n\t\t#[ inline ]\n\t\tfn eq (\u0026 self, other: \u0026 Self) -\u003e bool {\n\t\t\tlet mut left = self;\n\t\t\tlet mut right = other;\n\t\t\tloop {\n\t\t\t\tmatch (left.cons (), right.cons ()) {\n\t\t\t\t\t(None, None) =\u003e return true,\n\t\t\t\t\t(Some (_), None) | (None, Some (_)) =\u003e return false,\n\t\t\t\t\t(Some ((left_head, left_tail)), Some ((right_head, right_tail))) =\u003e {\n\t\t\t\t\t\tif ! Item::eq (left_head, right_head) { return false }\n\t\t\t\t\t\t(left, right) = (left_tail, right_tail);\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t}\n\n\timpl \u003cItem\u003e PartialOrd for List \u003cItem\u003e where Item: Clone + PartialOrd {\n\t\t#[ inline ]\n\t\tfn partial_cmp (\u0026 self, other: \u0026 Self) -\u003e Option \u003cOrdering\u003e {\n\t\t\tlet mut left = self;\n\t\t\tlet mut right = other;\n\t\t\tloop {\n\t\t\t\tmatch (left.cons (), right.cons ()) {\n\t\t\t\t\t(None, None) =\u003e return Some (Ordering::Equal),\n\t\t\t\t\t(None, Some (_)) =\u003e return Some (Ordering::Less),\n\t\t\t\t\t(Some (_), None) =\u003e return Some (Ordering::Greater),\n\t\t\t\t\t(Some ((left_head, left_tail)), Some ((right_head, right_tail))) =\u003e {\n\t\t\t\t\t\tmatch left_head.partial_cmp (right_head) {\n\t\t\t\t\t\t\tSome (Ordering::Equal) =\u003e {\n\t\t\t\t\t\t\t\tleft = left_tail;\n\t\t\t\t\t\t\t\tright = right_tail;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tSome (Ordering::Greater) =\u003e return Some (Ordering::Greater),\n\t\t\t\t\t\t\tSome (Ordering::Less) =\u003e return Some (Ordering::Less),\n\t\t\t\t\t\t\tNone =\u003e return None,\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\timpl \u003cItem\u003e Ord for List \u003cItem\u003e where Item: Clone + Ord {\n\t\t#[ inline ]\n\t\tfn cmp (\u0026 self, other: \u0026 Self) -\u003e Ordering {\n\t\t\tlet mut left = self;\n\t\t\tlet mut right = other;\n\t\t\tloop {\n\t\t\t\tmatch (left.cons (), right.cons ()) {\n\t\t\t\t\t(None, None) =\u003e return Ordering::Equal,\n\t\t\t\t\t(None, Some (_)) =\u003e return Ordering::Less,\n\t\t\t\t\t(Some (_), None) =\u003e return Ordering::Greater,\n\t\t\t\t\t(Some ((left_head, left_tail)), Some ((right_head, right_tail))) =\u003e {\n\t\t\t\t\t\tmatch left_head.cmp (right_head) {\n\t\t\t\t\t\t\tOrdering::Equal =\u003e {\n\t\t\t\t\t\t\t\tleft = left_tail;\n\t\t\t\t\t\t\t\tright = right_tail;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tOrdering::Greater =\u003e return Ordering::Greater,\n\t\t\t\t\t\t\tOrdering::Less =\u003e return Ordering::Less,\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\timpl \u003cItem: Clone + Eq\u003e Eq for List \u003cItem\u003e { }\n\n\timpl \u003cItem: Clone + Hash\u003e Hash for List \u003cItem\u003e {\n\n\t\t#[ inline ]\n\t\tfn hash \u003cHshr: Hasher\u003e (\u0026 self, hasher: \u0026 mut Hshr) {\n\t\t\tlet mut cur = self;\n\t\t\twhile let Some ((head, tail)) = cur.cons () {\n\t\t\t\thead.hash (hasher);\n\t\t\t\tcur = tail;\n\t\t\t}\n\t\t}\n\n\t}\n\n\timpl Display for List \u003cchar\u003e {\n\n\t\t#[ inline ]\n\t\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\t\tlet mut cur = self.clone ();\n\t\t\twhile let Self::Present (inner) = cur {\n\t\t\t\tlet \u0026 (head, ref tail) = inner.as_ref ();\n\t\t\t\twrite! (formatter, \"{}\", head) ?;\n\t\t\t\tcur = tail.clone ();\n\t\t\t}\n\t\t\tOk (())\n\t\t}\n\n\t}\n\n\tpub struct ListIter \u003c'dat, Item: Clone\u003e {\n\t\tlist: \u0026 'dat List \u003cItem\u003e,\n\t}\n\n\timpl \u003c'dat, Item: Clone\u003e Iterator for ListIter \u003c'dat, Item\u003e {\n\t\ttype Item = \u0026 'dat Item;\n\t\tfn next (\u0026 mut self) -\u003e Option \u003c\u0026 'dat Item\u003e {\n\t\t\tself.list.cons ().map (|(head, tail)| {\n\t\t\t\tself.list = tail;\n\t\t\t\thead\n\t\t\t})\n\t\t}\n\t}\n\n}\n\nmod char_list {\n\n\tuse super::*;\n\n\tpub type CharList = List \u003cchar\u003e;\n\n\timpl CharList {\n\n\t\t#[ inline ]\n\t\t#[ must_use ]\n\t\tpub fn starts_with (\u0026 self, pat: \u0026 str) -\u003e bool {\n\t\t\tself.strip_prefix (pat).is_some ()\n\t\t}\n\n\t\t#[ inline ]\n\t\t#[ must_use ]\n\t\tpub fn strip_prefix (\u0026 self, pat: \u0026 str) -\u003e Option \u003c\u0026 Self\u003e {\n\t\t\tlet mut cur = self;\n\t\t\tlet mut pat_chars = pat.chars ();\n\t\t\tloop {\n\t\t\t\tmatch (cur.cons (), pat_chars.next ()) {\n\t\t\t\t\t(_, None) =\u003e return Some (cur),\n\t\t\t\t\t(None, _) =\u003e return None,\n\t\t\t\t\t(Some ((\u0026 head, tail)), Some (pat_ch)) =\u003e {\n\t\t\t\t\t\tif head != pat_ch { return None }\n\t\t\t\t\t\tcur = tail;\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t#[ inline ]\n\t\t#[ must_use ]\n\t\tpub fn prepend (\u0026 self, prefix: \u0026 str) -\u003e Self {\n\t\t\tlet mut cur = self.clone ();\n\t\t\tfor prefix_ch in prefix.chars ().rev () {\n\t\t\t\tcur = cur.push_front (prefix_ch);\n\t\t\t}\n\t\t\tcur\n\t\t}\n\n\t}\n\n\timpl From \u003c\u0026 str\u003e for CharList {\n\t\t#[ inline ]\n\t\tfn from (src: \u0026 str) -\u003e Self {\n\t\t\tSelf::Empty.prepend (src)\n\t\t}\n\t}\n\n\timpl From \u003c\u0026 String\u003e for CharList {\n\t\t#[ inline ]\n\t\tfn from (src: \u0026 String) -\u003e Self {\n\t\t\tSelf::Empty.prepend (src)\n\t\t}\n\t}\n\n\timpl PartialEq \u003cstr\u003e for CharList {\n\t\t#[ inline ]\n\t\tfn eq (\u0026 self, other: \u0026 str) -\u003e bool {\n\t\t\tlet mut cur = self;\n\t\t\tlet mut other_iter = other.chars ();\n\t\t\tloop {\n\t\t\t\tmatch (cur.cons (), other_iter.next ()) {\n\t\t\t\t\t(Some (_), None) | (None, Some (_)) =\u003e return false,\n\t\t\t\t\t(None, None) =\u003e return true,\n\t\t\t\t\t(Some ((\u0026 cur_head, cur_tail)), Some (other_ch)) =\u003e {\n\t\t\t\t\t\tif cur_head != other_ch { return false }\n\t\t\t\t\t\tcur = cur_tail;\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\timpl PartialEq \u003cString\u003e for CharList {\n\t\t#[ inline ]\n\t\tfn eq (\u0026 self, other: \u0026 String) -\u003e bool {\n\t\t\tPartialEq::eq (self, other.as_str ())\n\t\t}\n\t}\n\n\timpl PartialEq \u003cCharList\u003e for \u0026 String {\n\t\t#[ inline ]\n\t\tfn eq (\u0026 self, other: \u0026 CharList) -\u003e bool {\n\t\t\tPartialEq::eq (self.as_str (), other)\n\t\t}\n\t}\n\n\timpl PartialEq \u003cCharList\u003e for str {\n\t\t#[ inline ]\n\t\tfn eq (\u0026 self, other: \u0026 CharList) -\u003e bool {\n\t\t\tPartialEq::eq (other, self)\n\t\t}\n\t}\n\n\t#[ cfg (test) ]\n\tmod tests {\n\n\t\tuse super::*;\n\t\tuse CharList as CL;\n\n\t\tfn cl (src: \u0026 str) -\u003e CL { CL::from (src) }\n\n\t\tconst SAMPLES: \u0026 [\u0026 str] = \u0026 [ \"\", \"a\", \"ab\", \"abc\", \"b\", \"bc\", \"c\" ];\n\n\t\t#[ test ]\n\t\tfn eq () {\n\t\t\tfor left in SAMPLES.iter ().cloned () {\n\t\t\t\tfor right in SAMPLES.iter ().cloned () {\n\t\t\t\t\tif left == right {\n\t\t\t\t\t\tassert! (cl (left) == cl (right),\n\t\t\t\t\t\t\t\"{:?} == {:?} but CharList::from ({:?}) != CharList::from ({:?})\",\n\t\t\t\t\t\t\tleft, right, left, right);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tassert! (cl (left) != cl (right),\n\t\t\t\t\t\t\t\"{:?} != {:?} but CharList::from ({:?}) == CharList::from ({:?})\",\n\t\t\t\t\t\t\tleft, right, left, right);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t#[ test ]\n\t\tfn strip_prefix () {\n\t\t\tfor left in SAMPLES.iter ().cloned () {\n\t\t\t\tfor right in SAMPLES.iter ().cloned () {\n\t\t\t\t\tlet expected = left.strip_prefix (right);\n\t\t\t\t\tlet actual = cl (left).strip_prefix (right).cloned ();\n\t\t\t\t\tassert_eq! (expected.map (cl), actual,\n\t\t\t\t\t\t\"{:?}.strip_prefix ({:?}) == {:?} but {:?}.strip_prefix ({:?}) == {:?}\",\n\t\t\t\t\t\tleft, right, expected, cl (left), right, actual);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t}\n\n}\n","traces":[{"line":33,"address":[40320,40321],"length":1,"stats":{"Line":2},"fn_name":"new\u003calloc::string::String\u003e"},{"line":37,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":38,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":39,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":43,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":49,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":50,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":75,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":80,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":81,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":86,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":99,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":101,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":102,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":103,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":114,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":115,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":116,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":117,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":126,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":127,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":128,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":129,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":130,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":131,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":132,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":133,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":134,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":135,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":145,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":146,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":147,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":148,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":149,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":150,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":151,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":152,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":153,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":154,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":155,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":156,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":157,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":159,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":160,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":161,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":171,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":172,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":173,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":174,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":175,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":176,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":177,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":178,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":179,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":180,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":181,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":182,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":183,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":185,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":186,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":199,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":200,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":201,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":202,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":203,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":212,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":213,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":214,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":215,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":216,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":217,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":219,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":230,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":231,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":232,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":233,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":250,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":251,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":256,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":257,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":258,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":259,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":260,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":261,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":262,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":263,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":264,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":265,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":273,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":274,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":275,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":276,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":278,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":285,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":286,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":292,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":293,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":299,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":300,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":301,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":302,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":303,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":304,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":305,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":306,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":307,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":308,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":317,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":318,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":324,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":325,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":331,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":332,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":342,"address":[10512,10526],"length":1,"stats":{"Line":2},"fn_name":"cl"},{"line":347,"address":[11306,11332,10544],"length":1,"stats":{"Line":3},"fn_name":"eq"},{"line":348,"address":[10754,10551],"length":1,"stats":{"Line":2},"fn_name":null},{"line":349,"address":[10786],"length":1,"stats":{"Line":1},"fn_name":null},{"line":350,"address":[11017],"length":1,"stats":{"Line":1},"fn_name":null},{"line":351,"address":[11317,11354,11092],"length":1,"stats":{"Line":3},"fn_name":null},{"line":355,"address":[11058,11636],"length":1,"stats":{"Line":2},"fn_name":null},{"line":364,"address":[12096,12815],"length":1,"stats":{"Line":3},"fn_name":"strip_prefix"},{"line":365,"address":[12316,12108],"length":1,"stats":{"Line":2},"fn_name":null},{"line":366,"address":[12348],"length":1,"stats":{"Line":1},"fn_name":null},{"line":367,"address":[12579],"length":1,"stats":{"Line":1},"fn_name":null},{"line":368,"address":[12632],"length":1,"stats":{"Line":1},"fn_name":null},{"line":369,"address":[12878,13348],"length":1,"stats":{"Line":1},"fn_name":null},{"line":371,"address":[13299],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":79,"coverable":147},{"path":["/","home","runner","work","advent-of-code","advent-of-code","common","md5","md5.rs"],"content":"use std::cmp;\nuse std::fmt::{ self, Debug, Display, Write as _ };\nuse std::ops::Index;\n\n#[ cfg (test) ] use aoc_misc::*;\nuse aoc_nums as nums;\nuse nums::IntConv;\n\n#[ derive (Eq, PartialEq) ]\npub struct Output ([u8; 16]);\n\n#[ inline ]\n#[ must_use ]\npub fn md5_hash (input: \u0026 [u8]) -\u003e Output {\n\tlet mut md5 = MD5::new ();\n\tmd5.update (input);\n\tmd5.finish ()\n}\n\npub struct MD5 {\n\tstate: State,\n\tmessage: [u8; 64],\n\tmessage_len: usize,\n\tlen: usize,\n}\n\ntype State = [u32; 4];\n\nimpl Output {\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub const fn len (\u0026 self) -\u003e usize {\n\t\tself.0.len ()\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub const fn is_empty (\u0026 self) -\u003e bool {\n\t\tself.0.is_empty ()\n\t}\n\n\t#[ allow (clippy::missing_inline_in_public_items) ]\n\tpub fn from_hex (input: \u0026 str) -\u003e Result \u003cSelf, String\u003e {\n\t\tlet input_len = input.chars ().count ();\n\t\tif input_len != 32 { return Err (format! (\"Expected 32 chars, not {}\", input_len)) }\n\t\tlet mut result = [0; 16];\n\t\tlet mut input_iter = input.chars ();\n\t\tfor result_ch in result.iter_mut () {\n\t\t\tlet high_ch = input_iter.next ().unwrap ();\n\t\t\tlet low_ch = input_iter.next ().unwrap ();\n\t\t\tlet decode = |ch: char| ch.to_digit (16).ok_or (format! (\"Invalid hex: {}\", ch));\n\t\t\t* result_ch = (decode (high_ch) ?.as_u8 ()) \u003c\u003c 4_i32 | decode (low_ch) ?.as_u8 ();\n\t\t}\n\t\tOk (Self (result))\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn num_zeros (\u0026 self) -\u003e u8 {\n\t\tlet mut result = 0;\n\t\tfor byte in self.0.iter ().copied () {\n\t\t\tif byte \u0026 0xf0 != 0 { break }\n\t\t\tresult += 1;\n\t\t\tif byte \u0026 0x0f != 0 { break }\n\t\t\tresult += 1;\n\t\t}\n\t\tresult\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn as_hex_bytes (\u0026 self) -\u003e [u8; 32] {\n\t\t#[ inline ]\n\t\tconst fn nibble_as_hex (nibble: u8) -\u003e u8 {\n\t\t\tif nibble \u003e= 10 { b'a' + nibble - 10 } else { b'0' + nibble }\n\t\t}\n\t\tlet mut result = [0; 32];\n\t\tlet mut result_iter = result.iter_mut ();\n\t\tfor byte in self.0.iter () {\n\t\t\t* result_iter.next ().unwrap () = nibble_as_hex (byte \u003e\u003e 4_u32);\n\t\t\t* result_iter.next ().unwrap () = nibble_as_hex (byte \u0026 0xf);\n\t\t}\n\t\tresult\n\t}\n\n}\n\nimpl Index \u003cusize\u003e for Output {\n\n\ttype Output = u8;\n\n\t#[ inline ]\n\tfn index (\u0026 self, idx: usize) -\u003e \u0026 u8 {\n\t\t\u0026 self.0 [idx]\n\t}\n\n}\n\nimpl Debug for Output {\n\n\t#[ allow (clippy::missing_inline_in_public_items) ]\n\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\tformatter.write_str (\"md5::Output (\\\"\") ?;\n\t\tDisplay::fmt (self, formatter) ?;\n\t\tformatter.write_str (\"\\\")\") ?;\n\t\tOk (())\n\t}\n\n}\n\nimpl Display for Output {\n\n\t#[ inline ]\n\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\tfor byte in self.0.iter ().copied () {\n\t\t\tlet byte = byte.as_u32 ();\n\t\t\tformatter.write_char (char::from_digit (byte \u003e\u003e 4, 16).unwrap ()) ?;\n\t\t\tformatter.write_char (char::from_digit (byte \u0026 0xf, 16).unwrap ()) ?;\n\t\t}\n\t\tOk (())\n\t}\n\n}\n\nimpl MD5 {\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub const fn new () -\u003e Self {\n\t\tSelf {\n\t\t\tstate: INITIAL_STATE,\n\t\t\tmessage: [0; 64],\n\t\t\tmessage_len: 0,\n\t\t\tlen: 0,\n\t\t}\n\t}\n\n\t#[ inline ]\n\tpub fn reset (\u0026 mut self) {\n\t\tself.state = INITIAL_STATE;\n\t\tself.message_len = 0;\n\t\tself.len = 0;\n\t}\n\n\t#[ inline ]\n\tpub fn push (\u0026 mut self, byte: u8) {\n\t\tself.message [self.message_len] = byte;\n\t\tself.message_len += 1;\n\t\tif self.message_len == 64 {\n\t\t\tself.apply ();\n\t\t}\n\t}\n\n\t#[ inline ]\n\tpub fn update (\u0026 mut self, mut message: \u0026 [u8]) {\n\n\t\t// iterate over message\n\n\t\twhile ! message.is_empty () {\n\n\t\t\t// copy max sized chunk to buffer\n\n\t\t\tlet bytes = cmp::min (64 - self.message_len, message.len ());\n\t\t\tself.message [self.message_len .. self.message_len + bytes].copy_from_slice (\u0026 message [ .. bytes]);\n\t\t\tself.message_len += bytes;\n\t\t\tmessage = \u0026 message [bytes .. ];\n\t\t\tself.len = self.len.wrapping_add (bytes \u003c\u003c 3);\n\n\t\t\t// stop now if buffer is part filled\n\n\t\t\tif self.message_len != 64 { return }\n\n\t\t\t// consume buffer\n\n\t\t\tself.apply ();\n\n\t\t}\n\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn finish (mut self) -\u003e Output {\n\t\tself.finish_real ()\n\t}\n\n\t#[ inline ]\n\tpub fn finish_reset (\u0026 mut self) -\u003e Output {\n\t\tlet output = self.finish_real ();\n\t\tself.reset ();\n\t\toutput\n\t}\n\n\t#[ allow (clippy::missing_inline_in_public_items) ]\n\t#[ must_use ]\n\tfn finish_real (\u0026 mut self) -\u003e Output {\n\n\t\t// remember the length before padding\n\n\t\tlet len = self.len;\n\n\t\t// add one then zeros, leaving exactly 56 bytes buffered\n\n\t\tself.push (0x80);\n\t\tif self.message_len \u003e 56 {\n\t\t\tfor idx in self.message_len .. 64 { self.message [idx] = 0; }\n\t\t\tself.message_len = 64;\n\t\t\tself.apply ();\n\t\t}\n\t\tfor idx in self.message_len .. 56 { self.message [idx] = 0; }\n\t\tself.message_len = 56;\n\n\t\t// then the length, which takes us to 64 bytes\n\n\t\tself.message [56 .. 64].copy_from_slice (\u0026 len.to_le_bytes ());\n\t\tself.message_len += 8;\n\t\tself.apply ();\n\n\t\t// convert result words to byte array\n\n\t\tassert! (self.message_len == 0);\n\n\t\tlet mut result = [0; 16];\n\t\tfor src_idx in 0 .. 4 {\n\t\t\tlet dst_idx = src_idx \u003c\u003c 2_i32;\n\t\t\tresult [dst_idx] = (self.state [src_idx] \u0026 0xff).as_u8 ();\n\t\t\tresult [dst_idx + 1] = (self.state [src_idx] \u003e\u003e 8_i32 \u0026 0xff).as_u8 ();\n\t\t\tresult [dst_idx + 2] = (self.state [src_idx] \u003e\u003e 16_i32 \u0026 0xff).as_u8 ();\n\t\t\tresult [dst_idx + 3] = (self.state [src_idx] \u003e\u003e 24_i32 \u0026 0xff).as_u8 ();\n\t\t}\n\n\t\tOutput (result)\n\n\t}\n\n\tfn apply (\u0026 mut self) {\n\n\t\t// convert message buffer into words\n\n\t\tassert! (self.message_len == 64);\n\n\t\tlet mut message = [0; 16];\n\t\t#[ allow (clippy::needless_range_loop) ]\n\t\tfor dst_idx in 0_usize .. 16_usize {\n\t\t\tlet src_idx = dst_idx \u003c\u003c 2_u32;\n\t\t\tmessage [dst_idx] = u32::from_le_bytes (\n\t\t\t\tself.message [src_idx .. src_idx + 4].try_into ().unwrap ());\n\t\t}\n\n\t\t// apply rounds as specified\n\n\t\tlet [mut a, mut b, mut c, mut d] = self.state;\n\n\t\tfor op in 0 .. 16 {\n\t\t\tlet func = ((b \u0026 c) | (! b \u0026 d))\n\t\t\t\t.wrapping_add (a)\n\t\t\t\t.wrapping_add (ADDS [op])\n\t\t\t\t.wrapping_add (message [op]);\n\t\t\t(a, b, c, d) = (d, b.wrapping_add (func.rotate_left (ROTATES [op].as_u32 ())), b, c);\n\t\t}\n\n\t\tfor op in 16 .. 32 {\n\t\t\tlet func = ((d \u0026 b) | (! d \u0026 c))\n\t\t\t\t.wrapping_add (a)\n\t\t\t\t.wrapping_add (ADDS [op])\n\t\t\t\t.wrapping_add (message [(5 * op + 1) % 16]);\n\t\t\t(a, b, c, d) = (d, b.wrapping_add (func.rotate_left (ROTATES [op].as_u32 ())), b, c);\n\t\t}\n\n\t\tfor op in 32 .. 48 {\n\t\t\tlet func = (b ^ c ^ d)\n\t\t\t\t.wrapping_add (a)\n\t\t\t\t.wrapping_add (ADDS [op])\n\t\t\t\t.wrapping_add (message [(3 * op + 5) % 16]);\n\t\t\t(a, b, c, d) = (d, b.wrapping_add (func.rotate_left (ROTATES [op].as_u32 ())), b, c);\n\t\t}\n\n\t\tfor op in 48 .. 64 {\n\t\t\tlet func = (c ^ (b | ! d))\n\t\t\t\t.wrapping_add (a)\n\t\t\t\t.wrapping_add (ADDS [op])\n\t\t\t\t.wrapping_add (message [7 * op % 16]);\n\t\t\t(a, b, c, d) = (d, b.wrapping_add (func.rotate_left (ROTATES [op].as_u32 ())), b, c);\n\t\t}\n\n\t\tself.state = [\n\t\t\tself.state [0].wrapping_add (a),\n\t\t\tself.state [1].wrapping_add (b),\n\t\t\tself.state [2].wrapping_add (c),\n\t\t\tself.state [3].wrapping_add (d),\n\t\t];\n\n\t\t// clear buffer\n\n\t\tself.message_len = 0;\n\n\t}\n\n}\n\nimpl Default for MD5 {\n\n\t#[ inline ]\n\tfn default () -\u003e Self {\n\t\tSelf::new ()\n\t}\n\n}\n\nconst INITIAL_STATE: State = [ 0x_6745_2301, 0x_efcd_ab89, 0x_98ba_dcfe, 0x_1032_5476 ];\n\nconst ROTATES: [u8; 64] = [\n\t7, 12, 17, 22, 7, 12, 17, 22, 7, 12, 17, 22, 7, 12, 17, 22,\n\t5, 9, 14, 20, 5, 9, 14, 20, 5, 9, 14, 20, 5, 9, 14, 20,\n\t4, 11, 16, 23, 4, 11, 16, 23, 4, 11, 16, 23, 4, 11, 16, 23,\n\t6, 10, 15, 21, 6, 10, 15, 21, 6, 10, 15, 21, 6, 10, 15, 21,\n];\n\nconst ADDS: [u32; 64] = [\n\t0x_d76a_a478, 0x_e8c7_b756, 0x_2420_70db, 0x_c1bd_ceee, 0x_f57c_0faf, 0x_4787_c62a,\n\t0x_a830_4613, 0x_fd46_9501, 0x_6980_98d8, 0x_8b44_f7af, 0x_ffff_5bb1, 0x_895c_d7be,\n\t0x_6b90_1122, 0x_fd98_7193, 0x_a679_438e, 0x_49b4_0821, 0x_f61e_2562, 0x_c040_b340,\n\t0x_265e_5a51, 0x_e9b6_c7aa, 0x_d62f_105d, 0x_0244_1453, 0x_d8a1_e681, 0x_e7d3_fbc8,\n\t0x_21e1_cde6, 0x_c337_07d6, 0x_f4d5_0d87, 0x_455a_14ed, 0x_a9e3_e905, 0x_fcef_a3f8,\n\t0x_676f_02d9, 0x_8d2a_4c8a, 0x_fffa_3942, 0x_8771_f681, 0x_6d9d_6122, 0x_fde5_380c,\n\t0x_a4be_ea44, 0x_4bde_cfa9, 0x_f6bb_4b60, 0x_bebf_bc70, 0x_289b_7ec6, 0x_eaa1_27fa,\n\t0x_d4ef_3085, 0x_0488_1d05, 0x_d9d4_d039, 0x_e6db_99e5, 0x_1fa2_7cf8, 0x_c4ac_5665,\n\t0x_f429_2244, 0x_432a_ff97, 0x_ab94_23a7, 0x_fc93_a039, 0x_655b_59c3, 0x_8f0c_cc92,\n\t0x_ffef_f47d, 0x_8584_5dd1, 0x_6fa8_7e4f, 0x_fe2c_e6e0, 0x_a301_4314, 0x_4e08_11a1,\n\t0x_f753_7e82, 0x_bd3a_f235, 0x_2ad7_d2bb, 0x_eb86_d391,\n];\n\n#[ cfg (test) ]\nmod tests {\n\n\tuse super::*;\n\n\tconst LOREM_IPSUM: \u0026 str =\n\t\t\"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut at tempus ligula, ac \\\n\t\tpellentesque leo. Nullam molestie justo sit amet neque venenatis, at laoreet urna \\\n\t\tmollis. Mauris eget mollis quam. Maecenas ultricies odio dolor, id luctus lorem \\\n\t\taliquam at. Vestibulum est lectus, egestas vehicula mi vel, pharetra elementum \\\n\t\tligula. Nam cursus, magna vitae sodales pretium, metus ligula facilisis nisl, pretium \\\n\t\taccumsan leo justo sed elit. Vestibulum efficitur justo quis molestie luctus. Aliquam \\\n\t\tvolutpat at quam quis egestas. Proin et turpis nec lacus maximus iaculis. Donec vitae \\\n\t\tmassa magna. Nulla pulvinar eleifend erat et fringilla.\";\n\n\tmacro_rules! assert_md5 {\n\t\t( $expect:expr , $input:expr ) =\u003e {\n\t\t\tassert_eq! (\n\t\t\t\tOutput::from_hex ($expect).unwrap (),\n\t\t\t\tmd5_hash ($input.as_bytes ()));\n\t\t}\n\t}\n\n\t#[ test ]\n\tfn test_md5_hash () {\n\t\tassert_md5! (\"d41d8cd98f00b204e9800998ecf8427e\", \"\");\n\t\tassert_md5! (\"6cd3556deb0da54bca060b4c39479839\", \"Hello, world!\");\n\t\tassert_md5! (\"7bb31841cf426a6de079421b2590cf82\", \"The Ideal Stocking Stuffer\");\n\t\tassert_md5! (\"777f5a5ebdeab74ab0299512f9688be0\", LOREM_IPSUM);\n\t}\n\n\t#[ test ]\n\tfn test_output () {\n\t\tlet output = Output::from_hex (\"0123456789abcdef0123456789abcdef\").unwrap ();\n\t\tassert_eq! (16, output.len ());\n\t\tassert_eq! (false, output.is_empty ());\n\t\tassert_eq! (0x01, output [0]);\n\t\tassert_eq! (0xef, output [15]);\n\t\tassert_eq! (\"md5::Output (\\\"0123456789abcdef0123456789abcdef\\\")\", format! (\"{:?}\", output));\n\t\tassert_eq! (\"0123456789abcdef0123456789abcdef\", format! (\"{}\", output));\n\t\tassert_err! (\"Expected 32 chars, not 31\", Output::from_hex (\"0123456789abcdef0123456789abcde\"));\n\t\tassert_err! (\"Expected 32 chars, not 33\", Output::from_hex (\"0123456789abcdef0123456789abcdef0\"));\n\t\tassert_err! (\"Invalid hex: X\", Output::from_hex (\"0123456789abcdeX0123456789abcdef\"));\n\t}\n\n}\n","traces":[{"line":14,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":15,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":16,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":17,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":33,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":34,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":44,"address":[28592],"length":1,"stats":{"Line":2},"fn_name":"from_hex"},{"line":45,"address":[28651],"length":1,"stats":{"Line":2},"fn_name":null},{"line":46,"address":[28753,28695],"length":1,"stats":{"Line":3},"fn_name":null},{"line":47,"address":[28716],"length":1,"stats":{"Line":2},"fn_name":null},{"line":48,"address":[28727],"length":1,"stats":{"Line":2},"fn_name":null},{"line":49,"address":[29788,28965,29191],"length":1,"stats":{"Line":6},"fn_name":null},{"line":50,"address":[29212],"length":1,"stats":{"Line":2},"fn_name":null},{"line":51,"address":[29256],"length":1,"stats":{"Line":2},"fn_name":null},{"line":52,"address":[27360,27389],"length":1,"stats":{"Line":4},"fn_name":"{closure#0}"},{"line":53,"address":[29304,29534,29784],"length":1,"stats":{"Line":6},"fn_name":null},{"line":55,"address":[29095],"length":1,"stats":{"Line":2},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":63,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":65,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":74,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":75,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":12},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":80,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":81,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":82,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":103,"address":[30784],"length":1,"stats":{"Line":1},"fn_name":"fmt"},{"line":104,"address":[30821,30904],"length":1,"stats":{"Line":1},"fn_name":null},{"line":105,"address":[30893,30941,31006],"length":1,"stats":{"Line":2},"fn_name":null},{"line":106,"address":[31077,31031,30982],"length":1,"stats":{"Line":2},"fn_name":null},{"line":107,"address":[31067],"length":1,"stats":{"Line":1},"fn_name":null},{"line":115,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":116,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":117,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":118,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":119,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":121,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":130,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":133,"address":[],"length":0,"stats":{"Line":14},"fn_name":null},{"line":140,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":141,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":142,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":143,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":147,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":148,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":149,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":150,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":151,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":156,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":160,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":164,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":165,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":166,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":167,"address":[],"length":0,"stats":{"Line":10},"fn_name":null},{"line":168,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":172,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":176,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":184,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":185,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":189,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":190,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":191,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":192,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":197,"address":[32688],"length":1,"stats":{"Line":1},"fn_name":"finish_real"},{"line":201,"address":[32738],"length":1,"stats":{"Line":1},"fn_name":null},{"line":205,"address":[32758],"length":1,"stats":{"Line":1},"fn_name":null},{"line":206,"address":[32776],"length":1,"stats":{"Line":1},"fn_name":null},{"line":207,"address":[33034,32864],"length":1,"stats":{"Line":2},"fn_name":null},{"line":208,"address":[33017],"length":1,"stats":{"Line":1},"fn_name":null},{"line":209,"address":[33024],"length":1,"stats":{"Line":1},"fn_name":null},{"line":211,"address":[33295,32790,33144],"length":1,"stats":{"Line":3},"fn_name":null},{"line":212,"address":[33220],"length":1,"stats":{"Line":1},"fn_name":null},{"line":216,"address":[33388,33227],"length":1,"stats":{"Line":2},"fn_name":null},{"line":217,"address":[33502,33460],"length":1,"stats":{"Line":1},"fn_name":null},{"line":218,"address":[33495],"length":1,"stats":{"Line":1},"fn_name":null},{"line":222,"address":[33631,33540],"length":1,"stats":{"Line":1},"fn_name":null},{"line":224,"address":[33553],"length":1,"stats":{"Line":1},"fn_name":null},{"line":225,"address":[33671,33573,33818,34591],"length":1,"stats":{"Line":4},"fn_name":null},{"line":226,"address":[33839],"length":1,"stats":{"Line":1},"fn_name":null},{"line":227,"address":[33866,33999],"length":1,"stats":{"Line":1},"fn_name":null},{"line":228,"address":[33981,34035,34204],"length":1,"stats":{"Line":2},"fn_name":null},{"line":229,"address":[34409,34240,34186],"length":1,"stats":{"Line":2},"fn_name":null},{"line":230,"address":[34601,34445,34391],"length":1,"stats":{"Line":2},"fn_name":null},{"line":233,"address":[33755],"length":1,"stats":{"Line":1},"fn_name":null},{"line":237,"address":[34624],"length":1,"stats":{"Line":1},"fn_name":"apply"},{"line":241,"address":[34647,34744],"length":1,"stats":{"Line":1},"fn_name":null},{"line":243,"address":[34660],"length":1,"stats":{"Line":1},"fn_name":null},{"line":245,"address":[34790,35368,34680,34973],"length":1,"stats":{"Line":4},"fn_name":null},{"line":246,"address":[34997],"length":1,"stats":{"Line":1},"fn_name":null},{"line":247,"address":[35306,35381],"length":1,"stats":{"Line":1},"fn_name":null},{"line":248,"address":[35033],"length":1,"stats":{"Line":1},"fn_name":null},{"line":253,"address":[34866],"length":1,"stats":{"Line":1},"fn_name":null},{"line":255,"address":[35555,35420,34906,36236],"length":1,"stats":{"Line":4},"fn_name":null},{"line":256,"address":[35733,35832,35579],"length":1,"stats":{"Line":3},"fn_name":null},{"line":257,"address":[35612],"length":1,"stats":{"Line":1},"fn_name":null},{"line":258,"address":[35743,35642],"length":1,"stats":{"Line":1},"fn_name":null},{"line":259,"address":[35774,35849],"length":1,"stats":{"Line":1},"fn_name":null},{"line":260,"address":[36110,35872],"length":1,"stats":{"Line":2},"fn_name":null},{"line":263,"address":[36257,35488,36392,37205],"length":1,"stats":{"Line":4},"fn_name":null},{"line":264,"address":[36416,36570,36801],"length":1,"stats":{"Line":3},"fn_name":null},{"line":265,"address":[36449],"length":1,"stats":{"Line":1},"fn_name":null},{"line":266,"address":[36580,36479],"length":1,"stats":{"Line":1},"fn_name":null},{"line":267,"address":[36818,36611],"length":1,"stats":{"Line":1},"fn_name":null},{"line":268,"address":[36841,37079],"length":1,"stats":{"Line":2},"fn_name":null},{"line":271,"address":[36325,37226,37361,38105],"length":1,"stats":{"Line":4},"fn_name":null},{"line":272,"address":[37385,37527,37737],"length":1,"stats":{"Line":3},"fn_name":null},{"line":273,"address":[37406],"length":1,"stats":{"Line":1},"fn_name":null},{"line":274,"address":[37537,37436],"length":1,"stats":{"Line":1},"fn_name":null},{"line":275,"address":[37751,37568],"length":1,"stats":{"Line":1},"fn_name":null},{"line":276,"address":[37774,37979],"length":1,"stats":{"Line":2},"fn_name":null},{"line":279,"address":[38237,38899,38126,37294],"length":1,"stats":{"Line":4},"fn_name":null},{"line":280,"address":[38392,38540,38258],"length":1,"stats":{"Line":3},"fn_name":null},{"line":281,"address":[38286],"length":1,"stats":{"Line":1},"fn_name":null},{"line":282,"address":[38399,38313],"length":1,"stats":{"Line":1},"fn_name":null},{"line":283,"address":[38427,38554],"length":1,"stats":{"Line":1},"fn_name":null},{"line":284,"address":[38577,38773],"length":1,"stats":{"Line":2},"fn_name":null},{"line":287,"address":[39042],"length":1,"stats":{"Line":1},"fn_name":null},{"line":288,"address":[38232,38202],"length":1,"stats":{"Line":2},"fn_name":null},{"line":289,"address":[38912],"length":1,"stats":{"Line":1},"fn_name":null},{"line":290,"address":[38950],"length":1,"stats":{"Line":1},"fn_name":null},{"line":291,"address":[38988],"length":1,"stats":{"Line":1},"fn_name":null},{"line":296,"address":[39054],"length":1,"stats":{"Line":1},"fn_name":null},{"line":305,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":306,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":358,"address":[21472],"length":1,"stats":{"Line":3},"fn_name":"test_md5_hash"},{"line":359,"address":[21788,21479,21627],"length":1,"stats":{"Line":2},"fn_name":null},{"line":360,"address":[22086,21745,21832,21943],"length":1,"stats":{"Line":3},"fn_name":null},{"line":361,"address":[22049,22384,22130,22241],"length":1,"stats":{"Line":3},"fn_name":null},{"line":362,"address":[22347,22539,22428,22663],"length":1,"stats":{"Line":3},"fn_name":null},{"line":366,"address":[22720,23866],"length":1,"stats":{"Line":3},"fn_name":"test_output"},{"line":367,"address":[22727],"length":1,"stats":{"Line":1},"fn_name":null},{"line":368,"address":[22935,22780],"length":1,"stats":{"Line":1},"fn_name":null},{"line":369,"address":[23122,22979,22895],"length":1,"stats":{"Line":2},"fn_name":null},{"line":370,"address":[23174,23309,23072],"length":1,"stats":{"Line":2},"fn_name":null},{"line":371,"address":[23258,23361,23492],"length":1,"stats":{"Line":2},"fn_name":null},{"line":372,"address":[23445,23552],"length":1,"stats":{"Line":2},"fn_name":null},{"line":373,"address":[23892],"length":1,"stats":{"Line":1},"fn_name":null},{"line":374,"address":[24237],"length":1,"stats":{"Line":1},"fn_name":null},{"line":375,"address":[24572],"length":1,"stats":{"Line":1},"fn_name":null},{"line":376,"address":[24907],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":141,"coverable":153},{"path":["/","home","runner","work","advent-of-code","advent-of-code","common","misc","misc.rs"],"content":"pub use arrayvec::ArrayVec;\npub use itertools;\npub use itertools::Either;\npub use itertools::EitherOrBoth;\npub use itertools::Itertools;\npub use itertools::MultiPeek;\npub use itertools::izip;\npub use std::borrow::Borrow;\npub use std::borrow::Cow;\npub use std::cell::Cell;\npub use std::cell::RefCell;\npub use std::cmp;\npub use std::cmp::Ordering;\npub use std::collections::BinaryHeap;\npub use std::collections::BTreeMap;\npub use std::collections::BTreeSet;\npub use std::collections::VecDeque;\npub use std::collections::btree_map::Entry as BTreeEntry;\npub use std::collections::btree_map::Iter as BTreeIter;\npub use std::collections::btree_map::Values as BTreeValues;\npub use std::collections::hash_map::DefaultHasher;\npub use std::collections::hash_map::Entry as HashMapEntry;\npub use std::collections::hash_map::RandomState as RandomHasher;\npub use std::convert::Infallible;\npub use std::error::Error;\npub use std::ffi::OsString;\npub use std::fmt;\npub use std::fmt::Debug;\npub use std::fmt::Display;\npub use std::fmt::Write as _;\npub use std::fs;\npub use std::hash;\npub use std::hash::BuildHasher;\npub use std::hash::BuildHasherDefault;\npub use std::hash::Hash;\npub use std::hash::Hasher;\npub use std::iter;\npub use std::iter::Peekable;\npub use std::marker::PhantomData;\npub use std::mem;\npub use std::ops;\npub use std::ops::Add;\npub use std::ops::BitAnd;\npub use std::ops::BitAndAssign;\npub use std::ops::BitOr;\npub use std::ops::BitOrAssign;\npub use std::ops::Deref;\npub use std::ops::Div;\npub use std::ops::Index;\npub use std::ops::IndexMut;\npub use std::ops::Mul;\npub use std::ops::Neg;\npub use std::ops::Range;\npub use std::ops::RangeInclusive;\npub use std::ops::Rem;\npub use std::ops::Shl;\npub use std::ops::ShlAssign;\npub use std::ops::Shr;\npub use std::ops::ShrAssign;\npub use std::ops::Sub;\npub use std::path::Path;\npub use std::rc::Rc;\npub use std::rc::Weak as RcWeak;\npub use std::slice;\npub use std::slice::Iter as SliceIter;\npub use std::str::Chars;\npub use std::str::FromStr;\npub use std::sync::Arc;\npub use std::sync::Condvar;\npub use std::sync::Mutex;\npub use std::thread;\npub use std::time;\n\n#[ cfg (not (fuzzing)) ]\npub use std::collections::HashSet;\n\n#[ cfg (fuzzing) ]\npub use std::collections::BTreeSet as HashSet;\n\n#[ cfg (not (fuzzing)) ]\npub use std::collections::HashMap;\n\n#[ cfg (fuzzing) ]\npub use crate::test_map::HashMap;\n\n#[ cfg (fuzzing) ]\nmod test_map;\n\npub type GenError = Box \u003cdyn Error\u003e;\npub type GenResult \u003cOk\u003e = Result \u003cOk, GenError\u003e;\n\n#[ must_use ]\n#[ inline ]\npub fn default \u003cT: Default\u003e () -\u003e T {\n\tDefault::default ()\n}\n\n#[ macro_export ]\nmacro_rules! ok_or {\n\t( $val:expr, $if_err:expr ) =\u003e {\n\t\tmatch ($val) { Ok (val) =\u003e val, Err (_) =\u003e $if_err }\n\t};\n}\n\n#[ macro_export ]\nmacro_rules! some_or {\n\t( $val:expr, $if_err:expr ) =\u003e {\n\t\tmatch ($val) { Some (val) =\u003e val, None =\u003e $if_err }\n\t};\n}\n\n#[ macro_export ]\nmacro_rules! assert_is_ok {\n\t( $actual:expr ) =\u003e {\n\t\tassert! ($actual.is_ok ());\n\t};\n}\n\n#[ macro_export ]\nmacro_rules! assert_eq_ok {\n\t( $expect:expr , $actual:expr ) =\u003e {\n\t\tlet actual = $actual;\n\t\tassert! (actual.is_ok (), \"Expected Ok but got {:?}\", actual);\n\t\tassert_eq! ($expect, actual.unwrap ());\n\t};\n\t( $expect: expr , $actual:expr , $($rest:tt)* ) =\u003e {\n\t\tlet actual = $actual;\n\t\tassert! (actual.is_ok (), $($rest)*);\n\t\tassert_eq! ($expect, actual.unwrap ());\n\t};\n}\n\n#[ macro_export ]\nmacro_rules! assert_err {\n\t( $expect:expr , $actual:expr ) =\u003e {\n\t\tassert_eq! ($expect, $actual.unwrap_err ().to_string ());\n\t};\n}\n\nmod iter_ext {\n\n\tuse super::*;\n\tuse iter::Copied;\n\n\tpub trait IntoIteratorExt: IntoIterator + Sized {\n\n\t\t#[ inline ]\n\t\tfn iter_vals \u003c'dat, Item\u003e (self) -\u003e Copied \u003cSelf::IntoIter\u003e\n\t\t\twhere\n\t\t\t\tItem: 'dat + Copy,\n\t\t\t\tSelf: IntoIterator \u003cItem = \u0026 'dat Item\u003e {\n\t\t\tself.into_iter ().copied ()\n\t\t}\n\n\t}\n\n\timpl \u003c'dat, IntoIter\u003e IntoIteratorExt for \u0026 'dat IntoIter\n\t\twhere \u0026 'dat IntoIter: IntoIterator {}\n\n\tpub trait IteratorExt: Iterator {\n\n\t\t#[ inline ]\n\t\tfn collect_array \u003cconst DIM: usize\u003e (mut self) -\u003e Option \u003c[Self::Item; DIM]\u003e\n\t\t\t\twhere Self: Sized, Self::Item: Copy + Default {\n\t\t\tlet mut result = [default (); DIM];\n\t\t\tfor idx in 0 .. DIM {\n\t\t\t\tassert! (idx \u003c result.len ());\n\t\t\t\tresult [idx] = some_or! (self.next (), return None);\n\t\t\t}\n\t\t\tif self.next ().is_some () { return None }\n\t\t\tSome (result)\n\t\t}\n\n\t}\n\n\timpl \u003cSomeIter: Iterator\u003e IteratorExt for SomeIter {}\n\n\tpub trait IteratorResultExt \u003cItem, Error\u003e: Iterator \u003cItem = Result \u003cItem, Error\u003e\u003e {\n\n\t\t#[ inline ]\n\t\tfn collect_array_ok \u003cconst DIM: usize\u003e (mut self) -\u003e Result \u003cOption \u003c[Item; DIM]\u003e, Error\u003e\n\t\t\t\twhere Self: Sized, Item: Copy + Default {\n\t\t\tlet mut result = [default (); DIM];\n\t\t\tfor idx in 0 .. DIM {\n\t\t\t\tassert! (idx \u003c result.len ());\n\t\t\t\tresult [idx] = some_or! (self.next (), return Ok (None)) ?;\n\t\t\t}\n\t\t\tif self.next ().is_some () { return Ok (None) }\n\t\t\tOk (Some (result))\n\t\t}\n\n\t}\n\n\timpl \u003cItem, Error, SomeIter: Iterator \u003cItem = Result \u003cItem, Error\u003e\u003e\u003e IteratorResultExt \u003cItem, Error\u003e for SomeIter {}\n\n}\n\n#[ macro_export ]\nmacro_rules! array_vec {\n\t( ) =\u003e { ArrayVec::new () };\n\t( $($vals:expr),+ ) =\u003e {\n\t\t{\n\t\t\tlet mut result = ArrayVec::new ();\n\t\t\tarray_vec! (@push result, $($vals,)*);\n\t\t\tresult\n\t\t}\n\t};\n\t( @push $result:ident $(,)? ) =\u003e {};\n\t( @push $result:ident , $val:expr $(, $rest:expr)* ) =\u003e {\n\t\t$result.push ($val);\n\t\tarray_vec! (@push $result, $($rest),*);\n\t};\n\t( @push $result:ident , $val:expr $(, $rest:expr)* , ) =\u003e {\n\t\t$result.push ($val);\n\t\tarray_vec! (@push $result, $($rest),*);\n\t};\n}\n","traces":[{"line":94,"address":[],"length":0,"stats":{"Line":12},"fn_name":null},{"line":95,"address":[184513],"length":1,"stats":{"Line":12},"fn_name":null},{"line":152,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":165,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":166,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":167,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":168,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":170,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":171,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":183,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":184,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":185,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":186,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":188,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":189,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":2,"coverable":15},{"path":["/","home","runner","work","advent-of-code","advent-of-code","common","misc","test_map.rs"],"content":"use super::*;\n\npub struct HashMap \u003cKey, Val, Hshr = RandomHasher\u003e {\n\tmap: BTreeMap \u003cKey, Val\u003e,\n\tphantom: PhantomData \u003cHshr\u003e,\n}\n\nimpl \u003cKey, Val, Hshr\u003e HashMap \u003cKey, Val, Hshr\u003e\n\twhere Key: Ord {\n\n\tpub fn new () -\u003e Self {\n\t\tSelf {\n\t\t\tmap: BTreeMap::new (),\n\t\t\tphantom: PhantomData,\n\t\t}\n\t}\n\n\tpub fn get \u003cQry\u003e (\u0026 self, key: \u0026 Qry) -\u003e Option \u003c\u0026 Val\u003e\n\t\twhere\n\t\t\tKey: Borrow \u003cQry\u003e,\n\t\t\tQry: Eq + Hash + Ord + ?Sized {\n\t\tself.map.get (key)\n\t}\n\n\tpub fn contains_key \u003cQry\u003e (\u0026 self, key: \u0026 Qry) -\u003e bool\n\t\twhere\n\t\t\tKey: Borrow \u003cQry\u003e,\n\t\t\tQry: Eq + Hash + Ord + ?Sized {\n\t\tself.map.contains_key (key)\n\t}\n\n\tpub fn get_mut \u003cQry\u003e (\u0026 mut self, key: \u0026 Qry) -\u003e Option \u003c\u0026 mut Val\u003e\n\t\twhere\n\t\t\tKey: Borrow \u003cQry\u003e,\n\t\t\tQry: Eq + Hash + Ord + ?Sized {\n\t\tself.map.get_mut (key)\n\t}\n\n\tpub fn entry (\u0026 mut self, key: Key) -\u003e BTreeEntry \u003c'_, Key, Val\u003e {\n\t\tself.map.entry (key)\n\t}\n\n\tpub fn insert (\u0026 mut self, key: Key, val: Val) -\u003e Option \u003cVal\u003e {\n\t\tself.map.insert (key, val)\n\t}\n\n\tpub fn iter (\u0026 self) -\u003e BTreeIter \u003c'_, Key, Val\u003e {\n\t\tself.map.iter ()\n\t}\n\n\tpub fn len (\u0026 self) -\u003e usize {\n\t\tself.map.len ()\n\t}\n\n\tpub fn values (\u0026 self) -\u003e BTreeValues \u003cKey, Val\u003e {\n\t\tself.map.values ()\n\t}\n\n}\n\nimpl \u003cKey, Val\u003e Clone for HashMap \u003cKey, Val\u003e where Key: Clone, Val: Clone {\n\tfn clone (\u0026 self) -\u003e Self {\n\t\tSelf {\n\t\t\tmap: self.map.clone (),\n\t\t\tphantom: PhantomData,\n\t\t}\n\t}\n}\n\nimpl \u003cKey, Val\u003e Debug for HashMap \u003cKey, Val\u003e\n\t\twhere Key: Debug, Val: Debug {\n\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\tself.map.fmt (formatter)\n\t}\n}\n\nimpl \u003cKey, Val\u003e Default for HashMap \u003cKey, Val\u003e {\n\tfn default () -\u003e Self {\n\t\tSelf {\n\t\t\tmap: BTreeMap::default (),\n\t\t\tphantom: PhantomData,\n\t\t}\n\t}\n}\n\nimpl \u003cKey, Val\u003e FromIterator \u003c(Key, Val)\u003e for HashMap \u003cKey, Val\u003e\n\t\twhere Key: Ord {\n\tfn from_iter \u003cIter\u003e (iter: Iter) -\u003e Self\n\t\t\twhere Iter: IntoIterator \u003cItem = (Key, Val)\u003e {\n\t\tSelf {\n\t\t\tmap: BTreeMap::from_iter (iter),\n\t\t\tphantom: PhantomData,\n\t\t}\n\t}\n}\n\nimpl \u003cKey, Val, Qry\u003e Index \u003c\u0026 '_ Qry\u003e for HashMap \u003cKey, Val\u003e\n\twhere\n\t\tKey: Ord + Borrow \u003cQry\u003e,\n\t\tQry: Ord + ?Sized {\n\ttype Output = Val;\n\tfn index (\u0026 self, query: \u0026 Qry) -\u003e \u0026 Val {\n\t\tself.map.get (query).unwrap ()\n\t}\n}\n","traces":[{"line":11,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":13,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":47,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":52,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":80,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":102,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":103,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":24},{"path":["/","home","runner","work","advent-of-code","advent-of-code","common","nums","nums.rs"],"content":"use std::error::Error;\nuse std::fmt::{ self, Debug, Display };\nuse std::hash::Hash;\nuse std::ops::{ Add, BitAnd, BitAndAssign, BitOr, BitOrAssign, Div, Mul, Neg, Rem, Shl, ShlAssign,\n\tShr, ShrAssign, Sub };\n\npub type NumResult \u003cVal\u003e = Result \u003cVal, Overflow\u003e;\n\n#[ derive (Debug, Eq, PartialEq) ]\npub struct Overflow;\n\nimpl Display for Overflow {\n\n\t#[ inline ]\n\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\twrite! (formatter, \"Overflow\") ?;\n\t\tOk (())\n\t}\n\n}\n\nimpl Error for Overflow {\n}\n\npub trait Int: Clone + Copy + Debug + Display + Eq + Hash + Ord + IntOps + IntConv {\n\ttype Signed: IntSigned;\n\ttype Unsigned: IntUnsigned;\n\tconst BITS: u32;\n\tconst ZERO: Self;\n\tconst ONE: Self;\n\tconst MIN: Self;\n\tconst MAX: Self;\n\tfn unsigned_abs (self) -\u003e Self::Unsigned;\n\tfn signum (self) -\u003e Self::Signed;\n\n\t/// Signed difference between two numbers\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented, ie if the difference is too\n\t/// high\n\t///\n\tfn signed_diff (self, other: Self) -\u003e NumResult \u003cSelf::Signed\u003e;\n\n\t/// Unsigned difference between two numbers\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented, ie if the second number is\n\t/// greater than the first\n\t///\n\tfn unsigned_diff (self, other: Self) -\u003e NumResult \u003cSelf::Unsigned\u003e;\n\n\t/// Add a signed number\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\tfn add_signed (self, other: Self::Signed) -\u003e NumResult \u003cSelf\u003e;\n\n\t/// Subtract a signed number\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\tfn sub_signed (self, other: Self::Signed) -\u003e NumResult \u003cSelf\u003e;\n\n\t/// Add two numbers together\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\tfn add_2 (arg_0: Self, arg_1: Self) -\u003e NumResult \u003cSelf\u003e;\n\n\t/// Add three numbers together\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\t#[ inline ]\n\tfn add_3 (arg_0: Self, arg_1: Self, arg_2: Self) -\u003e NumResult \u003cSelf\u003e {\n\t\tSelf::add_2 (Self::add_2 (arg_0, arg_1) ?, arg_2)\n\t}\n\n\t/// Add four numbers together\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\t#[ inline ]\n\tfn add_4 (arg_0: Self, arg_1: Self, arg_2: Self, arg_3: Self) -\u003e NumResult \u003cSelf\u003e {\n\t\tSelf::add_2 (Self::add_3 (arg_0, arg_1, arg_2) ?, arg_3)\n\t}\n\n\t/// Divide one number by another\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\tfn div_2 (arg_0: Self, arg_1: Self) -\u003e NumResult \u003cSelf\u003e;\n\n\t/// Multiply two numbers together\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\tfn mul_2 (arg_0: Self, arg_1: Self) -\u003e NumResult \u003cSelf\u003e;\n\n\t/// Multiply three numbers together\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\t#[ inline ]\n\tfn mul_3 (arg_0: Self, arg_1: Self, arg_2: Self) -\u003e NumResult \u003cSelf\u003e {\n\t\tSelf::mul_2 (Self::mul_2 (arg_0, arg_1) ?, arg_2)\n\t}\n\n\t/// Multiply four numbers together\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\t#[ inline ]\n\tfn mul_4 (arg_0: Self, arg_1: Self, arg_2: Self, arg_3: Self) -\u003e NumResult \u003cSelf\u003e {\n\t\tSelf::mul_2 (Self::mul_3 (arg_0, arg_1, arg_2) ?, arg_3)\n\t}\n\n\t/// Subtract one number from another\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\tfn sub_2 (arg_0: Self, arg_1: Self) -\u003e NumResult \u003cSelf\u003e;\n\n}\n\nmacro_rules! prim_int {\n\t( $signed:ident , $unsigned:ident, $bits:literal ) =\u003e {\n\n\t\timpl Int for $signed {\n\n\t\t\ttype Signed = $signed;\n\t\t\ttype Unsigned = $unsigned;\n\n\t\t\tconst BITS: u32 = $signed::BITS;\n\n\t\t\t#[ allow (clippy::default_numeric_fallback) ]\n\t\t\tconst ZERO: $signed = 0;\n\n\t\t\t#[ allow (clippy::default_numeric_fallback) ]\n\t\t\tconst ONE: $signed = 1;\n\n\t\t\tconst MIN: $signed = $signed::MIN;\n\t\t\tconst MAX: $signed = $signed::MAX;\n\n\t\t\t#[ inline ]\n\t\t\tfn unsigned_abs (self) -\u003e $unsigned { $signed::unsigned_abs (self) }\n\n\t\t\t#[ inline ]\n\t\t\tfn signum (self) -\u003e $signed { $signed::signum (self) }\n\n\t\t\t#[ inline ]\n\t\t\tfn signed_diff (self, other: Self) -\u003e NumResult \u003c$signed\u003e {\n\t\t\t\t$signed::checked_sub (self, other).ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn unsigned_diff (self, other: Self) -\u003e NumResult \u003c$unsigned\u003e {\n\t\t\t\t(other \u003c= self).then (|| $signed::abs_diff (self, other)).ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn add_signed (self, other: $signed) -\u003e NumResult \u003c$signed\u003e {\n\t\t\t\t$signed::checked_add (self, other).ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn sub_signed (self, other: $signed) -\u003e NumResult \u003c$signed\u003e {\n\t\t\t\t$signed::checked_sub (self, other).ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn add_2 (arg_0: $signed, arg_1: $signed) -\u003e NumResult \u003c$signed\u003e {\n\t\t\t\t$signed::checked_add (arg_0, arg_1).ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn div_2 (arg_0: $signed, arg_1: $signed) -\u003e NumResult \u003c$signed\u003e {\n\t\t\t\t$signed::checked_div (arg_0, arg_1).ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn mul_2 (arg_0: $signed, arg_1: $signed) -\u003e NumResult \u003c$signed\u003e {\n\t\t\t\t$signed::checked_mul (arg_0, arg_1).ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn sub_2 (arg_0: $signed, arg_1: $signed) -\u003e NumResult \u003c$signed\u003e {\n\t\t\t\t$signed::checked_sub (arg_0, arg_1).ok_or (Overflow)\n\t\t\t}\n\n\t\t}\n\n\t\timpl Int for $unsigned {\n\n\t\t\ttype Signed = $signed;\n\t\t\ttype Unsigned = $unsigned;\n\n\t\t\tconst BITS: u32 = $signed::BITS;\n\t\t\tconst ZERO: $unsigned = 0;\n\t\t\tconst ONE: $unsigned = 1;\n\t\t\tconst MIN: $unsigned = $unsigned::MIN;\n\t\t\tconst MAX: $unsigned = $unsigned::MAX;\n\n\t\t\t#[ inline ]\n\t\t\tfn unsigned_abs (self) -\u003e $unsigned { self }\n\n\t\t\t#[ inline ]\n\t\t\tfn signum (self) -\u003e $signed {\n\t\t\t\tif self \u003e 0 { Self::Signed::ONE } else { Self::Signed::ZERO }\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn signed_diff (self, other: Self) -\u003e NumResult \u003c$signed\u003e {\n\t\t\t\tif other \u003c self {\n\t\t\t\t\t(self - other).try_into ().ok ().ok_or (Overflow)\n\t\t\t\t} else {\n\t\t\t\t\t(other - self).try_into ().map ($signed::neg).ok ().ok_or (Overflow)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn unsigned_diff (self, other: Self) -\u003e NumResult \u003c$unsigned\u003e {\n\t\t\t\t$unsigned::checked_sub (self, other).ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn add_signed (self, other: $signed) -\u003e NumResult \u003c$unsigned\u003e {\n\t\t\t\tif other \u003e= Self::Signed::ZERO {\n\t\t\t\t\t$unsigned::checked_add (self, $signed::unsigned_abs (other)).ok_or (Overflow)\n\t\t\t\t} else {\n\t\t\t\t\t$unsigned::checked_sub (self, $signed::unsigned_abs (other)).ok_or (Overflow)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn sub_signed (self, other: $signed) -\u003e NumResult \u003c$unsigned\u003e {\n\t\t\t\tif other \u003e= Self::Signed::ZERO {\n\t\t\t\t\t$unsigned::checked_sub (self, $signed::unsigned_abs (other)).ok_or (Overflow)\n\t\t\t\t} else {\n\t\t\t\t\t$unsigned::checked_add (self, $signed::unsigned_abs (other)).ok_or (Overflow)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn add_2 (arg_0: $unsigned, arg_1: $unsigned) -\u003e NumResult \u003c$unsigned\u003e {\n\t\t\t\t$unsigned::checked_add (arg_0, arg_1).ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn div_2 (arg_0: $unsigned, arg_1: $unsigned) -\u003e NumResult \u003c$unsigned\u003e {\n\t\t\t\t$unsigned::checked_div (arg_0, arg_1).ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn mul_2 (arg_0: $unsigned, arg_1: $unsigned) -\u003e NumResult \u003c$unsigned\u003e {\n\t\t\t\t$unsigned::checked_mul (arg_0, arg_1).ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn sub_2 (arg_0: $unsigned, arg_1: $unsigned) -\u003e NumResult \u003c$unsigned\u003e {\n\t\t\t\t$unsigned::checked_sub (arg_0, arg_1).ok_or (Overflow)\n\t\t\t}\n\n\t\t}\n\n\t\timpl IntOpsSafe for $signed {\n\n\t\t\t#[ inline ]\n\t\t\tfn safe_add (self, arg: $signed) -\u003e $signed {\n\t\t\t\t$signed::checked_add (self, arg).unwrap ()\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn safe_sub (self, arg: $signed) -\u003e $signed {\n\t\t\t\t$signed::checked_sub (self, arg).unwrap ()\n\t\t\t}\n\n\t\t}\n\n\t\timpl IntOpsSafe for $unsigned {\n\n\t\t\t#[ inline ]\n\t\t\tfn safe_add (self, arg: $unsigned) -\u003e $unsigned {\n\t\t\t\t$unsigned::checked_add (self, arg).unwrap ()\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn safe_sub (self, arg: $unsigned) -\u003e $unsigned {\n\t\t\t\t$unsigned::checked_sub (self, arg).unwrap ()\n\t\t\t}\n\n\t\t}\n\n\t\timpl IntSigned for $signed {\n\t\t\tconst NEG_ONE: $signed = Self::ZERO - Self::ONE;\n\t\t}\n\n\t\timpl IntUnsigned for $unsigned {}\n\n\t\timpl IntSized \u003c$bits\u003e for $signed {}\n\t\timpl IntSized \u003c$bits\u003e for $unsigned {}\n\n\t\timpl IntConv for $signed {\n\n\t\t\t#[ inline ]\n\t\t\tfn from_usize (val: usize) -\u003e NumResult \u003cSelf\u003e {\n\t\t\t\tval.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_char (self) -\u003e NumResult \u003cchar\u003e {\n\t\t\t\tself.to_u32 () ?.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_i8 (self) -\u003e NumResult \u003ci8\u003e {\n\t\t\t\tself.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_i16 (self) -\u003e NumResult \u003ci16\u003e {\n\t\t\t\tself.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_i32 (self) -\u003e NumResult \u003ci32\u003e {\n\t\t\t\tself.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_i64 (self) -\u003e NumResult \u003ci64\u003e {\n\t\t\t\tself.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_i128 (self) -\u003e NumResult \u003ci128\u003e {\n\t\t\t\tself.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_isize (self) -\u003e NumResult \u003cisize\u003e {\n\t\t\t\tself.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_u8 (self) -\u003e NumResult \u003cu8\u003e {\n\t\t\t\tself.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_u16 (self) -\u003e NumResult \u003cu16\u003e {\n\t\t\t\tself.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_u32 (self) -\u003e NumResult \u003cu32\u003e {\n\t\t\t\tself.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_u64 (self) -\u003e NumResult \u003cu64\u003e {\n\t\t\t\tself.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_u128 (self) -\u003e NumResult \u003cu128\u003e {\n\t\t\t\tself.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_usize (self) -\u003e NumResult \u003cusize\u003e {\n\t\t\t\tself.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t}\n\n\t\timpl IntConv for $unsigned {\n\n\t\t\t#[ inline ]\n\t\t\tfn from_usize (val: usize) -\u003e NumResult \u003cSelf\u003e {\n\t\t\t\tval.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_char (self) -\u003e NumResult \u003cchar\u003e {\n\t\t\t\tself.to_u32 () ?.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_i8 (self) -\u003e NumResult \u003ci8\u003e {\n\t\t\t\tself.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_i16 (self) -\u003e NumResult \u003ci16\u003e {\n\t\t\t\tself.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_i32 (self) -\u003e NumResult \u003ci32\u003e {\n\t\t\t\tself.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_i64 (self) -\u003e NumResult \u003ci64\u003e {\n\t\t\t\tself.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_i128 (self) -\u003e NumResult \u003ci128\u003e {\n\t\t\t\tself.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_isize (self) -\u003e NumResult \u003cisize\u003e {\n\t\t\t\tself.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_u8 (self) -\u003e NumResult \u003cu8\u003e {\n\t\t\t\tself.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_u16 (self) -\u003e NumResult \u003cu16\u003e {\n\t\t\t\tself.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_u32 (self) -\u003e NumResult \u003cu32\u003e {\n\t\t\t\tself.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_u64 (self) -\u003e NumResult \u003cu64\u003e {\n\t\t\t\tself.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_u128 (self) -\u003e NumResult \u003cu128\u003e {\n\t\t\t\tself.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn to_usize (self) -\u003e NumResult \u003cusize\u003e {\n\t\t\t\tself.try_into ().ok ().ok_or (Overflow)\n\t\t\t}\n\n\t\t}\n\n\t};\n\n}\n\nprim_int! (i8, u8, 8);\nprim_int! (i16, u16, 16);\nprim_int! (i32, u32, 32);\nprim_int! (i64, u64, 64);\nprim_int! (i128, u128, 128);\nprim_int! (isize, usize, 128);\n\npub trait IntSigned: Int {\n\tconst NEG_ONE: Self::Signed;\n}\n\npub trait IntUnsigned: Int {}\n\npub trait IntSized \u003cconst BITS: usize\u003e: Int {}\n\npub trait IntOpsRust: Sized + Add \u003cOutput = Self\u003e + BitAnd + BitAndAssign + BitOr + BitOrAssign\n\t+ Div \u003cOutput = Self\u003e + Mul \u003cOutput = Self\u003e + Rem \u003cOutput = Self\u003e + Shl \u003cu32, Output = Self\u003e\n\t+ ShlAssign \u003cu32\u003e + Shr \u003cu32, Output = Self\u003e + ShrAssign \u003cu32\u003e + Sub \u003cOutput = Self\u003e {}\nimpl \u003cVal\u003e IntOpsRust for Val where Val: Sized + Add \u003cOutput = Self\u003e + BitAnd + BitAndAssign\n\t+ BitOr + BitOrAssign + Div \u003cOutput = Self\u003e + Mul \u003cOutput = Self\u003e + Rem \u003cOutput = Self\u003e\n\t+ Shl \u003cu32, Output = Self\u003e + ShlAssign \u003cu32\u003e + Shr \u003cu32, Output = Self\u003e + ShrAssign \u003cu32\u003e\n\t+ Sub \u003cOutput = Self\u003e {}\n\npub trait IntOpsSafe: Sized {\n\n\t#[ must_use ]\n\tfn safe_add (self, arg: Self) -\u003e Self;\n\n\t#[ must_use ]\n\tfn safe_sub (self, arg: Self) -\u003e Self;\n\n}\n\npub trait IntOps: IntOpsRust + IntOpsSafe {}\nimpl \u003cVal\u003e IntOps for Val where Val: IntOpsRust + IntOpsSafe {}\n\npub trait IntConv: Sized {\n\n\t#[ allow (clippy::wrong_self_convention) ]\n\t#[ inline ]\n\tfn as_f32 (self) -\u003e f32 { self.to_f32 ().unwrap () }\n\n\t#[ allow (clippy::wrong_self_convention) ]\n\t#[ inline ]\n\tfn as_f64 (self) -\u003e f64 { self.to_f64 ().unwrap () }\n\n\t#[ allow (clippy::wrong_self_convention) ]\n\t#[ inline ]\n\tfn as_i8 (self) -\u003e i8 { self.to_i8 ().unwrap () }\n\n\t#[ allow (clippy::wrong_self_convention) ]\n\t#[ inline ]\n\tfn as_i16 (self) -\u003e i16 { self.to_i16 ().unwrap () }\n\n\t#[ allow (clippy::wrong_self_convention) ]\n\t#[ inline ]\n\tfn as_i32 (self) -\u003e i32 { self.to_i32 ().unwrap () }\n\n\t#[ allow (clippy::wrong_self_convention) ]\n\t#[ inline ]\n\tfn as_i64 (self) -\u003e i64 { self.to_i64 ().unwrap () }\n\n\t#[ allow (clippy::wrong_self_convention) ]\n\t#[ inline ]\n\tfn as_i128 (self) -\u003e i128 { self.to_i128 ().unwrap () }\n\n\t#[ allow (clippy::wrong_self_convention) ]\n\t#[ inline ]\n\tfn as_isize (self) -\u003e isize { self.to_isize ().unwrap () }\n\n\t#[ allow (clippy::wrong_self_convention) ]\n\t#[ inline ]\n\tfn as_u8 (self) -\u003e u8 { self.to_u8 ().unwrap () }\n\n\t#[ allow (clippy::wrong_self_convention) ]\n\t#[ inline ]\n\tfn as_u16 (self) -\u003e u16 { self.to_u16 ().unwrap () }\n\n\t#[ allow (clippy::wrong_self_convention) ]\n\t#[ inline ]\n\tfn as_u32 (self) -\u003e u32 { self.to_u32 ().unwrap () }\n\n\t#[ allow (clippy::wrong_self_convention) ]\n\t#[ inline ]\n\tfn as_u64 (self) -\u003e u64 { self.to_u64 ().unwrap () }\n\n\t#[ allow (clippy::wrong_self_convention) ]\n\t#[ inline ]\n\tfn as_u128 (self) -\u003e u128 { self.to_u128 ().unwrap () }\n\n\t#[ allow (clippy::wrong_self_convention) ]\n\t#[ inline ]\n\tfn as_usize (self) -\u003e usize { self.to_usize ().unwrap () }\n\n\t#[ allow (clippy::wrong_self_convention) ]\n\t#[ inline ]\n\tfn as_char (self) -\u003e char { self.to_char ().unwrap () }\n\n\t/// Safely convert from [`usize`]\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\tfn from_usize (val: usize) -\u003e NumResult \u003cSelf\u003e;\n\n\t/// Safely convert to [`f32`]\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\t#[ inline ]\n\tfn to_f32 (self) -\u003e NumResult \u003cf32\u003e { self.to_u16 ().map (Into::into) }\n\n\t/// Safely convert to [`f64`]\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\t#[ inline ]\n\tfn to_f64 (self) -\u003e NumResult \u003cf64\u003e { self.to_u32 ().map (Into::into) }\n\n\t/// Safely convert to [`i8`]\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\tfn to_i8 (self) -\u003e NumResult \u003ci8\u003e;\n\n\t/// Safely convert to [`i16`]\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\tfn to_i16 (self) -\u003e NumResult \u003ci16\u003e;\n\n\t/// Safely convert to [`i32`]\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\tfn to_i32 (self) -\u003e NumResult \u003ci32\u003e;\n\n\t/// Safely convert to [`i64`]\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\tfn to_i64 (self) -\u003e NumResult \u003ci64\u003e;\n\n\t/// Safely convert to [`i128`]\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\tfn to_i128 (self) -\u003e NumResult \u003ci128\u003e;\n\n\t/// Safely convert to [`isize`]\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\tfn to_isize (self) -\u003e NumResult \u003cisize\u003e;\n\n\t/// Safely convert to [`u8`]\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\tfn to_u8 (self) -\u003e NumResult \u003cu8\u003e;\n\n\t/// Safely convert to [`u16`]\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\tfn to_u16 (self) -\u003e NumResult \u003cu16\u003e;\n\n\t/// Safely convert to [`u32`]\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\tfn to_u32 (self) -\u003e NumResult \u003cu32\u003e;\n\n\t/// Safely convert to [`u64`]\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\tfn to_u64 (self) -\u003e NumResult \u003cu64\u003e;\n\n\t/// Safely convert to [`u128`]\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\tfn to_u128 (self) -\u003e NumResult \u003cu128\u003e;\n\n\t/// Safely convert to [`usize`]\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (Overflow)` if the result can't be represented\n\t///\n\tfn to_usize (self) -\u003e NumResult \u003cusize\u003e;\n\n\tfn to_char (self) -\u003e NumResult \u003cchar\u003e;\n\n}\n\nimpl IntConv for char {\n\n\t#[ inline ]\n\tfn from_usize (val: usize) -\u003e NumResult \u003cSelf\u003e {\n\t\tval.to_u32 () ?.try_into ().map_err (|_err| Overflow)\n\t}\n\n\t#[ inline ]\n\tfn to_char (self) -\u003e NumResult \u003cchar\u003e {\n\t\tOk (self)\n\t}\n\n\t#[ inline ]\n\tfn to_i8 (self) -\u003e NumResult \u003ci8\u003e {\n\t\tself.to_u32 () ?.try_into ().map_err (|_err| Overflow)\n\t}\n\n\t#[ inline ]\n\tfn to_i16 (self) -\u003e NumResult \u003ci16\u003e {\n\t\tself.to_u32 () ?.try_into ().map_err (|_err| Overflow)\n\t}\n\n\t#[ inline ]\n\tfn to_i32 (self) -\u003e NumResult \u003ci32\u003e {\n\t\tself.to_u32 () ?.try_into ().map_err (|_err| Overflow)\n\t}\n\n\t#[ inline ]\n\tfn to_i64 (self) -\u003e NumResult \u003ci64\u003e {\n\t\tself.to_u32 () ?.try_into ().map_err (|_err| Overflow)\n\t}\n\n\t#[ inline ]\n\tfn to_i128 (self) -\u003e NumResult \u003ci128\u003e {\n\t\tself.to_u32 () ?.try_into ().map_err (|_err| Overflow)\n\t}\n\n\t#[ inline ]\n\tfn to_isize (self) -\u003e NumResult \u003cisize\u003e {\n\t\tself.to_u32 () ?.try_into ().map_err (|_err| Overflow)\n\t}\n\n\t#[ inline ]\n\tfn to_u8 (self) -\u003e NumResult \u003cu8\u003e {\n\t\tself.to_u32 () ?.try_into ().map_err (|_err| Overflow)\n\t}\n\n\t#[ inline ]\n\tfn to_u16 (self) -\u003e NumResult \u003cu16\u003e {\n\t\tself.to_u32 () ?.try_into ().map_err (|_err| Overflow)\n\t}\n\n\t#[ inline ]\n\tfn to_u32 (self) -\u003e NumResult \u003cu32\u003e {\n\t\tself.try_into ().map_err (|_err| Overflow)\n\t}\n\n\t#[ inline ]\n\tfn to_u64 (self) -\u003e NumResult \u003cu64\u003e {\n\t\tself.to_u32 () ?.try_into ().map_err (|_err| Overflow)\n\t}\n\n\t#[ inline ]\n\tfn to_u128 (self) -\u003e NumResult \u003cu128\u003e {\n\t\tself.to_u32 () ?.try_into ().map_err (|_err| Overflow)\n\t}\n\n\t#[ inline ]\n\tfn to_usize (self) -\u003e NumResult \u003cusize\u003e {\n\t\tself.to_u32 () ?.try_into ().map_err (|_err| Overflow)\n\t}\n\n}\n","traces":[{"line":15,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":16,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":17,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":85,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":86,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":123,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":124,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":134,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":135,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":168,"address":[81961,87136,77253,71625,93616,93625,66392,87150,71616,81952,77248,66384],"length":1,"stats":{"Line":0},"fn_name":"unsigned_abs"},{"line":171,"address":[82070,77280,81984,71648,66416,87184,87343,93648,93734,77356,71731,66488],"length":1,"stats":{"Line":0},"fn_name":"signum"},{"line":174,"address":[71744,66496,82080,87360,93744,77376],"length":1,"stats":{"Line":0},"fn_name":"signed_diff"},{"line":175,"address":[66511,77388,71764,87384,82094,93758],"length":1,"stats":{"Line":0},"fn_name":null},{"line":179,"address":[77440,87472,66576,93824,82160,71840],"length":1,"stats":{"Line":0},"fn_name":"unsigned_diff"},{"line":180,"address":[29390,29552,29600,29518,29454,29504,29440,29680,29376,29624,29566,29694],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":184,"address":[66704,71984,87648,77552,82288,93952],"length":1,"stats":{"Line":4},"fn_name":"add_signed"},{"line":185,"address":[72004,66719,87672,93966,77564,82302],"length":1,"stats":{"Line":4},"fn_name":null},{"line":189,"address":[77616,82368,94032,66784,87760,72080],"length":1,"stats":{"Line":1},"fn_name":"sub_signed"},{"line":190,"address":[87784,94046,72100,66799,77628,82382],"length":1,"stats":{"Line":1},"fn_name":null},{"line":194,"address":[94112,72176,66864,87872,77680,82448],"length":1,"stats":{"Line":2},"fn_name":"add_2"},{"line":195,"address":[72196,77692,66879,87896,94126,82462],"length":1,"stats":{"Line":2},"fn_name":null},{"line":199,"address":[94192,72272,77744,66944,82528,87984],"length":1,"stats":{"Line":0},"fn_name":"div_2"},{"line":200,"address":[94206,82542,88008,66959,77756,72292],"length":1,"stats":{"Line":0},"fn_name":null},{"line":204,"address":[88096,94272,72368,77808,67024,82608],"length":1,"stats":{"Line":0},"fn_name":"mul_2"},{"line":205,"address":[67039,77820,82622,94286,88120,72388],"length":1,"stats":{"Line":0},"fn_name":null},{"line":209,"address":[67104,72464,82688,88208,77872,94352],"length":1,"stats":{"Line":2},"fn_name":"sub_2"},{"line":210,"address":[88232,77884,94366,82702,67119,72484],"length":1,"stats":{"Line":2},"fn_name":null},{"line":227,"address":[82776,88320,94440,82768,88339,67194,94432,72560,77945,72571,77936,67184],"length":1,"stats":{"Line":0},"fn_name":"unsigned_abs"},{"line":230,"address":[82784,94448,67200,72576,77952,88352],"length":1,"stats":{"Line":0},"fn_name":"signum"},{"line":231,"address":[67211,82793,88366,77957,94457,72588],"length":1,"stats":{"Line":0},"fn_name":null},{"line":235,"address":[77984,88432,72624,94496,82832,67248],"length":1,"stats":{"Line":0},"fn_name":"signed_diff"},{"line":236,"address":[94529,72654,78004,67274,82865,88503],"length":1,"stats":{"Line":0},"fn_name":null},{"line":237,"address":[82914,67316,78043,72703,88615,94578],"length":1,"stats":{"Line":0},"fn_name":null},{"line":239,"address":[94724,67458,67286,72669,82880,83060,78164,88545,88839,78016,94544,72855],"length":1,"stats":{"Line":0},"fn_name":null},{"line":244,"address":[94864,73008,78272,83200,67616,89024],"length":1,"stats":{"Line":0},"fn_name":"unsigned_diff"},{"line":245,"address":[78284,83214,94878,73028,67631,89048],"length":1,"stats":{"Line":0},"fn_name":null},{"line":249,"address":[67696,89136,83280,94944,73104,78336],"length":1,"stats":{"Line":3},"fn_name":"add_signed"},{"line":250,"address":[67722,78356,83304,89195,73134,94968],"length":1,"stats":{"Line":3},"fn_name":null},{"line":251,"address":[67748,78380,94996,83332,73165,89242],"length":1,"stats":{"Line":3},"fn_name":null},{"line":253,"address":[94979,95081,78452,67838,73265,89381,78365,73145,67730,83315,83417,89212],"length":1,"stats":{"Line":6},"fn_name":null},{"line":258,"address":[78496,83472,73328,95136,67904,89440],"length":1,"stats":{"Line":0},"fn_name":"sub_signed"},{"line":259,"address":[89499,95160,73358,67930,78516,83496],"length":1,"stats":{"Line":0},"fn_name":null},{"line":260,"address":[83524,73389,78540,67956,89546,95188],"length":1,"stats":{"Line":0},"fn_name":null},{"line":262,"address":[89516,95171,95273,83609,78525,73369,89685,68046,67938,83507,73489,78612],"length":1,"stats":{"Line":0},"fn_name":null},{"line":267,"address":[95328,73552,68112,78656,83664,89744],"length":1,"stats":{"Line":11},"fn_name":"add_2"},{"line":268,"address":[78668,89768,95342,73572,68127,83678],"length":1,"stats":{"Line":11},"fn_name":null},{"line":272,"address":[68192,73648,78720,83744,89856,95408],"length":1,"stats":{"Line":4},"fn_name":"div_2"},{"line":273,"address":[68207,73668,83758,89880,95422,78732],"length":1,"stats":{"Line":4},"fn_name":null},{"line":277,"address":[68272,78784,89968,73744,95488,83824],"length":1,"stats":{"Line":12},"fn_name":"mul_2"},{"line":278,"address":[78796,73764,83838,89992,68287,95502],"length":1,"stats":{"Line":12},"fn_name":null},{"line":282,"address":[68352,90080,95568,83904,78848,73840],"length":1,"stats":{"Line":3},"fn_name":"sub_2"},{"line":283,"address":[95582,90104,73860,83918,68367,78860],"length":1,"stats":{"Line":3},"fn_name":null},{"line":291,"address":[95648,83984,73936,68432,78912,90192],"length":1,"stats":{"Line":1},"fn_name":"safe_add"},{"line":292,"address":[78924,73956,95662,83998,90216,68447],"length":1,"stats":{"Line":1},"fn_name":null},{"line":296,"address":[95712,74032,78976,90288,68512,84048],"length":1,"stats":{"Line":1},"fn_name":"safe_sub"},{"line":297,"address":[68527,74052,78988,84062,90312,95726],"length":1,"stats":{"Line":1},"fn_name":null},{"line":305,"address":[68592,84112,90384,95776,74128,79040],"length":1,"stats":{"Line":0},"fn_name":"safe_add"},{"line":306,"address":[84126,90408,79052,95790,74148,68607],"length":1,"stats":{"Line":0},"fn_name":null},{"line":310,"address":[68672,79104,90480,84176,95840,74224],"length":1,"stats":{"Line":0},"fn_name":"safe_sub"},{"line":311,"address":[90504,84190,74244,68687,95854,79116],"length":1,"stats":{"Line":0},"fn_name":null},{"line":328,"address":[79168,90576,95904,68752,74320,84240],"length":1,"stats":{"Line":1},"fn_name":"from_usize"},{"line":329,"address":[79177,90585,84249,95913,74329,68761],"length":1,"stats":{"Line":1},"fn_name":null},{"line":333,"address":[96000,90704,79248,68864,74432,84336],"length":1,"stats":{"Line":0},"fn_name":"to_char"},{"line":334,"address":[79256,96009,68875,74544,68975,84442,74444,90718,90815,84345,96106,79353],"length":1,"stats":{"Line":0},"fn_name":null},{"line":338,"address":[79392,69008,90848,84480,96144,74576],"length":1,"stats":{"Line":0},"fn_name":"to_i8"},{"line":339,"address":[84489,96153,69016,90862,74585,79400],"length":1,"stats":{"Line":0},"fn_name":null},{"line":343,"address":[90960,96256,84592,74672,69104,79488],"length":1,"stats":{"Line":0},"fn_name":"to_i16"},{"line":344,"address":[90974,74684,79496,96265,84601,69115],"length":1,"stats":{"Line":0},"fn_name":null},{"line":348,"address":[91072,69200,79600,84704,96368,74768],"length":1,"stats":{"Line":0},"fn_name":"to_i32"},{"line":349,"address":[79608,69211,74780,84713,91086,96377],"length":1,"stats":{"Line":0},"fn_name":null},{"line":353,"address":[91152,79680,84784,96448,69280,74848],"length":1,"stats":{"Line":0},"fn_name":"to_i64"},{"line":354,"address":[96457,79688,69291,74860,84793,91166],"length":1,"stats":{"Line":0},"fn_name":null},{"line":358,"address":[69376,79760,96544,74944,84864,91248],"length":1,"stats":{"Line":0},"fn_name":"to_i128"},{"line":359,"address":[91262,79768,69387,74956,96553,84873],"length":1,"stats":{"Line":0},"fn_name":null},{"line":363,"address":[84976,75072,96672,69488,79872,91376],"length":1,"stats":{"Line":0},"fn_name":"to_isize"},{"line":364,"address":[75084,91390,96681,79880,69499,84985],"length":1,"stats":{"Line":0},"fn_name":null},{"line":368,"address":[75168,96752,91472,85072,79968,69584],"length":1,"stats":{"Line":0},"fn_name":"to_u8"},{"line":369,"address":[91486,85081,96761,69592,75177,79976],"length":1,"stats":{"Line":0},"fn_name":null},{"line":373,"address":[69680,91584,75264,85184,96864,80064],"length":1,"stats":{"Line":0},"fn_name":"to_u16"},{"line":374,"address":[96873,85193,69691,75276,80072,91598],"length":1,"stats":{"Line":0},"fn_name":null},{"line":378,"address":[69792,80176,85296,91696,96976,75376],"length":1,"stats":{"Line":0},"fn_name":"to_u32"},{"line":379,"address":[85305,69803,91710,75388,96985,80184],"length":1,"stats":{"Line":0},"fn_name":null},{"line":383,"address":[80256,69888,91776,75472,85376,97056],"length":1,"stats":{"Line":0},"fn_name":"to_u64"},{"line":384,"address":[97065,69899,75484,91790,80264,85385],"length":1,"stats":{"Line":0},"fn_name":null},{"line":388,"address":[85472,80352,75568,69984,91872,97152],"length":1,"stats":{"Line":0},"fn_name":"to_u128"},{"line":389,"address":[69995,85481,75580,80360,91886,97161],"length":1,"stats":{"Line":0},"fn_name":null},{"line":393,"address":[92000,97280,80480,75696,70112,85600],"length":1,"stats":{"Line":3},"fn_name":"to_usize"},{"line":394,"address":[70123,80488,92014,75708,85609,97289],"length":1,"stats":{"Line":3},"fn_name":null},{"line":402,"address":[70208,85696,97376,92096,80576,75792],"length":1,"stats":{"Line":7},"fn_name":"from_usize"},{"line":403,"address":[80585,97385,92105,75801,85705,70217],"length":1,"stats":{"Line":7},"fn_name":null},{"line":407,"address":[92224,85792,80656,75904,97456,70320],"length":1,"stats":{"Line":0},"fn_name":"to_char"},{"line":408,"address":[92335,80761,80664,70331,76016,85801,97562,92238,97465,85898,70431,75916],"length":1,"stats":{"Line":0},"fn_name":null},{"line":412,"address":[76048,70464,92368,97600,85936,80800],"length":1,"stats":{"Line":0},"fn_name":"to_i8"},{"line":413,"address":[70472,85945,97609,92382,80808,76057],"length":1,"stats":{"Line":0},"fn_name":null},{"line":417,"address":[86048,92480,80896,70560,76144,97712],"length":1,"stats":{"Line":0},"fn_name":"to_i16"},{"line":418,"address":[97721,70571,76156,80904,86057,92494],"length":1,"stats":{"Line":0},"fn_name":null},{"line":422,"address":[86160,81008,97824,92592,76256,70656],"length":1,"stats":{"Line":0},"fn_name":"to_i32"},{"line":423,"address":[70667,76268,86169,81016,92606,97833],"length":1,"stats":{"Line":0},"fn_name":null},{"line":427,"address":[81088,86240,92672,76336,97904,70736],"length":1,"stats":{"Line":0},"fn_name":"to_i64"},{"line":428,"address":[76348,92686,97913,70747,86249,81096],"length":1,"stats":{"Line":0},"fn_name":null},{"line":432,"address":[86336,76432,92768,70832,98000,81168],"length":1,"stats":{"Line":0},"fn_name":"to_i128"},{"line":433,"address":[70843,76444,98009,81176,86345,92782],"length":1,"stats":{"Line":0},"fn_name":null},{"line":437,"address":[86448,92896,98128,70944,76560,81280],"length":1,"stats":{"Line":0},"fn_name":"to_isize"},{"line":438,"address":[70955,86457,81288,98137,76572,92910],"length":1,"stats":{"Line":0},"fn_name":null},{"line":442,"address":[71040,92992,98224,81376,86544,76656],"length":1,"stats":{"Line":0},"fn_name":"to_u8"},{"line":443,"address":[81384,93006,71048,86553,76665,98233],"length":1,"stats":{"Line":0},"fn_name":null},{"line":447,"address":[86656,93104,98336,81472,71136,76752],"length":1,"stats":{"Line":0},"fn_name":"to_u16"},{"line":448,"address":[71147,93118,86665,98345,81480,76764],"length":1,"stats":{"Line":0},"fn_name":null},{"line":452,"address":[93216,76848,71232,86768,81584,98448],"length":1,"stats":{"Line":2},"fn_name":"to_u32"},{"line":453,"address":[81592,71243,93230,98457,86777,76860],"length":1,"stats":{"Line":2},"fn_name":null},{"line":457,"address":[98528,76928,86848,71312,93296,81664],"length":1,"stats":{"Line":1},"fn_name":"to_u64"},{"line":458,"address":[93310,86857,98537,71323,76940,81672],"length":1,"stats":{"Line":1},"fn_name":null},{"line":462,"address":[77024,81744,71408,86928,98624,93392],"length":1,"stats":{"Line":0},"fn_name":"to_u128"},{"line":463,"address":[77036,71419,93406,86937,81752,98633],"length":1,"stats":{"Line":0},"fn_name":null},{"line":467,"address":[98752,93520,81856,71520,77152,87040],"length":1,"stats":{"Line":9},"fn_name":"to_usize"},{"line":468,"address":[98761,77164,93534,81864,87049,71531],"length":1,"stats":{"Line":9},"fn_name":null},{"line":517,"address":[13248,14028,13536,13961,14016,13392,13168,13833,13544,13256,13312,13952,13456,13897,13182,13467,13769,13824,13323,13600,13692,13400,13680,13614,13760,13888],"length":1,"stats":{"Line":0},"fn_name":"as_f32\u003ci128\u003e"},{"line":521,"address":[14800,14640,14496,14649,14430,14808,14096,14348,14731,14416,14105,14336,14944,14256,14953,14505,14720,15024,14576,14584,14176,14864,14188,15032,14270,14875],"length":1,"stats":{"Line":0},"fn_name":"as_f64\u003cusize\u003e"},{"line":525,"address":[15301,15216,15577,15096,15760,15161,15230,15152,15440,15632,15568,15088,15696,15509,15705,15768,15637,15888,15897,15360,15504,15824,15296,15449,15833,15374],"length":1,"stats":{"Line":0},"fn_name":"as_i8\u003cu8\u003e"},{"line":529,"address":[16494,16729,16016,16256,16184,16640,16800,16030,16176,16560,16569,16649,16720,16096,16888,15960,16880,16480,16344,16809,16265,16408,15952,16336,16400,16105],"length":1,"stats":{"Line":0},"fn_name":"as_i16\u003cu8\u003e"},{"line":533,"address":[16960,17228,17289,17408,17416,17550,17728,17608,17664,17344,17600,16971,17088,17163,17097,17152,17032,17353,17216,17280,17472,17536,17742,17481,17024,17676],"length":1,"stats":{"Line":0},"fn_name":"as_i32\u003ci8\u003e"},{"line":537,"address":[18336,18464,17865,17806,18344,18048,18216,17993,18475,18272,18608,17792,17856,18400,17929,18544,18059,18414,18553,18128,17920,18280,18620,18140,18208,17984],"length":1,"stats":{"Line":0},"fn_name":"as_i64\u003ci128\u003e"},{"line":541,"address":[19720,19806,18688,19248,18784,19083,19072,19344,19176,19424,18793,19616,19712,18987,19352,18880,18700,19168,19260,19520,19792,18889,18976,19433,19529,19630],"length":1,"stats":{"Line":0},"fn_name":"as_i128\u003cu16\u003e"},{"line":545,"address":[20473,20528,20601,19896,20027,20670,20720,20729,20270,20536,19961,20256,20176,20320,20188,20592,20656,20331,19888,19952,20016,20108,20400,20096,20408,20464],"length":1,"stats":{"Line":0},"fn_name":"as_isize\u003cu32\u003e"},{"line":549,"address":[21120,21262,20992,21529,20798,21125,21184,21465,20784,20873,21065,20864,20937,21392,21397,20928,21328,21192,21456,21520,21056,21592,20997,21248,21337,21584],"length":1,"stats":{"Line":0},"fn_name":"as_u8\u003cu128\u003e"},{"line":553,"address":[21720,22032,21792,22192,22206,22281,21952,22432,22520,22121,22576,22441,22361,21872,22512,22584,22352,21712,21648,21800,21966,22272,22041,21656,22112,21881],"length":1,"stats":{"Line":0},"fn_name":"as_u16\u003cu8\u003e"},{"line":557,"address":[23113,22912,23104,22856,23168,23296,23240,22731,22985,22668,23374,23424,22923,22976,23232,23182,22656,23305,22792,23049,23360,23436,22720,22784,23040,22848],"length":1,"stats":{"Line":0},"fn_name":"as_u32\u003ci16\u003e"},{"line":561,"address":[24316,24172,24248,23912,23552,23849,23696,23760,23840,23646,24032,24041,23904,24096,24104,24304,23488,24160,23632,23497,23968,23705,23982,24240,23771,23563],"length":1,"stats":{"Line":0},"fn_name":"as_u64\u003ci64\u003e"},{"line":565,"address":[24384,24489,25136,25488,25040,24776,25408,24672,25052,24857,24395,24944,25232,24686,25328,24768,25145,24848,24576,24955,25241,25336,24480,25416,24588,25502],"length":1,"stats":{"Line":0},"fn_name":"as_u128\u003cu8\u003e"},{"line":569,"address":[26412,25728,25984,25584,26064,25792,26192,25856,25664,25929,26073,26128,25595,25800,26280,26336,25742,26344,25673,25995,26142,26272,26400,25920,25865,26204],"length":1,"stats":{"Line":0},"fn_name":"as_usize\u003cu8\u003e"},{"line":573,"address":[27160,27036,26544,26651,26704,26764,26601,26864,26491,27102,26712,26552,26480,26825,26640,26752,26592,26816,26873,26912,26921,27152,27088,26960,26974,27024],"length":1,"stats":{"Line":0},"fn_name":"as_char\u003ci8\u003e"},{"line":590,"address":[27280,27680,27291,27768,28160,28168,27851,27694,27214,27600,27520,27532,27760,27369,27920,27932,27840,28009,28089,27448,27200,27609,27360,28000,27440,28080],"length":1,"stats":{"Line":0},"fn_name":"to_f32\u003cu128\u003e"},{"line":599,"address":[28316,28940,28656,29022,28800,29088,28720,28384,28731,28864,28240,28872,29102,28304,29008,28512,28601,28928,28809,28665,28523,28448,28457,28392,28248,28592],"length":1,"stats":{"Line":0},"fn_name":"to_f64\u003cchar\u003e"},{"line":704,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":705,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":709,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":710,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":714,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":715,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":719,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":720,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":724,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":725,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":729,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":730,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":734,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":735,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":739,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":740,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":744,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":745,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":749,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":750,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":754,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":755,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":759,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":760,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":764,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":765,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":769,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":770,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":39,"coverable":163},{"path":["/","home","runner","work","advent-of-code","advent-of-code","common","ocr","ocr.rs"],"content":"use std::fmt::{ self, Display };\n\nuse aoc_misc::*;\nuse aoc_nums as nums;\nuse nums::Int;\n\npub struct DrawDots \u003cVal, Iter\u003e (pub Iter)\n\twhere\n\t\tVal: Int,\n\t\tIter: Iterator \u003cItem = (Val, Val)\u003e + Clone;\n\nimpl \u003cVal, Iter\u003e Display for DrawDots \u003cVal, Iter\u003e\n\twhere\n\t\tIter: Iterator \u003cItem = (Val, Val)\u003e + Clone,\n\t\tVal: Int {\n\n\t#[ inline ]\n\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\tlet dots = {\n\t\t\tlet mut dots_temp: Vec \u003c(usize, usize)\u003e =\n\t\t\t\tself.0.clone ()\n\t\t\t\t\t.map (|(row, col)| (row.as_usize (), col.as_usize ()))\n\t\t\t\t\t.collect ();\n\t\t\tdots_temp.sort_by_key (|\u0026 (row, col)| (row, col));\n\t\t\tdots_temp\n\t\t};\n\t\tSelf::display_fmt_real (dots, formatter)\n\t}\n\n}\n\nimpl \u003cVal, Iter\u003e DrawDots \u003cVal, Iter\u003e\n\twhere\n\t\tIter: Iterator \u003cItem = (Val, Val)\u003e + Clone,\n\t\tVal: Int {\n\n\tfn display_fmt_real (dots: Vec \u003c(usize, usize)\u003e, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\tlet mut first_row = true;\n\t\tlet mut first_col = true;\n\t\tlet mut row = 0;\n\t\tlet mut col = 0;\n\t\tfor (dot_row, dot_col) in dots {\n\t\t\twhile first_row || row \u003c dot_row {\n\t\t\t\twrite! (formatter, \"\\n\") ?;\n\t\t\t\tcol = 0;\n\t\t\t\tif ! first_row { row += 1; }\n\t\t\t\tfirst_row = false;\n\t\t\t\tfirst_col = true;\n\t\t\t}\n\t\t\twhile first_col || col \u003c dot_col {\n\t\t\t\twrite! (formatter, \"  \") ?;\n\t\t\t\tif ! first_col { col += 1; }\n\t\t\t\tfirst_col = false;\n\t\t\t}\n\t\t\twrite! (formatter, \"##\") ?;\n\t\t\tcol += 1;\n\t\t\tfirst_col = false;\n\t\t}\n\t\twrite! (formatter, \"\\n\\n\") ?;\n\t\tOk (())\n\t}\n\n}\n\n#[ allow (clippy::missing_inline_in_public_items) ]\npub fn read_dots \u003cVal: Int\u003e (dots: \u0026 dyn Fn (Val, Val) -\u003e bool) -\u003e GenResult \u003cString\u003e {\n\tlet mut result = String::new ();\n\tfor offset in (0 .. ).step_by (5) {\n\t\tlet mut encoded: u32 = 0;\n\t\tfor row in 0 .. 6 {\n\t\t\tfor col in 0 .. 5 {\n\t\t\t\tencoded \u003c\u003c= 1_i32;\n\t\t\t\tif dots (Val::from_usize (row) ?, Val::from_usize (offset + col) ?) {\n\t\t\t\t\tencoded |= 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tresult.push (match encoded {\n\t\t\t0x_1929_7a52 =\u003e 'A',\n\t\t\t0x_392e_4a5c =\u003e 'B',\n\t\t\t0x_1928_424c =\u003e 'C',\n\t\t\t// unknown =\u003e 'D',\n\t\t\t0x_3d0e_421e =\u003e 'E',\n\t\t\t0x_3d0e_4210 =\u003e 'F',\n\t\t\t0x_1928_5a4e =\u003e 'G',\n\t\t\t0x_252f_4a52 =\u003e 'H',\n\t\t\t// unknown =\u003e 'I',\n\t\t\t0x_0c21_0a4c =\u003e 'J',\n\t\t\t0x_254c_5292 =\u003e 'K',\n\t\t\t0x_2108_421e =\u003e 'L',\n\t\t\t// unknown =\u003e 'M',\n\t\t\t// unknown =\u003e 'N',\n\t\t\t0x_1929_4a4c =\u003e 'O',\n\t\t\t0x_3929_7210 =\u003e 'P',\n\t\t\t// unknown =\u003e 'Q',\n\t\t\t0x_3929_7292 =\u003e 'R',\n\t\t\t// unknown =\u003e 'S',\n\t\t\t// unknown =\u003e 'T',\n\t\t\t0x_2529_4a4c =\u003e 'U',\n\t\t\t// unknown =\u003e 'V',\n\t\t\t// unknown =\u003e 'W',\n\t\t\t// unknown =\u003e 'X',\n\t\t\t// unknown =\u003e 'Y',\n\t\t\t0x_3c22_221e =\u003e 'Z',\n\t\t\t0x_0000_0000 =\u003e break,\n\t\t\t_ =\u003e Err (format! (\"Unrecognised character: {:#08x} in position {}\", encoded,\n\t\t\t\tresult.len () + 1)) ?,\n\t\t});\n\t}\n\tOk (result)\n}\n","traces":[{"line":18,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":19,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":20,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":24,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":25,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":27,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":45,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":46,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":47,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":50,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":52,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":57,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":59,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":74,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":80,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":81,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":83,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":85,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":86,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":89,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":93,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":99,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":107,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":110,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":12,"coverable":58},{"path":["/","home","runner","work","advent-of-code","advent-of-code","common","pos","pos.rs"],"content":"use std::fmt::{ self, Debug };\nuse std::ops::{ Add, Neg, Rem, Sub };\n\nuse aoc_misc::*;\nuse aoc_nums as nums;\nuse nums::Int;\nuse nums::IntSigned;\nuse nums::NumResult;\n\npub use coord::Coord;\npub use dim_2::Dir2d;\npub use dim_2::DirGeo;\npub use dim_2::PosXY;\npub use dim_2::PosYX;\npub use dim_2::PosGeo;\npub use dim_2::PosRowCol;\npub use dim_2::Turn2d;\npub use dim_3::PosXYZ;\n\nmacro_rules! pos_ops {\n\n\t( $name:ident : Debug $(, $rest:tt)* ) =\u003e {\n\t\timpl \u003cVal: Int\u003e Debug for $name \u003cVal\u003e {\n\t\t\t#[ inline ]\n\t\t\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\t\t\tlet self_coords = self.coord_to_array ();\n\t\t\t\tformatter.write_str (stringify! ($name)) ?;\n\t\t\t\tformatter.write_str (\" (\") ?;\n\t\t\t\tfor idx in 0 .. self_coords.len () {\n\t\t\t\t\tif idx != 0 { formatter.write_str (\", \") ?; }\n\t\t\t\t\tDebug::fmt (\u0026 self_coords [idx], formatter) ?;\n\t\t\t\t}\n\t\t\t\tformatter.write_str (\")\") ?;\n\t\t\t\tOk (())\n\t\t\t}\n\t\t}\n\t\tpos_ops! ($name: $($rest),*);\n\t};\n\n\t( $name:ident : Add $(, $rest:tt)* ) =\u003e {\n\t\timpl \u003cVal: Int\u003e $name \u003cVal\u003e {\n\t\t\t#[ inline ]\n\t\t\tpub fn try_add (self, other: $name \u003cVal::Signed\u003e) -\u003e Option \u003cSelf\u003e {\n\t\t\t\tlet self_coords = self.coord_to_array ();\n\t\t\t\tlet other_coords = other.coord_to_array ();\n\t\t\t\tlet mut result_coords = Self::ZERO.coord_to_array ();\n\t\t\t\tfor idx in 0 .. self_coords.len () {\n\t\t\t\t\tresult_coords [idx] =\n\t\t\t\t\t\tmatch self_coords [idx].add_signed (other_coords [idx]) {\n\t\t\t\t\t\t\tOk (val) =\u003e val,\n\t\t\t\t\t\t\tErr (_) =\u003e return None,\n\t\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tSome (Self::coord_from_array (result_coords))\n\t\t\t}\n\t\t}\n\t\timpl \u003cVal: Int\u003e Add \u003c$name \u003cVal::Signed\u003e\u003e for $name \u003cVal\u003e {\n\t\t\ttype Output = Self;\n\t\t\t#[ inline ]\n\t\t\tfn add (self, other: $name \u003cVal::Signed\u003e) -\u003e Self {\n\t\t\t\tlet self_coords = self.coord_to_array ();\n\t\t\t\tlet other_coords = other.coord_to_array ();\n\t\t\t\tlet mut result_coords = Self::ZERO.coord_to_array ();\n\t\t\t\tfor idx in 0 .. self_coords.len () {\n\t\t\t\t\tresult_coords [idx] =\n\t\t\t\t\t\tself_coords [idx].add_signed (other_coords [idx]).unwrap ();\n\t\t\t\t}\n\t\t\t\tSelf::coord_from_array (result_coords)\n\t\t\t}\n\t\t}\n\t\tpos_ops! ($name: $($rest),*);\n\t};\n\t( $name:ident : Neg $(, $rest:tt)* ) =\u003e {\n\t\timpl \u003cVal: Int + Neg \u003cOutput = Val\u003e\u003e Neg for $name \u003cVal\u003e {\n\t\t\ttype Output = Self;\n\t\t\t#[ inline ]\n\t\t\tfn neg (self) -\u003e Self {\n\t\t\t\tlet self_coords = self.coord_to_array ();\n\t\t\t\tlet mut result_coords = Self::ZERO.coord_to_array ();\n\t\t\t\tfor idx in 0 .. self_coords.len () {\n\t\t\t\t\tresult_coords [idx] = - self_coords [idx];\n\t\t\t\t}\n\t\t\t\tSelf::coord_from_array (result_coords)\n\t\t\t}\n\t\t}\n\t\tpos_ops! ($name: $($rest),*);\n\t};\n\t( $name:ident : Rem $(, $rest:tt)* ) =\u003e {\n\t\timpl \u003cVal: Int\u003e Rem for $name \u003cVal\u003e {\n\t\t\ttype Output = Self;\n\t\t\t#[ inline ]\n\t\t\tfn rem (self, other: $name \u003cVal\u003e) -\u003e Self {\n\t\t\t\tlet self_coords = self.coord_to_array ();\n\t\t\t\tlet other_coords = other.coord_to_array ();\n\t\t\t\tlet mut result_coords = Self::ZERO.coord_to_array ();\n\t\t\t\tfor idx in 0 .. self_coords.len () {\n\t\t\t\t\tresult_coords [idx] = self_coords [idx] % other_coords [idx];\n\t\t\t\t}\n\t\t\t\tSelf::coord_from_array (result_coords)\n\t\t\t}\n\t\t}\n\t\tpos_ops! ($name: $($rest),*);\n\t};\n\t( $name:ident : Sub $(, $rest:tt)* ) =\u003e {\n\t\timpl \u003cVal: Int\u003e Sub \u003c$name \u003cVal::Signed\u003e\u003e for $name \u003cVal\u003e {\n\t\t\ttype Output = Self;\n\t\t\t#[ inline ]\n\t\t\tfn sub (self, other: $name \u003cVal::Signed\u003e) -\u003e Self {\n\t\t\t\tlet self_coords = self.coord_to_array ();\n\t\t\t\tlet other_coords = other.coord_to_array ();\n\t\t\t\tlet mut result_coords = Self::ZERO.coord_to_array ();\n\t\t\t\tfor idx in 0 .. self_coords.len () {\n\t\t\t\t\tresult_coords [idx] =\n\t\t\t\t\t\tself_coords [idx].sub_signed (other_coords [idx]).unwrap ();\n\t\t\t\t}\n\t\t\t\tSelf::coord_from_array (result_coords)\n\t\t\t}\n\t\t}\n\t\tpos_ops! ($name: $($rest),*);\n\t};\n\t( $name:ident : ) =\u003e {};\n\n}\n\nmod coord {\n\n\tuse super::*;\n\n\tpub trait Coord \u003cconst DIMS: usize\u003e: Copy + Debug + Sized {\n\n\t\ttype Val: Int;\n\t\ttype Signed;\n\n\t\tfn coord_to_array (self) -\u003e [Self::Val; DIMS];\n\t\tfn coord_from_array (array: [Self::Val; DIMS]) -\u003e Self;\n\n\t\t#[ inline ]\n\t\t#[ must_use ]\n\t\tfn zero () -\u003e Self {\n\t\t\tSelf::coord_from_array ([Self::Val::ZERO; DIMS])\n\t\t}\n\n\t}\n\n}\n\nmod dim_2 {\n\n\tuse super::*;\n\n\tpub use geo::DirGeo;\n\tpub use geo::PosGeo;\n\tpub use row_col::Dir2d;\n\tpub use row_col::PosRowCol;\n\tpub use xy::PosXY;\n\tpub use yx::PosYX;\n\n\t#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\n\tpub enum Turn2d { None, Left, Right, Around }\n\n\tmod xy {\n\n\t\tuse super::*;\n\n\t\t#[ derive (Clone, Copy, Default, Eq, Hash, Ord, PartialEq, PartialOrd) ]\n\t\tpub struct PosXY \u003cVal\u003e { pub x: Val, pub y: Val }\n\n\t\timpl \u003cVal: Int\u003e PosXY \u003cVal\u003e {\n\n\t\t\tpub const ZERO: Self = Self { x: Int::ZERO, y: Int::ZERO };\n\n\t\t\t#[ inline ]\n\t\t\tpub fn adjacent_4 (\u0026 self) -\u003e ArrayVec \u003cSelf, 4\u003e {\n\t\t\t\tlet mut result = ArrayVec::new ();\n\t\t\t\tlet Self { x, y } = * self;\n\t\t\t\tif self.x \u003e Val::MIN { result.push (Self { x: x - Val::ONE, y }); }\n\t\t\t\tif self.x \u003c Val::MAX { result.push (Self { x: x + Val::ONE, y }); }\n\t\t\t\tif self.y \u003e Val::MIN { result.push (Self { x, y: y - Val::ONE }); }\n\t\t\t\tif self.y \u003c Val::MAX { result.push (Self { x, y: y + Val::ONE }); }\n\t\t\t\tresult\n\t\t\t}\n\n\t\t}\n\n\t\timpl \u003cVal: Int\u003e Coord \u003c2\u003e for PosXY \u003cVal\u003e {\n\n\t\t\ttype Val = Val;\n\t\t\ttype Signed = PosXY \u003cVal::Signed\u003e;\n\n\t\t\t#[ inline ]\n\t\t\tfn coord_to_array (self) -\u003e [Val; 2] {\n\t\t\t\t[ self.x, self.y ]\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn coord_from_array (arr: [Val; 2]) -\u003e Self {\n\t\t\t\tSelf { x: arr [0], y: arr [1] }\n\t\t\t}\n\n\t\t}\n\n\t\tpos_ops! (PosXY: Debug);\n\t\tpos_ops! (PosXY: Add, Neg, Sub, Rem);\n\n\t}\n\n\tmod yx {\n\n\t\tuse super::*;\n\n\t\t#[ derive (Clone, Copy, Eq, Hash, Ord, PartialEq, PartialOrd) ]\n\t\tpub struct PosYX \u003cVal\u003e { pub y: Val, pub x: Val }\n\n\t\timpl \u003cVal: Int\u003e PosYX \u003cVal\u003e {\n\n\t\t\tpub const ZERO: Self = Self { y: Val::ZERO, x: Val::ZERO };\n\n\t\t\t#[ inline ]\n\t\t\tpub fn adjacent_4 (\u0026 self) -\u003e ArrayVec \u003cSelf, 4\u003e where Val: Int {\n\t\t\t\tlet mut result = ArrayVec::new ();\n\t\t\t\tlet Self { y, x } = * self;\n\t\t\t\tif self.y \u003e Val::MIN { result.push (Self { x, y: y - Val::ONE }); }\n\t\t\t\tif self.y \u003c Val::MAX { result.push (Self { x, y: y + Val::ONE }); }\n\t\t\t\tif self.x \u003e Val::MIN { result.push (Self { x: x - Val::ONE, y }); }\n\t\t\t\tif self.x \u003c Val::MAX { result.push (Self { x: x + Val::ONE, y }); }\n\t\t\t\tresult\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tpub fn adjacent_8 (\u0026 self) -\u003e ArrayVec \u003cSelf, 8\u003e where Val: Int {\n\t\t\t\tlet mut result = ArrayVec::new ();\n\t\t\t\tlet Self { y, x } = * self;\n\t\t\t\tif self.y \u003e Val::MIN {\n\t\t\t\t\tlet y = y - Val::ONE;\n\t\t\t\t\tif self.x \u003e Val::MIN { result.push (Self { x: x - Val::ONE, y }); }\n\t\t\t\t\tresult.push (Self { y, x });\n\t\t\t\t\tif self.x \u003c Val::MAX { result.push (Self { x: x + Val::ONE, y }); }\n\t\t\t\t}\n\t\t\t\tif self.x \u003e Val::MIN { result.push (Self { x: x - Val::ONE, y }); }\n\t\t\t\tif self.x \u003c Val::MAX { result.push (Self { x: x + Val::ONE, y }); }\n\t\t\t\tif self.y \u003c Val::MAX {\n\t\t\t\t\tlet y = y + Val::ONE;\n\t\t\t\t\tif self.x \u003e Val::MIN { result.push (Self { x: x - Val::ONE, y }); }\n\t\t\t\t\tresult.push (Self { y, x });\n\t\t\t\t\tif self.x \u003c Val::MAX { result.push (Self { x: x + Val::ONE, y }); }\n\t\t\t\t}\n\t\t\t\tresult\n\t\t\t}\n\n\t\t}\n\n\t\timpl \u003cVal: Int\u003e Coord \u003c2\u003e for PosYX \u003cVal\u003e {\n\n\t\t\ttype Val = Val;\n\t\t\ttype Signed = PosYX \u003cVal::Signed\u003e;\n\n\t\t\t#[ inline ]\n\t\t\tfn coord_to_array (self) -\u003e [Val; 2] {\n\t\t\t\t[ self.y, self.x ]\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn coord_from_array (arr: [Val; 2]) -\u003e Self {\n\t\t\t\tSelf { y: arr [0], x: arr [1] }\n\t\t\t}\n\n\t\t}\n\n\t\timpl \u003cVal: Int \u003cSigned = Val\u003e + IntSigned\u003e From \u003cDir2d\u003e for PosYX \u003cVal\u003e {\n\n\t\t\t#[ inline ]\n\t\t\tfn from (dir: Dir2d) -\u003e Self {\n\t\t\t\tmatch dir {\n\t\t\t\t\tDir2d::Up =\u003e Self { y: Val::NEG_ONE, x: Val::ZERO },\n\t\t\t\t\tDir2d::Down =\u003e Self { y: Val::ONE, x: Val::ZERO },\n\t\t\t\t\tDir2d::Left =\u003e Self { y: Val::ZERO, x: Val::NEG_ONE },\n\t\t\t\t\tDir2d::Right =\u003e Self { y: Val::ZERO, x: Val::ONE },\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\n\t\tpos_ops! (PosYX: Debug);\n\t\tpos_ops! (PosYX: Add, Neg, Rem, Sub);\n\n\t}\n\n\tmod geo {\n\n\t\tuse super::*;\n\n\t\t#[ derive (Clone, Copy, Eq, Hash, Ord, PartialEq, PartialOrd) ]\n\t\tpub struct PosGeo \u003cVal\u003e { pub n: Val, pub e: Val }\n\n\t\timpl \u003cVal: Int\u003e PosGeo \u003cVal\u003e {\n\n\t\t\tpub const ZERO: Self = Self { n: Val::ZERO, e: Val::ZERO };\n\n\t\t\t#[ inline ]\n\t\t\t#[ must_use ]\n\t\t\tpub fn north (\u0026 self, num: Val) -\u003e Self {\n\t\t\t\tSelf { n: self.n.safe_add (num), e: self.e }\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\t#[ must_use ]\n\t\t\tpub fn south (\u0026 self, num: Val) -\u003e Self {\n\t\t\t\tSelf { n: self.n.safe_sub (num), e: self.e }\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\t#[ must_use ]\n\t\t\tpub fn east (\u0026 self, num: Val) -\u003e Self {\n\t\t\t\tSelf { n: self.n, e: self.e.safe_add (num) }\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\t#[ must_use ]\n\t\t\tpub fn west (\u0026 self, num: Val) -\u003e Self {\n\t\t\t\tSelf { n: self.n, e: self.e.safe_sub (num) }\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tpub fn adjacent_4 (\u0026 self) -\u003e ArrayVec \u003cSelf, 4\u003e where Val: Int {\n\t\t\t\tlet mut result = ArrayVec::new ();\n\t\t\t\tlet Self { n, e } = * self;\n\t\t\t\tif n \u003e Val::MIN { result.push (Self { n: n - Val::ONE, e }); }\n\t\t\t\tif n \u003c Val::MAX { result.push (Self { n: n + Val::ONE, e }); }\n\t\t\t\tif e \u003e Val::MIN { result.push (Self { n, e: e - Val::ONE }); }\n\t\t\t\tif e \u003c Val::MAX { result.push (Self { n, e: e + Val::ONE }); }\n\t\t\t\tresult\n\t\t\t}\n\n\t\t}\n\n\t\timpl \u003cVal: Int\u003e Coord \u003c2\u003e for PosGeo \u003cVal\u003e {\n\n\t\t\ttype Val = Val;\n\t\t\ttype Signed = PosGeo \u003cVal::Signed\u003e;\n\n\t\t\t#[ inline ]\n\t\t\tfn coord_to_array (self) -\u003e [Val; 2] {\n\t\t\t\t[ self.n, self.e ]\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn coord_from_array (arr: [Val; 2]) -\u003e Self {\n\t\t\t\tSelf { n: arr [0], e: arr [1] }\n\t\t\t}\n\n\t\t}\n\n\t\tpos_ops! (PosGeo: Debug);\n\t\tpos_ops! (PosGeo: Add, Neg, Rem, Sub);\n\n\t\t#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\n\t\tpub enum DirGeo { North, South, East, West }\n\n\t\timpl Add \u003cTurn2d\u003e for DirGeo {\n\n\t\t\ttype Output = Self;\n\n\t\t\t#[ inline ]\n\t\t\tfn add (self, other: Turn2d) -\u003e Self {\n\t\t\t\tuse Turn2d::{ None, Left, Right, Around };\n\t\t\t\tuse DirGeo::{ North, South, East, West };\n\t\t\t\tmatch (self, other) {\n\t\t\t\t\t(North, None) | (West, Right) | (East, Left) | (South, Around) =\u003e North,\n\t\t\t\t\t(South, None) | (East, Right) | (West, Left) | (North, Around) =\u003e South,\n\t\t\t\t\t(East, None) | (North, Right) | (South, Left) | (West, Around) =\u003e East,\n\t\t\t\t\t(West, None) | (South, Right) | (North, Left) | (East, Around) =\u003e West,\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\n\t\timpl \u003cVal: Int\u003e Add \u003c(DirGeo, Val)\u003e for PosGeo \u003cVal\u003e {\n\n\t\t\ttype Output = NumResult \u003cSelf\u003e;\n\n\t\t\t#[ inline ]\n\t\t\tfn add (self, (dir, dist): (DirGeo, Val)) -\u003e NumResult \u003cSelf\u003e {\n\t\t\t\tlet mut result = self;\n\t\t\t\tmatch dir {\n\t\t\t\t\tDirGeo::North =\u003e result.n = Val::add_2 (result.n, dist) ?,\n\t\t\t\t\tDirGeo::South =\u003e result.n = Val::sub_2 (result.n, dist) ?,\n\t\t\t\t\tDirGeo::East =\u003e result.e = Val::add_2 (result.e, dist) ?,\n\t\t\t\t\tDirGeo::West =\u003e result.e = Val::sub_2 (result.e, dist) ?,\n\t\t\t\t}\n\t\t\t\tOk (result)\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tmod row_col {\n\n\t\tuse super::*;\n\n\t\t#[ derive (Clone, Copy, Eq, Hash, Ord, PartialEq, PartialOrd) ]\n\t\tpub struct PosRowCol \u003cVal\u003e { pub row: Val, pub col: Val }\n\n\t\timpl \u003cVal: Int\u003e PosRowCol \u003cVal\u003e {\n\n\t\t\tpub const ZERO: Self = Self { row: Val::ZERO, col: Val::ZERO };\n\n\t\t\t#[ inline ]\n\t\t\t#[ must_use ]\n\t\t\tpub fn up (self, num: Val) -\u003e Self {\n\t\t\t\tSelf { row: self.row.safe_sub (num), col: self.col }\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\t#[ must_use ]\n\t\t\tpub fn down (self, num: Val) -\u003e Self {\n\t\t\t\tSelf { row: self.row.safe_add (num), col: self.col }\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\t#[ must_use ]\n\t\t\tpub fn left (\u0026 self, num: Val) -\u003e Self {\n\t\t\t\tSelf { row: self.row, col: self.col.safe_sub (num) }\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\t#[ must_use ]\n\t\t\tpub fn right (\u0026 self, num: Val) -\u003e Self {\n\t\t\t\tSelf { row: self.row, col: self.col.safe_add (num) }\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tpub fn adjacent_4 (\u0026 self) -\u003e ArrayVec \u003cSelf, 4\u003e where Val: Int {\n\t\t\t\tlet mut result = ArrayVec::new ();\n\t\t\t\tlet Self { row, col } = * self;\n\t\t\t\tif row \u003e Val::MIN { result.push (Self { row: row - Val::ONE, col }); }\n\t\t\t\tif row \u003c Val::MAX { result.push (Self { row: row + Val::ONE, col }); }\n\t\t\t\tif col \u003e Val::MIN { result.push (Self { row, col: col - Val::ONE }); }\n\t\t\t\tif col \u003c Val::MAX { result.push (Self { row, col: col + Val::ONE }); }\n\t\t\t\tresult\n\t\t\t}\n\n\t\t}\n\n\t\timpl \u003cVal: Int\u003e Coord \u003c2\u003e for PosRowCol \u003cVal\u003e {\n\n\t\t\ttype Val = Val;\n\t\t\ttype Signed = PosRowCol \u003cVal::Signed\u003e;\n\n\t\t\t#[ inline ]\n\t\t\tfn coord_to_array (self) -\u003e [Val; 2] {\n\t\t\t\t[ self.row, self.col ]\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn coord_from_array (arr: [Val; 2]) -\u003e Self {\n\t\t\t\tSelf { row: arr [0], col: arr [1] }\n\t\t\t}\n\n\t\t}\n\n\t\tpos_ops! (PosRowCol: Debug);\n\t\tpos_ops! (PosRowCol: Add, Neg, Rem, Sub);\n\n\t\t#[ derive (Clone, Copy, Debug, Eq, PartialEq) ]\n\t\tpub enum Dir2d { Up, Down, Left, Right }\n\n\t\timpl Add \u003cTurn2d\u003e for Dir2d {\n\n\t\t\ttype Output = Self;\n\n\t\t\t#[ inline ]\n\t\t\tfn add (self, other: Turn2d) -\u003e Self {\n\t\t\t\tuse Turn2d::{ None, Left as TLeft, Right as TRight, Around };\n\t\t\t\tuse Dir2d::{ Up, Down, Left as DLeft, Right as DRight };\n\t\t\t\tmatch (self, other) {\n\t\t\t\t\t(Up, None) | (DLeft, TRight) | (DRight, TLeft) | (Down, Around) =\u003e Up,\n\t\t\t\t\t(Down, None) | (DRight, TRight) | (DLeft, TLeft) | (Up, Around) =\u003e Down,\n\t\t\t\t\t(DLeft, None) | (Down, TRight) | (Up, TLeft) | (DRight, Around) =\u003e DLeft,\n\t\t\t\t\t(DRight, None) | (Up, TRight) | (Down, TLeft) | (DLeft, Around) =\u003e DRight,\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\n\t\timpl \u003cVal: Int\u003e Add \u003c(Dir2d, Val)\u003e for PosRowCol \u003cVal\u003e {\n\n\t\t\ttype Output = NumResult \u003cSelf\u003e;\n\n\t\t\t#[ inline ]\n\t\t\tfn add (self, (dir, dist): (Dir2d, Val)) -\u003e NumResult \u003cSelf\u003e {\n\t\t\t\tlet mut result = self;\n\t\t\t\tmatch dir {\n\t\t\t\t\tDir2d::Up =\u003e result.row = Val::sub_2 (result.row, dist) ?,\n\t\t\t\t\tDir2d::Down =\u003e result.row = Val::add_2 (result.row, dist) ?,\n\t\t\t\t\tDir2d::Left =\u003e result.col = Val::sub_2 (result.col, dist) ?,\n\t\t\t\t\tDir2d::Right =\u003e result.col = Val::add_2 (result.col, dist) ?,\n\t\t\t\t}\n\t\t\t\tOk (result)\n\t\t\t}\n\n\t\t}\n\n\t}\n\n}\n\nmod dim_3 {\n\n\tuse super::*;\n\n\tpub use xyz::PosXYZ;\n\n\tmod xyz {\n\n\t\tuse super::*;\n\n\t\t#[ derive (Clone, Copy, Eq, Hash, Ord, PartialEq, PartialOrd) ]\n\t\tpub struct PosXYZ \u003cVal\u003e { pub x: Val, pub y: Val, pub z: Val }\n\n\t\timpl \u003cVal: Int\u003e PosXYZ \u003cVal\u003e {\n\t\t\tpub const ZERO: Self = Self { x: Val::ZERO, y: Val::ZERO, z: Val::ZERO };\n\t\t\tpub const MAX: Self = Self { x: Val::MAX, y: Val::MAX, z: Val::MAX };\n\t\t\tpub const MIN: Self = Self { x: Val::MIN, y: Val::MIN, z: Val::MIN };\n\t\t}\n\n\t\timpl \u003cVal: Int\u003e Coord \u003c3\u003e for PosXYZ \u003cVal\u003e {\n\n\t\t\ttype Val = Val;\n\t\t\ttype Signed = PosGeo \u003cVal::Signed\u003e;\n\n\t\t\t#[ inline ]\n\t\t\tfn coord_to_array (self) -\u003e [Val; 3] {\n\t\t\t\t[ self.x, self.y, self.z ]\n\t\t\t}\n\n\t\t\t#[ inline ]\n\t\t\tfn coord_from_array (arr: [Val; 3]) -\u003e Self {\n\t\t\t\tSelf { x: arr [0], y: arr [1], z: arr [2] }\n\t\t\t}\n\n\t\t}\n\n\t\tpos_ops! (PosXYZ: Debug);\n\t\tpos_ops! (PosXYZ: Add, Neg, Rem, Sub);\n\n\t}\n\n}\n","traces":[{"line":25,"address":[79936],"length":1,"stats":{"Line":0},"fn_name":"fmt\u003ci64\u003e"},{"line":26,"address":[79964],"length":1,"stats":{"Line":0},"fn_name":null},{"line":27,"address":[80077,79986],"length":1,"stats":{"Line":0},"fn_name":null},{"line":28,"address":[80199,80053,80117],"length":1,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[80315,80153,80230],"length":1,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[80336,80368],"length":1,"stats":{"Line":0},"fn_name":null},{"line":31,"address":[80347,80470],"length":1,"stats":{"Line":0},"fn_name":null},{"line":33,"address":[80599,80651,80288],"length":1,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[80641],"length":1,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[50320],"length":1,"stats":{"Line":2},"fn_name":"try_add\u003cu8\u003e"},{"line":44,"address":[50377],"length":1,"stats":{"Line":2},"fn_name":null},{"line":45,"address":[50417],"length":1,"stats":{"Line":2},"fn_name":null},{"line":46,"address":[50449],"length":1,"stats":{"Line":2},"fn_name":null},{"line":47,"address":[50628,50862,50491],"length":1,"stats":{"Line":6},"fn_name":null},{"line":48,"address":[50872,50808,50858],"length":1,"stats":{"Line":4},"fn_name":null},{"line":49,"address":[50646],"length":1,"stats":{"Line":2},"fn_name":null},{"line":50,"address":[50793],"length":1,"stats":{"Line":2},"fn_name":null},{"line":51,"address":[50821],"length":1,"stats":{"Line":2},"fn_name":null},{"line":54,"address":[50595,50903],"length":1,"stats":{"Line":4},"fn_name":null},{"line":60,"address":[73248],"length":1,"stats":{"Line":4},"fn_name":"add\u003ci16\u003e"},{"line":61,"address":[73309],"length":1,"stats":{"Line":4},"fn_name":null},{"line":62,"address":[73348],"length":1,"stats":{"Line":4},"fn_name":null},{"line":63,"address":[73377],"length":1,"stats":{"Line":4},"fn_name":null},{"line":64,"address":[73553,73417,73768],"length":1,"stats":{"Line":12},"fn_name":null},{"line":65,"address":[73741,73778],"length":1,"stats":{"Line":4},"fn_name":null},{"line":66,"address":[73571],"length":1,"stats":{"Line":4},"fn_name":null},{"line":68,"address":[73521],"length":1,"stats":{"Line":4},"fn_name":null},{"line":77,"address":[42096],"length":1,"stats":{"Line":1},"fn_name":"neg\u003ci16\u003e"},{"line":78,"address":[42139],"length":1,"stats":{"Line":1},"fn_name":null},{"line":79,"address":[42225],"length":1,"stats":{"Line":1},"fn_name":null},{"line":80,"address":[42320,42530,42647],"length":1,"stats":{"Line":3},"fn_name":null},{"line":81,"address":[42657,42551],"length":1,"stats":{"Line":1},"fn_name":null},{"line":83,"address":[42427],"length":1,"stats":{"Line":1},"fn_name":null},{"line":108,"address":[38048],"length":1,"stats":{"Line":1},"fn_name":"sub\u003ci16\u003e"},{"line":109,"address":[38127],"length":1,"stats":{"Line":1},"fn_name":null},{"line":110,"address":[38213],"length":1,"stats":{"Line":1},"fn_name":null},{"line":111,"address":[38299],"length":1,"stats":{"Line":1},"fn_name":null},{"line":112,"address":[38394,38837,38619],"length":1,"stats":{"Line":3},"fn_name":null},{"line":113,"address":[38847,38810],"length":1,"stats":{"Line":1},"fn_name":null},{"line":114,"address":[38640],"length":1,"stats":{"Line":1},"fn_name":null},{"line":116,"address":[38516],"length":1,"stats":{"Line":1},"fn_name":null},{"line":139,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":140,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":173,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":174,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":175,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":176,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":177,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":178,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":179,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":180,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":191,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":192,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":196,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":197,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":219,"address":[67712,68248],"length":1,"stats":{"Line":1},"fn_name":"adjacent_4\u003ci16\u003e"},{"line":220,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":221,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":222,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":223,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":224,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":225,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":226,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":230,"address":[83884,82816],"length":1,"stats":{"Line":1},"fn_name":"adjacent_8\u003cu16\u003e"},{"line":231,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":232,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":233,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":234,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":235,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":236,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":237,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":239,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":240,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":241,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":242,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":243,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":244,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":245,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":247,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":258,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":259,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":263,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":264,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":272,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":273,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":301,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":302,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":307,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":308,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":313,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":314,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":319,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":320,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":325,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":326,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":327,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":328,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":329,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":330,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":331,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":342,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":343,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":347,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":348,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":364,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":367,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":368,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":369,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":370,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":371,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":382,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":383,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":384,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":385,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":386,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":387,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":388,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":390,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":410,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":411,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":416,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":417,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":422,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":423,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":428,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":429,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":433,"address":[184080,184611],"length":1,"stats":{"Line":1},"fn_name":"adjacent_4\u003cu16\u003e"},{"line":434,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":435,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":436,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":437,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":438,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":439,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":440,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":451,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":452,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":456,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":457,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":473,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":476,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":477,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":478,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":479,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":480,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":491,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":492,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":493,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":494,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":495,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":496,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":497,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":499,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":533,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":534,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":538,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":539,"address":[],"length":0,"stats":{"Line":1},"fn_name":null}],"covered":112,"coverable":156},{"path":["/","home","runner","work","advent-of-code","advent-of-code","common","search","search.rs"],"content":"//! Iterative search algorithms for solutions in a problem space\n\nuse aoc_grid as grid;\nuse aoc_misc::*;\nuse grid::Grid;\nuse grid::GridPos;\n\n/// Implements [Digkstra's algorithm](https://en.wikipedia.org/wiki/Dijkstra%27s_algorithm)\n///\n/// This searches for the cheapest path from one point to another, given a starting point (or\n/// points) and a way to iteratively find next points. While this can be used for path-finding, it\n/// can also be used to solve many other problems, assuming their state can be modeled as points,\n/// the next steps can be iterated, and each step can be scored with some kind of priority.\n///\n/// # Example\n///\n/// Here's an example taken from the\n/// [wikipedia page](https://en.wikipedia.org/wiki/Dijkstra%27s_algorithm). We use strings for the\n/// nodes instead of integers to make things a bit clearer.\n///\n/// In this example, we supply a hash map directly when constructing the [`PrioritySearch`]. This\n/// works because the trait [`PrioritySearchVisitor`] is implemented directly in this case. It is\n/// also implemented for functions, so you can pass a closure, plus the trait can be implemented\n/// directly, of course.\n///\n/// ```\n/// # use aoc_misc::*;\n/// # use aoc_search::*;\n/// // set up a data structure with a map of connected nodes and the distance between them\n/// let nodes: HashMap \u003c\u0026 str, Vec \u003c(\u0026 str, u64)\u003e\u003e = {\n///\n///    // use of Itertools::group_by requires a temporary...\n///    let nodes_group_by_temp = [\n///          // list of connected nodes and the distance between them\n///          (\"one\", \"two\", 7), (\"one\", \"three\", 9), (\"one\", \"six\", 14),\n///          (\"two\", \"three\", 10), (\"two\", \"four\", 15), (\"three\", \"four\", 11),\n///          (\"three\", \"six\", 2), (\"four\", \"five\", 6), (\"five\", \"six\", 8),\n///       ].into_iter ()\n///          // double up the connections to include the reverse\n///          .flat_map (|(node_1, node_2, dist)| [(node_1, node_2, dist), (node_2, node_1, dist)])\n///          // group by node_1 (requires sort)\n///          .sorted_by_key (|\u0026 (node_1, _, _)| node_1)\n///         .group_by (|\u0026 (node_1, _, _)| node_1);\n///\n///    // collect into a hash map from node_1 to (node_2, dist)\n///    nodes_group_by_temp.into_iter ()\n///       .map (|(node_1, group)| (\n///             node_1,\n///             group.map (|(_, node_2, dist)| (node_2, dist)).collect::\u003cVec \u003c_\u003e\u003e (),\n///          ))\n///       .collect ()\n///\n/// };\n///\n/// // create a PrioritySearch to traverse our nodes\n/// let mut search = PrioritySearch::with_hash_map (nodes);\n///\n/// // add the starting point with a total distance of 0\n/// search.push (\"one\", 0);\n///\n/// // verify the results\n/// assert_eq! (search.next (), Some ((\"one\", 0)));\n/// assert_eq! (search.next (), Some ((\"two\", 7)));\n/// assert_eq! (search.next (), Some ((\"three\", 9)));\n/// assert_eq! (search.next (), Some ((\"six\", 11)));\n/// assert_eq! (search.next (), Some ((\"five\", 19)));\n/// assert_eq! (search.next (), Some ((\"four\", 20)));\n/// assert_eq! (search.next (), None);\n/// ```\n\npub struct PrioritySearch \u003cNode, Pri, Visitor, SeenImpl\u003e\n\twhere\n\t\tNode: Clone + Debug + Eq + Hash,\n\t\tPri: Clone + Copy + Debug + Ord,\n\t\tSeenImpl: Seen \u003cNode, Pri\u003e,\n\t\tVisitor: PrioritySearchVisitor \u003cNode, Pri, SeenImpl\u003e {\n\tvisitor: Visitor,\n\tinner: PrioritySearchInner \u003cNode, Pri, SeenImpl\u003e,\n}\n\n#[ allow (clippy::implicit_hasher) ]\nimpl \u003cNode, Pri, Visitor\u003e\n\tPrioritySearch \u003cNode, Pri, Visitor, HashMap \u003cNode, SeenState \u003cPri\u003e\u003e\u003e\n\twhere\n\t\tNode: Clone + Debug + Eq + Hash + Ord,\n\t\tPri: Clone + Copy + Debug + Ord,\n\t\tVisitor: PrioritySearchVisitor \u003cNode, Pri, HashMap \u003cNode, SeenState \u003cPri\u003e\u003e\u003e {\n\n\t#[ inline ]\n\tpub fn with_hash_map (visitor: Visitor) -\u003e Self {\n\t\tSelf {\n\t\t\tvisitor,\n\t\t\tinner: PrioritySearchInner {\n\t\t\t\tseen: HashMap::new (),\n\t\t\t\ttodo: BinaryHeap::new (),\n\t\t\t},\n\t\t}\n\t}\n\n}\n\nimpl \u003cNode, Pri, Visitor, const DIMS: usize\u003e PrioritySearch \u003cNode, Pri, Visitor, Grid \u003cVec \u003cSeenState \u003cPri\u003e\u003e, Node, DIMS\u003e\u003e\n\twhere\n\t\tNode: Clone + Debug + Eq + Hash + GridPos \u003cDIMS\u003e,\n\t\tPri: Clone + Copy + Debug + Ord,\n\t\tVisitor: PrioritySearchVisitor \u003cNode, Pri, Grid \u003cVec \u003cSeenState \u003cPri\u003e\u003e, Node, DIMS\u003e\u003e {\n\n\t#[ inline ]\n\tpub fn with_grid (origin: [isize; DIMS], size: [usize; DIMS], visitor: Visitor) -\u003e Self {\n\t\tlet grid = Grid::wrap (\n\t\t\titer::repeat (SeenState::New)\n\t\t\t\t.take (size.iter ().product ())\n\t\t\t\t.collect (),\n\t\t\torigin,\n\t\t\tsize);\n\t\tSelf {\n\t\t\tvisitor,\n\t\t\tinner: PrioritySearchInner {\n\t\t\t\tseen: grid,\n\t\t\t\ttodo: BinaryHeap::new (),\n\t\t\t},\n\t\t}\n\t}\n\n}\n\nimpl \u003cNode, Pri, Visitor, SeenImpl\u003e PrioritySearch \u003cNode, Pri, Visitor, SeenImpl\u003e\n\twhere\n\t\tNode: Clone + Debug + Eq + Hash,\n\t\tPri: Clone + Copy + Debug + Ord,\n\t\tSeenImpl: Seen \u003cNode, Pri\u003e,\n\t\tVisitor: PrioritySearchVisitor \u003cNode, Pri, SeenImpl\u003e {\n\n\t#[ inline ]\n\tpub fn len (\u0026 self) -\u003e usize {\n\t\tself.inner.todo.len ()\n\t}\n\n\t#[ inline ]\n\tpub fn is_empty (\u0026 self) -\u003e bool {\n\t\tself.len () == 0\n\t}\n\n\t#[ inline ]\n\tpub fn push (\u0026 mut self, node: Node, priority: Pri) -\u003e \u0026 mut Self {\n\t\tself.inner.push (node, priority);\n\t\tself\n\t}\n\n}\n\nimpl \u003cNode, Pri, Visitor, SeenImpl\u003e Iterator for PrioritySearch \u003cNode, Pri, Visitor, SeenImpl\u003e\n\twhere\n\t\tNode: Clone + Debug + Eq + Hash,\n\t\tPri: Clone + Copy + Debug + Ord,\n\t\tSeenImpl: Seen \u003cNode, Pri\u003e,\n\t\tVisitor: PrioritySearchVisitor \u003cNode, Pri, SeenImpl\u003e {\n\n\ttype Item = Visitor::Item;\n\n\t#[ inline ]\n\tfn next (\u0026 mut self) -\u003e Option \u003cSelf::Item\u003e {\n\t\tif let Some (WithPriority { priority, value: node }) = self.inner.pop () {\n\t\t\tlet adder = PrioritySearchAdder { inner: \u0026 mut self.inner };\n\t\t\treturn Some (self.visitor.visit (node, priority, adder));\n\t\t}\n\t\tNone\n\t}\n\n}\n\nstruct WithPriority \u003cVal, Pri\u003e {\n\tpriority: Pri,\n\tvalue: Val,\n}\n\nimpl \u003cVal, Pri\u003e PartialEq for WithPriority \u003cVal, Pri\u003e where Pri: PartialEq {\n\tfn eq (\u0026 self, other: \u0026 Self) -\u003e bool {\n\t\tself.priority.eq (\u0026 other.priority)\n\t}\n}\n\nimpl \u003cVal, Pri\u003e Eq for WithPriority \u003cVal, Pri\u003e where Pri: Eq {\n}\n\nimpl \u003cVal, Pri\u003e PartialOrd for WithPriority \u003cVal, Pri\u003e where Pri: PartialOrd {\n\tfn partial_cmp (\u0026 self, other: \u0026 Self) -\u003e Option \u003cOrdering\u003e {\n\t\tother.priority.partial_cmp (\u0026 self.priority)\n\t}\n}\n\nimpl \u003cVal, Pri\u003e Ord for WithPriority \u003cVal, Pri\u003e where Pri: Ord {\n\tfn cmp (\u0026 self, other: \u0026 Self) -\u003e Ordering {\n\t\tother.priority.cmp (\u0026 self.priority)\n\t}\n}\n\nstruct PrioritySearchInner \u003cNode, Pri, Seen\u003e {\n\tseen: Seen,\n\ttodo: BinaryHeap \u003cWithPriority \u003cNode, Pri\u003e\u003e,\n}\n\nimpl \u003cNode, Pri, SeenImpl\u003e PrioritySearchInner \u003cNode, Pri, SeenImpl\u003e\n\twhere\n\t\tNode: Clone + Eq + Hash,\n\t\tPri: Clone + Ord,\n\t\tSeenImpl: Seen \u003cNode, Pri\u003e {\n\tfn push (\u0026 mut self, node: Node, priority: Pri) {\n\t\tif self.seen.seen_push (node.clone (), priority.clone ()) {\n\t\t\tself.todo.push (WithPriority { priority, value: node });\n\t\t}\n\t}\n\tfn pop (\u0026 mut self) -\u003e Option \u003cWithPriority \u003cNode, Pri\u003e\u003e {\n\t\twhile let Some (WithPriority { value: node, priority }) = self.todo.pop () {\n\t\t\tif self.seen.seen_visited (\u0026 node) { continue }\n\t\t\treturn Some (WithPriority { value: node, priority });\n\t\t}\n\t\tNone\n\t}\n}\n\npub struct PrioritySearchAdder \u003c'inr, Node, Pri, Seen\u003e {\n\tinner: \u0026 'inr mut PrioritySearchInner \u003cNode, Pri, Seen\u003e,\n}\n\nimpl \u003c'inr, Node, Pri, SeenImpl\u003e PrioritySearchAdder \u003c'inr, Node, Pri, SeenImpl\u003e\n\twhere\n\t\tNode: Clone + Debug + Eq + Hash,\n\t\tPri: Clone + Debug + Ord,\n\t\tSeenImpl: Seen \u003cNode, Pri\u003e {\n\n\t#[ inline ]\n\tpub fn add (\u0026 mut self, node: Node, priority: Pri) {\n\t\tself.inner.push (node, priority);\n\t}\n\n}\n\npub trait PrioritySearchVisitor \u003cNode, Pri, Seen\u003e {\n\n\ttype Item;\n\n\tfn visit (\n\t\t\u0026 mut self,\n\t\tnode: Node,\n\t\tpriority: Pri,\n\t\tadder: PrioritySearchAdder \u003cNode, Pri, Seen\u003e,\n\t) -\u003e Self::Item;\n\n}\n\nimpl \u003cVisitorFn, Node, Pri, Item, SeenImpl\u003e PrioritySearchVisitor \u003cNode, Pri, SeenImpl\u003e for VisitorFn\n\twhere\n\t\tNode: Clone,\n\t\tPri: Clone + Ord,\n\t\tSeenImpl: Seen \u003cNode, Pri\u003e,\n\t\tVisitorFn: FnMut (Node, Pri, PrioritySearchAdder \u003cNode, Pri, SeenImpl\u003e) -\u003e Item {\n\n\ttype Item = Item;\n\n\t#[ inline ]\n\tfn visit (\n\t\t\u0026 mut self,\n\t\tnode: Node,\n\t\tpriority: Pri,\n\t\tadder: PrioritySearchAdder \u003cNode, Pri, SeenImpl\u003e,\n\t) -\u003e Self::Item {\n\t\tself (node, priority, adder)\n\t}\n\n}\n\nimpl \u003cNode, Pri, SeenImpl, NextNodesIntoIter, Hshr\u003e PrioritySearchVisitor \u003cNode, Pri, SeenImpl\u003e\n\tfor HashMap \u003cNode, NextNodesIntoIter, Hshr\u003e\n\twhere\n\t\tHshr: BuildHasher,\n\t\tNode: Clone + Debug + Eq + Hash + Ord,\n\t\tPri: Clone + Debug + Ord + Add \u003cOutput = Pri\u003e,\n\t\tSeenImpl: Seen \u003cNode, Pri\u003e,\n\t\tfor \u003c'dat\u003e \u0026 'dat NextNodesIntoIter: IntoIterator \u003cItem = \u0026 'dat (Node, Pri)\u003e {\n\n\ttype Item = (Node, Pri);\n\n\t#[ inline ]\n\tfn visit (\n\t\t\u0026 mut self,\n\t\tnode: Node,\n\t\tpriority: Pri,\n\t\tmut adder: PrioritySearchAdder \u003cNode, Pri, SeenImpl\u003e,\n\t) -\u003e Self::Item {\n\t\tif let Some (next_nodes) = self.get (\u0026 node) {\n\t\t\tfor \u0026 (ref next_node, ref next_pri) in next_nodes {\n\t\t\t\tadder.add (next_node.clone (), priority.clone () + next_pri.clone ());\n\t\t\t}\n\t\t}\n\t\t(node, priority)\n\t}\n\n}\n\npub trait Seen \u003cNode, Pri\u003e where Node: Clone, Pri: Clone + Ord {\n\n\tfn seen_get_mut (\u0026 mut self, node: Node) -\u003e \u0026 mut SeenState \u003cPri\u003e;\n\n\t#[ inline ]\n\tfn seen_push (\u0026 mut self, node: Node, priority: Pri) -\u003e bool {\n\t\tlet seen_state = self.seen_get_mut (node);\n\t\tmatch seen_state.clone () {\n\t\t\tSeenState::New =\u003e {\n\t\t\t\t* seen_state = SeenState::Unvisited (priority);\n\t\t\t\ttrue\n\t\t\t},\n\t\t\tSeenState::Unvisited (seen_priority) if priority \u003c seen_priority =\u003e {\n\t\t\t\t* seen_state = SeenState::Unvisited (priority);\n\t\t\t\ttrue\n\t\t\t},\n\t\t\tSeenState::Unvisited (_) | SeenState::Visited =\u003e false,\n\t\t}\n\t}\n\n\t#[ inline ]\n\tfn seen_visited (\u0026 mut self, node: \u0026 Node) -\u003e bool {\n\t\tlet seen_state = self.seen_get_mut (node.clone ());\n\t\tif let SeenState::Visited = seen_state.clone () {\n\t\t\ttrue\n\t\t} else {\n\t\t\t* seen_state = SeenState::Visited;\n\t\t\tfalse\n\t\t}\n\t}\n\n}\n\nimpl \u003cNode, Pri, Hshr\u003e Seen \u003cNode, Pri\u003e\nfor HashMap \u003cNode, SeenState \u003cPri\u003e, Hshr\u003e\n\twhere\n\t\tHshr: BuildHasher,\n\t\tNode: Clone + Eq + Hash + Ord,\n\t\tPri: Clone + Ord {\n\n\t#[ inline ]\n\tfn seen_get_mut (\u0026 mut self, node: Node) -\u003e \u0026 mut SeenState \u003cPri\u003e {\n\t\tself.entry (node).or_insert (SeenState::New)\n\t}\n\n}\n\nimpl \u003cNode, Pri, const DIMS: usize\u003e Seen \u003cNode, Pri\u003e\n\tfor Grid \u003cVec \u003cSeenState \u003cPri\u003e\u003e, Node, DIMS\u003e\n\twhere\n\t\tNode: GridPos \u003cDIMS\u003e + Clone + Eq + Hash,\n\t\tPri: Clone + Ord {\n\n\t#[ inline ]\n\tfn seen_get_mut (\u0026 mut self, node: Node) -\u003e \u0026 mut SeenState \u003cPri\u003e {\n\t\tSelf::get_mut (self, node).unwrap ()\n\t}\n\n}\n\n#[ derive (Clone) ]\npub enum SeenState \u003cPri: Clone\u003e {\n\tNew,\n\tUnvisited (Pri),\n\tVisited,\n}\n","traces":[{"line":90,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":93,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":109,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":111,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":113,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":114,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":115,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":118,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":135,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":136,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":140,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":141,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":145,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":146,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":147,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":162,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":163,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":164,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":165,"address":[],"length":0,"stats":{"Line":12},"fn_name":null},{"line":167,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":178,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":179,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":187,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":188,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":193,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":194,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":208,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":209,"address":[],"length":0,"stats":{"Line":12},"fn_name":null},{"line":210,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":213,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":214,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":215,"address":[],"length":0,"stats":{"Line":12},"fn_name":null},{"line":216,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":218,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":233,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":234,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":262,"address":[82352],"length":1,"stats":{"Line":6},"fn_name":"visit\u003caoc_2021_day_23::tools::run_part::{closure_env#0}, aoc_2021_day_23::model::StateCompact, i64, (aoc_2021_day_23::model::StateCompact, i64, arrayvec::arrayvec::ArrayVec\u003c(aoc_2021_day_23::model::StateCompact, i64), 28\u003e), std::collections::hash::map::HashMap\u003caoc_2021_day_23::model::StateCompact, aoc_search::SeenState\u003ci64\u003e, std::collections::hash::map::RandomState\u003e\u003e"},{"line":268,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":291,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":292,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":293,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":296,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":306,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":307,"address":[],"length":0,"stats":{"Line":12},"fn_name":null},{"line":308,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":309,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":310,"address":[],"length":0,"stats":{"Line":12},"fn_name":null},{"line":311,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":313,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":314,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":315,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":317,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":322,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":323,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":324,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":325,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":327,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":328,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":342,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":343,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":355,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":356,"address":[],"length":0,"stats":{"Line":1},"fn_name":null}],"covered":46,"coverable":63},{"path":["/","home","runner","work","advent-of-code","advent-of-code","common","src","lib.rs"],"content":"//! Common functionality used in all puzzle solutions\n\nuse clap::ArgMatches;\nuse clap::Command;\n\n#[ doc (no_inline) ]\npub use prelude::*;\n\npub mod parser;\npub mod puzzle;\n\n#[ macro_export ]\nmacro_rules! array_vec {\n\t( ) =\u003e { ArrayVec::new () };\n\t( $($vals:expr),+ ) =\u003e {\n\t\t{\n\t\t\tlet mut result = ArrayVec::new ();\n\t\t\tarray_vec! (@push result, $($vals,)*);\n\t\t\tresult\n\t\t}\n\t};\n\t( @push $result:ident $(,)? ) =\u003e {};\n\t( @push $result:ident , $val:expr $(, $rest:expr)* ) =\u003e {\n\t\t$result.push ($val);\n\t\tarray_vec! (@push $result, $($rest),*);\n\t};\n\t( @push $result:ident , $val:expr $(, $rest:expr)* , ) =\u003e {\n\t\t$result.push ($val);\n\t\tarray_vec! (@push $result, $($rest),*);\n\t};\n}\n\nmod iter_ext {\n\n\tuse super::*;\n\tuse iter::Copied;\n\n\tpub trait IntoIteratorExt: IntoIterator + Sized {\n\n\t\t#[ inline ]\n\t\tfn iter_vals \u003c'dat, Item\u003e (self) -\u003e Copied \u003cSelf::IntoIter\u003e\n\t\t\twhere\n\t\t\t\tItem: 'dat + Copy,\n\t\t\t\tSelf: IntoIterator \u003cItem = \u0026 'dat Item\u003e {\n\t\t\tself.into_iter ().copied ()\n\t\t}\n\n\t}\n\n\timpl \u003c'dat, IntoIter\u003e IntoIteratorExt for \u0026 'dat IntoIter\n\t\twhere \u0026 'dat IntoIter: IntoIterator {}\n\n\tpub trait IteratorExt: Iterator {\n\n\t\t#[ inline ]\n\t\tfn collect_array \u003cconst DIM: usize\u003e (mut self) -\u003e Option \u003c[Self::Item; DIM]\u003e\n\t\t\t\twhere Self: Sized, Self::Item: Copy + Default {\n\t\t\tlet mut result = [default (); DIM];\n\t\t\tfor idx in 0 .. DIM {\n\t\t\t\tassert! (idx \u003c result.len ());\n\t\t\t\tresult [idx] = some_or! (self.next (), return None);\n\t\t\t}\n\t\t\tif self.next ().is_some () { return None }\n\t\t\tSome (result)\n\t\t}\n\n\t}\n\n\timpl \u003cSomeIter: Iterator\u003e IteratorExt for SomeIter {}\n\n\tpub trait IteratorResultExt \u003cItem, Error\u003e: Iterator \u003cItem = Result \u003cItem, Error\u003e\u003e {\n\n\t\t#[ inline ]\n\t\tfn collect_array_ok \u003cconst DIM: usize\u003e (mut self) -\u003e Result \u003cOption \u003c[Item; DIM]\u003e, Error\u003e\n\t\t\t\twhere Self: Sized, Item: Copy + Default {\n\t\t\tlet mut result = [default (); DIM];\n\t\t\tfor idx in 0 .. DIM {\n\t\t\t\tassert! (idx \u003c result.len ());\n\t\t\t\tresult [idx] = some_or! (self.next (), return Ok (None)) ?;\n\t\t\t}\n\t\t\tif self.next ().is_some () { return Ok (None) }\n\t\t\tOk (Some (result))\n\t\t}\n\n\t}\n\n\timpl \u003cItem, Error, SomeIter: Iterator \u003cItem = Result \u003cItem, Error\u003e\u003e\u003e IteratorResultExt \u003cItem, Error\u003e for SomeIter {}\n\n}\n\nmod prelude {\n\n\tpub use clap;\n\n\tpub use aoc_misc::*;\n\tpub use aoc_nums as nums;\n\n\tpub use crate::iter_ext::IntoIteratorExt as _;\n\tpub use crate::iter_ext::IteratorExt as _;\n\tpub use crate::iter_ext::IteratorResultExt as _;\n\tpub use crate::nums::Int as _;\n\tpub use crate::nums::IntConv as _;\n\n}\n","traces":[{"line":41,"address":[32704],"length":1,"stats":{"Line":29},"fn_name":"iter_vals\u003c\u0026alloc::vec::Vec\u003cu64, alloc::alloc::Global\u003e, u64\u003e"},{"line":45,"address":[32713],"length":1,"stats":{"Line":30},"fn_name":null},{"line":56,"address":[97482,96752],"length":1,"stats":{"Line":3},"fn_name":"collect_array\u003ccore::iter::adapters::map::Map\u003ccore::ops::range::Range\u003cu32\u003e, aoc_2016_day_11::logic::{impl#1}::expand::{closure_env#0}\u003e, 7\u003e"},{"line":58,"address":[96774,96818],"length":1,"stats":{"Line":6},"fn_name":null},{"line":59,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":63,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":64,"address":[97502],"length":1,"stats":{"Line":3},"fn_name":null},{"line":74,"address":[71990,71024,71965],"length":1,"stats":{"Line":2},"fn_name":"collect_array_ok\u003ccore::iter::adapters::take::Take\u003ccore::iter::adapters::chain::Chain\u003ccore::iter::adapters::map::Map\u003ccore::slice::iter::Iter\u003calloc::rc::Rc\u003cstr\u003e\u003e, aoc_2016_day_11::logic::{impl#0}::from_input::{closure_env#2}\u003e, core::iter::sources::from_fn::FromFn\u003caoc_2016_day_11::logic::{impl#0}::from_input::{closure_env#3}\u003e\u003e\u003e, [u8; 2], alloc::boxed::Box\u003cdyn std::error::Error, alloc::alloc::Global\u003e, 7\u003e"},{"line":76,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":81,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":82,"address":[],"length":0,"stats":{"Line":2},"fn_name":null}],"covered":16,"coverable":16},{"path":["/","home","runner","work","advent-of-code","advent-of-code","common","src","parser.rs"],"content":"use super::*;\n\npub type ParseResult \u003cItem\u003e = Result \u003cItem, ParseError\u003e;\n\n#[ derive (Clone) ]\npub struct Parser \u003c'inp\u003e {\n\tinput: \u0026 'inp str,\n\tpos: usize,\n\tword_pred: fn (char) -\u003e bool,\n\tignore_whitespace: bool,\n\tconfirmed: bool,\n}\n\n#[ derive (Debug) ]\npub enum ParseError {\n\tSimple (usize),\n\tWrapped (GenError),\n}\n\npub trait ResultExt \u003cItem\u003e {\n\n\t/// Map error from [`ParseError`] to `Box \u003cdyn Error\u003e` using the provided function\n\t///\n\t#[ allow (clippy::missing_errors_doc) ]\n\tfn map_parse_err \u003cMapFn, IntoGenErr\u003e (self, map_fn: MapFn) -\u003e GenResult \u003cItem\u003e\n\t\twhere\n\t\t\tMapFn: Fn (usize) -\u003e IntoGenErr,\n\t\t\tIntoGenErr: Into \u003cGenError\u003e;\n\n}\n\nimpl \u003cItem\u003e ResultExt \u003cItem\u003e for Result \u003cItem, ParseError\u003e {\n\n\t#[ inline ]\n\tfn map_parse_err \u003cMapFn, IntoGenErr\u003e (self, map_fn: MapFn) -\u003e GenResult \u003cItem\u003e\n\t\twhere\n\t\t\tMapFn: Fn (usize) -\u003e IntoGenErr,\n\t\t\tIntoGenErr: Into \u003cGenError\u003e {\n\t\tmatch self {\n\t\t\tOk (item) =\u003e Ok (item),\n\t\t\tErr (ParseError::Simple (char_idx)) =\u003e Err (map_fn (char_idx).into ()),\n\t\t\tErr (ParseError::Wrapped (err)) =\u003e Err (err),\n\t\t}\n\t}\n\n}\n\nimpl Display for ParseError {\n\n\t#[ inline ]\n\tfn fmt (\u0026 self, formatter: \u0026 mut fmt::Formatter) -\u003e fmt::Result {\n\t\tmatch * self {\n\t\t\tSelf::Simple (char_idx) =\u003e\n\t\t\t\twrite! (formatter, \"Parser error at col {}\", char_idx + 1) ?,\n\t\t\tSelf::Wrapped (ref inner) =\u003e\n\t\t\t\tDisplay::fmt (inner, formatter) ?,\n\t\t}\n\t\tOk (())\n\t}\n\n}\n\nimpl Error for ParseError {\n}\n\nimpl From \u003cGenError\u003e for ParseError {\n\n\t#[ inline ]\n    fn from (other: GenError) -\u003e Self {\n        Self::Wrapped (other)\n    }\n\n}\n\nimpl From \u003cnums::Overflow\u003e for ParseError {\n\n\t#[ inline ]\n\tfn from (other: nums::Overflow) -\u003e Self {\n\t\tSelf::Wrapped (Box::new (other))\n\t}\n\n}\n\nimpl From \u003c\u0026 str\u003e for ParseError {\n\n\t#[ inline ]\n\tfn from (other: \u0026 str) -\u003e Self {\n\t\tSelf::Wrapped (other.into ())\n\t}\n\n}\n\nimpl \u003c'inp\u003e Parser \u003c'inp\u003e {\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn new (input: \u0026 'inp str) -\u003e Parser \u003c'inp\u003e {\n\t\tParser {\n\t\t\tinput,\n\t\t\tpos: 0,\n\t\t\tword_pred: |ch| ! ch.is_whitespace (),\n\t\t\tignore_whitespace: false,\n\t\t\tconfirmed: false,\n\t\t}\n\t}\n\n\t#[ inline ]\n\tpub fn confirm (\u0026 mut self) -\u003e \u0026 mut Self {\n\t\tself.confirmed = true;\n\t\tself\n\t}\n\n\t#[ inline ]\n\tpub fn set_ignore_whitespace (\u0026 mut self, ignore_whitespace: bool) -\u003e \u0026 mut Self {\n\t\tself.ignore_whitespace = ignore_whitespace;\n\t\tself\n\t}\n\n\t#[ inline ]\n\tpub fn set_word_pred (\u0026 mut self, word_pred: fn (char) -\u003e bool) -\u003e \u0026 mut Self {\n\t\tself.word_pred = word_pred;\n\t\tself\n\t}\n\n\t/// Consume a specific string from the input\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (self.err ())` if the input does not match the specified value\n\t///\n\t#[ inline ]\n\tpub fn expect (\u0026 mut self, expect: \u0026 str) -\u003e ParseResult \u003c\u0026 mut Self\u003e {\n\t\tif self.ignore_whitespace { self.skip_whitespace (); }\n\t\tfor expect_char in expect.chars () {\n\t\t\tif self.peek () != Some (expect_char) { Err (self.err ()) ? }\n\t\t\tself.next ();\n\t\t}\n\t\tif self.ignore_whitespace { self.skip_whitespace (); }\n\t\tOk (self)\n\t}\n\n\t/// Consume a specific word from the input\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (self.err ())` if the input does not match the specified value\n\t///\n\t#[ inline ]\n\tpub fn expect_word (\u0026 mut self, expect: \u0026 str) -\u003e ParseResult \u003c\u0026 mut Self\u003e {\n\t\tif self.word () ? != expect { Err (self.err ()) ? }\n\t\tOk (self)\n\t}\n\n\t/// Consume and return a decimal number from the input\n\t///\n\t/// In fact, this will work for any type which implements [`FromStr`], but it is intended for\n\t/// use with numbers.\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (self.err ())` if parse returns an `Err`\n\t///\n\t#[ inline ]\n\tpub fn int \u003cIntType\u003e (\u0026 mut self) -\u003e ParseResult \u003cIntType\u003e where IntType: FromStr {\n\t\tself.int_real ().parse ().map_err (|_err| self.err ())\n\t}\n\n\t#[ inline ]\n\tpub fn item \u003cItem\u003e (\u0026 mut self) -\u003e ParseResult \u003cItem\u003e where Item: FromParser {\n\t\tItem::from_parser (self)\n\t}\n\n\t#[ allow (clippy::string_slice) ]\n\tfn int_real (\u0026 mut self) -\u003e \u0026 str {\n\t\tif self.ignore_whitespace { self.skip_whitespace (); }\n\t\tlet len =\n\t\t\tself.input.chars ()\n\t\t\t\t.enumerate ()\n\t\t\t\t.take_while (|\u0026 (idx, letter)|\n\t\t\t\t\tletter.is_ascii_digit () || (idx == 0 \u0026\u0026 (letter == '-' || letter == '+')))\n\t\t\t\t.map (|(_, letter)| letter.len_utf8 ())\n\t\t\t\t.sum ();\n\t\tlet val = \u0026 self.input [0 .. len];\n\t\tself.input = \u0026 self.input [len .. ];\n\t\tif self.ignore_whitespace { self.skip_whitespace (); }\n\t\tval\n\t}\n\n\t/// Consume and return a single word from the input\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (self.err ())` if there is no word remaining\n\t///\n\t#[ allow (clippy::missing_inline_in_public_items) ]\n\t#[ allow (clippy::string_slice) ]\n\tpub fn word (\u0026 mut self) -\u003e ParseResult \u003c\u0026 'inp str\u003e {\n\t\tif self.ignore_whitespace { self.skip_whitespace (); }\n\t\tlet input_temp = self.input;\n\t\tlet start = self.pos;\n\t\twhile let Some (letter) = self.peek () {\n\t\t\tif ! (self.word_pred) (letter) { break }\n\t\t\tself.next ().unwrap ();\n\t\t}\n\t\tlet end = self.pos;\n\t\tif start == end { Err (self.err ()) ? }\n\t\tif self.ignore_whitespace { self.skip_whitespace (); }\n\t\tOk (\u0026 input_temp [ .. end - start])\n\t}\n\n\t/// Consume and return a single word from the input, transforming it with [`TryInto::into`]\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (self.err ())` if there is no word remaining.\n\t///\n\t/// Returns `Err (ParseError::Wrapped (err))` if the conversion fails.\n\t///\n\t#[ inline ]\n\tpub fn word_into \u003c'par_1, Output\u003e (\u0026 'par_1 mut self) -\u003e ParseResult \u003cOutput\u003e\n\t\t\twhere Output: TryFrom \u003c\u0026 'par_1 str, Error = GenError\u003e {\n\t\tOk (self.word () ?.try_into () ?)\n\t}\n\n\t/// Consume and return a single word from the input, validating it with the provided function\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (self.err ())` if there is no word remaining, or if the provided predicate\n\t/// function returns false\n\t///\n\t#[ inline ]\n\tpub fn word_if \u003c'par_1, PredFn\u003e (\n\t\t\u0026 'par_1 mut self,\n\t\tpred: PredFn,\n\t) -\u003e ParseResult \u003c\u0026 'inp str\u003e\n\t\t\twhere PredFn: Fn (\u0026 'inp str) -\u003e bool {\n\t\tlet word = self.word () ?;\n\t\tif ! pred (word) { Err (self.err ()) ?; }\n\t\tOk (word)\n\t}\n\n\t/// Return a word from the input without consuming it\n\t///\n\t#[ inline ]\n\tpub fn peek_word (\u0026 mut self) -\u003e Option \u003c\u0026 'inp str\u003e {\n\t\tself.clone ().word ().ok ()\n\t}\n\n\t/// Consume any whitespace from the start of the remaining input\n\t///\n\t#[ inline ]\n\tpub fn skip_whitespace (\u0026 mut self) -\u003e \u0026 mut Self {\n\t\twhile let Some (letter) = self.peek () {\n\t\t\tif ! letter.is_whitespace () { break }\n\t\t\tself.next ().unwrap ();\n\t\t}\n\t\tself\n\t}\n\n\t/// Assert that there is no more input to consume\n\t///\n\t/// # Errors\n\t///\n\t/// Returns `Err (self.err ())` if there is more input.\n\t///\n\t#[ inline ]\n\tpub fn end (\u0026 mut self) -\u003e ParseResult \u003c()\u003e {\n\t\tif self.peek ().is_some () { Err (self.err ()) ? }\n\t\tOk (())\n\t}\n\n\t/// Consume and return the next character from the input\n\t///\n\t#[ allow (clippy::should_implement_trait) ]\n\t#[ allow (clippy::string_slice) ]\n\t#[ inline ]\n\tpub fn next (\u0026 mut self) -\u003e Option \u003cchar\u003e {\n\t\tlet letter_opt = self.input.chars ().next ();\n\t\tif let Some (letter) = letter_opt {\n\t\t\tself.input = \u0026 self.input [letter.len_utf8 () .. ];\n\t\t\tself.pos += letter.len_utf8 ();\n\t\t}\n\t\tletter_opt\n\t}\n\n\t/// Return the next character from the input without consuming it\n\t///\n\t#[ inline ]\n\tpub fn peek (\u0026 mut self) -\u003e Option \u003cchar\u003e {\n\t\tself.input.chars ().next ()\n\t}\n\n\t/// Consume and return the next character from the input\n\t///\n\t/// # Errors\n\t///\n\t/// Will return `Err (self.err ())` if there is no input remaining.\n\t///\n\t#[ inline ]\n\tpub fn expect_next (\u0026 mut self) -\u003e ParseResult \u003cchar\u003e {\n\t\tself.next ().ok_or_else (|| self.err ())\n\t}\n\n\t/// Return a `ParseError` with the current position\n\t///\n\t#[ inline ]\n\t#[ must_use ]\n\tpub const fn err (\u0026 self) -\u003e ParseError {\n\t    ParseError::Simple (self.pos)\n\t}\n\n\t#[ inline ]\n\tpub fn any \u003cItem\u003e (\u0026 mut self) -\u003e ParserAny \u003c'_, 'inp, Item\u003e {\n\t\tParserAny::Parser (self)\n\t}\n\n\t#[ inline ]\n\tpub fn wrap \u003cOutput, WrapFn\u003e (\n\t\tinput: \u0026 'inp str,\n\t\tmut wrap_fn: WrapFn,\n\t) -\u003e ParseResult \u003cOutput\u003e\n\t\twhere\n\t\t\tWrapFn: FnMut (\u0026 mut Parser) -\u003e ParseResult \u003cOutput\u003e {\n\t\tlet mut parser = Parser::new (input);\n\t\twrap_fn (\u0026 mut parser)\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub const fn rest (\u0026 self) -\u003e \u0026 str {\n\t\tself.input\n\t}\n\n}\n\npub enum ParserAny \u003c'par, 'inp, Item\u003e {\n\tParser (\u0026 'par mut Parser \u003c'inp\u003e),\n\tItem (Item),\n\tConfirmedError (ParseError),\n}\n\nimpl \u003c'par, 'inp, Item\u003e ParserAny \u003c'par, 'inp, Item\u003e {\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn of \u003cOfFn\u003e (self, mut of_fn: OfFn) -\u003e Self\n\t\t\twhere OfFn: FnMut (\u0026 mut Parser \u003c'inp\u003e) -\u003e ParseResult \u003cItem\u003e {\n\t\tmatch self {\n\t\t\tParserAny::Parser (parser) =\u003e {\n\t\t\t\tlet mut sub_parser = Parser { confirmed: false, .. * parser };\n\t\t\t\tmatch of_fn (\u0026 mut sub_parser) {\n\t\t\t\t\tOk (item) =\u003e {\n\t\t\t\t\t\tparser.input = sub_parser.input;\n\t\t\t\t\t\tparser.pos = sub_parser.pos;\n\t\t\t\t\t\tParserAny::Item (item)\n\t\t\t\t\t},\n\t\t\t\t\tErr (err) =\u003e\n\t\t\t\t\t\tif sub_parser.confirmed { ParserAny::ConfirmedError (err) }\n\t\t\t\t\t\telse { ParserAny::Parser (parser) },\n\t\t\t\t}\n\t\t\t},\n\t\t\tParserAny::Item (item) =\u003e ParserAny::Item (item),\n\t\t\tParserAny::ConfirmedError (err) =\u003e ParserAny::ConfirmedError (err),\n\t\t}\n\t}\n\n\t#[ inline ]\n\tpub fn done (self) -\u003e ParseResult \u003cItem\u003e {\n\t\tmatch self {\n\t\t\tParserAny::Parser (parser) =\u003e Err (parser.err ()),\n\t\t\tParserAny::Item (item) =\u003e Ok (item),\n\t\t\tParserAny::ConfirmedError (err) =\u003e Err (err),\n\t\t}\n\t}\n\n}\n\n/// Utility method to parse a parameter from the start of an input with default value\n///\n#[ inline ]\npub fn input_param \u003cVal: FromStr, Def: Into \u003cVal\u003e\u003e (\n\tinput: \u0026 mut \u0026 [\u0026 str],\n\tprefix: \u0026 str,\n\tdefault: Def,\n) -\u003e GenResult \u003cVal\u003e\n\t\twhere Val::Err: Error + 'static {\n\tOk (\n\t\tif let Some (line) = input.first () {\n\t\t\tif let Some (val) = line.strip_prefix (prefix) {\n\t\t\t\t* input = \u0026 (* input) [1 .. ];\n\t\t\t\tval.parse () ?\n\t\t\t} else { default.into () }\n\t\t} else { default.into () }\n\t)\n}\n\n/// Utility method to parse an optional parameter from the start of an input\n///\n#[ inline ]\npub fn input_param_opt \u003cVal: FromStr\u003e (\n\tinput: \u0026 mut \u0026 [\u0026 str],\n\tprefix: \u0026 str,\n) -\u003e GenResult \u003cOption \u003cVal\u003e\u003e\n\t\twhere Val::Err: Error + 'static {\n\tOk (\n\t\tif let Some (val) = input [0].strip_prefix (prefix) {\n\t\t\t* input = \u0026 (* input) [1 .. ];\n\t\t\tSome (val.parse () ?)\n\t\t} else { None }\n\t)\n}\n\n/// Utility method to prepend parameters to an example\n///\n#[ inline ]\n#[ must_use ]\npub fn with_params \u003cconst LEN: usize\u003e (\n\tparams: [\u0026 'static str; LEN],\n\texample: \u0026 [\u0026 'static str],\n) -\u003e Vec \u003c\u0026 'static str\u003e {\n\tparams.into_iter ()\n\t\t.chain (example.iter ().copied ())\n\t\t.collect ()\n}\n\n/// Trait implemented by types which can be produced by [`Parser::item`]\n///\npub trait FromParser: Sized {\n\tfn from_parser (parser: \u0026 mut Parser) -\u003e ParseResult \u003cSelf\u003e;\n}\n","traces":[{"line":35,"address":[57092,56784],"length":1,"stats":{"Line":55},"fn_name":"map_parse_err\u003caoc_2016_day_10::model::Step, aoc_2016_day_10::model::{impl#0}::parse::{closure#0}::{closure_env#1}, alloc::string::String\u003e"},{"line":39,"address":[],"length":0,"stats":{"Line":63},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":56},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":14},"fn_name":null},{"line":42,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":52,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":58,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":56},"fn_name":null},{"line":101,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":108,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":109,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":110,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":114,"address":[],"length":0,"stats":{"Line":15},"fn_name":null},{"line":115,"address":[],"length":0,"stats":{"Line":15},"fn_name":null},{"line":116,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":120,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":121,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":122,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":132,"address":[],"length":0,"stats":{"Line":38},"fn_name":null},{"line":133,"address":[],"length":0,"stats":{"Line":47},"fn_name":null},{"line":134,"address":[],"length":0,"stats":{"Line":114},"fn_name":null},{"line":135,"address":[],"length":0,"stats":{"Line":48},"fn_name":null},{"line":136,"address":[],"length":0,"stats":{"Line":38},"fn_name":null},{"line":138,"address":[],"length":0,"stats":{"Line":47},"fn_name":null},{"line":139,"address":[],"length":0,"stats":{"Line":38},"fn_name":null},{"line":149,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":150,"address":[],"length":0,"stats":{"Line":14},"fn_name":null},{"line":151,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":164,"address":[45408],"length":1,"stats":{"Line":44},"fn_name":"int\u003cu16\u003e"},{"line":165,"address":[],"length":0,"stats":{"Line":52},"fn_name":null},{"line":169,"address":[45648,45680],"length":1,"stats":{"Line":15},"fn_name":"item\u003caoc_2016_day_10::model::Target\u003e"},{"line":170,"address":[],"length":0,"stats":{"Line":15},"fn_name":null},{"line":174,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":175,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":176,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":177,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":179,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":180,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":181,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":183,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":184,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":185,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":186,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":197,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":198,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":199,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":200,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":201,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":202,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":203,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":205,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":206,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":207,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":208,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":222,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":233,"address":[35879,35264],"length":1,"stats":{"Line":3},"fn_name":"word_if\u003caoc_2015_day_19::model::{impl#0}::parse::{closure_env#0}\u003e"},{"line":238,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":239,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":240,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":246,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":247,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":253,"address":[],"length":0,"stats":{"Line":13},"fn_name":null},{"line":254,"address":[],"length":0,"stats":{"Line":13},"fn_name":null},{"line":255,"address":[],"length":0,"stats":{"Line":26},"fn_name":null},{"line":256,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":258,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":268,"address":[],"length":0,"stats":{"Line":37},"fn_name":null},{"line":269,"address":[],"length":0,"stats":{"Line":37},"fn_name":null},{"line":270,"address":[],"length":0,"stats":{"Line":37},"fn_name":null},{"line":278,"address":[],"length":0,"stats":{"Line":40},"fn_name":null},{"line":279,"address":[],"length":0,"stats":{"Line":40},"fn_name":null},{"line":280,"address":[],"length":0,"stats":{"Line":81},"fn_name":null},{"line":281,"address":[],"length":0,"stats":{"Line":80},"fn_name":null},{"line":282,"address":[],"length":0,"stats":{"Line":40},"fn_name":null},{"line":284,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":290,"address":[],"length":0,"stats":{"Line":47},"fn_name":null},{"line":291,"address":[],"length":0,"stats":{"Line":47},"fn_name":null},{"line":301,"address":[],"length":0,"stats":{"Line":10},"fn_name":null},{"line":302,"address":[],"length":0,"stats":{"Line":10},"fn_name":null},{"line":309,"address":[],"length":0,"stats":{"Line":13},"fn_name":null},{"line":310,"address":[],"length":0,"stats":{"Line":13},"fn_name":null},{"line":314,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":315,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":319,"address":[45798,45712],"length":1,"stats":{"Line":53},"fn_name":"wrap\u003caoc_2016_day_10::model::Step, aoc_2016_day_10::model::{impl#0}::parse::{closure#0}::{closure_env#0}\u003e"},{"line":325,"address":[],"length":0,"stats":{"Line":53},"fn_name":null},{"line":326,"address":[],"length":0,"stats":{"Line":54},"fn_name":null},{"line":331,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":332,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":347,"address":[43120,43937,44717,41488,42305,43984,43085,42352],"length":1,"stats":{"Line":54},"fn_name":"of\u003caoc_2016_day_10::model::Step, aoc_2016_day_10::model::{impl#1}::from_parser::{closure_env#1}\u003e"},{"line":349,"address":[],"length":0,"stats":{"Line":55},"fn_name":null},{"line":350,"address":[],"length":0,"stats":{"Line":52},"fn_name":null},{"line":351,"address":[],"length":0,"stats":{"Line":52},"fn_name":null},{"line":352,"address":[],"length":0,"stats":{"Line":102},"fn_name":null},{"line":353,"address":[],"length":0,"stats":{"Line":46},"fn_name":null},{"line":354,"address":[],"length":0,"stats":{"Line":46},"fn_name":null},{"line":355,"address":[],"length":0,"stats":{"Line":46},"fn_name":null},{"line":356,"address":[],"length":0,"stats":{"Line":46},"fn_name":null},{"line":358,"address":[],"length":0,"stats":{"Line":37},"fn_name":null},{"line":359,"address":[],"length":0,"stats":{"Line":74},"fn_name":null},{"line":360,"address":[],"length":0,"stats":{"Line":74},"fn_name":null},{"line":363,"address":[],"length":0,"stats":{"Line":38},"fn_name":null},{"line":364,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":369,"address":[],"length":0,"stats":{"Line":14},"fn_name":null},{"line":370,"address":[],"length":0,"stats":{"Line":14},"fn_name":null},{"line":371,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":372,"address":[],"length":0,"stats":{"Line":14},"fn_name":null},{"line":373,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":382,"address":[41094,40336],"length":1,"stats":{"Line":11},"fn_name":"input_param\u003cu16, u16\u003e"},{"line":389,"address":[],"length":0,"stats":{"Line":26},"fn_name":null},{"line":390,"address":[],"length":0,"stats":{"Line":31},"fn_name":null},{"line":391,"address":[],"length":0,"stats":{"Line":20},"fn_name":null},{"line":392,"address":[],"length":0,"stats":{"Line":13},"fn_name":null},{"line":393,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":394,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":401,"address":[109056],"length":1,"stats":{"Line":0},"fn_name":"input_param_opt\u003cusize\u003e"},{"line":407,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":408,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":409,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":410,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":418,"address":[41136,41461,41427],"length":1,"stats":{"Line":1},"fn_name":"with_params\u003c2\u003e"},{"line":422,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":423,"address":[],"length":0,"stats":{"Line":2},"fn_name":null}],"covered":84,"coverable":133},{"path":["/","home","runner","work","advent-of-code","advent-of-code","common","src","puzzle.rs"],"content":"use std::fs::File;\nuse std::io;\nuse std::io::BufRead as _;\nuse std::io::BufReader;\nuse std::io::Write as _;\nuse std::path::PathBuf;\nuse std::time::Instant;\n\nuse super::*;\nuse nums::IntConv;\n\npub struct RunStats {\n\tnum_correct: usize,\n\tnum_incorrect: usize,\n\tnum_unknown: usize,\n}\n\n#[ allow (clippy::missing_inline_in_public_items) ]\npub fn run_year_and_exit (\n\tpuzzles: \u0026 [Box \u003cdyn Puzzle\u003e],\n\trequire_answers: bool,\n) -\u003e GenResult \u003c()\u003e {\n\tlet stats = run_year (puzzles) ?;\n\tlet num_errors =\n\t\tif require_answers { stats.num_incorrect + stats.num_unknown }\n\t\telse { stats.num_incorrect };\n\t#[ allow (clippy::exit) ]\n\tstd::process::exit (\n\t\tif num_errors == 0 { 0 }\n\t\telse { 1 });\n}\n\n#[ allow (clippy::missing_inline_in_public_items) ]\n#[ allow (clippy::print_stdout) ]\npub fn run_year (puzzles: \u0026 [Box \u003cdyn Puzzle\u003e]) -\u003e GenResult \u003cRunStats\u003e {\n\n\tlet flush = || io::stdout ().flush ().unwrap ();\n\n\tlet mut stats = RunStats {\n\t\tnum_correct: 0,\n\t\tnum_incorrect: 0,\n\t\tnum_unknown: 0,\n\t};\n\n\t// work out max name length\n\n\tlet name_len =\n\t\tpuzzles.iter ()\n\t\t\t.map (|puzzle| puzzle.name ().len ())\n\t\t\t.max ()\n\t\t\t.unwrap ();\n\n\t// load answers\n\n\tlet answers_path = PathBuf::from (\n\t\tformat! (\"{}/inputs/answers\", puzzles [0].year ()));\n\n\tlet answers: HashMap \u003c(u8, u8), String\u003e =\n\t\tif answers_path.exists () {\n\t\t\tBufReader::new (File::open (answers_path) ?)\n\t\t\t\t.lines ()\n\t\t\t\t.map (move |line| {\n\t\t\t\t\tlet line = line ?;\n\t\t\t\t\tlet line_parts: Vec \u003cString\u003e =\n\t\t\t\t\t\tline.split (' ')\n\t\t\t\t\t\t\t.map (str::to_string)\n\t\t\t\t\t\t\t.collect ();\n\t\t\t\t\tlet day: u8 = line_parts [0].parse::\u003cu8\u003e () ?;\n\t\t\t\t\tOk (\n\t\t\t\t\t\tline_parts.into_iter ()\n\t\t\t\t\t\t\t.skip (1)\n\t\t\t\t\t\t\t.enumerate ()\n\t\t\t\t\t\t\t.map (move |(idx, val)|\n\t\t\t\t\t\t\t\t((day, idx.as_u8 ()), val))\n\t\t\t\t\t)\n\t\t\t\t})\n\t\t\t\t.flatten_ok ()\n\t\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e () ?\n\t\t} else { HashMap::new () };\n\n\t// iterate puzzles\n\n\tfor puzzle in puzzles.iter () {\n\n\t\t// load input\n\n\t\tlet input_string = puzzle.load_input () ?;\n\t\tlet input_lines: Vec \u003c\u0026 str\u003e =\n\t\t\tinput_string.trim ().split ('\\n').collect ();\n\n\t\t// print day and puzzle name\n\n\t\tprint! (\n\t\t\t\"{day:02}  {name:name_len$}\",\n\t\t\tday = puzzle.day (),\n\t\t\tname = puzzle.name (),\n\t\t\tname_len = name_len);\n\n\t\t// start timer\n\n\t\tlet start_time = time::Instant::now ();\n\n\t\t// iterate over parts\n\n\t\tlet mut errors = Vec::new ();\n\t\tfor (part_idx, part_name) in [ \"One\", \"Two\" ].into_iter ().enumerate () {\n\n\t\t\t// handle missing part\n\n\t\t\tif puzzle.num_parts () \u003c part_idx + 1 {\n\t\t\t\tprint! (\"{:24}\", \"\");\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// print part name\n\n\t\t\tprint! (\"  {}: \", part_name);\n\n\t\t\t// calculate result\n\n\t\t\tflush ();\n\n\t\t\tlet result =\n\t\t\t\tif part_idx == 0 { puzzle.part_one (\u0026 input_lines) ? }\n\t\t\t\telse { puzzle.part_two (\u0026 input_lines) ? };\n\n\t\t\t// check against answers\n\n\t\t\tif let Some (answer) = answers.get (\u0026 (puzzle.day (), part_idx.as_u8 ())) {\n\t\t\t\tif \u0026 result == answer {\n\t\t\t\t\tstats.num_correct += 1;\n\t\t\t\t} else if \u0026 result != answer {\n\t\t\t\t\tstats.num_incorrect += 1;\n\t\t\t\t\terrors.push (format! (\n\t\t\t\t\t\t\"Part {part}: Expected {answer:?}, but calculated {result:?}\",\n\t\t\t\t\t\tpart = part_idx + 1,\n\t\t\t\t\t\tanswer = answer,\n\t\t\t\t\t\tresult = result));\n\t\t\t\t} else {\n\t\t\t\t\t// no answer\n\t\t\t\t}\n\t\t\t} else { stats.num_unknown += 1; }\n\n\t\t\t// print result\n\n\t\t\tprint! (\"{:17}\", result);\n\n\t\t}\n\n\t\t// print duration\n\n\t\tlet end_time = time::Instant::now ();\n\t\tlet duration = end_time - start_time;\n\n\t\tprint! (\n\t\t\t\"Time: {millis:\u003e4}.{micros:02}ms\\n\",\n\t\t\tmillis = duration.as_millis (),\n\t\t\tmicros = (duration.as_micros () % 1000) / 10);\n\n\t\t// print errors\n\n\t\tfor error in errors {\n\t\t\tprint! (\"  {}\\n\", error);\n\t\t}\n\n\t}\n\n\tOk (stats)\n\n}\n\n#[ allow (clippy::print_stdout) ]\nfn puzzle_invoke_real (\n\tpuzzle: \u0026 dyn Puzzle,\n\targs: \u0026 [OsString],\n) -\u003e GenResult \u003c()\u003e {\n\tlet mut command = Command::new (format! (\"aoc-{}-day-{}\", puzzle.year (), puzzle.day ()));\n\tfor part_num in 1 ..= puzzle.num_parts () {\n\t\tcommand = command.subcommand (\n\t\t\tCommand::new (format! (\"part-{}\", part_num))\n\t\t\t\t.arg (\n\t\t\t\t\tclap::Arg::new (\"repeat\")\n\t\t\t\t\t\t.long (\"repeat\")\n\t\t\t\t\t\t.value_parser (clap::value_parser! (u64).range (1 .. ))\n\t\t\t\t\t\t.takes_value (true)\n\t\t\t\t\t\t.default_value (\"1\")\n\t\t\t\t\t\t.help (\"Number of times to repeat the calculation\"))\n\t\t);\n\t}\n\tfor puzzle_command in puzzle.commands () {\n\t\tcommand = command.subcommand (\n\t\t\tpuzzle_command.command ()\n\t\t\t\t.name (puzzle_command.name ())\n\t\t);\n\t}\n\tlet matches = command.get_matches_from (args);\n\tlet input_string = puzzle.load_input () ?;\n\tlet input_lines: Vec \u003c\u0026 str\u003e = input_string.trim ().split ('\\n').collect ();\n\tmatch matches.subcommand () {\n\t\tNone =\u003e {\n\t\t\tlet result = puzzle.part_one (\u0026 input_lines) ?;\n\t\t\tprintln! (\"Part one: {}\", result);\n\t\t\tif puzzle.num_parts () \u003e= 2 {\n\t\t\t\tlet result = puzzle.part_two (\u0026 input_lines) ?;\n\t\t\t\tprintln! (\"Part two: {}\", result);\n\t\t\t}\n\t\t},\n\t\tSome ((\"part-1\", matches)) =\u003e {\n\t\t\tlet repeat: u64 = * matches.get_one (\"repeat\").unwrap ();\n\t\t\trunner (repeat, |idx| {\n\t\t\t\tlet result = puzzle.part_one (\u0026 input_lines) ?;\n\t\t\t\tif idx == 0 { println! (\"Result: {}\", result); }\n\t\t\t\tOk (())\n\t\t\t}) ?;\n\t\t},\n\t\tSome ((\"part-2\", matches)) =\u003e {\n\t\t\tlet repeat: u64 = * matches.get_one (\"repeat\").unwrap ();\n\t\t\trunner (repeat, |idx| {\n\t\t\t\tlet result = puzzle.part_two (\u0026 input_lines) ?;\n\t\t\t\tif idx == 0 { println! (\"Result: {}\", result); }\n\t\t\t\tOk (())\n\t\t\t}) ?;\n\t\t},\n\t\tSome ((name, matches)) =\u003e {\n\t\t\tfor puzzle_command in puzzle.commands () {\n\t\t\t\tif puzzle_command.name () == name {\n\t\t\t\t\treturn puzzle_command.invoke (matches);\n\t\t\t\t}\n\t\t\t}\n\t\t\tunreachable! ();\n\t\t},\n\t}\n\tOk (())\n}\n\nfn percentile (times: \u0026 [u64], num: u64, denom: u64) -\u003e u64 {\n\tlet size = times.len ().as_u64 () - 1;\n\tlet idx: u64 = num * size / denom;\n\tlet rem = num * size % denom;\n\tif rem == 0 { return times [idx.as_usize ()] }\n\ttimes [idx.as_usize ()] * (denom - rem) / denom\n\t\t+ times [idx.as_usize () + 1] * rem / denom\n}\n\n#[ allow (clippy::print_stdout) ]\nfn runner \u003cInnerFn: Fn (u64) -\u003e GenResult \u003c()\u003e\u003e (repeat: u64, inner_fn: InnerFn) -\u003e GenResult \u003c()\u003e {\n\tlet times = {\n\t\tlet mut times: Vec \u003c_\u003e = (0 .. repeat)\n\t\t\t.map (|idx| { inner_fn (idx) ?; Ok (Instant::now ()) })\n\t\t\t.scan (Instant::now (), |state, cur|\n\t\t\t\tSome (cur.map (|cur| cur - mem::replace (state, cur))))\n\t\t\t.map_ok (|duration| duration.as_micros ().as_u64 ())\n\t\t\t.collect::\u003cGenResult \u003c_\u003e\u003e () ?;\n\t\ttimes.sort_unstable ();\n\t\ttimes\n\t};\n\tif repeat == 1 { return Ok (()) }\n\tlet total = times.iter ().map (|\u0026 val| val.as_u128 ()).sum::\u003cu128\u003e ();\n\tlet mean = (total / repeat.as_u128 ()).as_u64 ();\n\tlet disp_float = |val, ref_val|\n\t\tif ref_val \u003e= 2_000_000_f64 { format! (\"{:.3}s\", val / 1_000_000_f64) }\n\t\telse if ref_val \u003e= 2_000_f64 { format! (\"{:.3}ms\", val / 1_000_f64) }\n\t\telse { format! (\"{:.0}µs\", val) };\n\tlet disp = |val: u128| disp_float (val.as_f64 (), val.as_f64 ());\n\tlet disp_mean = |val: u64| disp_float (val.as_f64 (), mean.as_f64 ());\n\tlet disp_pc = |pc| disp_float (percentile (\u0026 times, pc, 1000).as_f64 (), mean.as_f64 ());\n\tprint! (\"Statistics: total={} count={} mean={},\", disp (total), repeat, disp_mean (mean));\n\tconst PERCENTILE_OPTIONS: \u0026 [(u64, \u0026 [u64])] = \u0026 [\n\t\t(1000, \u0026 [0, 500, 900, 990, 999, 1000]),\n\t\t(100, \u0026 [0, 500, 900, 990, 1000]),\n\t\t(25, \u0026 [0, 500, 750, 900, 1000]),\n\t\t(10, \u0026 [0, 500, 900, 1000]),\n\t\t(0, \u0026 []),\n\t];\n\tfor (min_repeat, percentiles) in PERCENTILE_OPTIONS.iter ().copied () {\n\t\tif repeat \u003c min_repeat * 2 { continue }\n\t\tfor percentile in percentiles.iter ().copied () {\n\t\t\tif percentile % 10 == 0 {\n\t\t\t\tprint! (\" p{}={}\", percentile / 10, disp_pc (percentile));\n\t\t\t} else {\n\t\t\t\tprint! (\" p{}={}\", percentile.as_f64 () / 10.0_f64, disp_pc (percentile));\n\t\t\t}\n\t\t}\n\t\tif percentiles.is_empty () {\n\t\t\tprint! (\" min={} median={} max={}\", disp_pc (0), disp_pc (500), disp_pc (1000));\n\t\t}\n\t\tbreak;\n\t}\n\tprint! (\"\\n\");\n\tOk (())\n}\n\n#[ allow (clippy::missing_inline_in_public_items) ]\npub trait Puzzle {\n\n\tfn dyn_puzzle (\u0026 self) -\u003e \u0026 dyn Puzzle;\n\n\tfn name (\u0026 self) -\u003e \u0026 'static str;\n\tfn year (\u0026 self) -\u003e u16;\n\tfn day (\u0026 self) -\u003e u8;\n\n\t#[ inline ]\n\tfn part_one (\u0026 self, _lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cString\u003e { unimplemented! () }\n\n\t#[ inline ]\n\tfn part_two (\u0026 self, _lines: \u0026 [\u0026 str]) -\u003e GenResult \u003cString\u003e { unimplemented! () }\n\n\tfn num_parts (\u0026 self) -\u003e usize;\n\n\t#[ inline ]\n\tfn commands (\u0026 self) -\u003e Vec \u003cPuzzleCommand\u003e {\n\t\tVec::new ()\n\t}\n\n\t#[ inline ]\n\tfn set_default_params (\u0026 mut self) { }\n\n\tfn set_param_real (\u0026 mut self, name: String, value: String);\n\n\t#[ inline ]\n\tfn set_param (\u0026 mut self, name: \u0026 str, value: String) {\n\t\tself.set_param_real (name.to_owned (), value);\n\t}\n\n\t#[ inline ]\n\tfn invoke (\u0026 self, args: \u0026 [OsString]) -\u003e GenResult \u003c()\u003e {\n\t\tpuzzle_invoke_real (self.dyn_puzzle (), args)\n\t}\n\n\tfn load_input (\u0026 self) -\u003e GenResult \u003cString\u003e {\n\t\tlet input_path = [\n\t\t\tformat! (\"{:04}/inputs/day-{:02}\", self.year (), self.day ()),\n\t\t\tformat! (\"inputs/day-{:02}\", self.day ()),\n\t\t\tformat! (\"../inputs/day-{:02}\", self.day ()),\n\t\t].into_iter ()\n\t\t\t.find (|path| Path::new (path).exists ())\n\t\t\t.ok_or_else (|| format! (\n\t\t\t\t\"Unable to find inputs/day-{:02} in \\\"{:04}\\\", \\\".\\\" or \\\"..\\\"\",\n\t\t\t\tself.day (),\n\t\t\t\tself.year ())) ?;\n\t\tlet input_string = fs::read_to_string (input_path) ?;\n\t\tOk (input_string)\n\t}\n\n}\n\npub struct PuzzleCommand {\n\tname: \u0026 'static str,\n\tinvoke_fn: Box \u003cdyn Fn (\u0026 ArgMatches) -\u003e GenResult \u003c()\u003e\u003e,\n\tmagic: Box \u003cdyn MagicTrait\u003e,\n}\n\ntrait MagicTrait {\n\tfn command \u003c'help\u003e (\u0026 self) -\u003e Command \u003c'help\u003e;\n}\n\nstruct MagicStruct \u003cArgs\u003e {\n\tphantom: PhantomData \u003cArgs\u003e,\n}\n\nimpl \u003cArgs: clap::CommandFactory\u003e MagicTrait for MagicStruct \u003cArgs\u003e {\n\tfn command \u003c'help\u003e (\u0026 self) -\u003e Command \u003c'help\u003e { Args::command () }\n}\n\nimpl PuzzleCommand {\n\n\t#[ inline ]\n\tpub fn new \u003c\n\t\tArgs: clap::Parser + 'static,\n\t\tInvokeFn: Fn (Args) -\u003e GenResult \u003c()\u003e + 'static,\n\t\u003e (\n\t\tname: \u0026 'static str,\n\t\tinvoke_fn: InvokeFn,\n\t) -\u003e Self {\n\n\t\tlet invoke_fn = Box::new (\n\t\t\tmove |matches: \u0026 _| invoke_fn (Args::from_arg_matches (matches).unwrap ()),\n\t\t);\n\n\t\tlet magic: Box \u003cMagicStruct \u003cArgs\u003e\u003e = Box::new (MagicStruct {\n\t\t\tphantom: PhantomData,\n\t\t});\n\n\t\tSelf { name, invoke_fn, magic }\n\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub const fn name (\u0026 self) -\u003e \u0026 str {\n\t\tself.name\n\t}\n\n\t#[ inline ]\n\t#[ must_use ]\n\tpub fn command \u003c'help\u003e (\u0026 self) -\u003e Command \u003c'help\u003e {\n\t\tself.magic.command ()\n\t}\n\n\t#[ inline ]\n\tpub fn invoke (\u0026 self, args: \u0026 ArgMatches) -\u003e GenResult \u003c()\u003e {\n\t\t(self.invoke_fn) (args)\n\t}\n\n}\n\n#[ macro_export ]\nmacro_rules! puzzle_info {\n\n\t(\n\t\tname = $name:literal ;\n\t\tyear = $year:literal ;\n\t\tday = $day:literal ;\n\t\t$($rest4:tt)*\n\t) =\u003e {\n\t\tpub fn puzzle_metadata () -\u003e Box \u003cdyn ::aoc_common::puzzle::Puzzle\u003e {\n\t\t\tuse ::aoc_common::puzzle::Puzzle;\n\t\t\tstruct ThisPuzzle { params: HashMap \u003cString, String\u003e }\n\t\t\timpl Puzzle for ThisPuzzle {\n\t\t\t\tfn dyn_puzzle (\u0026 self) -\u003e \u0026 dyn Puzzle { self }\n\t\t\t\tfn name (\u0026 self) -\u003e \u0026 'static str { $name }\n\t\t\t\tfn year (\u0026 self) -\u003e u16 { $year }\n\t\t\t\tfn day (\u0026 self) -\u003e u8 { $day }\n\t\t\t\tfn set_param_real (\u0026 mut self, name: String, value: String) {\n\t\t\t\t\tself.params.insert (name, value);\n\t\t\t\t}\n\t\t\t\tpuzzle_info! { @rest (input, Ok::\u003c_, Infallible\u003e (input), 0) $($rest4)* }\n\t\t\t}\n\t\t\tlet mut puzzle = ThisPuzzle { params: HashMap::new () };\n\t\t\tpuzzle.set_default_params ();\n\t\t\tBox::new (puzzle)\n\t\t}\n\t};\n\n\t( @rest ($parse_input:ident, $parse_expr:expr, $num_parts:expr) ) =\u003e {\n\t\tfn num_parts (\u0026 self) -\u003e usize { $num_parts }\n\t};\n\t( @rest ($parse_input_old:ident, $parse_expr_old:expr, $num_parts:expr)\n\t\tparse = |$parse_input:ident| $parse_expr:expr;\n\t\t$($rest1:tt)*\n\t) =\u003e {\n\t\tpuzzle_info! { @rest ($parse_input, $parse_expr, $num_parts) $($rest1)* }\n\t};\n\t( @rest ($parse_input:ident, $parse_expr:expr, $num_parts:expr)\n\t\tpart_one = |$part_input:ident $(, $param_name:ident : $param_type:ty)*| $part_expr:expr;\n\t\t$($rest0:tt)*\n\t) =\u003e {\n\t\tfn part_one (\u0026 self, $parse_input: \u0026 [\u0026 str]) -\u003e GenResult \u003cString\u003e {\n\t\t\t$(\n\t\t\t\tlet $param_name: $param_type =\n\t\t\t\t\tself.params [stringify! ($param_name)].parse ().unwrap ();\n\t\t\t)*\n\t\t\tlet $part_input = $parse_expr ?;\n\t\t\tlet result = $part_expr ?;\n\t\t\tOk (format! (\"{}\", result))\n\t\t}\n\t\tpuzzle_info! { @rest ($parse_input, $parse_expr, $num_parts + 1) $($rest0)* }\n\t};\n\t( @rest ($parse_input:ident, $parse_expr:expr, $num_parts:expr)\n\t\tpart_two = |$part_input:ident $(, $param_name:ident : $param_type:ty)*| $part_expr:expr;\n\t\t$($rest0:tt)*\n\t) =\u003e {\n\t\tfn part_two (\u0026 self, $parse_input: \u0026 [\u0026 str]) -\u003e GenResult \u003cString\u003e {\n\t\t\t$(\n\t\t\t\tlet $param_name: $param_type =\n\t\t\t\t\tself.params [stringify! ($param_name)].parse ().unwrap ();\n\t\t\t)*\n\t\t\tlet $part_input = $parse_expr ?;\n\t\t\tlet result = $part_expr ?;\n\t\t\tOk (format! (\"{}\", result))\n\t\t}\n\t\tpuzzle_info! { @rest ($parse_input, $parse_expr, $num_parts + 1) $($rest0)* }\n\t};\n\t( @rest ($parse_input:ident, $parse_expr:expr, $num_parts:expr)\n\t\tcommands = [ $($commands:tt)* ];\n\t\t$($rest3:tt)*\n\t) =\u003e {\n\t\tfn commands (\u0026 self) -\u003e Vec \u003c::aoc_common::puzzle::PuzzleCommand\u003e {\n\t\t\tlet mut commands = Vec::new ();\n\t\t\tpuzzle_info! { @commands commands $($commands)* }\n\t\t\tcommands\n\t\t}\n\t\tpuzzle_info! { @rest ($parse_input, $parse_expr, $num_parts) $($rest3)* }\n\t};\n\t( @rest ($parse_input:ident, $parse_expr:expr, $num_parts:expr)\n\t\tparams = [ $($params:tt)* ];\n\t\t$($rest:tt)*\n\t) =\u003e {\n\t\tfn set_default_params (\u0026 mut self) {\n\t\t\tpuzzle_info! { @params self $($params)* }\n\t\t}\n\t\tpuzzle_info! { @rest ($parse_input, $parse_expr, $num_parts) $($rest)* }\n\t};\n\n\t( @params ) =\u003e {};\n\t( @params $self:ident $name:ident : $type:ty = $val:expr ; $($rest:tt)* ) =\u003e {\n\t\t$self.set_param_real (stringify! ($name).to_owned (), format! (\"{}\", $val as $type));\n\t\tpuzzle_info! { @params $($rest)* }\n\t};\n\n\t( @commands $commands:ident ) =\u003e {};\n\t( @commands $commands:ident (\n\t\tname = $name:literal ;\n\t\tmethod = $method:expr ;\n\t) ) =\u003e {\n\t\t$commands.push (::aoc_common::puzzle::PuzzleCommand::new ($name, $method));\n\t};\n\t( @commands $commands:ident (\n\t\tname = $name:literal ;\n\t\tmethod = $method:expr ;\n\t) , $($rest:tt)* ) =\u003e {\n\t\t$commands.push (::aoc_common::puzzle::PuzzleCommand::new ($name, $method));\n\t\tpuzzle_info! { @commands $commands $($rest)* }\n\t};\n\n}\n","traces":[{"line":19,"address":[290048],"length":1,"stats":{"Line":0},"fn_name":"run_year_and_exit"},{"line":23,"address":[290215,290092],"length":1,"stats":{"Line":0},"fn_name":null},{"line":24,"address":[290294,290209],"length":1,"stats":{"Line":0},"fn_name":null},{"line":26,"address":[290281],"length":1,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[290361],"length":1,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[290385],"length":1,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[290416,296825,295775],"length":1,"stats":{"Line":0},"fn_name":"run_year"},{"line":37,"address":[290493],"length":1,"stats":{"Line":0},"fn_name":null},{"line":47,"address":[290545],"length":1,"stats":{"Line":0},"fn_name":null},{"line":49,"address":[331438,331424],"length":1,"stats":{"Line":0},"fn_name":"{closure#1}"},{"line":56,"address":[290685,290947],"length":1,"stats":{"Line":0},"fn_name":null},{"line":58,"address":[291483,291043,290963],"length":1,"stats":{"Line":0},"fn_name":null},{"line":60,"address":[291088,291286,291309,291525],"length":1,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[331713,331488,332387],"length":1,"stats":{"Line":0},"fn_name":"{closure#2}"},{"line":63,"address":[331513,331681],"length":1,"stats":{"Line":0},"fn_name":null},{"line":65,"address":[331772,331659],"length":1,"stats":{"Line":0},"fn_name":null},{"line":67,"address":[331842],"length":1,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[332134,331850,331927],"length":1,"stats":{"Line":0},"fn_name":null},{"line":69,"address":[332307],"length":1,"stats":{"Line":0},"fn_name":null},{"line":70,"address":[332066,332271,332230],"length":1,"stats":{"Line":0},"fn_name":null},{"line":73,"address":[332617,332416,332435,332264],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":74,"address":[332461],"length":1,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[291259,291078,291629,291539],"length":1,"stats":{"Line":0},"fn_name":null},{"line":83,"address":[291606,291687,291895],"length":1,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[291919,292090],"length":1,"stats":{"Line":0},"fn_name":null},{"line":88,"address":[292243,292056],"length":1,"stats":{"Line":0},"fn_name":null},{"line":93,"address":[292555,292429],"length":1,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[292414,292341],"length":1,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[292492],"length":1,"stats":{"Line":0},"fn_name":null},{"line":101,"address":[292846],"length":1,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[292927],"length":1,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[294154,292946,293088],"length":1,"stats":{"Line":0},"fn_name":null},{"line":110,"address":[293314],"length":1,"stats":{"Line":0},"fn_name":null},{"line":111,"address":[293457],"length":1,"stats":{"Line":0},"fn_name":null},{"line":117,"address":[293635,293419],"length":1,"stats":{"Line":0},"fn_name":null},{"line":121,"address":[293719],"length":1,"stats":{"Line":0},"fn_name":null},{"line":123,"address":[294229,294061,293734],"length":1,"stats":{"Line":0},"fn_name":null},{"line":125,"address":[293817,294071],"length":1,"stats":{"Line":0},"fn_name":null},{"line":129,"address":[294636,294172,294864],"length":1,"stats":{"Line":0},"fn_name":null},{"line":130,"address":[294779,294944,295039],"length":1,"stats":{"Line":0},"fn_name":null},{"line":131,"address":[294996,295044],"length":1,"stats":{"Line":0},"fn_name":null},{"line":132,"address":[294958,295084],"length":1,"stats":{"Line":0},"fn_name":null},{"line":133,"address":[295093,295165],"length":1,"stats":{"Line":0},"fn_name":null},{"line":134,"address":[295214,295322],"length":1,"stats":{"Line":0},"fn_name":null},{"line":136,"address":[295206,295249,295144],"length":1,"stats":{"Line":0},"fn_name":null},{"line":142,"address":[294866,294821],"length":1,"stats":{"Line":0},"fn_name":null},{"line":146,"address":[295646,294899],"length":1,"stats":{"Line":0},"fn_name":null},{"line":152,"address":[295786],"length":1,"stats":{"Line":0},"fn_name":null},{"line":153,"address":[295861],"length":1,"stats":{"Line":0},"fn_name":null},{"line":155,"address":[296114,295970],"length":1,"stats":{"Line":0},"fn_name":null},{"line":157,"address":[295919],"length":1,"stats":{"Line":0},"fn_name":null},{"line":158,"address":[296015],"length":1,"stats":{"Line":0},"fn_name":null},{"line":162,"address":[296710,296270],"length":1,"stats":{"Line":0},"fn_name":null},{"line":163,"address":[296535,296615],"length":1,"stats":{"Line":0},"fn_name":null},{"line":168,"address":[291814],"length":1,"stats":{"Line":0},"fn_name":null},{"line":173,"address":[298266,302627,296896],"length":1,"stats":{"Line":0},"fn_name":"puzzle_invoke_real"},{"line":177,"address":[296973],"length":1,"stats":{"Line":0},"fn_name":null},{"line":178,"address":[297331,297616,297396,298505],"length":1,"stats":{"Line":0},"fn_name":null},{"line":179,"address":[298402,298471,297632],"length":1,"stats":{"Line":0},"fn_name":null},{"line":180,"address":[298351,297770,297678],"length":1,"stats":{"Line":0},"fn_name":null},{"line":182,"address":[298237,298169,297911,298277,297983],"length":1,"stats":{"Line":0},"fn_name":null},{"line":183,"address":[298018],"length":1,"stats":{"Line":0},"fn_name":null},{"line":184,"address":[298026,298208,298244],"length":1,"stats":{"Line":0},"fn_name":null},{"line":187,"address":[298441,298394,297942],"length":1,"stats":{"Line":0},"fn_name":null},{"line":190,"address":[299167,297597,298548],"length":1,"stats":{"Line":0},"fn_name":null},{"line":191,"address":[298773,299011,299080],"length":1,"stats":{"Line":0},"fn_name":null},{"line":192,"address":[298883,298835,298972],"length":1,"stats":{"Line":0},"fn_name":null},{"line":193,"address":[298899,299050,299003],"length":1,"stats":{"Line":0},"fn_name":null},{"line":196,"address":[299199],"length":1,"stats":{"Line":0},"fn_name":null},{"line":197,"address":[299300,299376,299500],"length":1,"stats":{"Line":0},"fn_name":null},{"line":198,"address":[299703,299474],"length":1,"stats":{"Line":0},"fn_name":null},{"line":199,"address":[299809,299860],"length":1,"stats":{"Line":0},"fn_name":null},{"line":201,"address":[301570,301724,299885],"length":1,"stats":{"Line":0},"fn_name":null},{"line":202,"address":[301692,301892],"length":1,"stats":{"Line":0},"fn_name":null},{"line":203,"address":[301984],"length":1,"stats":{"Line":0},"fn_name":null},{"line":204,"address":[302239,302030],"length":1,"stats":{"Line":0},"fn_name":null},{"line":205,"address":[302207,302478],"length":1,"stats":{"Line":0},"fn_name":null},{"line":208,"address":[299923,300023],"length":1,"stats":{"Line":0},"fn_name":null},{"line":209,"address":[300039],"length":1,"stats":{"Line":0},"fn_name":null},{"line":210,"address":[300334,300407,300138],"length":1,"stats":{"Line":0},"fn_name":null},{"line":211,"address":[332684,332877],"length":1,"stats":{"Line":0},"fn_name":null},{"line":212,"address":[332869,332945,333039],"length":1,"stats":{"Line":0},"fn_name":null},{"line":213,"address":[332970],"length":1,"stats":{"Line":0},"fn_name":null},{"line":216,"address":[299978,300486,300583],"length":1,"stats":{"Line":0},"fn_name":null},{"line":217,"address":[300599],"length":1,"stats":{"Line":0},"fn_name":null},{"line":218,"address":[300894,300967,300698],"length":1,"stats":{"Line":0},"fn_name":null},{"line":219,"address":[333373,333180],"length":1,"stats":{"Line":0},"fn_name":null},{"line":220,"address":[333365,333441,333535],"length":1,"stats":{"Line":0},"fn_name":null},{"line":221,"address":[333466],"length":1,"stats":{"Line":0},"fn_name":null},{"line":224,"address":[300508],"length":1,"stats":{"Line":0},"fn_name":null},{"line":225,"address":[300564,301004,301456],"length":1,"stats":{"Line":0},"fn_name":null},{"line":226,"address":[301310,301237],"length":1,"stats":{"Line":0},"fn_name":null},{"line":227,"address":[301398],"length":1,"stats":{"Line":0},"fn_name":null},{"line":233,"address":[300445],"length":1,"stats":{"Line":0},"fn_name":null},{"line":236,"address":[302672],"length":1,"stats":{"Line":0},"fn_name":"percentile"},{"line":237,"address":[302832,302756],"length":1,"stats":{"Line":0},"fn_name":null},{"line":238,"address":[302870,302815,302977],"length":1,"stats":{"Line":0},"fn_name":null},{"line":239,"address":[303015,303097,302960],"length":1,"stats":{"Line":0},"fn_name":null},{"line":240,"address":[303089,303793,303132,303845],"length":1,"stats":{"Line":0},"fn_name":null},{"line":241,"address":[303674,303724,303153,303734,303421],"length":1,"stats":{"Line":0},"fn_name":null},{"line":242,"address":[303408,303456,303690],"length":1,"stats":{"Line":0},"fn_name":null},{"line":246,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":247,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":248,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":249,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":250,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":251,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":252,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":254,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":255,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":257,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":258,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":259,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":260,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":261,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":262,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":263,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":264,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":265,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":266,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":267,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":275,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":276,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":277,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":278,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":279,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":281,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":284,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":285,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":287,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":289,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":290,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":306,"address":[91586,91568],"length":1,"stats":{"Line":0},"fn_name":"part_two\u003caoc_2021_day_25::puzzle_metadata::ThisPuzzle\u003e"},{"line":311,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":312,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":316,"address":[146176,146181],"length":1,"stats":{"Line":134},"fn_name":"set_default_params\u003caoc_2021_day_13::puzzle_metadata::ThisPuzzle\u003e"},{"line":321,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":322,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":326,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":327,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":330,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":331,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":332,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":333,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":334,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":335,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":336,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":337,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":338,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":339,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":340,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":341,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":342,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":362,"address":[81729,81712],"length":1,"stats":{"Line":0},"fn_name":"command\u003caoc_2021_day_13::tool::RunArgs\u003e"},{"line":368,"address":[80896,81202],"length":1,"stats":{"Line":0},"fn_name":"new\u003caoc_2021_day_13::tool::RunArgs, fn(aoc_2021_day_13::tool::RunArgs) -\u003e core::result::Result\u003c(), alloc::boxed::Box\u003cdyn std::error::Error, alloc::alloc::Global\u003e\u003e\u003e"},{"line":377,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":380,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":381,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":390,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":391,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":396,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":397,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":401,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":402,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":416,"address":[97548,97184,97521],"length":1,"stats":{"Line":71},"fn_name":"puzzle_metadata"},{"line":420,"address":[97576,97568],"length":1,"stats":{"Line":0},"fn_name":"dyn_puzzle"},{"line":421,"address":[97600,97605],"length":1,"stats":{"Line":0},"fn_name":"name"},{"line":422,"address":[97632,97637],"length":1,"stats":{"Line":0},"fn_name":"year"},{"line":423,"address":[97648,97653],"length":1,"stats":{"Line":0},"fn_name":"day"},{"line":424,"address":[97664],"length":1,"stats":{"Line":1},"fn_name":"set_param_real"},{"line":425,"address":[97679],"length":1,"stats":{"Line":1},"fn_name":null},{"line":429,"address":[97199],"length":1,"stats":{"Line":68},"fn_name":null},{"line":430,"address":[97252],"length":1,"stats":{"Line":68},"fn_name":null},{"line":431,"address":[97191,97320],"length":1,"stats":{"Line":139},"fn_name":null},{"line":436,"address":[98965,98960],"length":1,"stats":{"Line":0},"fn_name":"num_parts"},{"line":448,"address":[97776],"length":1,"stats":{"Line":48},"fn_name":"part_one"},{"line":450,"address":[43008],"length":1,"stats":{"Line":1},"fn_name":null},{"line":451,"address":[43016],"length":1,"stats":{"Line":1},"fn_name":null},{"line":453,"address":[97827,97914],"length":1,"stats":{"Line":49},"fn_name":null},{"line":454,"address":[97916,97994],"length":1,"stats":{"Line":49},"fn_name":null},{"line":455,"address":[98057,97966],"length":1,"stats":{"Line":96},"fn_name":null},{"line":463,"address":[98793,98240],"length":1,"stats":{"Line":45},"fn_name":"part_two"},{"line":465,"address":[44016],"length":1,"stats":{"Line":1},"fn_name":null},{"line":466,"address":[44024],"length":1,"stats":{"Line":1},"fn_name":null},{"line":468,"address":[98291,98381],"length":1,"stats":{"Line":46},"fn_name":null},{"line":469,"address":[98383,98500],"length":1,"stats":{"Line":47},"fn_name":null},{"line":470,"address":[98603,98470],"length":1,"stats":{"Line":86},"fn_name":null},{"line":478,"address":[98935,98832],"length":1,"stats":{"Line":0},"fn_name":"commands"},{"line":479,"address":[98853],"length":1,"stats":{"Line":0},"fn_name":null},{"line":480,"address":[98918,98858],"length":1,"stats":{"Line":0},"fn_name":null},{"line":489,"address":[44960,45257,45226],"length":1,"stats":{"Line":1},"fn_name":"set_default_params"},{"line":490,"address":[45241,44980],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":23,"coverable":192},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-01.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_01::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tif let Ok (input) = model::parse_input (input_str) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-02.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_02::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec: Vec \u003c\u0026 str\u003e = input_str.split ('\\n').collect ();\n\tif let Ok (input) = model::parse_input (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-03.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_03::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tif let Ok (input) = model::parse_input (\u0026 input_str) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-04.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_04::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input: \u0026 str| {\n\tlet input_vec =\n\t\t[ \"NUM_ZEROS=1\", \"MAX_THREADS=1\" ].iter ().copied ()\n\t\t\t.chain (input.trim ().split ('\\n'))\n\t\t\t.collect::\u003cVec \u003c\u0026 str\u003e\u003e ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t}\n\tlet input_vec =\n\t\t[ \"NUM_ZEROS=2\", \"MAX_THREADS=1\" ].iter ().copied ()\n\t\t\t.chain (input.trim ().split ('\\n'))\n\t\t\t.collect::\u003cVec \u003c\u0026 str\u003e\u003e ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-05.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_05::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec = input_str.split ('\\n').collect::\u003cVec \u003c_\u003e\u003e ();\n\tif let Ok (input) = model::parse_input (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-06.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_06::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec = input_str.split ('\\n').collect::\u003cVec \u003c_\u003e\u003e ();\n\tif let Ok (input) = model::parse_input (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-07.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_07::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec = input_str.split ('\\n').collect::\u003cVec \u003c_\u003e\u003e ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_one (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-08.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_08::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tassert_eq! (model::decode (\u0026 model::encode (\u0026 input_str)).unwrap (), input_str);\n\tlet input_vec = input_str.split ('\\n').collect::\u003cVec \u003c_\u003e\u003e ();\n\tif let Ok (input) = model::parse_input (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-09.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_09::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec: Vec \u003c\u0026 str\u003e = input_str.trim ().split ('\\n').collect ();\n\tif let Ok (input) = model::parse_input (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-10.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_10::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tif let Ok (input) = model::State::parse (\u0026 input_str) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-11.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_11::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet _ = logic::part_one (input_str);\n\tlet _ = logic::part_two (input_str);\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-12.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_12::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tif let Ok (input) = model::Json::parse (\u0026 input_str) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-13.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_13::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec: Vec \u003c\u0026 str\u003e = input_str.trim ().split ('\\n').collect ();\n\tif let Ok (input) = model::parse_input (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-14.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_14::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec: Vec \u003c\u0026 str\u003e = input_str.trim ().split ('\\n').collect ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-15.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_15::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec: Vec \u003c\u0026 str\u003e = input_str.trim ().split ('\\n').collect ();\n\tif let Ok (input) = model::parse_input (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-16.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_16::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec: Vec \u003c\u0026 str\u003e = input_str.trim ().split ('\\n').collect ();\n\tif let Ok (input) = model::parse_input (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-17.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_17::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec = input_str.split ('\\n').collect::\u003cVec \u003c_\u003e\u003e ();\n\tif let Ok (input) = model::parse_input (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (input.clone ());\n\t\tlet _ = logic::part_two (input.clone ());\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-18.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_18::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec = input_str.split ('\\n').collect::\u003cVec \u003c_\u003e\u003e ();\n\tif let Ok (input) = model::parse_input (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (input.clone (), 2);\n\t\tlet _ = logic::part_two (input.clone (), 2);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-19.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_19::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec = input_str.trim ().split ('\\n').collect::\u003cVec \u003c_\u003e\u003e ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-20.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_20::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tif let Ok (input) = input_str.parse::\u003cu32\u003e () {\n\t\tif input \u003c 1000000 {\n\t\t\tlet _ = logic::part_one (input.clone ());\n\t\t\tlet _ = logic::part_two (input.clone ());\n\t\t}\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-21.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_21::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_lines: Vec \u003c\u0026 str\u003e = input_str.split ('\\n').collect ();\n\tif let Ok (input) = model::Stats::parse (\u0026 input_lines) {\n\t\tlet _ = logic::part_one (input.clone ());\n\t\tlet _ = logic::part_two (input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-22.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_22::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_lines: Vec \u003c\u0026 str\u003e = input_str.trim ().split ('\\n').collect ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_lines) {\n\t\tlet _ = logic::part_one (input.clone ());\n\t\tlet _ = logic::part_two (input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-23.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_23::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_lines: Vec \u003c\u0026 str\u003e = input_str.trim ().split ('\\n').collect ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_lines) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-24.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_24::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_lines: Vec \u003c\u0026 str\u003e = input_str.trim ().split ('\\n').collect ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_lines) {\n\t\tlet _ = logic::part_one (input.clone ());\n\t\tlet _ = logic::part_two (input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2015-day-25.rs"],"content":"#![ no_main ]\n\nuse aoc_2015::day_25::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tif let Ok (input) = model::Input::parse (\u0026 input_str) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-01.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_01::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tif let Ok (input) = model::Input::parse (input_str) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-02.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_02::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec = input_str.trim ().split ('\\n').collect::\u003cVec \u003c_\u003e\u003e ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-03.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_03::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec = input_str.trim ().split ('\\n').collect::\u003cVec \u003c_\u003e\u003e ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-04.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_04::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec = input_str.trim ().split ('\\n').collect::\u003cVec \u003c_\u003e\u003e ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-05.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_05::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec = vec! [ \"NUM_ZEROS=1\", input_str ];\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-06.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_06::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec: Vec \u003c\u0026 str\u003e = input_str.trim ().split ('\\n').collect ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-07.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_07::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec: Vec \u003c\u0026 str\u003e = input_str.trim ().split ('\\n').collect ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-08.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_08::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec: Vec \u003c\u0026 str\u003e =\n\t\tvec! [ \"WIDTH=10\", \"HEIGHT=6\" ].into_iter ()\n\t\t\t.chain (input_str.trim ().split ('\\n'))\n\t\t\t.collect ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-09.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_09::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet _ = logic::part_one (input_str);\n\tlet _ = logic::part_two (input_str);\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-10.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_10::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec = input_str.trim ().split ('\\n').collect::\u003cVec \u003c_\u003e\u003e ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-11.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_11::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec = input_str.trim ().split ('\\n').collect::\u003cVec \u003c_\u003e\u003e ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-12.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_12::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec =\n\t\t[ \"OPS_LIMIT=100000\" ].iter ().copied ()\n\t\t\t.chain (input_str.trim ().split ('\\n'))\n\t\t\t.collect::\u003cVec \u003c_\u003e\u003e ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-13.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_13::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec =\n\t\t[ \"MAX_DIST=100\", \"COUNT_DIST=50\" ].iter ().copied ()\n\t\t\t.chain (input_str.trim ().split ('\\n'))\n\t\t\t.collect::\u003cVec \u003c_\u003e\u003e ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-14.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_14::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec =\n\t\t[ \"NUM_KEYS=4\", \"NUM_NEXT=2000\", \"HASH_REPS=8\" ].iter ().copied ()\n\t\t\t.chain (input_str.trim ().split ('\\n'))\n\t\t\t.collect::\u003cVec \u003c_\u003e\u003e ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-15.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_15::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec: Vec \u003c\u0026 str\u003e = input_str.split ('\\n').collect ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-16.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_16::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec: Vec \u003c\u0026 str\u003e = input_str.split ('\\n').collect ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tif input.disk_size_one \u003c 1000000 {\n\t\t\tlet _ = logic::part_one (\u0026 input);\n\t\t}\n\t\tif input.disk_size_two \u003c 1000000 {\n\t\t\tlet _ = logic::part_two (\u0026 input);\n\t\t}\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-17.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_17::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec: Vec \u003c\u0026 str\u003e = input_str.split ('\\n').collect ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-18.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_18::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec: Vec \u003c\u0026 str\u003e = input_str.split ('\\n').collect ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tif input.num_rows_one \u003c= 1000 {\n\t\t\tlet _ = logic::part_one (\u0026 input);\n\t\t}\n\t\tif input.num_rows_one \u003c= 1_000_000 {\n\t\t\tlet _ = logic::part_two (\u0026 input);\n\t\t}\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-19.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_19::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec: Vec \u003c\u0026 str\u003e = input_str.split ('\\n').collect ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tif input.num_elves \u003c 1_000_000 {\n\t\t\tlet _ = logic::part_two (\u0026 input);\n\t\t}\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-20.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_20::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec: Vec \u003c\u0026 str\u003e = input_str.split ('\\n').collect ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-21.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_21::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec: Vec \u003c\u0026 str\u003e = input_str.split ('\\n').collect ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-22.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_22::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec: Vec \u003c\u0026 str\u003e = input_str.split ('\\n').collect ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-23.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_23::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec: Vec \u003c\u0026 str\u003e = input_str.split ('\\n').collect ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-24.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_24::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet mut input_vec: Vec \u003c\u0026 str\u003e = input_str.split ('\\n').collect ();\n\tif let Some (width_str) = input_vec [0].strip_prefix (\"FUZZ_WIDTH_FILTER=\") {\n\t\tif let Ok (width) = width_str.parse::\u003cusize\u003e () {\n\t\t\tinput_vec = input_vec.iter ().copied ()\n\t\t\t\t.skip (1)\n\t\t\t\t.filter (|line| width \u003c= line.chars ().count ())\n\t\t\t\t.collect ();\n\t\t\tif input_vec.is_empty () { input_vec.push (\"\"); }\n\t\t}\n\t}\n\tif let Some (width_str) = input_vec [0].strip_prefix (\"FUZZ_WIDTH_TRUNCATE=\") {\n\t\tif let Ok (width) = width_str.parse () {\n\t\t\tinput_vec.remove (0);\n\t\t\tfor line in input_vec.iter_mut () {\n\t\t\t\tif line.chars ().count () \u003e width {\n\t\t\t\t\tlet num_bytes = line.chars ()\n\t\t\t\t\t\t.take (width)\n\t\t\t\t\t\t.map (|ch| ch.len_utf8 ())\n\t\t\t\t\t\t.sum ();\n\t\t\t\t\t* line = \u0026 line [0 .. num_bytes];\n\t\t\t\t}\n\t\t\t}\n\t\t\tif input_vec.is_empty () { input_vec.push (\"\"); }\n\t\t}\n\t}\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t\tlet _ = logic::part_two (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","fuzz","src","2016-day-25.rs"],"content":"#![ no_main ]\n\nuse aoc_2016::day_25::*;\nuse libfuzzer_sys::fuzz_target;\n\nfuzz_target! (|input_str: \u0026 str| {\n\tlet input_vec: Vec \u003c\u0026 str\u003e =\n\t\t\t[ \"LIMIT=400\" ].iter ().copied ()\n\t\t.chain (input_str.split ('\\n'))\n\t\t.collect ();\n\tif let Ok (input) = model::Input::parse (\u0026 input_vec) {\n\t\tlet _ = logic::part_one (\u0026 input);\n\t}\n});\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","advent-of-code","advent-of-code","misc","codegen","src","lib.rs"],"content":"//! Generate boilerplate code, run from build.rs\n\nuse std::collections::HashMap;\nuse std::env;\nuse std::error::Error;\nuse std::fs;\nuse std::fs::File;\nuse std::io::Write;\nuse std::iter;\nuse std::mem;\nuse std::path::PathBuf;\n\n/// Entry point for code generation\n///\n/// # Errors\n///\n/// Returns any errors from the underlying IO operations unchanged\n///\n/// # Panics\n///\n/// If the package name does not conform to expectations.\n///\n#[ allow (clippy::missing_inline_in_public_items) ]\n#[ allow (clippy::print_stdout) ]\npub fn invoke () -\u003e Result \u003c(), Box \u003cdyn Error\u003e\u003e {\n\tprintln! (\"cargo:rerun-if-changed=build.rs\");\n\tprintln! (\"cargo:rerun-if-changed=.\");\n\tlet pkg_name = env::var (\"CARGO_PKG_NAME\") ?;\n\tif pkg_name == \"aoc-common\" {\n\t\tlet home = env::current_dir () ?;\n\t\tfor year in [\"2015\", \"2021\"] {\n\t\t\tenv::set_current_dir (format! (\"../{}\", year)) ?;\n\t\t\tprepare_year (year) ?;\n\t\t\tenv::set_current_dir (\u0026 home) ?;\n\t\t}\n\t} else {\n\t\tlet pkg_name_parts: Vec \u003c\u0026 str\u003e = pkg_name.split ('-').collect ();\n\t\tif pkg_name_parts.len () \u003c 2 { Err (\"Invalid package name\") ? }\n\t\tif pkg_name_parts [0] != \"aoc\" { Err (\"Invalid package name\") ? }\n\t\tlet year = pkg_name_parts [1];\n\t\tif pkg_name_parts.len () == 2 {\n\t\t\tprepare_year (year) ?;\n\t\t} else if pkg_name_parts.len () == 4 {\n\t\t\tif pkg_name_parts [2] != \"day\" { Err (\"Invalid package name\") ? }\n\t\t\tlet day = pkg_name_parts [3];\n\t\t\tprepare_day (year, day) ?;\n\t\t} else { Err (\"Invalid package name\") ? }\n\t}\n\tOk (())\n}\n\n/// Generate code for a single year\n///\nfn prepare_year (year: \u0026 str) -\u003e Result \u003c(), Box \u003cdyn Error\u003e\u003e {\n\tlet static_part = |template| {\n\t\treplace_placeholders (\n\t\t\ttemplate,\n\t\t\t\u0026 HashMap::from_iter (vec! [\n\t\t\t\t(\"${YEAR}\", year),\n\t\t\t]))\n\t};\n\tlet dynamic_part = |template| {\n\t\t(1_u32 ..= 25)\n\t\t\t.filter_map (move |day|\n\t\t\t\tPathBuf::from (format! (\"day-{:02}\", day)).exists ().then_some (\n\t\t\t\t\treplace_placeholders (\n\t\t\t\t\t\ttemplate,\n\t\t\t\t\t\t\u0026 HashMap::from_iter (vec! [\n\t\t\t\t\t\t\t(\"${YEAR}\", year),\n\t\t\t\t\t\t\t(\"${DAY}\", \u0026 format! (\"{:02}\", day)),\n\t\t\t\t\t\t] ),\n\t\t\t\t\t)))\n\t\t\t.flatten ()\n\t};\n\twrite_file (\n\t\t\"src/lib.rs\",\n\t\titer::empty ()\n\t\t\t.chain (static_part (templates::YEAR_LIB [0]))\n\t\t\t.chain (dynamic_part (templates::YEAR_LIB [1]))\n\t\t\t.chain (static_part (templates::YEAR_LIB [2]))\n\t\t\t.chain (dynamic_part (templates::YEAR_LIB [3]))\n\t\t\t.chain (static_part (templates::YEAR_LIB [4])),\n\t) ?;\n\twrite_file (\n\t\t\"src/main.rs\",\n\t\tstatic_part (templates::YEAR_MAIN),\n\t) ?;\n\tOk (())\n}\n\n/// Generate code for a single day\n///\nfn prepare_day (year: \u0026 str, day: \u0026 str) -\u003e Result \u003c(), Box \u003cdyn Error\u003e\u003e {\n\twrite_file (\n\t\t\"src/main.rs\",\n\t\treplace_placeholders (templates::DAY_MAIN, \u0026 HashMap::from_iter (vec! [\n\t\t\t(\"${YEAR}\", year),\n\t\t\t(\"${DAY}\", day),\n\t\t])),\n\t) ?;\n\tOk (())\n}\n\n/// Write the provided lines to a named file\n///\nfn write_file \u003cItem: AsRef \u003cstr\u003e, LinesIter: IntoIterator \u003cItem = Item\u003e\u003e (\n\tname: \u0026 str,\n\tlines: LinesIter,\n) -\u003e Result \u003c(), Box \u003cdyn Error\u003e\u003e {\n\tlet mut new_contents = String::new ();\n\tfor line_temp in lines {\n\t\tlet line = line_temp.as_ref ();\n\t\tnew_contents.push_str (line);\n\t\tnew_contents.push ('\\n');\n\t}\n\tlet old_contents = fs::read_to_string (name).unwrap_or_default ();\n\tif old_contents != new_contents {\n\t\tlet mut main_rs_file = File::create (name) ?;\n\t\twrite! (\u0026 mut main_rs_file, \"{}\", new_contents) ?;\n\t}\n\tOk (())\n}\n\n/// Replace placeholders in some strings\n///\nfn replace_placeholders (lines: \u0026 [\u0026 str], replacements: \u0026 HashMap \u003c\u0026 str, \u0026 str\u003e) -\u003e Vec \u003cString\u003e {\n\tlines.iter ().map (|line| {\n\t\tlet (output, buffer) = line.chars ().fold ((String::new (), String::new ()),\n\t\t\t|(mut output, mut buffer), letter| {\n\t\t\t\tif (buffer.is_empty () \u0026\u0026 letter == '$')\n\t\t\t\t\t\t|| (buffer.len () == 1 \u0026\u0026 letter == '{')\n\t\t\t\t\t\t|| buffer.len () \u003e 1 {\n\t\t\t\t\tbuffer.push (letter);\n\t\t\t\t\tif letter == '}' {\n\t\t\t\t\t\tlet replacement = replacements.get (buffer.as_str ()).unwrap_or_else (||\n\t\t\t\t\t\t\tpanic! (\"Replacement not found for: {}\", buffer),\n\t\t\t\t\t\t);\n\t\t\t\t\t\toutput.push_str (replacement);\n\t\t\t\t\t\tbuffer = String::new ();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\toutput.push_str (mem::take (\u0026 mut buffer).as_str ());\n\t\t\t\t\toutput.push (letter);\n\t\t\t\t}\n\t\t\t\t(output, buffer)\n\t\t\t},\n\t\t);\n\t\tif ! buffer.is_empty () { panic! () }\n\t\toutput\n\t}).collect ()\n}\n\n/// Templates for generated file contents\n///\nmod templates {\n\n\t/// Template for lib.rs in a year\n\t///\n\tpub const YEAR_LIB: \u0026 [\u0026 [\u0026 str]] = \u0026 [\n\t\t\u0026 [\n\t\t\t\"#![ allow (clippy::missing_inline_in_public_items) ]\",\n\t\t\t\"\",\n\t\t\t\"use aoc_common::*;\",\n\t\t\t\"\",\n\t\t],\n\t\t\u0026 [\n\t\t\t\"pub use aoc_${YEAR}_day_${DAY} as day_${DAY};\",\n\t\t],\n\t\t\u0026 [\n\t\t\t\"\",\n\t\t\t\"#[ must_use ]\",\n\t\t\t\"pub fn puzzle_metadata () -\u003e Vec \u003cBox \u003cdyn puzzle::Puzzle\u003e\u003e {\",\n\t\t\t\"\\tvec! [\",\n\t\t],\n\t\t\u0026 [\n\t\t\t\"\\t\\tday_${DAY}::puzzle_metadata (),\",\n\t\t],\n\t\t\u0026 [\n\t\t\t\"\\t]\",\n\t\t\t\"}\",\n\t\t],\n\t];\n\n\t/// Template for main.rs in a year\n\t///\n\tpub const YEAR_MAIN: \u0026 [\u0026 str] = \u0026 [\n\t\t\"use aoc_common::*;\",\n\t\t\"\",\n\t\t\"fn main () -\u003e GenResult \u003c()\u003e {\",\n\t\t\"\\tpuzzle::run_year_and_exit (\u0026 aoc_${YEAR}::puzzle_metadata (), true)\",\n\t\t\"}\",\n\t];\n\n\t/// Template for main.rs in a day\n\t///\n\tpub const DAY_MAIN: \u0026 [\u0026 str] = \u0026 [\n\t\t\"use std::env;\",\n\t\t\"use std::ffi::OsString;\",\n\t\t\"\",\n\t\t\"use aoc_common::*;\",\n\t\t\"use aoc_${YEAR}_day_${DAY}::*;\",\n\t\t\"\",\n\t\t\"fn main () -\u003e GenResult \u003c()\u003e {\",\n\t\t\"\tlet args: Vec \u003cOsString\u003e = env::args_os ().collect ();\",\n\t\t\"\tpuzzle_metadata ().invoke (\u0026 args)\",\n\t\t\"}\",\n\t];\n\n}\n","traces":[{"line":25,"address":[115696,117581,119546],"length":1,"stats":{"Line":0},"fn_name":"invoke"},{"line":26,"address":[115703],"length":1,"stats":{"Line":0},"fn_name":null},{"line":27,"address":[115754],"length":1,"stats":{"Line":0},"fn_name":null},{"line":28,"address":[115966,115805],"length":1,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[115934,116139],"length":1,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[116387,116179],"length":1,"stats":{"Line":0},"fn_name":null},{"line":31,"address":[116550,117147,117466,116307],"length":1,"stats":{"Line":0},"fn_name":null},{"line":32,"address":[117034,116759],"length":1,"stats":{"Line":0},"fn_name":null},{"line":33,"address":[116995,117276,117173],"length":1,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[117261,117410,117471],"length":1,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[117684,116153],"length":1,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[117722,117785,117828],"length":1,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[118075,117791,118147],"length":1,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[118109,118381],"length":1,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[118428,119429],"length":1,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[119361,118473,119434],"length":1,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[118507,119226],"length":1,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[118822,118885,118536],"length":1,"stats":{"Line":0},"fn_name":null},{"line":45,"address":[119108,118850],"length":1,"stats":{"Line":0},"fn_name":null},{"line":46,"address":[119231,119131],"length":1,"stats":{"Line":0},"fn_name":null},{"line":47,"address":[118574,118715],"length":1,"stats":{"Line":0},"fn_name":null},{"line":49,"address":[117625],"length":1,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[119568,119965,119995],"length":1,"stats":{"Line":0},"fn_name":"prepare_year"},{"line":55,"address":[94832,95124],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":58,"address":[94974,94888],"length":1,"stats":{"Line":0},"fn_name":null},{"line":59,"address":[94921],"length":1,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[95335,95168],"length":1,"stats":{"Line":0},"fn_name":"{closure#1}"},{"line":63,"address":[95224,95295],"length":1,"stats":{"Line":0},"fn_name":null},{"line":64,"address":[95259,95344,96414,96030],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":65,"address":[95675,96348,95387],"length":1,"stats":{"Line":0},"fn_name":null},{"line":66,"address":[96292],"length":1,"stats":{"Line":0},"fn_name":null},{"line":67,"address":[95691],"length":1,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[95718,96259,96136,95826,96046],"length":1,"stats":{"Line":0},"fn_name":null},{"line":69,"address":[95745],"length":1,"stats":{"Line":0},"fn_name":null},{"line":70,"address":[95804,95868,96093],"length":1,"stats":{"Line":0},"fn_name":null},{"line":77,"address":[119637,120044,120402,120225,119706,119843],"length":1,"stats":{"Line":0},"fn_name":null},{"line":78,"address":[119642,119727],"length":1,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[119882,119988,119735],"length":1,"stats":{"Line":0},"fn_name":null},{"line":80,"address":[120006,120174,120083,119898],"length":1,"stats":{"Line":0},"fn_name":null},{"line":81,"address":[120264,120099,120184,120355],"length":1,"stats":{"Line":0},"fn_name":null},{"line":82,"address":[120488,120438,120365,120280],"length":1,"stats":{"Line":0},"fn_name":null},{"line":86,"address":[120545],"length":1,"stats":{"Line":0},"fn_name":null},{"line":88,"address":[120770],"length":1,"stats":{"Line":0},"fn_name":null},{"line":93,"address":[120848,121523],"length":1,"stats":{"Line":0},"fn_name":"prepare_day"},{"line":96,"address":[121065,120907],"length":1,"stats":{"Line":0},"fn_name":null},{"line":97,"address":[120979],"length":1,"stats":{"Line":0},"fn_name":null},{"line":98,"address":[121022],"length":1,"stats":{"Line":0},"fn_name":null},{"line":101,"address":[121567],"length":1,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[99095,97777,97808,98314,96448,96994],"length":1,"stats":{"Line":0},"fn_name":"write_file\u003calloc::string::String, alloc::vec::Vec\u003calloc::string::String, alloc::alloc::Global\u003e\u003e"},{"line":110,"address":[96486,97846],"length":1,"stats":{"Line":0},"fn_name":null},{"line":111,"address":[96563,97923,98325,98015,96654,97005],"length":1,"stats":{"Line":0},"fn_name":null},{"line":112,"address":[96928,98248,96864,98184],"length":1,"stats":{"Line":0},"fn_name":null},{"line":113,"address":[96952,98272],"length":1,"stats":{"Line":0},"fn_name":null},{"line":114,"address":[96972,98292],"length":1,"stats":{"Line":0},"fn_name":null},{"line":116,"address":[97055,98375],"length":1,"stats":{"Line":0},"fn_name":null},{"line":117,"address":[98476,97101,97156,98421],"length":1,"stats":{"Line":0},"fn_name":null},{"line":118,"address":[97207,98527,98624,97304],"length":1,"stats":{"Line":0},"fn_name":null},{"line":119,"address":[98604,97618,98938,97284,97462,98782],"length":1,"stats":{"Line":0},"fn_name":null},{"line":121,"address":[97162,98482],"length":1,"stats":{"Line":0},"fn_name":null},{"line":126,"address":[121584],"length":1,"stats":{"Line":0},"fn_name":"replace_placeholders"},{"line":127,"address":[99136,99416,99654],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":128,"address":[99447,99174,99391],"length":1,"stats":{"Line":0},"fn_name":null},{"line":129,"address":[100666,99380,100710,99680,99721,100300],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":130,"address":[99773,99828,99893,99953,99991,100023],"length":1,"stats":{"Line":0},"fn_name":null},{"line":131,"address":[99918,99881],"length":1,"stats":{"Line":0},"fn_name":null},{"line":132,"address":[99979,100016],"length":1,"stats":{"Line":0},"fn_name":null},{"line":133,"address":[100072],"length":1,"stats":{"Line":0},"fn_name":null},{"line":134,"address":[100083,100561],"length":1,"stats":{"Line":0},"fn_name":null},{"line":135,"address":[100736,100093,100323],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":136,"address":[100745],"length":1,"stats":{"Line":0},"fn_name":null},{"line":138,"address":[100389],"length":1,"stats":{"Line":0},"fn_name":null},{"line":139,"address":[100416],"length":1,"stats":{"Line":0},"fn_name":null},{"line":142,"address":[100050,100574],"length":1,"stats":{"Line":0},"fn_name":null},{"line":143,"address":[100686],"length":1,"stats":{"Line":0},"fn_name":null},{"line":145,"address":[100139],"length":1,"stats":{"Line":0},"fn_name":null},{"line":148,"address":[99497,99546,99572],"length":1,"stats":{"Line":0},"fn_name":null},{"line":149,"address":[99552],"length":1,"stats":{"Line":0},"fn_name":null},{"line":150,"address":[99565,99667,99513,99604],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":78},{"path":["/","home","runner","work","advent-of-code","advent-of-code","src","lib.rs"],"content":"//! Advent of Code solutions by James Pharaoh\n//!\n//! [https://adventofcode.com/](https://adventofcode.com/)\n//!\n//! Home: [https://github.com/jamespharaoh/advent-of-code](https://github.com/jamespharaoh/advent-of-code)  \n\npub use aoc_2015 as year_2015;\npub use aoc_2021 as year_2021;\npub use aoc_common as common;\n","traces":[],"covered":0,"coverable":0}]};
        var previousData = null;
    </script>
    <script crossorigin>/** @license React v16.13.1
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
'use strict';(function(d,r){"object"===typeof exports&&"undefined"!==typeof module?r(exports):"function"===typeof define&&define.amd?define(["exports"],r):(d=d||self,r(d.React={}))})(this,function(d){function r(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function w(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function da(){}function L(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function ea(a,b,c){var g,e={},fa=null,d=null;if(null!=b)for(g in void 0!==b.ref&&(d=b.ref),void 0!==b.key&&(fa=""+b.key),b)ha.call(b,g)&&!ia.hasOwnProperty(g)&&(e[g]=b[g]);var h=arguments.length-2;if(1===h)e.children=c;else if(1<h){for(var k=Array(h),f=0;f<h;f++)k[f]=arguments[f+2];e.children=k}if(a&&a.defaultProps)for(g in h=a.defaultProps,
h)void 0===e[g]&&(e[g]=h[g]);return{$$typeof:x,type:a,key:fa,ref:d,props:e,_owner:M.current}}function va(a,b){return{$$typeof:x,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}}function N(a){return"object"===typeof a&&null!==a&&a.$$typeof===x}function wa(a){var b={"=":"=0",":":"=2"};return"$"+(""+a).replace(/[=:]/g,function(a){return b[a]})}function ja(a,b,c,g){if(C.length){var e=C.pop();e.result=a;e.keyPrefix=b;e.func=c;e.context=g;e.count=0;return e}return{result:a,keyPrefix:b,func:c,
context:g,count:0}}function ka(a){a.result=null;a.keyPrefix=null;a.func=null;a.context=null;a.count=0;10>C.length&&C.push(a)}function O(a,b,c,g){var e=typeof a;if("undefined"===e||"boolean"===e)a=null;var d=!1;if(null===a)d=!0;else switch(e){case "string":case "number":d=!0;break;case "object":switch(a.$$typeof){case x:case xa:d=!0}}if(d)return c(g,a,""===b?"."+P(a,0):b),1;d=0;b=""===b?".":b+":";if(Array.isArray(a))for(var f=0;f<a.length;f++){e=a[f];var h=b+P(e,f);d+=O(e,h,c,g)}else if(null===a||
"object"!==typeof a?h=null:(h=la&&a[la]||a["@@iterator"],h="function"===typeof h?h:null),"function"===typeof h)for(a=h.call(a),f=0;!(e=a.next()).done;)e=e.value,h=b+P(e,f++),d+=O(e,h,c,g);else if("object"===e)throw c=""+a,Error(r(31,"[object Object]"===c?"object with keys {"+Object.keys(a).join(", ")+"}":c,""));return d}function Q(a,b,c){return null==a?0:O(a,"",b,c)}function P(a,b){return"object"===typeof a&&null!==a&&null!=a.key?wa(a.key):b.toString(36)}function ya(a,b,c){a.func.call(a.context,b,
a.count++)}function za(a,b,c){var g=a.result,e=a.keyPrefix;a=a.func.call(a.context,b,a.count++);Array.isArray(a)?R(a,g,c,function(a){return a}):null!=a&&(N(a)&&(a=va(a,e+(!a.key||b&&b.key===a.key?"":(""+a.key).replace(ma,"$&/")+"/")+c)),g.push(a))}function R(a,b,c,g,e){var d="";null!=c&&(d=(""+c).replace(ma,"$&/")+"/");b=ja(b,d,g,e);Q(a,za,b);ka(b)}function t(){var a=na.current;if(null===a)throw Error(r(321));return a}function S(a,b){var c=a.length;a.push(b);a:for(;;){var g=c-1>>>1,e=a[g];if(void 0!==
e&&0<D(e,b))a[g]=b,a[c]=e,c=g;else break a}}function n(a){a=a[0];return void 0===a?null:a}function E(a){var b=a[0];if(void 0!==b){var c=a.pop();if(c!==b){a[0]=c;a:for(var g=0,e=a.length;g<e;){var d=2*(g+1)-1,f=a[d],h=d+1,k=a[h];if(void 0!==f&&0>D(f,c))void 0!==k&&0>D(k,f)?(a[g]=k,a[h]=c,g=h):(a[g]=f,a[d]=c,g=d);else if(void 0!==k&&0>D(k,c))a[g]=k,a[h]=c,g=h;else break a}}return b}return null}function D(a,b){var c=a.sortIndex-b.sortIndex;return 0!==c?c:a.id-b.id}function F(a){for(var b=n(u);null!==
b;){if(null===b.callback)E(u);else if(b.startTime<=a)E(u),b.sortIndex=b.expirationTime,S(p,b);else break;b=n(u)}}function T(a){y=!1;F(a);if(!v)if(null!==n(p))v=!0,z(U);else{var b=n(u);null!==b&&G(T,b.startTime-a)}}function U(a,b){v=!1;y&&(y=!1,V());H=!0;var c=m;try{F(b);for(l=n(p);null!==l&&(!(l.expirationTime>b)||a&&!W());){var g=l.callback;if(null!==g){l.callback=null;m=l.priorityLevel;var e=g(l.expirationTime<=b);b=q();"function"===typeof e?l.callback=e:l===n(p)&&E(p);F(b)}else E(p);l=n(p)}if(null!==
l)var d=!0;else{var f=n(u);null!==f&&G(T,f.startTime-b);d=!1}return d}finally{l=null,m=c,H=!1}}function oa(a){switch(a){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1E4;default:return 5E3}}var f="function"===typeof Symbol&&Symbol.for,x=f?Symbol.for("react.element"):60103,xa=f?Symbol.for("react.portal"):60106,Aa=f?Symbol.for("react.fragment"):60107,Ba=f?Symbol.for("react.strict_mode"):60108,Ca=f?Symbol.for("react.profiler"):60114,Da=f?Symbol.for("react.provider"):60109,
Ea=f?Symbol.for("react.context"):60110,Fa=f?Symbol.for("react.forward_ref"):60112,Ga=f?Symbol.for("react.suspense"):60113,Ha=f?Symbol.for("react.memo"):60115,Ia=f?Symbol.for("react.lazy"):60116,la="function"===typeof Symbol&&Symbol.iterator,pa=Object.getOwnPropertySymbols,Ja=Object.prototype.hasOwnProperty,Ka=Object.prototype.propertyIsEnumerable,I=function(){try{if(!Object.assign)return!1;var a=new String("abc");a[5]="de";if("5"===Object.getOwnPropertyNames(a)[0])return!1;var b={};for(a=0;10>a;a++)b["_"+
String.fromCharCode(a)]=a;if("0123456789"!==Object.getOwnPropertyNames(b).map(function(a){return b[a]}).join(""))return!1;var c={};"abcdefghijklmnopqrst".split("").forEach(function(a){c[a]=a});return"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},c)).join("")?!1:!0}catch(g){return!1}}()?Object.assign:function(a,b){if(null===a||void 0===a)throw new TypeError("Object.assign cannot be called with null or undefined");var c=Object(a);for(var g,e=1;e<arguments.length;e++){var d=Object(arguments[e]);
for(var f in d)Ja.call(d,f)&&(c[f]=d[f]);if(pa){g=pa(d);for(var h=0;h<g.length;h++)Ka.call(d,g[h])&&(c[g[h]]=d[g[h]])}}return c},ca={isMounted:function(a){return!1},enqueueForceUpdate:function(a,b,c){},enqueueReplaceState:function(a,b,c,d){},enqueueSetState:function(a,b,c,d){}},ba={};w.prototype.isReactComponent={};w.prototype.setState=function(a,b){if("object"!==typeof a&&"function"!==typeof a&&null!=a)throw Error(r(85));this.updater.enqueueSetState(this,a,b,"setState")};w.prototype.forceUpdate=
function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")};da.prototype=w.prototype;f=L.prototype=new da;f.constructor=L;I(f,w.prototype);f.isPureReactComponent=!0;var M={current:null},ha=Object.prototype.hasOwnProperty,ia={key:!0,ref:!0,__self:!0,__source:!0},ma=/\/+/g,C=[],na={current:null},X;if("undefined"===typeof window||"function"!==typeof MessageChannel){var A=null,qa=null,ra=function(){if(null!==A)try{var a=q();A(!0,a);A=null}catch(b){throw setTimeout(ra,0),b;}},La=Date.now();var q=
function(){return Date.now()-La};var z=function(a){null!==A?setTimeout(z,0,a):(A=a,setTimeout(ra,0))};var G=function(a,b){qa=setTimeout(a,b)};var V=function(){clearTimeout(qa)};var W=function(){return!1};f=X=function(){}}else{var Y=window.performance,sa=window.Date,Ma=window.setTimeout,Na=window.clearTimeout;"undefined"!==typeof console&&(f=window.cancelAnimationFrame,"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),
"function"!==typeof f&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"));if("object"===typeof Y&&"function"===typeof Y.now)q=function(){return Y.now()};else{var Oa=sa.now();q=function(){return sa.now()-Oa}}var J=!1,K=null,Z=-1,ta=5,ua=0;W=function(){return q()>=ua};f=function(){};X=function(a){0>a||125<a?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):
ta=0<a?Math.floor(1E3/a):5};var B=new MessageChannel,aa=B.port2;B.port1.onmessage=function(){if(null!==K){var a=q();ua=a+ta;try{K(!0,a)?aa.postMessage(null):(J=!1,K=null)}catch(b){throw aa.postMessage(null),b;}}else J=!1};z=function(a){K=a;J||(J=!0,aa.postMessage(null))};G=function(a,b){Z=Ma(function(){a(q())},b)};V=function(){Na(Z);Z=-1}}var p=[],u=[],Pa=1,l=null,m=3,H=!1,v=!1,y=!1,Qa=0;B={ReactCurrentDispatcher:na,ReactCurrentOwner:M,IsSomeRendererActing:{current:!1},assign:I};I(B,{Scheduler:{__proto__:null,
unstable_ImmediatePriority:1,unstable_UserBlockingPriority:2,unstable_NormalPriority:3,unstable_IdlePriority:5,unstable_LowPriority:4,unstable_runWithPriority:function(a,b){switch(a){case 1:case 2:case 3:case 4:case 5:break;default:a=3}var c=m;m=a;try{return b()}finally{m=c}},unstable_next:function(a){switch(m){case 1:case 2:case 3:var b=3;break;default:b=m}var c=m;m=b;try{return a()}finally{m=c}},unstable_scheduleCallback:function(a,b,c){var d=q();if("object"===typeof c&&null!==c){var e=c.delay;
e="number"===typeof e&&0<e?d+e:d;c="number"===typeof c.timeout?c.timeout:oa(a)}else c=oa(a),e=d;c=e+c;a={id:Pa++,callback:b,priorityLevel:a,startTime:e,expirationTime:c,sortIndex:-1};e>d?(a.sortIndex=e,S(u,a),null===n(p)&&a===n(u)&&(y?V():y=!0,G(T,e-d))):(a.sortIndex=c,S(p,a),v||H||(v=!0,z(U)));return a},unstable_cancelCallback:function(a){a.callback=null},unstable_wrapCallback:function(a){var b=m;return function(){var c=m;m=b;try{return a.apply(this,arguments)}finally{m=c}}},unstable_getCurrentPriorityLevel:function(){return m},
unstable_shouldYield:function(){var a=q();F(a);var b=n(p);return b!==l&&null!==l&&null!==b&&null!==b.callback&&b.startTime<=a&&b.expirationTime<l.expirationTime||W()},unstable_requestPaint:f,unstable_continueExecution:function(){v||H||(v=!0,z(U))},unstable_pauseExecution:function(){},unstable_getFirstCallbackNode:function(){return n(p)},get unstable_now(){return q},get unstable_forceFrameRate(){return X},unstable_Profiling:null},SchedulerTracing:{__proto__:null,__interactionsRef:null,__subscriberRef:null,
unstable_clear:function(a){return a()},unstable_getCurrent:function(){return null},unstable_getThreadID:function(){return++Qa},unstable_trace:function(a,b,c){return c()},unstable_wrap:function(a){return a},unstable_subscribe:function(a){},unstable_unsubscribe:function(a){}}});d.Children={map:function(a,b,c){if(null==a)return a;var d=[];R(a,d,null,b,c);return d},forEach:function(a,b,c){if(null==a)return a;b=ja(null,null,b,c);Q(a,ya,b);ka(b)},count:function(a){return Q(a,function(){return null},null)},
toArray:function(a){var b=[];R(a,b,null,function(a){return a});return b},only:function(a){if(!N(a))throw Error(r(143));return a}};d.Component=w;d.Fragment=Aa;d.Profiler=Ca;d.PureComponent=L;d.StrictMode=Ba;d.Suspense=Ga;d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B;d.cloneElement=function(a,b,c){if(null===a||void 0===a)throw Error(r(267,a));var d=I({},a.props),e=a.key,f=a.ref,m=a._owner;if(null!=b){void 0!==b.ref&&(f=b.ref,m=M.current);void 0!==b.key&&(e=""+b.key);if(a.type&&a.type.defaultProps)var h=
a.type.defaultProps;for(k in b)ha.call(b,k)&&!ia.hasOwnProperty(k)&&(d[k]=void 0===b[k]&&void 0!==h?h[k]:b[k])}var k=arguments.length-2;if(1===k)d.children=c;else if(1<k){h=Array(k);for(var l=0;l<k;l++)h[l]=arguments[l+2];d.children=h}return{$$typeof:x,type:a.type,key:e,ref:f,props:d,_owner:m}};d.createContext=function(a,b){void 0===b&&(b=null);a={$$typeof:Ea,_calculateChangedBits:b,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null};a.Provider={$$typeof:Da,_context:a};return a.Consumer=
a};d.createElement=ea;d.createFactory=function(a){var b=ea.bind(null,a);b.type=a;return b};d.createRef=function(){return{current:null}};d.forwardRef=function(a){return{$$typeof:Fa,render:a}};d.isValidElement=N;d.lazy=function(a){return{$$typeof:Ia,_ctor:a,_status:-1,_result:null}};d.memo=function(a,b){return{$$typeof:Ha,type:a,compare:void 0===b?null:b}};d.useCallback=function(a,b){return t().useCallback(a,b)};d.useContext=function(a,b){return t().useContext(a,b)};d.useDebugValue=function(a,b){};
d.useEffect=function(a,b){return t().useEffect(a,b)};d.useImperativeHandle=function(a,b,c){return t().useImperativeHandle(a,b,c)};d.useLayoutEffect=function(a,b){return t().useLayoutEffect(a,b)};d.useMemo=function(a,b){return t().useMemo(a,b)};d.useReducer=function(a,b,c){return t().useReducer(a,b,c)};d.useRef=function(a){return t().useRef(a)};d.useState=function(a){return t().useState(a)};d.version="16.13.1"});
</script>
    <script crossorigin>/** @license React v16.13.1
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
/*
 Modernizr 3.0.0pre (Custom Build) | MIT
*/
'use strict';(function(I,ea){"object"===typeof exports&&"undefined"!==typeof module?ea(exports,require("react")):"function"===typeof define&&define.amd?define(["exports","react"],ea):(I=I||self,ea(I.ReactDOM={},I.React))})(this,function(I,ea){function k(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function ji(a,b,c,d,e,f,g,h,m){yb=!1;gc=null;ki.apply(li,arguments)}function mi(a,b,c,d,e,f,g,h,m){ji.apply(this,arguments);if(yb){if(yb){var n=gc;yb=!1;gc=null}else throw Error(k(198));hc||(hc=!0,pd=n)}}function lf(a,b,c){var d=a.type||"unknown-event";a.currentTarget=mf(c);mi(d,b,void 0,a);a.currentTarget=null}function nf(){if(ic)for(var a in cb){var b=cb[a],c=ic.indexOf(a);if(!(-1<c))throw Error(k(96,a));if(!jc[c]){if(!b.extractEvents)throw Error(k(97,a));jc[c]=b;c=b.eventTypes;for(var d in c){var e=
void 0;var f=c[d],g=b,h=d;if(qd.hasOwnProperty(h))throw Error(k(99,h));qd[h]=f;var m=f.phasedRegistrationNames;if(m){for(e in m)m.hasOwnProperty(e)&&of(m[e],g,h);e=!0}else f.registrationName?(of(f.registrationName,g,h),e=!0):e=!1;if(!e)throw Error(k(98,d,a));}}}}function of(a,b,c){if(db[a])throw Error(k(100,a));db[a]=b;rd[a]=b.eventTypes[c].dependencies}function pf(a){var b=!1,c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!cb.hasOwnProperty(c)||cb[c]!==d){if(cb[c])throw Error(k(102,c));cb[c]=
d;b=!0}}b&&nf()}function qf(a){if(a=rf(a)){if("function"!==typeof sd)throw Error(k(280));var b=a.stateNode;b&&(b=td(b),sd(a.stateNode,a.type,b))}}function sf(a){eb?fb?fb.push(a):fb=[a]:eb=a}function tf(){if(eb){var a=eb,b=fb;fb=eb=null;qf(a);if(b)for(a=0;a<b.length;a++)qf(b[a])}}function ud(){if(null!==eb||null!==fb)vd(),tf()}function uf(a,b,c){if(wd)return a(b,c);wd=!0;try{return vf(a,b,c)}finally{wd=!1,ud()}}function ni(a){if(wf.call(xf,a))return!0;if(wf.call(yf,a))return!1;if(oi.test(a))return xf[a]=
!0;yf[a]=!0;return!1}function pi(a,b,c,d){if(null!==c&&0===c.type)return!1;switch(typeof b){case "function":case "symbol":return!0;case "boolean":if(d)return!1;if(null!==c)return!c.acceptsBooleans;a=a.toLowerCase().slice(0,5);return"data-"!==a&&"aria-"!==a;default:return!1}}function qi(a,b,c,d){if(null===b||"undefined"===typeof b||pi(a,b,c,d))return!0;if(d)return!1;if(null!==c)switch(c.type){case 3:return!b;case 4:return!1===b;case 5:return isNaN(b);case 6:return isNaN(b)||1>b}return!1}function L(a,
b,c,d,e,f){this.acceptsBooleans=2===b||3===b||4===b;this.attributeName=d;this.attributeNamespace=e;this.mustUseProperty=c;this.propertyName=a;this.type=b;this.sanitizeURL=f}function xd(a,b,c,d){var e=E.hasOwnProperty(b)?E[b]:null;var f=null!==e?0===e.type:d?!1:!(2<b.length)||"o"!==b[0]&&"O"!==b[0]||"n"!==b[1]&&"N"!==b[1]?!1:!0;f||(qi(b,c,e,d)&&(c=null),d||null===e?ni(b)&&(null===c?a.removeAttribute(b):a.setAttribute(b,""+c)):e.mustUseProperty?a[e.propertyName]=null===c?3===e.type?!1:"":c:(b=e.attributeName,
d=e.attributeNamespace,null===c?a.removeAttribute(b):(e=e.type,c=3===e||4===e&&!0===c?"":""+c,d?a.setAttributeNS(d,b,c):a.setAttribute(b,c))))}function zb(a){if(null===a||"object"!==typeof a)return null;a=zf&&a[zf]||a["@@iterator"];return"function"===typeof a?a:null}function ri(a){if(-1===a._status){a._status=0;var b=a._ctor;b=b();a._result=b;b.then(function(b){0===a._status&&(b=b.default,a._status=1,a._result=b)},function(b){0===a._status&&(a._status=2,a._result=b)})}}function na(a){if(null==a)return null;
if("function"===typeof a)return a.displayName||a.name||null;if("string"===typeof a)return a;switch(a){case Ma:return"Fragment";case gb:return"Portal";case kc:return"Profiler";case Af:return"StrictMode";case lc:return"Suspense";case yd:return"SuspenseList"}if("object"===typeof a)switch(a.$$typeof){case Bf:return"Context.Consumer";case Cf:return"Context.Provider";case zd:var b=a.render;b=b.displayName||b.name||"";return a.displayName||(""!==b?"ForwardRef("+b+")":"ForwardRef");case Ad:return na(a.type);
case Df:return na(a.render);case Ef:if(a=1===a._status?a._result:null)return na(a)}return null}function Bd(a){var b="";do{a:switch(a.tag){case 3:case 4:case 6:case 7:case 10:case 9:var c="";break a;default:var d=a._debugOwner,e=a._debugSource,f=na(a.type);c=null;d&&(c=na(d.type));d=f;f="";e?f=" (at "+e.fileName.replace(si,"")+":"+e.lineNumber+")":c&&(f=" (created by "+c+")");c="\n    in "+(d||"Unknown")+f}b+=c;a=a.return}while(a);return b}function va(a){switch(typeof a){case "boolean":case "number":case "object":case "string":case "undefined":return a;
default:return""}}function Ff(a){var b=a.type;return(a=a.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===b||"radio"===b)}function ti(a){var b=Ff(a)?"checked":"value",c=Object.getOwnPropertyDescriptor(a.constructor.prototype,b),d=""+a[b];if(!a.hasOwnProperty(b)&&"undefined"!==typeof c&&"function"===typeof c.get&&"function"===typeof c.set){var e=c.get,f=c.set;Object.defineProperty(a,b,{configurable:!0,get:function(){return e.call(this)},set:function(a){d=""+a;f.call(this,a)}});Object.defineProperty(a,
b,{enumerable:c.enumerable});return{getValue:function(){return d},setValue:function(a){d=""+a},stopTracking:function(){a._valueTracker=null;delete a[b]}}}}function mc(a){a._valueTracker||(a._valueTracker=ti(a))}function Gf(a){if(!a)return!1;var b=a._valueTracker;if(!b)return!0;var c=b.getValue();var d="";a&&(d=Ff(a)?a.checked?"true":"false":a.value);a=d;return a!==c?(b.setValue(a),!0):!1}function Cd(a,b){var c=b.checked;return M({},b,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=
c?c:a._wrapperState.initialChecked})}function Hf(a,b){var c=null==b.defaultValue?"":b.defaultValue,d=null!=b.checked?b.checked:b.defaultChecked;c=va(null!=b.value?b.value:c);a._wrapperState={initialChecked:d,initialValue:c,controlled:"checkbox"===b.type||"radio"===b.type?null!=b.checked:null!=b.value}}function If(a,b){b=b.checked;null!=b&&xd(a,"checked",b,!1)}function Dd(a,b){If(a,b);var c=va(b.value),d=b.type;if(null!=c)if("number"===d){if(0===c&&""===a.value||a.value!=c)a.value=""+c}else a.value!==
""+c&&(a.value=""+c);else if("submit"===d||"reset"===d){a.removeAttribute("value");return}b.hasOwnProperty("value")?Ed(a,b.type,c):b.hasOwnProperty("defaultValue")&&Ed(a,b.type,va(b.defaultValue));null==b.checked&&null!=b.defaultChecked&&(a.defaultChecked=!!b.defaultChecked)}function Jf(a,b,c){if(b.hasOwnProperty("value")||b.hasOwnProperty("defaultValue")){var d=b.type;if(!("submit"!==d&&"reset"!==d||void 0!==b.value&&null!==b.value))return;b=""+a._wrapperState.initialValue;c||b===a.value||(a.value=
b);a.defaultValue=b}c=a.name;""!==c&&(a.name="");a.defaultChecked=!!a._wrapperState.initialChecked;""!==c&&(a.name=c)}function Ed(a,b,c){if("number"!==b||a.ownerDocument.activeElement!==a)null==c?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+c&&(a.defaultValue=""+c)}function ui(a){var b="";ea.Children.forEach(a,function(a){null!=a&&(b+=a)});return b}function Fd(a,b){a=M({children:void 0},b);if(b=ui(b.children))a.children=b;return a}function hb(a,b,c,d){a=a.options;if(b){b={};
for(var e=0;e<c.length;e++)b["$"+c[e]]=!0;for(c=0;c<a.length;c++)e=b.hasOwnProperty("$"+a[c].value),a[c].selected!==e&&(a[c].selected=e),e&&d&&(a[c].defaultSelected=!0)}else{c=""+va(c);b=null;for(e=0;e<a.length;e++){if(a[e].value===c){a[e].selected=!0;d&&(a[e].defaultSelected=!0);return}null!==b||a[e].disabled||(b=a[e])}null!==b&&(b.selected=!0)}}function Gd(a,b){if(null!=b.dangerouslySetInnerHTML)throw Error(k(91));return M({},b,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}
function Kf(a,b){var c=b.value;if(null==c){c=b.children;b=b.defaultValue;if(null!=c){if(null!=b)throw Error(k(92));if(Array.isArray(c)){if(!(1>=c.length))throw Error(k(93));c=c[0]}b=c}null==b&&(b="");c=b}a._wrapperState={initialValue:va(c)}}function Lf(a,b){var c=va(b.value),d=va(b.defaultValue);null!=c&&(c=""+c,c!==a.value&&(a.value=c),null==b.defaultValue&&a.defaultValue!==c&&(a.defaultValue=c));null!=d&&(a.defaultValue=""+d)}function Mf(a,b){b=a.textContent;b===a._wrapperState.initialValue&&""!==
b&&null!==b&&(a.value=b)}function Nf(a){switch(a){case "svg":return"http://www.w3.org/2000/svg";case "math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Hd(a,b){return null==a||"http://www.w3.org/1999/xhtml"===a?Nf(b):"http://www.w3.org/2000/svg"===a&&"foreignObject"===b?"http://www.w3.org/1999/xhtml":a}function nc(a,b){var c={};c[a.toLowerCase()]=b.toLowerCase();c["Webkit"+a]="webkit"+b;c["Moz"+a]="moz"+b;return c}function oc(a){if(Id[a])return Id[a];
if(!ib[a])return a;var b=ib[a],c;for(c in b)if(b.hasOwnProperty(c)&&c in Of)return Id[a]=b[c];return a}function Jd(a){var b=Pf.get(a);void 0===b&&(b=new Map,Pf.set(a,b));return b}function Na(a){var b=a,c=a;if(a.alternate)for(;b.return;)b=b.return;else{a=b;do b=a,0!==(b.effectTag&1026)&&(c=b.return),a=b.return;while(a)}return 3===b.tag?c:null}function Qf(a){if(13===a.tag){var b=a.memoizedState;null===b&&(a=a.alternate,null!==a&&(b=a.memoizedState));if(null!==b)return b.dehydrated}return null}function Rf(a){if(Na(a)!==
a)throw Error(k(188));}function vi(a){var b=a.alternate;if(!b){b=Na(a);if(null===b)throw Error(k(188));return b!==a?null:a}for(var c=a,d=b;;){var e=c.return;if(null===e)break;var f=e.alternate;if(null===f){d=e.return;if(null!==d){c=d;continue}break}if(e.child===f.child){for(f=e.child;f;){if(f===c)return Rf(e),a;if(f===d)return Rf(e),b;f=f.sibling}throw Error(k(188));}if(c.return!==d.return)c=e,d=f;else{for(var g=!1,h=e.child;h;){if(h===c){g=!0;c=e;d=f;break}if(h===d){g=!0;d=e;c=f;break}h=h.sibling}if(!g){for(h=
f.child;h;){if(h===c){g=!0;c=f;d=e;break}if(h===d){g=!0;d=f;c=e;break}h=h.sibling}if(!g)throw Error(k(189));}}if(c.alternate!==d)throw Error(k(190));}if(3!==c.tag)throw Error(k(188));return c.stateNode.current===c?a:b}function Sf(a){a=vi(a);if(!a)return null;for(var b=a;;){if(5===b.tag||6===b.tag)return b;if(b.child)b.child.return=b,b=b.child;else{if(b===a)break;for(;!b.sibling;){if(!b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}}return null}function jb(a,b){if(null==
b)throw Error(k(30));if(null==a)return b;if(Array.isArray(a)){if(Array.isArray(b))return a.push.apply(a,b),a;a.push(b);return a}return Array.isArray(b)?[a].concat(b):[a,b]}function Kd(a,b,c){Array.isArray(a)?a.forEach(b,c):a&&b.call(c,a)}function pc(a){null!==a&&(Ab=jb(Ab,a));a=Ab;Ab=null;if(a){Kd(a,wi);if(Ab)throw Error(k(95));if(hc)throw a=pd,hc=!1,pd=null,a;}}function Ld(a){a=a.target||a.srcElement||window;a.correspondingUseElement&&(a=a.correspondingUseElement);return 3===a.nodeType?a.parentNode:
a}function Tf(a){if(!wa)return!1;a="on"+a;var b=a in document;b||(b=document.createElement("div"),b.setAttribute(a,"return;"),b="function"===typeof b[a]);return b}function Uf(a){a.topLevelType=null;a.nativeEvent=null;a.targetInst=null;a.ancestors.length=0;10>qc.length&&qc.push(a)}function Vf(a,b,c,d){if(qc.length){var e=qc.pop();e.topLevelType=a;e.eventSystemFlags=d;e.nativeEvent=b;e.targetInst=c;return e}return{topLevelType:a,eventSystemFlags:d,nativeEvent:b,targetInst:c,ancestors:[]}}function Wf(a){var b=
a.targetInst,c=b;do{if(!c){a.ancestors.push(c);break}var d=c;if(3===d.tag)d=d.stateNode.containerInfo;else{for(;d.return;)d=d.return;d=3!==d.tag?null:d.stateNode.containerInfo}if(!d)break;b=c.tag;5!==b&&6!==b||a.ancestors.push(c);c=Bb(d)}while(c);for(c=0;c<a.ancestors.length;c++){b=a.ancestors[c];var e=Ld(a.nativeEvent);d=a.topLevelType;var f=a.nativeEvent,g=a.eventSystemFlags;0===c&&(g|=64);for(var h=null,m=0;m<jc.length;m++){var n=jc[m];n&&(n=n.extractEvents(d,b,f,e,g))&&(h=jb(h,n))}pc(h)}}function Md(a,
b,c){if(!c.has(a)){switch(a){case "scroll":Cb(b,"scroll",!0);break;case "focus":case "blur":Cb(b,"focus",!0);Cb(b,"blur",!0);c.set("blur",null);c.set("focus",null);break;case "cancel":case "close":Tf(a)&&Cb(b,a,!0);break;case "invalid":case "submit":case "reset":break;default:-1===Db.indexOf(a)&&w(a,b)}c.set(a,null)}}function xi(a,b){var c=Jd(b);Nd.forEach(function(a){Md(a,b,c)});yi.forEach(function(a){Md(a,b,c)})}function Od(a,b,c,d,e){return{blockedOn:a,topLevelType:b,eventSystemFlags:c|32,nativeEvent:e,
container:d}}function Xf(a,b){switch(a){case "focus":case "blur":xa=null;break;case "dragenter":case "dragleave":ya=null;break;case "mouseover":case "mouseout":za=null;break;case "pointerover":case "pointerout":Eb.delete(b.pointerId);break;case "gotpointercapture":case "lostpointercapture":Fb.delete(b.pointerId)}}function Gb(a,b,c,d,e,f){if(null===a||a.nativeEvent!==f)return a=Od(b,c,d,e,f),null!==b&&(b=Hb(b),null!==b&&Yf(b)),a;a.eventSystemFlags|=d;return a}function zi(a,b,c,d,e){switch(b){case "focus":return xa=
Gb(xa,a,b,c,d,e),!0;case "dragenter":return ya=Gb(ya,a,b,c,d,e),!0;case "mouseover":return za=Gb(za,a,b,c,d,e),!0;case "pointerover":var f=e.pointerId;Eb.set(f,Gb(Eb.get(f)||null,a,b,c,d,e));return!0;case "gotpointercapture":return f=e.pointerId,Fb.set(f,Gb(Fb.get(f)||null,a,b,c,d,e)),!0}return!1}function Ai(a){var b=Bb(a.target);if(null!==b){var c=Na(b);if(null!==c)if(b=c.tag,13===b){if(b=Qf(c),null!==b){a.blockedOn=b;Pd(a.priority,function(){Bi(c)});return}}else if(3===b&&c.stateNode.hydrate){a.blockedOn=
3===c.tag?c.stateNode.containerInfo:null;return}}a.blockedOn=null}function rc(a){if(null!==a.blockedOn)return!1;var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);if(null!==b){var c=Hb(b);null!==c&&Yf(c);a.blockedOn=b;return!1}return!0}function Zf(a,b,c){rc(a)&&c.delete(b)}function Ci(){for(Rd=!1;0<fa.length;){var a=fa[0];if(null!==a.blockedOn){a=Hb(a.blockedOn);null!==a&&Di(a);break}var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);null!==b?a.blockedOn=b:fa.shift()}null!==
xa&&rc(xa)&&(xa=null);null!==ya&&rc(ya)&&(ya=null);null!==za&&rc(za)&&(za=null);Eb.forEach(Zf);Fb.forEach(Zf)}function Ib(a,b){a.blockedOn===b&&(a.blockedOn=null,Rd||(Rd=!0,$f(ag,Ci)))}function bg(a){if(0<fa.length){Ib(fa[0],a);for(var b=1;b<fa.length;b++){var c=fa[b];c.blockedOn===a&&(c.blockedOn=null)}}null!==xa&&Ib(xa,a);null!==ya&&Ib(ya,a);null!==za&&Ib(za,a);b=function(b){return Ib(b,a)};Eb.forEach(b);Fb.forEach(b);for(b=0;b<Jb.length;b++)c=Jb[b],c.blockedOn===a&&(c.blockedOn=null);for(;0<Jb.length&&
(b=Jb[0],null===b.blockedOn);)Ai(b),null===b.blockedOn&&Jb.shift()}function Sd(a,b){for(var c=0;c<a.length;c+=2){var d=a[c],e=a[c+1],f="on"+(e[0].toUpperCase()+e.slice(1));f={phasedRegistrationNames:{bubbled:f,captured:f+"Capture"},dependencies:[d],eventPriority:b};Td.set(d,b);cg.set(d,f);dg[e]=f}}function w(a,b){Cb(b,a,!1)}function Cb(a,b,c){var d=Td.get(b);switch(void 0===d?2:d){case 0:d=Ei.bind(null,b,1,a);break;case 1:d=Fi.bind(null,b,1,a);break;default:d=sc.bind(null,b,1,a)}c?a.addEventListener(b,
d,!0):a.addEventListener(b,d,!1)}function Ei(a,b,c,d){Oa||vd();var e=sc,f=Oa;Oa=!0;try{eg(e,a,b,c,d)}finally{(Oa=f)||ud()}}function Fi(a,b,c,d){Gi(Hi,sc.bind(null,a,b,c,d))}function sc(a,b,c,d){if(tc)if(0<fa.length&&-1<Nd.indexOf(a))a=Od(null,a,b,c,d),fa.push(a);else{var e=Qd(a,b,c,d);if(null===e)Xf(a,d);else if(-1<Nd.indexOf(a))a=Od(e,a,b,c,d),fa.push(a);else if(!zi(e,a,b,c,d)){Xf(a,d);a=Vf(a,d,null,b);try{uf(Wf,a)}finally{Uf(a)}}}}function Qd(a,b,c,d){c=Ld(d);c=Bb(c);if(null!==c){var e=Na(c);if(null===
e)c=null;else{var f=e.tag;if(13===f){c=Qf(e);if(null!==c)return c;c=null}else if(3===f){if(e.stateNode.hydrate)return 3===e.tag?e.stateNode.containerInfo:null;c=null}else e!==c&&(c=null)}}a=Vf(a,d,c,b);try{uf(Wf,a)}finally{Uf(a)}return null}function fg(a,b,c){return null==b||"boolean"===typeof b||""===b?"":c||"number"!==typeof b||0===b||Kb.hasOwnProperty(a)&&Kb[a]?(""+b).trim():b+"px"}function gg(a,b){a=a.style;for(var c in b)if(b.hasOwnProperty(c)){var d=0===c.indexOf("--"),e=fg(c,b[c],d);"float"===
c&&(c="cssFloat");d?a.setProperty(c,e):a[c]=e}}function Ud(a,b){if(b){if(Ii[a]&&(null!=b.children||null!=b.dangerouslySetInnerHTML))throw Error(k(137,a,""));if(null!=b.dangerouslySetInnerHTML){if(null!=b.children)throw Error(k(60));if(!("object"===typeof b.dangerouslySetInnerHTML&&"__html"in b.dangerouslySetInnerHTML))throw Error(k(61));}if(null!=b.style&&"object"!==typeof b.style)throw Error(k(62,""));}}function Vd(a,b){if(-1===a.indexOf("-"))return"string"===typeof b.is;switch(a){case "annotation-xml":case "color-profile":case "font-face":case "font-face-src":case "font-face-uri":case "font-face-format":case "font-face-name":case "missing-glyph":return!1;
default:return!0}}function oa(a,b){a=9===a.nodeType||11===a.nodeType?a:a.ownerDocument;var c=Jd(a);b=rd[b];for(var d=0;d<b.length;d++)Md(b[d],a,c)}function uc(){}function Wd(a){a=a||("undefined"!==typeof document?document:void 0);if("undefined"===typeof a)return null;try{return a.activeElement||a.body}catch(b){return a.body}}function hg(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function ig(a,b){var c=hg(a);a=0;for(var d;c;){if(3===c.nodeType){d=a+c.textContent.length;if(a<=b&&d>=b)return{node:c,
offset:b-a};a=d}a:{for(;c;){if(c.nextSibling){c=c.nextSibling;break a}c=c.parentNode}c=void 0}c=hg(c)}}function jg(a,b){return a&&b?a===b?!0:a&&3===a.nodeType?!1:b&&3===b.nodeType?jg(a,b.parentNode):"contains"in a?a.contains(b):a.compareDocumentPosition?!!(a.compareDocumentPosition(b)&16):!1:!1}function kg(){for(var a=window,b=Wd();b instanceof a.HTMLIFrameElement;){try{var c="string"===typeof b.contentWindow.location.href}catch(d){c=!1}if(c)a=b.contentWindow;else break;b=Wd(a.document)}return b}
function Xd(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return b&&("input"===b&&("text"===a.type||"search"===a.type||"tel"===a.type||"url"===a.type||"password"===a.type)||"textarea"===b||"true"===a.contentEditable)}function lg(a,b){switch(a){case "button":case "input":case "select":case "textarea":return!!b.autoFocus}return!1}function Yd(a,b){return"textarea"===a||"option"===a||"noscript"===a||"string"===typeof b.children||"number"===typeof b.children||"object"===typeof b.dangerouslySetInnerHTML&&
null!==b.dangerouslySetInnerHTML&&null!=b.dangerouslySetInnerHTML.__html}function kb(a){for(;null!=a;a=a.nextSibling){var b=a.nodeType;if(1===b||3===b)break}return a}function mg(a){a=a.previousSibling;for(var b=0;a;){if(8===a.nodeType){var c=a.data;if(c===ng||c===Zd||c===$d){if(0===b)return a;b--}else c===og&&b++}a=a.previousSibling}return null}function Bb(a){var b=a[Aa];if(b)return b;for(var c=a.parentNode;c;){if(b=c[Lb]||c[Aa]){c=b.alternate;if(null!==b.child||null!==c&&null!==c.child)for(a=mg(a);null!==
a;){if(c=a[Aa])return c;a=mg(a)}return b}a=c;c=a.parentNode}return null}function Hb(a){a=a[Aa]||a[Lb];return!a||5!==a.tag&&6!==a.tag&&13!==a.tag&&3!==a.tag?null:a}function Pa(a){if(5===a.tag||6===a.tag)return a.stateNode;throw Error(k(33));}function ae(a){return a[vc]||null}function pa(a){do a=a.return;while(a&&5!==a.tag);return a?a:null}function pg(a,b){var c=a.stateNode;if(!c)return null;var d=td(c);if(!d)return null;c=d[b];a:switch(b){case "onClick":case "onClickCapture":case "onDoubleClick":case "onDoubleClickCapture":case "onMouseDown":case "onMouseDownCapture":case "onMouseMove":case "onMouseMoveCapture":case "onMouseUp":case "onMouseUpCapture":case "onMouseEnter":(d=
!d.disabled)||(a=a.type,d=!("button"===a||"input"===a||"select"===a||"textarea"===a));a=!d;break a;default:a=!1}if(a)return null;if(c&&"function"!==typeof c)throw Error(k(231,b,typeof c));return c}function qg(a,b,c){if(b=pg(a,c.dispatchConfig.phasedRegistrationNames[b]))c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a)}function Ji(a){if(a&&a.dispatchConfig.phasedRegistrationNames){for(var b=a._targetInst,c=[];b;)c.push(b),b=pa(b);for(b=c.length;0<b--;)qg(c[b],
"captured",a);for(b=0;b<c.length;b++)qg(c[b],"bubbled",a)}}function be(a,b,c){a&&c&&c.dispatchConfig.registrationName&&(b=pg(a,c.dispatchConfig.registrationName))&&(c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a))}function Ki(a){a&&a.dispatchConfig.registrationName&&be(a._targetInst,null,a)}function lb(a){Kd(a,Ji)}function rg(){if(wc)return wc;var a,b=ce,c=b.length,d,e="value"in Ba?Ba.value:Ba.textContent,f=e.length;for(a=0;a<c&&b[a]===e[a];a++);var g=
c-a;for(d=1;d<=g&&b[c-d]===e[f-d];d++);return wc=e.slice(a,1<d?1-d:void 0)}function xc(){return!0}function yc(){return!1}function R(a,b,c,d){this.dispatchConfig=a;this._targetInst=b;this.nativeEvent=c;a=this.constructor.Interface;for(var e in a)a.hasOwnProperty(e)&&((b=a[e])?this[e]=b(c):"target"===e?this.target=d:this[e]=c[e]);this.isDefaultPrevented=(null!=c.defaultPrevented?c.defaultPrevented:!1===c.returnValue)?xc:yc;this.isPropagationStopped=yc;return this}function Li(a,b,c,d){if(this.eventPool.length){var e=
this.eventPool.pop();this.call(e,a,b,c,d);return e}return new this(a,b,c,d)}function Mi(a){if(!(a instanceof this))throw Error(k(279));a.destructor();10>this.eventPool.length&&this.eventPool.push(a)}function sg(a){a.eventPool=[];a.getPooled=Li;a.release=Mi}function tg(a,b){switch(a){case "keyup":return-1!==Ni.indexOf(b.keyCode);case "keydown":return 229!==b.keyCode;case "keypress":case "mousedown":case "blur":return!0;default:return!1}}function ug(a){a=a.detail;return"object"===typeof a&&"data"in
a?a.data:null}function Oi(a,b){switch(a){case "compositionend":return ug(b);case "keypress":if(32!==b.which)return null;vg=!0;return wg;case "textInput":return a=b.data,a===wg&&vg?null:a;default:return null}}function Pi(a,b){if(mb)return"compositionend"===a||!de&&tg(a,b)?(a=rg(),wc=ce=Ba=null,mb=!1,a):null;switch(a){case "paste":return null;case "keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;
case "compositionend":return xg&&"ko"!==b.locale?null:b.data;default:return null}}function yg(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return"input"===b?!!Qi[a.type]:"textarea"===b?!0:!1}function zg(a,b,c){a=R.getPooled(Ag.change,a,b,c);a.type="change";sf(c);lb(a);return a}function Ri(a){pc(a)}function zc(a){var b=Pa(a);if(Gf(b))return a}function Si(a,b){if("change"===a)return b}function Bg(){Mb&&(Mb.detachEvent("onpropertychange",Cg),Nb=Mb=null)}function Cg(a){if("value"===a.propertyName&&
zc(Nb))if(a=zg(Nb,a,Ld(a)),Oa)pc(a);else{Oa=!0;try{ee(Ri,a)}finally{Oa=!1,ud()}}}function Ti(a,b,c){"focus"===a?(Bg(),Mb=b,Nb=c,Mb.attachEvent("onpropertychange",Cg)):"blur"===a&&Bg()}function Ui(a,b){if("selectionchange"===a||"keyup"===a||"keydown"===a)return zc(Nb)}function Vi(a,b){if("click"===a)return zc(b)}function Wi(a,b){if("input"===a||"change"===a)return zc(b)}function Xi(a){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(a):(a=Yi[a])?!!b[a]:!1}function fe(a){return Xi}
function Zi(a,b){return a===b&&(0!==a||1/a===1/b)||a!==a&&b!==b}function Ob(a,b){if(Qa(a,b))return!0;if("object"!==typeof a||null===a||"object"!==typeof b||null===b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++)if(!$i.call(b,c[d])||!Qa(a[c[d]],b[c[d]]))return!1;return!0}function Dg(a,b){var c=b.window===b?b.document:9===b.nodeType?b:b.ownerDocument;if(ge||null==nb||nb!==Wd(c))return null;c=nb;"selectionStart"in c&&Xd(c)?c={start:c.selectionStart,
end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset});return Pb&&Ob(Pb,c)?null:(Pb=c,a=R.getPooled(Eg.select,he,a,b),a.type="select",a.target=nb,lb(a),a)}function Ac(a){var b=a.keyCode;"charCode"in a?(a=a.charCode,0===a&&13===b&&(a=13)):a=b;10===a&&(a=13);return 32<=a||13===a?a:0}function q(a,b){0>ob||(a.current=ie[ob],ie[ob]=null,ob--)}function y(a,b,c){ob++;
ie[ob]=a.current;a.current=b}function pb(a,b){var c=a.type.contextTypes;if(!c)return Ca;var d=a.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===b)return d.__reactInternalMemoizedMaskedChildContext;var e={},f;for(f in c)e[f]=b[f];d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=b,a.__reactInternalMemoizedMaskedChildContext=e);return e}function N(a){a=a.childContextTypes;return null!==a&&void 0!==a}function Fg(a,b,c){if(B.current!==Ca)throw Error(k(168));y(B,b);y(G,c)}
function Gg(a,b,c){var d=a.stateNode;a=b.childContextTypes;if("function"!==typeof d.getChildContext)return c;d=d.getChildContext();for(var e in d)if(!(e in a))throw Error(k(108,na(b)||"Unknown",e));return M({},c,{},d)}function Bc(a){a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Ca;Ra=B.current;y(B,a);y(G,G.current);return!0}function Hg(a,b,c){var d=a.stateNode;if(!d)throw Error(k(169));c?(a=Gg(a,b,Ra),d.__reactInternalMemoizedMergedChildContext=a,q(G),q(B),y(B,a)):q(G);y(G,c)}function Cc(){switch(aj()){case Dc:return 99;
case Ig:return 98;case Jg:return 97;case Kg:return 96;case Lg:return 95;default:throw Error(k(332));}}function Mg(a){switch(a){case 99:return Dc;case 98:return Ig;case 97:return Jg;case 96:return Kg;case 95:return Lg;default:throw Error(k(332));}}function Da(a,b){a=Mg(a);return bj(a,b)}function Ng(a,b,c){a=Mg(a);return je(a,b,c)}function Og(a){null===qa?(qa=[a],Ec=je(Dc,Pg)):qa.push(a);return Qg}function ha(){if(null!==Ec){var a=Ec;Ec=null;Rg(a)}Pg()}function Pg(){if(!ke&&null!==qa){ke=!0;var a=0;
try{var b=qa;Da(99,function(){for(;a<b.length;a++){var c=b[a];do c=c(!0);while(null!==c)}});qa=null}catch(c){throw null!==qa&&(qa=qa.slice(a+1)),je(Dc,ha),c;}finally{ke=!1}}}function Fc(a,b,c){c/=10;return 1073741821-(((1073741821-a+b/10)/c|0)+1)*c}function aa(a,b){if(a&&a.defaultProps){b=M({},b);a=a.defaultProps;for(var c in a)void 0===b[c]&&(b[c]=a[c])}return b}function le(){Gc=qb=Hc=null}function me(a){var b=Ic.current;q(Ic);a.type._context._currentValue=b}function Sg(a,b){for(;null!==a;){var c=
a.alternate;if(a.childExpirationTime<b)a.childExpirationTime=b,null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);else if(null!==c&&c.childExpirationTime<b)c.childExpirationTime=b;else break;a=a.return}}function rb(a,b){Hc=a;Gc=qb=null;a=a.dependencies;null!==a&&null!==a.firstContext&&(a.expirationTime>=b&&(ia=!0),a.firstContext=null)}function W(a,b){if(Gc!==a&&!1!==b&&0!==b){if("number"!==typeof b||1073741823===b)Gc=a,b=1073741823;b={context:a,observedBits:b,next:null};if(null===qb){if(null===
Hc)throw Error(k(308));qb=b;Hc.dependencies={expirationTime:0,firstContext:b,responders:null}}else qb=qb.next=b}return a._currentValue}function ne(a){a.updateQueue={baseState:a.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function oe(a,b){a=a.updateQueue;b.updateQueue===a&&(b.updateQueue={baseState:a.baseState,baseQueue:a.baseQueue,shared:a.shared,effects:a.effects})}function Ea(a,b){a={expirationTime:a,suspenseConfig:b,tag:Tg,payload:null,callback:null,next:null};return a.next=
a}function Fa(a,b){a=a.updateQueue;if(null!==a){a=a.shared;var c=a.pending;null===c?b.next=b:(b.next=c.next,c.next=b);a.pending=b}}function Ug(a,b){var c=a.alternate;null!==c&&oe(c,a);a=a.updateQueue;c=a.baseQueue;null===c?(a.baseQueue=b.next=b,b.next=b):(b.next=c.next,c.next=b)}function Qb(a,b,c,d){var e=a.updateQueue;Ga=!1;var f=e.baseQueue,g=e.shared.pending;if(null!==g){if(null!==f){var h=f.next;f.next=g.next;g.next=h}f=g;e.shared.pending=null;h=a.alternate;null!==h&&(h=h.updateQueue,null!==h&&
(h.baseQueue=g))}if(null!==f){h=f.next;var m=e.baseState,n=0,k=null,ba=null,l=null;if(null!==h){var p=h;do{g=p.expirationTime;if(g<d){var t={expirationTime:p.expirationTime,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null};null===l?(ba=l=t,k=m):l=l.next=t;g>n&&(n=g)}else{null!==l&&(l=l.next={expirationTime:1073741823,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null});Vg(g,p.suspenseConfig);a:{var q=a,r=p;g=b;t=c;switch(r.tag){case 1:q=
r.payload;if("function"===typeof q){m=q.call(t,m,g);break a}m=q;break a;case 3:q.effectTag=q.effectTag&-4097|64;case Tg:q=r.payload;g="function"===typeof q?q.call(t,m,g):q;if(null===g||void 0===g)break a;m=M({},m,g);break a;case Jc:Ga=!0}}null!==p.callback&&(a.effectTag|=32,g=e.effects,null===g?e.effects=[p]:g.push(p))}p=p.next;if(null===p||p===h)if(g=e.shared.pending,null===g)break;else p=f.next=g.next,g.next=h,e.baseQueue=f=g,e.shared.pending=null}while(1)}null===l?k=m:l.next=ba;e.baseState=k;e.baseQueue=
l;Kc(n);a.expirationTime=n;a.memoizedState=m}}function Wg(a,b,c){a=b.effects;b.effects=null;if(null!==a)for(b=0;b<a.length;b++){var d=a[b],e=d.callback;if(null!==e){d.callback=null;d=e;e=c;if("function"!==typeof d)throw Error(k(191,d));d.call(e)}}}function Lc(a,b,c,d){b=a.memoizedState;c=c(d,b);c=null===c||void 0===c?b:M({},b,c);a.memoizedState=c;0===a.expirationTime&&(a.updateQueue.baseState=c)}function Xg(a,b,c,d,e,f,g){a=a.stateNode;return"function"===typeof a.shouldComponentUpdate?a.shouldComponentUpdate(d,
f,g):b.prototype&&b.prototype.isPureReactComponent?!Ob(c,d)||!Ob(e,f):!0}function Yg(a,b,c){var d=!1,e=Ca;var f=b.contextType;"object"===typeof f&&null!==f?f=W(f):(e=N(b)?Ra:B.current,d=b.contextTypes,f=(d=null!==d&&void 0!==d)?pb(a,e):Ca);b=new b(c,f);a.memoizedState=null!==b.state&&void 0!==b.state?b.state:null;b.updater=Mc;a.stateNode=b;b._reactInternalFiber=a;d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=e,a.__reactInternalMemoizedMaskedChildContext=f);return b}function Zg(a,
b,c,d){a=b.state;"function"===typeof b.componentWillReceiveProps&&b.componentWillReceiveProps(c,d);"function"===typeof b.UNSAFE_componentWillReceiveProps&&b.UNSAFE_componentWillReceiveProps(c,d);b.state!==a&&Mc.enqueueReplaceState(b,b.state,null)}function pe(a,b,c,d){var e=a.stateNode;e.props=c;e.state=a.memoizedState;e.refs=$g;ne(a);var f=b.contextType;"object"===typeof f&&null!==f?e.context=W(f):(f=N(b)?Ra:B.current,e.context=pb(a,f));Qb(a,c,e,d);e.state=a.memoizedState;f=b.getDerivedStateFromProps;
"function"===typeof f&&(Lc(a,b,f,c),e.state=a.memoizedState);"function"===typeof b.getDerivedStateFromProps||"function"===typeof e.getSnapshotBeforeUpdate||"function"!==typeof e.UNSAFE_componentWillMount&&"function"!==typeof e.componentWillMount||(b=e.state,"function"===typeof e.componentWillMount&&e.componentWillMount(),"function"===typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),b!==e.state&&Mc.enqueueReplaceState(e,e.state,null),Qb(a,c,e,d),e.state=a.memoizedState);"function"===
typeof e.componentDidMount&&(a.effectTag|=4)}function Rb(a,b,c){a=c.ref;if(null!==a&&"function"!==typeof a&&"object"!==typeof a){if(c._owner){c=c._owner;if(c){if(1!==c.tag)throw Error(k(309));var d=c.stateNode}if(!d)throw Error(k(147,a));var e=""+a;if(null!==b&&null!==b.ref&&"function"===typeof b.ref&&b.ref._stringRef===e)return b.ref;b=function(a){var b=d.refs;b===$g&&(b=d.refs={});null===a?delete b[e]:b[e]=a};b._stringRef=e;return b}if("string"!==typeof a)throw Error(k(284));if(!c._owner)throw Error(k(290,
a));}return a}function Nc(a,b){if("textarea"!==a.type)throw Error(k(31,"[object Object]"===Object.prototype.toString.call(b)?"object with keys {"+Object.keys(b).join(", ")+"}":b,""));}function ah(a){function b(b,c){if(a){var d=b.lastEffect;null!==d?(d.nextEffect=c,b.lastEffect=c):b.firstEffect=b.lastEffect=c;c.nextEffect=null;c.effectTag=8}}function c(c,d){if(!a)return null;for(;null!==d;)b(c,d),d=d.sibling;return null}function d(a,b){for(a=new Map;null!==b;)null!==b.key?a.set(b.key,b):a.set(b.index,
b),b=b.sibling;return a}function e(a,b){a=Sa(a,b);a.index=0;a.sibling=null;return a}function f(b,c,d){b.index=d;if(!a)return c;d=b.alternate;if(null!==d)return d=d.index,d<c?(b.effectTag=2,c):d;b.effectTag=2;return c}function g(b){a&&null===b.alternate&&(b.effectTag=2);return b}function h(a,b,c,d){if(null===b||6!==b.tag)return b=qe(c,a.mode,d),b.return=a,b;b=e(b,c);b.return=a;return b}function m(a,b,c,d){if(null!==b&&b.elementType===c.type)return d=e(b,c.props),d.ref=Rb(a,b,c),d.return=a,d;d=Oc(c.type,
c.key,c.props,null,a.mode,d);d.ref=Rb(a,b,c);d.return=a;return d}function n(a,b,c,d){if(null===b||4!==b.tag||b.stateNode.containerInfo!==c.containerInfo||b.stateNode.implementation!==c.implementation)return b=re(c,a.mode,d),b.return=a,b;b=e(b,c.children||[]);b.return=a;return b}function l(a,b,c,d,f){if(null===b||7!==b.tag)return b=Ha(c,a.mode,d,f),b.return=a,b;b=e(b,c);b.return=a;return b}function ba(a,b,c){if("string"===typeof b||"number"===typeof b)return b=qe(""+b,a.mode,c),b.return=a,b;if("object"===
typeof b&&null!==b){switch(b.$$typeof){case Pc:return c=Oc(b.type,b.key,b.props,null,a.mode,c),c.ref=Rb(a,null,b),c.return=a,c;case gb:return b=re(b,a.mode,c),b.return=a,b}if(Qc(b)||zb(b))return b=Ha(b,a.mode,c,null),b.return=a,b;Nc(a,b)}return null}function p(a,b,c,d){var e=null!==b?b.key:null;if("string"===typeof c||"number"===typeof c)return null!==e?null:h(a,b,""+c,d);if("object"===typeof c&&null!==c){switch(c.$$typeof){case Pc:return c.key===e?c.type===Ma?l(a,b,c.props.children,d,e):m(a,b,c,
d):null;case gb:return c.key===e?n(a,b,c,d):null}if(Qc(c)||zb(c))return null!==e?null:l(a,b,c,d,null);Nc(a,c)}return null}function t(a,b,c,d,e){if("string"===typeof d||"number"===typeof d)return a=a.get(c)||null,h(b,a,""+d,e);if("object"===typeof d&&null!==d){switch(d.$$typeof){case Pc:return a=a.get(null===d.key?c:d.key)||null,d.type===Ma?l(b,a,d.props.children,e,d.key):m(b,a,d,e);case gb:return a=a.get(null===d.key?c:d.key)||null,n(b,a,d,e)}if(Qc(d)||zb(d))return a=a.get(c)||null,l(b,a,d,e,null);
Nc(b,d)}return null}function q(e,g,h,m){for(var n=null,k=null,l=g,r=g=0,C=null;null!==l&&r<h.length;r++){l.index>r?(C=l,l=null):C=l.sibling;var O=p(e,l,h[r],m);if(null===O){null===l&&(l=C);break}a&&l&&null===O.alternate&&b(e,l);g=f(O,g,r);null===k?n=O:k.sibling=O;k=O;l=C}if(r===h.length)return c(e,l),n;if(null===l){for(;r<h.length;r++)l=ba(e,h[r],m),null!==l&&(g=f(l,g,r),null===k?n=l:k.sibling=l,k=l);return n}for(l=d(e,l);r<h.length;r++)C=t(l,e,r,h[r],m),null!==C&&(a&&null!==C.alternate&&l.delete(null===
C.key?r:C.key),g=f(C,g,r),null===k?n=C:k.sibling=C,k=C);a&&l.forEach(function(a){return b(e,a)});return n}function w(e,g,h,n){var m=zb(h);if("function"!==typeof m)throw Error(k(150));h=m.call(h);if(null==h)throw Error(k(151));for(var l=m=null,r=g,C=g=0,O=null,v=h.next();null!==r&&!v.done;C++,v=h.next()){r.index>C?(O=r,r=null):O=r.sibling;var q=p(e,r,v.value,n);if(null===q){null===r&&(r=O);break}a&&r&&null===q.alternate&&b(e,r);g=f(q,g,C);null===l?m=q:l.sibling=q;l=q;r=O}if(v.done)return c(e,r),m;
if(null===r){for(;!v.done;C++,v=h.next())v=ba(e,v.value,n),null!==v&&(g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);return m}for(r=d(e,r);!v.done;C++,v=h.next())v=t(r,e,C,v.value,n),null!==v&&(a&&null!==v.alternate&&r.delete(null===v.key?C:v.key),g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);a&&r.forEach(function(a){return b(e,a)});return m}return function(a,d,f,h){var m="object"===typeof f&&null!==f&&f.type===Ma&&null===f.key;m&&(f=f.props.children);var n="object"===typeof f&&null!==f;if(n)switch(f.$$typeof){case Pc:a:{n=
f.key;for(m=d;null!==m;){if(m.key===n){switch(m.tag){case 7:if(f.type===Ma){c(a,m.sibling);d=e(m,f.props.children);d.return=a;a=d;break a}break;default:if(m.elementType===f.type){c(a,m.sibling);d=e(m,f.props);d.ref=Rb(a,m,f);d.return=a;a=d;break a}}c(a,m);break}else b(a,m);m=m.sibling}f.type===Ma?(d=Ha(f.props.children,a.mode,h,f.key),d.return=a,a=d):(h=Oc(f.type,f.key,f.props,null,a.mode,h),h.ref=Rb(a,d,f),h.return=a,a=h)}return g(a);case gb:a:{for(m=f.key;null!==d;){if(d.key===m)if(4===d.tag&&d.stateNode.containerInfo===
f.containerInfo&&d.stateNode.implementation===f.implementation){c(a,d.sibling);d=e(d,f.children||[]);d.return=a;a=d;break a}else{c(a,d);break}else b(a,d);d=d.sibling}d=re(f,a.mode,h);d.return=a;a=d}return g(a)}if("string"===typeof f||"number"===typeof f)return f=""+f,null!==d&&6===d.tag?(c(a,d.sibling),d=e(d,f),d.return=a,a=d):(c(a,d),d=qe(f,a.mode,h),d.return=a,a=d),g(a);if(Qc(f))return q(a,d,f,h);if(zb(f))return w(a,d,f,h);n&&Nc(a,f);if("undefined"===typeof f&&!m)switch(a.tag){case 1:case 0:throw a=
a.type,Error(k(152,a.displayName||a.name||"Component"));}return c(a,d)}}function Ta(a){if(a===Sb)throw Error(k(174));return a}function se(a,b){y(Tb,b);y(Ub,a);y(ja,Sb);a=b.nodeType;switch(a){case 9:case 11:b=(b=b.documentElement)?b.namespaceURI:Hd(null,"");break;default:a=8===a?b.parentNode:b,b=a.namespaceURI||null,a=a.tagName,b=Hd(b,a)}q(ja);y(ja,b)}function tb(a){q(ja);q(Ub);q(Tb)}function bh(a){Ta(Tb.current);var b=Ta(ja.current);var c=Hd(b,a.type);b!==c&&(y(Ub,a),y(ja,c))}function te(a){Ub.current===
a&&(q(ja),q(Ub))}function Rc(a){for(var b=a;null!==b;){if(13===b.tag){var c=b.memoizedState;if(null!==c&&(c=c.dehydrated,null===c||c.data===$d||c.data===Zd))return b}else if(19===b.tag&&void 0!==b.memoizedProps.revealOrder){if(0!==(b.effectTag&64))return b}else if(null!==b.child){b.child.return=b;b=b.child;continue}if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}return null}function ue(a,b){return{responder:a,props:b}}
function S(){throw Error(k(321));}function ve(a,b){if(null===b)return!1;for(var c=0;c<b.length&&c<a.length;c++)if(!Qa(a[c],b[c]))return!1;return!0}function we(a,b,c,d,e,f){Ia=f;z=b;b.memoizedState=null;b.updateQueue=null;b.expirationTime=0;Sc.current=null===a||null===a.memoizedState?dj:ej;a=c(d,e);if(b.expirationTime===Ia){f=0;do{b.expirationTime=0;if(!(25>f))throw Error(k(301));f+=1;J=K=null;b.updateQueue=null;Sc.current=fj;a=c(d,e)}while(b.expirationTime===Ia)}Sc.current=Tc;b=null!==K&&null!==K.next;
Ia=0;J=K=z=null;Uc=!1;if(b)throw Error(k(300));return a}function ub(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};null===J?z.memoizedState=J=a:J=J.next=a;return J}function vb(){if(null===K){var a=z.alternate;a=null!==a?a.memoizedState:null}else a=K.next;var b=null===J?z.memoizedState:J.next;if(null!==b)J=b,K=a;else{if(null===a)throw Error(k(310));K=a;a={memoizedState:K.memoizedState,baseState:K.baseState,baseQueue:K.baseQueue,queue:K.queue,next:null};null===J?z.memoizedState=
J=a:J=J.next=a}return J}function Ua(a,b){return"function"===typeof b?b(a):b}function Vc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=K,e=d.baseQueue,f=c.pending;if(null!==f){if(null!==e){var g=e.next;e.next=f.next;f.next=g}d.baseQueue=e=f;c.pending=null}if(null!==e){e=e.next;d=d.baseState;var h=g=f=null,m=e;do{var n=m.expirationTime;if(n<Ia){var l={expirationTime:m.expirationTime,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,
next:null};null===h?(g=h=l,f=d):h=h.next=l;n>z.expirationTime&&(z.expirationTime=n,Kc(n))}else null!==h&&(h=h.next={expirationTime:1073741823,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,next:null}),Vg(n,m.suspenseConfig),d=m.eagerReducer===a?m.eagerState:a(d,m.action);m=m.next}while(null!==m&&m!==e);null===h?f=d:h.next=g;Qa(d,b.memoizedState)||(ia=!0);b.memoizedState=d;b.baseState=f;b.baseQueue=h;c.lastRenderedState=d}return[b.memoizedState,
c.dispatch]}function Wc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=c.dispatch,e=c.pending,f=b.memoizedState;if(null!==e){c.pending=null;var g=e=e.next;do f=a(f,g.action),g=g.next;while(g!==e);Qa(f,b.memoizedState)||(ia=!0);b.memoizedState=f;null===b.baseQueue&&(b.baseState=f);c.lastRenderedState=f}return[f,d]}function xe(a){var b=ub();"function"===typeof a&&(a=a());b.memoizedState=b.baseState=a;a=b.queue={pending:null,dispatch:null,lastRenderedReducer:Ua,
lastRenderedState:a};a=a.dispatch=ch.bind(null,z,a);return[b.memoizedState,a]}function ye(a,b,c,d){a={tag:a,create:b,destroy:c,deps:d,next:null};b=z.updateQueue;null===b?(b={lastEffect:null},z.updateQueue=b,b.lastEffect=a.next=a):(c=b.lastEffect,null===c?b.lastEffect=a.next=a:(d=c.next,c.next=a,a.next=d,b.lastEffect=a));return a}function dh(a){return vb().memoizedState}function ze(a,b,c,d){var e=ub();z.effectTag|=a;e.memoizedState=ye(1|b,c,void 0,void 0===d?null:d)}function Ae(a,b,c,d){var e=vb();
d=void 0===d?null:d;var f=void 0;if(null!==K){var g=K.memoizedState;f=g.destroy;if(null!==d&&ve(d,g.deps)){ye(b,c,f,d);return}}z.effectTag|=a;e.memoizedState=ye(1|b,c,f,d)}function eh(a,b){return ze(516,4,a,b)}function Xc(a,b){return Ae(516,4,a,b)}function fh(a,b){return Ae(4,2,a,b)}function gh(a,b){if("function"===typeof b)return a=a(),b(a),function(){b(null)};if(null!==b&&void 0!==b)return a=a(),b.current=a,function(){b.current=null}}function hh(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;
return Ae(4,2,gh.bind(null,b,a),c)}function Be(a,b){}function ih(a,b){ub().memoizedState=[a,void 0===b?null:b];return a}function Yc(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];c.memoizedState=[a,b];return a}function jh(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];a=a();c.memoizedState=[a,b];return a}function Ce(a,b,c){var d=Cc();Da(98>d?98:d,function(){a(!0)});Da(97<d?97:d,function(){var d=
X.suspense;X.suspense=void 0===b?null:b;try{a(!1),c()}finally{X.suspense=d}})}function ch(a,b,c){var d=ka(),e=Vb.suspense;d=Va(d,a,e);e={expirationTime:d,suspenseConfig:e,action:c,eagerReducer:null,eagerState:null,next:null};var f=b.pending;null===f?e.next=e:(e.next=f.next,f.next=e);b.pending=e;f=a.alternate;if(a===z||null!==f&&f===z)Uc=!0,e.expirationTime=Ia,z.expirationTime=Ia;else{if(0===a.expirationTime&&(null===f||0===f.expirationTime)&&(f=b.lastRenderedReducer,null!==f))try{var g=b.lastRenderedState,
h=f(g,c);e.eagerReducer=f;e.eagerState=h;if(Qa(h,g))return}catch(m){}finally{}Ja(a,d)}}function kh(a,b){var c=la(5,null,null,0);c.elementType="DELETED";c.type="DELETED";c.stateNode=b;c.return=a;c.effectTag=8;null!==a.lastEffect?(a.lastEffect.nextEffect=c,a.lastEffect=c):a.firstEffect=a.lastEffect=c}function lh(a,b){switch(a.tag){case 5:var c=a.type;b=1!==b.nodeType||c.toLowerCase()!==b.nodeName.toLowerCase()?null:b;return null!==b?(a.stateNode=b,!0):!1;case 6:return b=""===a.pendingProps||3!==b.nodeType?
null:b,null!==b?(a.stateNode=b,!0):!1;case 13:return!1;default:return!1}}function De(a){if(Wa){var b=Ka;if(b){var c=b;if(!lh(a,b)){b=kb(c.nextSibling);if(!b||!lh(a,b)){a.effectTag=a.effectTag&-1025|2;Wa=!1;ra=a;return}kh(ra,c)}ra=a;Ka=kb(b.firstChild)}else a.effectTag=a.effectTag&-1025|2,Wa=!1,ra=a}}function mh(a){for(a=a.return;null!==a&&5!==a.tag&&3!==a.tag&&13!==a.tag;)a=a.return;ra=a}function Zc(a){if(a!==ra)return!1;if(!Wa)return mh(a),Wa=!0,!1;var b=a.type;if(5!==a.tag||"head"!==b&&"body"!==
b&&!Yd(b,a.memoizedProps))for(b=Ka;b;)kh(a,b),b=kb(b.nextSibling);mh(a);if(13===a.tag){a=a.memoizedState;a=null!==a?a.dehydrated:null;if(!a)throw Error(k(317));a:{a=a.nextSibling;for(b=0;a;){if(8===a.nodeType){var c=a.data;if(c===og){if(0===b){Ka=kb(a.nextSibling);break a}b--}else c!==ng&&c!==Zd&&c!==$d||b++}a=a.nextSibling}Ka=null}}else Ka=ra?kb(a.stateNode.nextSibling):null;return!0}function Ee(){Ka=ra=null;Wa=!1}function T(a,b,c,d){b.child=null===a?Fe(b,null,c,d):wb(b,a.child,c,d)}function nh(a,
b,c,d,e){c=c.render;var f=b.ref;rb(b,e);d=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,d,e);return b.child}function oh(a,b,c,d,e,f){if(null===a){var g=c.type;if("function"===typeof g&&!Ge(g)&&void 0===g.defaultProps&&null===c.compare&&void 0===c.defaultProps)return b.tag=15,b.type=g,ph(a,b,g,d,e,f);a=Oc(c.type,null,d,null,b.mode,f);a.ref=b.ref;a.return=b;return b.child=a}g=a.child;if(e<
f&&(e=g.memoizedProps,c=c.compare,c=null!==c?c:Ob,c(e,d)&&a.ref===b.ref))return sa(a,b,f);b.effectTag|=1;a=Sa(g,d);a.ref=b.ref;a.return=b;return b.child=a}function ph(a,b,c,d,e,f){return null!==a&&Ob(a.memoizedProps,d)&&a.ref===b.ref&&(ia=!1,e<f)?(b.expirationTime=a.expirationTime,sa(a,b,f)):He(a,b,c,d,f)}function qh(a,b){var c=b.ref;if(null===a&&null!==c||null!==a&&a.ref!==c)b.effectTag|=128}function He(a,b,c,d,e){var f=N(c)?Ra:B.current;f=pb(b,f);rb(b,e);c=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=
a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,c,e);return b.child}function rh(a,b,c,d,e){if(N(c)){var f=!0;Bc(b)}else f=!1;rb(b,e);if(null===b.stateNode)null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),Yg(b,c,d),pe(b,c,d,e),d=!0;else if(null===a){var g=b.stateNode,h=b.memoizedProps;g.props=h;var m=g.context,n=c.contextType;"object"===typeof n&&null!==n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n));var l=c.getDerivedStateFromProps,k="function"===
typeof l||"function"===typeof g.getSnapshotBeforeUpdate;k||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n);Ga=!1;var p=b.memoizedState;g.state=p;Qb(b,d,g,e);m=b.memoizedState;h!==d||p!==m||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),m=b.memoizedState),(h=Ga||Xg(b,c,h,d,p,m,n))?(k||"function"!==typeof g.UNSAFE_componentWillMount&&"function"!==typeof g.componentWillMount||("function"===typeof g.componentWillMount&&
g.componentWillMount(),"function"===typeof g.UNSAFE_componentWillMount&&g.UNSAFE_componentWillMount()),"function"===typeof g.componentDidMount&&(b.effectTag|=4)):("function"===typeof g.componentDidMount&&(b.effectTag|=4),b.memoizedProps=d,b.memoizedState=m),g.props=d,g.state=m,g.context=n,d=h):("function"===typeof g.componentDidMount&&(b.effectTag|=4),d=!1)}else g=b.stateNode,oe(a,b),h=b.memoizedProps,g.props=b.type===b.elementType?h:aa(b.type,h),m=g.context,n=c.contextType,"object"===typeof n&&null!==
n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n)),l=c.getDerivedStateFromProps,(k="function"===typeof l||"function"===typeof g.getSnapshotBeforeUpdate)||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n),Ga=!1,m=b.memoizedState,g.state=m,Qb(b,d,g,e),p=b.memoizedState,h!==d||m!==p||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),p=b.memoizedState),(l=Ga||Xg(b,c,h,d,m,p,n))?(k||"function"!==typeof g.UNSAFE_componentWillUpdate&&
"function"!==typeof g.componentWillUpdate||("function"===typeof g.componentWillUpdate&&g.componentWillUpdate(d,p,n),"function"===typeof g.UNSAFE_componentWillUpdate&&g.UNSAFE_componentWillUpdate(d,p,n)),"function"===typeof g.componentDidUpdate&&(b.effectTag|=4),"function"===typeof g.getSnapshotBeforeUpdate&&(b.effectTag|=256)):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===
a.memoizedState||(b.effectTag|=256),b.memoizedProps=d,b.memoizedState=p),g.props=d,g.state=p,g.context=n,d=l):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=256),d=!1);return Ie(a,b,c,d,f,e)}function Ie(a,b,c,d,e,f){qh(a,b);var g=0!==(b.effectTag&64);if(!d&&!g)return e&&Hg(b,c,!1),sa(a,b,f);d=b.stateNode;gj.current=b;var h=g&&"function"!==typeof c.getDerivedStateFromError?
null:d.render();b.effectTag|=1;null!==a&&g?(b.child=wb(b,a.child,null,f),b.child=wb(b,null,h,f)):T(a,b,h,f);b.memoizedState=d.state;e&&Hg(b,c,!0);return b.child}function sh(a){var b=a.stateNode;b.pendingContext?Fg(a,b.pendingContext,b.pendingContext!==b.context):b.context&&Fg(a,b.context,!1);se(a,b.containerInfo)}function th(a,b,c){var d=b.mode,e=b.pendingProps,f=D.current,g=!1,h;(h=0!==(b.effectTag&64))||(h=0!==(f&2)&&(null===a||null!==a.memoizedState));h?(g=!0,b.effectTag&=-65):null!==a&&null===
a.memoizedState||void 0===e.fallback||!0===e.unstable_avoidThisFallback||(f|=1);y(D,f&1);if(null===a){void 0!==e.fallback&&De(b);if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;b.memoizedState=Je;b.child=e;return c}d=e.children;b.memoizedState=null;return b.child=Fe(b,null,d,c)}if(null!==a.memoizedState){a=a.child;d=a.sibling;if(g){e=e.fallback;
c=Sa(a,a.pendingProps);c.return=b;if(0===(b.mode&2)&&(g=null!==b.memoizedState?b.child.child:b.child,g!==a.child))for(c.child=g;null!==g;)g.return=c,g=g.sibling;d=Sa(d,e);d.return=b;c.sibling=d;c.childExpirationTime=0;b.memoizedState=Je;b.child=c;return d}c=wb(b,a.child,e.children,c);b.memoizedState=null;return b.child=c}a=a.child;if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;e.child=a;null!==a&&(a.return=e);if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==
a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;c.effectTag|=2;e.childExpirationTime=0;b.memoizedState=Je;b.child=e;return c}b.memoizedState=null;return b.child=wb(b,a,e.children,c)}function uh(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);Sg(a.return,b)}function Ke(a,b,c,d,e,f){var g=a.memoizedState;null===g?a.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:d,tail:c,tailExpiration:0,tailMode:e,
lastEffect:f}:(g.isBackwards=b,g.rendering=null,g.renderingStartTime=0,g.last=d,g.tail=c,g.tailExpiration=0,g.tailMode=e,g.lastEffect=f)}function vh(a,b,c){var d=b.pendingProps,e=d.revealOrder,f=d.tail;T(a,b,d.children,c);d=D.current;if(0!==(d&2))d=d&1|2,b.effectTag|=64;else{if(null!==a&&0!==(a.effectTag&64))a:for(a=b.child;null!==a;){if(13===a.tag)null!==a.memoizedState&&uh(a,c);else if(19===a.tag)uh(a,c);else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===b)break a;for(;null===a.sibling;){if(null===
a.return||a.return===b)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}d&=1}y(D,d);if(0===(b.mode&2))b.memoizedState=null;else switch(e){case "forwards":c=b.child;for(e=null;null!==c;)a=c.alternate,null!==a&&null===Rc(a)&&(e=c),c=c.sibling;c=e;null===c?(e=b.child,b.child=null):(e=c.sibling,c.sibling=null);Ke(b,!1,e,c,f,b.lastEffect);break;case "backwards":c=null;e=b.child;for(b.child=null;null!==e;){a=e.alternate;if(null!==a&&null===Rc(a)){b.child=e;break}a=e.sibling;e.sibling=c;c=e;e=a}Ke(b,
!0,c,null,f,b.lastEffect);break;case "together":Ke(b,!1,null,null,void 0,b.lastEffect);break;default:b.memoizedState=null}return b.child}function sa(a,b,c){null!==a&&(b.dependencies=a.dependencies);var d=b.expirationTime;0!==d&&Kc(d);if(b.childExpirationTime<c)return null;if(null!==a&&b.child!==a.child)throw Error(k(153));if(null!==b.child){a=b.child;c=Sa(a,a.pendingProps);b.child=c;for(c.return=b;null!==a.sibling;)a=a.sibling,c=c.sibling=Sa(a,a.pendingProps),c.return=b;c.sibling=null}return b.child}
function $c(a,b){switch(a.tailMode){case "hidden":b=a.tail;for(var c=null;null!==b;)null!==b.alternate&&(c=b),b=b.sibling;null===c?a.tail=null:c.sibling=null;break;case "collapsed":c=a.tail;for(var d=null;null!==c;)null!==c.alternate&&(d=c),c=c.sibling;null===d?b||null===a.tail?a.tail=null:a.tail.sibling=null:d.sibling=null}}function hj(a,b,c){var d=b.pendingProps;switch(b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return N(b.type)&&(q(G),q(B)),
null;case 3:return tb(),q(G),q(B),c=b.stateNode,c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),null!==a&&null!==a.child||!Zc(b)||(b.effectTag|=4),wh(b),null;case 5:te(b);c=Ta(Tb.current);var e=b.type;if(null!==a&&null!=b.stateNode)ij(a,b,e,d,c),a.ref!==b.ref&&(b.effectTag|=128);else{if(!d){if(null===b.stateNode)throw Error(k(166));return null}a=Ta(ja.current);if(Zc(b)){d=b.stateNode;e=b.type;var f=b.memoizedProps;d[Aa]=b;d[vc]=f;switch(e){case "iframe":case "object":case "embed":w("load",
d);break;case "video":case "audio":for(a=0;a<Db.length;a++)w(Db[a],d);break;case "source":w("error",d);break;case "img":case "image":case "link":w("error",d);w("load",d);break;case "form":w("reset",d);w("submit",d);break;case "details":w("toggle",d);break;case "input":Hf(d,f);w("invalid",d);oa(c,"onChange");break;case "select":d._wrapperState={wasMultiple:!!f.multiple};w("invalid",d);oa(c,"onChange");break;case "textarea":Kf(d,f),w("invalid",d),oa(c,"onChange")}Ud(e,f);a=null;for(var g in f)if(f.hasOwnProperty(g)){var h=
f[g];"children"===g?"string"===typeof h?d.textContent!==h&&(a=["children",h]):"number"===typeof h&&d.textContent!==""+h&&(a=["children",""+h]):db.hasOwnProperty(g)&&null!=h&&oa(c,g)}switch(e){case "input":mc(d);Jf(d,f,!0);break;case "textarea":mc(d);Mf(d);break;case "select":case "option":break;default:"function"===typeof f.onClick&&(d.onclick=uc)}c=a;b.updateQueue=c;null!==c&&(b.effectTag|=4)}else{g=9===c.nodeType?c:c.ownerDocument;"http://www.w3.org/1999/xhtml"===a&&(a=Nf(e));"http://www.w3.org/1999/xhtml"===
a?"script"===e?(a=g.createElement("div"),a.innerHTML="<script>\x3c/script>",a=a.removeChild(a.firstChild)):"string"===typeof d.is?a=g.createElement(e,{is:d.is}):(a=g.createElement(e),"select"===e&&(g=a,d.multiple?g.multiple=!0:d.size&&(g.size=d.size))):a=g.createElementNS(a,e);a[Aa]=b;a[vc]=d;jj(a,b,!1,!1);b.stateNode=a;g=Vd(e,d);switch(e){case "iframe":case "object":case "embed":w("load",a);h=d;break;case "video":case "audio":for(h=0;h<Db.length;h++)w(Db[h],a);h=d;break;case "source":w("error",a);
h=d;break;case "img":case "image":case "link":w("error",a);w("load",a);h=d;break;case "form":w("reset",a);w("submit",a);h=d;break;case "details":w("toggle",a);h=d;break;case "input":Hf(a,d);h=Cd(a,d);w("invalid",a);oa(c,"onChange");break;case "option":h=Fd(a,d);break;case "select":a._wrapperState={wasMultiple:!!d.multiple};h=M({},d,{value:void 0});w("invalid",a);oa(c,"onChange");break;case "textarea":Kf(a,d);h=Gd(a,d);w("invalid",a);oa(c,"onChange");break;default:h=d}Ud(e,h);var m=h;for(f in m)if(m.hasOwnProperty(f)){var n=
m[f];"style"===f?gg(a,n):"dangerouslySetInnerHTML"===f?(n=n?n.__html:void 0,null!=n&&xh(a,n)):"children"===f?"string"===typeof n?("textarea"!==e||""!==n)&&Wb(a,n):"number"===typeof n&&Wb(a,""+n):"suppressContentEditableWarning"!==f&&"suppressHydrationWarning"!==f&&"autoFocus"!==f&&(db.hasOwnProperty(f)?null!=n&&oa(c,f):null!=n&&xd(a,f,n,g))}switch(e){case "input":mc(a);Jf(a,d,!1);break;case "textarea":mc(a);Mf(a);break;case "option":null!=d.value&&a.setAttribute("value",""+va(d.value));break;case "select":a.multiple=
!!d.multiple;c=d.value;null!=c?hb(a,!!d.multiple,c,!1):null!=d.defaultValue&&hb(a,!!d.multiple,d.defaultValue,!0);break;default:"function"===typeof h.onClick&&(a.onclick=uc)}lg(e,d)&&(b.effectTag|=4)}null!==b.ref&&(b.effectTag|=128)}return null;case 6:if(a&&null!=b.stateNode)kj(a,b,a.memoizedProps,d);else{if("string"!==typeof d&&null===b.stateNode)throw Error(k(166));c=Ta(Tb.current);Ta(ja.current);Zc(b)?(c=b.stateNode,d=b.memoizedProps,c[Aa]=b,c.nodeValue!==d&&(b.effectTag|=4)):(c=(9===c.nodeType?
c:c.ownerDocument).createTextNode(d),c[Aa]=b,b.stateNode=c)}return null;case 13:q(D);d=b.memoizedState;if(0!==(b.effectTag&64))return b.expirationTime=c,b;c=null!==d;d=!1;null===a?void 0!==b.memoizedProps.fallback&&Zc(b):(e=a.memoizedState,d=null!==e,c||null===e||(e=a.child.sibling,null!==e&&(f=b.firstEffect,null!==f?(b.firstEffect=e,e.nextEffect=f):(b.firstEffect=b.lastEffect=e,e.nextEffect=null),e.effectTag=8)));if(c&&!d&&0!==(b.mode&2))if(null===a&&!0!==b.memoizedProps.unstable_avoidThisFallback||
0!==(D.current&1))F===Xa&&(F=ad);else{if(F===Xa||F===ad)F=bd;0!==Xb&&null!==U&&(Ya(U,P),yh(U,Xb))}if(c||d)b.effectTag|=4;return null;case 4:return tb(),wh(b),null;case 10:return me(b),null;case 17:return N(b.type)&&(q(G),q(B)),null;case 19:q(D);d=b.memoizedState;if(null===d)return null;e=0!==(b.effectTag&64);f=d.rendering;if(null===f)if(e)$c(d,!1);else{if(F!==Xa||null!==a&&0!==(a.effectTag&64))for(f=b.child;null!==f;){a=Rc(f);if(null!==a){b.effectTag|=64;$c(d,!1);e=a.updateQueue;null!==e&&(b.updateQueue=
e,b.effectTag|=4);null===d.lastEffect&&(b.firstEffect=null);b.lastEffect=d.lastEffect;for(d=b.child;null!==d;)e=d,f=c,e.effectTag&=2,e.nextEffect=null,e.firstEffect=null,e.lastEffect=null,a=e.alternate,null===a?(e.childExpirationTime=0,e.expirationTime=f,e.child=null,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null):(e.childExpirationTime=a.childExpirationTime,e.expirationTime=a.expirationTime,e.child=a.child,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,
e.updateQueue=a.updateQueue,f=a.dependencies,e.dependencies=null===f?null:{expirationTime:f.expirationTime,firstContext:f.firstContext,responders:f.responders}),d=d.sibling;y(D,D.current&1|2);return b.child}f=f.sibling}}else{if(!e)if(a=Rc(f),null!==a){if(b.effectTag|=64,e=!0,c=a.updateQueue,null!==c&&(b.updateQueue=c,b.effectTag|=4),$c(d,!0),null===d.tail&&"hidden"===d.tailMode&&!f.alternate)return b=b.lastEffect=d.lastEffect,null!==b&&(b.nextEffect=null),null}else 2*Y()-d.renderingStartTime>d.tailExpiration&&
1<c&&(b.effectTag|=64,e=!0,$c(d,!1),b.expirationTime=b.childExpirationTime=c-1);d.isBackwards?(f.sibling=b.child,b.child=f):(c=d.last,null!==c?c.sibling=f:b.child=f,d.last=f)}return null!==d.tail?(0===d.tailExpiration&&(d.tailExpiration=Y()+500),c=d.tail,d.rendering=c,d.tail=c.sibling,d.lastEffect=b.lastEffect,d.renderingStartTime=Y(),c.sibling=null,b=D.current,y(D,e?b&1|2:b&1),c):null}throw Error(k(156,b.tag));}function lj(a,b){switch(a.tag){case 1:return N(a.type)&&(q(G),q(B)),b=a.effectTag,b&4096?
(a.effectTag=b&-4097|64,a):null;case 3:tb();q(G);q(B);b=a.effectTag;if(0!==(b&64))throw Error(k(285));a.effectTag=b&-4097|64;return a;case 5:return te(a),null;case 13:return q(D),b=a.effectTag,b&4096?(a.effectTag=b&-4097|64,a):null;case 19:return q(D),null;case 4:return tb(),null;case 10:return me(a),null;default:return null}}function Le(a,b){return{value:a,source:b,stack:Bd(b)}}function Me(a,b){var c=b.source,d=b.stack;null===d&&null!==c&&(d=Bd(c));null!==c&&na(c.type);b=b.value;null!==a&&1===a.tag&&
na(a.type);try{console.error(b)}catch(e){setTimeout(function(){throw e;})}}function mj(a,b){try{b.props=a.memoizedProps,b.state=a.memoizedState,b.componentWillUnmount()}catch(c){Za(a,c)}}function zh(a){var b=a.ref;if(null!==b)if("function"===typeof b)try{b(null)}catch(c){Za(a,c)}else b.current=null}function nj(a,b){switch(b.tag){case 0:case 11:case 15:case 22:return;case 1:if(b.effectTag&256&&null!==a){var c=a.memoizedProps,d=a.memoizedState;a=b.stateNode;b=a.getSnapshotBeforeUpdate(b.elementType===
b.type?c:aa(b.type,c),d);a.__reactInternalSnapshotBeforeUpdate=b}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(k(163));}function Ah(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.destroy;c.destroy=void 0;void 0!==d&&d()}c=c.next}while(c!==b)}}function Bh(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.create;c.destroy=d()}c=c.next}while(c!==b)}}function oj(a,b,c,d){switch(c.tag){case 0:case 11:case 15:case 22:Bh(3,
c);return;case 1:a=c.stateNode;c.effectTag&4&&(null===b?a.componentDidMount():(d=c.elementType===c.type?b.memoizedProps:aa(c.type,b.memoizedProps),a.componentDidUpdate(d,b.memoizedState,a.__reactInternalSnapshotBeforeUpdate)));b=c.updateQueue;null!==b&&Wg(c,b,a);return;case 3:b=c.updateQueue;if(null!==b){a=null;if(null!==c.child)switch(c.child.tag){case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}Wg(c,b,a)}return;case 5:a=c.stateNode;null===b&&c.effectTag&4&&lg(c.type,c.memoizedProps)&&
a.focus();return;case 6:return;case 4:return;case 12:return;case 13:null===c.memoizedState&&(c=c.alternate,null!==c&&(c=c.memoizedState,null!==c&&(c=c.dehydrated,null!==c&&bg(c))));return;case 19:case 17:case 20:case 21:return}throw Error(k(163));}function Ch(a,b,c){"function"===typeof Ne&&Ne(b);switch(b.tag){case 0:case 11:case 14:case 15:case 22:a=b.updateQueue;if(null!==a&&(a=a.lastEffect,null!==a)){var d=a.next;Da(97<c?97:c,function(){var a=d;do{var c=a.destroy;if(void 0!==c){var g=b;try{c()}catch(h){Za(g,
h)}}a=a.next}while(a!==d)})}break;case 1:zh(b);c=b.stateNode;"function"===typeof c.componentWillUnmount&&mj(b,c);break;case 5:zh(b);break;case 4:Dh(a,b,c)}}function Eh(a){var b=a.alternate;a.return=null;a.child=null;a.memoizedState=null;a.updateQueue=null;a.dependencies=null;a.alternate=null;a.firstEffect=null;a.lastEffect=null;a.pendingProps=null;a.memoizedProps=null;a.stateNode=null;null!==b&&Eh(b)}function Fh(a){return 5===a.tag||3===a.tag||4===a.tag}function Gh(a){a:{for(var b=a.return;null!==
b;){if(Fh(b)){var c=b;break a}b=b.return}throw Error(k(160));}b=c.stateNode;switch(c.tag){case 5:var d=!1;break;case 3:b=b.containerInfo;d=!0;break;case 4:b=b.containerInfo;d=!0;break;default:throw Error(k(161));}c.effectTag&16&&(Wb(b,""),c.effectTag&=-17);a:b:for(c=a;;){for(;null===c.sibling;){if(null===c.return||Fh(c.return)){c=null;break a}c=c.return}c.sibling.return=c.return;for(c=c.sibling;5!==c.tag&&6!==c.tag&&18!==c.tag;){if(c.effectTag&2)continue b;if(null===c.child||4===c.tag)continue b;
else c.child.return=c,c=c.child}if(!(c.effectTag&2)){c=c.stateNode;break a}}d?Oe(a,c,b):Pe(a,c,b)}function Oe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?8===c.nodeType?c.parentNode.insertBefore(a,b):c.insertBefore(a,b):(8===c.nodeType?(b=c.parentNode,b.insertBefore(a,c)):(b=c,b.appendChild(a)),c=c._reactRootContainer,null!==c&&void 0!==c||null!==b.onclick||(b.onclick=uc));else if(4!==d&&(a=a.child,null!==a))for(Oe(a,b,c),a=a.sibling;null!==a;)Oe(a,b,c),a=a.sibling}
function Pe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?c.insertBefore(a,b):c.appendChild(a);else if(4!==d&&(a=a.child,null!==a))for(Pe(a,b,c),a=a.sibling;null!==a;)Pe(a,b,c),a=a.sibling}function Dh(a,b,c){for(var d=b,e=!1,f,g;;){if(!e){e=d.return;a:for(;;){if(null===e)throw Error(k(160));f=e.stateNode;switch(e.tag){case 5:g=!1;break a;case 3:f=f.containerInfo;g=!0;break a;case 4:f=f.containerInfo;g=!0;break a}e=e.return}e=!0}if(5===d.tag||6===d.tag){a:for(var h=
a,m=d,n=c,l=m;;)if(Ch(h,l,n),null!==l.child&&4!==l.tag)l.child.return=l,l=l.child;else{if(l===m)break a;for(;null===l.sibling;){if(null===l.return||l.return===m)break a;l=l.return}l.sibling.return=l.return;l=l.sibling}g?(h=f,m=d.stateNode,8===h.nodeType?h.parentNode.removeChild(m):h.removeChild(m)):f.removeChild(d.stateNode)}else if(4===d.tag){if(null!==d.child){f=d.stateNode.containerInfo;g=!0;d.child.return=d;d=d.child;continue}}else if(Ch(a,d,c),null!==d.child){d.child.return=d;d=d.child;continue}if(d===
b)break;for(;null===d.sibling;){if(null===d.return||d.return===b)return;d=d.return;4===d.tag&&(e=!1)}d.sibling.return=d.return;d=d.sibling}}function Qe(a,b){switch(b.tag){case 0:case 11:case 14:case 15:case 22:Ah(3,b);return;case 1:return;case 5:var c=b.stateNode;if(null!=c){var d=b.memoizedProps,e=null!==a?a.memoizedProps:d;a=b.type;var f=b.updateQueue;b.updateQueue=null;if(null!==f){c[vc]=d;"input"===a&&"radio"===d.type&&null!=d.name&&If(c,d);Vd(a,e);b=Vd(a,d);for(e=0;e<f.length;e+=2){var g=f[e],
h=f[e+1];"style"===g?gg(c,h):"dangerouslySetInnerHTML"===g?xh(c,h):"children"===g?Wb(c,h):xd(c,g,h,b)}switch(a){case "input":Dd(c,d);break;case "textarea":Lf(c,d);break;case "select":b=c._wrapperState.wasMultiple,c._wrapperState.wasMultiple=!!d.multiple,a=d.value,null!=a?hb(c,!!d.multiple,a,!1):b!==!!d.multiple&&(null!=d.defaultValue?hb(c,!!d.multiple,d.defaultValue,!0):hb(c,!!d.multiple,d.multiple?[]:"",!1))}}}return;case 6:if(null===b.stateNode)throw Error(k(162));b.stateNode.nodeValue=b.memoizedProps;
return;case 3:b=b.stateNode;b.hydrate&&(b.hydrate=!1,bg(b.containerInfo));return;case 12:return;case 13:c=b;null===b.memoizedState?d=!1:(d=!0,c=b.child,Re=Y());if(null!==c)a:for(a=c;;){if(5===a.tag)f=a.stateNode,d?(f=f.style,"function"===typeof f.setProperty?f.setProperty("display","none","important"):f.display="none"):(f=a.stateNode,e=a.memoizedProps.style,e=void 0!==e&&null!==e&&e.hasOwnProperty("display")?e.display:null,f.style.display=fg("display",e));else if(6===a.tag)a.stateNode.nodeValue=d?
"":a.memoizedProps;else if(13===a.tag&&null!==a.memoizedState&&null===a.memoizedState.dehydrated){f=a.child.sibling;f.return=a;a=f;continue}else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===c)break;for(;null===a.sibling;){if(null===a.return||a.return===c)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}Hh(b);return;case 19:Hh(b);return;case 17:return}throw Error(k(163));}function Hh(a){var b=a.updateQueue;if(null!==b){a.updateQueue=null;var c=a.stateNode;null===c&&(c=a.stateNode=
new pj);b.forEach(function(b){var d=qj.bind(null,a,b);c.has(b)||(c.add(b),b.then(d,d))})}}function Ih(a,b,c){c=Ea(c,null);c.tag=3;c.payload={element:null};var d=b.value;c.callback=function(){cd||(cd=!0,Se=d);Me(a,b)};return c}function Jh(a,b,c){c=Ea(c,null);c.tag=3;var d=a.type.getDerivedStateFromError;if("function"===typeof d){var e=b.value;c.payload=function(){Me(a,b);return d(e)}}var f=a.stateNode;null!==f&&"function"===typeof f.componentDidCatch&&(c.callback=function(){"function"!==typeof d&&
(null===La?La=new Set([this]):La.add(this),Me(a,b));var c=b.stack;this.componentDidCatch(b.value,{componentStack:null!==c?c:""})});return c}function ka(){return(p&(ca|ma))!==H?1073741821-(Y()/10|0):0!==dd?dd:dd=1073741821-(Y()/10|0)}function Va(a,b,c){b=b.mode;if(0===(b&2))return 1073741823;var d=Cc();if(0===(b&4))return 99===d?1073741823:1073741822;if((p&ca)!==H)return P;if(null!==c)a=Fc(a,c.timeoutMs|0||5E3,250);else switch(d){case 99:a=1073741823;break;case 98:a=Fc(a,150,100);break;case 97:case 96:a=
Fc(a,5E3,250);break;case 95:a=2;break;default:throw Error(k(326));}null!==U&&a===P&&--a;return a}function ed(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);var d=a.return,e=null;if(null===d&&3===a.tag)e=a.stateNode;else for(;null!==d;){c=d.alternate;d.childExpirationTime<b&&(d.childExpirationTime=b);null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);if(null===d.return&&3===d.tag){e=d.stateNode;break}d=d.return}null!==e&&
(U===e&&(Kc(b),F===bd&&Ya(e,P)),yh(e,b));return e}function fd(a){var b=a.lastExpiredTime;if(0!==b)return b;b=a.firstPendingTime;if(!Kh(a,b))return b;var c=a.lastPingedTime;a=a.nextKnownPendingLevel;a=c>a?c:a;return 2>=a&&b!==a?0:a}function V(a){if(0!==a.lastExpiredTime)a.callbackExpirationTime=1073741823,a.callbackPriority=99,a.callbackNode=Og(Te.bind(null,a));else{var b=fd(a),c=a.callbackNode;if(0===b)null!==c&&(a.callbackNode=null,a.callbackExpirationTime=0,a.callbackPriority=90);else{var d=ka();
1073741823===b?d=99:1===b||2===b?d=95:(d=10*(1073741821-b)-10*(1073741821-d),d=0>=d?99:250>=d?98:5250>=d?97:95);if(null!==c){var e=a.callbackPriority;if(a.callbackExpirationTime===b&&e>=d)return;c!==Qg&&Rg(c)}a.callbackExpirationTime=b;a.callbackPriority=d;b=1073741823===b?Og(Te.bind(null,a)):Ng(d,Lh.bind(null,a),{timeout:10*(1073741821-b)-Y()});a.callbackNode=b}}}function Lh(a,b){dd=0;if(b)return b=ka(),Ue(a,b),V(a),null;var c=fd(a);if(0!==c){b=a.callbackNode;if((p&(ca|ma))!==H)throw Error(k(327));
xb();a===U&&c===P||$a(a,c);if(null!==t){var d=p;p|=ca;var e=Mh();do try{rj();break}catch(h){Nh(a,h)}while(1);le();p=d;gd.current=e;if(F===hd)throw b=id,$a(a,c),Ya(a,c),V(a),b;if(null===t)switch(e=a.finishedWork=a.current.alternate,a.finishedExpirationTime=c,d=F,U=null,d){case Xa:case hd:throw Error(k(345));case Oh:Ue(a,2<c?2:c);break;case ad:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(1073741823===ta&&(e=Re+Ph-Y(),10<e)){if(jd){var f=a.lastPingedTime;if(0===f||f>=c){a.lastPingedTime=
c;$a(a,c);break}}f=fd(a);if(0!==f&&f!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}a.timeoutHandle=We(ab.bind(null,a),e);break}ab(a);break;case bd:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(jd&&(e=a.lastPingedTime,0===e||e>=c)){a.lastPingedTime=c;$a(a,c);break}e=fd(a);if(0!==e&&e!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}1073741823!==Yb?d=10*(1073741821-Yb)-Y():1073741823===ta?d=0:(d=10*(1073741821-ta)-5E3,e=Y(),c=10*(1073741821-c)-e,d=e-d,0>d&&(d=0),d=
(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3E3>d?3E3:4320>d?4320:1960*sj(d/1960))-d,c<d&&(d=c));if(10<d){a.timeoutHandle=We(ab.bind(null,a),d);break}ab(a);break;case Xe:if(1073741823!==ta&&null!==kd){f=ta;var g=kd;d=g.busyMinDurationMs|0;0>=d?d=0:(e=g.busyDelayMs|0,f=Y()-(10*(1073741821-f)-(g.timeoutMs|0||5E3)),d=f<=e?0:e+d-f);if(10<d){Ya(a,c);a.timeoutHandle=We(ab.bind(null,a),d);break}}ab(a);break;default:throw Error(k(329));}V(a);if(a.callbackNode===b)return Lh.bind(null,a)}}return null}function Te(a){var b=
a.lastExpiredTime;b=0!==b?b:1073741823;if((p&(ca|ma))!==H)throw Error(k(327));xb();a===U&&b===P||$a(a,b);if(null!==t){var c=p;p|=ca;var d=Mh();do try{tj();break}catch(e){Nh(a,e)}while(1);le();p=c;gd.current=d;if(F===hd)throw c=id,$a(a,b),Ya(a,b),V(a),c;if(null!==t)throw Error(k(261));a.finishedWork=a.current.alternate;a.finishedExpirationTime=b;U=null;ab(a);V(a)}return null}function uj(){if(null!==bb){var a=bb;bb=null;a.forEach(function(a,c){Ue(c,a);V(c)});ha()}}function Qh(a,b){var c=p;p|=1;try{return a(b)}finally{p=
c,p===H&&ha()}}function Rh(a,b){var c=p;p&=-2;p|=Ye;try{return a(b)}finally{p=c,p===H&&ha()}}function $a(a,b){a.finishedWork=null;a.finishedExpirationTime=0;var c=a.timeoutHandle;-1!==c&&(a.timeoutHandle=-1,vj(c));if(null!==t)for(c=t.return;null!==c;){var d=c;switch(d.tag){case 1:d=d.type.childContextTypes;null!==d&&void 0!==d&&(q(G),q(B));break;case 3:tb();q(G);q(B);break;case 5:te(d);break;case 4:tb();break;case 13:q(D);break;case 19:q(D);break;case 10:me(d)}c=c.return}U=a;t=Sa(a.current,null);
P=b;F=Xa;id=null;Yb=ta=1073741823;kd=null;Xb=0;jd=!1}function Nh(a,b){do{try{le();Sc.current=Tc;if(Uc)for(var c=z.memoizedState;null!==c;){var d=c.queue;null!==d&&(d.pending=null);c=c.next}Ia=0;J=K=z=null;Uc=!1;if(null===t||null===t.return)return F=hd,id=b,t=null;a:{var e=a,f=t.return,g=t,h=b;b=P;g.effectTag|=2048;g.firstEffect=g.lastEffect=null;if(null!==h&&"object"===typeof h&&"function"===typeof h.then){var m=h;if(0===(g.mode&2)){var n=g.alternate;n?(g.updateQueue=n.updateQueue,g.memoizedState=
n.memoizedState,g.expirationTime=n.expirationTime):(g.updateQueue=null,g.memoizedState=null)}var l=0!==(D.current&1),k=f;do{var p;if(p=13===k.tag){var q=k.memoizedState;if(null!==q)p=null!==q.dehydrated?!0:!1;else{var w=k.memoizedProps;p=void 0===w.fallback?!1:!0!==w.unstable_avoidThisFallback?!0:l?!1:!0}}if(p){var y=k.updateQueue;if(null===y){var r=new Set;r.add(m);k.updateQueue=r}else y.add(m);if(0===(k.mode&2)){k.effectTag|=64;g.effectTag&=-2981;if(1===g.tag)if(null===g.alternate)g.tag=17;else{var O=
Ea(1073741823,null);O.tag=Jc;Fa(g,O)}g.expirationTime=1073741823;break a}h=void 0;g=b;var v=e.pingCache;null===v?(v=e.pingCache=new wj,h=new Set,v.set(m,h)):(h=v.get(m),void 0===h&&(h=new Set,v.set(m,h)));if(!h.has(g)){h.add(g);var x=xj.bind(null,e,m,g);m.then(x,x)}k.effectTag|=4096;k.expirationTime=b;break a}k=k.return}while(null!==k);h=Error((na(g.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+
Bd(g))}F!==Xe&&(F=Oh);h=Le(h,g);k=f;do{switch(k.tag){case 3:m=h;k.effectTag|=4096;k.expirationTime=b;var A=Ih(k,m,b);Ug(k,A);break a;case 1:m=h;var u=k.type,B=k.stateNode;if(0===(k.effectTag&64)&&("function"===typeof u.getDerivedStateFromError||null!==B&&"function"===typeof B.componentDidCatch&&(null===La||!La.has(B)))){k.effectTag|=4096;k.expirationTime=b;var H=Jh(k,m,b);Ug(k,H);break a}}k=k.return}while(null!==k)}t=Sh(t)}catch(cj){b=cj;continue}break}while(1)}function Mh(a){a=gd.current;gd.current=
Tc;return null===a?Tc:a}function Vg(a,b){a<ta&&2<a&&(ta=a);null!==b&&a<Yb&&2<a&&(Yb=a,kd=b)}function Kc(a){a>Xb&&(Xb=a)}function tj(){for(;null!==t;)t=Th(t)}function rj(){for(;null!==t&&!yj();)t=Th(t)}function Th(a){var b=zj(a.alternate,a,P);a.memoizedProps=a.pendingProps;null===b&&(b=Sh(a));Uh.current=null;return b}function Sh(a){t=a;do{var b=t.alternate;a=t.return;if(0===(t.effectTag&2048)){b=hj(b,t,P);if(1===P||1!==t.childExpirationTime){for(var c=0,d=t.child;null!==d;){var e=d.expirationTime,
f=d.childExpirationTime;e>c&&(c=e);f>c&&(c=f);d=d.sibling}t.childExpirationTime=c}if(null!==b)return b;null!==a&&0===(a.effectTag&2048)&&(null===a.firstEffect&&(a.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==a.lastEffect&&(a.lastEffect.nextEffect=t.firstEffect),a.lastEffect=t.lastEffect),1<t.effectTag&&(null!==a.lastEffect?a.lastEffect.nextEffect=t:a.firstEffect=t,a.lastEffect=t))}else{b=lj(t);if(null!==b)return b.effectTag&=2047,b;null!==a&&(a.firstEffect=a.lastEffect=null,a.effectTag|=
2048)}b=t.sibling;if(null!==b)return b;t=a}while(null!==t);F===Xa&&(F=Xe);return null}function Ve(a){var b=a.expirationTime;a=a.childExpirationTime;return b>a?b:a}function ab(a){var b=Cc();Da(99,Aj.bind(null,a,b));return null}function Aj(a,b){do xb();while(null!==Zb);if((p&(ca|ma))!==H)throw Error(k(327));var c=a.finishedWork,d=a.finishedExpirationTime;if(null===c)return null;a.finishedWork=null;a.finishedExpirationTime=0;if(c===a.current)throw Error(k(177));a.callbackNode=null;a.callbackExpirationTime=
0;a.callbackPriority=90;a.nextKnownPendingLevel=0;var e=Ve(c);a.firstPendingTime=e;d<=a.lastSuspendedTime?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:d<=a.firstSuspendedTime&&(a.firstSuspendedTime=d-1);d<=a.lastPingedTime&&(a.lastPingedTime=0);d<=a.lastExpiredTime&&(a.lastExpiredTime=0);a===U&&(t=U=null,P=0);1<c.effectTag?null!==c.lastEffect?(c.lastEffect.nextEffect=c,e=c.firstEffect):e=c:e=c.firstEffect;if(null!==e){var f=p;p|=ma;Uh.current=null;Ze=tc;var g=kg();if(Xd(g)){if("selectionStart"in
g)var h={start:g.selectionStart,end:g.selectionEnd};else a:{h=(h=g.ownerDocument)&&h.defaultView||window;var m=h.getSelection&&h.getSelection();if(m&&0!==m.rangeCount){h=m.anchorNode;var n=m.anchorOffset,q=m.focusNode;m=m.focusOffset;try{h.nodeType,q.nodeType}catch(sb){h=null;break a}var ba=0,w=-1,y=-1,B=0,D=0,r=g,z=null;b:for(;;){for(var v;;){r!==h||0!==n&&3!==r.nodeType||(w=ba+n);r!==q||0!==m&&3!==r.nodeType||(y=ba+m);3===r.nodeType&&(ba+=r.nodeValue.length);if(null===(v=r.firstChild))break;z=r;
r=v}for(;;){if(r===g)break b;z===h&&++B===n&&(w=ba);z===q&&++D===m&&(y=ba);if(null!==(v=r.nextSibling))break;r=z;z=r.parentNode}r=v}h=-1===w||-1===y?null:{start:w,end:y}}else h=null}h=h||{start:0,end:0}}else h=null;$e={activeElementDetached:null,focusedElem:g,selectionRange:h};tc=!1;l=e;do try{Bj()}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=e;do try{for(g=a,h=b;null!==l;){var x=l.effectTag;x&16&&Wb(l.stateNode,"");if(x&128){var A=l.alternate;if(null!==A){var u=
A.ref;null!==u&&("function"===typeof u?u(null):u.current=null)}}switch(x&1038){case 2:Gh(l);l.effectTag&=-3;break;case 6:Gh(l);l.effectTag&=-3;Qe(l.alternate,l);break;case 1024:l.effectTag&=-1025;break;case 1028:l.effectTag&=-1025;Qe(l.alternate,l);break;case 4:Qe(l.alternate,l);break;case 8:n=l,Dh(g,n,h),Eh(n)}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);u=$e;A=kg();x=u.focusedElem;h=u.selectionRange;if(A!==x&&x&&x.ownerDocument&&jg(x.ownerDocument.documentElement,
x)){null!==h&&Xd(x)&&(A=h.start,u=h.end,void 0===u&&(u=A),"selectionStart"in x?(x.selectionStart=A,x.selectionEnd=Math.min(u,x.value.length)):(u=(A=x.ownerDocument||document)&&A.defaultView||window,u.getSelection&&(u=u.getSelection(),n=x.textContent.length,g=Math.min(h.start,n),h=void 0===h.end?g:Math.min(h.end,n),!u.extend&&g>h&&(n=h,h=g,g=n),n=ig(x,g),q=ig(x,h),n&&q&&(1!==u.rangeCount||u.anchorNode!==n.node||u.anchorOffset!==n.offset||u.focusNode!==q.node||u.focusOffset!==q.offset)&&(A=A.createRange(),
A.setStart(n.node,n.offset),u.removeAllRanges(),g>h?(u.addRange(A),u.extend(q.node,q.offset)):(A.setEnd(q.node,q.offset),u.addRange(A))))));A=[];for(u=x;u=u.parentNode;)1===u.nodeType&&A.push({element:u,left:u.scrollLeft,top:u.scrollTop});"function"===typeof x.focus&&x.focus();for(x=0;x<A.length;x++)u=A[x],u.element.scrollLeft=u.left,u.element.scrollTop=u.top}tc=!!Ze;$e=Ze=null;a.current=c;l=e;do try{for(x=a;null!==l;){var F=l.effectTag;F&36&&oj(x,l.alternate,l);if(F&128){A=void 0;var E=l.ref;if(null!==
E){var G=l.stateNode;switch(l.tag){case 5:A=G;break;default:A=G}"function"===typeof E?E(A):E.current=A}}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=null;Cj();p=f}else a.current=c;if(ld)ld=!1,Zb=a,$b=b;else for(l=e;null!==l;)b=l.nextEffect,l.nextEffect=null,l=b;b=a.firstPendingTime;0===b&&(La=null);1073741823===b?a===af?ac++:(ac=0,af=a):ac=0;"function"===typeof bf&&bf(c.stateNode,d);V(a);if(cd)throw cd=!1,a=Se,Se=null,a;if((p&Ye)!==H)return null;
ha();return null}function Bj(){for(;null!==l;){var a=l.effectTag;0!==(a&256)&&nj(l.alternate,l);0===(a&512)||ld||(ld=!0,Ng(97,function(){xb();return null}));l=l.nextEffect}}function xb(){if(90!==$b){var a=97<$b?97:$b;$b=90;return Da(a,Dj)}}function Dj(){if(null===Zb)return!1;var a=Zb;Zb=null;if((p&(ca|ma))!==H)throw Error(k(331));var b=p;p|=ma;for(a=a.current.firstEffect;null!==a;){try{var c=a;if(0!==(c.effectTag&512))switch(c.tag){case 0:case 11:case 15:case 22:Ah(5,c),Bh(5,c)}}catch(d){if(null===
a)throw Error(k(330));Za(a,d)}c=a.nextEffect;a.nextEffect=null;a=c}p=b;ha();return!0}function Vh(a,b,c){b=Le(c,b);b=Ih(a,b,1073741823);Fa(a,b);a=ed(a,1073741823);null!==a&&V(a)}function Za(a,b){if(3===a.tag)Vh(a,a,b);else for(var c=a.return;null!==c;){if(3===c.tag){Vh(c,a,b);break}else if(1===c.tag){var d=c.stateNode;if("function"===typeof c.type.getDerivedStateFromError||"function"===typeof d.componentDidCatch&&(null===La||!La.has(d))){a=Le(b,a);a=Jh(c,a,1073741823);Fa(c,a);c=ed(c,1073741823);null!==
c&&V(c);break}}c=c.return}}function xj(a,b,c){var d=a.pingCache;null!==d&&d.delete(b);U===a&&P===c?F===bd||F===ad&&1073741823===ta&&Y()-Re<Ph?$a(a,P):jd=!0:Kh(a,c)&&(b=a.lastPingedTime,0!==b&&b<c||(a.lastPingedTime=c,V(a)))}function qj(a,b){var c=a.stateNode;null!==c&&c.delete(b);b=0;0===b&&(b=ka(),b=Va(b,a,null));a=ed(a,b);null!==a&&V(a)}function Ej(a){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)return!0;try{var c=
b.inject(a);bf=function(a,e){try{b.onCommitFiberRoot(c,a,void 0,64===(a.current.effectTag&64))}catch(f){}};Ne=function(a){try{b.onCommitFiberUnmount(c,a)}catch(e){}}}catch(d){}return!0}function Fj(a,b,c,d){this.tag=a;this.key=c;this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null;this.index=0;this.ref=null;this.pendingProps=b;this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null;this.mode=d;this.effectTag=0;this.lastEffect=this.firstEffect=this.nextEffect=
null;this.childExpirationTime=this.expirationTime=0;this.alternate=null}function Ge(a){a=a.prototype;return!(!a||!a.isReactComponent)}function Gj(a){if("function"===typeof a)return Ge(a)?1:0;if(void 0!==a&&null!==a){a=a.$$typeof;if(a===zd)return 11;if(a===Ad)return 14}return 2}function Sa(a,b){var c=a.alternate;null===c?(c=la(a.tag,b,a.key,a.mode),c.elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=b,c.effectTag=0,c.nextEffect=null,c.firstEffect=
null,c.lastEffect=null);c.childExpirationTime=a.childExpirationTime;c.expirationTime=a.expirationTime;c.child=a.child;c.memoizedProps=a.memoizedProps;c.memoizedState=a.memoizedState;c.updateQueue=a.updateQueue;b=a.dependencies;c.dependencies=null===b?null:{expirationTime:b.expirationTime,firstContext:b.firstContext,responders:b.responders};c.sibling=a.sibling;c.index=a.index;c.ref=a.ref;return c}function Oc(a,b,c,d,e,f){var g=2;d=a;if("function"===typeof a)Ge(a)&&(g=1);else if("string"===typeof a)g=
5;else a:switch(a){case Ma:return Ha(c.children,e,f,b);case Hj:g=8;e|=7;break;case Af:g=8;e|=1;break;case kc:return a=la(12,c,b,e|8),a.elementType=kc,a.type=kc,a.expirationTime=f,a;case lc:return a=la(13,c,b,e),a.type=lc,a.elementType=lc,a.expirationTime=f,a;case yd:return a=la(19,c,b,e),a.elementType=yd,a.expirationTime=f,a;default:if("object"===typeof a&&null!==a)switch(a.$$typeof){case Cf:g=10;break a;case Bf:g=9;break a;case zd:g=11;break a;case Ad:g=14;break a;case Ef:g=16;d=null;break a;case Df:g=
22;break a}throw Error(k(130,null==a?a:typeof a,""));}b=la(g,c,b,e);b.elementType=a;b.type=d;b.expirationTime=f;return b}function Ha(a,b,c,d){a=la(7,a,d,b);a.expirationTime=c;return a}function qe(a,b,c){a=la(6,a,null,b);a.expirationTime=c;return a}function re(a,b,c){b=la(4,null!==a.children?a.children:[],a.key,b);b.expirationTime=c;b.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation};return b}function Ij(a,b,c){this.tag=b;this.current=null;this.containerInfo=
a;this.pingCache=this.pendingChildren=null;this.finishedExpirationTime=0;this.finishedWork=null;this.timeoutHandle=-1;this.pendingContext=this.context=null;this.hydrate=c;this.callbackNode=null;this.callbackPriority=90;this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Kh(a,b){var c=a.firstSuspendedTime;a=a.lastSuspendedTime;return 0!==c&&c>=b&&a<=b}function Ya(a,b){var c=a.firstSuspendedTime,d=a.lastSuspendedTime;
c<b&&(a.firstSuspendedTime=b);if(d>b||0===c)a.lastSuspendedTime=b;b<=a.lastPingedTime&&(a.lastPingedTime=0);b<=a.lastExpiredTime&&(a.lastExpiredTime=0)}function yh(a,b){b>a.firstPendingTime&&(a.firstPendingTime=b);var c=a.firstSuspendedTime;0!==c&&(b>=c?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:b>=a.lastSuspendedTime&&(a.lastSuspendedTime=b+1),b>a.nextKnownPendingLevel&&(a.nextKnownPendingLevel=b))}function Ue(a,b){var c=a.lastExpiredTime;if(0===c||c>b)a.lastExpiredTime=b}
function md(a,b,c,d){var e=b.current,f=ka(),g=Vb.suspense;f=Va(f,e,g);a:if(c){c=c._reactInternalFiber;b:{if(Na(c)!==c||1!==c.tag)throw Error(k(170));var h=c;do{switch(h.tag){case 3:h=h.stateNode.context;break b;case 1:if(N(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break b}}h=h.return}while(null!==h);throw Error(k(171));}if(1===c.tag){var m=c.type;if(N(m)){c=Gg(c,m,h);break a}}c=h}else c=Ca;null===b.context?b.context=c:b.pendingContext=c;b=Ea(f,g);b.payload={element:a};d=void 0===
d?null:d;null!==d&&(b.callback=d);Fa(e,b);Ja(e,f);return f}function cf(a){a=a.current;if(!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function Wh(a,b){a=a.memoizedState;null!==a&&null!==a.dehydrated&&a.retryTime<b&&(a.retryTime=b)}function df(a,b){Wh(a,b);(a=a.alternate)&&Wh(a,b)}function ef(a,b,c){c=null!=c&&!0===c.hydrate;var d=new Ij(a,b,c),e=la(3,null,null,2===b?7:1===b?3:0);d.current=e;e.stateNode=d;ne(e);a[Lb]=d.current;c&&0!==b&&
xi(a,9===a.nodeType?a:a.ownerDocument);this._internalRoot=d}function bc(a){return!(!a||1!==a.nodeType&&9!==a.nodeType&&11!==a.nodeType&&(8!==a.nodeType||" react-mount-point-unstable "!==a.nodeValue))}function Jj(a,b){b||(b=a?9===a.nodeType?a.documentElement:a.firstChild:null,b=!(!b||1!==b.nodeType||!b.hasAttribute("data-reactroot")));if(!b)for(var c;c=a.lastChild;)a.removeChild(c);return new ef(a,0,b?{hydrate:!0}:void 0)}function nd(a,b,c,d,e){var f=c._reactRootContainer;if(f){var g=f._internalRoot;
if("function"===typeof e){var h=e;e=function(){var a=cf(g);h.call(a)}}md(b,g,a,e)}else{f=c._reactRootContainer=Jj(c,d);g=f._internalRoot;if("function"===typeof e){var m=e;e=function(){var a=cf(g);m.call(a)}}Rh(function(){md(b,g,a,e)})}return cf(g)}function Kj(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:gb,key:null==d?null:""+d,children:a,containerInfo:b,implementation:c}}function Xh(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;
if(!bc(b))throw Error(k(200));return Kj(a,b,null,c)}if(!ea)throw Error(k(227));var ki=function(a,b,c,d,e,f,g,h,m){var n=Array.prototype.slice.call(arguments,3);try{b.apply(c,n)}catch(C){this.onError(C)}},yb=!1,gc=null,hc=!1,pd=null,li={onError:function(a){yb=!0;gc=a}},td=null,rf=null,mf=null,ic=null,cb={},jc=[],qd={},db={},rd={},wa=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),M=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.assign,
sd=null,eb=null,fb=null,ee=function(a,b){return a(b)},eg=function(a,b,c,d,e){return a(b,c,d,e)},vd=function(){},vf=ee,Oa=!1,wd=!1,Z=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.Scheduler,Lj=Z.unstable_cancelCallback,ff=Z.unstable_now,$f=Z.unstable_scheduleCallback,Mj=Z.unstable_shouldYield,Yh=Z.unstable_requestPaint,Pd=Z.unstable_runWithPriority,Nj=Z.unstable_getCurrentPriorityLevel,Oj=Z.unstable_ImmediatePriority,Zh=Z.unstable_UserBlockingPriority,ag=Z.unstable_NormalPriority,Pj=Z.unstable_LowPriority,
Qj=Z.unstable_IdlePriority,oi=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,wf=Object.prototype.hasOwnProperty,yf={},xf={},E={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){E[a]=
new L(a,0,!1,a,null,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var b=a[0];E[b]=new L(b,1,!1,a[1],null,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(a){E[a]=new L(a,2,!1,a.toLowerCase(),null,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){E[a]=new L(a,2,!1,a,null,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){E[a]=
new L(a,3,!1,a.toLowerCase(),null,!1)});["checked","multiple","muted","selected"].forEach(function(a){E[a]=new L(a,3,!0,a,null,!1)});["capture","download"].forEach(function(a){E[a]=new L(a,4,!1,a,null,!1)});["cols","rows","size","span"].forEach(function(a){E[a]=new L(a,6,!1,a,null,!1)});["rowSpan","start"].forEach(function(a){E[a]=new L(a,5,!1,a.toLowerCase(),null,!1)});var gf=/[\-:]([a-z])/g,hf=function(a){return a[1].toUpperCase()};"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var b=
a.replace(gf,hf);E[b]=new L(b,1,!1,a,null,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/1999/xlink",!1)});["xml:base","xml:lang","xml:space"].forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1)});["tabIndex","crossOrigin"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!1)});E.xlinkHref=new L("xlinkHref",1,
!1,"xlink:href","http://www.w3.org/1999/xlink",!0);["src","href","action","formAction"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!0)});var da=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;da.hasOwnProperty("ReactCurrentDispatcher")||(da.ReactCurrentDispatcher={current:null});da.hasOwnProperty("ReactCurrentBatchConfig")||(da.ReactCurrentBatchConfig={suspense:null});var si=/^(.*)[\\\/]/,Q="function"===typeof Symbol&&Symbol.for,Pc=Q?Symbol.for("react.element"):60103,gb=Q?Symbol.for("react.portal"):
60106,Ma=Q?Symbol.for("react.fragment"):60107,Af=Q?Symbol.for("react.strict_mode"):60108,kc=Q?Symbol.for("react.profiler"):60114,Cf=Q?Symbol.for("react.provider"):60109,Bf=Q?Symbol.for("react.context"):60110,Hj=Q?Symbol.for("react.concurrent_mode"):60111,zd=Q?Symbol.for("react.forward_ref"):60112,lc=Q?Symbol.for("react.suspense"):60113,yd=Q?Symbol.for("react.suspense_list"):60120,Ad=Q?Symbol.for("react.memo"):60115,Ef=Q?Symbol.for("react.lazy"):60116,Df=Q?Symbol.for("react.block"):60121,zf="function"===
typeof Symbol&&Symbol.iterator,od,xh=function(a){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(b,c,d,e){MSApp.execUnsafeLocalFunction(function(){return a(b,c,d,e)})}:a}(function(a,b){if("http://www.w3.org/2000/svg"!==a.namespaceURI||"innerHTML"in a)a.innerHTML=b;else{od=od||document.createElement("div");od.innerHTML="<svg>"+b.valueOf().toString()+"</svg>";for(b=od.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;b.firstChild;)a.appendChild(b.firstChild)}}),Wb=function(a,
b){if(b){var c=a.firstChild;if(c&&c===a.lastChild&&3===c.nodeType){c.nodeValue=b;return}}a.textContent=b},ib={animationend:nc("Animation","AnimationEnd"),animationiteration:nc("Animation","AnimationIteration"),animationstart:nc("Animation","AnimationStart"),transitionend:nc("Transition","TransitionEnd")},Id={},Of={};wa&&(Of=document.createElement("div").style,"AnimationEvent"in window||(delete ib.animationend.animation,delete ib.animationiteration.animation,delete ib.animationstart.animation),"TransitionEvent"in
window||delete ib.transitionend.transition);var $h=oc("animationend"),ai=oc("animationiteration"),bi=oc("animationstart"),ci=oc("transitionend"),Db="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pf=new ("function"===typeof WeakMap?WeakMap:Map),Ab=null,wi=function(a){if(a){var b=a._dispatchListeners,c=a._dispatchInstances;
if(Array.isArray(b))for(var d=0;d<b.length&&!a.isPropagationStopped();d++)lf(a,b[d],c[d]);else b&&lf(a,b,c);a._dispatchListeners=null;a._dispatchInstances=null;a.isPersistent()||a.constructor.release(a)}},qc=[],Rd=!1,fa=[],xa=null,ya=null,za=null,Eb=new Map,Fb=new Map,Jb=[],Nd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),
yi="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" "),dg={},cg=new Map,Td=new Map,Rj=["abort","abort",$h,"animationEnd",ai,"animationIteration",bi,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata",
"loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",ci,"transitionEnd","waiting","waiting"];Sd("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),
0);Sd("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);Sd(Rj,2);(function(a,b){for(var c=0;c<a.length;c++)Td.set(a[c],b)})("change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),0);var Hi=Zh,Gi=Pd,tc=!0,Kb={animationIterationCount:!0,
borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,
strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Sj=["Webkit","ms","Moz","O"];Object.keys(Kb).forEach(function(a){Sj.forEach(function(b){b=b+a.charAt(0).toUpperCase()+a.substring(1);Kb[b]=Kb[a]})});var Ii=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),ng="$",og="/$",$d="$?",Zd="$!",Ze=null,$e=null,We="function"===typeof setTimeout?setTimeout:void 0,vj="function"===
typeof clearTimeout?clearTimeout:void 0,jf=Math.random().toString(36).slice(2),Aa="__reactInternalInstance$"+jf,vc="__reactEventHandlers$"+jf,Lb="__reactContainere$"+jf,Ba=null,ce=null,wc=null;M(R.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():"unknown"!==typeof a.returnValue&&(a.returnValue=!1),this.isDefaultPrevented=xc)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():"unknown"!==
typeof a.cancelBubble&&(a.cancelBubble=!0),this.isPropagationStopped=xc)},persist:function(){this.isPersistent=xc},isPersistent:yc,destructor:function(){var a=this.constructor.Interface,b;for(b in a)this[b]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null;this.isPropagationStopped=this.isDefaultPrevented=yc;this._dispatchInstances=this._dispatchListeners=null}});R.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(a){return a.timeStamp||
Date.now()},defaultPrevented:null,isTrusted:null};R.extend=function(a){function b(){return c.apply(this,arguments)}var c=this,d=function(){};d.prototype=c.prototype;d=new d;M(d,b.prototype);b.prototype=d;b.prototype.constructor=b;b.Interface=M({},c.Interface,a);b.extend=c.extend;sg(b);return b};sg(R);var Tj=R.extend({data:null}),Uj=R.extend({data:null}),Ni=[9,13,27,32],de=wa&&"CompositionEvent"in window,cc=null;wa&&"documentMode"in document&&(cc=document.documentMode);var Vj=wa&&"TextEvent"in window&&
!cc,xg=wa&&(!de||cc&&8<cc&&11>=cc),wg=String.fromCharCode(32),ua={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},
dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},vg=!1,mb=!1,Wj={eventTypes:ua,extractEvents:function(a,b,c,d,e){var f;if(de)b:{switch(a){case "compositionstart":var g=ua.compositionStart;break b;case "compositionend":g=ua.compositionEnd;break b;case "compositionupdate":g=
ua.compositionUpdate;break b}g=void 0}else mb?tg(a,c)&&(g=ua.compositionEnd):"keydown"===a&&229===c.keyCode&&(g=ua.compositionStart);g?(xg&&"ko"!==c.locale&&(mb||g!==ua.compositionStart?g===ua.compositionEnd&&mb&&(f=rg()):(Ba=d,ce="value"in Ba?Ba.value:Ba.textContent,mb=!0)),e=Tj.getPooled(g,b,c,d),f?e.data=f:(f=ug(c),null!==f&&(e.data=f)),lb(e),f=e):f=null;(a=Vj?Oi(a,c):Pi(a,c))?(b=Uj.getPooled(ua.beforeInput,b,c,d),b.data=a,lb(b)):b=null;return null===f?b:null===b?f:[f,b]}},Qi={color:!0,date:!0,
datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0},Ag={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}},Mb=null,Nb=null,kf=!1;wa&&(kf=Tf("input")&&(!document.documentMode||9<document.documentMode));var Xj={eventTypes:Ag,_isInputEventSupported:kf,extractEvents:function(a,b,c,d,e){e=b?Pa(b):window;var f=
e.nodeName&&e.nodeName.toLowerCase();if("select"===f||"input"===f&&"file"===e.type)var g=Si;else if(yg(e))if(kf)g=Wi;else{g=Ui;var h=Ti}else(f=e.nodeName)&&"input"===f.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)&&(g=Vi);if(g&&(g=g(a,b)))return zg(g,c,d);h&&h(a,e,b);"blur"===a&&(a=e._wrapperState)&&a.controlled&&"number"===e.type&&Ed(e,"number",e.value)}},dc=R.extend({view:null,detail:null}),Yi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"},di=0,ei=0,fi=!1,gi=!1,ec=dc.extend({screenX:null,
screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:fe,button:null,buttons:null,relatedTarget:function(a){return a.relatedTarget||(a.fromElement===a.srcElement?a.toElement:a.fromElement)},movementX:function(a){if("movementX"in a)return a.movementX;var b=di;di=a.screenX;return fi?"mousemove"===a.type?a.screenX-b:0:(fi=!0,0)},movementY:function(a){if("movementY"in a)return a.movementY;var b=ei;ei=a.screenY;return gi?"mousemove"===
a.type?a.screenY-b:0:(gi=!0,0)}}),hi=ec.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),fc={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout",
"pointerover"]}},Yj={eventTypes:fc,extractEvents:function(a,b,c,d,e){var f="mouseover"===a||"pointerover"===a,g="mouseout"===a||"pointerout"===a;if(f&&0===(e&32)&&(c.relatedTarget||c.fromElement)||!g&&!f)return null;f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window;if(g){if(g=b,b=(b=c.relatedTarget||c.toElement)?Bb(b):null,null!==b){var h=Na(b);if(b!==h||5!==b.tag&&6!==b.tag)b=null}}else g=null;if(g===b)return null;if("mouseout"===a||"mouseover"===a){var m=ec;var n=fc.mouseLeave;
var l=fc.mouseEnter;var k="mouse"}else if("pointerout"===a||"pointerover"===a)m=hi,n=fc.pointerLeave,l=fc.pointerEnter,k="pointer";a=null==g?f:Pa(g);f=null==b?f:Pa(b);n=m.getPooled(n,g,c,d);n.type=k+"leave";n.target=a;n.relatedTarget=f;c=m.getPooled(l,b,c,d);c.type=k+"enter";c.target=f;c.relatedTarget=a;d=g;k=b;if(d&&k)a:{m=d;l=k;g=0;for(a=m;a;a=pa(a))g++;a=0;for(b=l;b;b=pa(b))a++;for(;0<g-a;)m=pa(m),g--;for(;0<a-g;)l=pa(l),a--;for(;g--;){if(m===l||m===l.alternate)break a;m=pa(m);l=pa(l)}m=null}else m=
null;l=m;for(m=[];d&&d!==l;){g=d.alternate;if(null!==g&&g===l)break;m.push(d);d=pa(d)}for(d=[];k&&k!==l;){g=k.alternate;if(null!==g&&g===l)break;d.push(k);k=pa(k)}for(k=0;k<m.length;k++)be(m[k],"bubbled",n);for(k=d.length;0<k--;)be(d[k],"captured",c);return 0===(e&64)?[n]:[n,c]}},Qa="function"===typeof Object.is?Object.is:Zi,$i=Object.prototype.hasOwnProperty,Zj=wa&&"documentMode"in document&&11>=document.documentMode,Eg={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},
dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},nb=null,he=null,Pb=null,ge=!1,ak={eventTypes:Eg,extractEvents:function(a,b,c,d,e,f){e=f||(d.window===d?d.document:9===d.nodeType?d:d.ownerDocument);if(!(f=!e)){a:{e=Jd(e);f=rd.onSelect;for(var g=0;g<f.length;g++)if(!e.has(f[g])){e=!1;break a}e=!0}f=!e}if(f)return null;e=b?Pa(b):window;switch(a){case "focus":if(yg(e)||"true"===e.contentEditable)nb=e,he=b,Pb=null;break;case "blur":Pb=he=nb=null;
break;case "mousedown":ge=!0;break;case "contextmenu":case "mouseup":case "dragend":return ge=!1,Dg(c,d);case "selectionchange":if(Zj)break;case "keydown":case "keyup":return Dg(c,d)}return null}},bk=R.extend({animationName:null,elapsedTime:null,pseudoElement:null}),ck=R.extend({clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),dk=dc.extend({relatedTarget:null}),ek={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",
Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fk={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",
224:"Meta"},gk=dc.extend({key:function(a){if(a.key){var b=ek[a.key]||a.key;if("Unidentified"!==b)return b}return"keypress"===a.type?(a=Ac(a),13===a?"Enter":String.fromCharCode(a)):"keydown"===a.type||"keyup"===a.type?fk[a.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:fe,charCode:function(a){return"keypress"===a.type?Ac(a):0},keyCode:function(a){return"keydown"===a.type||"keyup"===a.type?a.keyCode:0},which:function(a){return"keypress"===
a.type?Ac(a):"keydown"===a.type||"keyup"===a.type?a.keyCode:0}}),hk=ec.extend({dataTransfer:null}),ik=dc.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:fe}),jk=R.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),kk=ec.extend({deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?
-a.wheelDelta:0},deltaZ:null,deltaMode:null}),lk={eventTypes:dg,extractEvents:function(a,b,c,d,e){e=cg.get(a);if(!e)return null;switch(a){case "keypress":if(0===Ac(c))return null;case "keydown":case "keyup":a=gk;break;case "blur":case "focus":a=dk;break;case "click":if(2===c.button)return null;case "auxclick":case "dblclick":case "mousedown":case "mousemove":case "mouseup":case "mouseout":case "mouseover":case "contextmenu":a=ec;break;case "drag":case "dragend":case "dragenter":case "dragexit":case "dragleave":case "dragover":case "dragstart":case "drop":a=
hk;break;case "touchcancel":case "touchend":case "touchmove":case "touchstart":a=ik;break;case $h:case ai:case bi:a=bk;break;case ci:a=jk;break;case "scroll":a=dc;break;case "wheel":a=kk;break;case "copy":case "cut":case "paste":a=ck;break;case "gotpointercapture":case "lostpointercapture":case "pointercancel":case "pointerdown":case "pointermove":case "pointerout":case "pointerover":case "pointerup":a=hi;break;default:a=R}b=a.getPooled(e,b,c,d);lb(b);return b}};(function(a){if(ic)throw Error(k(101));
ic=Array.prototype.slice.call(a);nf()})("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" "));(function(a,b,c){td=a;rf=b;mf=c})(ae,Hb,Pa);pf({SimpleEventPlugin:lk,EnterLeaveEventPlugin:Yj,ChangeEventPlugin:Xj,SelectEventPlugin:ak,BeforeInputEventPlugin:Wj});var ie=[],ob=-1,Ca={},B={current:Ca},G={current:!1},Ra=Ca,bj=Pd,je=$f,Rg=Lj,aj=Nj,Dc=Oj,Ig=Zh,Jg=ag,Kg=Pj,Lg=Qj,Qg={},yj=Mj,Cj=void 0!==Yh?Yh:function(){},qa=null,
Ec=null,ke=!1,ii=ff(),Y=1E4>ii?ff:function(){return ff()-ii},Ic={current:null},Hc=null,qb=null,Gc=null,Tg=0,Jc=2,Ga=!1,Vb=da.ReactCurrentBatchConfig,$g=(new ea.Component).refs,Mc={isMounted:function(a){return(a=a._reactInternalFiber)?Na(a)===a:!1},enqueueSetState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;d=Va(d,a,e);e=Ea(d,e);e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueReplaceState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;
d=Va(d,a,e);e=Ea(d,e);e.tag=1;e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueForceUpdate:function(a,b){a=a._reactInternalFiber;var c=ka(),d=Vb.suspense;c=Va(c,a,d);d=Ea(c,d);d.tag=Jc;void 0!==b&&null!==b&&(d.callback=b);Fa(a,d);Ja(a,c)}},Qc=Array.isArray,wb=ah(!0),Fe=ah(!1),Sb={},ja={current:Sb},Ub={current:Sb},Tb={current:Sb},D={current:0},Sc=da.ReactCurrentDispatcher,X=da.ReactCurrentBatchConfig,Ia=0,z=null,K=null,J=null,Uc=!1,Tc={readContext:W,useCallback:S,useContext:S,
useEffect:S,useImperativeHandle:S,useLayoutEffect:S,useMemo:S,useReducer:S,useRef:S,useState:S,useDebugValue:S,useResponder:S,useDeferredValue:S,useTransition:S},dj={readContext:W,useCallback:ih,useContext:W,useEffect:eh,useImperativeHandle:function(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;return ze(4,2,gh.bind(null,b,a),c)},useLayoutEffect:function(a,b){return ze(4,2,a,b)},useMemo:function(a,b){var c=ub();b=void 0===b?null:b;a=a();c.memoizedState=[a,b];return a},useReducer:function(a,b,c){var d=
ub();b=void 0!==c?c(b):b;d.memoizedState=d.baseState=b;a=d.queue={pending:null,dispatch:null,lastRenderedReducer:a,lastRenderedState:b};a=a.dispatch=ch.bind(null,z,a);return[d.memoizedState,a]},useRef:function(a){var b=ub();a={current:a};return b.memoizedState=a},useState:xe,useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=xe(a),d=c[0],e=c[1];eh(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=
xe(!1),c=b[0];b=b[1];return[ih(Ce.bind(null,b,a),[b,a]),c]}},ej={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Vc,useRef:dh,useState:function(a){return Vc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Vc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Vc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,
b,a),[b,a]),c]}},fj={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Wc,useRef:dh,useState:function(a){return Wc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Wc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Wc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,b,a),[b,a]),c]}},ra=null,Ka=null,Wa=
!1,gj=da.ReactCurrentOwner,ia=!1,Je={dehydrated:null,retryTime:0};var jj=function(a,b,c,d){for(c=b.child;null!==c;){if(5===c.tag||6===c.tag)a.appendChild(c.stateNode);else if(4!==c.tag&&null!==c.child){c.child.return=c;c=c.child;continue}if(c===b)break;for(;null===c.sibling;){if(null===c.return||c.return===b)return;c=c.return}c.sibling.return=c.return;c=c.sibling}};var wh=function(a){};var ij=function(a,b,c,d,e){var f=a.memoizedProps;if(f!==d){var g=b.stateNode;Ta(ja.current);a=null;switch(c){case "input":f=
Cd(g,f);d=Cd(g,d);a=[];break;case "option":f=Fd(g,f);d=Fd(g,d);a=[];break;case "select":f=M({},f,{value:void 0});d=M({},d,{value:void 0});a=[];break;case "textarea":f=Gd(g,f);d=Gd(g,d);a=[];break;default:"function"!==typeof f.onClick&&"function"===typeof d.onClick&&(g.onclick=uc)}Ud(c,d);var h,m;c=null;for(h in f)if(!d.hasOwnProperty(h)&&f.hasOwnProperty(h)&&null!=f[h])if("style"===h)for(m in g=f[h],g)g.hasOwnProperty(m)&&(c||(c={}),c[m]="");else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==
h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(db.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in d){var k=d[h];g=null!=f?f[h]:void 0;if(d.hasOwnProperty(h)&&k!==g&&(null!=k||null!=g))if("style"===h)if(g){for(m in g)!g.hasOwnProperty(m)||k&&k.hasOwnProperty(m)||(c||(c={}),c[m]="");for(m in k)k.hasOwnProperty(m)&&g[m]!==k[m]&&(c||(c={}),c[m]=k[m])}else c||(a||(a=[]),a.push(h,c)),c=k;else"dangerouslySetInnerHTML"===h?(k=k?k.__html:void 0,g=g?g.__html:void 0,null!=k&&g!==k&&(a=a||
[]).push(h,k)):"children"===h?g===k||"string"!==typeof k&&"number"!==typeof k||(a=a||[]).push(h,""+k):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(db.hasOwnProperty(h)?(null!=k&&oa(e,h),a||g===k||(a=[])):(a=a||[]).push(h,k))}c&&(a=a||[]).push("style",c);e=a;if(b.updateQueue=e)b.effectTag|=4}};var kj=function(a,b,c,d){c!==d&&(b.effectTag|=4)};var pj="function"===typeof WeakSet?WeakSet:Set,wj="function"===typeof WeakMap?WeakMap:Map,sj=Math.ceil,gd=da.ReactCurrentDispatcher,
Uh=da.ReactCurrentOwner,H=0,Ye=8,ca=16,ma=32,Xa=0,hd=1,Oh=2,ad=3,bd=4,Xe=5,p=H,U=null,t=null,P=0,F=Xa,id=null,ta=1073741823,Yb=1073741823,kd=null,Xb=0,jd=!1,Re=0,Ph=500,l=null,cd=!1,Se=null,La=null,ld=!1,Zb=null,$b=90,bb=null,ac=0,af=null,dd=0,Ja=function(a,b){if(50<ac)throw ac=0,af=null,Error(k(185));a=ed(a,b);if(null!==a){var c=Cc();1073741823===b?(p&Ye)!==H&&(p&(ca|ma))===H?Te(a):(V(a),p===H&&ha()):V(a);(p&4)===H||98!==c&&99!==c||(null===bb?bb=new Map([[a,b]]):(c=bb.get(a),(void 0===c||c>b)&&bb.set(a,
b)))}};var zj=function(a,b,c){var d=b.expirationTime;if(null!==a){var e=b.pendingProps;if(a.memoizedProps!==e||G.current)ia=!0;else{if(d<c){ia=!1;switch(b.tag){case 3:sh(b);Ee();break;case 5:bh(b);if(b.mode&4&&1!==c&&e.hidden)return b.expirationTime=b.childExpirationTime=1,null;break;case 1:N(b.type)&&Bc(b);break;case 4:se(b,b.stateNode.containerInfo);break;case 10:d=b.memoizedProps.value;e=b.type._context;y(Ic,e._currentValue);e._currentValue=d;break;case 13:if(null!==b.memoizedState){d=b.child.childExpirationTime;
if(0!==d&&d>=c)return th(a,b,c);y(D,D.current&1);b=sa(a,b,c);return null!==b?b.sibling:null}y(D,D.current&1);break;case 19:d=b.childExpirationTime>=c;if(0!==(a.effectTag&64)){if(d)return vh(a,b,c);b.effectTag|=64}e=b.memoizedState;null!==e&&(e.rendering=null,e.tail=null);y(D,D.current);if(!d)return null}return sa(a,b,c)}ia=!1}}else ia=!1;b.expirationTime=0;switch(b.tag){case 2:d=b.type;null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;e=pb(b,B.current);rb(b,c);e=we(null,
b,d,a,e,c);b.effectTag|=1;if("object"===typeof e&&null!==e&&"function"===typeof e.render&&void 0===e.$$typeof){b.tag=1;b.memoizedState=null;b.updateQueue=null;if(N(d)){var f=!0;Bc(b)}else f=!1;b.memoizedState=null!==e.state&&void 0!==e.state?e.state:null;ne(b);var g=d.getDerivedStateFromProps;"function"===typeof g&&Lc(b,d,g,a);e.updater=Mc;b.stateNode=e;e._reactInternalFiber=b;pe(b,d,a,c);b=Ie(null,b,d,!0,f,c)}else b.tag=0,T(null,b,e,c),b=b.child;return b;case 16:a:{e=b.elementType;null!==a&&(a.alternate=
null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;ri(e);if(1!==e._status)throw e._result;e=e._result;b.type=e;f=b.tag=Gj(e);a=aa(e,a);switch(f){case 0:b=He(null,b,e,a,c);break a;case 1:b=rh(null,b,e,a,c);break a;case 11:b=nh(null,b,e,a,c);break a;case 14:b=oh(null,b,e,aa(e.type,a),d,c);break a}throw Error(k(306,e,""));}return b;case 0:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),He(a,b,d,e,c);case 1:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),rh(a,b,d,e,c);
case 3:sh(b);d=b.updateQueue;if(null===a||null===d)throw Error(k(282));d=b.pendingProps;e=b.memoizedState;e=null!==e?e.element:null;oe(a,b);Qb(b,d,null,c);d=b.memoizedState.element;if(d===e)Ee(),b=sa(a,b,c);else{if(e=b.stateNode.hydrate)Ka=kb(b.stateNode.containerInfo.firstChild),ra=b,e=Wa=!0;if(e)for(c=Fe(b,null,d,c),b.child=c;c;)c.effectTag=c.effectTag&-3|1024,c=c.sibling;else T(a,b,d,c),Ee();b=b.child}return b;case 5:return bh(b),null===a&&De(b),d=b.type,e=b.pendingProps,f=null!==a?a.memoizedProps:
null,g=e.children,Yd(d,e)?g=null:null!==f&&Yd(d,f)&&(b.effectTag|=16),qh(a,b),b.mode&4&&1!==c&&e.hidden?(b.expirationTime=b.childExpirationTime=1,b=null):(T(a,b,g,c),b=b.child),b;case 6:return null===a&&De(b),null;case 13:return th(a,b,c);case 4:return se(b,b.stateNode.containerInfo),d=b.pendingProps,null===a?b.child=wb(b,null,d,c):T(a,b,d,c),b.child;case 11:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),nh(a,b,d,e,c);case 7:return T(a,b,b.pendingProps,c),b.child;case 8:return T(a,
b,b.pendingProps.children,c),b.child;case 12:return T(a,b,b.pendingProps.children,c),b.child;case 10:a:{d=b.type._context;e=b.pendingProps;g=b.memoizedProps;f=e.value;var h=b.type._context;y(Ic,h._currentValue);h._currentValue=f;if(null!==g)if(h=g.value,f=Qa(h,f)?0:("function"===typeof d._calculateChangedBits?d._calculateChangedBits(h,f):1073741823)|0,0===f){if(g.children===e.children&&!G.current){b=sa(a,b,c);break a}}else for(h=b.child,null!==h&&(h.return=b);null!==h;){var m=h.dependencies;if(null!==
m){g=h.child;for(var l=m.firstContext;null!==l;){if(l.context===d&&0!==(l.observedBits&f)){1===h.tag&&(l=Ea(c,null),l.tag=Jc,Fa(h,l));h.expirationTime<c&&(h.expirationTime=c);l=h.alternate;null!==l&&l.expirationTime<c&&(l.expirationTime=c);Sg(h.return,c);m.expirationTime<c&&(m.expirationTime=c);break}l=l.next}}else g=10===h.tag?h.type===b.type?null:h.child:h.child;if(null!==g)g.return=h;else for(g=h;null!==g;){if(g===b){g=null;break}h=g.sibling;if(null!==h){h.return=g.return;g=h;break}g=g.return}h=
g}T(a,b,e.children,c);b=b.child}return b;case 9:return e=b.type,f=b.pendingProps,d=f.children,rb(b,c),e=W(e,f.unstable_observedBits),d=d(e),b.effectTag|=1,T(a,b,d,c),b.child;case 14:return e=b.type,f=aa(e,b.pendingProps),f=aa(e.type,f),oh(a,b,e,f,d,c);case 15:return ph(a,b,b.type,b.pendingProps,d,c);case 17:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),b.tag=1,N(d)?(a=!0,Bc(b)):a=!1,rb(b,c),Yg(b,d,e),pe(b,d,e,c),Ie(null,
b,d,!0,a,c);case 19:return vh(a,b,c)}throw Error(k(156,b.tag));};var bf=null,Ne=null,la=function(a,b,c,d){return new Fj(a,b,c,d)};ef.prototype.render=function(a){md(a,this._internalRoot,null,null)};ef.prototype.unmount=function(){var a=this._internalRoot,b=a.containerInfo;md(null,a,null,function(){b[Lb]=null})};var Di=function(a){if(13===a.tag){var b=Fc(ka(),150,100);Ja(a,b);df(a,b)}};var Yf=function(a){13===a.tag&&(Ja(a,3),df(a,3))};var Bi=function(a){if(13===a.tag){var b=ka();b=Va(b,a,null);Ja(a,
b);df(a,b)}};sd=function(a,b,c){switch(b){case "input":Dd(a,c);b=c.name;if("radio"===c.type&&null!=b){for(c=a;c.parentNode;)c=c.parentNode;c=c.querySelectorAll("input[name="+JSON.stringify(""+b)+'][type="radio"]');for(b=0;b<c.length;b++){var d=c[b];if(d!==a&&d.form===a.form){var e=ae(d);if(!e)throw Error(k(90));Gf(d);Dd(d,e)}}}break;case "textarea":Lf(a,c);break;case "select":b=c.value,null!=b&&hb(a,!!c.multiple,b,!1)}};(function(a,b,c,d){ee=a;eg=b;vd=c;vf=d})(Qh,function(a,b,c,d,e){var f=p;p|=4;
try{return Da(98,a.bind(null,b,c,d,e))}finally{p=f,p===H&&ha()}},function(){(p&(1|ca|ma))===H&&(uj(),xb())},function(a,b){var c=p;p|=2;try{return a(b)}finally{p=c,p===H&&ha()}});var mk={Events:[Hb,Pa,ae,pf,qd,lb,function(a){Kd(a,Ki)},sf,tf,sc,pc,xb,{current:!1}]};(function(a){var b=a.findFiberByHostInstance;return Ej(M({},a,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:da.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){a=Sf(a);
return null===a?null:a.stateNode},findFiberByHostInstance:function(a){return b?b(a):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))})({findFiberByHostInstance:Bb,bundleType:0,version:"16.13.1",rendererPackageName:"react-dom"});I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mk;I.createPortal=Xh;I.findDOMNode=function(a){if(null==a)return null;if(1===a.nodeType)return a;var b=a._reactInternalFiber;if(void 0===
b){if("function"===typeof a.render)throw Error(k(188));throw Error(k(268,Object.keys(a)));}a=Sf(b);a=null===a?null:a.stateNode;return a};I.flushSync=function(a,b){if((p&(ca|ma))!==H)throw Error(k(187));var c=p;p|=1;try{return Da(99,a.bind(null,b))}finally{p=c,ha()}};I.hydrate=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!0,c)};I.render=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!1,c)};I.unmountComponentAtNode=function(a){if(!bc(a))throw Error(k(40));return a._reactRootContainer?
(Rh(function(){nd(null,null,a,!1,function(){a._reactRootContainer=null;a[Lb]=null})}),!0):!1};I.unstable_batchedUpdates=Qh;I.unstable_createPortal=function(a,b){return Xh(a,b,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)};I.unstable_renderSubtreeIntoContainer=function(a,b,c,d){if(!bc(c))throw Error(k(200));if(null==a||void 0===a._reactInternalFiber)throw Error(k(38));return nd(a,b,c,!1,d)};I.version="16.13.1"});
</script>
    <script>const e = React.createElement;

function pathToString(path) {
  if (path[0] === '/') {
    return '/' + path.slice(1).join('/');
  } else {
    return path.join('/');
  }
}

function findCommonPath(files) {
  if (!files || !files.length) {
    return [];
  }

  function isPrefix(arr, prefix) {
    if (arr.length < prefix.length) {
      return false;
    }
    for (let i = prefix.length - 1; i >= 0; --i) {
      if (arr[i] !== prefix[i]) {
        return false;
      }
    }
    return true;
  }

  let commonPath = files[0].path.slice(0, -1);
  while (commonPath.length) {
    if (files.every(file => isPrefix(file.path, commonPath))) {
      break;
    }
    commonPath.pop();
  }
  return commonPath;
}

function findFolders(files) {
  if (!files || !files.length) {
    return [];
  }

  let folders = files.filter(file => file.path.length > 1).map(file => file.path[0]);
  folders = [...new Set(folders)]; // unique
  folders.sort();

  folders = folders.map(folder => {
    let filesInFolder = files
      .filter(file => file.path[0] === folder)
      .map(file => ({
        ...file,
        path: file.path.slice(1),
        parent: [...file.parent, file.path[0]],
      }));

    const children = findFolders(filesInFolder); // recursion

    return {
      is_folder: true,
      path: [folder],
      parent: files[0].parent,
      children,
      covered: children.reduce((sum, file) => sum + file.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.coverable, 0),
      prevRun: {
        covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
        coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
      }
    };
  });

  return [
    ...folders,
    ...files.filter(file => file.path.length === 1),
  ];
}

class App extends React.Component {
  constructor(...args) {
    super(...args);

    this.state = {
      current: [],
    };
  }

  componentDidMount() {
    this.updateStateFromLocation();
    window.addEventListener("hashchange", () => this.updateStateFromLocation(), false);
  }

  updateStateFromLocation() {
    if (window.location.hash.length > 1) {
      const current = window.location.hash.substr(1).split('/');
      this.setState({current});
    } else {
      this.setState({current: []});
    }
  }

  getCurrentPath() {
    let file = this.props.root;
    let path = [file];
    for (let p of this.state.current) {
      file = file.children.find(file => file.path[0] === p);
      if (!file) {
        return path;
      }
      path.push(file);
    }
    return path;
  }

  render() {
    const path = this.getCurrentPath();
    const file = path[path.length - 1];

    let w = null;
    if (file.is_folder) {
      w = e(FilesList, {
        folder: file,
        onSelectFile: this.selectFile.bind(this),
        onBack: path.length > 1 ? this.back.bind(this) : null,
      });
    } else {
      w = e(DisplayFile, {
        file,
        onBack: this.back.bind(this),
      });
    }

    return e('div', {className: 'app'}, w);
  }

  selectFile(file) {
    this.setState(({current}) => {
      return {current: [...current, file.path[0]]};
    }, () => this.updateHash());
  }

  back(file) {
    this.setState(({current}) => {
      return {current: current.slice(0, current.length - 1)};
    }, () => this.updateHash());
  }

  updateHash() {
    if (!this.state.current || !this.state.current.length) {
      window.location = '#';
    } else {
      window.location = '#' + this.state.current.join('/');
    }
  }
}

function FilesList({folder, onSelectFile, onBack}) {
  let files = folder.children;
  return e('div', {className: 'display-folder'},
    e(FileHeader, {file: folder, onBack}),
    e('table', {className: 'files-list'},
      e('thead', {className: 'files-list__head'},
        e('tr', null,
          e('th', null, "Path"),
          e('th', null, "Coverage")
        )
      ),
      e('tbody', {className: 'files-list__body'},
        files.map(file => e(File, {file, onClick: onSelectFile}))
      )
    )
  );
}

function File({file, onClick}) {
  const coverage = file.coverable ? file.covered / file.coverable * 100 : -1;
  const coverageDelta = file.prevRun &&
    (file.covered / file.coverable * 100 - file.prevRun.covered / file.prevRun.coverable * 100);

  return e('tr', {
      className: 'files-list__file'
        + (coverage >= 0 && coverage < 50 ? ' files-list__file_low': '')
        + (coverage >= 50 && coverage < 80 ? ' files-list__file_medium': '')
        + (coverage >= 80 ? ' files-list__file_high': '')
        + (file.is_folder ? ' files-list__file_folder': ''),
      onClick: () => onClick(file),
    },
    e('td', null, pathToString(file.path)),
    e('td', null,
      file.covered + ' / ' + file.coverable +
      (coverage >= 0 ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e('span', {title: 'Change from the previous run'},
        (coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : ''))
    )
  );
}

function DisplayFile({file, onBack}) {
  return e('div', {className: 'display-file'},
    e(FileHeader, {file, onBack}),
    e(FileContent, {file})
  );
}

function FileHeader({file, onBack}) {
  const coverage = file.covered / file.coverable * 100;
  const coverageDelta = file.prevRun && (coverage - file.prevRun.covered / file.prevRun.coverable * 100);

  return e('div', {className: 'file-header'},
    onBack ? e('a', {className: 'file-header__back', onClick: onBack}, 'Back') : null,
    e('div', {className: 'file-header__name'}, pathToString([...file.parent, ...file.path])),
    e('div', {className: 'file-header__stat'},
      'Covered: ' + file.covered + ' of ' + file.coverable +
      (file.coverable ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e('span', {title: 'Change from the previous run'},
        (coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : ''))
    )
  );
}

function FileContent({file}) {
  return e('div', {className: 'file-content'},
    file.content.split(/\r?\n/).map((line, index) => {
      const trace = file.traces.find(trace => trace.line === index + 1);
      const covered = trace && trace.stats.Line;
      const uncovered = trace && !trace.stats.Line;
      return e('pre', {
          className: 'code-line'
            + (covered ? ' code-line_covered' : '')
            + (uncovered ? ' code-line_uncovered' : ''),
          title: trace ? JSON.stringify(trace.stats, null, 2) : null,
        }, line);
    })
  );
}

(function(){
  const commonPath = findCommonPath(data.files);
  const prevFilesMap = new Map();

  previousData && previousData.files.forEach((file) => {
    const path = file.path.slice(commonPath.length).join('/');
    prevFilesMap.set(path, file);
  });

  const files = data.files.map((file) => {
    const path = file.path.slice(commonPath.length);
    const { covered = 0, coverable = 0 } = prevFilesMap.get(path.join('/')) || {};
    return {
      ...file,
      path,
      parent: commonPath,
      prevRun: { covered, coverable },
    };
  });

  const children = findFolders(files);

  const root = {
    is_folder: true,
    children,
    path: commonPath,
    parent: [],
    covered: children.reduce((sum, file) => sum + file.covered, 0),
    coverable: children.reduce((sum, file) => sum + file.coverable, 0),
    prevRun: {
      covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
    }
  };

  ReactDOM.render(e(App, {root, prevFilesMap}), document.getElementById('root'));
}());
</script>
</body>
</html>