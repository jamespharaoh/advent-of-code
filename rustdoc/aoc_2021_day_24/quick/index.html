<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Quick algorithm found by reverse engineering the input programme."><title>aoc_2021_day_24::quick - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-f3501f0f5ae15dfb.css" id="mainThemeStyle"><div id="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="aoc_2021_day_24" data-themes="" data-resource-suffix="" data-rustdoc-version="1.72.0-nightly (498553fc0 2023-05-29)" data-search-js="search-4926e5fc22a5646a.js" data-settings-js="settings-de11bff964e9d4e5.js" data-settings-css="settings-8c76f75bfb6bd192.css" data-theme-light-css="light-0f8c037637f9eb3e.css" data-theme-dark-css="dark-1097f8e92a01e3cf.css" data-theme-ayu-css="ayu-614652228113ac93.css" ></div><script src="../../static.files/storage-62ce34ea385b278a.js"></script><script defer src="../../static.files/main-f0540c1d82cde29b.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../static.files/light-0f8c037637f9eb3e.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../static.files/dark-1097f8e92a01e3cf.css"><link rel="stylesheet" href="../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../aoc_2021_day_24/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../aoc_2021_day_24/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Module quick</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#functions">Functions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">aoc_2021_day_24</a>::<wbr><a class="mod" href="#">quick</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../src/aoc_2021_day_24/quick.rs.html#1-287">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Quick algorithm found by reverse engineering the input programme.</p>
<h2 id="quick-start"><a href="#quick-start">Quick start</a></h2>
<p>Call <a href="fn.iterator.html" title="fn aoc_2021_day_24::quick::iterator"><code>iterator</code></a> to create an iterator over the valid solutions:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">for </span>solution <span class="kw">in </span>quick::iterator (&amp; steps, <span class="bool-val">true</span>) {
  <span class="macro">println! </span>(<span class="string">&quot;{:?}&quot;</span>, solution);
}</code></pre></div>
<h2 id="description"><a href="#description">Description</a></h2>
<p>Looking carefully at the provided programme, it seems to be the same 18 instructions repeated,
once for every input character. There are only three that vary. Here’s the template:</p>
<div class="example-wrap"><pre class="language-text"><code> 1  inp w
 2  mul x 0
 3  add x z
 4  mod x 26
 5  div z (1 or 26)
 6  add x (-16 to 13)
 7  eql x w
 8  eql x 0
 9  mul y 0
10  add y 25
11  mul y x
12  add y 1
13  mul z y
14  mul y 0
15  mul y w
16  add y (3 to 15)
17  mul y x
18  add z y
</code></pre></div>
<p>So, the registers seem to be used as follows:</p>
<ul>
<li><code>w</code> — The current input value. This is loaded in the first instruction and not modified
again.</li>
<li><code>x</code> — Temporary value, the value from the previous step is discarded. This is set to <code>0</code> if
the input value matches a calculation based on <code>z</code> and a parameter which varies for each step,
or to <code>1</code> otherwise.</li>
<li><code>y</code> — Another temporary value, this is used to calculate values based on <code>x</code>, <code>w</code> and a
parameter, and then used to update <code>z</code>. The value is carefully calculated to not update <code>z</code> if
<code>x</code> is set to <code>0</code>, by setting it to <code>1</code> for a multiply or <code>0</code> for an add.</li>
<li><code>z</code> — An accumulator, which is kept between steps. This starts off at <code>0</code> and gets
conditionally multiplied by 26, divided by 26, and added to.</li>
</ul>
<p>We can compile the differences in each step into a table of parameters. Since a divide by one
is an identity operation, we reduce the first difference into a boolean, tracking whether we
will divide of not. We will name the other two parameters <code>check</code> and <code>increment</code>, based on
how they are used. So using the programme I was given as an example, we end up with the
following:</p>
<div><table><thead><tr><th>Parameter</th><th style="text-align: center">1</th><th style="text-align: center">2</th><th style="text-align: center">3</th><th style="text-align: center">4</th><th style="text-align: center">5</th><th style="text-align: center">6</th><th style="text-align: center">7</th><th style="text-align: center">8</th><th style="text-align: center">9</th><th style="text-align: center">10</th><th style="text-align: center">11</th><th style="text-align: center">12</th><th style="text-align: center">13</th><th style="text-align: center">14</th></tr></thead><tbody>
<tr><td><code>divide</code></td><td style="text-align: center"></td><td style="text-align: center"></td><td style="text-align: center"></td><td style="text-align: center"></td><td style="text-align: center"></td><td style="text-align: center">yes</td><td style="text-align: center"></td><td style="text-align: center">yes</td><td style="text-align: center">yes</td><td style="text-align: center"></td><td style="text-align: center">yes</td><td style="text-align: center">yes</td><td style="text-align: center">yes</td><td style="text-align: center">yes</td></tr>
<tr><td><code>check</code></td><td style="text-align: center"><code>10</code></td><td style="text-align: center"><code>12</code></td><td style="text-align: center"><code>10</code></td><td style="text-align: center"><code>12</code></td><td style="text-align: center"><code>11</code></td><td style="text-align: center"><code>-16</code></td><td style="text-align: center"><code>10</code></td><td style="text-align: center"><code>-11</code></td><td style="text-align: center"><code>-13</code></td><td style="text-align: center"><code>13</code></td><td style="text-align: center"><code>-8</code></td><td style="text-align: center"><code>-1</code></td><td style="text-align: center"><code>-4</code></td><td style="text-align: center"><code>-14</code></td></tr>
<tr><td><code>increment</code></td><td style="text-align: center"><code>12</code></td><td style="text-align: center"><code>7</code></td><td style="text-align: center"><code>8</code></td><td style="text-align: center"><code>8</code></td><td style="text-align: center"><code>15</code></td><td style="text-align: center"><code>12</code></td><td style="text-align: center"><code>8</code></td><td style="text-align: center"><code>13</code></td><td style="text-align: center"><code>3</code></td><td style="text-align: center"><code>13</code></td><td style="text-align: center"><code>3</code></td><td style="text-align: center"><code>9</code></td><td style="text-align: center"><code>4</code></td><td style="text-align: center"><code>13</code></td></tr>
</tbody></table>
</div>
<p>And we can descibe the algorithm for each step as code. Here we use <code>acc</code> to refer to the
shared state stored in register <code>z</code>, and we expect the parameters for each step to be passed in
a struct:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">struct </span>StepParams {
    divide: bool,
    check: i64,
    increment: i64,
}
<span class="kw">fn </span>apply_step (params: &amp; StepParams, acc: &amp; <span class="kw-2">mut </span>i64, input: i64) {
    <span class="kw">if </span>input == * acc % <span class="number">26 </span>+ params.check { <span class="comment">// instructions 2-4,6-8
        </span><span class="kw">if </span>params.divide { * acc /= <span class="number">26</span>; }   <span class="comment">// instruction 5
    </span>} <span class="kw">else </span>{
        <span class="kw">if </span>! params.divide { * acc <span class="kw-2">*</span>= <span class="number">26</span>; } <span class="comment">// instructions 9-13
        </span>* acc += input + params.increment;  <span class="comment">// instructions 14-18
    </span>}
}</code></pre></div>
<p>We can either divide <code>acc</code> by 26, multiply it by 26 and add something, or just add something.
Furthermore, in seven of our fourteen steps we always multiply, so to get this value down to
zero we are going to have to make sure we divide on all seven of the other steps. The extra
addition from increment will have to be removed as a rounding error from the division - this
presumably is intended to reduce the total number of valid inputs.</p>
<p>Since we are deciding whether to divide based on a value derived from <code>acc</code> and <code>check</code>, we
can simply calculate the correct value based on the previous digits. This reduces our problem
from searching 9¹⁴ (twenty-three trillion) combinations, down to only 9⁷ (five million).
What’s more, we will often be able to shortcut the search if there is no matching next digit.</p>
<p>This leads to the algorithm implemented here. The steps are encoded in the <a href="struct.Step.html" title="struct aoc_2021_day_24::quick::Step"><code>Step</code></a> struct,
and the <code>steps_for</code> function reads an input programme and identifies the correct parameters
for each step. I inverted the <code>divide</code> parameter around and called it <a href="struct.Step.html#structfield.random" title="field aoc_2021_day_24::quick::Step::random"><code>random</code></a></p>
<ul>
<li>this indicates that we should choose a random value for this input value, or in practice try
all possible values. The <code>iterator</code> function returns an iterator over all of the valid inputs,
actually 14 nested iterators plus a final call to <code>map</code> at the end to check the final sum, and
to convert to match the function signature.</li>
</ul>
<p>The actual algorithm is implemented in the <a href="enum.NextNumIter.html" title="enum aoc_2021_day_24::quick::NextNumIter"><code>NextNumIter</code></a> struct. This is an iterator
adapter, which takes an iterator over partial solutions and provides the possible answers with
the next digit included. If this is a <code>random</code> step, then this expands every <code>n</code>-digit entry
into nine <code>n+1</code>-digit entries, one for each valid digit. Otherwise, it will either provide a
single entry with the appropriate next digit, or no entries if the correct next digit is not
in the valid range.</p>
<h2 id="performance"><a href="#performance">Performance</a></h2>
<p>This shows the time for finding the answers for the puzzle, and for finding all valid codes,
plus the peak memory usage, for each build version.</p>
<div><table><thead><tr><th style="text-align: center">Version</th><th style="text-align: center">Puzzle</th><th style="text-align: center">All</th><th style="text-align: center">Memory</th></tr></thead><tbody>
<tr><td style="text-align: center">Debug</td><td style="text-align: center">0.56 secs</td><td style="text-align: center">2.23 secs</td><td style="text-align: center">2.88 MiB</td></tr>
<tr><td style="text-align: center">Release</td><td style="text-align: center">0.10 secs</td><td style="text-align: center">0.39 secs</td><td style="text-align: center">2.20 MiB</td></tr>
</tbody></table>
</div></div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Step.html" title="struct aoc_2021_day_24::quick::Step">Step</a></div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.NextNumIter.html" title="enum aoc_2021_day_24::quick::NextNumIter">NextNumIter</a></div></li></ul><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.iterator.html" title="fn aoc_2021_day_24::quick::iterator">iterator</a></div></li><li><div class="item-name"><a class="fn" href="fn.steps_for.html" title="fn aoc_2021_day_24::quick::steps_for">steps_for</a></div></li></ul></section></div></main></body></html>